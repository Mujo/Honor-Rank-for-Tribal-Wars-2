function PointerEventsPolyfill(a){if(this.options={selector:"*",mouseEvents:["click","dblclick","mousedown","mouseup"],usePolyfillIf:function(){if("Microsoft Internet Explorer"==navigator.appName){var a=navigator.userAgent;if(null!=a.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/)){var b=parseFloat(RegExp.$1);if(11>b)return!0}}return!1}},a){var b,c=this;for(b in a)c.options[b]=a[b]}this.options.usePolyfillIf()&&this.register_mouse_events()}var requirejs,require,define;!function(a){function b(a,b){return r.call(a,b)}function c(a,b){var c,d,e,f,g,h,i,j,k,l,m=b&&b.split("/"),n=p.map,o=n&&n["*"]||{};if(a&&"."===a.charAt(0)&&b){for(m=m.slice(0,m.length-1),a=m.concat(a.split("/")),j=0;j<a.length;j+=1)if(l=a[j],"."===l)a.splice(j,1),j-=1;else if(".."===l){if(1===j&&(".."===a[2]||".."===a[0]))break;j>0&&(a.splice(j-1,2),j-=2)}a=a.join("/")}if((m||o)&&n){for(c=a.split("/"),j=c.length;j>0;j-=1){if(d=c.slice(0,j).join("/"),m)for(k=m.length;k>0;k-=1)if(e=n[m.slice(0,k).join("/")],e&&(e=e[d])){f=e,g=j;break}if(f)break;!h&&o&&o[d]&&(h=o[d],i=j)}!f&&h&&(f=h,g=i),f&&(c.splice(0,g,f),a=c.join("/"))}return a}function d(b,c){return function(){return k.apply(a,s.call(arguments,0).concat([b,c]))}}function e(a){return function(b){return c(b,a)}}function f(a){return function(b){n[a]=b}}function g(c){if(b(o,c)){var d=o[c];delete o[c],q[c]=!0,j.apply(a,d)}if(!b(n,c)&&!b(q,c))throw new Error("No "+c);return n[c]}function h(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function i(a){return function(){return p&&p.config&&p.config[a]||{}}}var j,k,l,m,n={},o={},p={},q={},r=Object.prototype.hasOwnProperty,s=[].slice;l=function(a,b){var d,f=h(a),i=f[0];return a=f[1],i&&(i=c(i,b),d=g(i)),i?a=d&&d.normalize?d.normalize(a,e(b)):c(a,b):(a=c(a,b),f=h(a),i=f[0],a=f[1],i&&(d=g(i))),{f:i?i+"!"+a:a,n:a,pr:i,p:d}},m={require:function(a){return d(a)},exports:function(a){var b=n[a];return"undefined"!=typeof b?b:n[a]={}},module:function(a){return{id:a,uri:"",exports:n[a],config:i(a)}}},j=function(c,e,h,i){var j,k,p,r,s,t,u=[];if(i=i||c,"function"==typeof h){for(e=!e.length&&h.length?["require","exports","module"]:e,s=0;s<e.length;s+=1)if(r=l(e[s],i),k=r.f,"require"===k)u[s]=m.require(c);else if("exports"===k)u[s]=m.exports(c),t=!0;else if("module"===k)j=u[s]=m.module(c);else if(b(n,k)||b(o,k)||b(q,k))u[s]=g(k);else{if(!r.p)throw new Error(c+" missing "+k);r.p.load(r.n,d(i,!0),f(k),{}),u[s]=n[k]}p=h.apply(n[c],u),c&&(j&&j.exports!==a&&j.exports!==n[c]?n[c]=j.exports:p===a&&t||(n[c]=p))}else c&&(n[c]=h)},requirejs=require=k=function(b,c,d,e,f){return"string"==typeof b?m[b]?m[b](c):g(l(b,c).f):(b.splice||(p=b,c.splice?(b=c,c=d,d=null):b=a),c=c||function(){},"function"==typeof d&&(d=e,e=f),e?j(a,b,c,d):setTimeout(function(){j(a,b,c,d)},15),k)},k.config=function(a){return p=a,k},define=function(a,c,d){c.splice||(d=c,c=[]),b(n,a)||(o[a]=[a,c,d])},define.amd={jQuery:!0}}(),define("../libs/almond",function(){}),/*!
 * Sizzle CSS Selector Engine
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://sizzlejs.com/
 */
function(a,b){function c(a,b,c,d){c=c||[],b=b||G;var e,f,g,h,i=b.nodeType;if(!a||"string"!=typeof a)return c;if(1!==i&&9!==i)return[];if(g=v(b),!g&&!d&&(e=ca.exec(a)))if(h=e[1]){if(9===i){if(f=b.getElementById(h),!f||!f.parentNode)return c;if(f.id===h)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(h))&&w(b,f)&&f.id===h)return c.push(f),c}else{if(e[2])return L.apply(c,M.call(b.getElementsByTagName(a),0)),c;if((h=e[3])&&ma&&b.getElementsByClassName)return L.apply(c,M.call(b.getElementsByClassName(h),0)),c}return p(a.replace($,"$1"),b,c,d,g)}function d(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function e(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function f(a){return O(function(b){return b=+b,O(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function g(a,b){if(a&&b)for(var c=a.nextSibling;c;){if(c===b)return-1;c=c.nextSibling}return a?1:-1}function h(a,b){var d,e,f,g,h,i,j,k=R[E][a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=t.preFilter;h;){(!d||(e=_.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=aa.exec(h))&&(f.push(d=new F(e.shift())),h=h.slice(d.length),d.type=e[0].replace($," "));for(g in t.filter)!(e=ha[g].exec(h))||j[g]&&!(e=j[g](e))||(f.push(d=new F(e.shift())),h=h.slice(d.length),d.type=g,d.matches=e);if(!d)break}return b?h.length:h?c.error(a):R(a,i).slice(0)}function i(a,b,c){var d=b.dir,e=c&&"parentNode"===b.dir,f=J++;return b.first?function(b,c,f){for(;b=b[d];)if(e||1===b.nodeType)return a(b,c,f)}:function(b,c,g){if(g){for(;b=b[d];)if((e||1===b.nodeType)&&a(b,c,g))return b}else for(var h,i=I+" "+f+" ",j=i+r;b=b[d];)if(e||1===b.nodeType){if((h=b[E])===j)return b.sizset;if("string"==typeof h&&0===h.indexOf(i)){if(b.sizset)return b}else{if(b[E]=j,a(b,c,g))return b.sizset=!0,b;b.sizset=!1}}}}function j(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function k(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function l(a,b,c,d,e,f){return d&&!d[E]&&(d=l(d)),e&&!e[E]&&(e=l(e,f)),O(function(f,g,h,i){var j,l,m,n=[],p=[],q=g.length,r=f||o(b||"*",h.nodeType?[h]:h,[]),s=!a||!f&&b?r:k(r,n,a,h,i),t=c?e||(f?a:q||d)?[]:g:s;if(c&&c(s,t,h,i),d)for(j=k(t,p),d(j,[],h,i),l=j.length;l--;)(m=j[l])&&(t[p[l]]=!(s[p[l]]=m));if(f){if(e||a){if(e){for(j=[],l=t.length;l--;)(m=t[l])&&j.push(s[l]=m);e(null,t=[],j,i)}for(l=t.length;l--;)(m=t[l])&&(j=e?N.call(f,m):n[l])>-1&&(f[j]=!(g[j]=m))}}else t=k(t===g?t.splice(q,t.length):t),e?e(null,g,t,i):L.apply(g,t)})}function m(a){for(var b,c,d,e=a.length,f=t.relative[a[0].type],g=f||t.relative[" "],h=f?1:0,k=i(function(a){return a===b},g,!0),n=i(function(a){return N.call(b,a)>-1},g,!0),o=[function(a,c,d){return!f&&(d||c!==A)||((b=c).nodeType?k(a,c,d):n(a,c,d))}];e>h;h++)if(c=t.relative[a[h].type])o=[i(j(o),c)];else{if(c=t.filter[a[h].type].apply(null,a[h].matches),c[E]){for(d=++h;e>d&&!t.relative[a[d].type];d++);return l(h>1&&j(o),h>1&&a.slice(0,h-1).join("").replace($,"$1"),c,d>h&&m(a.slice(h,d)),e>d&&m(a=a.slice(d)),e>d&&a.join(""))}o.push(c)}return j(o)}function n(a,b){var d=b.length>0,e=a.length>0,f=function(g,h,i,j,l){var m,n,o,p=[],q=0,s="0",u=g&&[],v=null!=l,w=A,x=g||e&&t.find.TAG("*",l&&h.parentNode||h),y=I+=null==w?1:Math.E;for(v&&(A=h!==G&&h,r=f.el);null!=(m=x[s]);s++){if(e&&m){for(n=0;o=a[n];n++)if(o(m,h,i)){j.push(m);break}v&&(I=y,r=++f.el)}d&&((m=!o&&m)&&q--,g&&u.push(m))}if(q+=s,d&&s!==q){for(n=0;o=b[n];n++)o(u,p,h,i);if(g){if(q>0)for(;s--;)u[s]||p[s]||(p[s]=K.call(j));p=k(p)}L.apply(j,p),v&&!g&&p.length>0&&q+b.length>1&&c.uniqueSort(j)}return v&&(I=y,A=w),u};return f.el=0,d?O(f):f}function o(a,b,d){for(var e=0,f=b.length;f>e;e++)c(a,b[e],d);return d}function p(a,b,c,d,e){var f,g,i,j,k,l=h(a);if(!d&&1===l.length){if(g=l[0]=l[0].slice(0),g.length>2&&"ID"===(i=g[0]).type&&9===b.nodeType&&!e&&t.relative[g[1].type]){if(b=t.find.ID(i.matches[0].replace(ga,""),b,e)[0],!b)return c;a=a.slice(g.shift().length)}for(f=ha.POS.test(a)?-1:g.length-1;f>=0&&(i=g[f],!t.relative[j=i.type]);f--)if((k=t.find[j])&&(d=k(i.matches[0].replace(ga,""),da.test(g[0].type)&&b.parentNode||b,e))){if(g.splice(f,1),a=d.length&&g.join(""),!a)return L.apply(c,M.call(d,0)),c;break}}return x(a,l)(d,b,e,c,da.test(a)),c}function q(){}var r,s,t,u,v,w,x,y,z,A,B="undefined",C=1<<31,D=!0,E=("sizcache"+Math.random()).replace(".",""),F=String,G=a.document,H=G.documentElement,I=0,J=0,K=[].pop,L=[].push,M=[].slice,N=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},O=function(a,b){return a[E]=null==b||b,a},P=function(){var a={},b=[];return O(function(c,d){return b.push(c)>t.cacheLength&&delete a[b.shift()],a[c+" "]=d},a)},Q=P(),R=P(),S=P(),T="[\\x20\\t\\r\\n\\f]",U="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",V=U.replace("w","w#"),W="([*^$|!~]?=)",X="\\["+T+"*("+U+")"+T+"*(?:"+W+T+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+V+")|)|)"+T+"*\\]",Y=":("+U+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+X+")|[^:]|\\\\.)*|.*))\\)|)",Z=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+T+"*((?:-\\d)?\\d*)"+T+"*\\)|)(?=[^-]|$)",$=new RegExp("^"+T+"+|((?:^|[^\\\\])(?:\\\\.)*)"+T+"+$","g"),_=new RegExp("^"+T+"*,"+T+"*"),aa=new RegExp("^"+T+"*([\\x20\\t\\r\\n\\f>+~])"+T+"*"),ba=new RegExp(Y),ca=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,da=/[\x20\t\r\n\f]*[+~]/,ea=/h\d/i,fa=/input|select|textarea|button/i,ga=/\\(?!\\)/g,ha={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),NAME:new RegExp("^\\[name=['\"]?("+U+")['\"]?\\]"),TAG:new RegExp("^("+U.replace("w","w*")+")"),ATTR:new RegExp("^"+X),PSEUDO:new RegExp("^"+Y),POS:new RegExp(Z,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+T+"*(even|odd|(([+-]|)(\\d*)n|)"+T+"*(?:([+-]|)"+T+"*(\\d+)|))"+T+"*\\)|)","i"),needsContext:new RegExp("^"+T+"*[>+~]|"+Z,"i")},ia=function(a){var b=G.createElement("div");try{return a(b)}catch(c){return!1}finally{b=null}},ja=ia(function(a){return a.appendChild(G.createComment("")),!a.getElementsByTagName("*").length}),ka=ia(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==B&&"#"===a.firstChild.getAttribute("href")}),la=ia(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return"boolean"!==b&&"string"!==b}),ma=ia(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",a.getElementsByClassName&&a.getElementsByClassName("e").length?(a.lastChild.className="e",2===a.getElementsByClassName("e").length):!1}),na=ia(function(a){a.id=E+0,a.innerHTML="<a name='"+E+"'></a><div name='"+E+"'></div>",H.insertBefore(a,H.firstChild);var b=G.getElementsByName&&G.getElementsByName(E).length===2+G.getElementsByName(E+0).length;return s=!G.getElementById(E),H.removeChild(a),b});try{M.call(H.childNodes,0)[0].nodeType}catch(oa){M=function(a){for(var b,c=[];b=this[a];a++)c.push(b);return c}}c.matches=function(a,b){return c(a,null,null,b)},c.matchesSelector=function(a,b){return c(b,null,null,[a]).length>0},u=c.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=u(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=u(b);return c},v=c.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},w=c.contains=H.contains?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&1===d.nodeType&&c.contains&&c.contains(d))}:H.compareDocumentPosition?function(a,b){return b&&!!(16&a.compareDocumentPosition(b))}:function(a,b){for(;b=b.parentNode;)if(b===a)return!0;return!1},c.attr=function(a,b){var c,d=v(a);return d||(b=b.toLowerCase()),(c=t.attrHandle[b])?c(a):d||la?a.getAttribute(b):(c=a.getAttributeNode(b),c?"boolean"==typeof a[b]?a[b]?b:null:c.specified?c.value:null:null)},t=c.selectors={cacheLength:50,createPseudo:O,match:ha,attrHandle:ka?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},find:{ID:s?function(a,b,c){if(typeof b.getElementById!==B&&!c){var d=b.getElementById(a);return d&&d.parentNode?[d]:[]}}:function(a,c,d){if(typeof c.getElementById!==B&&!d){var e=c.getElementById(a);return e?e.id===a||typeof e.getAttributeNode!==B&&e.getAttributeNode("id").value===a?[e]:b:[]}},TAG:ja?function(a,b){return typeof b.getElementsByTagName!==B?b.getElementsByTagName(a):void 0}:function(a,b){var c=b.getElementsByTagName(a);if("*"===a){for(var d,e=[],f=0;d=c[f];f++)1===d.nodeType&&e.push(d);return e}return c},NAME:na&&function(a,b){return typeof b.getElementsByName!==B?b.getElementsByName(name):void 0},CLASS:ma&&function(a,b,c){return typeof b.getElementsByClassName===B||c?void 0:b.getElementsByClassName(a)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ga,""),a[3]=(a[4]||a[5]||"").replace(ga,""),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1]?(a[2]||c.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*("even"===a[2]||"odd"===a[2])),a[4]=+(a[6]+a[7]||"odd"===a[2])):a[2]&&c.error(a[0]),a},PSEUDO:function(a){var b,c;return ha.CHILD.test(a[0])?null:(a[3]?a[2]=a[3]:(b=a[4])&&(ba.test(b)&&(c=h(b,!0))&&(c=b.indexOf(")",b.length-c)-b.length)&&(b=b.slice(0,c),a[0]=a[0].slice(0,c)),a[2]=b),a.slice(0,3))}},filter:{ID:s?function(a){return a=a.replace(ga,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(ga,""),function(b){var c=typeof b.getAttributeNode!==B&&b.getAttributeNode("id");return c&&c.value===a}},TAG:function(a){return"*"===a?function(){return!0}:(a=a.replace(ga,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=Q[E][a+" "];return b||(b=new RegExp("(^|"+T+")"+a+"("+T+"|$)"))&&Q(a,function(a){return b.test(a.className||typeof a.getAttribute!==B&&a.getAttribute("class")||"")})},ATTR:function(a,b,d){return function(e){var f=c.attr(e,a);return null==f?"!="===b:b?(f+="","="===b?f===d:"!="===b?f!==d:"^="===b?d&&0===f.indexOf(d):"*="===b?d&&f.indexOf(d)>-1:"$="===b?d&&f.substr(f.length-d.length)===d:"~="===b?(" "+f+" ").indexOf(d)>-1:"|="===b?f===d||f.substr(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d){return"nth"===a?function(a){var b,e,f=a.parentNode;if(1===c&&0===d)return!0;if(f)for(e=0,b=f.firstChild;b&&(1!==b.nodeType||(e++,a!==b));b=b.nextSibling);return e-=d,e===c||e%c===0&&e/c>=0}:function(b){var c=b;switch(a){case"only":case"first":for(;c=c.previousSibling;)if(1===c.nodeType)return!1;if("first"===a)return!0;c=b;case"last":for(;c=c.nextSibling;)if(1===c.nodeType)return!1;return!0}}},PSEUDO:function(a,b){var d,e=t.pseudos[a]||t.setFilters[a.toLowerCase()]||c.error("unsupported pseudo: "+a);return e[E]?e(b):e.length>1?(d=[a,a,"",b],t.setFilters.hasOwnProperty(a.toLowerCase())?O(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=N.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,d)}):e}},pseudos:{not:O(function(a){var b=[],c=[],d=x(a.replace($,"$1"));return d[E]?O(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:O(function(a){return function(b){return c(a,b).length>0}}),contains:O(function(a){return function(b){return(b.textContent||b.innerText||u(b)).indexOf(a)>-1}}),enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!t.pseudos.empty(a)},empty:function(a){var b;for(a=a.firstChild;a;){if(a.nodeName>"@"||3===(b=a.nodeType)||4===b)return!1;a=a.nextSibling}return!0},header:function(a){return ea.test(a.nodeName)},text:function(a){var b,c;return"input"===a.nodeName.toLowerCase()&&"text"===(b=a.type)&&(null==(c=a.getAttribute("type"))||c.toLowerCase()===b)},radio:d("radio"),checkbox:d("checkbox"),file:d("file"),password:d("password"),image:d("image"),submit:e("submit"),reset:e("reset"),button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},input:function(a){return fa.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},active:function(a){return a===a.ownerDocument.activeElement},first:f(function(){return[0]}),last:f(function(a,b){return[b-1]}),eq:f(function(a,b,c){return[0>c?c+b:c]}),even:f(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:f(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:f(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:f(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},y=H.compareDocumentPosition?function(a,b){var c,d;return a===b?(z=!0,0):a.compareDocumentPosition&&b.compareDocumentPosition?1&(c=a.compareDocumentPosition(b))||(d=a.parentNode)&&11===d.nodeType?a===G||w(G,a)?-1:b===G||w(G,b)?1:0:4&c?-1:1:a.compareDocumentPosition?-1:1}:function(a,b){if(a===b)return z=!0,0;if(a.sourceIndex&&b.sourceIndex)return(~b.sourceIndex||C)-(w(G,a)&&~a.sourceIndex||C);var c=0,d=[a],e=[b],f=a.parentNode,h=b.parentNode,i=f;if(a===G)return-1;if(b===G)return 1;if(!f&&!h)return 0;if(!h)return-1;if(!f)return 1;if(f===h)return g(a,b);for(;i;)d.unshift(i),i=i.parentNode;for(i=h;i;)e.unshift(i),i=i.parentNode;for(;d[c]===e[c];)c++;return 0===c?d[0]===G||w(G,d[0])?-1:e[0]===G||w(G,e[0])?1:0:g(d[c],e[c])},[0,0].sort(y),D=!z,c.uniqueSort=function(a){var b,c=[],d=1,e=0;if(z=D,a.sort(y),z){for(;b=a[d];d++)b===a[d-1]&&(e=c.push(d));for(;e--;)a.splice(c[e],1)}return a},c.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},x=c.compile=function(a,b){var c,d=[],e=[],f=S[E][a+" "];if(!f){for(b||(b=h(a)),c=b.length;c--;)f=m(b[c]),f[E]?d.push(f):e.push(f);f=S(a,n(e,d))}return f},G.querySelectorAll&&!function(){var a,b=p,d=/'|\\/g,e=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,f=[":focus"],g=[":active"],i=H.matchesSelector||H.mozMatchesSelector||H.webkitMatchesSelector||H.oMatchesSelector||H.msMatchesSelector;ia(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||f.push("\\["+T+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||f.push(":checked")}),ia(function(a){a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&f.push("[*^$]="+T+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'/>",a.querySelectorAll(":enabled").length||f.push(":enabled",":disabled")}),f=new RegExp(f.join("|")),p=function(a,c,e,g,i){if(!g&&!i&&!f.test(a)){var j,k,l=!0,m=E,n=c,o=9===c.nodeType&&a;if(1===c.nodeType&&"object"!==c.nodeName.toLowerCase()){for(j=h(a),(l=c.getAttribute("id"))?m=l.replace(d,"\\$&"):c.setAttribute("id",m),m="[id='"+m+"'] ",k=j.length;k--;)j[k]=m+j[k].join("");n=da.test(a)&&c.parentNode||c,o=j.join(",")}if(o)try{return L.apply(e,M.call(n.querySelectorAll(o),0)),e}catch(p){}finally{l||c.removeAttribute("id")}}return b(a,c,e,g,i)},i&&(ia(function(b){a=i.call(b,"div");try{i.call(b,"[test!='']:sizzle"),g.push("!=",Y)}catch(c){}}),g=new RegExp(g.join("|")),c.matchesSelector=function(b,d){if(d=d.replace(e,"='$1']"),!v(b)&&!g.test(d)&&!f.test(d))try{var h=i.call(b,d);if(h||a||b.document&&11!==b.document.nodeType)return h}catch(j){}return c(d,null,null,[b]).length>0})}(),t.pseudos.nth=t.pseudos.eq,t.filters=q.prototype=t.pseudos,t.setFilters=new q,"function"==typeof define&&define.amd&&define("sizzle",[],function(){return c}),a.Sizzle=c}(window),function a(b,a,c,d){d=d||{csstransforms3d:!1,csstransforms:!1,prefixed:function(a){return a}};var e=b.document,f="internal-id",g="before",h="after",i=["margin-top","margin-bottom","padding-top","padding-bottom","border-bottom-width","border-top-width"],j=["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],k=["margin-left","margin-right"],l=d.prefixed("transform"),m=/(webkit)[ \/]([\w.]+)/,n=/(opera)(?:.*version)?[ \/]([\w.]+)/,o=/(msie) ([\w.]+)/,p=/(mozilla)(?:.*? rv:([\w.]+))?/,q=function(a){var b=m.exec(a)||n.exec(a)||o.exec(a)||a.indexOf("compatible")<0&&p.exec(a)||[],c={version:b[2],vendor:b[1]};return c[b[1]]=b[2],c}(window.navigator.userAgent.toLowerCase()),r="rclick0lclick0click0mousedown0mouseup0mousemove0transitionend0resize0wheel".split(0),s=219540062,t=function(a){return a.replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()})},u=function(a,c){var d=null;return b.getComputedStyle?d=b.getComputedStyle(a,null).getPropertyValue(c):a.currentStyle&&(d=a.currentStyle[t(c)]),d},v={transitionend:{mozilla:"transitionend",webkit:"webkitTransitionEnd",opera:"oTransitionEnd",msie:"transitionend"}},w={wheel:function(a){var b=[330,10,1];return function(c){return a(c,c.deltaY/-(b[c.deltaMode]||1),c.deltaX,c.deltaY)}}},x=function(a){var b=q.vendor;return v[a]&&(a=v[a][b]),a},y=function(a,b,c){switch(c){case g:return a.insertBefore(b,a.firstChild);case h:return a.appendChild(b)}},z=1,A={},B=function(a){var b,c=a.length;if(E.isArray(a))b=a;else for(b=[];c--;)b[c]=a[c];for(c in P)P.hasOwnProperty(c)&&(b[c]=P[c]);return b},C=function(a,b){var d;return d=c?c(a,b||e):[].slice.call((b||e).querySelectorAll(a),0)},D=function(a,b){return c.matchesSelector(a,b)},E=function Q(a){var c;if(Q.isUndef(a))c=[];else if(Q.isString(a))c=C(a);else if(Q.isHTMLNode(a)||a===b||a===e)c=[a];else try{c=[].slice.call(a).filter(function(a){return Q.isHTMLNode(a)||a})}catch(d){c=[]}return B(c)},F=function(a,b,c,d){if(E.isNode(a))if(d)a.removeAttribute(b);else{if(!E.isObject(b))return E.isUndef(c)?a.getAttribute(b):a.setAttribute(b,c);var e;for(e in b)b.hasOwnProperty(e)&&a.setAttribute(e,b[e])}},G=function(a,b,c){b=0|b,c=0|c,d.csstransforms3d?a.style[l]="translate3d("+b+"px,"+c+"px,0)":d.csstransforms?a.style[l]="translate("+b+"px,"+c+"px)":(a.style.left=b+"px",a.style.top=c+"px")},H=function(a,b,c){if(A[a]&&A[a][b]){var d=A[a][b].indexOf(c);d>=0&&A[a][b].splice(d,1)}},I=function(a,c,d,g){var h=c.match("key");w[c]&&(d=w[c](d)),c=x(c),a.forEach(function(a){var i;if(i=E.isNode(a)?F(a,f):a===b?"w":a===e?"d":null,!g){if(i||F(a,f,i=z++),A[i]=A[i]||{},A[i][c]=A[i][c]||[],A[i][c].indexOf(d)>=0)throw new Error("duplicated listener!");A[i][c].push(d)}h&&(g||a.tabIndex&&!(a.tabIndex<0)?g&&a.tabIndex===s&&(a.tabIndex=-1):a.tabIndex=s),e.addEventListener?g?(a.removeEventListener(c,d,!1),H(i,c,d)):a.addEventListener(c,d,!1):e.attachEvent&&(g?(a.detachEvent("on"+c,d),H(i,c,d)):a.attachEvent("on"+c,d))})},J=function(a,b,c){var d;for(d in b)b.hasOwnProperty(d)&&I(a,d,b[d],c)},K=function(a,b){a.forEach(function(a){var c=e.createEvent("UIEvents");c.initEvent(b,!0,!0),a.dispatchEvent(c)})},L=function(a,c){a.forEach(function(a){var d,g,h;if(d=E.isNode(a)?F(a,f):a===b?"w":a===e?"d":null,c){if(A[d]&&A[d][c]){for(;h=A[d][c].pop();)I([a],c,h,!0);delete A[d][c]}}else for(g in A[d])if(A[d].hasOwnProperty(g)){for(;h=A[d][g].pop();)I([a],g,h,!0);delete A[d][g]}E.isObject(A[d])&&!Object.keys(A[d]).length&&(F(a,f,0,!0),delete A[d])})},M=function(a,b,c){var d=(F(a,"class")||"").trim().split(" ");c?d=d.filter(function(a){return a!==b}):d.indexOf(b)<0&&d.push(b),F(a,"class",d.join(" ").trim())},N=function(a){return a.style.display="block",this},O=function(a){return a.style.display="none",this},P={isVisible:function(){var a;for(a=0;a<this.length;a++)if(0===this[a].offsetHeight)return!1;return!0},matchesSelector:function(a){return c.matchesSelector(this[0],a)},find:function(a){var b=[];return this.forEach(function(c){b.push(C(a,c))}),B([].concat.apply([],b))},focus:function(){return this.length&&this[0].focus(),this},parent:function(){return B(this.map(function(a){return a.parentNode}))},parents:function(a){for(var b,c=[],d=this.length;d--;)for(b=this[d];b&&b.parentNode&&b.parentNode!==e;)b=b.parentNode,D(b,a)&&c.push(b);return B(c)},css:function(a,b){if(E.isString(a)){if(a=d.prefixed(a),E.isUndef(b))return this.length?u(this[0],a):null;this.forEach(function(c){c.style[a]=b})}else E.isObject(a)&&this.forEach(function(b){var c,e;for(c in a)e=d.prefixed(c),a.hasOwnProperty(c)&&(b.style[e]=a[c])});return this},on:function(a,b){return E.isObject(a)?J(this,a):I(this,a,b),this},off:function(a,b){return E.isUndef(a)?L(this):E.isObject(a)?J(this,a,!0):b?I(this,a,b,!0):L(this,a),this},one:function(a,b){var c=this;return I(c,a,function d(){b.apply(this,arguments),I([this],a,d,!0)}),this},trigger:function(a){return K(this,a),this},attr:function(a,b){return!E.isObject(a)&&E.isUndef(b)?this.map(function(b){return F(b,a)}):(this.forEach(function(c){F(c,a,b)}),this)},removeAttr:function(a){return this.forEach(function(b){F(b,a,0,!0)}),this},cls:function(a,b){return this.forEach(function(c){M(c,a,b)}),this},addClass:function(a){return this.cls(a)},removeClass:function(a){return this.cls(a,!0)},children:function(a){var b=[];return this.forEach(function(c){for(var d=c.childNodes.length;d--;)a&&!D(c.childNodes[d],a)||!E.isHTMLNode(c.childNodes[d])||b.push(c.childNodes[d])}),b.reverse(),B(b)},toggleClass:function(a,b){return this.forEach(function(c){var d=!b;E.isUndef(b)&&(d=D(c,"."+a)),M(c,a,d)}),this},closest:function(a){var b=this.map(function(b){for(;b&&b.parentNode;){if(D(b,a))return b;b=b.parentNode}return void 0});return B(b)},siblings:function(a){var b=this.map(function(b){for(var c=b,d=[];b=b.nextSibling;)!E.isHTMLNode(b)||a&&!D(b,a)||d.push(b);for(b=c;b=b.previousSibling;)!E.isHTMLNode(b)||a&&!D(b,a)||d.unshift(b);return d});return B([].concat.apply([],b))},prepend:function(a){return this.append(a,g)},append:function(c,d){var e,f,g;if(E.isArray(c)){for(e=document.createDocumentFragment(),g=c.length,f=0;g>f;)y(e,b[a].elementify(c[f]),d||h),f++;c=e}return this.forEach(function(e){y(e,b[a].elementify(c),d||h)}),this},appendTo:function(a){return this.forEach(function(b){y(a,b,h)}),this},html:function(c,d){var e;return E.isUndef(c)&&this[0]?this[0].innerHTML:(this.forEach(function(f){if(d)switch(e=f.parentNode,c=b[a].elementify(c),d){case g:e.insertBefore(c,f);break;case h:e.insertBefore(c,f.nextSibling)}else f.innerHTML=c}),this)},translate:function(a,b){return this.forEach(function(c){G(c,a,b)}),this},remove:function(){return L(this),this.forEach(function(a){var b;E.isNode(a)&&(b=a.parentNode)&&b.removeChild(a)}),this},show:function(){return this.forEach(N),this},hide:function(){return this.forEach(O),this},toggle:function(a){return this.forEach(function(b){E.isUndef(a)&&(a=!P.fn.isVisible(b)),a?N(b):O(b)}),this},offset:function(){return this[0]?this[0].getBoundingClientRect():null},getComputedStyle:function(a,b){var c,d,f,g,h=this[0];if(h){if(b){for(c=e.createElement(h.tagName),f=(d=h.attributes).length;f--;)c.setAttribute(d[f].nodeName,d[f].nodeValue);h=c,q.mozilla?g=u(h,a):(e.body.appendChild(h),g=u(h,a),h.innerHTML='<div style="width:5000px;height:5000px;"></div>',g!==u(h,a)&&(g="auto"),e.body.removeChild(h))}else g=u(h,a);return g}},pos:function(){if(this[0]&&this[0].parentNode){var a=this[0].getBoundingClientRect(),b=this[0].parentNode.getBoundingClientRect();return{top:a.top-b.top,left:a.left-b.left}}return{}},width:function(){return this[0]?this[0].getBoundingClientRect().width:null},outerWidth:function(){var a=this[0];return k.reduce(function(b,c){return b+parseInt(u(a,c),10)},this.width()||0)},height:function(){return this[0]?this[0].getBoundingClientRect().height:null},innerHeight:function(){var a=this[0];return i.reduce(function(b,c){return b-parseInt(u(a,c),10)},this.height())},innerWidth:function(){var a=this[0];return j.reduce(function(b,c){return b-parseInt(u(a,c),10)},this.width())},val:function(a){return E.isUndef(a)?this.length?"checkbox"===this[0].type?this[0].checked:this[0].value:void 0:(this.forEach(function(b){"checkbox"===b.type?b.checked=a:b.value=a}),this)},getEventListeners:function(){return this.map(function(a){return A[F(a,f)]})},attrChange:function(a){var b,c,d,e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(e)for(c={subtree:!0,attributes:!0},d=new e(function(b){b.forEach(function(b){a.call(b.target,b.attributeName)})}),b=0;b<this.length;b++)d.observe(this[b],c);else E.isDOMAttrModifiedSupported()?this.on("DOMAttrModified",function(b){a.call(this,b.attrName)}):"onpropertychange"in document.body&&this.on("propertychange",function(b){a.call(this,window.event.propertyName)})}};E.elementify=function R(a){var b,c,d,f,g;if(E.isString(a))for(b=e.createDocumentFragment(),c=document.createElement("div"),c.innerHTML=a,f=c.childNodes.length;f;)b.appendChild(c.childNodes[0]),f--;else if(!(E.isString(a)||E.isHTMLNode(a)||E.isTextNode(a)||E.isFragment(a)))for(b=e.createDocumentFragment(),f=a.length,g=0;f>g;g++)d=null,E.isString(a[g])&&(d=R(a[g])),b.appendChild(d||a[g]);return b||a},E.browser=q,E.version={major:1,minor:1,patch:5,name:"hordak",toString:function(){return this.major+"."+this.minor+"."+this.patch+":"+this.name}},E.deepcopy=function S(a){var b,c,d=["string","number","boolean"],e=a instanceof Array?[]:{};for(b in a)a.hasOwnProperty(b)&&(c=typeof a[b],d.indexOf(c)<0?e[b]=S(a[b]):e[b]=a[b]);return e},r.forEach(function(a){P[a]=function(b){return b?I(this,a,b):K(this,a),this}}),b[a]=E,"function"==typeof define&&define.amd&&define("battlecat",[],function(){return E})}(window,"$",window.Sizzle,window.Modernizr),function(a){var b=function(a){return"string"==typeof a},c=function(a){return a instanceof Array},d=function(a){return a instanceof Object&&a.constructor===Object},e=function(a){return void 0===a},f=function(a){return a?1===a.nodeType:!1},g=function(a){return a?11===a.nodeType:!1},h=function(a){return f(a)||a===window||a===document},i=function(a){return a?3===a.nodeType:!1},j=function(a){return a instanceof HTMLElement&&!d(a)};a.isString=b,a.isArray=c,a.isObject=d,a.isUndef=e,a.isHTMLNode=f,a.isFragment=g,a.isWrappable=h,a.isTextNode=i,a.isNode=j}($),function(a,b){b.get=function(b,c,d){var e,f,g,h=function(){var a;200!==f.status,a=f.responseText,b.indexOf(".json")>0&&(a=JSON.parse(a)),c?c(a):e&&e(a)},i=function(a){};f=new XMLHttpRequest,d?"withCredentials"in f?f.open("get",b,!0):a.XDomainRequest&&(f=new XDomainRequest,f.open("get",b),g=!0):f.open("get",b,!0);try{f.addEventListener("load",h,!1),f.addEventListener("error",i,!1)}catch(j){f.onload=h,f.onerror=i,f.onprogress=function(){},f.ontimeout=function(){},f.onerror=function(){}}return g?a.setTimeout(function(){f.send()},0):f.send(),c?void 0:{success:function(a){e=a}}},b.getCORS=function(a,b){return this.get(a,b,!0)}}(window,$),window.log=function(){if(window.log.history=window.log.history||[],window.log.history.push(arguments),window.console){var a,b=arguments;a=[].slice.call(b),"object"==typeof console.log&&window.log.apply.call(console.log,console,a)}},function(a,b,c){for(var d=function(){};c=b.pop();)a[c]=a[c]||d}(function(){try{return window.console}catch(a){return window.console={}}}(),"assert0count0debug0dir0dirxml0error0exception0group0groupCollapsed0groupEnd0info0log0markTimeline0profile0profileEnd0time0timeEnd0trace0warn".split(0)),function(){var a,b=0,c=["ms","moz","webkit","o"];for(a=0;a<c.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-b)),f=window.setTimeout(function(){a(d+e)},e);return b=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),Modernizr.addTest("pointerevents",function(){var a,b=document.createElement("x"),c=document.documentElement,d=window.getComputedStyle;return"pointerEvents"in b.style?(b.style.pointerEvents="auto",b.style.pointerEvents="x",c.appendChild(b),a=d&&"auto"===d(b,"").pointerEvents,c.removeChild(b),!!a):!1}),Modernizr.addTest("canvasblending",function(){if(!Modernizr.canvas)return!1;var a=document.createElement("canvas").getContext("2d"),b="screen";return a.globalCompositeOperation=b,a.globalCompositeOperation===b}),window.CanvasRenderingContext2D&&(window.CanvasRenderingContext2D.prototype.strokeRoundedRect=function(a,b,c,d,e){this.beginPath(),this.moveTo(a+e,b),this.lineTo(a+c-e,b),this.arc(a+c-e,b+e,e,1.5*Math.PI,0),this.lineTo(a+c,b+d-e),this.arc(a+c-e,b+d-e,e,0,.5*Math.PI),this.lineTo(a+e,b+d),this.arc(a+e,b+d-e,e,.5*Math.PI,Math.PI),this.lineTo(a,b+e),this.arc(a+e,b+e,e,Math.PI,1.5*Math.PI),this.closePath(),this.stroke()}),define("plugins",function(){}),Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.remove=function(a,b){var c=(void 0!==b?b-a:0)+1;return this.splice(a,c),this.length},Array.prototype.max=function(a){return Math.max.apply(Math,a||this)},Array.prototype.min=function(a){return Math.min.apply(Math,a||this)},Array.prototype.merge=function(a,b){var c,d,e=a.length;for(b=b||function(a,b){return a.indexOf(b)};e--;)if((c=b(this,a))>=0)for(d in a[e])a[e].hasOwnProperty(d)&&(this[c][d]=a[e][d])},Array.prototype.mean=function(){for(var a=this.length,b=0;a--;)b+=~~this[a];return b/this.length},Array.prototype.toString=function(){return"["+this.join(",")+"]"},Array.prototype.toEnum=function(){return this.reduce(function(a,b,c){return a[b.toUpperCase()]=c,a},{})},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.toObject=function(a){if(this.length!==a.length||"string"!=typeof a)throw new Error("Array and keys dont't have the same length!");return Array.prototype.reduce.call(this,function(b,c,d){return b[a.charAt(d)]=c,b},{})},Array.prototype.pushDistinct=function(a){-1===this.indexOf(a)&&this.push(a)},Array.prototype.spliceIfExists=function(a){-1!==this.indexOf(a)&&this.splice(this.indexOf(a),1)},Array.prototype.sortByProperty=function(a,b){return this.sort(function(b,c){return b[a]<c[a]?-1:b[a]===c[a]?0:1}),b&&this.reverse(),this},Array.prototype.reshape=function(a){for(var b,c=[];this.length;)c.push(this.splice(0,a));for(;b=c.pop();)this.unshift(b);return this},define("plugins/array",function(){}),Function.prototype.inherits=function(a){if(!a)throw new TypeError;return this.prototype=new a,this.prototype.constructor=this,this.__super__=a.prototype,this},Function.prototype.extendPrototypeWith=function(a){var b;for(b in a){if(this.prototype.hasOwnProperty(b))throw new Error("nay!");this.prototype[b]=a[b]}return this},Function.prototype.bind||(Function.prototype.bind=function(){var a=this,b=arguments[0],c=Array.prototype.slice.call(arguments,1);return function(){return a.apply(b,c)}}),define("plugins/function",function(){}),Number.prototype.bound=function(a,b){var c;return a>b&&(c=a,a=b,b=c),Math.min(Math.max(this,a),b)},Number.prototype.between=function(a,b){if(void 0===a||void 0===b||isNaN(a)||isNaN(b))throw new TypeError("Invalid Arguments: "+a+", "+b);return b>a?this>=a&&b>=this:this>=b&&a>=this},Number.prototype.isInt=function(){return this.valueOf()===(0|this.valueOf())},Number.prototype.toHex=function(){return"0x"+this.toString(16)},Number.prototype.toBinary=function(a){if(0>this)throw new Error("not implemented on negative values");for(var b="",c=this,d=Math.max(Math.floor(Math.log(this)/Math.log(2)+1),a||0),e=Math.pow(2,d),f=!!a;d--;)e/=2,c>=e?(f=!0,b+="1",c-=e):f&&(b+="0");return b},Number.prototype.toShortString=function(a){var b,c,d=this.toString(10),e=0,f=["","k","M","G","T","P"],g=1e3;if(!a||d.length<=a)return d;for(b=this;b>=Math.pow(g,Math.round(a/3));)b/=g,e++;return b.toString(10).length>=a-(e?2:0)&&(c=Math.floor(b)),d=c.toString(10)+f[e],d+(c===b&&d.length>1?"":"+");

},Number.prototype.mod=function(a){return(this%a+a)%a},define("plugins/number",function(){}),String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.camelCase=function(){var a=this.replace(/(\_[a-z])/g,function(a){return a.toUpperCase().replace("_","")});return a.charAt(0).toUpperCase()+a.substr(1)},define("plugins/string",function(){}),Date.prototype.setFixHour=function(a){return this.setHours(a),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.addDays=function(a){return this.setDate(this.getDate()+a),this},define("plugins/date",function(){}),function(){function a(a,c,d){this.el=a,this.axis=c,this.track=new b(i("jssb-"+c+"-track",a),c),this.thumb=new b(i("jssb-"+c+"-thumb",this.track.el),c),this.prev=new b("x"==c?i("jssb-x-left",a):i("jssb-y-up",a),c),this.next=new b("x"==c?i("jssb-x-right",a):i("jssb-y-down",a),c),this.minThumb="undefined"==typeof d?this.thumb.relevantDim():d}function b(a,b){this.el=a,this.axis=b}function c(a,b){var c,d={};if(void 0!=typeof a&&null!=a)for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d}function d(a){if(!a)return!1;if(l(a,"jssb-applied"))return!1;var b,c,d=i("outer-scroll-wrap",a)||i("box-paper",a);return d?(j(a,"jssb-applied"),b=d.currentStyle?d.currentStyle.overflow:document.defaultView.getComputedStyle(d,null).getPropertyValue("overflow"),c=a.currentStyle?a.currentStyle.position:document.defaultView.getComputedStyle(a,null).getPropertyValue("position"),k(a,"jssb-applied"),"hidden"==b?("static"==c&&(a.style.position="relative"),!0):!1):!1}function e(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function f(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)}function g(a){return a||(a=window.event),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.cancel=!0,a.returnValue=!1,!1}function h(a){return a=a?a:window.event,"undefined"==typeof a.target&&(a.target=a.srcElement),"undefined"==typeof a.pageX&&(a.pageX=a.clientX+document.body.scrollLeft),"undefined"==typeof a.pageY&&(a.pageY=a.clientY+document.body.scrollTop),a}function i(a,b){if("undefined"!=typeof b){var c,d,e=b.getElementsByTagName("*",b);for(c=0,d=e.length;d>c;c++)if(e[c].className&&l(e[c],a))return e[c];return null}return document.getElementById(a)}function j(a,b){l(a,b)||(0==a.className.length?a.className=b:a.className+=" "+b)}function k(a,b){var c,d=a.className.split(" ");for(c=0;c<d.length;c++)"string"==typeof b?d[c]==b&&(d[c]=""):d[c].match(b)&&(d[c]="");a.className=d.join(" ")}function l(a,b,c){if("undefined"==typeof c){var d,e=a.className.split(" ");for(d=0;d<e.length;d++)if(e[d]==b)return!0}else if(a.className.indexOf(b)>-1)return!0;return!1}function m(a){var b=0;if(a.offsetParent)for(;a.offsetParent;)b+=a.offsetTop,a=a.offsetParent;return b}function n(a){var b=0;if(a.offsetParent)for(;a.offsetParent;)b+=a.offsetLeft,a=a.offsetParent;return b}function o(a,b){var c=window.jsScrollbar._closures.objs,d=window.jsScrollbar._closures.fns,e=b.__objId,f=a.__fnId;return e||(c[e=b.__objId=c.length]=b),f||(d[f=a.__fnId=d.length]=a),b.__closures||(b.__closures=[]),b.__closures[f]?b.__closures[f]:(b=a=c=d=null,window.jsScrollbar._closures.objs[e].__closures[f]=function(){return window.jsScrollbar._closures.fns[f].apply(window.jsScrollbar._closures.objs[e],arguments)})}this.jsScrollbar=function(a,b){var c,e,f=[];if("undefined"==typeof b&&(b=null),"string"==typeof a)for(e=a.replace(/\s/g,"").replace(/,$/,"").replace(/#/g,"").split(","),c=0;c<e.length;c++)d(i(e[c]))&&f.push(new jsScrollbar.init(i(e[c]),b));else if(a.nodeType&&1==a.nodeType)d(a)&&f.push(new jsScrollbar.init(a,b));else if(a.length&&a.length>0)for(c=0;c<a.length;c++)d(a[c])&&f.push(new jsScrollbar.init(a[c],b));return 0===f.length?null:1==f.length?f[0]:f},jsScrollbar.scrollbars=[],jsScrollbar.defaults={scrollSpeed:30,scrollDistance:10,wheelDistance:40,tweenFn:function(a){return-Math.pow(a-1,4)+1},tweenDuration:500,disableTweening:!1,horizontalScrolling:!1,verticalScrolling:!0,fixedThumb:!1,template:'<div class="jssb"><div class="jssb-track"><div class="jssb-thumb"><div class="scrollbar-top"></div><div class="scrollbar-middle"></div><div class="scrollbar-bottom"></div></div></div></div>'},this.jsScrollbar._closures={objs:[],fns:[]},e(window,"unload",function(){this.jsScrollbar._closures.objs=null,this.jsScrollbar._closures.fns=null,this.jsScrollbar._closures=null,this.jsScrollbar.scrollbars=null}),jsScrollbar.init=function(){jsScrollbar.scrollbars.push(this),this.parent=arguments[0],this._prefs=c(jsScrollbar.defaults,arguments[1]),this._init()},jsScrollbar.init.prototype={_enabled:!0,_doScrollX:!1,_doScrollY:!1,_isAnimating:!1,_hasFocus:!1,_temp:null,_scrollX:null,_scrollY:null,_prefs:null,content:null,parent:null,_init:function(){var b,c=this.parent,d=this.content,f=this._prefs,g=!1,h=!1;this._temp||(this._temp={}),j(c,"jssb-applied"),b=document.createElement("div"),!f.horizontalScrolling||i("jssb-x",c)||this._scrollX&&this._scrollX.el||(b.innerHTML+=f.template.replace(/jssb/g,"jssb-x").replace(/-up/g,"-left").replace(/-down/g,"-right"),this.parent.appendChild(b)),!f.verticalScrolling||i("jssb-y",c)||this._scrollY&&this._scrollY.el||(b.innerHTML+=f.template.replace(/jssb/g,"jssb-y"),this.parent.appendChild(b)),(!d||d&&!d.parentNode)&&(d=this.content=i("outer-scroll-wrap",c)||i("box-paper",c)),this._doScrollX=f.horizontalScrolling&&d.scrollWidth>d.clientWidth?!0:!1,this._doScrollY=f.verticalScrolling&&d.scrollHeight>d.clientHeight?!0:!1,this._doScrollX?(j(c,"jssb-scrollx"),f.verticalScrolling&&d.scrollHeight>d.clientHeight&&(this._doScrollY=!0)):k(c,"jssb-scrollx"),this._doScrollY?(j(c,"jssb-scrolly"),!this._doScrollX&&f.horizontalScrolling&&d.scrollWidth>d.clientWidth&&(this._doScrollX=!0,j(c,"jssb-scrollx"))):k(c,"jssb-scrolly"),f.horizontalScrolling&&(null===this._scrollX&&(this._scrollX=new a(i("jssb-x",c),"x")),this._prepComponent(this._scrollX,this._doScrollX)),f.verticalScrolling&&(null===this._scrollY&&(this._scrollY=new a(i("jssb-y",c),"y")),this._prepComponent(this._scrollY,this._doScrollY)),e(c,"mousewheel",o(this._mouseWheel,this)),e(c,"DOMMouseScroll",o(this._mouseWheel,this)),e(c,"mousedown",o(this._focus,this)),e(document,"mousedown",o(this._blur,this)),e(d,"mousedown",o(this._selectStart,this)),e(d,"scroll",o(this._keepUp,this)),e(c,"mousedown",function(){h=!0}),e(c,"mouseup",function(){h=!1}),c.onmouseover=function(){g===!1&&(j(i("jssb-y",c),"scrollbar-visible"),g=!0,setTimeout(function(){h===!1&&k(i("jssb-y",c),"scrollbar-visible"),g=!1},1500))},i("jssb-y-thumb",c).onmouseover=function(){j(i("jssb-y",c),"scrollbar-visible")}},_prepComponent:function(b,c){if(b.el&&!b.el.parentNode&&(f(b.el,"mousedown",o(this._mouseDown,this)),b=new a(i("jssb-"+b.axis,this.parent),b.axis,b.minThumb)),c){var d=this.content,g=b.track.relevantDim(),h=b.thumb.relevantDim(),j="x"==b.axis?d.clientWidth:d.clientHeight,k="x"==b.axis?d.scrollWidth:d.scrollHeight;this._prefs.fixedThumb||(h=b.thumb.relevantDim(Math.round(g*j/k>=b.minThumb?g*j/k:b.minThumb))),b.ratio=(k-j)/(g-h),f(b.el,"mousedown",o(this._mouseDown,this)),e(b.el,"mousedown",o(this._mouseDown,this))}},_mouseDown:function(a){a=h(a);var b,c,d=this._prefs,i=this.content,k=this._temp,p=l(a.target,"jssb-x",!0)?"x":"y",q="x"==p?this._scrollX:this._scrollY;l(a.target,"scrollbar-middle",!0)?(j(q.thumb.el," jssb-"+p+"-thumb-click"),k.clicked=q.thumb.el,k.trackPos="x"==p?n(q.track.el):m(q.track.el),k.grabPoint="x"==p?a.pageX-n(q.thumb.el):a.pageY-m(q.thumb.el),k.axis=p,f(this.content,"scroll",o(this._keepUp,this)),e(document,"mousemove",o(this._drag,this))):l(a.target,"jssb-"+p+"-track",!0)?(j(q.track.el," jssb-"+p+"-track-click"),k.clicked=q.track.el,b="x"==p?n(q.track.el):m(q.track.el),d.disableTweening?(k.newPos=(a["page"+p.toUpperCase()]-b)*q.ratio,"x"==p?this._startScroll(k.newPos<i.scrollLeft?-i.clientWidth:i.clientWidth,0):this._startScroll(0,k.newPos<i.scrollTop?-i.clientHeight:i.clientHeight)):(c=(a["page"+p.toUpperCase()]-b-q.thumb.relevantDim()/2)*q.ratio,"x"==p?this.tweenTo(c,null):this.tweenTo(null,c))):l(a.target,"jssb-y-up",!0)?(j(q.prev.el,"jssb-y-up-click"),k.clicked=q.prev.el,this._startScroll(0,-d.scrollDistance)):l(a.target,"jssb-y-down",!0)?(j(q.next.el,"jssb-y-down-click"),k.clicked=q.next.el,this._startScroll(0,d.scrollDistance)):l(a.target,"jssb-x-left",!0)?(j(q.prev.el,"jssb-x-left-click"),k.clicked=q.prev.el,this._startScroll(-d.scrollDistance,0)):l(a.target,"jssb-x-right",!0)&&(j(q.next.el,"jssb-x-right-click"),k.clicked=q.next.el,this._startScroll(d.scrollDistance,0)),e(document,"mouseup",o(this._mouseUp,this)),e(document,"selectstart",g),a.preventDefault&&a.preventDefault()},_mouseUp:function(a){var b=this._temp;k(b.clicked,/jssb-[x|y]-[a-z]*-click/g),b.scrollTimer&&(window.clearInterval(b.scrollTimer),b.scrollTimer=null),"number"==typeof b.newPos&&(b.newPos=null),f(document,"mousemove",o(this._drag,this)),f(document,"mouseup",o(this._mouseUp,this)),f(document,"selectstart",g),e(this.content,"scroll",o(this._keepUp,this))},_drag:function(a){a=h(a);var b=this._temp,c=b.axis,d="x"==c?this._scrollX:this._scrollY,e=a["page"+c.toUpperCase()]-b.trackPos,f=e-b.grabPoint;"x"==c?this._scroll(f*d.ratio,null):this._scroll(null,f*d.ratio),this._keepUp()},_mouseWheel:function(a){a=a?a:event;var b=0,c=this.content;return"undefined"==typeof a.wheelDelta?(a.detail>0&&(b=1),a.detail<0&&(b=-1)):(a.wheelDelta>=120&&(b=-1),a.wheelDelta<=-120&&(b=1)),this._prefs.verticalScrolling===!1?this.scrollBy(b*this._prefs.wheelDistance,null):this.scrollBy(null,b*this._prefs.wheelDistance),c.scrollTop>0&&c.scrollTop<c.scrollHeight-c.clientHeight?g(a):void 0},_focus:function(a){a=h(a),this._focusFlag=!0,this._hasFocus||(this._hasFocus=!0,j(this.parent,"jssb-focus"),e(document,"keydown",o(this._keyDown,this)))},focus:function(){var a,b=window.jsScrollbar._closures.objs;for(a=0;a<b.length;a++)b[a].__objId!==this.__objId&&b[a]._blur();this._focus({})},_blur:function(){!this._focusFlag&&this._hasFocus&&(this._hasFocus=!1,k(this.parent,"jssb-focus"),f(document,"keydown",o(this._keyDown,this))),this._focusFlag=!1},_keyDown:function(a){a=h(a);var b=this.content,c=this._prefs,d=a.target.tagName.toLowerCase(),e=c.disableTweening?this.scrollTo:this.tweenTo,f=c.disableTweening?this.scrollBy:this.tweenBy;if("input"!=d&&"select"!=d&&"textarea"!=d&&!a.target.hasAttribute("contentEditable")){switch(a.keyCode){case 33:f.call(this,0,-b.clientHeight);break;case 32:case 34:f.call(this,0,b.clientHeight);break;case 35:e.call(this,b.scrollLeft,b.scrollHeight);break;case 36:e.call(this,b.scrollLeft,0);break;case 37:this.scrollBy(-c.scrollDistance,0);break;case 38:this.scrollBy(0,-c.scrollDistance);break;case 39:this.scrollBy(c.scrollDistance,0);break;case 40:this.scrollBy(0,c.scrollDistance)}return a.keyCode>=32&&a.keyCode<=40?g(a):!0}},_keepUp:function(){var a=this._scrollX,b=this._scrollY;this._doScrollX&&a.thumb.x(Math.round(this.content.scrollLeft/a.ratio)),this._doScrollY&&b.thumb.y(Math.round(this.content.scrollTop/b.ratio))},_scroll:function(a,b){null!==a&&"undefined"!=typeof a&&(this.content.scrollLeft=a),null!==b&&"undefined"!=typeof b&&(this.content.scrollTop=b)},_startScroll:function(a,b){this.scrollBy(a,b),this._temp.scrollByX=a,this._temp.scrollByY=b,this._temp.scrollTimer=setTimeout(o(this._startScrollDelay,this),300)},_startScrollDelay:function(){this._temp.scrollTimer=setInterval(o(this._startScrollInterval,this),this._prefs.scrollSpeed)},_startScrollInterval:function(){var a=this.content,b=this._temp,c=b.scrollByX,d=b.scrollByY;return"number"==typeof b.newPos&&(c&&b.newPos>=a.scrollLeft&&b.newPos<=a.scrollLeft+a.clientWidth||d&&b.newPos>=a.scrollTop&&b.newPos<=a.scrollTop+a.clientHeight)?(clearTimeout(b.scrollTimer),b.scrollByX=0,void(b.scrollByY=0)):void this.scrollBy(c,d)},_selectStart:function(){this._temp.coTop=m(this.content),this._temp.coLeft=n(this.content),e(document,"mousemove",o(this._select,this)),e(document,"mouseup",o(this._selectStop,this))},_select:function(a){a=h(a);var b=this.content,c=this._temp,d=this._prefs,e=0,f=0;d.horizontalScrolling&&(a.pageX<c.coLeft?e=-d.scrollDistance:a.pageX>c.coLeft&&a.pageX<c.coLeft+b.clientWidth?e=0:a.pageX>c.coLeft+b.clientWidth&&(e=d.scrollDistance)),d.verticalScrolling&&(a.pageY<c.coTop?f=-d.scrollDistance:a.pageY>c.coTop&&a.pageY<c.coTop+b.clientHeight?f=0:a.pageY>c.coTop+b.clientHeight&&(f=d.scrollDistance)),c.isScrolling||0===e&&0===f?c.isScrolling&&0===e&&0===f?(clearInterval(c.scrollTimer),c.isScrolling=!1):(c.scrollByX=e,c.scrollByY=f):(this._startScroll(e,f),c.isScrolling=!0)},_selectStop:function(a){clearInterval(this._temp.scrollTimer),f(document,"mousemove",o(this._select,this)),f(document,"mouseup",o(this._selectStop,this))},scrollTo:function(a,b){"undefined"==typeof b?this._prefs.horizontalScrolling===!1?this._scroll(null,a):this._scroll(a,null):this._scroll(a,b)},scrollBy:function(a,b){"undefined"==typeof b?this._prefs.horizontalScrolling===!1?this._scroll(null,this.content.scrollTop+a):this._scroll(this.content.scrollLeft+a,null):this._scroll(this.content.scrollLeft+a,this.content.scrollTop+b)},tweenTo:function(a,b,c){var d,e,f,g,h=this.content,i=this._prefs,j=this._temp,k=h.scrollLeft,l=h.scrollTop,m=+new Date;this._isAnimating&&clearInterval(j.tweenTimer),"undefined"==typeof b?i.horizontalScrolling===!1?(d=null,e=a):(d=a,e=null):(d=a,e=b),null!==d&&d!=h.scrollLeft&&(0>d&&(d=0),d>h.scrollWidth-h.clientWidth&&(d=h.scrollWidth-h.clientWidth),f=d-k),null!==e&&e!=h.scrollTop&&(0>e&&(e=0),e>h.scrollHeight-h.clientHeight&&(e=h.scrollHeight-h.clientHeight),g=e-l),this._isAnimating=!0,j.tweenData={start:m,fin:m+i.tweenDuration,sx:k,sy:l,dx:f,dy:g,x:d,y:e},c&&setTimeout(function(){c()},j.tweenData.fin-j.tweenData.start),j.tweenTimer=setInterval(o(this._tweenToFn,this),10)},_tweenToFn:function(a){var b=this._temp.tweenData,c=this._prefs,d=+new Date,e=d>b.fin?1:(d-b.start)/c.tweenDuration;c.tweenFn&&(e=c.tweenFn(e)),this.scrollTo(null===b.x?null:b.sx+b.dx*e,null===b.y?null:b.sy+b.dy*e),d>b.fin&&(clearInterval(this._temp.tweenTimer),this._isAnimating=!1)},tweenBy:function(a,b){"undefined"==typeof b?this._prefs.horizontalScrolling===!1?this.tweenTo(null,this.content.scrollTop+a):this.tweenTo(this.content.scrollLeft+a,null):this.tweenTo(this.content.scrollLeft+a,this.content.scrollTop+b)},recalc:function(){if(this._enabled){var a=this.parent,b=this.content;return f(a,"mousewheel",o(this._mouseWheel,this)),f(a,"DOMMouseScroll",o(this._mouseWheel,this)),f(a,"mousedown",o(this._focus,this)),f(document,"mousedown",o(this._blur,this)),f(b,"mousedown",o(this._selectStart,this)),f(b,"scroll",o(this._keepUp,this)),this._init(),this._keepUp(),b.scrollWidth-b.clientWidth-b.scrollLeft<0&&this._scroll(b.scrollWidth-b.clientWidth,null),b.scrollHeight-b.clientHeight-b.scrollTop<0&&this._scroll(null,b.scrollHeight-b.clientHeight),this._doScrollY}},disable:function(){if(this._enabled){var a=this.content,b=this.parent;this._enabled=!1,this._blur(),k(b,"jssb-applied"),k(b,"jssb-scrolly"),k(b,"jssb-scrollx"),f(a,"mousedown",o(this._selectStart,this)),f(a,"scroll",o(this._keepUp,this)),f(b,"mousedown",o(this._focus,this)),f(document,"mousedown",o(this._blur,this))}},enable:function(){this._enabled||(this._enabled=!0,this.recalc())},prefs:function(a,b){return b||"object"==typeof a?("string"==typeof a?this._prefs[a]=b:"object"==typeof a&&(this._prefs=c(a,this._prefs)),!0):this._prefs[a]}},a.prototype={track:null,thumb:null,prev:null,next:null,minThumb:0,ratio:0},b.prototype={width:function(a){return"undefined"!=typeof a&&(this.el.style.width=a+"px"),this.el.style.width?parseFloat(this.el.style.width):this.el.offsetWidth},height:function(a){return"undefined"!=typeof a&&(this.el.style.height=a+"px"),this.el.style.height?Math.max(parseFloat(this.el.style.height),50):Math.max(this.el.offsetHeight,50)},x:function(a){return"undefined"!=typeof a&&(this.el.style.left=a+"px"),parseFloat(this.el.style.left)},y:function(a){return"undefined"!=typeof a&&(this.el.style.top=a+"px"),parseFloat(this.el.style.top-this.height())},relevantDim:function(a){return"x"==this.axis?this.width(a):this.height(a)},relevantPos:function(a){return"x"==this.axis?this.x(a):this.y(a)}}}(),define("jsScrollbar",function(){}),/**
 * @license AngularJS v1.3.15
 * (c) 2010-2014 Google, Inc. http://angularjs.org
 * License: MIT
 */
function(a,b,c){"use strict";function d(a,b){return b=b||Error,function(){var c,d,e=arguments[0],f="["+(a?a+":":"")+e+"] ",g=arguments[1],h=arguments;for(c=f+g.replace(/\{\d+\}/g,function(a){var b=+a.slice(1,-1);return b+2<h.length?ma(h[b+2]):a}),c=c+"\nhttp://errors.angularjs.org/1.3.15/"+(a?a+"/":"")+e,d=2;d<arguments.length;d++)c=c+(2==d?"?":"&")+"p"+(d-2)+"="+encodeURIComponent(ma(arguments[d]));return new b(c)}}function e(a){if(null==a||z(a))return!1;var b=a.length;return a.nodeType===sd&&b?!0:u(a)||ld(a)||0===b||"number"==typeof b&&b>0&&b-1 in a}function f(a,b,c){var d,g;if(a)if(x(a))for(d in a)"prototype"==d||"length"==d||"name"==d||a.hasOwnProperty&&!a.hasOwnProperty(d)||b.call(c,a[d],d,a);else if(ld(a)||e(a)){var h="object"!=typeof a;for(d=0,g=a.length;g>d;d++)(h||d in a)&&b.call(c,a[d],d,a)}else if(a.forEach&&a.forEach!==f)a.forEach(b,c,a);else for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}function g(a){return Object.keys(a).sort()}function h(a,b,c){for(var d=g(a),e=0;e<d.length;e++)b.call(c,a[d[e]],d[e]);return d}function i(a){return function(b,c){a(c,b)}}function j(){return++jd}function k(a,b){b?a.$$hashKey=b:delete a.$$hashKey}function l(a){for(var b=a.$$hashKey,c=1,d=arguments.length;d>c;c++){var e=arguments[c];if(e)for(var f=Object.keys(e),g=0,h=f.length;h>g;g++){var i=f[g];a[i]=e[i]}}return k(a,b),a}function m(a){return parseInt(a,10)}function n(a,b){return l(Object.create(a),b)}function o(){}function p(a){return a}function q(a){return function(){return a}}function r(a){return"undefined"==typeof a}function s(a){return"undefined"!=typeof a}function t(a){return null!==a&&"object"==typeof a}function u(a){return"string"==typeof a}function v(a){return"number"==typeof a}function w(a){return"[object Date]"===gd.call(a)}function x(a){return"function"==typeof a}function y(a){return"[object RegExp]"===gd.call(a)}function z(a){return a&&a.window===a}function A(a){return a&&a.$evalAsync&&a.$watch}function B(a){return"[object File]"===gd.call(a)}function C(a){return"[object FormData]"===gd.call(a)}function D(a){return"[object Blob]"===gd.call(a)}function E(a){return"boolean"==typeof a}function F(a){return a&&x(a.then)}function G(a){return!(!a||!(a.nodeName||a.prop&&a.attr&&a.find))}function H(a){var b,c={},d=a.split(",");for(b=0;b<d.length;b++)c[d[b]]=!0;return c}function I(a){return Wc(a.nodeName||a[0]&&a[0].nodeName)}function J(a,b){var c=a.indexOf(b);return c>=0&&a.splice(c,1),b}function K(a,b,c,d){if(z(a)||A(a))throw hd("cpws","Can't copy! Making copies of Window or Scope instances is not supported.");if(b){if(a===b)throw hd("cpi","Can't copy! Source and destination are identical.");if(c=c||[],d=d||[],t(a)){var e=c.indexOf(a);if(-1!==e)return d[e];c.push(a),d.push(b)}var g;if(ld(a)){b.length=0;for(var h=0;h<a.length;h++)g=K(a[h],null,c,d),t(a[h])&&(c.push(a[h]),d.push(g)),b.push(g)}else{var i=b.$$hashKey;ld(b)?b.length=0:f(b,function(a,c){delete b[c]});for(var j in a)a.hasOwnProperty(j)&&(g=K(a[j],null,c,d),t(a[j])&&(c.push(a[j]),d.push(g)),b[j]=g);k(b,i)}}else if(b=a,a)if(ld(a))b=K(a,[],c,d);else if(w(a))b=new Date(a.getTime());else if(y(a))b=new RegExp(a.source,a.toString().match(/[^\/]*$/)[0]),b.lastIndex=a.lastIndex;else if(t(a)){var l=Object.create(Object.getPrototypeOf(a));b=K(a,l,c,d)}return b}function L(a,b){if(ld(a)){b=b||[];for(var c=0,d=a.length;d>c;c++)b[c]=a[c]}else if(t(a)){b=b||{};for(var e in a)("$"!==e.charAt(0)||"$"!==e.charAt(1))&&(b[e]=a[e])}return b||a}function M(a,b){if(a===b)return!0;if(null===a||null===b)return!1;if(a!==a&&b!==b)return!0;var d,e,f,g=typeof a,h=typeof b;if(g==h&&"object"==g){if(!ld(a)){if(w(a))return w(b)?M(a.getTime(),b.getTime()):!1;if(y(a))return y(b)?a.toString()==b.toString():!1;if(A(a)||A(b)||z(a)||z(b)||ld(b)||w(b)||y(b))return!1;f={};for(e in a)if("$"!==e.charAt(0)&&!x(a[e])){if(!M(a[e],b[e]))return!1;f[e]=!0}for(e in b)if(!f.hasOwnProperty(e)&&"$"!==e.charAt(0)&&b[e]!==c&&!x(b[e]))return!1;return!0}if(!ld(b))return!1;if((d=a.length)==b.length){for(e=0;d>e;e++)if(!M(a[e],b[e]))return!1;return!0}}return!1}function N(a,b,c){return a.concat(dd.call(b,c))}function O(a,b){return dd.call(a,b||0)}function P(a,b){var c=arguments.length>2?O(arguments,2):[];return!x(b)||b instanceof RegExp?b:c.length?function(){return arguments.length?b.apply(a,N(c,arguments,0)):b.apply(a,c)}:function(){return arguments.length?b.apply(a,arguments):b.call(a)}}function Q(a,d){var e=d;return"string"==typeof a&&"$"===a.charAt(0)&&"$"===a.charAt(1)?e=c:z(d)?e="$WINDOW":d&&b===d?e="$DOCUMENT":A(d)&&(e="$SCOPE"),e}function R(a,b){return"undefined"==typeof a?c:(v(b)||(b=b?2:null),JSON.stringify(a,Q,b))}function S(a){return u(a)?JSON.parse(a):a}function T(a){a=ad(a).clone();try{a.empty()}catch(b){}var c=ad("<div>").append(a).html();try{return a[0].nodeType===td?Wc(c):c.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(a,b){return"<"+Wc(b)})}catch(b){return Wc(c)}}function U(a){try{return decodeURIComponent(a)}catch(b){}}function V(a){var b,c,d={};return f((a||"").split("&"),function(a){if(a&&(b=a.replace(/\+/g,"%20").split("="),c=U(b[0]),s(c))){var e=s(b[1])?U(b[1]):!0;Xc.call(d,c)?ld(d[c])?d[c].push(e):d[c]=[d[c],e]:d[c]=e}}),d}function W(a){var b=[];return f(a,function(a,c){ld(a)?f(a,function(a){b.push(Y(c,!0)+(a===!0?"":"="+Y(a,!0)))}):b.push(Y(c,!0)+(a===!0?"":"="+Y(a,!0)))}),b.length?b.join("&"):""}function X(a){return Y(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function Y(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,b?"%20":"+")}function Z(a,b){var c,d,e=pd.length;for(a=ad(a),d=0;e>d;++d)if(c=pd[d]+b,u(c=a.attr(c)))return c;return null}function $(a,b){var c,d,e={};f(pd,function(b){var e=b+"app";!c&&a.hasAttribute&&a.hasAttribute(e)&&(c=a,d=a.getAttribute(e))}),f(pd,function(b){var e,f=b+"app";!c&&(e=a.querySelector("["+f.replace(":","\\:")+"]"))&&(c=e,d=e.getAttribute(f))}),c&&(e.strictDi=null!==Z(c,"strict-di"),b(c,d?[d]:[],e))}function _(c,d,e){t(e)||(e={});var g={strictDi:!1};e=l(g,e);var h=function(){if(c=ad(c),c.injector()){var a=c[0]===b?"document":T(c);throw hd("btstrpd","App Already Bootstrapped with this Element '{0}'",a.replace(/</,"&lt;").replace(/>/,"&gt;"))}d=d||[],d.unshift(["$provide",function(a){a.value("$rootElement",c)}]),e.debugInfoEnabled&&d.push(["$compileProvider",function(a){a.debugInfoEnabled(!0)}]),d.unshift("ng");var f=Sa(d,e.strictDi);return f.invoke(["$rootScope","$rootElement","$compile","$injector",function(a,b,c,d){a.$apply(function(){b.data("$injector",d),c(b)(a)})}]),f},i=/^NG_ENABLE_DEBUG_INFO!/,j=/^NG_DEFER_BOOTSTRAP!/;return a&&i.test(a.name)&&(e.debugInfoEnabled=!0,a.name=a.name.replace(i,"")),a&&!j.test(a.name)?h():(a.name=a.name.replace(j,""),id.resumeBootstrap=function(a){return f(a,function(a){d.push(a)}),h()},void(x(id.resumeDeferredBootstrap)&&id.resumeDeferredBootstrap()))}function aa(){a.name="NG_ENABLE_DEBUG_INFO!"+a.name,a.location.reload()}function ba(a){var b=id.element(a).injector();if(!b)throw hd("test","no injector found for element argument to getTestability");return b.get("$$testability")}function ca(a,b){return b=b||"_",a.replace(qd,function(a,c){return(c?b:"")+a.toLowerCase()})}function da(){var b;rd||(bd=a.jQuery,bd&&bd.fn.on?(ad=bd,l(bd.fn,{scope:Ld.scope,isolateScope:Ld.isolateScope,controller:Ld.controller,injector:Ld.injector,inheritedData:Ld.inheritedData}),b=bd.cleanData,bd.cleanData=function(a){var c;if(kd)kd=!1;else for(var d,e=0;null!=(d=a[e]);e++)c=bd._data(d,"events"),c&&c.$destroy&&bd(d).triggerHandler("$destroy");b(a)}):ad=ua,id.element=ad,rd=!0)}function ea(a,b,c){if(!a)throw hd("areq","Argument '{0}' is {1}",b||"?",c||"required");return a}function fa(a,b,c){return c&&ld(a)&&(a=a[a.length-1]),ea(x(a),b,"not a function, got "+(a&&"object"==typeof a?a.constructor.name||"Object":typeof a)),a}function ga(a,b){if("hasOwnProperty"===a)throw hd("badname","hasOwnProperty is not a valid {0} name",b)}function ha(a,b,c){if(!b)return a;for(var d,e=b.split("."),f=a,g=e.length,h=0;g>h;h++)d=e[h],a&&(a=(f=a)[d]);return!c&&x(a)?P(f,a):a}function ia(a){var b=a[0],c=a[a.length-1],d=[b];do{if(b=b.nextSibling,!b)break;d.push(b)}while(b!==c);return ad(d)}function ja(){return Object.create(null)}function ka(a){function b(a,b,c){return a[b]||(a[b]=c())}var c=d("$injector"),e=d("ng"),f=b(a,"angular",Object);return f.$$minErr=f.$$minErr||d,b(f,"module",function(){var a={};return function(d,f,g){var h=function(a,b){if("hasOwnProperty"===a)throw e("badname","hasOwnProperty is not a valid {0} name",b)};return h(d,"module"),f&&a.hasOwnProperty(d)&&(a[d]=null),b(a,d,function(){function a(a,c,d,e){return e||(e=b),function(){return e[d||"push"]([a,c,arguments]),j}}if(!f)throw c("nomod","Module '{0}' is not available! You either misspelled the module name or forgot to load it. If registering a module ensure that you specify the dependencies as the second argument.",d);var b=[],e=[],h=[],i=a("$injector","invoke","push",e),j={_invokeQueue:b,_configBlocks:e,_runBlocks:h,requires:f,name:d,provider:a("$provide","provider"),factory:a("$provide","factory"),service:a("$provide","service"),value:a("$provide","value"),constant:a("$provide","constant","unshift"),animation:a("$animateProvider","register"),filter:a("$filterProvider","register"),controller:a("$controllerProvider","register"),directive:a("$compileProvider","directive"),config:i,run:function(a){return h.push(a),this}};return g&&i(g),j})}})}function la(a){var b=[];return JSON.stringify(a,function(a,c){if(c=Q(a,c),t(c)){if(b.indexOf(c)>=0)return"<<already seen>>";b.push(c)}return c})}function ma(a){return"function"==typeof a?a.toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof a?"undefined":"string"!=typeof a?la(a):a}function na(b){l(b,{bootstrap:_,copy:K,extend:l,equals:M,element:ad,forEach:f,injector:Sa,noop:o,bind:P,toJson:R,fromJson:S,identity:p,isUndefined:r,isDefined:s,isString:u,isFunction:x,isObject:t,isNumber:v,isElement:G,isArray:ld,version:xd,isDate:w,lowercase:Wc,uppercase:Yc,callbacks:{counter:0},getTestability:ba,$$minErr:d,$$csp:od,reloadWithDebugInfo:aa}),cd=ka(a);try{cd("ngLocale")}catch(c){cd("ngLocale",[]).provider("$locale",qb)}cd("ng",["ngLocale"],["$provide",function(a){a.provider({$$sanitizeUri:Wb}),a.provider("$compile",Za).directive({a:De,input:Ue,textarea:Ue,form:Ie,script:Kf,select:Nf,style:Pf,option:Of,ngBind:Xe,ngBindHtml:Ze,ngBindTemplate:Ye,ngClass:_e,ngClassEven:bf,ngClassOdd:af,ngCloak:cf,ngController:df,ngForm:Je,ngHide:Ef,ngIf:gf,ngInclude:hf,ngInit:kf,ngNonBindable:yf,ngPluralize:zf,ngRepeat:Af,ngShow:Df,ngStyle:Ff,ngSwitch:Gf,ngSwitchWhen:Hf,ngSwitchDefault:If,ngOptions:Mf,ngTransclude:Jf,ngModel:vf,ngList:lf,ngChange:$e,pattern:Rf,ngPattern:Rf,required:Qf,ngRequired:Qf,minlength:Tf,ngMinlength:Tf,maxlength:Sf,ngMaxlength:Sf,ngValue:We,ngModelOptions:xf}).directive({ngInclude:jf}).directive(Ee).directive(ef),a.provider({$anchorScroll:Ta,$animate:Vd,$browser:Wa,$cacheFactory:Xa,$controller:bb,$document:cb,$exceptionHandler:db,$filter:gc,$interpolate:ob,$interval:pb,$http:kb,$httpBackend:mb,$location:Eb,$log:Fb,$parse:Qb,$rootScope:Vb,$q:Rb,$$q:Sb,$sce:$b,$sceDelegate:Zb,$sniffer:_b,$templateCache:Ya,$templateRequest:ac,$$testability:bc,$timeout:cc,$window:fc,$$rAF:Ub,$$asyncCallback:Ua,$$jqLite:Na})}])}function oa(){return++zd}function pa(a){return a.replace(Cd,function(a,b,c,d){return d?c.toUpperCase():c}).replace(Dd,"Moz$1")}function qa(a){return!Hd.test(a)}function ra(a){var b=a.nodeType;return b===sd||!b||b===vd}function sa(a,b){var c,d,e,g,h=b.createDocumentFragment(),i=[];if(qa(a))i.push(b.createTextNode(a));else{for(c=c||h.appendChild(b.createElement("div")),d=(Id.exec(a)||["",""])[1].toLowerCase(),e=Kd[d]||Kd._default,c.innerHTML=e[1]+a.replace(Jd,"<$1></$2>")+e[2],g=e[0];g--;)c=c.lastChild;i=N(i,c.childNodes),c=h.firstChild,c.textContent=""}return h.textContent="",h.innerHTML="",f(i,function(a){h.appendChild(a)}),h}function ta(a,c){c=c||b;var d;return(d=Gd.exec(a))?[c.createElement(d[1])]:(d=sa(a,c))?d.childNodes:[]}function ua(a){if(a instanceof ua)return a;var b;if(u(a)&&(a=md(a),b=!0),!(this instanceof ua)){if(b&&"<"!=a.charAt(0))throw Fd("nosel","Looking up elements via selectors is not supported by jqLite! See: http://docs.angularjs.org/api/angular.element");return new ua(a)}b?Ea(this,ta(a)):Ea(this,a)}function va(a){return a.cloneNode(!0)}function wa(a,b){if(b||ya(a),a.querySelectorAll)for(var c=a.querySelectorAll("*"),d=0,e=c.length;e>d;d++)ya(c[d])}function xa(a,b,c,d){if(s(d))throw Fd("offargs","jqLite#off() does not support the `selector` argument");var e=za(a),g=e&&e.events,h=e&&e.handle;if(h)if(b)f(b.split(" "),function(b){if(s(c)){var d=g[b];if(J(d||[],c),d&&d.length>0)return}Bd(a,b,h),delete g[b]});else for(b in g)"$destroy"!==b&&Bd(a,b,h),delete g[b]}function ya(a,b){var d=a.ng339,e=d&&yd[d];if(e){if(b)return void delete e.data[b];e.handle&&(e.events.$destroy&&e.handle({},"$destroy"),xa(a)),delete yd[d],a.ng339=c}}function za(a,b){var d=a.ng339,e=d&&yd[d];return b&&!e&&(a.ng339=d=oa(),e=yd[d]={events:{},data:{},handle:c}),e}function Aa(a,b,c){if(ra(a)){var d=s(c),e=!d&&b&&!t(b),f=!b,g=za(a,!e),h=g&&g.data;if(d)h[b]=c;else{if(f)return h;if(e)return h&&h[b];l(h,b)}}}function Ba(a,b){return a.getAttribute?(" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+b+" ")>-1:!1}function Ca(a,b){b&&a.setAttribute&&f(b.split(" "),function(b){a.setAttribute("class",md((" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+md(b)+" "," ")))})}function Da(a,b){if(b&&a.setAttribute){var c=(" "+(a.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");f(b.split(" "),function(a){a=md(a),-1===c.indexOf(" "+a+" ")&&(c+=a+" ")}),a.setAttribute("class",md(c))}}function Ea(a,b){if(b)if(b.nodeType)a[a.length++]=b;else{var c=b.length;if("number"==typeof c&&b.window!==b){if(c)for(var d=0;c>d;d++)a[a.length++]=b[d]}else a[a.length++]=b}}function Fa(a,b){return Ga(a,"$"+(b||"ngController")+"Controller")}function Ga(a,b,d){a.nodeType==vd&&(a=a.documentElement);for(var e=ld(b)?b:[b];a;){for(var f=0,g=e.length;g>f;f++)if((d=ad.data(a,e[f]))!==c)return d;a=a.parentNode||a.nodeType===wd&&a.host}}function Ha(a){for(wa(a,!0);a.firstChild;)a.removeChild(a.firstChild)}function Ia(a,b){b||wa(a);var c=a.parentNode;c&&c.removeChild(a)}function Ja(b,c){c=c||a,"complete"===c.document.readyState?c.setTimeout(b):ad(c).on("load",b)}function Ka(a,b){var c=Md[b.toLowerCase()];return c&&Nd[I(a)]&&c}function La(a,b){var c=a.nodeName;return("INPUT"===c||"TEXTAREA"===c)&&Od[b]}function Ma(a,b){var c=function(c,d){c.isDefaultPrevented=function(){return c.defaultPrevented};var e=b[d||c.type],f=e?e.length:0;if(f){if(r(c.immediatePropagationStopped)){var g=c.stopImmediatePropagation;c.stopImmediatePropagation=function(){c.immediatePropagationStopped=!0,c.stopPropagation&&c.stopPropagation(),g&&g.call(c)}}c.isImmediatePropagationStopped=function(){return c.immediatePropagationStopped===!0},f>1&&(e=L(e));for(var h=0;f>h;h++)c.isImmediatePropagationStopped()||e[h].call(a,c)}};return c.elem=a,c}function Na(){this.$get=function(){return l(ua,{hasClass:function(a,b){return a.attr&&(a=a[0]),Ba(a,b)},addClass:function(a,b){return a.attr&&(a=a[0]),Da(a,b)},removeClass:function(a,b){return a.attr&&(a=a[0]),Ca(a,b)}})}}function Oa(a,b){var c=a&&a.$$hashKey;if(c)return"function"==typeof c&&(c=a.$$hashKey()),c;var d=typeof a;return c="function"==d||"object"==d&&null!==a?a.$$hashKey=d+":"+(b||j)():d+":"+a}function Pa(a,b){if(b){var c=0;this.nextUid=function(){return++c}}f(a,this.put,this)}function Qa(a){var b=a.toString().replace(Sd,""),c=b.match(Pd);return c?"function("+(c[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}function Ra(a,b,c){var d,e,g,h;if("function"==typeof a){if(!(d=a.$inject)){if(d=[],a.length){if(b)throw u(c)&&c||(c=a.name||Qa(a)),Td("strictdi","{0} is not using explicit annotation and cannot be invoked in strict mode",c);e=a.toString().replace(Sd,""),g=e.match(Pd),f(g[1].split(Qd),function(a){a.replace(Rd,function(a,b,c){d.push(c)})})}a.$inject=d}}else ld(a)?(h=a.length-1,fa(a[h],"fn"),d=a.slice(0,h)):fa(a,"fn",!0);return d}function Sa(a,b){function d(a){return function(b,c){return t(b)?void f(b,i(a)):a(b,c)}}function e(a,b){if(ga(a,"service"),(x(b)||ld(b))&&(b=A.instantiate(b)),!b.$get)throw Td("pget","Provider '{0}' must define $get factory method.",a);return z[a+v]=b}function g(a,b){return function(){var c=C.invoke(b,this);if(r(c))throw Td("undef","Provider '{0}' must return a value from $get factory method.",a);return c}}function h(a,b,c){return e(a,{$get:c!==!1?g(a,b):b})}function j(a,b){return h(a,["$injector",function(a){return a.instantiate(b)}])}function k(a,b){return h(a,q(b),!1)}function l(a,b){ga(a,"constant"),z[a]=b,B[a]=b}function m(a,b){var c=A.get(a+v),d=c.$get;c.$get=function(){var a=C.invoke(d,c);return C.invoke(b,null,{$delegate:a})}}function n(a){var b,c=[];return f(a,function(a){function d(a){var b,c;for(b=0,c=a.length;c>b;b++){var d=a[b],e=A.get(d[0]);e[d[1]].apply(e,d[2])}}if(!y.get(a)){y.put(a,!0);try{u(a)?(b=cd(a),c=c.concat(n(b.requires)).concat(b._runBlocks),d(b._invokeQueue),d(b._configBlocks)):x(a)?c.push(A.invoke(a)):ld(a)?c.push(A.invoke(a)):fa(a,"module")}catch(e){throw ld(a)&&(a=a[a.length-1]),e.message&&e.stack&&-1==e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),Td("modulerr","Failed to instantiate module {0} due to:\n{1}",a,e.stack||e.message||e)}}}),c}function p(a,c){function d(b,d){if(a.hasOwnProperty(b)){if(a[b]===s)throw Td("cdep","Circular dependency found: {0}",b+" <- "+w.join(" <- "));return a[b]}try{return w.unshift(b),a[b]=s,a[b]=c(b,d)}catch(e){throw a[b]===s&&delete a[b],e}finally{w.shift()}}function e(a,c,e,f){"string"==typeof e&&(f=e,e=null);var g,h,i,j=[],k=Sa.$$annotate(a,b,f);for(h=0,g=k.length;g>h;h++){if(i=k[h],"string"!=typeof i)throw Td("itkn","Incorrect injection token! Expected service name as string, got {0}",i);j.push(e&&e.hasOwnProperty(i)?e[i]:d(i,f))}return ld(a)&&(a=a[g]),a.apply(c,j)}function f(a,b,c){var d=Object.create((ld(a)?a[a.length-1]:a).prototype||null),f=e(a,d,b,c);return t(f)||x(f)?f:d}return{invoke:e,instantiate:f,get:d,annotate:Sa.$$annotate,has:function(b){return z.hasOwnProperty(b+v)||a.hasOwnProperty(b)}}}b=b===!0;var s={},v="Provider",w=[],y=new Pa([],!0),z={$provide:{provider:d(e),factory:d(h),service:d(j),value:d(k),constant:d(l),decorator:m}},A=z.$injector=p(z,function(a,b){throw id.isString(b)&&w.push(b),Td("unpr","Unknown provider: {0}",w.join(" <- "))}),B={},C=B.$injector=p(B,function(a,b){var d=A.get(a+v,b);return C.invoke(d.$get,d,c,a)});return f(n(a),function(a){C.invoke(a||o)}),C}function Ta(){var a=!0;this.disableAutoScrolling=function(){a=!1},this.$get=["$window","$location","$rootScope",function(b,c,d){function e(a){var b=null;return Array.prototype.some.call(a,function(a){return"a"===I(a)?(b=a,!0):void 0}),b}function f(){var a=h.yOffset;if(x(a))a=a();else if(G(a)){var c=a[0],d=b.getComputedStyle(c);a="fixed"!==d.position?0:c.getBoundingClientRect().bottom}else v(a)||(a=0);return a}function g(a){if(a){a.scrollIntoView();var c=f();if(c){var d=a.getBoundingClientRect().top;b.scrollBy(0,d-c)}}else b.scrollTo(0,0)}function h(){var a,b=c.hash();b?(a=i.getElementById(b))?g(a):(a=e(i.getElementsByName(b)))?g(a):"top"===b&&g(null):g(null)}var i=b.document;return a&&d.$watch(function(){return c.hash()},function(a,b){(a!==b||""!==a)&&Ja(function(){d.$evalAsync(h)})}),h}]}function Ua(){this.$get=["$$rAF","$timeout",function(a,b){return a.supported?function(b){return a(b)}:function(a){return b(a,0,!1)}}]}function Va(a,b,d,e){function g(a){try{a.apply(null,O(arguments,1))}finally{if(y--,0===y)for(;z.length;)try{z.pop()()}catch(b){d.error(b)}}}function h(a){var b=a.indexOf("#");return-1===b?"":a.substr(b+1)}function i(a,b){!function c(){f(B,function(a){a()}),A=b(c,a)}()}function j(){l(),m()}function k(){try{return t.state}catch(a){}}function l(){C=k(),C=r(C)?null:C,M(C,J)&&(C=J),J=C}function m(){(E!==p.url()||D!==C)&&(E=p.url(),D=C,f(H,function(a){a(p.url(),C)}))}function n(a){try{return decodeURIComponent(a)}catch(b){return a}}var p=this,q=b[0],s=a.location,t=a.history,v=a.setTimeout,w=a.clearTimeout,x={};p.isMock=!1;var y=0,z=[];p.$$completeOutstandingRequest=g,p.$$incOutstandingRequestCount=function(){y++},p.notifyWhenNoOutstandingRequests=function(a){f(B,function(a){a()}),0===y?a():z.push(a)};var A,B=[];p.addPollFn=function(a){return r(A)&&i(100,v),B.push(a),a};var C,D,E=s.href,F=b.find("base"),G=null;l(),D=C,p.url=function(b,c,d){if(r(d)&&(d=null),s!==a.location&&(s=a.location),t!==a.history&&(t=a.history),b){var f=D===d;if(E===b&&(!e.history||f))return p;var g=E&&vb(E)===vb(b);return E=b,D=d,!e.history||g&&f?(g||(G=b),c?s.replace(b):g?s.hash=h(b):s.href=b):(t[c?"replaceState":"pushState"](d,"",b),l(),D=C),p}return G||s.href.replace(/%27/g,"'")},p.state=function(){return C};var H=[],I=!1,J=null;p.onUrlChange=function(b){return I||(e.history&&ad(a).on("popstate",j),ad(a).on("hashchange",j),I=!0),H.push(b),b},p.$$checkUrlChange=m,p.baseHref=function(){var a=F.attr("href");return a?a.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var K={},L="",N=p.baseHref();p.cookies=function(a,b){var e,f,g,h,i;if(!a){if(q.cookie!==L)for(L=q.cookie,f=L.split("; "),K={},h=0;h<f.length;h++)g=f[h],i=g.indexOf("="),i>0&&(a=n(g.substring(0,i)),K[a]===c&&(K[a]=n(g.substring(i+1))));return K}b===c?q.cookie=encodeURIComponent(a)+"=;path="+N+";expires=Thu, 01 Jan 1970 00:00:00 GMT":u(b)&&(e=(q.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+";path="+N).length+1,e>4096&&d.warn("Cookie '"+a+"' possibly not set or overflowed because it was too large ("+e+" > 4096 bytes)!"))},p.defer=function(a,b){var c;return y++,c=v(function(){delete x[c],g(a)},b||0),x[c]=!0,c},p.defer.cancel=function(a){return x[a]?(delete x[a],w(a),g(o),!0):!1}}function Wa(){this.$get=["$window","$log","$sniffer","$document",function(a,b,c,d){return new Va(a,d,b,c)}]}function Xa(){this.$get=function(){function a(a,c){function e(a){a!=m&&(n?n==a&&(n=a.n):n=a,f(a.n,a.p),f(a,m),m=a,m.n=null)}function f(a,b){a!=b&&(a&&(a.p=b),b&&(b.n=a))}if(a in b)throw d("$cacheFactory")("iid","CacheId '{0}' is already taken!",a);var g=0,h=l({},c,{id:a}),i={},j=c&&c.capacity||Number.MAX_VALUE,k={},m=null,n=null;return b[a]={put:function(a,b){if(j<Number.MAX_VALUE){var c=k[a]||(k[a]={key:a});e(c)}if(!r(b))return a in i||g++,i[a]=b,g>j&&this.remove(n.key),b},get:function(a){if(j<Number.MAX_VALUE){var b=k[a];if(!b)return;e(b)}return i[a]},remove:function(a){if(j<Number.MAX_VALUE){var b=k[a];if(!b)return;b==m&&(m=b.p),b==n&&(n=b.n),f(b.n,b.p),delete k[a]}delete i[a],g--},removeAll:function(){i={},g=0,k={},m=n=null},destroy:function(){i=null,h=null,k=null,delete b[a]},info:function(){return l({},h,{size:g})}}}var b={};return a.info=function(){var a={};return f(b,function(b,c){a[c]=b.info()}),a},a.get=function(a){return b[a]},a}}function Ya(){this.$get=["$cacheFactory",function(a){return a("templates")}]}function Za(a,d){function e(a,b){var c=/^\s*([@&]|=(\*?))(\??)\s*(\w*)\s*$/,d={};return f(a,function(a,e){var f=a.match(c);if(!f)throw Wd("iscp","Invalid isolate scope definition for directive '{0}'. Definition: {... {1}: '{2}' ...}",b,e,a);d[e]={mode:f[1][0],collection:"*"===f[2],optional:"?"===f[3],attrName:f[4]||e}}),d}var g={},h="Directive",j=/^\s*directive\:\s*([\w\-]+)\s+(.*)$/,k=/(([\w\-]+)(?:\:([^;]+))?;?)/,m=H("ngSrc,ngSrcset,src,srcset"),r=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,v=/^(on[a-z]+|formaction)$/;this.directive=function y(b,c){return ga(b,"directive"),u(b)?(ea(c,"directiveFactory"),g.hasOwnProperty(b)||(g[b]=[],a.factory(b+h,["$injector","$exceptionHandler",function(a,c){var d=[];return f(g[b],function(f,g){try{var h=a.invoke(f);x(h)?h={compile:q(h)}:!h.compile&&h.link&&(h.compile=q(h.link)),h.priority=h.priority||0,h.index=g,h.name=h.name||b,h.require=h.require||h.controller&&h.name,h.restrict=h.restrict||"EA",t(h.scope)&&(h.$$isolateBindings=e(h.scope,h.name)),d.push(h)}catch(i){c(i)}}),d}])),g[b].push(c)):f(b,i(y)),this},this.aHrefSanitizationWhitelist=function(a){return s(a)?(d.aHrefSanitizationWhitelist(a),this):d.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(a){return s(a)?(d.imgSrcSanitizationWhitelist(a),this):d.imgSrcSanitizationWhitelist()};var w=!0;this.debugInfoEnabled=function(a){return s(a)?(w=a,this):w},this.$get=["$injector","$interpolate","$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(a,d,e,i,q,s,y,z,B,C,D){function E(a,b){try{a.addClass(b)}catch(c){}}function F(a,b,c,d,e){a instanceof ad||(a=ad(a)),f(a,function(b,c){b.nodeType==td&&b.nodeValue.match(/\S+/)&&(a[c]=ad(b).wrap("<span></span>").parent()[0])});var g=H(a,b,a,c,d,e);F.$$addScopeClass(a);var h=null;return function(b,c,d){ea(b,"scope"),d=d||{};var e=d.parentBoundTranscludeFn,f=d.transcludeControllers,i=d.futureParentElement;e&&e.$$boundTransclude&&(e=e.$$boundTransclude),h||(h=G(i));var j;if(j="html"!==h?ad($(h,ad("<div>").append(a).html())):c?Ld.clone.call(a):a,f)for(var k in f)j.data("$"+k+"Controller",f[k].instance);return F.$$addScopeInfo(j,b),c&&c(j,b),g&&g(b,j,j,e),j}}function G(a){var b=a&&a[0];return b&&"foreignobject"!==I(b)&&b.toString().match(/SVG/)?"svg":"html"}function H(a,b,d,e,f,g){function h(a,d,e,f){var g,h,i,j,k,l,m,n,q;if(o){var r=d.length;for(q=new Array(r),k=0;k<p.length;k+=3)m=p[k],q[m]=d[m]}else q=d;for(k=0,l=p.length;l>k;)i=q[p[k++]],g=p[k++],h=p[k++],g?(g.scope?(j=a.$new(),F.$$addScopeInfo(ad(i),j)):j=a,n=g.transcludeOnThisElement?K(a,g.transclude,f,g.elementTranscludeOnThisElement):!g.templateOnThisElement&&f?f:!f&&b?K(a,b):null,g(h,j,i,e,n)):h&&h(a,i.childNodes,c,f)}for(var i,j,k,l,m,n,o,p=[],q=0;q<a.length;q++)i=new ga,j=L(a[q],[],i,0===q?e:c,f),k=j.length?Q(j,a[q],i,b,d,null,[],[],g):null,k&&k.scope&&F.$$addScopeClass(i.$$element),m=k&&k.terminal||!(l=a[q].childNodes)||!l.length?null:H(l,k?(k.transcludeOnThisElement||!k.templateOnThisElement)&&k.transclude:b),(k||m)&&(p.push(q,k,m),n=!0,o=o||k),g=null;return n?h:null}function K(a,b,c,d){var e=function(d,e,f,g,h){return d||(d=a.$new(!1,h),d.$$transcluded=!0),b(d,e,{parentBoundTranscludeFn:c,transcludeControllers:f,futureParentElement:g})};return e}function L(a,b,c,d,e){var f,g,h=a.nodeType,i=c.$attr;switch(h){case sd:S(b,$a(I(a)),"E",d,e);for(var l,m,n,o,p,q,r=a.attributes,s=0,v=r&&r.length;v>s;s++){var w=!1,x=!1;l=r[s],m=l.name,p=md(l.value),o=$a(m),(q=la.test(o))&&(m=m.replace(Xd,"").substr(8).replace(/_(.)/g,function(a,b){return b.toUpperCase()}));var y=o.replace(/(Start|End)$/,"");U(y)&&o===y+"Start"&&(w=m,x=m.substr(0,m.length-5)+"end",m=m.substr(0,m.length-6)),n=$a(m.toLowerCase()),i[n]=m,(q||!c.hasOwnProperty(n))&&(c[n]=p,Ka(a,n)&&(c[n]=!0)),aa(a,b,p,n,q),S(b,n,"A",d,e,w,x)}if(g=a.className,t(g)&&(g=g.animVal),u(g)&&""!==g)for(;f=k.exec(g);)n=$a(f[2]),S(b,n,"C",d,e)&&(c[n]=md(f[3])),g=g.substr(f.index+f[0].length);break;case td:Z(b,a.nodeValue);break;case ud:try{f=j.exec(a.nodeValue),f&&(n=$a(f[1]),S(b,n,"M",d,e)&&(c[n]=md(f[2])))}catch(z){}}return b.sort(X),b}function N(a,b,c){var d=[],e=0;if(b&&a.hasAttribute&&a.hasAttribute(b)){do{if(!a)throw Wd("uterdir","Unterminated attribute, found '{0}' but no matching '{1}' found.",b,c);a.nodeType==sd&&(a.hasAttribute(b)&&e++,a.hasAttribute(c)&&e--),d.push(a),a=a.nextSibling}while(e>0)}else d.push(a);return ad(d)}function P(a,b,c){return function(d,e,f,g,h){return e=N(e[0],b,c),a(d,e,f,g,h)}}function Q(a,g,h,i,j,k,l,m,n){function o(a,b,c,d){a&&(c&&(a=P(a,c,d)),a.require=z.require,a.directiveName=B,(I===z||z.$$isolateScope)&&(a=da(a,{isolateScope:!0})),l.push(a)),b&&(c&&(b=P(b,c,d)),b.require=z.require,b.directiveName=B,(I===z||z.$$isolateScope)&&(b=da(b,{isolateScope:!0})),m.push(b))}function p(a,b,c,d){var e,g,h="data",i=!1,j=c;if(u(b)){if(g=b.match(r),b=b.substring(g[0].length),g[3]&&(g[1]?g[3]=null:g[1]=g[3]),"^"===g[1]?h="inheritedData":"^^"===g[1]&&(h="inheritedData",j=c.parent()),"?"===g[2]&&(i=!0),e=null,d&&"data"===h&&(e=d[b])&&(e=e.instance),e=e||j[h]("$"+b+"Controller"),!e&&!i)throw Wd("ctreq","Controller '{0}', required by directive '{1}', can't be found!",b,a);return e||null}return ld(b)&&(e=[],f(b,function(b){e.push(p(a,b,c,d))})),e}function v(a,b,e,i,j){function k(a,b,d){var e;return A(a)||(d=b,b=a,a=c),U&&(e=v),d||(d=U?x.parent():x),j(a,b,e,d,D)}var n,o,r,t,u,v,w,x,z;if(g===e?(z=h,x=h.$$element):(x=ad(e),z=new ga(x,h)),I&&(u=b.$new(!0)),j&&(w=k,w.$$boundTransclude=j),H&&(y={},v={},f(H,function(a){var c,d={$scope:a===I||a.$$isolateScope?u:b,$element:x,$attrs:z,$transclude:w};t=a.controller,"@"==t&&(t=z[a.name]),c=s(t,d,!0,a.controllerAs),v[a.name]=c,U||x.data("$"+a.name+"Controller",c.instance),y[a.name]=c})),I){F.$$addScopeInfo(x,u,!0,!(J&&(J===I||J===I.$$originalDirective))),F.$$addScopeClass(x,!0);var B=y&&y[I.name],C=u;B&&B.identifier&&I.bindToController===!0&&(C=B.instance),f(u.$$isolateBindings=I.$$isolateBindings,function(a,c){var e,f,g,h,i=a.attrName,j=a.optional,k=a.mode;switch(k){case"@":z.$observe(i,function(a){C[c]=a}),z.$$observers[i].$$scope=b,z[i]&&(C[c]=d(z[i])(b));break;case"=":if(j&&!z[i])return;f=q(z[i]),h=f.literal?M:function(a,b){return a===b||a!==a&&b!==b},g=f.assign||function(){throw e=C[c]=f(b),Wd("nonassign","Expression '{0}' used with directive '{1}' is non-assignable!",z[i],I.name)},e=C[c]=f(b);var l=function(a){return h(a,C[c])||(h(a,e)?g(b,a=C[c]):C[c]=a),e=a};l.$stateful=!0;var m;m=a.collection?b.$watchCollection(z[i],l):b.$watch(q(z[i],l),null,f.literal),u.$on("$destroy",m);break;case"&":f=q(z[i]),C[c]=function(a){return f(b,a)}}})}for(y&&(f(y,function(a){a()}),y=null),n=0,o=l.length;o>n;n++)r=l[n],fa(r,r.isolateScope?u:b,x,z,r.require&&p(r.directiveName,r.require,x,v),w);var D=b;for(I&&(I.template||null===I.templateUrl)&&(D=u),a&&a(D,e.childNodes,c,j),n=m.length-1;n>=0;n--)r=m[n],fa(r,r.isolateScope?u:b,x,z,r.require&&p(r.directiveName,r.require,x,v),w)}n=n||{};for(var w,y,z,B,C,D,E,G=-Number.MAX_VALUE,H=n.controllerDirectives,I=n.newIsolateScopeDirective,J=n.templateDirective,K=n.nonTlbTranscludeDirective,Q=!1,S=!1,U=n.hasElementTranscludeDirective,X=h.$$element=ad(g),Z=k,_=i,aa=0,ca=a.length;ca>aa;aa++){z=a[aa];var ea=z.$$start,ha=z.$$end;if(ea&&(X=N(g,ea,ha)),C=c,G>z.priority)break;if((E=z.scope)&&(z.templateUrl||(t(E)?(Y("new/isolated scope",I||w,z,X),I=z):Y("new/isolated scope",I,z,X)),w=w||z),B=z.name,!z.templateUrl&&z.controller&&(E=z.controller,H=H||{},Y("'"+B+"' controller",H[B],z,X),H[B]=z),(E=z.transclude)&&(Q=!0,z.$$tlb||(Y("transclusion",K,z,X),K=z),"element"==E?(U=!0,G=z.priority,C=X,X=h.$$element=ad(b.createComment(" "+B+": "+h[B]+" ")),g=X[0],ba(j,O(C),g),_=F(C,i,G,Z&&Z.name,{nonTlbTranscludeDirective:K})):(C=ad(va(g)).contents(),X.empty(),_=F(C,i))),z.template)if(S=!0,Y("template",J,z,X),J=z,E=x(z.template)?z.template(X,h):z.template,E=ka(E),z.replace){if(Z=z,C=qa(E)?[]:ab($(z.templateNamespace,md(E))),g=C[0],1!=C.length||g.nodeType!==sd)throw Wd("tplrt","Template for directive '{0}' must have exactly one root element. {1}",B,"");ba(j,X,g);var ia={$attr:{}},ja=L(g,[],ia),la=a.splice(aa+1,a.length-(aa+1));I&&R(ja),a=a.concat(ja).concat(la),V(h,ia),ca=a.length}else X.html(E);if(z.templateUrl)S=!0,Y("template",J,z,X),J=z,z.replace&&(Z=z),v=W(a.splice(aa,a.length-aa),X,h,j,Q&&_,l,m,{controllerDirectives:H,newIsolateScopeDirective:I,templateDirective:J,nonTlbTranscludeDirective:K}),ca=a.length;else if(z.compile)try{D=z.compile(X,h,_),x(D)?o(null,D,ea,ha):D&&o(D.pre,D.post,ea,ha)}catch(ma){e(ma,T(X))}z.terminal&&(v.terminal=!0,G=Math.max(G,z.priority))}return v.scope=w&&w.scope===!0,v.transcludeOnThisElement=Q,v.elementTranscludeOnThisElement=U,v.templateOnThisElement=S,v.transclude=_,n.hasElementTranscludeDirective=U,v}function R(a){for(var b=0,c=a.length;c>b;b++)a[b]=n(a[b],{$$isolateScope:!0})}function S(b,d,f,i,j,k,l){if(d===j)return null;var m=null;if(g.hasOwnProperty(d))for(var o,p=a.get(d+h),q=0,r=p.length;r>q;q++)try{o=p[q],(i===c||i>o.priority)&&-1!=o.restrict.indexOf(f)&&(k&&(o=n(o,{
$$start:k,$$end:l})),b.push(o),m=o)}catch(s){e(s)}return m}function U(b){if(g.hasOwnProperty(b))for(var c,d=a.get(b+h),e=0,f=d.length;f>e;e++)if(c=d[e],c.multiElement)return!0;return!1}function V(a,b){var c=b.$attr,d=a.$attr,e=a.$$element;f(a,function(d,e){"$"!=e.charAt(0)&&(b[e]&&b[e]!==d&&(d+=("style"===e?";":" ")+b[e]),a.$set(e,d,!0,c[e]))}),f(b,function(b,f){"class"==f?(E(e,b),a["class"]=(a["class"]?a["class"]+" ":"")+b):"style"==f?(e.attr("style",e.attr("style")+";"+b),a.style=(a.style?a.style+";":"")+b):"$"==f.charAt(0)||a.hasOwnProperty(f)||(a[f]=b,d[f]=c[f])})}function W(a,b,c,d,e,g,h,j){var k,l,m=[],o=b[0],p=a.shift(),q=n(p,{templateUrl:null,transclude:null,replace:null,$$originalDirective:p}),r=x(p.templateUrl)?p.templateUrl(b,c):p.templateUrl,s=p.templateNamespace;return b.empty(),i(B.getTrustedResourceUrl(r)).then(function(i){var n,u,v,w;if(i=ka(i),p.replace){if(v=qa(i)?[]:ab($(s,md(i))),n=v[0],1!=v.length||n.nodeType!==sd)throw Wd("tplrt","Template for directive '{0}' must have exactly one root element. {1}",p.name,r);u={$attr:{}},ba(d,b,n);var x=L(n,[],u);t(p.scope)&&R(x),a=x.concat(a),V(c,u)}else n=o,b.html(i);for(a.unshift(q),k=Q(a,n,c,e,b,p,g,h,j),f(d,function(a,c){a==n&&(d[c]=b[0])}),l=H(b[0].childNodes,e);m.length;){var y=m.shift(),z=m.shift(),A=m.shift(),B=m.shift(),C=b[0];if(!y.$$destroyed){if(z!==o){var D=z.className;j.hasElementTranscludeDirective&&p.replace||(C=va(n)),ba(A,ad(z),C),E(ad(C),D)}w=k.transcludeOnThisElement?K(y,k.transclude,B):B,k(l,y,C,d,w)}}m=null}),function(a,b,c,d,e){var f=e;b.$$destroyed||(m?m.push(b,c,d,f):(k.transcludeOnThisElement&&(f=K(b,k.transclude,e)),k(l,b,c,d,f)))}}function X(a,b){var c=b.priority-a.priority;return 0!==c?c:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function Y(a,b,c,d){if(b)throw Wd("multidir","Multiple directives [{0}, {1}] asking for {2} on: {3}",b.name,c.name,a,T(d))}function Z(a,b){var c=d(b,!0);c&&a.push({priority:0,compile:function(a){var b=a.parent(),d=!!b.length;return d&&F.$$addBindingClass(b),function(a,b){var e=b.parent();d||F.$$addBindingClass(e),F.$$addBindingInfo(e,c.expressions),a.$watch(c,function(a){b[0].nodeValue=a})}}})}function $(a,c){switch(a=Wc(a||"html")){case"svg":case"math":var d=b.createElement("div");return d.innerHTML="<"+a+">"+c+"</"+a+">",d.childNodes[0].childNodes;default:return c}}function _(a,b){if("srcdoc"==b)return B.HTML;var c=I(a);return"xlinkHref"==b||"form"==c&&"action"==b||"img"!=c&&("src"==b||"ngSrc"==b)?B.RESOURCE_URL:void 0}function aa(a,b,c,e,f){var g=_(a,e);f=m[e]||f;var h=d(c,!0,g,f);if(h){if("multiple"===e&&"select"===I(a))throw Wd("selmulti","Binding to the 'multiple' attribute is not supported. Element: {0}",T(a));b.push({priority:100,compile:function(){return{pre:function(a,b,i){var j=i.$$observers||(i.$$observers={});if(v.test(e))throw Wd("nodomevents","Interpolations for HTML DOM event attributes are disallowed.  Please use the ng- versions (such as ng-click instead of onclick) instead.");var k=i[e];k!==c&&(h=k&&d(k,!0,g,f),c=k),h&&(i[e]=h(a),(j[e]||(j[e]=[])).$$inter=!0,(i.$$observers&&i.$$observers[e].$$scope||a).$watch(h,function(a,b){"class"===e&&a!=b?i.$updateClass(a,b):i.$set(e,a)}))}}}})}}function ba(a,c,d){var e,f,g=c[0],h=c.length,i=g.parentNode;if(a)for(e=0,f=a.length;f>e;e++)if(a[e]==g){a[e++]=d;for(var j=e,k=j+h-1,l=a.length;l>j;j++,k++)l>k?a[j]=a[k]:delete a[j];a.length-=h-1,a.context===g&&(a.context=d);break}i&&i.replaceChild(d,g);var m=b.createDocumentFragment();m.appendChild(g),ad(d).data(ad(g).data()),bd?(kd=!0,bd.cleanData([g])):delete ad.cache[g[ad.expando]];for(var n=1,o=c.length;o>n;n++){var p=c[n];ad(p).remove(),m.appendChild(p),delete c[n]}c[0]=d,c.length=1}function da(a,b){return l(function(){return a.apply(null,arguments)},a,b)}function fa(a,b,c,d,f,g){try{a(b,c,d,f,g)}catch(h){e(h,T(c))}}var ga=function(a,b){if(b){var c,d,e,f=Object.keys(b);for(c=0,d=f.length;d>c;c++)e=f[c],this[e]=b[e]}else this.$attr={};this.$$element=a};ga.prototype={$normalize:$a,$addClass:function(a){a&&a.length>0&&C.addClass(this.$$element,a)},$removeClass:function(a){a&&a.length>0&&C.removeClass(this.$$element,a)},$updateClass:function(a,b){var c=_a(a,b);c&&c.length&&C.addClass(this.$$element,c);var d=_a(b,a);d&&d.length&&C.removeClass(this.$$element,d)},$set:function(a,b,d,g){var h,i=this.$$element[0],j=Ka(i,a),k=La(i,a),l=a;if(j?(this.$$element.prop(a,b),g=j):k&&(this[k]=b,l=k),this[a]=b,g?this.$attr[a]=g:(g=this.$attr[a],g||(this.$attr[a]=g=ca(a,"-"))),h=I(this.$$element),"a"===h&&"href"===a||"img"===h&&"src"===a)this[a]=b=D(b,"src"===a);else if("img"===h&&"srcset"===a){for(var m="",n=md(b),o=/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/,p=/\s/.test(n)?o:/(,)/,q=n.split(p),r=Math.floor(q.length/2),s=0;r>s;s++){var t=2*s;m+=D(md(q[t]),!0),m+=" "+md(q[t+1])}var u=md(q[2*s]).split(/\s/);m+=D(md(u[0]),!0),2===u.length&&(m+=" "+md(u[1])),this[a]=b=m}d!==!1&&(null===b||b===c?this.$$element.removeAttr(g):this.$$element.attr(g,b));var v=this.$$observers;v&&f(v[l],function(a){try{a(b)}catch(c){e(c)}})},$observe:function(a,b){var c=this,d=c.$$observers||(c.$$observers=ja()),e=d[a]||(d[a]=[]);return e.push(b),y.$evalAsync(function(){!e.$$inter&&c.hasOwnProperty(a)&&b(c[a])}),function(){J(e,b)}}};var ha=d.startSymbol(),ia=d.endSymbol(),ka="{{"==ha||"}}"==ia?p:function(a){return a.replace(/\{\{/g,ha).replace(/}}/g,ia)},la=/^ngAttr[A-Z]/;return F.$$addBindingInfo=w?function(a,b){var c=a.data("$binding")||[];ld(b)?c=c.concat(b):c.push(b),a.data("$binding",c)}:o,F.$$addBindingClass=w?function(a){E(a,"ng-binding")}:o,F.$$addScopeInfo=w?function(a,b,c,d){var e=c?d?"$isolateScopeNoTemplate":"$isolateScope":"$scope";a.data(e,b)}:o,F.$$addScopeClass=w?function(a,b){E(a,b?"ng-isolate-scope":"ng-scope")}:o,F}]}function $a(a){return pa(a.replace(Xd,""))}function _a(a,b){var c="",d=a.split(/\s+/),e=b.split(/\s+/);a:for(var f=0;f<d.length;f++){for(var g=d[f],h=0;h<e.length;h++)if(g==e[h])continue a;c+=(c.length>0?" ":"")+g}return c}function ab(a){a=ad(a);var b=a.length;if(1>=b)return a;for(;b--;){var c=a[b];c.nodeType===ud&&ed.call(a,b,1)}return a}function bb(){var a={},b=!1,e=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(b,c){ga(b,"controller"),t(b)?l(a,b):a[b]=c},this.allowGlobals=function(){b=!0},this.$get=["$injector","$window",function(f,g){function h(a,b,c,e){if(!a||!t(a.$scope))throw d("$controller")("noscp","Cannot export controller '{0}' as '{1}'! No $scope object provided via `locals`.",e,b);a.$scope[b]=c}return function(d,i,j,k){var m,n,o,p;if(j=j===!0,k&&u(k)&&(p=k),u(d)){if(n=d.match(e),!n)throw Yd("ctrlfmt","Badly formed controller string '{0}'. Must match `__name__ as __id__` or `__name__`.",d);o=n[1],p=p||n[3],d=a.hasOwnProperty(o)?a[o]:ha(i.$scope,o,!0)||(b?ha(g,o,!0):c),fa(d,o,!0)}if(j){var q=(ld(d)?d[d.length-1]:d).prototype;return m=Object.create(q||null),p&&h(i,p,m,o||d.name),l(function(){return f.invoke(d,m,i,o),m},{instance:m,identifier:p})}return m=f.instantiate(d,i,o),p&&h(i,p,m,o||d.name),m}}]}function cb(){this.$get=["$window",function(a){return ad(a.document)}]}function db(){this.$get=["$log",function(a){return function(b,c){a.error.apply(a,arguments)}}]}function eb(a,b){if(u(a)){var c=a.replace(be,"").trim();if(c){var d=b("Content-Type");(d&&0===d.indexOf(Zd)||fb(c))&&(a=S(c))}}return a}function fb(a){var b=a.match(_d);return b&&ae[b[0]].test(a)}function gb(a){var b,c,d,e=ja();return a?(f(a.split("\n"),function(a){d=a.indexOf(":"),b=Wc(md(a.substr(0,d))),c=md(a.substr(d+1)),b&&(e[b]=e[b]?e[b]+", "+c:c)}),e):e}function hb(a){var b=t(a)?a:c;return function(c){if(b||(b=gb(a)),c){var d=b[Wc(c)];return void 0===d&&(d=null),d}return b}}function ib(a,b,c,d){return x(d)?d(a,b,c):(f(d,function(d){a=d(a,b,c)}),a)}function jb(a){return a>=200&&300>a}function kb(){var a=this.defaults={transformResponse:[eb],transformRequest:[function(a){return!t(a)||B(a)||D(a)||C(a)?a:R(a)}],headers:{common:{Accept:"application/json, text/plain, */*"},post:L($d),put:L($d),patch:L($d)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},b=!1;this.useApplyAsync=function(a){return s(a)?(b=!!a,this):b};var e=this.interceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope","$q","$injector",function(g,i,j,k,m,n){function o(b){function e(a){var b=l({},a);return a.data?b.data=ib(a.data,a.headers,a.status,i.transformResponse):b.data=a.data,jb(a.status)?b:m.reject(b)}function g(a){var b,c={};return f(a,function(a,d){x(a)?(b=a(),null!=b&&(c[d]=b)):c[d]=a}),c}function h(b){var c,d,e,f=a.headers,h=l({},b.headers);f=l({},f.common,f[Wc(b.method)]);a:for(c in f){d=Wc(c);for(e in h)if(Wc(e)===d)continue a;h[c]=f[c]}return g(h)}if(!id.isObject(b))throw d("$http")("badreq","Http request configuration must be an object.  Received: {0}",b);var i=l({method:"get",transformRequest:a.transformRequest,transformResponse:a.transformResponse},b);i.headers=h(b),i.method=Yc(i.method);var j=function(b){var d=b.headers,g=ib(b.data,hb(d),c,b.transformRequest);return r(g)&&f(d,function(a,b){"content-type"===Wc(b)&&delete d[b]}),r(b.withCredentials)&&!r(a.withCredentials)&&(b.withCredentials=a.withCredentials),v(b,g).then(e,e)},k=[j,c],n=m.when(i);for(f(A,function(a){(a.request||a.requestError)&&k.unshift(a.request,a.requestError),(a.response||a.responseError)&&k.push(a.response,a.responseError)});k.length;){var o=k.shift(),p=k.shift();n=n.then(o,p)}return n.success=function(a){return n.then(function(b){a(b.data,b.status,b.headers,i)}),n},n.error=function(a){return n.then(null,function(b){a(b.data,b.status,b.headers,i)}),n},n}function p(a){f(arguments,function(a){o[a]=function(b,c){return o(l(c||{},{method:a,url:b}))}})}function q(a){f(arguments,function(a){o[a]=function(b,c,d){return o(l(d||{},{method:a,url:b,data:c}))}})}function v(d,e){function f(a,c,d,e){function f(){h(c,a,d,e)}n&&(jb(a)?n.put(w,[a,c,gb(d),e]):n.remove(w)),b?k.$applyAsync(f):(f(),k.$$phase||k.$apply())}function h(a,b,c,e){b=Math.max(b,0),(jb(b)?q.resolve:q.reject)({data:a,status:b,headers:hb(c),config:d,statusText:e})}function j(a){h(a.data,a.status,L(a.headers()),a.statusText)}function l(){var a=o.pendingRequests.indexOf(d);-1!==a&&o.pendingRequests.splice(a,1)}var n,p,q=m.defer(),u=q.promise,v=d.headers,w=y(d.url,d.params);if(o.pendingRequests.push(d),u.then(l,l),!d.cache&&!a.cache||d.cache===!1||"GET"!==d.method&&"JSONP"!==d.method||(n=t(d.cache)?d.cache:t(a.cache)?a.cache:z),n&&(p=n.get(w),s(p)?F(p)?p.then(j,j):ld(p)?h(p[1],p[0],L(p[2]),p[3]):h(p,200,{},"OK"):n.put(w,u)),r(p)){var x=ec(d.url)?i.cookies()[d.xsrfCookieName||a.xsrfCookieName]:c;x&&(v[d.xsrfHeaderName||a.xsrfHeaderName]=x),g(d.method,w,e,f,v,d.timeout,d.withCredentials,d.responseType)}return u}function y(a,b){if(!b)return a;var c=[];return h(b,function(a,b){null===a||r(a)||(ld(a)||(a=[a]),f(a,function(a){t(a)&&(a=w(a)?a.toISOString():R(a)),c.push(Y(b)+"="+Y(a))}))}),c.length>0&&(a+=(-1==a.indexOf("?")?"?":"&")+c.join("&")),a}var z=j("$http"),A=[];return f(e,function(a){A.unshift(u(a)?n.get(a):n.invoke(a))}),o.pendingRequests=[],p("get","delete","head","jsonp"),q("post","put","patch"),o.defaults=a,o}]}function lb(){return new a.XMLHttpRequest}function mb(){this.$get=["$browser","$window","$document",function(a,b,c){return nb(a,lb,a.defer,b.angular.callbacks,c[0])}]}function nb(a,b,d,e,g){function h(a,b,c){var d=g.createElement("script"),f=null;return d.type="text/javascript",d.src=a,d.async=!0,f=function(a){Bd(d,"load",f),Bd(d,"error",f),g.body.removeChild(d),d=null;var h=-1,i="unknown";a&&("load"!==a.type||e[b].called||(a={type:"error"}),i=a.type,h="error"===a.type?404:200),c&&c(h,i)},Ad(d,"load",f),Ad(d,"error",f),g.body.appendChild(d),f}return function(g,i,j,k,l,m,n,p){function q(){u&&u(),v&&v.abort()}function r(b,e,f,g,h){y!==c&&d.cancel(y),u=v=null,b(e,f,g,h),a.$$completeOutstandingRequest(o)}if(a.$$incOutstandingRequestCount(),i=i||a.url(),"jsonp"==Wc(g)){var t="_"+(e.counter++).toString(36);e[t]=function(a){e[t].data=a,e[t].called=!0};var u=h(i.replace("JSON_CALLBACK","angular.callbacks."+t),t,function(a,b){r(k,a,e[t].data,"",b),e[t]=o})}else{var v=b();v.open(g,i,!0),f(l,function(a,b){s(a)&&v.setRequestHeader(b,a)}),v.onload=function(){var a=v.statusText||"",b="response"in v?v.response:v.responseText,c=1223===v.status?204:v.status;0===c&&(c=b?200:"file"==dc(i).protocol?404:0),r(k,c,b,v.getAllResponseHeaders(),a)};var w=function(){r(k,-1,null,null,"")};if(v.onerror=w,v.onabort=w,n&&(v.withCredentials=!0),p)try{v.responseType=p}catch(x){if("json"!==p)throw x}v.send(j||null)}if(m>0)var y=d(q,m);else F(m)&&m.then(q)}}function ob(){var a="{{",b="}}";this.startSymbol=function(b){return b?(a=b,this):a},this.endSymbol=function(a){return a?(b=a,this):b},this.$get=["$parse","$exceptionHandler","$sce",function(c,d,e){function f(a){return"\\\\\\"+a}function g(f,g,m,n){function o(c){return c.replace(j,a).replace(k,b)}function p(a){try{return a=D(a),n&&!s(a)?a:E(a)}catch(b){var c=ce("interr","Can't interpolate: {0}\n{1}",f,b.toString());d(c)}}n=!!n;for(var q,t,u,v=0,w=[],y=[],z=f.length,A=[],B=[];z>v;){if(-1==(q=f.indexOf(a,v))||-1==(t=f.indexOf(b,q+h))){v!==z&&A.push(o(f.substring(v)));break}v!==q&&A.push(o(f.substring(v,q))),u=f.substring(q+h,t),w.push(u),y.push(c(u,p)),v=t+i,B.push(A.length),A.push("")}if(m&&A.length>1)throw ce("noconcat","Error while interpolating: {0}\nStrict Contextual Escaping disallows interpolations that concatenate multiple expressions when a trusted value is required.  See http://docs.angularjs.org/api/ng.$sce",f);if(!g||w.length){var C=function(a){for(var b=0,c=w.length;c>b;b++){if(n&&r(a[b]))return;A[B[b]]=a[b]}return A.join("")},D=function(a){return m?e.getTrusted(m,a):e.valueOf(a)},E=function(a){if(null==a)return"";switch(typeof a){case"string":break;case"number":a=""+a;break;default:a=R(a)}return a};return l(function(a){var b=0,c=w.length,e=new Array(c);try{for(;c>b;b++)e[b]=y[b](a);return C(e)}catch(g){var h=ce("interr","Can't interpolate: {0}\n{1}",f,g.toString());d(h)}},{exp:f,expressions:w,$$watchDelegate:function(a,b,c){var d;return a.$watchGroup(y,function(c,e){var f=C(c);x(b)&&b.call(this,f,c!==e?d:f,a),d=f},c)}})}}var h=a.length,i=b.length,j=new RegExp(a.replace(/./g,f),"g"),k=new RegExp(b.replace(/./g,f),"g");return g.startSymbol=function(){return a},g.endSymbol=function(){return b},g}]}function pb(){this.$get=["$rootScope","$window","$q","$$q",function(a,b,c,d){function e(e,g,h,i){var j=b.setInterval,k=b.clearInterval,l=0,m=s(i)&&!i,n=(m?d:c).defer(),o=n.promise;return h=s(h)?h:0,o.then(null,null,e),o.$$intervalId=j(function(){n.notify(l++),h>0&&l>=h&&(n.resolve(l),k(o.$$intervalId),delete f[o.$$intervalId]),m||a.$apply()},g),f[o.$$intervalId]=n,o}var f={};return e.cancel=function(a){return a&&a.$$intervalId in f?(f[a.$$intervalId].reject("canceled"),b.clearInterval(a.$$intervalId),delete f[a.$$intervalId],!0):!1},e}]}function qb(){this.$get=function(){return{id:"en-us",NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"¤",posSuf:"",negPre:"(¤",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),SHORTMONTH:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),DAY:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),SHORTDAY:"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(","),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a",ERANAMES:["Before Christ","Anno Domini"],ERAS:["BC","AD"]},pluralCat:function(a){return 1===a?"one":"other"}}}}function rb(a){for(var b=a.split("/"),c=b.length;c--;)b[c]=X(b[c]);return b.join("/")}function sb(a,b){var c=dc(a);b.$$protocol=c.protocol,b.$$host=c.hostname,b.$$port=m(c.port)||ee[c.protocol]||null}function tb(a,b){var c="/"!==a.charAt(0);c&&(a="/"+a);var d=dc(a);b.$$path=decodeURIComponent(c&&"/"===d.pathname.charAt(0)?d.pathname.substring(1):d.pathname),b.$$search=V(d.search),b.$$hash=decodeURIComponent(d.hash),b.$$path&&"/"!=b.$$path.charAt(0)&&(b.$$path="/"+b.$$path)}function ub(a,b){return 0===b.indexOf(a)?b.substr(a.length):void 0}function vb(a){var b=a.indexOf("#");return-1==b?a:a.substr(0,b)}function wb(a){return a.replace(/(#.+)|#$/,"$1")}function xb(a){return a.substr(0,vb(a).lastIndexOf("/")+1)}function yb(a){return a.substring(0,a.indexOf("/",a.indexOf("//")+2))}function zb(a,b){this.$$html5=!0,b=b||"";var d=xb(a);sb(a,this),this.$$parse=function(a){var b=ub(d,a);if(!u(b))throw fe("ipthprfx",'Invalid url "{0}", missing path prefix "{1}".',a,d);tb(b,this),this.$$path||(this.$$path="/"),this.$$compose()},this.$$compose=function(){var a=W(this.$$search),b=this.$$hash?"#"+X(this.$$hash):"";this.$$url=rb(this.$$path)+(a?"?"+a:"")+b,this.$$absUrl=d+this.$$url.substr(1)},this.$$parseLinkUrl=function(e,f){if(f&&"#"===f[0])return this.hash(f.slice(1)),!0;var g,h,i;return(g=ub(a,e))!==c?(h=g,i=(g=ub(b,g))!==c?d+(ub("/",g)||g):a+h):(g=ub(d,e))!==c?i=d+g:d==e+"/"&&(i=d),i&&this.$$parse(i),!!i}}function Ab(a,b){var c=xb(a);sb(a,this),this.$$parse=function(d){function e(a,b,c){var d,e=/^\/[A-Z]:(\/.*)/;return 0===b.indexOf(c)&&(b=b.replace(c,"")),e.exec(b)?a:(d=e.exec(a),d?d[1]:a)}var f,g=ub(a,d)||ub(c,d);"#"===g.charAt(0)?(f=ub(b,g),r(f)&&(f=g)):f=this.$$html5?g:"",tb(f,this),this.$$path=e(this.$$path,f,a),this.$$compose()},this.$$compose=function(){var c=W(this.$$search),d=this.$$hash?"#"+X(this.$$hash):"";this.$$url=rb(this.$$path)+(c?"?"+c:"")+d,this.$$absUrl=a+(this.$$url?b+this.$$url:"")},this.$$parseLinkUrl=function(b,c){return vb(a)==vb(b)?(this.$$parse(b),!0):!1}}function Bb(a,b){this.$$html5=!0,Ab.apply(this,arguments);var c=xb(a);this.$$parseLinkUrl=function(d,e){if(e&&"#"===e[0])return this.hash(e.slice(1)),!0;var f,g;return a==vb(d)?f=d:(g=ub(c,d))?f=a+b+g:c===d+"/"&&(f=c),f&&this.$$parse(f),!!f},this.$$compose=function(){var c=W(this.$$search),d=this.$$hash?"#"+X(this.$$hash):"";this.$$url=rb(this.$$path)+(c?"?"+c:"")+d,this.$$absUrl=a+b+this.$$url}}function Cb(a){return function(){return this[a]}}function Db(a,b){return function(c){return r(c)?this[a]:(this[a]=b(c),this.$$compose(),this)}}function Eb(){var a="",b={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(b){return s(b)?(a=b,this):a},this.html5Mode=function(a){return E(a)?(b.enabled=a,this):t(a)?(E(a.enabled)&&(b.enabled=a.enabled),E(a.requireBase)&&(b.requireBase=a.requireBase),E(a.rewriteLinks)&&(b.rewriteLinks=a.rewriteLinks),this):b},this.$get=["$rootScope","$browser","$sniffer","$rootElement","$window",function(c,d,e,f,g){function h(a,b,c){var e=j.url(),f=j.$$state;try{d.url(a,b,c),j.$$state=d.state()}catch(g){throw j.url(e),j.$$state=f,g}}function i(a,b){c.$broadcast("$locationChangeSuccess",j.absUrl(),a,j.$$state,b)}var j,k,l,m=d.baseHref(),n=d.url();if(b.enabled){if(!m&&b.requireBase)throw fe("nobase","$location in HTML5 mode requires a <base> tag to be present!");l=yb(n)+(m||"/"),k=e.history?zb:Bb}else l=vb(n),k=Ab;j=new k(l,"#"+a),j.$$parseLinkUrl(n,n),j.$$state=d.state();var o=/^\s*(javascript|mailto):/i;f.on("click",function(a){if(b.rewriteLinks&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&2!=a.which&&2!=a.button){for(var e=ad(a.target);"a"!==I(e[0]);)if(e[0]===f[0]||!(e=e.parent())[0])return;var h=e.prop("href"),i=e.attr("href")||e.attr("xlink:href");t(h)&&"[object SVGAnimatedString]"===h.toString()&&(h=dc(h.animVal).href),o.test(h)||!h||e.attr("target")||a.isDefaultPrevented()||j.$$parseLinkUrl(h,i)&&(a.preventDefault(),j.absUrl()!=d.url()&&(c.$apply(),g.angular["ff-684208-preventDefault"]=!0))}}),wb(j.absUrl())!=wb(n)&&d.url(j.absUrl(),!0);var p=!0;return d.onUrlChange(function(a,b){c.$evalAsync(function(){var d,e=j.absUrl(),f=j.$$state;j.$$parse(a),j.$$state=b,d=c.$broadcast("$locationChangeStart",a,e,b,f).defaultPrevented,j.absUrl()===a&&(d?(j.$$parse(e),j.$$state=f,h(e,!1,f)):(p=!1,i(e,f)))}),c.$$phase||c.$digest()}),c.$watch(function(){var a=wb(d.url()),b=wb(j.absUrl()),f=d.state(),g=j.$$replace,k=a!==b||j.$$html5&&e.history&&f!==j.$$state;(p||k)&&(p=!1,c.$evalAsync(function(){var b=j.absUrl(),d=c.$broadcast("$locationChangeStart",b,a,j.$$state,f).defaultPrevented;j.absUrl()===b&&(d?(j.$$parse(a),j.$$state=f):(k&&h(b,g,f===j.$$state?null:j.$$state),i(a,f)))})),j.$$replace=!1}),j}]}function Fb(){var a=!0,b=this;this.debugEnabled=function(b){return s(b)?(a=b,this):a},this.$get=["$window",function(c){function d(a){return a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line)),a}function e(a){var b=c.console||{},e=b[a]||b.log||o,g=!1;try{g=!!e.apply}catch(h){}return g?function(){var a=[];return f(arguments,function(b){a.push(d(b))}),e.apply(b,a)}:function(a,b){e(a,null==b?"":b)}}return{log:e("log"),info:e("info"),warn:e("warn"),error:e("error"),debug:function(){var c=e("debug");return function(){a&&c.apply(b,arguments)}}()}}]}function Gb(a,b){if("__defineGetter__"===a||"__defineSetter__"===a||"__lookupGetter__"===a||"__lookupSetter__"===a||"__proto__"===a)throw he("isecfld","Attempting to access a disallowed field in Angular expressions! Expression: {0}",b);return a}function Hb(a,b){if(a){if(a.constructor===a)throw he("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",b);if(a.window===a)throw he("isecwindow","Referencing the Window in Angular expressions is disallowed! Expression: {0}",b);if(a.children&&(a.nodeName||a.prop&&a.attr&&a.find))throw he("isecdom","Referencing DOM nodes in Angular expressions is disallowed! Expression: {0}",b);if(a===Object)throw he("isecobj","Referencing Object in Angular expressions is disallowed! Expression: {0}",b)}return a}function Ib(a,b){if(a){if(a.constructor===a)throw he("isecfn","Referencing Function in Angular expressions is disallowed! Expression: {0}",b);if(a===ie||a===je||a===ke)throw he("isecff","Referencing call, apply or bind in Angular expressions is disallowed! Expression: {0}",b)}}function Jb(a){return a.constant}function Kb(a,b,c,d,e){Hb(a,e),Hb(b,e);for(var f,g=c.split("."),h=0;g.length>1;h++){f=Gb(g.shift(),e);var i=0===h&&b&&b[f]||a[f];i||(i={},a[f]=i),a=Hb(i,e)}return f=Gb(g.shift(),e),Hb(a[f],e),a[f]=d,d}function Lb(a){return"constructor"==a}function Mb(a,b,d,e,f,g,h){Gb(a,g),Gb(b,g),Gb(d,g),Gb(e,g),Gb(f,g);var i=function(a){return Hb(a,g)},j=h||Lb(a)?i:p,k=h||Lb(b)?i:p,l=h||Lb(d)?i:p,m=h||Lb(e)?i:p,n=h||Lb(f)?i:p;return function(g,h){var i=h&&h.hasOwnProperty(a)?h:g;return null==i?i:(i=j(i[a]),b?null==i?c:(i=k(i[b]),d?null==i?c:(i=l(i[d]),e?null==i?c:(i=m(i[e]),f?null==i?c:i=n(i[f]):i):i):i):i)}}function Nb(a,b){return function(c,d){return a(c,d,Hb,b)}}function Ob(a,b,d){var e=b.expensiveChecks,g=e?re:qe,h=g[a];if(h)return h;var i=a.split("."),j=i.length;if(b.csp)h=6>j?Mb(i[0],i[1],i[2],i[3],i[4],d,e):function(a,b){var f,g=0;do f=Mb(i[g++],i[g++],i[g++],i[g++],i[g++],d,e)(a,b),b=c,a=f;while(j>g);return f};else{var k="";e&&(k+="s = eso(s, fe);\nl = eso(l, fe);\n");var l=e;f(i,function(a,b){Gb(a,d);var c=(b?"s":'((l&&l.hasOwnProperty("'+a+'"))?l:s)')+"."+a;(e||Lb(a))&&(c="eso("+c+", fe)",l=!0),k+="if(s == null) return undefined;\ns="+c+";\n"}),k+="return s;";var m=new Function("s","l","eso","fe",k);m.toString=q(k),l&&(m=Nb(m,d)),h=m}return h.sharedGetter=!0,h.assign=function(b,c,d){return Kb(b,d,a,c,a)},g[a]=h,h}function Pb(a){return x(a.valueOf)?a.valueOf():se.call(a)}function Qb(){var a=ja(),b=ja();this.$get=["$filter","$sniffer",function(c,d){function e(a){var b=a;return a.sharedGetter&&(b=function(b,c){return a(b,c)},b.literal=a.literal,b.constant=a.constant,b.assign=a.assign),b}function g(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];e.constant||(e.inputs?g(e.inputs,b):-1===b.indexOf(e)&&b.push(e))}return b}function h(a,b){return null==a||null==b?a===b:"object"==typeof a&&(a=Pb(a),"object"==typeof a)?!1:a===b||a!==a&&b!==b}function i(a,b,c,d){var e,f=d.$$inputs||(d.$$inputs=g(d.inputs,[]));if(1===f.length){var i=h;return f=f[0],a.$watch(function(a){var b=f(a);return h(b,i)||(e=d(a),i=b&&Pb(b)),e},b,c)}for(var j=[],k=0,l=f.length;l>k;k++)j[k]=h;return a.$watch(function(a){for(var b=!1,c=0,g=f.length;g>c;c++){var i=f[c](a);(b||(b=!h(i,j[c])))&&(j[c]=i&&Pb(i))}return b&&(e=d(a)),e},b,c)}function j(a,b,c,d){var e,f;return e=a.$watch(function(a){return d(a)},function(a,c,d){f=a,x(b)&&b.apply(this,arguments),s(a)&&d.$$postDigest(function(){s(f)&&e()})},c)}function k(a,b,c,d){function e(a){var b=!0;return f(a,function(a){s(a)||(b=!1)}),b}var g,h;return g=a.$watch(function(a){return d(a)},function(a,c,d){h=a,x(b)&&b.call(this,a,c,d),e(a)&&d.$$postDigest(function(){e(h)&&g()})},c)}function l(a,b,c,d){var e;return e=a.$watch(function(a){return d(a)},function(a,c,d){x(b)&&b.apply(this,arguments),e()},c)}function m(a,b){if(!b)return a;var c=a.$$watchDelegate,d=c!==k&&c!==j,e=d?function(c,d){var e=a(c,d);return b(e,c,d)}:function(c,d){var e=a(c,d),f=b(e,c,d);return s(e)?f:e};return a.$$watchDelegate&&a.$$watchDelegate!==i?e.$$watchDelegate=a.$$watchDelegate:b.$stateful||(e.$$watchDelegate=i,e.inputs=[a]),e}var n={csp:d.csp,expensiveChecks:!1},p={csp:d.csp,expensiveChecks:!0};return function(d,f,g){var h,q,r;switch(typeof d){case"string":r=d=d.trim();var s=g?b:a;if(h=s[r],!h){":"===d.charAt(0)&&":"===d.charAt(1)&&(q=!0,d=d.substring(2));var t=g?p:n,u=new oe(t),v=new pe(u,c,t);h=v.parse(d),h.constant?h.$$watchDelegate=l:q?(h=e(h),h.$$watchDelegate=h.literal?k:j):h.inputs&&(h.$$watchDelegate=i),s[r]=h}return m(h,f);case"function":return m(d,f);default:return m(o,f)}}}]}function Rb(){this.$get=["$rootScope","$exceptionHandler",function(a,b){return Tb(function(b){a.$evalAsync(b)},b)}]}function Sb(){this.$get=["$browser","$exceptionHandler",function(a,b){return Tb(function(b){a.defer(b)},b)}]}function Tb(a,b){function e(a,b,c){function d(b){return function(c){e||(e=!0,b.call(a,c))}}var e=!1;return[d(b),d(c)]}function g(){this.$$state={status:0}}function h(a,b){return function(c){b.call(a,c)}}function i(a){var d,e,f;f=a.pending,a.processScheduled=!1,a.pending=c;for(var g=0,h=f.length;h>g;++g){e=f[g][0],d=f[g][a.status];try{x(d)?e.resolve(d(a.value)):1===a.status?e.resolve(a.value):e.reject(a.value)}catch(i){e.reject(i),b(i)}}}function j(b){!b.processScheduled&&b.pending&&(b.processScheduled=!0,a(function(){i(b)}))}function k(){this.promise=new g,this.resolve=h(this,this.resolve),this.reject=h(this,this.reject),this.notify=h(this,this.notify)}function l(a){var b=new k,c=0,d=ld(a)?[]:{};return f(a,function(a,e){c++,r(a).then(function(a){d.hasOwnProperty(e)||(d[e]=a,--c||b.resolve(d))},function(a){d.hasOwnProperty(e)||b.reject(a)})}),0===c&&b.resolve(d),b.promise}var m=d("$q",TypeError),n=function(){return new k};g.prototype={then:function(a,b,c){var d=new k;return this.$$state.pending=this.$$state.pending||[],this.$$state.pending.push([d,a,b,c]),this.$$state.status>0&&j(this.$$state),d.promise},"catch":function(a){return this.then(null,a)},"finally":function(a,b){return this.then(function(b){return q(b,!0,a)},function(b){return q(b,!1,a)},b)}},k.prototype={resolve:function(a){this.promise.$$state.status||(a===this.promise?this.$$reject(m("qcycle","Expected promise to be resolved with value other than itself '{0}'",a)):this.$$resolve(a))},$$resolve:function(a){var c,d;d=e(this,this.$$resolve,this.$$reject);try{(t(a)||x(a))&&(c=a&&a.then),x(c)?(this.promise.$$state.status=-1,c.call(a,d[0],d[1],this.notify)):(this.promise.$$state.value=a,this.promise.$$state.status=1,j(this.promise.$$state))}catch(f){d[1](f),b(f)}},reject:function(a){this.promise.$$state.status||this.$$reject(a)},$$reject:function(a){this.promise.$$state.value=a,this.promise.$$state.status=2,j(this.promise.$$state)},notify:function(c){var d=this.promise.$$state.pending;this.promise.$$state.status<=0&&d&&d.length&&a(function(){for(var a,e,f=0,g=d.length;g>f;f++){e=d[f][0],a=d[f][3];try{e.notify(x(a)?a(c):c)}catch(h){b(h)}}})}};var o=function(a){var b=new k;return b.reject(a),b.promise},p=function(a,b){var c=new k;return b?c.resolve(a):c.reject(a),c.promise},q=function(a,b,c){var d=null;try{x(c)&&(d=c())}catch(e){return p(e,!1)}return F(d)?d.then(function(){return p(a,b)},function(a){return p(a,!1)}):p(a,b)},r=function(a,b,c,d){var e=new k;return e.resolve(a),e.promise.then(b,c,d)},s=function u(a){function b(a){d.resolve(a)}function c(a){d.reject(a)}if(!x(a))throw m("norslvr","Expected resolverFn, got '{0}'",a);if(!(this instanceof u))return new u(a);var d=new k;return a(b,c),d.promise};return s.defer=n,s.reject=o,s.when=r,s.all=l,s}function Ub(){this.$get=["$window","$timeout",function(a,b){var c=a.requestAnimationFrame||a.webkitRequestAnimationFrame,d=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame,e=!!c,f=e?function(a){var b=c(a);return function(){d(b)}}:function(a){var c=b(a,16.66,!1);return function(){b.cancel(c)}};return f.supported=e,f}]}function Vb(){function a(a){function b(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$$watchersCount=0,this.$id=j(),this.$$ChildScope=null}return b.prototype=a,b}var b=10,c=d("$rootScope"),g=null,h=null;this.digestTtl=function(a){return arguments.length&&(b=a),b},this.$get=["$injector","$exceptionHandler","$parse","$browser",function(d,i,k,l){function m(a){a.currentScope.$$destroyed=!0}function n(){this.$id=j(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,this.$root=this,this.$$destroyed=!1,this.$$listeners={},this.$$listenerCount={},this.$$isolateBindings=null}function p(a){if(y.$$phase)throw c("inprog","{0} already in progress",y.$$phase);y.$$phase=a}function q(){y.$$phase=null}function s(a,b,c){do a.$$listenerCount[c]-=b,0===a.$$listenerCount[c]&&delete a.$$listenerCount[c];while(a=a.$parent)}function u(){}function v(){for(;B.length;)try{B.shift()()}catch(a){i(a)}h=null}function w(){null===h&&(h=l.defer(function(){y.$apply(v)}))}n.prototype={constructor:n,$new:function(b,c){var d;return c=c||this,b?(d=new n,d.$root=this.$root):(this.$$ChildScope||(this.$$ChildScope=a(this)),d=new this.$$ChildScope),d.$parent=c,d.$$prevSibling=c.$$childTail,c.$$childHead?(c.$$childTail.$$nextSibling=d,c.$$childTail=d):c.$$childHead=c.$$childTail=d,(b||c!=this)&&d.$on("$destroy",m),d},$watch:function(a,b,c){var d=k(a);if(d.$$watchDelegate)return d.$$watchDelegate(this,b,c,d);var e=this,f=e.$$watchers,h={fn:b,last:u,get:d,exp:a,eq:!!c};return g=null,x(b)||(h.fn=o),f||(f=e.$$watchers=[]),f.unshift(h),function(){J(f,h),g=null}},$watchGroup:function(a,b){function c(){i=!1,j?(j=!1,b(e,e,h)):b(e,d,h)}var d=new Array(a.length),e=new Array(a.length),g=[],h=this,i=!1,j=!0;if(!a.length){var k=!0;return h.$evalAsync(function(){k&&b(e,e,h)}),function(){k=!1}}return 1===a.length?this.$watch(a[0],function(a,c,f){e[0]=a,d[0]=c,b(e,a===c?e:d,f)}):(f(a,function(a,b){var f=h.$watch(a,function(a,f){e[b]=a,d[b]=f,i||(i=!0,h.$evalAsync(c))});g.push(f)}),function(){for(;g.length;)g.shift()()})},$watchCollection:function(a,b){function c(a){f=a;var b,c,d,h,i;if(!r(f)){if(t(f))if(e(f)){g!==n&&(g=n,q=g.length=0,l++),b=f.length,q!==b&&(l++,g.length=q=b);for(var j=0;b>j;j++)i=g[j],h=f[j],d=i!==i&&h!==h,d||i===h||(l++,g[j]=h)}else{g!==o&&(g=o={},q=0,l++),b=0;for(c in f)f.hasOwnProperty(c)&&(b++,h=f[c],i=g[c],c in g?(d=i!==i&&h!==h,d||i===h||(l++,g[c]=h)):(q++,g[c]=h,l++));if(q>b){l++;for(c in g)f.hasOwnProperty(c)||(q--,delete g[c])}}else g!==f&&(g=f,l++);return l}}function d(){if(p?(p=!1,b(f,f,i)):b(f,h,i),j)if(t(f))if(e(f)){h=new Array(f.length);for(var a=0;a<f.length;a++)h[a]=f[a]}else{h={};for(var c in f)Xc.call(f,c)&&(h[c]=f[c])}else h=f}c.$stateful=!0;var f,g,h,i=this,j=b.length>1,l=0,m=k(a,c),n=[],o={},p=!0,q=0;return this.$watch(m,d)},$digest:function(){var a,d,e,f,j,k,m,n,o,r,s=b,t=this,w=[];p("$digest"),l.$$checkUrlChange(),this===y&&null!==h&&(l.defer.cancel(h),
v()),g=null;do{for(k=!1,n=t;z.length;){try{r=z.shift(),r.scope.$eval(r.expression,r.locals)}catch(B){i(B)}g=null}a:do{if(f=n.$$watchers)for(j=f.length;j--;)try{if(a=f[j])if((d=a.get(n))===(e=a.last)||(a.eq?M(d,e):"number"==typeof d&&"number"==typeof e&&isNaN(d)&&isNaN(e))){if(a===g){k=!1;break a}}else k=!0,g=a,a.last=a.eq?K(d,null):d,a.fn(d,e===u?d:e,n),5>s&&(o=4-s,w[o]||(w[o]=[]),w[o].push({msg:x(a.exp)?"fn: "+(a.exp.name||a.exp.toString()):a.exp,newVal:d,oldVal:e}))}catch(B){i(B)}if(!(m=n.$$childHead||n!==t&&n.$$nextSibling))for(;n!==t&&!(m=n.$$nextSibling);)n=n.$parent}while(n=m);if((k||z.length)&&!s--)throw q(),c("infdig","{0} $digest() iterations reached. Aborting!\nWatchers fired in the last 5 iterations: {1}",b,w)}while(k||z.length);for(q();A.length;)try{A.shift()()}catch(B){i(B)}},$destroy:function(){if(!this.$$destroyed){var a=this.$parent;if(this.$broadcast("$destroy"),this.$$destroyed=!0,this!==y){for(var b in this.$$listenerCount)s(this,this.$$listenerCount[b],b);a.$$childHead==this&&(a.$$childHead=this.$$nextSibling),a.$$childTail==this&&(a.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=o,this.$on=this.$watch=this.$watchGroup=function(){return o},this.$$listeners={},this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=this.$$watchers=null}}},$eval:function(a,b){return k(a)(this,b)},$evalAsync:function(a,b){y.$$phase||z.length||l.defer(function(){z.length&&y.$digest()}),z.push({scope:this,expression:a,locals:b})},$$postDigest:function(a){A.push(a)},$apply:function(a){try{return p("$apply"),this.$eval(a)}catch(b){i(b)}finally{q();try{y.$digest()}catch(b){throw i(b),b}}},$applyAsync:function(a){function b(){c.$eval(a)}var c=this;a&&B.push(b),w()},$on:function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=c=[]),c.push(b);var d=this;do d.$$listenerCount[a]||(d.$$listenerCount[a]=0),d.$$listenerCount[a]++;while(d=d.$parent);var e=this;return function(){var d=c.indexOf(b);-1!==d&&(c[d]=null,s(e,1,a))}},$emit:function(a,b){var c,d,e,f=[],g=this,h=!1,j={name:a,targetScope:g,stopPropagation:function(){h=!0},preventDefault:function(){j.defaultPrevented=!0},defaultPrevented:!1},k=N([j],arguments,1);do{for(c=g.$$listeners[a]||f,j.currentScope=g,d=0,e=c.length;e>d;d++)if(c[d])try{c[d].apply(null,k)}catch(l){i(l)}else c.splice(d,1),d--,e--;if(h)return j.currentScope=null,j;g=g.$parent}while(g);return j.currentScope=null,j},$broadcast:function(a,b){var c=this,d=c,e=c,f={name:a,targetScope:c,preventDefault:function(){f.defaultPrevented=!0},defaultPrevented:!1};if(!c.$$listenerCount[a])return f;for(var g,h,j,k=N([f],arguments,1);d=e;){for(f.currentScope=d,g=d.$$listeners[a]||[],h=0,j=g.length;j>h;h++)if(g[h])try{g[h].apply(null,k)}catch(l){i(l)}else g.splice(h,1),h--,j--;if(!(e=d.$$listenerCount[a]&&d.$$childHead||d!==c&&d.$$nextSibling))for(;d!==c&&!(e=d.$$nextSibling);)d=d.$parent}return f.currentScope=null,f}};var y=new n,z=y.$$asyncQueue=[],A=y.$$postDigestQueue=[],B=y.$$applyAsyncQueue=[];return y}]}function Wb(){var a=/^\s*(https?|ftp|mailto|tel|file):/,b=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(b){return s(b)?(a=b,this):a},this.imgSrcSanitizationWhitelist=function(a){return s(a)?(b=a,this):b},this.$get=function(){return function(c,d){var e,f=d?b:a;return e=dc(c).href,""===e||e.match(f)?c:"unsafe:"+e}}}function Xb(a){if("self"===a)return a;if(u(a)){if(a.indexOf("***")>-1)throw te("iwcard","Illegal sequence *** in string matcher.  String: {0}",a);return a=nd(a).replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*"),new RegExp("^"+a+"$")}if(y(a))return new RegExp("^"+a.source+"$");throw te("imatcher",'Matchers may only be "self", string patterns or RegExp objects')}function Yb(a){var b=[];return s(a)&&f(a,function(a){b.push(Xb(a))}),b}function Zb(){this.SCE_CONTEXTS=ue;var a=["self"],b=[];this.resourceUrlWhitelist=function(b){return arguments.length&&(a=Yb(b)),a},this.resourceUrlBlacklist=function(a){return arguments.length&&(b=Yb(a)),b},this.$get=["$injector",function(d){function e(a,b){return"self"===a?ec(b):!!a.exec(b.href)}function f(c){var d,f,g=dc(c.toString()),h=!1;for(d=0,f=a.length;f>d;d++)if(e(a[d],g)){h=!0;break}if(h)for(d=0,f=b.length;f>d;d++)if(e(b[d],g)){h=!1;break}return h}function g(a){var b=function(a){this.$$unwrapTrustedValue=function(){return a}};return a&&(b.prototype=new a),b.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},b.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},b}function h(a,b){var d=m.hasOwnProperty(a)?m[a]:null;if(!d)throw te("icontext","Attempted to trust a value in invalid context. Context: {0}; Value: {1}",a,b);if(null===b||b===c||""===b)return b;if("string"!=typeof b)throw te("itype","Attempted to trust a non-string value in a content requiring a string: Context: {0}",a);return new d(b)}function i(a){return a instanceof l?a.$$unwrapTrustedValue():a}function j(a,b){if(null===b||b===c||""===b)return b;var d=m.hasOwnProperty(a)?m[a]:null;if(d&&b instanceof d)return b.$$unwrapTrustedValue();if(a===ue.RESOURCE_URL){if(f(b))return b;throw te("insecurl","Blocked loading resource from url not allowed by $sceDelegate policy.  URL: {0}",b.toString())}if(a===ue.HTML)return k(b);throw te("unsafe","Attempting to use an unsafe value in a safe context.")}var k=function(a){throw te("unsafe","Attempting to use an unsafe value in a safe context.")};d.has("$sanitize")&&(k=d.get("$sanitize"));var l=g(),m={};return m[ue.HTML]=g(l),m[ue.CSS]=g(l),m[ue.URL]=g(l),m[ue.JS]=g(l),m[ue.RESOURCE_URL]=g(m[ue.URL]),{trustAs:h,getTrusted:j,valueOf:i}}]}function $b(){var a=!0;this.enabled=function(b){return arguments.length&&(a=!!b),a},this.$get=["$parse","$sceDelegate",function(b,c){if(a&&8>_c)throw te("iequirks","Strict Contextual Escaping does not support Internet Explorer version < 11 in quirks mode.  You can fix this by adding the text <!doctype html> to the top of your HTML document.  See http://docs.angularjs.org/api/ng.$sce for more information.");var d=L(ue);d.isEnabled=function(){return a},d.trustAs=c.trustAs,d.getTrusted=c.getTrusted,d.valueOf=c.valueOf,a||(d.trustAs=d.getTrusted=function(a,b){return b},d.valueOf=p),d.parseAs=function(a,c){var e=b(c);return e.literal&&e.constant?e:b(c,function(b){return d.getTrusted(a,b)})};var e=d.parseAs,g=d.getTrusted,h=d.trustAs;return f(ue,function(a,b){var c=Wc(b);d[pa("parse_as_"+c)]=function(b){return e(a,b)},d[pa("get_trusted_"+c)]=function(b){return g(a,b)},d[pa("trust_as_"+c)]=function(b){return h(a,b)}}),d}]}function _b(){this.$get=["$window","$document",function(a,b){var c,d,e={},f=m((/android (\d+)/.exec(Wc((a.navigator||{}).userAgent))||[])[1]),g=/Boxee/i.test((a.navigator||{}).userAgent),h=b[0]||{},i=/^(Moz|webkit|ms)(?=[A-Z])/,j=h.body&&h.body.style,k=!1,l=!1;if(j){for(var n in j)if(d=i.exec(n)){c=d[0],c=c.substr(0,1).toUpperCase()+c.substr(1);break}c||(c="WebkitOpacity"in j&&"webkit"),k=!!("transition"in j||c+"Transition"in j),l=!!("animation"in j||c+"Animation"in j),!f||k&&l||(k=u(h.body.style.webkitTransition),l=u(h.body.style.webkitAnimation))}return{history:!(!a.history||!a.history.pushState||4>f||g),hasEvent:function(a){if("input"===a&&11>=_c)return!1;if(r(e[a])){var b=h.createElement("div");e[a]="on"+a in b}return e[a]},csp:od(),vendorPrefix:c,transitions:k,animations:l,android:f}}]}function ac(){this.$get=["$templateCache","$http","$q",function(a,b,c){function d(e,f){function g(a){if(!f)throw Wd("tpload","Failed to load template: {0}",e);return c.reject(a)}d.totalPendingRequests++;var h=b.defaults&&b.defaults.transformResponse;ld(h)?h=h.filter(function(a){return a!==eb}):h===eb&&(h=null);var i={cache:a,transformResponse:h};return b.get(e,i)["finally"](function(){d.totalPendingRequests--}).then(function(a){return a.data},g)}return d.totalPendingRequests=0,d}]}function bc(){this.$get=["$rootScope","$browser","$location",function(a,b,c){var d={};return d.findBindings=function(a,b,c){var d=a.getElementsByClassName("ng-binding"),e=[];return f(d,function(a){var d=id.element(a).data("$binding");d&&f(d,function(d){if(c){var f=new RegExp("(^|\\s)"+nd(b)+"(\\s|\\||$)");f.test(d)&&e.push(a)}else-1!=d.indexOf(b)&&e.push(a)})}),e},d.findModels=function(a,b,c){for(var d=["ng-","data-ng-","ng\\:"],e=0;e<d.length;++e){var f=c?"=":"*=",g="["+d[e]+"model"+f+'"'+b+'"]',h=a.querySelectorAll(g);if(h.length)return h}},d.getLocation=function(){return c.url()},d.setLocation=function(b){b!==c.url()&&(c.url(b),a.$digest())},d.whenStable=function(a){b.notifyWhenNoOutstandingRequests(a)},d}]}function cc(){this.$get=["$rootScope","$browser","$q","$$q","$exceptionHandler",function(a,b,c,d,e){function f(f,h,i){var j,k=s(i)&&!i,l=(k?d:c).defer(),m=l.promise;return j=b.defer(function(){try{l.resolve(f())}catch(b){l.reject(b),e(b)}finally{delete g[m.$$timeoutId]}k||a.$apply()},h),m.$$timeoutId=j,g[j]=l,m}var g={};return f.cancel=function(a){return a&&a.$$timeoutId in g?(g[a.$$timeoutId].reject("canceled"),delete g[a.$$timeoutId],b.defer.cancel(a.$$timeoutId)):!1},f}]}function dc(a){var b=a;return _c&&(ve.setAttribute("href",b),b=ve.href),ve.setAttribute("href",b),{href:ve.href,protocol:ve.protocol?ve.protocol.replace(/:$/,""):"",host:ve.host,search:ve.search?ve.search.replace(/^\?/,""):"",hash:ve.hash?ve.hash.replace(/^#/,""):"",hostname:ve.hostname,port:ve.port,pathname:"/"===ve.pathname.charAt(0)?ve.pathname:"/"+ve.pathname}}function ec(a){var b=u(a)?dc(a):a;return b.protocol===we.protocol&&b.host===we.host}function fc(){this.$get=q(a)}function gc(a){function b(d,e){if(t(d)){var g={};return f(d,function(a,c){g[c]=b(c,a)}),g}return a.factory(d+c,e)}var c="Filter";this.register=b,this.$get=["$injector",function(a){return function(b){return a.get(b+c)}}],b("currency",kc),b("date",xc),b("filter",hc),b("json",yc),b("limitTo",zc),b("lowercase",Be),b("number",lc),b("orderBy",Ac),b("uppercase",Ce)}function hc(){return function(a,b,c){if(!ld(a))return a;var d,e;switch(typeof b){case"function":d=b;break;case"boolean":case"number":case"string":e=!0;case"object":d=ic(b,c,e);break;default:return a}return a.filter(d)}}function ic(a,b,c){var d,e=t(a)&&"$"in a;return b===!0?b=M:x(b)||(b=function(a,b){return t(a)||t(b)?!1:(a=Wc(""+a),b=Wc(""+b),-1!==a.indexOf(b))}),d=function(d){return e&&!t(d)?jc(d,a.$,b,!1):jc(d,a,b,c)}}function jc(a,b,c,d,e){var f=null!==a?typeof a:"null",g=null!==b?typeof b:"null";if("string"===g&&"!"===b.charAt(0))return!jc(a,b.substring(1),c,d);if(ld(a))return a.some(function(a){return jc(a,b,c,d)});switch(f){case"object":var h;if(d){for(h in a)if("$"!==h.charAt(0)&&jc(a[h],b,c,!0))return!0;return e?!1:jc(a,b,c,!1)}if("object"===g){for(h in b){var i=b[h];if(!x(i)&&!r(i)){var j="$"===h,k=j?a:a[h];if(!jc(k,i,c,j,j))return!1}}return!0}return c(a,b);case"function":return!1;default:return c(a,b)}}function kc(a){var b=a.NUMBER_FORMATS;return function(a,c,d){return r(c)&&(c=b.CURRENCY_SYM),r(d)&&(d=b.PATTERNS[1].maxFrac),null==a?a:mc(a,b.PATTERNS[1],b.GROUP_SEP,b.DECIMAL_SEP,d).replace(/\u00A4/g,c)}}function lc(a){var b=a.NUMBER_FORMATS;return function(a,c){return null==a?a:mc(a,b.PATTERNS[0],b.GROUP_SEP,b.DECIMAL_SEP,c)}}function mc(a,b,c,d,e){if(!isFinite(a)||t(a))return"";var f=0>a;a=Math.abs(a);var g=a+"",h="",i=[],j=!1;if(-1!==g.indexOf("e")){var k=g.match(/([\d\.]+)e(-?)(\d+)/);k&&"-"==k[2]&&k[3]>e+1?a=0:(h=g,j=!0)}if(j)e>0&&1>a&&(h=a.toFixed(e),a=parseFloat(h));else{var l=(g.split(xe)[1]||"").length;r(e)&&(e=Math.min(Math.max(b.minFrac,l),b.maxFrac)),a=+(Math.round(+(a.toString()+"e"+e)).toString()+"e"+-e);var m=(""+a).split(xe),n=m[0];m=m[1]||"";var o,p=0,q=b.lgSize,s=b.gSize;if(n.length>=q+s)for(p=n.length-q,o=0;p>o;o++)(p-o)%s===0&&0!==o&&(h+=c),h+=n.charAt(o);for(o=p;o<n.length;o++)(n.length-o)%q===0&&0!==o&&(h+=c),h+=n.charAt(o);for(;m.length<e;)m+="0";e&&"0"!==e&&(h+=d+m.substr(0,e))}return 0===a&&(f=!1),i.push(f?b.negPre:b.posPre,h,f?b.negSuf:b.posSuf),i.join("")}function nc(a,b,c){var d="";for(0>a&&(d="-",a=-a),a=""+a;a.length<b;)a="0"+a;return c&&(a=a.substr(a.length-b)),d+a}function oc(a,b,c,d){return c=c||0,function(e){var f=e["get"+a]();return(c>0||f>-c)&&(f+=c),0===f&&-12==c&&(f=12),nc(f,b,d)}}function pc(a,b){return function(c,d){var e=c["get"+a](),f=Yc(b?"SHORT"+a:a);return d[f][e]}}function qc(a){var b=-1*a.getTimezoneOffset(),c=b>=0?"+":"";return c+=nc(Math[b>0?"floor":"ceil"](b/60),2)+nc(Math.abs(b%60),2)}function rc(a){var b=new Date(a,0,1).getDay();return new Date(a,0,(4>=b?5:12)-b)}function sc(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate()+(4-a.getDay()))}function tc(a){return function(b){var c=rc(b.getFullYear()),d=sc(b),e=+d-+c,f=1+Math.round(e/6048e5);return nc(f,a)}}function uc(a,b){return a.getHours()<12?b.AMPMS[0]:b.AMPMS[1]}function vc(a,b){return a.getFullYear()<=0?b.ERAS[0]:b.ERAS[1]}function wc(a,b){return a.getFullYear()<=0?b.ERANAMES[0]:b.ERANAMES[1]}function xc(a){function b(a){var b;if(b=a.match(c)){var d=new Date(0),e=0,f=0,g=b[8]?d.setUTCFullYear:d.setFullYear,h=b[8]?d.setUTCHours:d.setHours;b[9]&&(e=m(b[9]+b[10]),f=m(b[9]+b[11])),g.call(d,m(b[1]),m(b[2])-1,m(b[3]));var i=m(b[4]||0)-e,j=m(b[5]||0)-f,k=m(b[6]||0),l=Math.round(1e3*parseFloat("0."+(b[7]||0)));return h.call(d,i,j,k,l),d}return a}var c=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(c,d,e){var g,h,i="",j=[];if(d=d||"mediumDate",d=a.DATETIME_FORMATS[d]||d,u(c)&&(c=Ae.test(c)?m(c):b(c)),v(c)&&(c=new Date(c)),!w(c))return c;for(;d;)h=ze.exec(d),h?(j=N(j,h,1),d=j.pop()):(j.push(d),d=null);return e&&"UTC"===e&&(c=new Date(c.getTime()),c.setMinutes(c.getMinutes()+c.getTimezoneOffset())),f(j,function(b){g=ye[b],i+=g?g(c,a.DATETIME_FORMATS):b.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),i}}function yc(){return function(a,b){return r(b)&&(b=2),R(a,b)}}function zc(){return function(a,b){return v(a)&&(a=a.toString()),ld(a)||u(a)?(b=Math.abs(Number(b))===1/0?Number(b):m(b),b?b>0?a.slice(0,b):a.slice(b):u(a)?"":[]):a}}function Ac(a){return function(b,c,d){function f(a,b){for(var d=0;d<c.length;d++){var e=c[d](a,b);if(0!==e)return e}return 0}function g(a,b){return b?function(b,c){return a(c,b)}:a}function h(a){switch(typeof a){case"number":case"boolean":case"string":return!0;default:return!1}}function i(a){return null===a?"null":"function"==typeof a.valueOf&&(a=a.valueOf(),h(a))?a:"function"==typeof a.toString&&(a=a.toString(),h(a))?a:""}function j(a,b){var c=typeof a,d=typeof b;return c===d&&"object"===c&&(a=i(a),b=i(b)),c===d?("string"===c&&(a=a.toLowerCase(),b=b.toLowerCase()),a===b?0:b>a?-1:1):d>c?-1:1}return e(b)?(c=ld(c)?c:[c],0===c.length&&(c=["+"]),c=c.map(function(b){var c=!1,d=b||p;if(u(b)){if(("+"==b.charAt(0)||"-"==b.charAt(0))&&(c="-"==b.charAt(0),b=b.substring(1)),""===b)return g(j,c);if(d=a(b),d.constant){var e=d();return g(function(a,b){return j(a[e],b[e])},c)}}return g(function(a,b){return j(d(a),d(b))},c)}),dd.call(b).sort(g(f,d))):b}}function Bc(a){return x(a)&&(a={link:a}),a.restrict=a.restrict||"AC",q(a)}function Cc(a,b){a.$name=b}function Dc(a,b,d,e,g){var h=this,i=[],j=h.$$parentForm=a.parent().controller("form")||Fe;h.$error={},h.$$success={},h.$pending=c,h.$name=g(b.name||b.ngForm||"")(d),h.$dirty=!1,h.$pristine=!0,h.$valid=!0,h.$invalid=!1,h.$submitted=!1,j.$addControl(h),h.$rollbackViewValue=function(){f(i,function(a){a.$rollbackViewValue()})},h.$commitViewValue=function(){f(i,function(a){a.$commitViewValue()})},h.$addControl=function(a){ga(a.$name,"input"),i.push(a),a.$name&&(h[a.$name]=a)},h.$$renameControl=function(a,b){var c=a.$name;h[c]===a&&delete h[c],h[b]=a,a.$name=b},h.$removeControl=function(a){a.$name&&h[a.$name]===a&&delete h[a.$name],f(h.$pending,function(b,c){h.$setValidity(c,null,a)}),f(h.$error,function(b,c){h.$setValidity(c,null,a)}),f(h.$$success,function(b,c){h.$setValidity(c,null,a)}),J(i,a)},Sc({ctrl:this,$element:a,set:function(a,b,c){var d=a[b];if(d){var e=d.indexOf(c);-1===e&&d.push(c)}else a[b]=[c]},unset:function(a,b,c){var d=a[b];d&&(J(d,c),0===d.length&&delete a[b])},parentForm:j,$animate:e}),h.$setDirty=function(){e.removeClass(a,of),e.addClass(a,pf),h.$dirty=!0,h.$pristine=!1,j.$setDirty()},h.$setPristine=function(){e.setClass(a,of,pf+" "+Ge),h.$dirty=!1,h.$pristine=!0,h.$submitted=!1,f(i,function(a){a.$setPristine()})},h.$setUntouched=function(){f(i,function(a){a.$setUntouched()})},h.$setSubmitted=function(){e.addClass(a,Ge),h.$submitted=!0,j.$setSubmitted()}}function Ec(a){a.$formatters.push(function(b){return a.$isEmpty(b)?b:b.toString()})}function Fc(a,b,c,d,e,f){Gc(a,b,c,d,e,f),Ec(d)}function Gc(a,b,c,d,e,f){var g=Wc(b[0].type);if(!e.android){var h=!1;b.on("compositionstart",function(a){h=!0}),b.on("compositionend",function(){h=!1,i()})}var i=function(a){if(j&&(f.defer.cancel(j),j=null),!h){var e=b.val(),i=a&&a.type;"password"===g||c.ngTrim&&"false"===c.ngTrim||(e=md(e)),(d.$viewValue!==e||""===e&&d.$$hasNativeValidators)&&d.$setViewValue(e,i)}};if(e.hasEvent("input"))b.on("input",i);else{var j,k=function(a,b,c){j||(j=f.defer(function(){j=null,b&&b.value===c||i(a)}))};b.on("keydown",function(a){var b=a.keyCode;91===b||b>15&&19>b||b>=37&&40>=b||k(a,this,this.value)}),e.hasEvent("paste")&&b.on("paste cut",k)}b.on("change",i),d.$render=function(){b.val(d.$isEmpty(d.$viewValue)?"":d.$viewValue)}}function Hc(a,b){if(w(a))return a;if(u(a)){Qe.lastIndex=0;var c=Qe.exec(a);if(c){var d=+c[1],e=+c[2],f=0,g=0,h=0,i=0,j=rc(d),k=7*(e-1);return b&&(f=b.getHours(),g=b.getMinutes(),h=b.getSeconds(),i=b.getMilliseconds()),new Date(d,0,j.getDate()+k,f,g,h,i)}}return 0/0}function Ic(a,b){return function(c,d){var e,g;if(w(c))return c;if(u(c)){if('"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substring(1,c.length-1)),Ke.test(c))return new Date(c);if(a.lastIndex=0,e=a.exec(c))return e.shift(),g=d?{yyyy:d.getFullYear(),MM:d.getMonth()+1,dd:d.getDate(),HH:d.getHours(),mm:d.getMinutes(),ss:d.getSeconds(),sss:d.getMilliseconds()/1e3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},f(e,function(a,c){c<b.length&&(g[b[c]]=+a)}),new Date(g.yyyy,g.MM-1,g.dd,g.HH,g.mm,g.ss||0,1e3*g.sss||0)}return 0/0}}function Jc(a,b,d,e){return function(f,g,h,i,j,k,l){function m(a){return a&&!(a.getTime&&a.getTime()!==a.getTime())}function n(a){return s(a)?w(a)?a:d(a):c}Kc(f,g,h,i),Gc(f,g,h,i,j,k);var o,p=i&&i.$options&&i.$options.timezone;if(i.$$parserName=a,i.$parsers.push(function(a){if(i.$isEmpty(a))return null;if(b.test(a)){var e=d(a,o);return"UTC"===p&&e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e}return c}),i.$formatters.push(function(a){if(a&&!w(a))throw tf("datefmt","Expected `{0}` to be a date",a);if(m(a)){if(o=a,o&&"UTC"===p){var b=6e4*o.getTimezoneOffset();o=new Date(o.getTime()+b)}return l("date")(a,e,p)}return o=null,""}),s(h.min)||h.ngMin){var q;i.$validators.min=function(a){return!m(a)||r(q)||d(a)>=q},h.$observe("min",function(a){q=n(a),i.$validate()})}if(s(h.max)||h.ngMax){var t;i.$validators.max=function(a){return!m(a)||r(t)||d(a)<=t},h.$observe("max",function(a){t=n(a),i.$validate()})}}}function Kc(a,b,d,e){var f=b[0],g=e.$$hasNativeValidators=t(f.validity);g&&e.$parsers.push(function(a){var d=b.prop(Vc)||{};return d.badInput&&!d.typeMismatch?c:a})}function Lc(a,b,d,e,f,g){if(Kc(a,b,d,e),Gc(a,b,d,e,f,g),e.$$parserName="number",e.$parsers.push(function(a){return e.$isEmpty(a)?null:Ne.test(a)?parseFloat(a):c}),e.$formatters.push(function(a){if(!e.$isEmpty(a)){if(!v(a))throw tf("numfmt","Expected `{0}` to be a number",a);a=a.toString()}return a}),s(d.min)||d.ngMin){var h;e.$validators.min=function(a){return e.$isEmpty(a)||r(h)||a>=h},d.$observe("min",function(a){s(a)&&!v(a)&&(a=parseFloat(a,10)),h=v(a)&&!isNaN(a)?a:c,e.$validate()})}if(s(d.max)||d.ngMax){var i;e.$validators.max=function(a){return e.$isEmpty(a)||r(i)||i>=a},d.$observe("max",function(a){s(a)&&!v(a)&&(a=parseFloat(a,10)),i=v(a)&&!isNaN(a)?a:c,e.$validate()})}}function Mc(a,b,c,d,e,f){Gc(a,b,c,d,e,f),Ec(d),d.$$parserName="url",d.$validators.url=function(a,b){var c=a||b;return d.$isEmpty(c)||Le.test(c)}}function Nc(a,b,c,d,e,f){Gc(a,b,c,d,e,f),Ec(d),d.$$parserName="email",d.$validators.email=function(a,b){var c=a||b;return d.$isEmpty(c)||Me.test(c)}}function Oc(a,b,c,d){r(c.name)&&b.attr("name",j());var e=function(a){b[0].checked&&d.$setViewValue(c.value,a&&a.type)};b.on("click",e),d.$render=function(){var a=c.value;b[0].checked=a==d.$viewValue},c.$observe("value",d.$render)}function Pc(a,b,c,e,f){var g;if(s(e)){if(g=a(e),!g.constant)throw d("ngModel")("constexpr","Expected constant expression for `{0}`, but saw `{1}`.",c,e);return g(b)}return f}function Qc(a,b,c,d,e,f,g,h){var i=Pc(h,a,"ngTrueValue",c.ngTrueValue,!0),j=Pc(h,a,"ngFalseValue",c.ngFalseValue,!1),k=function(a){d.$setViewValue(b[0].checked,a&&a.type)};b.on("click",k),d.$render=function(){b[0].checked=d.$viewValue},d.$isEmpty=function(a){return a===!1},d.$formatters.push(function(a){return M(a,i)}),d.$parsers.push(function(a){return a?i:j})}function Rc(a,b){return a="ngClass"+a,["$animate",function(c){function d(a,b){var c=[];a:for(var d=0;d<a.length;d++){for(var e=a[d],f=0;f<b.length;f++)if(e==b[f])continue a;c.push(e)}return c}function e(a){if(ld(a))return a;if(u(a))return a.split(" ");if(t(a)){var b=[];return f(a,function(a,c){a&&(b=b.concat(c.split(" ")))}),b}return a}return{restrict:"AC",link:function(g,h,i){function j(a){var b=l(a,1);i.$addClass(b)}function k(a){var b=l(a,-1);i.$removeClass(b)}function l(a,b){var c=h.data("$classCounts")||{},d=[];return f(a,function(a){(b>0||c[a])&&(c[a]=(c[a]||0)+b,c[a]===+(b>0)&&d.push(a))}),h.data("$classCounts",c),d.join(" ")}function m(a,b){var e=d(b,a),f=d(a,b);e=l(e,1),f=l(f,-1),e&&e.length&&c.addClass(h,e),f&&f.length&&c.removeClass(h,f)}function n(a){if(b===!0||g.$index%2===b){var c=e(a||[]);if(o){if(!M(a,o)){var d=e(o);m(d,c)}}else j(c)}o=L(a)}var o;g.$watch(i[a],n,!0),i.$observe("class",function(b){n(g.$eval(i[a]))}),"ngClass"!==a&&g.$watch("$index",function(c,d){var f=1&c;if(f!==(1&d)){var h=e(g.$eval(i[a]));f===b?j(h):k(h)}})}}}]}function Sc(a){function b(a,b,i){b===c?d("$pending",a,i):e("$pending",a,i),E(b)?b?(l(h.$error,a,i),k(h.$$success,a,i)):(k(h.$error,a,i),l(h.$$success,a,i)):(l(h.$error,a,i),l(h.$$success,a,i)),h.$pending?(f(sf,!0),h.$valid=h.$invalid=c,g("",null)):(f(sf,!1),h.$valid=Tc(h.$error),h.$invalid=!h.$valid,g("",h.$valid));var j;j=h.$pending&&h.$pending[a]?c:h.$error[a]?!1:h.$$success[a]?!0:null,g(a,j),m.$setValidity(a,j,h)}function d(a,b,c){h[a]||(h[a]={}),k(h[a],b,c)}function e(a,b,d){h[a]&&l(h[a],b,d),Tc(h[a])&&(h[a]=c)}function f(a,b){b&&!j[a]?(n.addClass(i,a),j[a]=!0):!b&&j[a]&&(n.removeClass(i,a),j[a]=!1)}function g(a,b){a=a?"-"+ca(a,"-"):"",f(mf+a,b===!0),f(nf+a,b===!1)}var h=a.ctrl,i=a.$element,j={},k=a.set,l=a.unset,m=a.parentForm,n=a.$animate;j[nf]=!(j[mf]=i.hasClass(mf)),h.$setValidity=b}function Tc(a){if(a)for(var b in a)return!1;return!0}var Uc=/^\/(.+)\/([a-z]*)$/,Vc="validity",Wc=function(a){return u(a)?a.toLowerCase():a},Xc=Object.prototype.hasOwnProperty,Yc=function(a){return u(a)?a.toUpperCase():a},Zc=function(a){return u(a)?a.replace(/[A-Z]/g,function(a){return String.fromCharCode(32|a.charCodeAt(0))}):a},$c=function(a){return u(a)?a.replace(/[a-z]/g,function(a){return String.fromCharCode(-33&a.charCodeAt(0))}):a};"i"!=="I".toLowerCase()&&(Wc=Zc,Yc=$c);var _c,ad,bd,cd,dd=[].slice,ed=[].splice,fd=[].push,gd=Object.prototype.toString,hd=d("ng"),id=a.angular||(a.angular={}),jd=0;_c=b.documentMode,o.$inject=[],p.$inject=[];var kd,ld=Array.isArray,md=function(a){return u(a)?a.trim():a},nd=function(a){return a.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},od=function(){if(s(od.isActive_))return od.isActive_;var a=!(!b.querySelector("[ng-csp]")&&!b.querySelector("[data-ng-csp]"));if(!a)try{new Function("")}catch(c){a=!0}return od.isActive_=a},pd=["ng-","data-ng-","ng:","x-ng-"],qd=/[A-Z]/g,rd=!1,sd=1,td=3,ud=8,vd=9,wd=11,xd={full:"1.3.15",major:1,minor:3,dot:15,codeName:"locality-filtration"};ua.expando="ng339";var yd=ua.cache={},zd=1,Ad=function(a,b,c){a.addEventListener(b,c,!1)},Bd=function(a,b,c){a.removeEventListener(b,c,!1)};ua._data=function(a){return this.cache[a[this.expando]]||{}};var Cd=/([\:\-\_]+(.))/g,Dd=/^moz([A-Z])/,Ed={mouseleave:"mouseout",mouseenter:"mouseover"},Fd=d("jqLite"),Gd=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Hd=/<|&#?\w+;/,Id=/<([\w:]+)/,Jd=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Kd={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Kd.optgroup=Kd.option,Kd.tbody=Kd.tfoot=Kd.colgroup=Kd.caption=Kd.thead,Kd.th=Kd.td;var Ld=ua.prototype={ready:function(c){function d(){e||(e=!0,c())}var e=!1;"complete"===b.readyState?setTimeout(d):(this.on("DOMContentLoaded",d),ua(a).on("load",d))},toString:function(){var a=[];return f(this,function(b){a.push(""+b)}),"["+a.join(", ")+"]"},eq:function(a){return ad(a>=0?this[a]:this[this.length+a])},length:0,push:fd,sort:[].sort,splice:[].splice},Md={};f("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(a){Md[Wc(a)]=a});var Nd={};f("input,select,option,textarea,button,form,details".split(","),function(a){Nd[a]=!0});var Od={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern"};f({data:Aa,removeData:ya},function(a,b){ua[b]=a}),f({data:Aa,inheritedData:Ga,scope:function(a){return ad.data(a,"$scope")||Ga(a.parentNode||a,["$isolateScope","$scope"])},isolateScope:function(a){return ad.data(a,"$isolateScope")||ad.data(a,"$isolateScopeNoTemplate")},controller:Fa,injector:function(a){return Ga(a,"$injector")},removeAttr:function(a,b){a.removeAttribute(b)},hasClass:Ba,css:function(a,b,c){return b=pa(b),s(c)?void(a.style[b]=c):a.style[b]},attr:function(a,b,d){var e=Wc(b);if(Md[e]){if(!s(d))return a[b]||(a.attributes.getNamedItem(b)||o).specified?e:c;d?(a[b]=!0,a.setAttribute(b,e)):(a[b]=!1,a.removeAttribute(e))}else if(s(d))a.setAttribute(b,d);else if(a.getAttribute){var f=a.getAttribute(b,2);return null===f?c:f}},prop:function(a,b,c){return s(c)?void(a[b]=c):a[b]},text:function(){function a(a,b){if(r(b)){var c=a.nodeType;return c===sd||c===td?a.textContent:""}a.textContent=b}return a.$dv="",a}(),val:function(a,b){if(r(b)){if(a.multiple&&"select"===I(a)){var c=[];return f(a.options,function(a){a.selected&&c.push(a.value||a.text)}),0===c.length?null:c}return a.value}a.value=b},html:function(a,b){return r(b)?a.innerHTML:(wa(a,!0),void(a.innerHTML=b))},empty:Ha},function(a,b){ua.prototype[b]=function(b,d){var e,f,g=this.length;if(a!==Ha&&(2==a.length&&a!==Ba&&a!==Fa?b:d)===c){if(t(b)){for(e=0;g>e;e++)if(a===Aa)a(this[e],b);else for(f in b)a(this[e],f,b[f]);return this}for(var h=a.$dv,i=h===c?Math.min(g,1):g,j=0;i>j;j++){var k=a(this[j],b,d);h=h?h+k:k}return h}for(e=0;g>e;e++)a(this[e],b,d);return this}}),f({removeData:ya,on:function Uf(a,b,c,d){if(s(d))throw Fd("onargs","jqLite#on() does not support the `selector` or `eventData` parameters");if(ra(a)){var e=za(a,!0),f=e.events,g=e.handle;g||(g=e.handle=Ma(a,f));for(var h=b.indexOf(" ")>=0?b.split(" "):[b],i=h.length;i--;){b=h[i];var j=f[b];j||(f[b]=[],"mouseenter"===b||"mouseleave"===b?Uf(a,Ed[b],function(a){var c=this,d=a.relatedTarget;(!d||d!==c&&!c.contains(d))&&g(a,b)}):"$destroy"!==b&&Ad(a,b,g),j=f[b]),j.push(c)}}},off:xa,one:function(a,b,c){a=ad(a),a.on(b,function d(){a.off(b,c),a.off(b,d)}),a.on(b,c)},replaceWith:function(a,b){var c,d=a.parentNode;wa(a),f(new ua(b),function(b){c?d.insertBefore(b,c.nextSibling):d.replaceChild(b,a),c=b})},children:function(a){var b=[];return f(a.childNodes,function(a){a.nodeType===sd&&b.push(a)}),b},contents:function(a){return a.contentDocument||a.childNodes||[]},append:function(a,b){var c=a.nodeType;if(c===sd||c===wd){b=new ua(b);for(var d=0,e=b.length;e>d;d++){var f=b[d];a.appendChild(f)}}},prepend:function(a,b){if(a.nodeType===sd){var c=a.firstChild;f(new ua(b),function(b){a.insertBefore(b,c)})}},wrap:function(a,b){b=ad(b).eq(0).clone()[0];var c=a.parentNode;c&&c.replaceChild(b,a),b.appendChild(a)},remove:Ia,detach:function(a){Ia(a,!0)},after:function(a,b){var c=a,d=a.parentNode;b=new ua(b);for(var e=0,f=b.length;f>e;e++){var g=b[e];d.insertBefore(g,c.nextSibling),c=g}},addClass:Da,removeClass:Ca,toggleClass:function(a,b,c){b&&f(b.split(" "),function(b){var d=c;r(d)&&(d=!Ba(a,b)),(d?Da:Ca)(a,b)})},parent:function(a){var b=a.parentNode;return b&&b.nodeType!==wd?b:null},next:function(a){return a.nextElementSibling},find:function(a,b){return a.getElementsByTagName?a.getElementsByTagName(b):[]},clone:va,triggerHandler:function(a,b,c){var d,e,g,h=b.type||b,i=za(a),j=i&&i.events,k=j&&j[h];k&&(d={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return this.defaultPrevented===!0},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return this.immediatePropagationStopped===!0},stopPropagation:o,type:h,target:a},b.type&&(d=l(d,b)),e=L(k),g=c?[d].concat(c):[d],f(e,function(b){d.isImmediatePropagationStopped()||b.apply(a,g)}))}},function(a,b){ua.prototype[b]=function(b,c,d){for(var e,f=0,g=this.length;g>f;f++)r(e)?(e=a(this[f],b,c,d),s(e)&&(e=ad(e))):Ea(e,a(this[f],b,c,d));return s(e)?e:this},ua.prototype.bind=ua.prototype.on,ua.prototype.unbind=ua.prototype.off}),Pa.prototype={put:function(a,b){this[Oa(a,this.nextUid)]=b},get:function(a){return this[Oa(a,this.nextUid)]},remove:function(a){var b=this[a=Oa(a,this.nextUid)];return delete this[a],b}};var Pd=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,Qd=/,/,Rd=/^\s*(_?)(\S+?)\1\s*$/,Sd=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,Td=d("$injector");Sa.$$annotate=Ra;var Ud=d("$animate"),Vd=["$provide",function(a){this.$$selectors={},this.register=function(b,c){var d=b+"-animation";if(b&&"."!=b.charAt(0))throw Ud("notcsel","Expecting class selector starting with '.' got '{0}'.",b);this.$$selectors[b.substr(1)]=d,a.factory(d,c)},this.classNameFilter=function(a){return 1===arguments.length&&(this.$$classNameFilter=a instanceof RegExp?a:null),this.$$classNameFilter},this.$get=["$$q","$$asyncCallback","$rootScope",function(a,b,c){function d(b){var d,e=a.defer();return e.promise.$$cancelFn=function(){d&&d()},c.$$postDigest(function(){d=b(function(){e.resolve()})}),e.promise}function e(a,b){var c=[],d=[],e=ja();return f((a.attr("class")||"").split(/\s+/),function(a){e[a]=!0}),f(b,function(a,b){var f=e[b];a===!1&&f?d.push(b):a!==!0||f||c.push(b)}),c.length+d.length>0&&[c.length?c:null,d.length?d:null]}function g(a,b,c){for(var d=0,e=b.length;e>d;++d){var f=b[d];a[f]=c}}function h(){return j||(j=a.defer(),b(function(){j.resolve(),j=null})),j.promise}function i(a,b){if(id.isObject(b)){var c=l(b.from||{},b.to||{});a.css(c)}}var j;return{animate:function(a,b,c){return i(a,{from:b,to:c}),h()},enter:function(a,b,c,d){return i(a,d),c?c.after(a):b.prepend(a),h()},leave:function(a,b){return i(a,b),a.remove(),h()},move:function(a,b,c,d){return this.enter(a,b,c,d)},addClass:function(a,b,c){return this.setClass(a,b,[],c)},$$addClassImmediately:function(a,b,c){return a=ad(a),b=u(b)?b:ld(b)?b.join(" "):"",f(a,function(a){Da(a,b)}),i(a,c),h()},removeClass:function(a,b,c){return this.setClass(a,[],b,c)},$$removeClassImmediately:function(a,b,c){return a=ad(a),b=u(b)?b:ld(b)?b.join(" "):"",f(a,function(a){Ca(a,b)}),i(a,c),h()},setClass:function(a,b,c,f){var h=this,i="$$animateClasses",j=!1;a=ad(a);var k=a.data(i);k?f&&k.options&&(k.options=id.extend(k.options||{},f)):(k={classes:{},options:f},j=!0);var l=k.classes;return b=ld(b)?b:b.split(" "),c=ld(c)?c:c.split(" "),g(l,b,!0),g(l,c,!1),j&&(k.promise=d(function(b){var c=a.data(i);if(a.removeData(i),c){var d=e(a,c.classes);d&&h.$$setClassImmediately(a,d[0],d[1],c.options)}b()}),a.data(i,k)),k.promise},$$setClassImmediately:function(a,b,c,d){
return b&&this.$$addClassImmediately(a,b),c&&this.$$removeClassImmediately(a,c),i(a,d),h()},enabled:o,cancel:o}}]}],Wd=d("$compile");Za.$inject=["$provide","$$sanitizeUriProvider"];var Xd=/^((?:x|data)[\:\-_])/i,Yd=d("$controller"),Zd="application/json",$d={"Content-Type":Zd+";charset=utf-8"},_d=/^\[|^\{(?!\{)/,ae={"[":/]$/,"{":/}$/},be=/^\)\]\}',?\n/,ce=d("$interpolate"),de=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,ee={http:80,https:443,ftp:21},fe=d("$location"),ge={$$html5:!1,$$replace:!1,absUrl:Cb("$$absUrl"),url:function(a){if(r(a))return this.$$url;var b=de.exec(a);return(b[1]||""===a)&&this.path(decodeURIComponent(b[1])),(b[2]||b[1]||""===a)&&this.search(b[3]||""),this.hash(b[5]||""),this},protocol:Cb("$$protocol"),host:Cb("$$host"),port:Cb("$$port"),path:Db("$$path",function(a){return a=null!==a?a.toString():"","/"==a.charAt(0)?a:"/"+a}),search:function(a,b){switch(arguments.length){case 0:return this.$$search;case 1:if(u(a)||v(a))a=a.toString(),this.$$search=V(a);else{if(!t(a))throw fe("isrcharg","The first argument of the `$location#search()` call must be a string or an object.");a=K(a,{}),f(a,function(b,c){null==b&&delete a[c]}),this.$$search=a}break;default:r(b)||null===b?delete this.$$search[a]:this.$$search[a]=b}return this.$$compose(),this},hash:Db("$$hash",function(a){return null!==a?a.toString():""}),replace:function(){return this.$$replace=!0,this}};f([Bb,Ab,zb],function(a){a.prototype=Object.create(ge),a.prototype.state=function(b){if(!arguments.length)return this.$$state;if(a!==zb||!this.$$html5)throw fe("nostate","History API state support is available only in HTML5 mode and only in browsers supporting HTML5 History API");return this.$$state=r(b)?null:b,this}});var he=d("$parse"),ie=Function.prototype.call,je=Function.prototype.apply,ke=Function.prototype.bind,le=ja();f({"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:function(){}},function(a,b){a.constant=a.literal=a.sharedGetter=!0,le[b]=a}),le["this"]=function(a){return a},le["this"].sharedGetter=!0;var me=l(ja(),{"+":function(a,b,d,e){return d=d(a,b),e=e(a,b),s(d)?s(e)?d+e:d:s(e)?e:c},"-":function(a,b,c,d){return c=c(a,b),d=d(a,b),(s(c)?c:0)-(s(d)?d:0)},"*":function(a,b,c,d){return c(a,b)*d(a,b)},"/":function(a,b,c,d){return c(a,b)/d(a,b)},"%":function(a,b,c,d){return c(a,b)%d(a,b)},"===":function(a,b,c,d){return c(a,b)===d(a,b)},"!==":function(a,b,c,d){return c(a,b)!==d(a,b)},"==":function(a,b,c,d){return c(a,b)==d(a,b)},"!=":function(a,b,c,d){return c(a,b)!=d(a,b)},"<":function(a,b,c,d){return c(a,b)<d(a,b)},">":function(a,b,c,d){return c(a,b)>d(a,b)},"<=":function(a,b,c,d){return c(a,b)<=d(a,b)},">=":function(a,b,c,d){return c(a,b)>=d(a,b)},"&&":function(a,b,c,d){return c(a,b)&&d(a,b)},"||":function(a,b,c,d){return c(a,b)||d(a,b)},"!":function(a,b,c){return!c(a,b)},"=":!0,"|":!0}),ne={n:"\n",f:"\f",r:"\r",t:"	",v:"","'":"'",'"':'"'},oe=function(a){this.options=a};oe.prototype={constructor:oe,lex:function(a){for(this.text=a,this.index=0,this.tokens=[];this.index<this.text.length;){var b=this.text.charAt(this.index);if('"'===b||"'"===b)this.readString(b);else if(this.isNumber(b)||"."===b&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(b))this.readIdent();else if(this.is(b,"(){}[].,;:?"))this.tokens.push({index:this.index,text:b}),this.index++;else if(this.isWhitespace(b))this.index++;else{var c=b+this.peek(),d=c+this.peek(2),e=me[b],f=me[c],g=me[d];if(e||f||g){var h=g?d:f?c:b;this.tokens.push({index:this.index,text:h,operator:!0}),this.index+=h.length}else this.throwError("Unexpected next character ",this.index,this.index+1)}}return this.tokens},is:function(a,b){return-1!==b.indexOf(a)},peek:function(a){var b=a||1;return this.index+b<this.text.length?this.text.charAt(this.index+b):!1},isNumber:function(a){return a>="0"&&"9">=a&&"string"==typeof a},isWhitespace:function(a){return" "===a||"\r"===a||"	"===a||"\n"===a||""===a||" "===a},isIdent:function(a){return a>="a"&&"z">=a||a>="A"&&"Z">=a||"_"===a||"$"===a},isExpOperator:function(a){return"-"===a||"+"===a||this.isNumber(a)},throwError:function(a,b,c){c=c||this.index;var d=s(b)?"s "+b+"-"+this.index+" ["+this.text.substring(b,c)+"]":" "+c;throw he("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",a,d,this.text)},readNumber:function(){for(var a="",b=this.index;this.index<this.text.length;){var c=Wc(this.text.charAt(this.index));if("."==c||this.isNumber(c))a+=c;else{var d=this.peek();if("e"==c&&this.isExpOperator(d))a+=c;else if(this.isExpOperator(c)&&d&&this.isNumber(d)&&"e"==a.charAt(a.length-1))a+=c;else{if(!this.isExpOperator(c)||d&&this.isNumber(d)||"e"!=a.charAt(a.length-1))break;this.throwError("Invalid exponent")}}this.index++}this.tokens.push({index:b,text:a,constant:!0,value:Number(a)})},readIdent:function(){for(var a=this.index;this.index<this.text.length;){var b=this.text.charAt(this.index);if(!this.isIdent(b)&&!this.isNumber(b))break;this.index++}this.tokens.push({index:a,text:this.text.slice(a,this.index),identifier:!0})},readString:function(a){var b=this.index;this.index++;for(var c="",d=a,e=!1;this.index<this.text.length;){var f=this.text.charAt(this.index);if(d+=f,e){if("u"===f){var g=this.text.substring(this.index+1,this.index+5);g.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+g+"]"),this.index+=4,c+=String.fromCharCode(parseInt(g,16))}else{var h=ne[f];c+=h||f}e=!1}else if("\\"===f)e=!0;else{if(f===a)return this.index++,void this.tokens.push({index:b,text:d,constant:!0,value:c});c+=f}this.index++}this.throwError("Unterminated quote",b)}};var pe=function(a,b,c){this.lexer=a,this.$filter=b,this.options=c};pe.ZERO=l(function(){return 0},{sharedGetter:!0,constant:!0}),pe.prototype={constructor:pe,parse:function(a){this.text=a,this.tokens=this.lexer.lex(a);var b=this.statements();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),b.literal=!!b.literal,b.constant=!!b.constant,b},primary:function(){var a;this.expect("(")?(a=this.filterChain(),this.consume(")")):this.expect("[")?a=this.arrayDeclaration():this.expect("{")?a=this.object():this.peek().identifier&&this.peek().text in le?a=le[this.consume().text]:this.peek().identifier?a=this.identifier():this.peek().constant?a=this.constant():this.throwError("not a primary expression",this.peek());for(var b,c;b=this.expect("(","[",".");)"("===b.text?(a=this.functionCall(a,c),c=null):"["===b.text?(c=a,a=this.objectIndex(a)):"."===b.text?(c=a,a=this.fieldAccess(a)):this.throwError("IMPOSSIBLE");return a},throwError:function(a,b){throw he("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",b.text,a,b.index+1,this.text,this.text.substring(b.index))},peekToken:function(){if(0===this.tokens.length)throw he("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(a,b,c,d){return this.peekAhead(0,a,b,c,d)},peekAhead:function(a,b,c,d,e){if(this.tokens.length>a){var f=this.tokens[a],g=f.text;if(g===b||g===c||g===d||g===e||!b&&!c&&!d&&!e)return f}return!1},expect:function(a,b,c,d){var e=this.peek(a,b,c,d);return e?(this.tokens.shift(),e):!1},consume:function(a){if(0===this.tokens.length)throw he("ueoe","Unexpected end of expression: {0}",this.text);var b=this.expect(a);return b||this.throwError("is unexpected, expecting ["+a+"]",this.peek()),b},unaryFn:function(a,b){var c=me[a];return l(function(a,d){return c(a,d,b)},{constant:b.constant,inputs:[b]})},binaryFn:function(a,b,c,d){var e=me[b];return l(function(b,d){return e(b,d,a,c)},{constant:a.constant&&c.constant,inputs:!d&&[a,c]})},identifier:function(){for(var a=this.consume().text;this.peek(".")&&this.peekAhead(1).identifier&&!this.peekAhead(2,"(");)a+=this.consume().text+this.consume().text;return Ob(a,this.options,this.text)},constant:function(){var a=this.consume().value;return l(function(){return a},{constant:!0,literal:!0})},statements:function(){for(var a=[];;)if(this.tokens.length>0&&!this.peek("}",")",";","]")&&a.push(this.filterChain()),!this.expect(";"))return 1===a.length?a[0]:function(b,c){for(var d,e=0,f=a.length;f>e;e++)d=a[e](b,c);return d}},filterChain:function(){for(var a,b=this.expression();a=this.expect("|");)b=this.filter(b);return b},filter:function(a){var b,d,e=this.$filter(this.consume().text);if(this.peek(":"))for(b=[],d=[];this.expect(":");)b.push(this.expression());var f=[a].concat(b||[]);return l(function(f,g){var h=a(f,g);if(d){d[0]=h;for(var i=b.length;i--;)d[i+1]=b[i](f,g);return e.apply(c,d)}return e(h)},{constant:!e.$stateful&&f.every(Jb),inputs:!e.$stateful&&f})},expression:function(){return this.assignment()},assignment:function(){var a,b,c=this.ternary();return(b=this.expect("="))?(c.assign||this.throwError("implies assignment but ["+this.text.substring(0,b.index)+"] can not be assigned to",b),a=this.ternary(),l(function(b,d){return c.assign(b,a(b,d),d)},{inputs:[c,a]})):c},ternary:function(){var a,b,c=this.logicalOR();if((b=this.expect("?"))&&(a=this.assignment(),this.consume(":"))){var d=this.assignment();return l(function(b,e){return c(b,e)?a(b,e):d(b,e)},{constant:c.constant&&a.constant&&d.constant})}return c},logicalOR:function(){for(var a,b=this.logicalAND();a=this.expect("||");)b=this.binaryFn(b,a.text,this.logicalAND(),!0);return b},logicalAND:function(){for(var a,b=this.equality();a=this.expect("&&");)b=this.binaryFn(b,a.text,this.equality(),!0);return b},equality:function(){for(var a,b=this.relational();a=this.expect("==","!=","===","!==");)b=this.binaryFn(b,a.text,this.relational());return b},relational:function(){for(var a,b=this.additive();a=this.expect("<",">","<=",">=");)b=this.binaryFn(b,a.text,this.additive());return b},additive:function(){for(var a,b=this.multiplicative();a=this.expect("+","-");)b=this.binaryFn(b,a.text,this.multiplicative());return b},multiplicative:function(){for(var a,b=this.unary();a=this.expect("*","/","%");)b=this.binaryFn(b,a.text,this.unary());return b},unary:function(){var a;return this.expect("+")?this.primary():(a=this.expect("-"))?this.binaryFn(pe.ZERO,a.text,this.unary()):(a=this.expect("!"))?this.unaryFn(a.text,this.unary()):this.primary()},fieldAccess:function(a){var b=this.identifier();return l(function(d,e,f){var g=f||a(d,e);return null==g?c:b(g)},{assign:function(c,d,e){var f=a(c,e);return f||a.assign(c,f={},e),b.assign(f,d)}})},objectIndex:function(a){var b=this.text,d=this.expression();return this.consume("]"),l(function(e,f){var g,h=a(e,f),i=d(e,f);return Gb(i,b),h?g=Hb(h[i],b):c},{assign:function(c,e,f){var g=Gb(d(c,f),b),h=Hb(a(c,f),b);return h||a.assign(c,h={},f),h[g]=e}})},functionCall:function(a,b){var d=[];if(")"!==this.peekToken().text)do d.push(this.expression());while(this.expect(","));this.consume(")");var e=this.text,f=d.length?[]:null;return function(g,h){var i=b?b(g,h):s(b)?c:g,j=a(g,h,i)||o;if(f)for(var k=d.length;k--;)f[k]=Hb(d[k](g,h),e);Hb(i,e),Ib(j,e);var l=j.apply?j.apply(i,f):j(f[0],f[1],f[2],f[3],f[4]);return f&&(f.length=0),Hb(l,e)}},arrayDeclaration:function(){var a=[];if("]"!==this.peekToken().text)do{if(this.peek("]"))break;a.push(this.expression())}while(this.expect(","));return this.consume("]"),l(function(b,c){for(var d=[],e=0,f=a.length;f>e;e++)d.push(a[e](b,c));return d},{literal:!0,constant:a.every(Jb),inputs:a})},object:function(){var a=[],b=[];if("}"!==this.peekToken().text)do{if(this.peek("}"))break;var c=this.consume();c.constant?a.push(c.value):c.identifier?a.push(c.text):this.throwError("invalid key",c),this.consume(":"),b.push(this.expression())}while(this.expect(","));return this.consume("}"),l(function(c,d){for(var e={},f=0,g=b.length;g>f;f++)e[a[f]]=b[f](c,d);return e},{literal:!0,constant:b.every(Jb),inputs:b})}};var qe=ja(),re=ja(),se=Object.prototype.valueOf,te=d("$sce"),ue={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},Wd=d("$compile"),ve=b.createElement("a"),we=dc(a.location.href);gc.$inject=["$provide"],kc.$inject=["$locale"],lc.$inject=["$locale"];var xe=".",ye={yyyy:oc("FullYear",4),yy:oc("FullYear",2,0,!0),y:oc("FullYear",1),MMMM:pc("Month"),MMM:pc("Month",!0),MM:oc("Month",2,1),M:oc("Month",1,1),dd:oc("Date",2),d:oc("Date",1),HH:oc("Hours",2),H:oc("Hours",1),hh:oc("Hours",2,-12),h:oc("Hours",1,-12),mm:oc("Minutes",2),m:oc("Minutes",1),ss:oc("Seconds",2),s:oc("Seconds",1),sss:oc("Milliseconds",3),EEEE:pc("Day"),EEE:pc("Day",!0),a:uc,Z:qc,ww:tc(2),w:tc(1),G:vc,GG:vc,GGG:vc,GGGG:wc},ze=/((?:[^yMdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z|G+|w+))(.*)/,Ae=/^\-?\d+$/;xc.$inject=["$locale"];var Be=q(Wc),Ce=q(Yc);Ac.$inject=["$parse"];var De=q({restrict:"E",compile:function(a,b){return b.href||b.xlinkHref||b.name?void 0:function(a,b){if("a"===b[0].nodeName.toLowerCase()){var c="[object SVGAnimatedString]"===gd.call(b.prop("href"))?"xlink:href":"href";b.on("click",function(a){b.attr(c)||a.preventDefault()})}}}}),Ee={};f(Md,function(a,b){if("multiple"!=a){var c=$a("ng-"+b);Ee[c]=function(){return{restrict:"A",priority:100,link:function(a,d,e){a.$watch(e[c],function(a){e.$set(b,!!a)})}}}}}),f(Od,function(a,b){Ee[b]=function(){return{priority:100,link:function(a,c,d){if("ngPattern"===b&&"/"==d.ngPattern.charAt(0)){var e=d.ngPattern.match(Uc);if(e)return void d.$set("ngPattern",new RegExp(e[1],e[2]))}a.$watch(d[b],function(a){d.$set(b,a)})}}}}),f(["src","srcset","href"],function(a){var b=$a("ng-"+a);Ee[b]=function(){return{priority:99,link:function(c,d,e){var f=a,g=a;"href"===a&&"[object SVGAnimatedString]"===gd.call(d.prop("href"))&&(g="xlinkHref",e.$attr[g]="xlink:href",f=null),e.$observe(b,function(b){return b?(e.$set(g,b),void(_c&&f&&d.prop(f,e[g]))):void("href"===a&&e.$set(g,null))})}}}});var Fe={$addControl:o,$$renameControl:Cc,$removeControl:o,$setValidity:o,$setDirty:o,$setPristine:o,$setSubmitted:o},Ge="ng-submitted";Dc.$inject=["$element","$attrs","$scope","$animate","$interpolate"];var He=function(a){return["$timeout",function(b){var d={name:"form",restrict:a?"EAC":"E",controller:Dc,compile:function(d,e){d.addClass(of).addClass(mf);var f=e.name?"name":a&&e.ngForm?"ngForm":!1;return{pre:function(a,d,e,g){if(!("action"in e)){var h=function(b){a.$apply(function(){g.$commitViewValue(),g.$setSubmitted()}),b.preventDefault()};Ad(d[0],"submit",h),d.on("$destroy",function(){b(function(){Bd(d[0],"submit",h)},0,!1)})}var i=g.$$parentForm;f&&(Kb(a,null,g.$name,g,g.$name),e.$observe(f,function(b){g.$name!==b&&(Kb(a,null,g.$name,c,g.$name),i.$$renameControl(g,b),Kb(a,null,g.$name,g,g.$name))})),d.on("$destroy",function(){i.$removeControl(g),f&&Kb(a,null,e[f],c,g.$name),l(g,Fe)})}}}};return d}]},Ie=He(),Je=He(!0),Ke=/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z)/,Le=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,Me=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,Ne=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,Oe=/^(\d{4})-(\d{2})-(\d{2})$/,Pe=/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,Qe=/^(\d{4})-W(\d\d)$/,Re=/^(\d{4})-(\d\d)$/,Se=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,Te={text:Fc,date:Jc("date",Oe,Ic(Oe,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":Jc("datetimelocal",Pe,Ic(Pe,["yyyy","MM","dd","HH","mm","ss","sss"]),"yyyy-MM-ddTHH:mm:ss.sss"),time:Jc("time",Se,Ic(Se,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:Jc("week",Qe,Hc,"yyyy-Www"),month:Jc("month",Re,Ic(Re,["yyyy","MM"]),"yyyy-MM"),number:Lc,url:Mc,email:Nc,radio:Oc,checkbox:Qc,hidden:o,button:o,submit:o,reset:o,file:o},Ue=["$browser","$sniffer","$filter","$parse",function(a,b,c,d){return{restrict:"E",require:["?ngModel"],link:{pre:function(e,f,g,h){h[0]&&(Te[Wc(g.type)]||Te.text)(e,f,g,h[0],b,a,c,d)}}}}],Ve=/^(true|false|\d+)$/,We=function(){return{restrict:"A",priority:100,compile:function(a,b){return Ve.test(b.ngValue)?function(a,b,c){c.$set("value",a.$eval(c.ngValue))}:function(a,b,c){a.$watch(c.ngValue,function(a){c.$set("value",a)})}}}},Xe=["$compile",function(a){return{restrict:"AC",compile:function(b){return a.$$addBindingClass(b),function(b,d,e){a.$$addBindingInfo(d,e.ngBind),d=d[0],b.$watch(e.ngBind,function(a){d.textContent=a===c?"":a})}}}}],Ye=["$interpolate","$compile",function(a,b){return{compile:function(d){return b.$$addBindingClass(d),function(d,e,f){var g=a(e.attr(f.$attr.ngBindTemplate));b.$$addBindingInfo(e,g.expressions),e=e[0],f.$observe("ngBindTemplate",function(a){e.textContent=a===c?"":a})}}}}],Ze=["$sce","$parse","$compile",function(a,b,c){return{restrict:"A",compile:function(d,e){var f=b(e.ngBindHtml),g=b(e.ngBindHtml,function(a){return(a||"").toString()});return c.$$addBindingClass(d),function(b,d,e){c.$$addBindingInfo(d,e.ngBindHtml),b.$watch(g,function(){d.html(a.getTrustedHtml(f(b))||"")})}}}}],$e=q({restrict:"A",require:"ngModel",link:function(a,b,c,d){d.$viewChangeListeners.push(function(){a.$eval(c.ngChange)})}}),_e=Rc("",!0),af=Rc("Odd",0),bf=Rc("Even",1),cf=Bc({compile:function(a,b){b.$set("ngCloak",c),a.removeClass("ng-cloak")}}),df=[function(){return{restrict:"A",scope:!0,controller:"@",priority:500}}],ef={},ff={blur:!0,focus:!0};f("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(a){var b=$a("ng-"+a);ef[b]=["$parse","$rootScope",function(c,d){return{restrict:"A",compile:function(e,f){var g=c(f[b],null,!0);return function(b,c){c.on(a,function(c){var e=function(){g(b,{$event:c})};ff[a]&&d.$$phase?b.$evalAsync(e):b.$apply(e)})}}}}]});var gf=["$animate",function(a){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,d,e,f,g){var h,i,j;c.$watch(e.ngIf,function(c){c?i||g(function(c,f){i=f,c[c.length++]=b.createComment(" end ngIf: "+e.ngIf+" "),h={clone:c},a.enter(c,d.parent(),d)}):(j&&(j.remove(),j=null),i&&(i.$destroy(),i=null),h&&(j=ia(h.clone),a.leave(j).then(function(){j=null}),h=null))})}}}],hf=["$templateRequest","$anchorScroll","$animate","$sce",function(a,b,c,d){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:id.noop,compile:function(e,f){var g=f.ngInclude||f.src,h=f.onload||"",i=f.autoscroll;return function(e,f,j,k,l){var m,n,o,p=0,q=function(){n&&(n.remove(),n=null),m&&(m.$destroy(),m=null),o&&(c.leave(o).then(function(){n=null}),n=o,o=null)};e.$watch(d.parseAsResourceUrl(g),function(d){var g=function(){!s(i)||i&&!e.$eval(i)||b()},j=++p;d?(a(d,!0).then(function(a){if(j===p){var b=e.$new();k.template=a;var i=l(b,function(a){q(),c.enter(a,null,f).then(g)});m=b,o=i,m.$emit("$includeContentLoaded",d),e.$eval(h)}},function(){j===p&&(q(),e.$emit("$includeContentError",d))}),e.$emit("$includeContentRequested",d)):(q(),k.template=null)})}}}}],jf=["$compile",function(a){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(c,d,e,f){return/SVG/.test(d[0].toString())?(d.empty(),void a(sa(f.template,b).childNodes)(c,function(a){d.append(a)},{futureParentElement:d})):(d.html(f.template),void a(d.contents())(c))}}}],kf=Bc({priority:450,compile:function(){return{pre:function(a,b,c){a.$eval(c.ngInit)}}}}),lf=function(){return{restrict:"A",priority:100,require:"ngModel",link:function(a,b,d,e){var g=b.attr(d.$attr.ngList)||", ",h="false"!==d.ngTrim,i=h?md(g):g,j=function(a){if(!r(a)){var b=[];return a&&f(a.split(i),function(a){a&&b.push(h?md(a):a)}),b}};e.$parsers.push(j),e.$formatters.push(function(a){return ld(a)?a.join(g):c}),e.$isEmpty=function(a){return!a||!a.length}}}},mf="ng-valid",nf="ng-invalid",of="ng-pristine",pf="ng-dirty",qf="ng-untouched",rf="ng-touched",sf="ng-pending",tf=new d("ngModel"),uf=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate","$timeout","$rootScope","$q","$interpolate",function(a,b,d,e,g,h,i,j,k,l){this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$$rawModelValue=c,this.$validators={},this.$asyncValidators={},this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$untouched=!0,this.$touched=!1,this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$error={},this.$$success={},this.$pending=c,this.$name=l(d.name||"",!1)(a);var m,n=g(d.ngModel),p=n.assign,q=n,t=p,u=null,w=this;this.$$setOptions=function(a){if(w.$options=a,a&&a.getterSetter){var b=g(d.ngModel+"()"),c=g(d.ngModel+"($$$p)");q=function(a){var c=n(a);return x(c)&&(c=b(a)),c},t=function(a,b){x(n(a))?c(a,{$$$p:w.$modelValue}):p(a,w.$modelValue)}}else if(!n.assign)throw tf("nonassign","Expression '{0}' is non-assignable. Element: {1}",d.ngModel,T(e))},this.$render=o,this.$isEmpty=function(a){return r(a)||""===a||null===a||a!==a};var y=e.inheritedData("$formController")||Fe,z=0;Sc({ctrl:this,$element:e,set:function(a,b){a[b]=!0},unset:function(a,b){delete a[b]},parentForm:y,$animate:h}),this.$setPristine=function(){w.$dirty=!1,w.$pristine=!0,h.removeClass(e,pf),h.addClass(e,of)},this.$setDirty=function(){w.$dirty=!0,w.$pristine=!1,h.removeClass(e,of),h.addClass(e,pf),y.$setDirty()},this.$setUntouched=function(){w.$touched=!1,w.$untouched=!0,h.setClass(e,qf,rf)},this.$setTouched=function(){w.$touched=!0,w.$untouched=!1,h.setClass(e,rf,qf)},this.$rollbackViewValue=function(){i.cancel(u),w.$viewValue=w.$$lastCommittedViewValue,w.$render()},this.$validate=function(){if(!v(w.$modelValue)||!isNaN(w.$modelValue)){var a=w.$$lastCommittedViewValue,b=w.$$rawModelValue,d=w.$valid,e=w.$modelValue,f=w.$options&&w.$options.allowInvalid;w.$$runValidators(b,a,function(a){f||d===a||(w.$modelValue=a?b:c,w.$modelValue!==e&&w.$$writeModelToScope())})}},this.$$runValidators=function(a,b,d){function e(){var a=w.$$parserName||"parse";return m!==c?(m||(f(w.$validators,function(a,b){i(b,null)}),f(w.$asyncValidators,function(a,b){i(b,null)})),i(a,m),m):(i(a,null),!0)}function g(){var c=!0;return f(w.$validators,function(d,e){var f=d(a,b);c=c&&f,i(e,f)}),c?!0:(f(w.$asyncValidators,function(a,b){i(b,null)}),!1)}function h(){var d=[],e=!0;f(w.$asyncValidators,function(f,g){var h=f(a,b);if(!F(h))throw tf("$asyncValidators","Expected asynchronous validator to return a promise but got '{0}' instead.",h);i(g,c),d.push(h.then(function(){i(g,!0)},function(a){e=!1,i(g,!1)}))}),d.length?k.all(d).then(function(){j(e)},o):j(!0)}function i(a,b){l===z&&w.$setValidity(a,b)}function j(a){l===z&&d(a)}z++;var l=z;return e()&&g()?void h():void j(!1)},this.$commitViewValue=function(){var a=w.$viewValue;i.cancel(u),(w.$$lastCommittedViewValue!==a||""===a&&w.$$hasNativeValidators)&&(w.$$lastCommittedViewValue=a,w.$pristine&&this.$setDirty(),this.$$parseAndValidate())},this.$$parseAndValidate=function(){function b(){w.$modelValue!==g&&w.$$writeModelToScope()}var d=w.$$lastCommittedViewValue,e=d;if(m=r(e)?c:!0)for(var f=0;f<w.$parsers.length;f++)if(e=w.$parsers[f](e),r(e)){m=!1;break}v(w.$modelValue)&&isNaN(w.$modelValue)&&(w.$modelValue=q(a));var g=w.$modelValue,h=w.$options&&w.$options.allowInvalid;w.$$rawModelValue=e,h&&(w.$modelValue=e,b()),w.$$runValidators(e,w.$$lastCommittedViewValue,function(a){h||(w.$modelValue=a?e:c,b())})},this.$$writeModelToScope=function(){t(a,w.$modelValue),f(w.$viewChangeListeners,function(a){try{a()}catch(c){b(c)}})},this.$setViewValue=function(a,b){w.$viewValue=a,(!w.$options||w.$options.updateOnDefault)&&w.$$debounceViewValueCommit(b)},this.$$debounceViewValueCommit=function(b){var c,d=0,e=w.$options;e&&s(e.debounce)&&(c=e.debounce,v(c)?d=c:v(c[b])?d=c[b]:v(c["default"])&&(d=c["default"])),i.cancel(u),d?u=i(function(){w.$commitViewValue()},d):j.$$phase?w.$commitViewValue():a.$apply(function(){w.$commitViewValue()})},a.$watch(function(){var b=q(a);if(b!==w.$modelValue){w.$modelValue=w.$$rawModelValue=b,m=c;for(var d=w.$formatters,e=d.length,f=b;e--;)f=d[e](f);w.$viewValue!==f&&(w.$viewValue=w.$$lastCommittedViewValue=f,w.$render(),w.$$runValidators(b,f,o))}return b})}],vf=["$rootScope",function(a){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:uf,priority:1,compile:function(b){return b.addClass(of).addClass(qf).addClass(mf),{pre:function(a,b,c,d){var e=d[0],f=d[1]||Fe;e.$$setOptions(d[2]&&d[2].$options),f.$addControl(e),c.$observe("name",function(a){e.$name!==a&&f.$$renameControl(e,a)}),a.$on("$destroy",function(){f.$removeControl(e)})},post:function(b,c,d,e){var f=e[0];f.$options&&f.$options.updateOn&&c.on(f.$options.updateOn,function(a){f.$$debounceViewValueCommit(a&&a.type)}),c.on("blur",function(c){f.$touched||(a.$$phase?b.$evalAsync(f.$setTouched):b.$apply(f.$setTouched))})}}}}}],wf=/(\s+|^)default(\s+|$)/,xf=function(){return{restrict:"A",controller:["$scope","$attrs",function(a,b){var d=this;this.$options=a.$eval(b.ngModelOptions),this.$options.updateOn!==c?(this.$options.updateOnDefault=!1,this.$options.updateOn=md(this.$options.updateOn.replace(wf,function(){return d.$options.updateOnDefault=!0," "}))):this.$options.updateOnDefault=!0}]}},yf=Bc({terminal:!0,priority:1e3}),zf=["$locale","$interpolate",function(a,b){var c=/{}/g,d=/^when(Minus)?(.+)$/;return{restrict:"EA",link:function(e,g,h){function i(a){g.text(a||"")}var j,k=h.count,l=h.$attr.when&&g.attr(h.$attr.when),m=h.offset||0,n=e.$eval(l)||{},o={},p=b.startSymbol(),q=b.endSymbol(),r=p+k+"-"+m+q,s=id.noop;f(h,function(a,b){var c=d.exec(b);if(c){var e=(c[1]?"-":"")+Wc(c[2]);n[e]=g.attr(h.$attr[b])}}),f(n,function(a,d){o[d]=b(a.replace(c,r))}),e.$watch(k,function(b){var c=parseFloat(b),d=isNaN(c);d||c in n||(c=a.pluralCat(c-m)),c===j||d&&isNaN(j)||(s(),s=e.$watch(o[c],i),j=c)})}}}],Af=["$parse","$animate",function(a,g){var h="$$NG_REMOVED",i=d("ngRepeat"),j=function(a,b,c,d,e,f,g){a[c]=d,e&&(a[e]=f),a.$index=b,a.$first=0===b,a.$last=b===g-1,a.$middle=!(a.$first||a.$last),a.$odd=!(a.$even=0===(1&b))},k=function(a){return a.clone[0]},l=function(a){return a.clone[a.clone.length-1]};return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,compile:function(d,m){var n=m.ngRepeat,o=b.createComment(" end ngRepeat: "+n+" "),p=n.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!p)throw i("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",n);var q=p[1],r=p[2],s=p[3],t=p[4];if(p=q.match(/^(?:(\s*[\$\w]+)|\(\s*([\$\w]+)\s*,\s*([\$\w]+)\s*\))$/),!p)throw i("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",q);var u=p[3]||p[1],v=p[2];if(s&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(s)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent|\$root|\$id)$/.test(s)))throw i("badident","alias '{0}' is invalid --- must be a valid JS identifier which is not a reserved name.",s);var w,x,y,z,A={$id:Oa};return t?w=a(t):(y=function(a,b){return Oa(b)},z=function(a){return a}),function(a,b,d,m,p){w&&(x=function(b,c,d){return v&&(A[v]=b),A[u]=c,A.$index=d,w(a,A)});var q=ja();a.$watchCollection(r,function(d){var m,r,t,w,A,B,C,D,E,F,G,H,I=b[0],J=ja();if(s&&(a[s]=d),e(d))E=d,D=x||y;else{D=x||z,E=[];for(var K in d)d.hasOwnProperty(K)&&"$"!=K.charAt(0)&&E.push(K);E.sort()}for(w=E.length,G=new Array(w),m=0;w>m;m++)if(A=d===E?m:E[m],B=d[A],C=D(A,B,m),q[C])F=q[C],delete q[C],J[C]=F,G[m]=F;else{if(J[C])throw f(G,function(a){a&&a.scope&&(q[a.id]=a)}),i("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}, Duplicate value: {2}",n,C,B);G[m]={id:C,scope:c,clone:c},J[C]=!0}for(var L in q){if(F=q[L],H=ia(F.clone),g.leave(H),H[0].parentNode)for(m=0,r=H.length;r>m;m++)H[m][h]=!0;F.scope.$destroy()}for(m=0;w>m;m++)if(A=d===E?m:E[m],B=d[A],F=G[m],F.scope){t=I;do t=t.nextSibling;while(t&&t[h]);k(F)!=t&&g.move(ia(F.clone),null,ad(I)),I=l(F),j(F.scope,m,u,B,v,A,w)}else p(function(a,b){F.scope=b;var c=o.cloneNode(!1);a[a.length++]=c,g.enter(a,null,ad(I)),I=c,F.clone=a,J[F.id]=F,j(F.scope,m,u,B,v,A,w)});q=J})}}}}],Bf="ng-hide",Cf="ng-hide-animate",Df=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ngShow,function(b){a[b?"removeClass":"addClass"](c,Bf,{tempClasses:Cf})})}}}],Ef=["$animate",function(a){return{restrict:"A",multiElement:!0,link:function(b,c,d){b.$watch(d.ngHide,function(b){a[b?"addClass":"removeClass"](c,Bf,{tempClasses:Cf})})}}}],Ff=Bc(function(a,b,c){a.$watchCollection(c.ngStyle,function(a,c){c&&a!==c&&f(c,function(a,c){b.css(c,"")}),a&&b.css(a)})}),Gf=["$animate",function(a){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(c,d,e,g){var h=e.ngSwitch||e.on,i=[],j=[],k=[],l=[],m=function(a,b){return function(){a.splice(b,1)}};c.$watch(h,function(c){var d,e;for(d=0,e=k.length;e>d;++d)a.cancel(k[d]);for(k.length=0,d=0,e=l.length;e>d;++d){var h=ia(j[d].clone);l[d].$destroy();var n=k[d]=a.leave(h);n.then(m(k,d))}j.length=0,l.length=0,(i=g.cases["!"+c]||g.cases["?"])&&f(i,function(c){c.transclude(function(d,e){l.push(e);var f=c.element;d[d.length++]=b.createComment(" end ngSwitchWhen: ");var g={clone:d};j.push(g),a.enter(d,f.parent(),f)})})})}}}],Hf=Bc({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,b,c,d,e){d.cases["!"+c.ngSwitchWhen]=d.cases["!"+c.ngSwitchWhen]||[],d.cases["!"+c.ngSwitchWhen].push({transclude:e,element:b})}}),If=Bc({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(a,b,c,d,e){d.cases["?"]=d.cases["?"]||[],d.cases["?"].push({transclude:e,element:b})}}),Jf=Bc({restrict:"EAC",link:function(a,b,c,e,f){if(!f)throw d("ngTransclude")("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",T(b));f(function(a){b.empty(),b.append(a)})}}),Kf=["$templateCache",function(a){return{restrict:"E",terminal:!0,compile:function(b,c){if("text/ng-template"==c.type){var d=c.id,e=b[0].text;a.put(d,e)}}}}],Lf=d("ngOptions"),Mf=q({restrict:"A",terminal:!0}),Nf=["$compile","$parse",function(a,d){var e=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,h={$setViewValue:o};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(a,b,c){var d,e,f=this,g={},i=h;f.databound=c.ngModel,f.init=function(a,b,c){i=a,d=b,e=c},f.addOption=function(b,c){ga(b,'"option value"'),g[b]=!0,i.$viewValue==b&&(a.val(b),e.parent()&&e.remove()),c&&c[0].hasAttribute("selected")&&(c[0].selected=!0)},f.removeOption=function(a){this.hasOption(a)&&(delete g[a],i.$viewValue===a&&this.renderUnknownOption(a))},f.renderUnknownOption=function(b){var c="? "+Oa(b)+" ?";e.val(c),a.prepend(e),a.val(c),e.prop("selected",!0)},f.hasOption=function(a){return g.hasOwnProperty(a)},b.$on("$destroy",function(){f.renderUnknownOption=o})}],link:function(h,i,j,k){function l(a,b,c,d){c.$render=function(){var a=c.$viewValue;d.hasOption(a)?(z.parent()&&z.remove(),b.val(a),""===a&&o.prop("selected",!0)):r(a)&&o?b.val(""):d.renderUnknownOption(a)},b.on("change",function(){a.$apply(function(){z.parent()&&z.remove(),c.$setViewValue(b.val())})})}function m(a,b,c){var d;c.$render=function(){var a=new Pa(c.$viewValue);f(b.find("option"),function(b){b.selected=s(a.get(b.value))})},a.$watch(function(){M(d,c.$viewValue)||(d=L(c.$viewValue),c.$render())}),b.on("change",function(){a.$apply(function(){var a=[];f(b.find("option"),function(b){b.selected&&a.push(b.value)}),c.$setViewValue(a)})})}function n(b,h,i){function j(a,c,d){return M[B]=d,E&&(M[E]=c),a(b,M)}function k(){b.$apply(function(){var a,c=H(b)||[];if(t)a=[],f(h.val(),function(b){b=J?K[b]:b,a.push(l(b,c[b]))});else{var d=J?K[h.val()]:h.val();a=l(d,c[d])}i.$setViewValue(a),r()})}function l(a,b){if("?"===a)return c;if(""===a)return null;var d=D?D:G;return j(d,a,b)}function m(){var a,c=H(b);if(c&&ld(c)){a=new Array(c.length);for(var d=0,e=c.length;e>d;d++)a[d]=j(A,d,c[d]);return a}if(c){a={};for(var f in c)c.hasOwnProperty(f)&&(a[f]=j(A,f,c[f]))}return a}function n(a){
var b;if(t)if(J&&ld(a)){b=new Pa([]);for(var c=0;c<a.length;c++)b.put(j(J,null,a[c]),!0)}else b=new Pa(a);else J&&(a=j(J,null,a));return function(c,d){var e;return e=J?J:D?D:G,t?s(b.remove(j(e,c,d))):a===j(e,c,d)}}function o(){w||(b.$$postDigest(r),w=!0)}function q(a,b,c){a[b]=a[b]||0,a[b]+=c?1:-1}function r(){w=!1;var a,c,d,e,k,l,m,o,r,u,z,B,C,D,G,I,N,O={"":[]},P=[""],Q=i.$viewValue,R=H(b)||[],S=E?g(R):R,T={},U=n(Q),V=!1;for(K={},B=0;u=S.length,u>B;B++)m=B,E&&(m=S[B],"$"===m.charAt(0))||(o=R[m],a=j(F,m,o)||"",(c=O[a])||(c=O[a]=[],P.push(a)),C=U(m,o),V=V||C,I=j(A,m,o),I=s(I)?I:"",N=J?J(b,M):E?S[B]:B,J&&(K[N]=m),c.push({id:N,label:I,selected:C}));for(t||(v||null===Q?O[""].unshift({id:"",label:"",selected:!V}):V||O[""].unshift({id:"?",label:"",selected:!0})),z=0,r=P.length;r>z;z++){for(a=P[z],c=O[a],L.length<=z?(e={element:y.clone().attr("label",a),label:c.label},k=[e],L.push(k),h.append(e.element)):(k=L[z],e=k[0],e.label!=a&&e.element.attr("label",e.label=a)),D=null,B=0,u=c.length;u>B;B++)d=c[B],(l=k[B+1])?(D=l.element,l.label!==d.label&&(q(T,l.label,!1),q(T,d.label,!0),D.text(l.label=d.label),D.prop("label",l.label)),l.id!==d.id&&D.val(l.id=d.id),D[0].selected!==d.selected&&(D.prop("selected",l.selected=d.selected),_c&&D.prop("selected",l.selected))):(""===d.id&&v?G=v:(G=x.clone()).val(d.id).prop("selected",d.selected).attr("selected",d.selected).prop("label",d.label).text(d.label),k.push(l={element:G,label:d.label,id:d.id,selected:d.selected}),q(T,d.label,!0),D?D.after(G):e.element.append(G),D=G);for(B++;k.length>B;)d=k.pop(),q(T,d.label,!1),d.element.remove()}for(;L.length>z;){for(c=L.pop(),B=1;B<c.length;++B)q(T,c[B].label,!1);c[0].element.remove()}f(T,function(a,b){a>0?p.addOption(b):0>a&&p.removeOption(b)})}var z;if(!(z=u.match(e)))throw Lf("iexp","Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_' but got '{0}'. Element: {1}",u,T(h));var A=d(z[2]||z[1]),B=z[4]||z[6],C=/ as /.test(z[0])&&z[1],D=C?d(C):null,E=z[5],F=d(z[3]||""),G=d(z[2]?z[1]:B),H=d(z[7]),I=z[8],J=I?d(z[8]):null,K={},L=[[{element:h,label:""}]],M={};v&&(a(v)(b),v.removeClass("ng-scope"),v.remove()),h.empty(),h.on("change",k),i.$render=r,b.$watchCollection(H,o),b.$watchCollection(m,o),t&&b.$watchCollection(function(){return i.$modelValue},o)}if(k[1]){for(var o,p=k[0],q=k[1],t=j.multiple,u=j.ngOptions,v=!1,w=!1,x=ad(b.createElement("option")),y=ad(b.createElement("optgroup")),z=x.clone(),A=0,B=i.children(),C=B.length;C>A;A++)if(""===B[A].value){o=v=B.eq(A);break}p.init(q,v,z),t&&(q.$isEmpty=function(a){return!a||0===a.length}),u?n(h,i,q):t?m(h,i,q):l(h,i,q,p)}}}}],Of=["$interpolate",function(a){var b={addOption:o,removeOption:o};return{restrict:"E",priority:100,compile:function(c,d){if(r(d.value)){var e=a(c.text(),!0);e||d.$set("value",c.text())}return function(a,c,d){var f="$selectController",g=c.parent(),h=g.data(f)||g.parent().data(f);h&&h.databound||(h=b),e?a.$watch(e,function(a,b){d.$set("value",a),b!==a&&h.removeOption(b),h.addOption(a,c)}):h.addOption(d.value,c),c.on("$destroy",function(){h.removeOption(d.value)})}}}}],Pf=q({restrict:"E",terminal:!1}),Qf=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(c.required=!0,d.$validators.required=function(a,b){return!c.required||!d.$isEmpty(b)},c.$observe("required",function(){d.$validate()}))}}},Rf=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,e,f){if(f){var g,h=e.ngPattern||e.pattern;e.$observe("pattern",function(a){if(u(a)&&a.length>0&&(a=new RegExp("^"+a+"$")),a&&!a.test)throw d("ngPattern")("noregexp","Expected {0} to be a RegExp but was {1}. Element: {2}",h,a,T(b));g=a||c,f.$validate()}),f.$validators.pattern=function(a){return f.$isEmpty(a)||r(g)||g.test(a)}}}}},Sf=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var e=-1;c.$observe("maxlength",function(a){var b=m(a);e=isNaN(b)?-1:b,d.$validate()}),d.$validators.maxlength=function(a,b){return 0>e||d.$isEmpty(b)||b.length<=e}}}}},Tf=function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){var e=0;c.$observe("minlength",function(a){e=m(a)||0,d.$validate()}),d.$validators.minlength=function(a,b){return d.$isEmpty(b)||b.length>=e}}}}};a.angular.bootstrap||(da(),na(id),ad(b).ready(function(){$(b,_)}))}(window,document),!window.angular.$$csp()&&window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}</style>'),define("angular",function(a){return function(){var b;return b||a.angular}}(this)),function(a,b){"use strict";function c(a,b){var c,d;b=b||{},a="raven"+a.substr(0,1).toUpperCase()+a.substr(1),document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(a,!0,!0)):(c=document.createEventObject(),c.eventType=a);for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);if(document.createEvent)document.dispatchEvent(c);else try{document.fireEvent("on"+c.eventType.toLowerCase(),c)}catch(e){}}function d(a){this.name="RavenConfigError",this.message=a}function e(a){var b=O.exec(a),c={},e=7;try{for(;e--;)c[N[e]]=b[e]||""}catch(f){throw new d("Invalid DSN: "+a)}if(c.pass)throw new d("Do not specify your private key in the DSN!");return c}function f(a){return"undefined"==typeof a}function g(a){return"function"==typeof a}function h(a){return"string"==typeof a}function i(a){for(var b in a)return!1;return!0}function j(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function k(a,b){var c,d;if(f(a.length))for(c in a)a.hasOwnProperty(c)&&b.call(null,c,a[c]);else if(d=a.length)for(c=0;d>c;c++)b.call(null,c,a[c])}function l(){I="?sentry_version=4&sentry_client=raven-js/"+M.VERSION+"&sentry_key="+G}function m(a,b){var d=[];a.stack&&a.stack.length&&k(a.stack,function(a,b){var c=n(b);c&&d.push(c)}),c("handle",{stackInfo:a,options:b}),p(a.name,a.message,a.url,a.lineno,d,b)}function n(a){if(a.url){var b,c={filename:a.url,lineno:a.line,colno:a.column,"function":a.func||"?"},d=o(a);if(d){var e=["pre_context","context_line","post_context"];for(b=3;b--;)c[e[b]]=d[b]}return c.in_app=!(!L.includePaths.test(c.filename)||/(Raven|TraceKit)\./.test(c["function"])||/raven\.(min\.)js$/.test(c.filename)),c}}function o(a){if(a.context&&L.fetchContext){for(var b=a.context,c=~~(b.length/2),d=b.length,e=!1;d--;)if(b[d].length>300){e=!0;break}if(e){if(f(a.column))return;return[[],b[c].substr(a.column,50),[]]}return[b.slice(0,c),b[c],b.slice(c+1)]}}function p(a,b,c,d,e,f){var g,h;b+="",("Error"!==a||b)&&(L.ignoreErrors.test(b)||(e&&e.length?(c=e[0].filename||c,e.reverse(),g={frames:e}):c&&(g={frames:[{filename:c,lineno:d,in_app:!0}]}),b=r(b,100),L.ignoreUrls&&L.ignoreUrls.test(c)||(!L.whitelistUrls||L.whitelistUrls.test(c))&&(h=d?b+" at "+d:b,t(q({exception:{type:a,value:b},stacktrace:g,culprit:c,message:h},f)))))}function q(a,b){return b?(k(b,function(b,c){a[b]=c}),a):a}function r(a,b){return a.length<=b?a:a.substr(0,b)+"…"}function s(){var a={url:document.location.href,headers:{"User-Agent":navigator.userAgent}};return document.referrer&&(a.headers.Referer=document.referrer),a}function t(a){v()&&(a=q({project:H,logger:L.logger,site:L.site,platform:"javascript",request:s()},a),a.tags=q(L.tags,a.tags),a.extra=q(L.extra,a.extra),i(a.tags)&&delete a.tags,i(a.extra)&&delete a.extra,F&&(a.user=F),g(L.dataCallback)&&(a=L.dataCallback(a)),(!g(L.shouldSendCallback)||L.shouldSendCallback(a))&&(D=a.event_id||(a.event_id=x()),u(a)))}function u(a){var b=new Image,d=E+I+"&sentry_data="+encodeURIComponent(JSON.stringify(a));b.onload=function(){c("success",{data:a,src:d})},b.onerror=b.onabort=function(){c("failure",{data:a,src:d})},b.src=d}function v(){return K?E?!0:(a.console&&console.error,!1):!1}function w(a){for(var b,c=[],d=0,e=a.length;e>d;d++)b=a[d],h(b)?c.push(b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):b&&b.source&&c.push(b.source);return new RegExp(c.join("|"),"i")}function x(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function y(){var b=a.RavenConfig;b&&M.config(b.dsn,b.config).install()}var z={remoteFetching:!1,collectWindowErrors:!0,linesOfContext:7},A=[].slice,B="?";z.wrap=function(a){function b(){try{return a.apply(this,arguments)}catch(b){throw z.report(b),b}}return b},z.report=function(){function c(a){h(),o.push(a)}function d(a){for(var b=o.length-1;b>=0;--b)o[b]===a&&o.splice(b,1)}function e(){i(),o=[]}function f(a,b){var c=null;if(!b||z.collectWindowErrors){for(var d in o)if(j(o,d))try{o[d].apply(null,[a].concat(A.call(arguments,2)))}catch(e){c=e}if(c)throw c}}function g(a,b,c,d,e){var g=null;if(r)z.computeStackTrace.augmentStackTraceWithInitialElement(r,b,c,a),k();else if(e)g=z.computeStackTrace(e),f(g,!0);else{var h={url:b,line:c,column:d};h.func=z.computeStackTrace.guessFunctionName(h.url,h.line),h.context=z.computeStackTrace.gatherContext(h.url,h.line),g={message:a,url:document.location.href,stack:[h]},f(g,!0)}return m?m.apply(this,arguments):!1}function h(){n||(m=a.onerror,a.onerror=g,n=!0)}function i(){n&&(a.onerror=m,n=!1,m=b)}function k(){var a=r,b=p;p=null,r=null,q=null,f.apply(null,[a,!1].concat(b))}function l(b,c){var d=A.call(arguments,1);if(r){if(q===b)return;k()}var e=z.computeStackTrace(b);if(r=e,q=b,p=d,a.setTimeout(function(){q===b&&k()},e.incomplete?2e3:0),c!==!1)throw b}var m,n,o=[],p=null,q=null,r=null;return l.subscribe=c,l.unsubscribe=d,l.uninstall=e,l}(),z.computeStackTrace=function(){function b(b){if(!z.remoteFetching)return"";try{var c=function(){try{return new a.XMLHttpRequest}catch(b){return new a.ActiveXObject("Microsoft.XMLHTTP")}},d=c();return d.open("GET",b,!1),d.send(""),d.responseText}catch(e){return""}}function c(a){if(!h(a))return[];if(!j(v,a)){var c="";-1!==a.indexOf(document.domain)&&(c=b(a)),v[a]=c?c.split("\n"):[]}return v[a]}function d(a,b){var d,e=/function ([^(]*)\(([^)]*)\)/,g=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,h="",i=10,j=c(a);if(!j.length)return B;for(var k=0;i>k;++k)if(h=j[b-k]+h,!f(h)){if(d=g.exec(h))return d[1];if(d=e.exec(h))return d[1]}return B}function e(a,b){var d=c(a);if(!d.length)return null;var e=[],g=Math.floor(z.linesOfContext/2),h=g+z.linesOfContext%2,i=Math.max(0,b-g-1),j=Math.min(d.length,b+h-1);b-=1;for(var k=i;j>k;++k)f(d[k])||e.push(d[k]);return e.length>0?e:null}function g(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function i(a){return g(a).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function k(a,b){for(var d,e,f=0,g=b.length;g>f;++f)if((d=c(b[f])).length&&(d=d.join("\n"),e=a.exec(d)))return{url:b[f],line:d.substring(0,e.index).split("\n").length,column:e.index-d.lastIndexOf("\n",e.index)-1};return null}function l(a,b,d){var e,f=c(b),h=new RegExp("\\b"+g(a)+"\\b");return d-=1,f&&f.length>d&&(e=h.exec(f[d]))?e.index:null}function m(b){for(var c,d,e,f,h=[a.location.href],j=document.getElementsByTagName("script"),l=""+b,m=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,n=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,o=0;o<j.length;++o){var p=j[o];p.src&&h.push(p.src)}if(e=m.exec(l)){var q=e[1]?"\\s+"+e[1]:"",r=e[2].split(",").join("\\s*,\\s*");c=g(e[3]).replace(/;$/,";?"),d=new RegExp("function"+q+"\\s*\\(\\s*"+r+"\\s*\\)\\s*{\\s*"+c+"\\s*}")}else d=new RegExp(g(l).replace(/\s+/g,"\\s+"));if(f=k(d,h))return f;if(e=n.exec(l)){var s=e[1];if(c=i(e[2]),d=new RegExp("on"+s+"=[\\'\"]\\s*"+c+"\\s*[\\'\"]","i"),f=k(d,h[0]))return f;if(d=new RegExp(c),f=k(d,h))return f}return null}function n(a){if(!a.stack)return null;for(var b,c,g=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|https?):.*?):(\d+)(?::(\d+))?\)?\s*$/i,h=/^\s*(\S*)(?:\((.*?)\))?@((?:file|https?).*?):(\d+)(?::(\d+))?\s*$/i,i=a.stack.split("\n"),j=[],k=/^(.*) is undefined$/.exec(a.message),m=0,n=i.length;n>m;++m){if(b=h.exec(i[m]))c={url:b[3],func:b[1]||B,args:b[2]?b[2].split(","):"",line:+b[4],column:b[5]?+b[5]:null};else{if(!(b=g.exec(i[m])))continue;c={url:b[2],func:b[1]||B,line:+b[3],column:b[4]?+b[4]:null}}!c.func&&c.line&&(c.func=d(c.url,c.line)),c.line&&(c.context=e(c.url,c.line)),j.push(c)}return j.length?(j[0].line&&!j[0].column&&k?j[0].column=l(k[1],j[0].url,j[0].line):j[0].column||f(a.columnNumber)||(j[0].column=a.columnNumber+1),{name:a.name,message:a.message,url:document.location.href,stack:j}):null}function o(a){for(var b,c=a.stacktrace,f=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,g=c.split("\n"),h=[],i=0,j=g.length;j>i;i+=2)if(b=f.exec(g[i])){var k={line:+b[1],column:+b[2],func:b[3]||b[4],args:b[5]?b[5].split(","):[],url:b[6]};if(!k.func&&k.line&&(k.func=d(k.url,k.line)),k.line)try{k.context=e(k.url,k.line)}catch(l){}k.context||(k.context=[g[i+1]]),h.push(k)}return h.length?{name:a.name,message:a.message,url:document.location.href,stack:h}:null}function p(b){var f=b.message.split("\n");if(f.length<4)return null;var g,h,l,m,n=/^\s*Line (\d+) of linked script ((?:file|https?)\S+)(?:: in function (\S+))?\s*$/i,o=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?)\S+)(?:: in function (\S+))?\s*$/i,p=/^\s*Line (\d+) of function script\s*$/i,q=[],r=document.getElementsByTagName("script"),s=[];for(h in r)j(r,h)&&!r[h].src&&s.push(r[h]);for(h=2,l=f.length;l>h;h+=2){var t=null;if(g=n.exec(f[h]))t={url:g[2],func:g[3],line:+g[1]};else if(g=o.exec(f[h])){t={url:g[3],func:g[4]};var u=+g[1],v=s[g[2]-1];if(v&&(m=c(t.url))){m=m.join("\n");var w=m.indexOf(v.innerText);w>=0&&(t.line=u+m.substring(0,w).split("\n").length)}}else if(g=p.exec(f[h])){var x=a.location.href.replace(/#.*$/,""),y=g[1],z=new RegExp(i(f[h+1]));m=k(z,[x]),t={url:x,line:m?m.line:y,func:""}}if(t){t.func||(t.func=d(t.url,t.line));var A=e(t.url,t.line),B=A?A[Math.floor(A.length/2)]:null;A&&B.replace(/^\s*/,"")===f[h+1].replace(/^\s*/,"")?t.context=A:t.context=[f[h+1]],q.push(t)}}return q.length?{name:b.name,message:f[0],url:document.location.href,stack:q}:null}function q(a,b,c,f){var g={url:b,line:c};if(g.url&&g.line){a.incomplete=!1,g.func||(g.func=d(g.url,g.line)),g.context||(g.context=e(g.url,g.line));var h=/ '([^']+)' /.exec(f);if(h&&(g.column=l(h[1],g.url,g.line)),a.stack.length>0&&a.stack[0].url===g.url){if(a.stack[0].line===g.line)return!1;if(!a.stack[0].line&&a.stack[0].func===g.func)return a.stack[0].line=g.line,a.stack[0].context=g.context,!1}return a.stack.unshift(g),a.partial=!0,!0}return a.incomplete=!0,!1}function r(a,b){for(var c,e,f,g=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,h=[],i={},j=!1,k=r.caller;k&&!j;k=k.caller)if(k!==s&&k!==z.report){if(e={url:null,func:B,line:null,column:null},k.name?e.func=k.name:(c=g.exec(k.toString()))&&(e.func=c[1]),f=m(k)){e.url=f.url,e.line=f.line,e.func===B&&(e.func=d(e.url,e.line));var n=/ '([^']+)' /.exec(a.message||a.description);n&&(e.column=l(n[1],f.url,f.line))}i[""+k]?j=!0:i[""+k]=!0,h.push(e)}b&&h.splice(0,b);var o={name:a.name,message:a.message,url:document.location.href,stack:h};return q(o,a.sourceURL||a.fileName,a.line||a.lineNumber,a.message||a.description),o}function s(a,b){var c=null;b=null==b?0:+b;try{if(c=o(a))return c}catch(d){if(u)throw d}try{if(c=n(a))return c}catch(d){if(u)throw d}try{if(c=p(a))return c}catch(d){if(u)throw d}try{if(c=r(a,b+1))return c}catch(d){if(u)throw d}return{}}function t(a){a=(null==a?0:+a)+1;try{throw new Error}catch(b){return s(b,a+1)}}var u=!1,v={};return s.augmentStackTraceWithInitialElement=q,s.guessFunctionName=d,s.gatherContext=e,s.ofCaller=t,s}();var C,D,E,F,G,H,I,J=a.Raven,K=!(!a.JSON||!a.JSON.stringify),L={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],collectWindowErrors:!0,tags:{},extra:{}},M={VERSION:"1.1.15",noConflict:function(){return a.Raven=J,M},config:function(a,b){if(!a)return M;var c=e(a),d=c.path.lastIndexOf("/"),f=c.path.substr(1,d);return b&&k(b,function(a,b){L[a]=b}),L.ignoreErrors.push("Script error."),L.ignoreErrors.push("Script error"),L.ignoreErrors=w(L.ignoreErrors),L.ignoreUrls=L.ignoreUrls.length?w(L.ignoreUrls):!1,L.whitelistUrls=L.whitelistUrls.length?w(L.whitelistUrls):!1,L.includePaths=w(L.includePaths),G=c.user,H=c.path.substr(d+1),E="//"+c.host+(c.port?":"+c.port:"")+"/"+f+"api/"+H+"/store/",c.protocol&&(E=c.protocol+":"+E),L.fetchContext&&(z.remoteFetching=!0),L.linesOfContext&&(z.linesOfContext=L.linesOfContext),z.collectWindowErrors=!!L.collectWindowErrors,l(),M},install:function(){return v()&&z.report.subscribe(m),M},context:function(a,c,d){return g(a)&&(d=c||[],c=a,a=b),M.wrap(a,c).apply(this,d)},wrap:function(a,c){function d(){for(var b=[],d=arguments.length,e=!a||a&&a.deep!==!1;d--;)b[d]=e?M.wrap(a,arguments[d]):arguments[d];try{return c.apply(this,b)}catch(f){throw M.captureException(f,a),f}}if(f(c)&&!g(a))return a;if(g(a)&&(c=a,a=b),!g(c))return c;if(c.__raven__)return c;for(var e in c)c.hasOwnProperty(e)&&(d[e]=c[e]);return d.__raven__=!0,d.__inner__=c,d},uninstall:function(){return z.report.uninstall(),M},captureException:function(a,b){if(!(a instanceof Error))return M.captureMessage(a,b);C=a;try{z.report(a,b)}catch(c){if(a!==c)throw c}return M},captureMessage:function(a,b){return t(q({message:a+""},b)),M},setUser:function(a){return F=a,M},lastException:function(){return C},lastEventId:function(){return D}},N="source protocol user pass host port path".split(" "),O=/^(?:(\w+):)?\/\/(\w+)(:\w+)?@([\w\.-]+)(?::(\d+))?(\/.*)/;d.prototype=new Error,d.prototype.constructor=d,y(),a.Raven=M,"function"==typeof define&&define.amd&&define("raven",[],function(){return M})}(this),define("app",["angular"],function(a){return a.module("twx",["ipCookie","textAngular","cfp.hotkeys"])}),define("conf/conf",[],function(){var a=function(a){var b="dev",c="prod",d="",e=["/bin/",".bin"];return a.ENV=window.build&&"DEV"!==window.build.number?c:b,a.DEV=a.ENV===b,a.PROD=a.ENV===c,a.PORTAL_BAR_ENABLED=!0,a.TOOLTIPS=!0,a.SENTRY="https://21ef858ee7ea40a68abc71b7b6cd6995@sentry2-events.innogames.de/14",a.SENTRY_ENABLED=!(!window.build||!window.build.sentry_enabled),a.DEBUG=!0,a.IMG="img/",a.MARKET=window.build&&window.build.market||"dev",a.setMapName=function(a){a&&(d=a)},a.getMapPath=function(){if(!d)throw new Error("No map file!!");return e.join(d)},a.SOUND_JSON_PATH="/json/sounds.json",a.MAP_TILES_JSON_PATH=["/json/tiles-",".json"],a.ANIMATION_LIST_PATH="/json/animation-list.json",a.DEV_ANIMATION_JSON_PATH=["/json/animations/",".json"],a.PROD_ANIMATION_JSON_PATH="/json/animations.json",a.RANDOM_ANIMATION_SETS=!0,a.VILLAGE_ASSETS_JSON_PATH=["/json/village-assets-",".json"],a.VILLAGE_ASSET_PATH="/img/village/",a.TILESIZE=function(a,b,c){var d=[[0,c],[0,b-c],[a/2,b],[a,b-c],[a,c],[a/2,0]];return{x:a,halfX:a>>1,y:b,halfY:b>>1,tri:c,off:1-c/b,shape:d,maxVertDistance:Math.sqrt(Math.max.apply(Math,d.map(function(a,b,c,d,e){return b=++b%c.length,(d=a[0]-c[b][0])*d+(e=a[1]-c[b][1])*e})))}}(136,98,23),a.MAP_SIZE=1e3,a.TILE_COUNT=Math.pow(a.MAP_SIZE,2),a.BITS_IN_TILE=5,a.BITS_IN_TILE_PER_BYTE=a.BITS_IN_TILE/8,a.MAP_CHUNK_SIZE=25,a.MAP_REQUESTS_PER_SECOND=1,a.BG_WIDTH=2703,a.BG_HEIGHT=1908,a.SHOW_CLICK_AREAS=!1,a.VILLAGE_SCALE=Math.max(a.TILESIZE.x/a.BG_WIDTH,a.TILESIZE.y/a.BG_HEIGHT),a.BUILDING_LABEL_OFFSET={x:-65,y:87},a.ZOOM={MIN:.35,MAP_MAX:1,MAX:1/a.VILLAGE_SCALE,TIMEOUT:350},a.ZOOM_STEPS={MAP_MAX:4,MAX:9},a.DEFAULT_FRAME_DURATION=83,a.TICK=500,a.LOADING_TIMEOUT=1e4,a.REGISTRATION_ENABLED=!0,a.KINETIC=!0,a.SAFE_FRAME_OFFSET=100,a.FUNKY=!1,a.TILES=!0,a.RIVERS=!0,a.ZOOM_FACTOR=function(a){return.35*(1-1/(7>a?Math.pow(5*a/(10-a),2)+1:1/0))},a.SOCKET_KEY="msg",a.SOCKET_DEBUG=!0,a.TEMPLATE_PATH_EXT=["/templates/",".html"],a.DIRECTIVE_TEMPLATE_PATH_EXT=["/templates/directives/",".html"],a.I18N_PATH_EXT=["/lang/",a.DEV?".jsont":".json"],a.L10N_PATH_EXT=["/js/locale/locale-",".js"],a.features=null,a.csDiff=0,a.AUTOCOMPLETE_AMOUNT=5,a.VILLAGE_LOCATOR_ALPHA=.4,a.VILLAGE_LEVELS=[299,999,2999,8999,10999,1/0],a.IOS_APP_NAME="tribalwars2",a.DEFAULT_PAGINATION_LIMITS=[25,50,75,100],a.HOST=null,a.MAINTENANCE=!1,a.MAX_MERCHANTS=235,a.RESERVED_VILLAGE_IDS={RESOURCE_DEPOSIT:-1,INVITE_A_FRIEND:-2,SECOND_VILLAGE:-3},a.ALL_MARKETS=["en","de","br","pl","nl","fr","ru","us","es","it","gr","tr","cz","pt","se","no","dk","fi","sk","ro","hu","ar"],a.MAX_TRIBE_LEVEL=60,a.HIGH_LEVEL_TRIBE_CREST=3,a.NO_TRIBE_CREST=0,a}({});return a}),define("conf/cdn",[],function(){return{ENABLED:!0,host:"https://twxbr.innogamescdn.com",versionMap:{"/templates/boosts.html":"06edaa9ee3","/templates/building_academy.html":"2caa86fad6","/templates/building_barracks.html":"b4191e47ed","/templates/building_chapel.html":"5a45904c71","/templates/building_church.html":"3063bb8007","/templates/building_clay_pit.html":"ad422738cd","/templates/building_farm.html":"9cd3909036","/templates/building_fortress.html":"b08383844c","/templates/building_gods_house.html":"610797eb1c","/templates/building_headquarter.html":"0e41686608","/templates/building_headquarter_card_available.html":"e37ba7cf33","/templates/building_headquarter_card_unavailable.html":"ac1f6a8ee6","/templates/building_headquarter_queue.html":"c8b9929620","/templates/building_hospital.html":"68a3f5f02b","/templates/building_iron_mine.html":"94155d2257","/templates/building_market.html":"35514bc0eb","/templates/building_market_merchant_status.html":"7d6282e1a1","/templates/building_market_npc_tab.html":"3aca53ecc5","/templates/building_preceptory.html":"5709decd71","/templates/building_preceptory_recruit_order.html":"984433a20a","/templates/building_preceptory_select_order.html":"a39fe8fc26","/templates/building_preceptory_thieves_order.html":"a5d78b4e03","/templates/building_rally_point.html":"ded84a07dd","/templates/building_resources.html":"40455d257c","/templates/building_snippet_header.html":"70a1f17c40","/templates/building_snippet_not_researched.html":"40702e1e91","/templates/building_snippet_not_researched_as_main.html":"389be0d6e5","/templates/building_statue.html":"fd82f9bf48","/templates/building_tavern.html":"b755ca5d11","/templates/building_timber_camp.html":"efa8dd16fb","/templates/building_wall.html":"cce5674b13","/templates/building_warehouse.html":"e7a059192a","/templates/buildinglabel.html":"1227f2bc5f","/templates/character-selection.html":"8da509e84a","/templates/components/component-box-wood.html":"2ad843ac7b","/templates/components/component-bubble.html":"403500cd0f","/templates/components/component-frame.html":"a21be8beaf","/templates/components/component-interface.html":"c0be6762d1","/templates/components/component-ornament-modal.html":"f3ae7b28a5","/templates/components/component-rad-edge.html":"03c63380c8","/templates/components/component-torn-paper.html":"04aeb602e7","/templates/context_menu.html":"638578d991","/templates/directives/autocomplete.html":"6cf4197ac8","/templates/directives/contentSliderItemViews/quest.html":"9d274e4a82","/templates/directives/content_slider.html":"fd9517ebe7","/templates/directives/message.html":"6763846985","/templates/directives/pagination.html":"333a4053d6","/templates/directives/premium_button.html":"9287674178","/templates/directives/range_slider.html":"987df0a7ed","/templates/directives/researches.html":"8998852db3","/templates/directives/rich_text_editor.html":"24fbf84641","/templates/directives/rich_text_editor_menu.html":"bff5487646","/templates/directives/rich_text_editor_menus/rich_text_editor_menu_building.html":"4c36b817f5","/templates/directives/rich_text_editor_menus/rich_text_editor_menu_color.html":"92097a2ae5","/templates/directives/rich_text_editor_menus/rich_text_editor_menu_link.html":"db82f2005e","/templates/directives/rich_text_editor_menus/rich_text_editor_menu_size.html":"2d0ef86ea5","/templates/directives/rich_text_editor_menus/rich_text_editor_menu_spoiler.html":"782d24b810","/templates/directives/rich_text_editor_menus/rich_text_editor_menu_unit.html":"363537a6c4","/templates/directives/rich_text_report.html":"a3f95d9a6d","/templates/directives/rich_text_spoiler.html":"feb598a893","/templates/directives/select.html":"5444186e66","/templates/directives/select_element.html":"3d88114978","/templates/directives/slot_machine.html":"c2adfb646a","/templates/directives/switch_slider.html":"9a08aa8317","/templates/directives/unit_operate_sliders.html":"3badb0dfb3","/templates/directives/unit_screen_table.html":"9714d5a851","/templates/directives/world_map_search.html":"3388b309bb","/templates/interface.bottom.html":"9dbf425b07","/templates/interface.building_queue.html":"a01616e7d3","/templates/interface.character_selection.html":"178339fc59","/templates/interface.chat.html":"e25800f07e","/templates/interface.global_information.html":"b66c770422","/templates/interface.hotkeys.html":"7e61236ea2","/templates/interface.icon_animations.html":"599100c219","/templates/interface.movement_menu.html":"32b3b7ebdc","/templates/interface.quests.html":"d5165e0586","/templates/interface.recruiting_queue.html":"0afde68236","/templates/interface.timeline.html":"f903cf0e98","/templates/interface.top.html":"412c0fc310","/templates/interface.validate_mail.html":"b5a27ca76e","/templates/landing/mobile-invite.html":"e976fb5dbb","/templates/landing_notification.html":"472a1b1c26","/templates/maintenance.html":"f37c36158f","/templates/map_bubble.html":"7766a64876","/templates/message_list.html":"228f0ad225","/templates/message_screen.html":"aaef3b05ad","/templates/message_view.html":"8d2f4f4eda","/templates/modal_add_contacts_to_conversation.html":"3f6bfb44f5","/templates/modal_add_coop_partner.html":"4fdaf4fe44","/templates/modal_application_text.html":"fb9adbe6b2","/templates/modal_attention.html":"a85bb141be","/templates/modal_barbarian_boost.html":"836589fdba","/templates/modal_building_info.html":"85191bf1f6","/templates/modal_coin_info.html":"eaea7d95d5","/templates/modal_confirm_daily_unit_deal.html":"ea288a4218","/templates/modal_create_forum.html":"5bef5e43ef","/templates/modal_custom_army.html":"523ca5f269","/templates/modal_daily_login_bonus.html":"3f4c025acf","/templates/modal_donate_resources.html":"b7fda45809","/templates/modal_donation_ranking.html":"9ce3d507f3","/templates/modal_edit_rights.html":"858132e1df","/templates/modal_edit_welcome_message.html":"0f22fe5bfc","/templates/modal_enter_key.html":"fb945ce7b8","/templates/modal_establish_village.html":"dc5ce2a4e5","/templates/modal_found_tribe.html":"9da7b030e7","/templates/modal_friendlist.html":"f7d5f6b9c5","/templates/modal_game_over.html":"45946e7c34","/templates/modal_groups_index.html":"dcf9c12a70","/templates/modal_icon_generator.html":"a3594fd9f9","/templates/modal_improve_skill.html":"57c354bf85","/templates/modal_interstitial.html":"eae5c05fdb","/templates/modal_invite_friend.html":"e0c46c4411","/templates/modal_invite_player.html":"fd1029c877","/templates/modal_item_info.html":"3301ecb158","/templates/modal_landing_banned.html":"d24fefa44d","/templates/modal_landing_enter_key.html":"1a94b9f2b7","/templates/modal_landing_invite.html":"8223cf6d86","/templates/modal_landing_pw.html":"d51db0a730","/templates/modal_landing_registration_success.html":"3a9807b667","/templates/modal_landing_world_selection.html":"c897609d1c","/templates/modal_load_preset_list.html":"7aae3ebdd5","/templates/modal_mass_donation.html":"92bc9dccb6","/templates/modal_more_tribe_information.html":"26f565b1a3","/templates/modal_officer_info.html":"8306189cbd","/templates/modal_order_info.html":"cf99c2276f","/templates/modal_packet_offer.html":"6ae0b29232","/templates/modal_participants_list.html":"4bbcaf8e14","/templates/modal_payment.html":"a8dd5ea555","/templates/modal_player_banned.html":"ee9ee41ed0","/templates/modal_premium.html":"906891dd5f","/templates/modal_preset_buy_officer.html":"dd1286971d","/templates/modal_preset_content.html":"5e5fbfde9b","/templates/modal_preset_edit.html":"43db71b550","/templates/modal_preset_name.html":"1ad1bef96b","/templates/modal_profile_icon.html":"9aab6031f5","/templates/modal_quest_line.html":"6548ebc566","/templates/modal_recruit_management.html":"855ee07588","/templates/modal_relocate_paladin.html":"1f0867bad8","/templates/modal_rename_command.html":"174c68b670","/templates/modal_rename_forum.html":"4cf5efd75b","/templates/modal_rename_paladin.html":"927450f1a7","/templates/modal_rename_province.html":"0220666c28","/templates/modal_rename_thread.html":"6e28982b1d","/templates/modal_rename_village.html":"1d583f194d","/templates/modal_research.html":"0bebd050f8","/templates/modal_reset_order.html":"49e92f7b7c","/templates/modal_reward_full.html":"ebff08f42b","/templates/modal_right_management.html":"507035a646","/templates/modal_save_preset.html":"4b0d01f7e2","/templates/modal_select_achievements.html":"1510f47edf","/templates/modal_select_kingdom.html":"37d6da36f8","/templates/modal_select_order.html":"37d3897cc7","/templates/modal_select_title.html":"f8df518756","/templates/modal_select_units.html":"86b50707b1","/templates/modal_send_preset.html":"1171834e93","/templates/modal_send_resources.html":"e2b4955a5c","/templates/modal_send_spies.html":"70c8be9bf9","/templates/modal_set_founder.html":"fd4e3f7821","/templates/modal_show_hotkeys.html":"b08d8f9772","/templates/modal_socket.html":"3d9d6bf54b","/templates/modal_support_warning.html":"535bea4a7b","/templates/modal_technology_camouflage.html":"60d76f5ede","/templates/modal_technology_dummies.html":"a5a774831e","/templates/modal_technology_switch_weapons.html":"9731180854","/templates/modal_tribe_forum_thread_move.html":"3a7923340d","/templates/modal_tribe_relation.html":"a252d1b47c","/templates/modal_tribe_settings.html":"49f1cf8b0c","/templates/modal_unit_info.html":"c331a5695e","/templates/modal_upgrade.html":"ff2a14b0e3","/templates/modal_use_item.html":"fac9ea2808","/templates/modal_validate_mail.html":"2b66d6f715","/templates/modal_withdraw_all_units.html":"3e56fb58f2","/templates/modal_withdraw_part_units.html":"aeeeb977c7","/templates/modal_write_tribe_application.html":"bcab70fe40","/templates/overview/screen_overview.html":"362564be2e","/templates/overview/screen_overview_column_character.html":"d412430db2","/templates/overview/screen_overview_column_command_type.html":"0540c8ae9a","/templates/overview/screen_overview_column_groups.html":"0b31e6ca97","/templates/overview/screen_overview_column_resource.html":"014217bd94","/templates/overview/screen_overview_column_village.html":"f86b3f6d97","/templates/overview/screen_overview_commands.html":"26dd56f0a8","/templates/overview/screen_overview_incoming.html":"5d678ce9df","/templates/overview/screen_overview_no_data.html":"efe026ae8c","/templates/overview/screen_overview_thead.html":"67d756ec1b","/templates/overview/screen_overview_units.html":"0539f57809","/templates/overview/screen_overview_villages.html":"f7f8a0f98d","/templates/quest_goals.html":"ce62d856d0","/templates/quest_rewards.html":"5fdc421686","/templates/queues/queue_item.html":"e996db7043","/templates/queues/queue_item_academy.html":"04c31915ed","/templates/queues/queue_item_statue.html":"e741bc87e8","/templates/queues/queue_item_tavern.html":"b735a8dcb0","/templates/report.html":"47619b2ebb","/templates/report_list.html":"bc0401a06a","/templates/reports/invitation_reward.html":"4aadbbd99a","/templates/reports/invitee_joined.html":"8a2b1f8c88","/templates/reports/loot_master_building_upgrade.html":"07e9696390","/templates/reports/premium_currency_change.html":"b0a61eb32c","/templates/reports/tribe/application_accepted.html":"66c912758b","/templates/reports/tribe/application_created.html":"9a7de58bd9","/templates/reports/tribe/application_rejected.html":"04100883b8","/templates/reports/tribe/disbanded.html":"3b4516e430","/templates/reports/tribe/founder_changed.html":"16ffcc79f9","/templates/reports/tribe/invitation.html":"f2960b674e","/templates/reports/tribe/invitation_aborted.html":"13c4587e65","/templates/reports/tribe/invitation_accepted.html":"83c6bbb645","/templates/reports/tribe/invitation_rejected.html":"41e566b6a3",
"/templates/reports/tribe/member_kicked.html":"fb337ff200","/templates/screen_achievements.html":"95fc8de1e5","/templates/screen_character_info.html":"78fc288ad5","/templates/screen_character_management.html":"69a8ff2422","/templates/screen_devtools.html":"bf1a303f36","/templates/screen_inventory.html":"3c4e701861","/templates/screen_no_tribe.html":"79e9b108b2","/templates/screen_province.html":"ecdd087c4a","/templates/screen_ranking.html":"39a3b05db9","/templates/screen_report_achievement.html":"dec43de673","/templates/screen_report_battle.html":"26411aa8bc","/templates/screen_report_battle_details.html":"bda2d431ff","/templates/screen_report_battle_prevented.html":"1888d9f6dd","/templates/screen_report_battle_specials.html":"69681412db","/templates/screen_report_battle_support.html":"3c5904c10b","/templates/screen_report_paladin_item.html":"d6a0aef867","/templates/screen_report_spy.html":"b0e174a35e","/templates/screen_report_spy_details.html":"9917d0b0c5","/templates/screen_report_support.html":"b98edd7a45","/templates/screen_report_trade_accepted.html":"55bc2d0511","/templates/screen_report_transport.html":"7d1c6af7ee","/templates/screen_resource_deposit.html":"ca6b8b41ef","/templates/screen_second_village.html":"283a75d0e0","/templates/screen_settings.html":"3b779607e2","/templates/screen_settings_account.html":"db1371d0b9","/templates/screen_settings_game.html":"214f715509","/templates/screen_settings_mobile.html":"2782a260c6","/templates/screen_settings_support.html":"7560a921f9","/templates/screen_shop.html":"fe996036cb","/templates/screen_tribe.html":"5c9ac1517f","/templates/screen_tribe_diplomacy.html":"65b74172e3","/templates/screen_tribe_forum.html":"79ad7f0b99","/templates/screen_tribe_forum_admin.html":"e105882c5a","/templates/screen_tribe_forum_create_post.html":"30601f962e","/templates/screen_tribe_forum_create_thread.html":"2e3a15ce2e","/templates/screen_tribe_forum_forum_list.html":"5ebe77d680","/templates/screen_tribe_forum_read_thread.html":"c6c76f4012","/templates/screen_tribe_forum_thread_list.html":"1208494035","/templates/screen_tribe_memberlist.html":"a9a5447fd0","/templates/screen_tribe_news.html":"c17d7ac048","/templates/screen_tribe_noble.html":"327cec4a9e","/templates/screen_tribe_profile.html":"7214376f6d","/templates/screen_tribe_quests.html":"d35262daa6","/templates/screen_tribe_skills.html":"3c6527f50b","/templates/screen_tribe_wars.html":"d35262daa6","/templates/screen_unit_overview.html":"12c3af7473","/templates/screen_village_info.html":"b3d777b31c","/templates/screen_village_info_command.html":"96ff336ac6","/templates/shop_offers.html":"c845dacc29","/templates/test/screen_test_rich_text.html":"29f32cf17f","/templates/tooltip/building_construction.html":"6351b56843","/templates/tooltip/building_construction_requirements.html":"f1bdd85646","/templates/tooltip/counter_measures.html":"2d533af0d7","/templates/tooltip/food_resource_info.html":"8690176534","/templates/tooltip/interface_quest.html":"56704c147f","/templates/tooltip/officer_info.html":"ee6c474152","/templates/tooltip/quest_reward.html":"33813eb920","/templates/tooltip/resource_info.html":"848825d161","/templates/tooltip_map.html":"ad7d26a11c","/templates/tribe_skill_donation_progress.html":"54dd2bd086","/templates/tutorial/tutorial.html":"cbffcd68d4","/templates/tutorial/tutorial_00.html":"585b8454d9","/templates/tutorial/tutorial_01.html":"05c3a7e30d","/templates/tutorial/tutorial_02.html":"0d5c9ce109","/templates/tutorial/tutorial_03.html":"b48f24cf60","/templates/tutorial/tutorial_04.html":"6b0fad1d13","/templates/tutorial/tutorial_05.html":"87e94c1e29","/templates/tutorial/tutorial_06.html":"21b0e33bf3","/templates/tutorial/tutorial_07.html":"af30aa423e","/templates/tutorial/tutorial_08.html":"e5de22c3f1","/templates/tutorial/tutorial_09.html":"6ebadd01f4","/templates/tutorial/tutorial_10.html":"cf56e45ff5","/templates/tutorial/tutorial_11.html":"c004f48153","/templates/tutorial/tutorial_12.html":"5498cb09f1","/templates/tutorial/tutorial_13.html":"4fbc2ea741","/templates/tutorial/tutorial_14.html":"6e8dcff49d","/templates/tutorial/tutorial_15.html":"6a07ddd13e","/templates/tutorial/tutorial_16.html":"6cfb2dd75b","/templates/tutorial/tutorial_17.html":"e4926d9fb5","/templates/tutorial/tutorial_18.html":"e5ee6f0cf9","/templates/tutorial/tutorial_19.html":"61178c5444","/templates/tutorial/tutorial_20.html":"497bb21251","/templates/tutorial/tutorial_21.html":"673ebbbf08","/templates/tutorial/tutorial_22.html":"6c1fe2c862","/templates/tutorial/tutorial_23.html":"f57ffb9f43","/templates/tutorial/tutorial_24.html":"3a504b9e08","/templates/tutorial/tutorial_25.html":"d93e8c609f","/templates/tutorial/tutorial_26.html":"af7ddb0ead","/templates/tutorial/tutorial_27.html":"9641947481","/templates/tutorial_highlight_interface.html":"003c8872af","/templates/tutorial_highlight_map.html":"b5ffcb98b2","/lang/branch.json":"76fe2f018f","/lang/cs_cz.json":"44f858e30f","/lang/da_dk.json":"bf71f8b524","/lang/de_de.json":"b00f3f236a","/lang/el_gr.json":"89337a18f9","/lang/en_dk.json":"0cfdf8adca","/lang/en_us.json":"a4700c2807","/lang/es_ar.json":"e5613fc982","/lang/es_es.json":"499422f79c","/lang/fi_fi.json":"b8ff2f47d8","/lang/fr_fr.json":"0968d6ac98","/lang/hu_hu.json":"15af850128","/lang/it_it.json":"376f76cfd4","/lang/nb_no.json":"dfdef6299d","/lang/nl_nl.json":"ccca153f3c","/lang/pl_pl.json":"01a2e7abb6","/lang/pt_br.json":"e7f702722d","/lang/pt_pt.json":"e5bacfd726","/lang/ref.json":"f9a19bd94d","/lang/ro_ro.json":"018a47275f","/lang/ru_ru.json":"926a837cf3","/lang/sk_sk.json":"01b3fb773e","/lang/sl_si.json":"9f75593ed1","/lang/sv_se.json":"8f89a79d98","/lang/tr_tr.json":"bfccf0da4a","/js/socket-worker.js":"63d5666b77","/js/locale/locale-branch.js":"b38076e87c","/js/locale/locale-cs_cz.js":"de92c0df7c","/js/locale/locale-da_dk.js":"e02238edbd","/js/locale/locale-de_de.js":"96052a1fbe","/js/locale/locale-default.js":"b38076e87c","/js/locale/locale-el_gr.js":"22c12de8d3","/js/locale/locale-en_dk.js":"b38076e87c","/js/locale/locale-en_us.js":"656c21a67a","/js/locale/locale-es_ar.js":"082fc76d4f","/js/locale/locale-es_es.js":"c1ab5371ae","/js/locale/locale-fi_fi.js":"7181805f6e","/js/locale/locale-fr_fr.js":"ab259922d2","/js/locale/locale-hu_hu.js":"f8a5315c1f","/js/locale/locale-it_it.js":"c33b1f7fb6","/js/locale/locale-nb_no.js":"4ed223458e","/js/locale/locale-nl_nl.js":"5a4c1bfddc","/js/locale/locale-pl_pl.js":"1fbe7fde6f","/js/locale/locale-pt_br.js":"6cc65e7cd0","/js/locale/locale-pt_pt.js":"f3ab1f9c02","/js/locale/locale-ro_ro.js":"541dc97539","/js/locale/locale-ru_ru.js":"cf6590149e","/js/locale/locale-sk_sk.js":"97a5be1138","/js/locale/locale-sl_si.js":"5d18e67d27","/js/locale/locale-sv_se.js":"793c6c2f74","/js/locale/locale-tr_tr.js":"9029eb74f1","/json/animation-list.json":"a0515fa72a","/json/animations.json":"80706c57b4","/json/sounds.json":"521a383133","/json/tiles-day.json":"b767681fe0","/json/tiles-night.json":"5cd6d8f5df","/json/village-assets-day.json":"01d5a6434c","/json/village-assets-night.json":"d18406cd35","/img/buildinglabel/sprite-inactive.png":"0dc8d77fff","/img/buildinglabel/sprite.png":"59e5e9481b","/img/buildings/barracks/jackpot_stars.png":"874837f152","/img/buildings/barracks/super_jackpot_stars.png":"8bf9863fa7","/img/buildings/barracks/unit_select_arrow.png":"8bb3c06076","/img/buttons/bg_max_level_bottom.jpg":"20859c246f","/img/buttons/bg_max_level_left.jpg":"22ff115db0","/img/buttons/bg_max_level_left_bottom.jpg":"053c8ffaf7","/img/buttons/bg_max_level_left_top.jpg":"5715259ce2","/img/buttons/bg_max_level_middle.jpg":"7652c4b12d","/img/buttons/bg_max_level_right.jpg":"3a864cd915","/img/buttons/bg_max_level_right_bottom.jpg":"d8d8b6e3d4","/img/buttons/bg_max_level_right_top.jpg":"0f0d6bf72a","/img/buttons/bg_max_level_top.jpg":"93c302e9bb","/img/character-management/arrow-curve-left.png":"b79bb7f6e5","/img/character-management/arrow-curve-right.png":"4fe2843386","/img/character-management/arrow-horizontal.png":"6a8e531efc","/img/character-management/arrow-vertical.png":"09e5520959","/img/character-management/arrow.png":"8965e16734","/img/character-management/indicator-offline.png":"7597430bd6","/img/character-management/indicator-online.png":"de601d4ae4","/img/compass.jpg":"813e6f69cd","/img/components/box-wood/box-left.png":"71b0c03426","/img/components/box-wood/box-middle.png":"ccb1d78035","/img/components/box-wood/box-right.png":"9248b3de51","/img/components/box-wood/gold-left.png":"fc2567b2c4","/img/components/box-wood/gold-middle.png":"51c89ee06b","/img/components/box-wood/gold-right.png":"b45d17001f","/img/components/box-wood/headline-left.png":"4b4ca57b3e","/img/components/box-wood/headline-middle.png":"69d8383807","/img/components/box-wood/headline-right.png":"b0521549c9","/img/components/bubble/center.png":"4eb0e688f1","/img/components/bubble/corner.png":"7fed644bb2","/img/components/bubble/deco-top.png":"35ed0ac71b","/img/components/bubble/horizontal-middle.png":"52d7af9222","/img/components/bubble/pointer-left.png":"30c0535de5","/img/components/bubble/vertical-middle.png":"62a230b5b5","/img/components/frame/border-gold-bottom-left.png":"54a709dd4d","/img/components/frame/border-gold-bottom-middle.png":"c55c310d69","/img/components/frame/border-gold-bottom-right.png":"142af3f47a","/img/components/frame/border-gold-middle-left.png":"47623a50ba","/img/components/frame/border-gold-middle-right.png":"233be8ea73","/img/components/frame/border-gold-top-left.png":"0cffe34db1","/img/components/frame/border-gold-top-middle.png":"f57bab08b4","/img/components/frame/border-gold-top-right.png":"73a1039b85","/img/components/frame/border-wood-bottom-left.png":"701521fd5f","/img/components/frame/border-wood-bottom-middle.png":"65b8e6fc32","/img/components/frame/border-wood-bottom-right.png":"bbbd467a98","/img/components/frame/border-wood-middle-left.png":"25e1f4e046","/img/components/frame/border-wood-middle-right.png":"12fc7d1cc6","/img/components/frame/border-wood-top-left.png":"57557c3703","/img/components/frame/border-wood-top-middle.png":"641e6615b7","/img/components/frame/border-wood-top-right.png":"8f7238b14c","/img/components/frame/dual-recruiting-bg.png":"f0d32f782c","/img/components/gold-slot/border-image.png":"05976b9ef8","/img/components/interface/border_corner.png":"8bd9d26194","/img/components/interface/border_horizontal.png":"99089bc3d9","/img/components/interface/border_vertical.png":"1e6e2bba00","/img/components/interface/deco_corner.png":"24e0c954da","/img/components/rad-edge/bottom.png":"edcf401f7a","/img/components/rad-edge/middle.png":"44a46598fe","/img/components/rad-edge/top.png":"ae4da7ad54","/img/components/torn-paper/board-deco-left.png":"a56c419ff1","/img/components/torn-paper/board.png":"9898768ede","/img/components/torn-paper/bottom-left.png":"0d97825636","/img/components/torn-paper/bottom-middle.png":"ea8889d079","/img/components/torn-paper/bottom-right.png":"2708a59cb8","/img/components/torn-paper/left.png":"362c19980a","/img/components/torn-paper/reward-board.png":"09587d8399","/img/components/torn-paper/right.png":"dae5b2d7d3","/img/components/torn-paper/rivets.png":"2b48e11bfe","/img/components/torn-paper/separator.png":"aaf1b804f5","/img/components/torn-paper/top-left-connector.png":"896295aadf","/img/components/torn-paper/top-left.png":"3d29cf1783","/img/components/torn-paper/top-middle.png":"575634f02b","/img/components/torn-paper/top-right-connector.png":"9f3a98734f","/img/components/torn-paper/top-right.png":"def478600c","/img/cursor/grab.cur":"2f3d87651f","/img/cursor/grab.png":"316307e973","/img/cursor/grab_pushed.cur":"f44cd7232f","/img/cursor/grab_pushed.png":"de09db5956","/img/cursor/link.cur":"878ece13d7","/img/cursor/link.png":"29e49d7643","/img/cursor/link_pushed.cur":"3f2394d16e","/img/cursor/link_pushed.png":"905c32cd52","/img/cursor/normal.cur":"1f58f6235f","/img/cursor/normal.png":"15708def61","/img/cursor/normal_pushed.cur":"55cae5b0ce","/img/cursor/normal_pushed.png":"a92e5b98c1","/img/cursor/not_possible.cur":"f4623beab8","/img/cursor/not_possible.png":"554055fc1d","/img/cursor/write.cur":"c7f31f53d3","/img/cursor/write.png":"7ab7a97337","/img/daily-login-bonus/daily-reward-arrow.png":"c4c89a1cb3","/img/game_over.jpg":"8c614959d4","/img/hotkey/hotkey-active.png":"7f9dfd0040","/img/hotkey/hotkey-left.png":"c77f8f7c5b","/img/hotkey/hotkey-middle.png":"afedd5471d","/img/hotkey/hotkey-right.png":"bd7192050f","/img/icons/achievements/120x120/achievement-Punktekoenig.png":"f85c5596e2","/img/icons/achievements/120x120/achievement-achievement_points_milestone.png":"8d022e9f39","/img/icons/achievements/120x120/achievement-attack_daily.png":"c3aab2b317","/img/icons/achievements/120x120/achievement-attack_daily_tribe.png":"696a99f770","/img/icons/achievements/120x120/achievement-attack_weekly.png":"3f89b3cdef","/img/icons/achievements/120x120/achievement-attack_weekly_tribe.png":"08733afa45","/img/icons/achievements/120x120/achievement-bash_points_defense.png":"11dc2689b4","/img/icons/achievements/120x120/achievement-bash_points_milestone.png":"c3237cffd5","/img/icons/achievements/120x120/achievement-bash_points_offense.png":"6143c699b4","/img/icons/achievements/120x120/achievement-build_fortress_milestone_tribe.png":"ae2c8a4dea","/img/icons/achievements/120x120/achievement-building_levels_destroyed.png":"d7640540d2","/img/icons/achievements/120x120/achievement-conquered_daily.png":"55e18149fc","/img/icons/achievements/120x120/achievement-conquered_daily_tribe.png":"470e4bd8fd","/img/icons/achievements/120x120/achievement-conquered_weekly.png":"fff7a6760e","/img/icons/achievements/120x120/achievement-conquered_weekly_tribe.png":"6b640dc082","/img/icons/achievements/120x120/achievement-conquest_lucky.png":"fd6f247010","/img/icons/achievements/120x120/achievement-conquest_milestone.png":"28e399bc47","/img/icons/achievements/120x120/achievement-conquest_unlucky.png":"4dfca108ff","/img/icons/achievements/120x120/achievement-continent_owned_milestone_tribe.png":"eee07f48f4","/img/icons/achievements/120x120/achievement-coop_players.png":"d60821d2c5","/img/icons/achievements/120x120/achievement-defend_daily.png":"6ce5342f1d","/img/icons/achievements/120x120/achievement-defend_daily_tribe.png":"6413a41ba9","/img/icons/achievements/120x120/achievement-defend_weekly.png":"5fdf007a60","/img/icons/achievements/120x120/achievement-defend_weekly_tribe.png":"19e28ba21b","/img/icons/achievements/120x120/achievement-doppelsoeldner_outnumbered.png":"e726ad2417","/img/icons/achievements/120x120/achievement-early_defeat.png":"803800488b","/img/icons/achievements/120x120/achievement-first_attacks_made.png":"baba0faa2c","/img/icons/achievements/120x120/achievement-first_building_leveled_up.png":"2aa5355b7c","/img/icons/achievements/120x120/achievement-first_mixed_attack.png":"f47e103381","/img/icons/achievements/120x120/achievement-first_paladin_kill.png":"47ed0e208c","/img/icons/achievements/120x120/achievement-first_resource_production.png":"59256fb4e3","/img/icons/achievements/120x120/achievement-first_resources_spent.png":"46145474c8","/img/icons/achievements/120x120/achievement-first_units_killed.png":"c44f6eceac","/img/icons/achievements/120x120/achievement-first_units_recruited.png":"822f3eb195","/img/icons/achievements/120x120/achievement-fortress_built_milestone.png":"1165a356a6","/img/icons/achievements/120x120/achievement-huge_villages_owned.png":"5fb8644824","/img/icons/achievements/120x120/achievement-large_villages_owned.png":"ce258ae20c","/img/icons/achievements/120x120/achievement-level_two_churches_milestone.png":"0eb8e403d7","/img/icons/achievements/120x120/achievement-loot.png":"d1bd13b489","/img/icons/achievements/120x120/achievement-loot_daily.png":"63475ac690","/img/icons/achievements/120x120/achievement-loot_daily_tribe.png":"268d2d2bda","/img/icons/achievements/120x120/achievement-loot_weekly.png":"c1dc64af28","/img/icons/achievements/120x120/achievement-loot_weekly_tribe.png":"abb9841cc8","/img/icons/achievements/120x120/achievement-looted_village_daily.png":"55e64a795b","/img/icons/achievements/120x120/achievement-looted_village_daily_tribe.png":"88015817f7","/img/icons/achievements/120x120/achievement-looted_village_weekly.png":"0ef500e218","/img/icons/achievements/120x120/achievement-looted_village_weekly_tribe.png":"bf014d66f5","/img/icons/achievements/120x120/achievement-losses.png":"c2b6de7bc3","/img/icons/achievements/120x120/achievement-losses_support.png":"c38d24c406","/img/icons/achievements/120x120/achievement-major_battle_defense_outnumbered.png":"9e5f8b5a24","/img/icons/achievements/120x120/achievement-major_battle_perfect_defense.png":"d5f0cb714d","/img/icons/achievements/120x120/achievement-major_battles_supported.png":"6153083b26","/img/icons/achievements/120x120/achievement-major_battles_winning_streak.png":"999bfe50bd","/img/icons/achievements/120x120/achievement-major_battles_won.png":"8306f72dce","/img/icons/achievements/120x120/achievement-max_level_barracks.png":"030d65eb41","/img/icons/achievements/120x120/achievement-max_level_churches.png":"aa97b92101","/img/icons/achievements/120x120/achievement-max_level_farms.png":"53af55f98d","/img/icons/achievements/120x120/achievement-max_level_markets.png":"08ba79d4b6","/img/icons/achievements/120x120/achievement-max_level_preceptories.png":"a52b9035cf","/img/icons/achievements/120x120/achievement-max_level_resources.png":"4d3acf34f0","/img/icons/achievements/120x120/achievement-max_level_taverns.png":"38255b9c7d","/img/icons/achievements/120x120/achievement-max_level_walls.png":"7c7454f6af","/img/icons/achievements/120x120/achievement-minted_coins.png":"699a40afb6","/img/icons/achievements/120x120/achievement-most_battle_daily.png":"65cbd88b05","/img/icons/achievements/120x120/achievement-most_battle_daily_tribe.png":"d4acb83522","/img/icons/achievements/120x120/achievement-most_battle_weekly.png":"e5861e5b13","/img/icons/achievements/120x120/achievement-most_battle_weekly_tribe.png":"7fdfd037a1","/img/icons/achievements/120x120/achievement-overkill.png":"cad4023182","/img/icons/achievements/120x120/achievement-players_attacked_unique.png":"5147bbd192","/img/icons/achievements/120x120/achievement-points.png":"f85c5596e2","/img/icons/achievements/120x120/achievement-points_milestone_tribe.png":"3f96c17651","/img/icons/achievements/120x120/achievement-province_fully_owned_milestone.png":"383caee877","/img/icons/achievements/120x120/achievement-province_king_milestone.png":"62daed941a","/img/icons/achievements/120x120/achievement-provinces_owned_milestone_tribe.png":"b1514026c5","/img/icons/achievements/120x120/achievement-ranking_continent.png":"29c8c277f3","/img/icons/achievements/120x120/achievement-ranking_global.png":"1162b44795","/img/icons/achievements/120x120/achievement-recruited_cavalry.png":"94d37b754c","/img/icons/achievements/120x120/achievement-recruited_infantry.png":"1735b51e4f","/img/icons/achievements/120x120/achievement-recruited_siege_weapons.png":"e68942aa8e","/img/icons/achievements/120x120/achievement-resources_delivered.png":"391c421272","/img/icons/achievements/120x120/achievement-resources_traded_clay.png":"9b28694acb","/img/icons/achievements/120x120/achievement-resources_traded_iron.png":"d23c534d21","/img/icons/achievements/120x120/achievement-resources_traded_wood.png":"eb46657528","/img/icons/achievements/120x120/achievement-scouting_success.png":"b88e068b60","/img/icons/achievements/120x120/achievement-scouting_thwarted.png":"6070e7aea2","/img/icons/achievements/120x120/achievement-scouts_killed_attacker.png":"118f2d437a","/img/icons/achievements/120x120/achievement-scouts_killed_defender.png":"f744b7b402","/img/icons/achievements/120x120/achievement-self_attack.png":"8274118990","/img/icons/achievements/120x120/achievement-self_conquest.png":"d8a0024f54","/img/icons/achievements/120x120/achievement-snobs_killed.png":"f196a3b090","/img/icons/achievements/120x120/achievement-trades_completed.png":"0ebf9cf4f7","/img/icons/achievements/120x120/achievement-trades_completed_buyer.png":"4df2ff1d22","/img/icons/achievements/120x120/achievement-trades_completed_seller.png":"e32639cb3e","/img/icons/achievements/120x120/achievement-trebuchet_kills.png":"60a603df02","/img/icons/achievements/120x120/achievement-tribe_membership_days.png":"592773973d","/img/icons/achievements/120x120/achievement-units_killed_milestone_tribe.png":"6de0c6d425","/img/icons/achievements/120x120/achievement-village_conquered_milestone_tribe.png":"46c6a309a5","/img/icons/achievements/120x120/achievement-village_owned_milestone_tribe.png":"89ef2f909f","/img/icons/achievements/120x120/achievement-village_points.png":"9e90bb1d11","/img/icons/achievements/120x120/achievement-villages_conquered.png":"288c3cf2de","/img/icons/achievements/120x120/achievement-villages_conquered_per_hour.png":"4af7b32d20","/img/icons/achievements/120x120/achievement-villages_looted_unique.png":"9db90044dc","/img/icons/achievements/120x120/achievement-villages_lost_milestone.png":"18ecf9961a","/img/icons/achievements/120x120/achievement-wall_levels_destroyed.png":"85f827e416","/img/icons/achievements/90x90/achievement-achievement_points_milestone.png":"ee7ab0eaff","/img/icons/achievements/90x90/achievement-attack_daily.png":"4621b261ae","/img/icons/achievements/90x90/achievement-attack_daily_tribe.png":"d14e6779e2","/img/icons/achievements/90x90/achievement-attack_weekly.png":"906188c01d","/img/icons/achievements/90x90/achievement-attack_weekly_tribe.png":"781530f6e2","/img/icons/achievements/90x90/achievement-bash_points_defense.png":"7a7eef2786","/img/icons/achievements/90x90/achievement-bash_points_milestone.png":"9b7a5c1c1d","/img/icons/achievements/90x90/achievement-bash_points_offense.png":"63e8fcfd39","/img/icons/achievements/90x90/achievement-border.png":"9a9117a0a2","/img/icons/achievements/90x90/achievement-build_fortress_milestone_tribe.png":"0466b074ad","/img/icons/achievements/90x90/achievement-building_levels_destroyed.png":"49858f1a39","/img/icons/achievements/90x90/achievement-conquered_daily.png":"b33dfd56bd","/img/icons/achievements/90x90/achievement-conquered_daily_tribe.png":"a666f625c1","/img/icons/achievements/90x90/achievement-conquered_weekly.png":"3d642509f4","/img/icons/achievements/90x90/achievement-conquered_weekly_tribe.png":"46ad85bf69","/img/icons/achievements/90x90/achievement-conquest_lucky.png":"7a1fa73687","/img/icons/achievements/90x90/achievement-conquest_milestone.png":"a0a5c194ce","/img/icons/achievements/90x90/achievement-conquest_unlucky.png":"a02aa78ac8","/img/icons/achievements/90x90/achievement-continent_owned_milestone_tribe.png":"f1f37c2ed9","/img/icons/achievements/90x90/achievement-coop_players.png":"02062d4acf","/img/icons/achievements/90x90/achievement-defend_daily.png":"7ecd49af31","/img/icons/achievements/90x90/achievement-defend_daily_tribe.png":"4546a1a4f1","/img/icons/achievements/90x90/achievement-defend_weekly.png":"84596236b1","/img/icons/achievements/90x90/achievement-defend_weekly_tribe.png":"e5b9578477","/img/icons/achievements/90x90/achievement-doppelsoeldner_outnumbered.png":"4e74bc204e","/img/icons/achievements/90x90/achievement-early_defeat.png":"4aa6288350","/img/icons/achievements/90x90/achievement-first_attacks_made.png":"140d2c8f58","/img/icons/achievements/90x90/achievement-first_building_leveled_up.png":"935db3536e","/img/icons/achievements/90x90/achievement-first_mixed_attack.png":"fe038642ea","/img/icons/achievements/90x90/achievement-first_paladin_kill.png":"046c69247d","/img/icons/achievements/90x90/achievement-first_resource_production.png":"60c359baaf","/img/icons/achievements/90x90/achievement-first_resources_spent.png":"fa20406ba5","/img/icons/achievements/90x90/achievement-first_units_killed.png":"46c1368aff","/img/icons/achievements/90x90/achievement-first_units_recruited.png":"fa9462125c","/img/icons/achievements/90x90/achievement-fortress_built_milestone.png":"6954e07320","/img/icons/achievements/90x90/achievement-huge_villages_owned.png":"f37a7dd669","/img/icons/achievements/90x90/achievement-large_villages_owned.png":"5fd37aba65","/img/icons/achievements/90x90/achievement-level_two_churches_milestone.png":"0a5640417a","/img/icons/achievements/90x90/achievement-loot.png":"4355e73765","/img/icons/achievements/90x90/achievement-loot_daily.png":"f26b3f499e","/img/icons/achievements/90x90/achievement-loot_daily_tribe.png":"105c275699","/img/icons/achievements/90x90/achievement-loot_weekly.png":"fa308c2508","/img/icons/achievements/90x90/achievement-loot_weekly_tribe.png":"5e3b0a8455","/img/icons/achievements/90x90/achievement-looted_village_daily.png":"b0feb20e06","/img/icons/achievements/90x90/achievement-looted_village_daily_tribe.png":"db1ca7c8f3","/img/icons/achievements/90x90/achievement-looted_village_weekly.png":"584158e88d","/img/icons/achievements/90x90/achievement-looted_village_weekly_tribe.png":"7854480f07","/img/icons/achievements/90x90/achievement-losses.png":"570cf0853d","/img/icons/achievements/90x90/achievement-losses_support.png":"658218444d","/img/icons/achievements/90x90/achievement-major_battle_defense_outnumbered.png":"1c2e2f5cf7","/img/icons/achievements/90x90/achievement-major_battle_perfect_defense.png":"4a22160c8d","/img/icons/achievements/90x90/achievement-major_battles_supported.png":"bb80cb5001","/img/icons/achievements/90x90/achievement-major_battles_winning_streak.png":"378f73156e","/img/icons/achievements/90x90/achievement-major_battles_won.png":"44cac88d38","/img/icons/achievements/90x90/achievement-max_level_barracks.png":"9d0a32c085","/img/icons/achievements/90x90/achievement-max_level_churches.png":"256380e426","/img/icons/achievements/90x90/achievement-max_level_farms.png":"0a67b800ad","/img/icons/achievements/90x90/achievement-max_level_markets.png":"32157aadb9","/img/icons/achievements/90x90/achievement-max_level_preceptories.png":"9e3d1fbca6","/img/icons/achievements/90x90/achievement-max_level_resources.png":"c818a48f1e","/img/icons/achievements/90x90/achievement-max_level_taverns.png":"5dd8387874","/img/icons/achievements/90x90/achievement-max_level_walls.png":"43ee9b0a3e","/img/icons/achievements/90x90/achievement-minted_coins.png":"97639e2f1e","/img/icons/achievements/90x90/achievement-most_battle_daily.png":"30d1d90491","/img/icons/achievements/90x90/achievement-most_battle_daily_tribe.png":"3d6c8266c4","/img/icons/achievements/90x90/achievement-most_battle_weekly.png":"8317c9ed3e","/img/icons/achievements/90x90/achievement-most_battle_weekly_tribe.png":"3d00b9408b","/img/icons/achievements/90x90/achievement-overkill.png":"e03751886b","/img/icons/achievements/90x90/achievement-players_attacked_unique.png":"bf50b658e5","/img/icons/achievements/90x90/achievement-points.png":"c109b7a5e9","/img/icons/achievements/90x90/achievement-points_milestone_tribe.png":"405f3fd870","/img/icons/achievements/90x90/achievement-province_fully_owned_milestone.png":"fd314530a9","/img/icons/achievements/90x90/achievement-province_king_milestone.png":"c09aab4bb0","/img/icons/achievements/90x90/achievement-provinces_owned_milestone_tribe.png":"e270391b3d","/img/icons/achievements/90x90/achievement-ranking_continent.png":"9a9dca1cd4","/img/icons/achievements/90x90/achievement-ranking_global.png":"8459669230","/img/icons/achievements/90x90/achievement-recruited_cavalry.png":"8e40bdd9a1","/img/icons/achievements/90x90/achievement-recruited_infantry.png":"da5bcae13f","/img/icons/achievements/90x90/achievement-recruited_siege_weapons.png":"13ee8ccf2a","/img/icons/achievements/90x90/achievement-resources_delivered.png":"f9ae8acb2a","/img/icons/achievements/90x90/achievement-resources_traded_clay.png":"b1339510ae","/img/icons/achievements/90x90/achievement-resources_traded_iron.png":"00f770ae83","/img/icons/achievements/90x90/achievement-resources_traded_wood.png":"be4fac4b18","/img/icons/achievements/90x90/achievement-scouting_success.png":"b1bc47678e","/img/icons/achievements/90x90/achievement-scouting_thwarted.png":"9aeb8c95a9","/img/icons/achievements/90x90/achievement-scouts_killed_attacker.png":"aa9b129cf5","/img/icons/achievements/90x90/achievement-scouts_killed_defender.png":"8ed9a666d5","/img/icons/achievements/90x90/achievement-self_attack.png":"b5058cb4f2","/img/icons/achievements/90x90/achievement-self_conquest.png":"f00475e3d9","/img/icons/achievements/90x90/achievement-snobs_killed.png":"5a6d1b746e","/img/icons/achievements/90x90/achievement-trades_completed.png":"204c98cc29","/img/icons/achievements/90x90/achievement-trades_completed_buyer.png":"8bade483ed","/img/icons/achievements/90x90/achievement-trades_completed_seller.png":"18242ae886","/img/icons/achievements/90x90/achievement-trebuchet_kills.png":"441a88da34","/img/icons/achievements/90x90/achievement-tribe_membership_days.png":"e12e8871b1","/img/icons/achievements/90x90/achievement-units_killed_milestone_tribe.png":"c1e20fc843","/img/icons/achievements/90x90/achievement-village_conquered_milestone_tribe.png":"d2dad472aa","/img/icons/achievements/90x90/achievement-village_owned_milestone_tribe.png":"13b9e312e7","/img/icons/achievements/90x90/achievement-village_points.png":"d7fb668ffe","/img/icons/achievements/90x90/achievement-villages_conquered.png":"5c216902b8","/img/icons/achievements/90x90/achievement-villages_conquered_per_hour.png":"0780c1ca04","/img/icons/achievements/90x90/achievement-villages_looted_unique.png":"ed8e260623","/img/icons/achievements/90x90/achievement-villages_lost_milestone.png":"a0bf2ca0ad","/img/icons/achievements/90x90/achievement-wall_levels_destroyed.png":"4f9935ca75","/img/icons/alpha.png":"34362af848","/img/icons/background_green.jpg":"57b4bf80e5","/img/icons/background_noise.png":"36cefed5e7","/img/icons/background_noise_blue.png":"bc945be908","/img/icons/background_noise_brown_0.1.png":"430b3df37d","/img/icons/background_noise_brown_0.2.png":"fdb20da22d","/img/icons/background_noise_brown_1.0.png":"88dfa21354","/img/icons/background_noise_button.png":"e27e36503c","/img/icons/background_noise_icon_black.png":"8bf37c810e","/img/icons/background_noise_icon_blue.png":"08980b6ee7","/img/icons/background_noise_icon_red.png":"7513d5376f","/img/icons/background_orange.jpg":"aabaf2ad9f","/img/icons/background_red.jpg":"9e8abf0746","/img/icons/bathhouse.jpg":"7083dfc62c","/img/icons/bathhouse.png":"a1df7be305","/img/icons/big-crest-icons.png":"22d29d073c","/img/icons/crest-icons.jpg":"cb2df5b1c7","/img/icons/crest-icons.png":"62e02e8532","/img/icons/global-info-border.png":"0b545d1ae0","/img/icons/group-icons.png":"6da3cc3d17","/img/icons/map-icons.png":"35969ccd54","/img/icons/marker-icons.png":"cbb83cdac7","/img/icons/no-alpha.jpg":"3bc20f971c","/img/icons/preset-icons.jpg":"36f81ba103","/img/icons/preset-icons.png":"08395d1b5c","/img/icons/quest-sprite.png":"83e1016413","/img/icons/shop.gif":"ceb2eebe6a","/img/icons/sprite-context-items.png":"c195c89b2e","/img/icons/sprite-context-town.png":"1eecd8ec19","/img/icons/sprite-timeline.png":"b3f3fe5df1","/img/interface/backgrounds/cell_wood_bg.jpg":"6b0fd9224c","/img/interface/backgrounds/wood.png":"bfbc2ff01d","/img/interface/bar-separator.png":"40d85a2d44","/img/interface/bg.jpg":"cff0c1b604","/img/interface/border_corner.png":"cd091ac710","/img/interface/border_horizontal.png":"768410e5e8","/img/interface/border_inner_vertical.png":"62488880b7","/img/interface/border_middle.png":"8c0e90dcf4","/img/interface/border_middle_small.png":"0b4d503de6","/img/interface/border_vertical.png":"26feacc3cd","/img/interface/box-separator.jpg":"a52afa116f","/img/interface/btn-background.png":"1b3046d124","/img/interface/divider-end.png":"24b417b4c5","/img/interface/divider-middle.png":"4c5529f81e","/img/interface/divider-start.png":"104945978f","/img/interface/interface_bottom_bg.png":"051d64fa8b","/img/interface/interface_bottom_deco_left.png":"3547e97f72","/img/interface/interface_bottom_deco_right.png":"2cd90f2627","/img/interface/interface_bottom_side_bg.png":"72ea0ded16","/img/interface/interface_timeline_button_bg.jpg":"3623e5a66d","/img/interface/interface_top_bg.jpg":"83f037dd28",
"/img/interface/interface_top_icon_bg.jpg":"dd75c17db8","/img/interface/interface_top_icon_bg_boosted.jpg":"af6da71f48","/img/interface/interface_top_left_bg.png":"8c7a6ab6bf","/img/interface/interface_top_progressbar_bg.gif":"d5aeabeeca","/img/interface/interface_top_right_deco.png":"284e164de9","/img/interface/marker-background.png":"a10be41079","/img/interface/marker-m-left.png":"3ae701ce34","/img/interface/marker-m-mid.png":"7446f8843a","/img/interface/marker-m-pointer.png":"9ce44c8dab","/img/interface/marker-m-right.png":"d99b30fe1e","/img/interface/quest-queue/bg-top.png":"f94f37baef","/img/interface/quest-queue/bg-trigger.png":"206ffd8bec","/img/interface/quest-queue/tabbed-queue-top.png":"46f1cda2e0","/img/interface/resource_value_bg.jpg":"9627812cd6","/img/interface/ring-border.png":"305f50367d","/img/interface/timeline.png":"48bd037c77","/img/interface/tribe-crest-level-middle.png":"5c652c45a6","/img/interface/unit_bar.png":"3db96f97d4","/img/interface/unit_bar_button.png":"2ecd94d5f1","/img/landing/artwork/main-building-small.jpg":"2a85656f22","/img/landing/artwork/main-building.jpg":"f36742f7be","/img/landing/artwork/timber-camp-small.jpg":"4b45169370","/img/landing/artwork/timber-camp.jpg":"8d8dfee053","/img/landing/artwork/units1-small.jpg":"42938ac278","/img/landing/artwork/units1.jpg":"f48c9e0be7","/img/landing/artwork/units2-small.jpg":"9f62fb8f20","/img/landing/artwork/units2.jpg":"b6ecdf2561","/img/landing/artwork/units3-small.jpg":"9925caccbf","/img/landing/artwork/units3.jpg":"b0a9d41aae","/img/landing/attention.png":"affe9818c9","/img/landing/background-930.jpg":"f25c52fb64","/img/landing/background.jpg":"b3c7512795","/img/landing/bfc-header-background.jpg":"87bd15ed28","/img/landing/bfc-header-corners.png":"f342628bb1","/img/landing/bfc-header.jpg":"dc4ed47d15","/img/landing/bfc-horsemen.png":"77b577395a","/img/landing/bfc-nobleman.png":"bfce14ae43","/img/landing/bfc-swordman.png":"4c2669c9b5","/img/landing/bordered-background.png":"7871154a50","/img/landing/button-register.png":"f6dd581c1a","/img/landing/character.png":"1dadc049fc","/img/landing/checkbox-login.png":"167757ee00","/img/landing/checkbox.png":"45d971f44c","/img/landing/colorbox/arrows.png":"975f8df04c","/img/landing/colorbox/loading.gif":"f2d6eb987d","/img/landing/container-bottom-bfc.jpg":"029c7ee78b","/img/landing/container-corners-bfc.png":"1abc5ff6f8","/img/landing/container-corners.png":"7d397d0c3e","/img/landing/container-left-bfc.jpg":"9bf56f09fc","/img/landing/container-right-bfc.jpg":"29380d6d5f","/img/landing/container-sides1.png":"bcc675b23c","/img/landing/container-sides2.png":"ac5c7c6fbc","/img/landing/container-top-bfc.jpg":"43ea148e9e","/img/landing/coop.png":"ea4a88819f","/img/landing/dialog-extension-background.png":"e51e074e02","/img/landing/external-link.png":"91a1143754","/img/landing/footer-background.png":"2a4e02df78","/img/landing/form-input.jpg":"427943bc1b","/img/landing/gallery/attack-small.jpg":"ffa475477c","/img/landing/gallery/attack.jpg":"d47b7e4a15","/img/landing/gallery/barracks-small.jpg":"0fd5549198","/img/landing/gallery/barracks.jpg":"5e27778ced","/img/landing/gallery/headquarter-small.jpg":"6b990fe296","/img/landing/gallery/headquarter.jpg":"02c31b977d","/img/landing/gallery/map-night-small.jpg":"0231382770","/img/landing/gallery/map-night.jpg":"99e8537f42","/img/landing/gallery/map-small.jpg":"7c7952af25","/img/landing/gallery/map.jpg":"0e591360db","/img/landing/gallery/reports-small.jpg":"9bbc9ba793","/img/landing/gallery/reports.jpg":"8eb316f6a5","/img/landing/gallery/tavern-small.jpg":"a0c983f486","/img/landing/gallery/tavern.jpg":"8443ee1699","/img/landing/gallery/timeline-small.jpg":"53c6027da3","/img/landing/gallery/timeline.jpg":"a4adf7e8bc","/img/landing/gallery/village-view-medium.jpg":"865a8a8449","/img/landing/gallery/village-view-small.jpg":"f35e906fa2","/img/landing/gallery/village-view.jpg":"2295a1b871","/img/landing/inner-bottom-left.jpg":"e2c124168b","/img/landing/inner-bottom-right.jpg":"4d5c5613e4","/img/landing/inner-bottom.jpg":"1277a92ad6","/img/landing/inner-left-bfc.jpg":"bc584a967f","/img/landing/inner-left.jpg":"b9e15a5589","/img/landing/inner-middle-bfc.jpg":"a507f15c93","/img/landing/inner-middle.jpg":"66263f611d","/img/landing/inner-right-bfc.jpg":"c4bd858a5b","/img/landing/inner-right.jpg":"323b0c1b06","/img/landing/inner-top-left.jpg":"ccbcb0b4b3","/img/landing/inner-top-right.jpg":"73b85e46e5","/img/landing/inner-top.jpg":"6bc71ff8f4","/img/landing/innogames-logo.png":"444b47e39d","/img/landing/input-left.png":"ac17763e00","/img/landing/input-middle.png":"040badc23d","/img/landing/input-right.png":"688099e302","/img/landing/input.png":"7627892db2","/img/landing/introduction-video5.jpg":"81d09b06e3","/img/landing/ipp-buttons.png":"c0f2031585","/img/landing/locked.png":"23010ce6ef","/img/landing/login-buttons.png":"b1499dccaf","/img/landing/login-expanded.png":"b79371e446","/img/landing/login-input-background.png":"da27146bec","/img/landing/login-small.png":"ce17a69ea4","/img/landing/logo.png":"108f5579ba","/img/landing/logo2.png":"53789cc6b4","/img/landing/menu-background.jpg":"1d2a07b55d","/img/landing/menu-divider.jpg":"d7ff206efe","/img/landing/menu.png":"eac332022a","/img/landing/mobile_background.jpg":"2eb4a9e16d","/img/landing/modal-bottom.png":"f36f2ae4bb","/img/landing/modal-middle.png":"713e01f88f","/img/landing/modal-top.png":"662f9efe62","/img/landing/ornaments.png":"9053e446b9","/img/landing/paladin.png":"3f66f2c3f1","/img/landing/paper-top.jpg":"3711ebeb8a","/img/landing/play-button.png":"705db7faa3","/img/landing/sidebar-header-background.png":"81e793898b","/img/landing/social-background.jpg":"bd3a183956","/img/landing/social-networks.png":"6e63e6dae0","/img/landing/spike-bottom.png":"0d2f20d55c","/img/landing/spike-top.png":"71664aae8b","/img/landing/spinner.gif":"633593cc27","/img/landing/stores-background.jpg":"349c7d5895","/img/landing/tw2-announcement-video.jpg":"4181bcb9e7","/img/landing/world-selection-button.png":"d69993f4ca","/img/landing/world-selection-greeting-bottom.png":"f80080cf58","/img/landing/world-selection-greeting-middle.png":"c030835e56","/img/landing/world-selection-greeting-top.png":"7d7041b5d9","/img/loading.jpg":"114fa4d961","/img/progress/progress_loading.png":"9c6fcfd06f","/img/progress/progress_loading_bg.png":"e4d16d352c","/img/quests/quest-marker-finish.png":"2650491ebf","/img/quests/quest-marker-unread.png":"c2a35fc419","/img/quests/slider-border-left.png":"1473af5996","/img/quests/slider-border-right.png":"02025aa5af","/img/queue/bg-bottom.png":"6d166456a9","/img/queue/bg-top.png":"3c44309bfb","/img/queue/item-expanded.png":"d72cab49f7","/img/queue/slot-disabled.png":"e9edc53497","/img/queue/slot-enabled.png":"4e5b932fd9","/img/registration-landing/appstore/btn-ar.png":"c6fed32e16","/img/registration-landing/appstore/btn-br.png":"6930e1558e","/img/registration-landing/appstore/btn-cz.png":"a8a11e9d30","/img/registration-landing/appstore/btn-de.png":"1ab1260953","/img/registration-landing/appstore/btn-dk.png":"2cc9499eec","/img/registration-landing/appstore/btn-en.png":"7f684ed61e","/img/registration-landing/appstore/btn-es.png":"e25588de27","/img/registration-landing/appstore/btn-fi.png":"1a6b04f45d","/img/registration-landing/appstore/btn-fr.png":"5b79200031","/img/registration-landing/appstore/btn-gr.png":"c9974a6a17","/img/registration-landing/appstore/btn-hu.png":"2978de91f0","/img/registration-landing/appstore/btn-it.png":"06e8b2249b","/img/registration-landing/appstore/btn-nl.png":"44a8cbda88","/img/registration-landing/appstore/btn-no.png":"131ac6081a","/img/registration-landing/appstore/btn-pl.png":"d78c7c4ae1","/img/registration-landing/appstore/btn-pt.png":"e9b7ef6eb0","/img/registration-landing/appstore/btn-ro.png":"a2039b57e0","/img/registration-landing/appstore/btn-ru.png":"6ba80df7d4","/img/registration-landing/appstore/btn-se.png":"84d175f01c","/img/registration-landing/appstore/btn-sk.png":"72c38de757","/img/registration-landing/appstore/btn-tr.png":"cf710c829b","/img/registration-landing/appstore/btn-us.png":"7f684ed61e","/img/registration-landing/arrows.png":"6cb1d94481","/img/registration-landing/artwork/main-building.jpg":"f36742f7be","/img/registration-landing/artwork/timber-camp.jpg":"8d8dfee053","/img/registration-landing/artwork/units1.jpg":"f48c9e0be7","/img/registration-landing/artwork/units2.jpg":"b6ecdf2561","/img/registration-landing/artwork/units3.jpg":"b0a9d41aae","/img/registration-landing/bar-bg-1024.png":"2190961b73","/img/registration-landing/bar-bg-620.png":"422bfd6a44","/img/registration-landing/bar-bg.png":"a6d54e4a1e","/img/registration-landing/bfc-header-background.jpg":"87bd15ed28","/img/registration-landing/bfc-header-corners.png":"f342628bb1","/img/registration-landing/bfc-header.jpg":"dc4ed47d15","/img/registration-landing/bfc-horsemen.png":"77b577395a","/img/registration-landing/bfc-nobleman.png":"bfce14ae43","/img/registration-landing/bfc-swordman.png":"4c2669c9b5","/img/registration-landing/bg-1024.jpg":"451c6d9a89","/img/registration-landing/bg-620.jpg":"ecd25a9a28","/img/registration-landing/bg.jpg":"517a35f4a6","/img/registration-landing/bordered-background.png":"7871154a50","/img/registration-landing/button-large.png":"d557106cbb","/img/registration-landing/button.png":"7dfb7beb75","/img/registration-landing/checkbox-login.png":"167757ee00","/img/registration-landing/checkbox.png":"45d971f44c","/img/registration-landing/colorbox/arrows.png":"975f8df04c","/img/registration-landing/colorbox/loading.gif":"f2d6eb987d","/img/registration-landing/container-bottom-bfc.jpg":"029c7ee78b","/img/registration-landing/container-corners-bfc.png":"1abc5ff6f8","/img/registration-landing/container-corners.png":"7d397d0c3e","/img/registration-landing/container-left-bfc.jpg":"9bf56f09fc","/img/registration-landing/container-right-bfc.jpg":"29380d6d5f","/img/registration-landing/container-sides1.png":"bcc675b23c","/img/registration-landing/container-sides2.png":"ac5c7c6fbc","/img/registration-landing/container-top-bfc.jpg":"43ea148e9e","/img/registration-landing/dialog-extension-background.png":"e51e074e02","/img/registration-landing/external-link.png":"91a1143754","/img/registration-landing/fixed-size-sprite-v2.png":"6a054092f9","/img/registration-landing/footer-background.png":"2a4e02df78","/img/registration-landing/form-input.jpg":"427943bc1b","/img/registration-landing/gallery/attack.jpg":"d47b7e4a15","/img/registration-landing/gallery/barracks.jpg":"5e27778ced","/img/registration-landing/gallery/headquarter.jpg":"02c31b977d","/img/registration-landing/gallery/map-night.jpg":"99e8537f42","/img/registration-landing/gallery/map.jpg":"0e591360db","/img/registration-landing/gallery/reports.jpg":"8eb316f6a5","/img/registration-landing/gallery/tavern.jpg":"8443ee1699","/img/registration-landing/gallery/timeline.jpg":"a4adf7e8bc","/img/registration-landing/gallery/village-view.jpg":"2295a1b871","/img/registration-landing/game-info-image.jpg":"49c8ea31d9","/img/registration-landing/gplay/btn-ar.png":"dddf0f7073","/img/registration-landing/gplay/btn-br.png":"cdfa14555a","/img/registration-landing/gplay/btn-cz.png":"9922fcb7a3","/img/registration-landing/gplay/btn-de.png":"8810c6cc75","/img/registration-landing/gplay/btn-dk.png":"1482fa6de9","/img/registration-landing/gplay/btn-en.png":"e8fe58cff0","/img/registration-landing/gplay/btn-es.png":"9b72708201","/img/registration-landing/gplay/btn-fi.png":"39fac6179a","/img/registration-landing/gplay/btn-fr.png":"d71ba99016","/img/registration-landing/gplay/btn-gr.png":"83012f69bb","/img/registration-landing/gplay/btn-hu.png":"2a9aafa376","/img/registration-landing/gplay/btn-it.png":"bccd78df9c","/img/registration-landing/gplay/btn-nl.png":"e22a26cfa7","/img/registration-landing/gplay/btn-no.png":"ea1118b16b","/img/registration-landing/gplay/btn-pl.png":"a805556dde","/img/registration-landing/gplay/btn-pt.png":"0be23ddd8c","/img/registration-landing/gplay/btn-ro.png":"6f053f308c","/img/registration-landing/gplay/btn-ru.png":"39c52bd5aa","/img/registration-landing/gplay/btn-se.png":"55de0b2a4c","/img/registration-landing/gplay/btn-sk.png":"da44c70358","/img/registration-landing/gplay/btn-tr.png":"ea72f60b79","/img/registration-landing/gplay/btn-us.png":"973cc73ee8","/img/registration-landing/header-bg-1024.jpg":"2deabace22","/img/registration-landing/header-bg-620.jpg":"f7a275a3e4","/img/registration-landing/inner-bottom-left.jpg":"e2c124168b","/img/registration-landing/inner-bottom-right.jpg":"4d5c5613e4","/img/registration-landing/inner-bottom.jpg":"1277a92ad6","/img/registration-landing/inner-left-bfc.jpg":"bc584a967f","/img/registration-landing/inner-left.jpg":"b9e15a5589","/img/registration-landing/inner-middle-bfc.jpg":"a507f15c93","/img/registration-landing/inner-middle.jpg":"66263f611d","/img/registration-landing/inner-right-bfc.jpg":"c4bd858a5b","/img/registration-landing/inner-right.jpg":"323b0c1b06","/img/registration-landing/inner-top-left.jpg":"ccbcb0b4b3","/img/registration-landing/inner-top-right.jpg":"73b85e46e5","/img/registration-landing/inner-top.jpg":"6bc71ff8f4","/img/registration-landing/innogames-logo.png":"444b47e39d","/img/registration-landing/input-left.png":"ac17763e00","/img/registration-landing/input-middle.png":"040badc23d","/img/registration-landing/input-right.png":"688099e302","/img/registration-landing/input.png":"7627892db2","/img/registration-landing/ipp-buttons.png":"8463ab4699","/img/registration-landing/ivy.png":"a26965753c","/img/registration-landing/loading.gif":"ccc6926142","/img/registration-landing/login-bg.png":"091e0f5966","/img/registration-landing/login-buttons.png":"b1499dccaf","/img/registration-landing/login-expanded.png":"b79371e446","/img/registration-landing/login-input-background.png":"da27146bec","/img/registration-landing/login-small.png":"ce17a69ea4","/img/registration-landing/login.png":"e0eea3b42a","/img/registration-landing/logo.png":"108f5579ba","/img/registration-landing/media-button.png":"89b2d98f26","/img/registration-landing/media-gallery-concept-art-image.jpg":"1b5b87c584","/img/registration-landing/media-gallery-screenshots-image.jpg":"646b4e79fd","/img/registration-landing/media-gallery-wallpaper-image.jpg":"806c86ce30","/img/registration-landing/menu-background.jpg":"1d2a07b55d","/img/registration-landing/menu-divider.jpg":"d7ff206efe","/img/registration-landing/menu.png":"eac332022a","/img/registration-landing/modal-bottom.png":"f36f2ae4bb","/img/registration-landing/modal-middle.png":"713e01f88f","/img/registration-landing/modal-top.png":"662f9efe62","/img/registration-landing/ornaments.png":"9053e446b9","/img/registration-landing/paper-top.jpg":"3711ebeb8a","/img/registration-landing/play-button.png":"705db7faa3","/img/registration-landing/section-divider-shadow.png":"679a4ea229","/img/registration-landing/section-divider.jpg":"54a06d876c","/img/registration-landing/section-divider.png":"16f8c1086e","/img/registration-landing/section-header.png":"ce4576c003","/img/registration-landing/sidebar-header-background.png":"81e793898b","/img/registration-landing/social-background.jpg":"bd3a183956","/img/registration-landing/social-networks.png":"6e63e6dae0","/img/registration-landing/spike-bottom.png":"0d2f20d55c","/img/registration-landing/spike-top.png":"71664aae8b","/img/registration-landing/stores-background.jpg":"349c7d5895","/img/registration-landing/tw2-announcement-video.jpg":"4181bcb9e7","/img/registration-landing/units-archer-thumb.png":"25f3a4b3cd","/img/registration-landing/units-archer.png":"1fe4840e88","/img/registration-landing/units-axe-thumb.png":"10ef365c13","/img/registration-landing/units-axe.png":"0fbfeb9a4e","/img/registration-landing/units-doppelsoldner-thumb.png":"fd786703c5","/img/registration-landing/units-doppelsoldner.png":"164c019e2c","/img/registration-landing/units-footer-bg-1024.jpg":"0da313c189","/img/registration-landing/units-footer-bg-620.jpg":"c9c8852fcd","/img/registration-landing/units-footer-bg-addon.png":"c443c95f7c","/img/registration-landing/units-footer-bg.jpg":"e30d8e4ba4","/img/registration-landing/units-heavy_cavalry-thumb.png":"5d5169ddc6","/img/registration-landing/units-heavy_cavalry.png":"74e0f0669c","/img/registration-landing/units-light_cavalry-thumb.png":"b37512af96","/img/registration-landing/units-light_cavalry.png":"ead527bff7","/img/registration-landing/units-mounted_archer-thumb.png":"3c23fabe8f","/img/registration-landing/units-mounted_archer.png":"b0679c5dfd","/img/registration-landing/units-scout-thumb.png":"aa5f39ae56","/img/registration-landing/units-snob-thumb.png":"f93064b5d3","/img/registration-landing/units-snob.png":"6f60ec337e","/img/registration-landing/units-spear-thumb.png":"84b57d3e2f","/img/registration-landing/units-spear.png":"39f9913004","/img/registration-landing/units-spy-thumb.png":"f173bebd7d","/img/registration-landing/units-spy.png":"dc0dba4e21","/img/registration-landing/units-sword-thumb.png":"421010df79","/img/registration-landing/units-sword.png":"2ce8e5e6e7","/img/registration-landing/wallpaper/tw2_wallpaper.jpg":"d72e851273","/img/registration-landing/world-selection-button.png":"d69993f4ca","/img/registration-landing/world-selection-greeting-bottom.png":"f80080cf58","/img/registration-landing/world-selection-greeting-middle.png":"c030835e56","/img/registration-landing/world-selection-greeting-top.png":"7d7041b5d9","/img/resource-deposit/badge1.png":"e7c413430c","/img/resource-deposit/badge2.png":"23822706a3","/img/resource-deposit/badge3.png":"15ffef671b","/img/resource-deposit/bh-blue.png":"6f09925ad1","/img/resource-deposit/bh-orange.png":"dfd8fb65bf","/img/resource-deposit/spinner.png":"72eafe1c7a","/img/rte/building-academy.png":"79265f3559","/img/rte/building-barracks.png":"df28747c3b","/img/rte/building-chapel-bathhouse.png":"0a5c6e3db2","/img/rte/building-chapel.png":"3b4c57106a","/img/rte/building-church-bathhouse.png":"6737d5ed08","/img/rte/building-church.png":"d2e0a3ff8e","/img/rte/building-clay_pit.png":"be62a525c4","/img/rte/building-farm.png":"b684773545","/img/rte/building-fortress.png":"06b2c151e3","/img/rte/building-headquarter.png":"b6bbcbcfc8","/img/rte/building-hospital.png":"16d12ce2dc","/img/rte/building-iron_mine.png":"cb8e647414","/img/rte/building-market.png":"6146709840","/img/rte/building-preceptory.png":"b8825f30ce","/img/rte/building-rally_point.png":"ef3b643181","/img/rte/building-statue.png":"8e7447deff","/img/rte/building-tavern.png":"e2a0842005","/img/rte/building-timber_camp.png":"44e49a4727","/img/rte/building-wall.png":"6476793f82","/img/rte/building-warehouse.png":"0e8267f49f","/img/rte/character.png":"b470dfb9fa","/img/rte/image.png":"df4c40dc17","/img/rte/report.png":"1d6cc49b44","/img/rte/spoiler.png":"664a0942af","/img/rte/tribe.png":"490239e55d","/img/rte/unit-archer.png":"486af6ac35","/img/rte/unit-axe.png":"e580ffd206","/img/rte/unit-catapult.png":"6d7751725a","/img/rte/unit-doppelsoldner.png":"8074f953ef","/img/rte/unit-heavy_cavalry.png":"ad0c81af8c","/img/rte/unit-knight.png":"00713b513c","/img/rte/unit-light_cavalry.png":"b3a50f0bd1","/img/rte/unit-mounted_archer.png":"3a1951e008","/img/rte/unit-ram.png":"90280e8539","/img/rte/unit-snob.png":"721c46f9d1","/img/rte/unit-spear.png":"b6383f605e","/img/rte/unit-sword.png":"7a689cd568","/img/rte/unit-trebuchet.png":"5139d1439b","/img/rte/url.png":"23a08c590a","/img/rte/village.png":"dd30a79728","/img/scrollbar/scrollbar-background-bottom.png":"cf99ead144","/img/scrollbar/scrollbar-background-top.png":"6882645d7d","/img/scrollbar/scrollbar-background.png":"144102265c","/img/scrollbar/scrollbar-bottom-grey.png":"fdfcb04fcb","/img/scrollbar/scrollbar-bottom.png":"4a36c52deb","/img/scrollbar/scrollbar-center-grey.png":"c234ddedd4","/img/scrollbar/scrollbar-center.png":"9e8d5a8b7b","/img/scrollbar/scrollbar-handle-grey.png":"02bee7d7b8","/img/scrollbar/scrollbar-handle.png":"55ae992f2e","/img/scrollbar/scrollbar-top-grey.png":"4976e3ed82","/img/scrollbar/scrollbar-top.png":"1eee2df892","/img/second-village/barracks.png":"eaf2765a63","/img/second-village/beam.png":"3a56b91e5c","/img/second-village/character.png":"27bacf7d65","/img/second-village/character_eyes_closed.png":"00d8edbb0b","/img/second-village/character_eyes_crazy.png":"72f17a3889","/img/second-village/construct.png":"502913e252","/img/second-village/farm.png":"eedf09b55f","/img/second-village/headquarter.png":"7531d6fd0c","/img/second-village/headquarter_bs.png":"682e0b3990","/img/second-village/hourglass.png":"cb5af3557f","/img/second-village/job-icon.png":"053faef794","/img/second-village/leafs.png":"fccccc7025","/img/second-village/rally_point.png":"b5facbb6b2","/img/second-village/status.png":"832dfceca4","/img/second-village/timber_camp.png":"cb64a2beeb","/img/second-village/village-bg.jpg":"9672fd13c3","/img/second-village/warehouse.png":"a01eea83d8","/img/shop/hot.png":"6487a9f67e","/img/spinner-devmode.gif":"a2c50765fc","/img/spinner.gif":"3d220d6cb6","/img/tabs/tab_active_bg.png":"b11ccf045e","/img/tabs/tab_bg.png":"5c3a3ccb51","/img/tabs/tab_border_active_bottom_left.png":"fb0a2389e2","/img/tabs/tab_border_active_bottom_right.png":"a27c362d52","/img/tabs/tab_border_left.png":"5759c1cf14","/img/tabs/tab_border_right.png":"fe8c24c45c","/img/tabs/tab_border_top_left.png":"7368bad5c9","/img/tabs/tab_border_top_right.png":"5d659daca7","/img/tabs/tab_box_bg.png":"603e07e4f1","/img/tabs/tab_box_bg_active.png":"3851bd32a1","/img/tabs/tab_box_left_bg.png":"666fa9db74","/img/tabs/tab_box_left_bg_active.png":"835d694eb5","/img/tabs/tab_box_right_bg.png":"6c2c4ee2c4","/img/tabs/tab_box_right_bg_active.png":"72bc970c7f","/img/tabs/tabs_bg.png":"bb74cccdf2","/img/tiles/day.png":"44be340739","/img/tiles/day/bfortress.png":"39fb379ddc","/img/tiles/day/border.png":"3068d208ba","/img/tiles/day/btown01.png":"62391314e8","/img/tiles/day/btown02.png":"67e3c5069b","/img/tiles/day/btown03.png":"eece0ae6f5","/img/tiles/day/btown04.png":"a8b5510f58","/img/tiles/day/btown05.png":"bdb30bf4b0","/img/tiles/day/btown06.png":"5be21829d8","/img/tiles/day/desert-0.png":"42015ff563","/img/tiles/day/desert-1.png":"02e4de6d04","/img/tiles/day/desert-2.png":"fb3c46167b","/img/tiles/day/desert-3.png":"59eb3993eb","/img/tiles/day/desert-4.png":"ac18f42be8","/img/tiles/day/desert-5.png":"9eed7c75bb","/img/tiles/day/fortress.png":"dde34c29ae","/img/tiles/day/gras-0.png":"d5fa422d6b","/img/tiles/day/gras-1.png":"a97a937658","/img/tiles/day/gras-2.png":"d41f359023","/img/tiles/day/gras-3.png":"7083e9de33","/img/tiles/day/gras-4.png":"00ee67f2f1","/img/tiles/day/gras-5.png":"42cfd4b1fb","/img/tiles/day/hover.png":"ea8e50d64e","/img/tiles/day/invite-friend.png":"8ba7142b10","/img/tiles/day/landmark01.png":"650cb278fd","/img/tiles/day/landmark02.png":"33cfa1bade","/img/tiles/day/landmark03.png":"3790d74665","/img/tiles/day/landmark04.png":"dcb15dfe83","/img/tiles/day/landmark05.png":"56d6f155eb","/img/tiles/day/landmark06.png":"f0049c3234","/img/tiles/day/landmark07.png":"9bdecad4fc","/img/tiles/day/landmark08.png":"e4acb62bc6","/img/tiles/day/landmark09.png":"548aaf2724","/img/tiles/day/landmark10.png":"9cd22838a5","/img/tiles/day/noob-protection.png":"578d52b7ba","/img/tiles/day/production-boost.png":"0c0c09de80","/img/tiles/day/resource-deposit-effect.png":"58101fa7b0","/img/tiles/day/resource-deposit.png":"08c78252dc","/img/tiles/day/river/river-1.png":"992bdd15f7","/img/tiles/day/river/river-10.png":"de8cb4fb37","/img/tiles/day/river/river-11.png":"b6206d1d16","/img/tiles/day/river/river-12.png":"0b44362ce5","/img/tiles/day/river/river-13.png":"8bea6cae77","/img/tiles/day/river/river-14.png":"f3c862e6e8","/img/tiles/day/river/river-15.png":"d18561459c","/img/tiles/day/river/river-16.png":"1ce142a5f4","/img/tiles/day/river/river-17.png":"c00527dfa6","/img/tiles/day/river/river-18.png":"e86e2da7c2","/img/tiles/day/river/river-19.png":"9c376dac5c","/img/tiles/day/river/river-2.png":"64265029a9","/img/tiles/day/river/river-20.png":"0d95c43456","/img/tiles/day/river/river-21.png":"9988531ad4","/img/tiles/day/river/river-22.png":"61d15f024c","/img/tiles/day/river/river-23.png":"080177e240","/img/tiles/day/river/river-24.png":"e542fedf96","/img/tiles/day/river/river-25.png":"17b3833cc3","/img/tiles/day/river/river-26.png":"5a686d1373","/img/tiles/day/river/river-27.png":"716cfe02d4","/img/tiles/day/river/river-28.png":"c7a5146aa1","/img/tiles/day/river/river-29.png":"759cfb7767","/img/tiles/day/river/river-3.png":"67efaae0e4","/img/tiles/day/river/river-4.png":"39da4f9f6e","/img/tiles/day/river/river-5.png":"3d3b910f5b","/img/tiles/day/river/river-6.png":"dac2708bc9","/img/tiles/day/river/river-7.png":"7a593c85e8","/img/tiles/day/river/river-8.png":"0637f9ec64","/img/tiles/day/river/river-9.png":"ba2054a5aa","/img/tiles/day/rock-0.png":"37a80b3348","/img/tiles/day/rock-1.png":"dd9dcf9e03","/img/tiles/day/rock-2.png":"34ed1a9e8c","/img/tiles/day/rock-3.png":"34ed1a9e8c","/img/tiles/day/rock-4.png":"cc4641f712","/img/tiles/day/rock-5.png":"f53280842f","/img/tiles/day/second-village-effect.png":"5f190704b0","/img/tiles/day/second-village-hourglass-effect.png":"092df9122b","/img/tiles/day/second-village.png":"4010fc9f08","/img/tiles/day/selected-village.png":"43bc0a83c7","/img/tiles/day/town01.png":"e834567f99","/img/tiles/day/town02.png":"1f8f51bd89","/img/tiles/day/town03.png":"dc14a4c3aa","/img/tiles/day/town04.png":"98866609bd","/img/tiles/day/town05.png":"e0b5fb29d5","/img/tiles/day/town06.png":"551fcef300","/img/tiles/day/transitions/desert-0.png":"a85574ea6b","/img/tiles/day/transitions/desert-1.png":"902408303e","/img/tiles/day/transitions/desert-2.png":"5d5218781b","/img/tiles/day/transitions/desert-3.png":"7043eb4f6a","/img/tiles/day/transitions/desert-4.png":"a4df835188","/img/tiles/day/transitions/desert-5.png":"777f3ea87e","/img/tiles/day/transitions/grass-0.png":"be4d4f512c","/img/tiles/day/transitions/grass-1.png":"5b3d282b79","/img/tiles/day/transitions/grass-2.png":"6823ed02b6","/img/tiles/day/transitions/grass-3.png":"56f0975b68","/img/tiles/day/transitions/grass-4.png":"0db39492cf","/img/tiles/day/transitions/grass-5.png":"479c6f3085","/img/tiles/day/transitions/rock-0.png":"1e43e2fe9e","/img/tiles/day/transitions/rock-1.png":"93c40aed4d","/img/tiles/day/transitions/rock-2.png":"61e30bd09b","/img/tiles/day/transitions/rock-3.png":"cceacad337","/img/tiles/day/transitions/rock-4.png":"737a2cee93","/img/tiles/day/transitions/rock-5.png":"4245da6be5","/img/tiles/day/transitions/waste-0.png":"1effe81872","/img/tiles/day/transitions/waste-1.png":"67ab45f287","/img/tiles/day/transitions/waste-2.png":"b8055f30a0","/img/tiles/day/transitions/waste-3.png":"ed16be2c7b","/img/tiles/day/transitions/waste-4.png":"44953217f2","/img/tiles/day/transitions/waste-5.png":"50120c46e8","/img/tiles/day/tree-1.png":"1fc30c498f","/img/tiles/day/tree-2.png":"69445f8ea6","/img/tiles/day/tree-3.png":"55202dad0e","/img/tiles/day/tree-4.png":"66cd824b53","/img/tiles/day/village-locator-pointer.png":"b1e4cc35bf","/img/tiles/day/village-locator.png":"eb0673183e","/img/tiles/day/village-mask.png":"6147a298d0","/img/tiles/day/waste-0.png":"cac02d10cb","/img/tiles/day/waste-1.png":"9ce557a648","/img/tiles/day/waste-2.png":"68bce25f2c","/img/tiles/day/waste-3.png":"30dc58560f","/img/tiles/day/waste-4.png":"8faa3df440","/img/tiles/day/waste-5.png":"873b3742c0","/img/tiles/day/water.png":"d10da3749c","/img/tiles/night.png":"ec8ed0d918","/img/tiles/night/bfortress.png":"ace3549f7e","/img/tiles/night/border.png":"c8c74ed8fe","/img/tiles/night/btown01.png":"a55536bcbe","/img/tiles/night/btown02.png":"dc61c5f7eb","/img/tiles/night/btown03.png":"32c415cc9f","/img/tiles/night/btown04.png":"bd67cc87b8","/img/tiles/night/btown05.png":"2bb2b81ce8","/img/tiles/night/btown06.png":"b58a59ba75","/img/tiles/night/desert-0.png":"ab55507ab6","/img/tiles/night/desert-1.png":"05dceaded0","/img/tiles/night/desert-2.png":"c74cedf7f8","/img/tiles/night/desert-3.png":"35ab1938d6","/img/tiles/night/desert-4.png":"6183916003","/img/tiles/night/desert-5.png":"8bc204c19c","/img/tiles/night/fortress.png":"5b75399a2c","/img/tiles/night/gras-0.png":"8f2dd5fb89","/img/tiles/night/gras-1.png":"96c0a32317","/img/tiles/night/gras-2.png":"7bacab34d6","/img/tiles/night/gras-3.png":"ba709490b5","/img/tiles/night/gras-4.png":"700b843e5b","/img/tiles/night/gras-5.png":"d82f3cd26a","/img/tiles/night/hover.png":"bb0544e61d","/img/tiles/night/invite-friend.png":"8ba7142b10","/img/tiles/night/landmark01.png":"23af969b9b","/img/tiles/night/landmark02.png":"4c8e208444","/img/tiles/night/landmark03.png":"50e1c7275f","/img/tiles/night/landmark04.png":"3053544042","/img/tiles/night/landmark05.png":"920e480abe","/img/tiles/night/landmark06.png":"1db132b979","/img/tiles/night/landmark07.png":"2dbaf181ed","/img/tiles/night/landmark08.png":"2d78c3fda8","/img/tiles/night/landmark09.png":"c3d8ee13b3","/img/tiles/night/landmark10.png":"cfe523be01","/img/tiles/night/noob-protection.png":"578d52b7ba","/img/tiles/night/production-boost.png":"d1977968ee","/img/tiles/night/resource-deposit-effect.png":"58101fa7b0","/img/tiles/night/resource-deposit.png":"08c78252dc","/img/tiles/night/river/river-1.png":"e758a34267","/img/tiles/night/river/river-10.png":"0c420227db","/img/tiles/night/river/river-11.png":"7ddceb4fe4","/img/tiles/night/river/river-12.png":"831f375f11","/img/tiles/night/river/river-13.png":"efaf39c02e","/img/tiles/night/river/river-14.png":"078d6a63a0","/img/tiles/night/river/river-15.png":"d003a421d5","/img/tiles/night/river/river-16.png":"2798de613b","/img/tiles/night/river/river-17.png":"f58f7ba9aa","/img/tiles/night/river/river-18.png":"ca9bd76b9a","/img/tiles/night/river/river-19.png":"cc64cbf51c","/img/tiles/night/river/river-2.png":"eb93cf41e4","/img/tiles/night/river/river-20.png":"130dac70a0","/img/tiles/night/river/river-21.png":"744d1c5f1e","/img/tiles/night/river/river-22.png":"9589f32c67","/img/tiles/night/river/river-23.png":"10b3911419","/img/tiles/night/river/river-24.png":"403271a67e","/img/tiles/night/river/river-25.png":"328049f51e","/img/tiles/night/river/river-26.png":"6e6575d3dc","/img/tiles/night/river/river-27.png":"19a3caa503","/img/tiles/night/river/river-28.png":"63918ad84c","/img/tiles/night/river/river-29.png":"368bca8c4a","/img/tiles/night/river/river-3.png":"d8a281a26c","/img/tiles/night/river/river-4.png":"5a966ff556","/img/tiles/night/river/river-5.png":"93e68ca1cb","/img/tiles/night/river/river-6.png":"a4f91edbc6","/img/tiles/night/river/river-7.png":"5b27fc8985","/img/tiles/night/river/river-8.png":"0246bba3ec","/img/tiles/night/river/river-9.png":"2d95219b4c","/img/tiles/night/rock-0.png":"691e952af2","/img/tiles/night/rock-1.png":"0d5ff9c3e0","/img/tiles/night/rock-2.png":"03333d468d","/img/tiles/night/rock-3.png":"03333d468d","/img/tiles/night/rock-4.png":"52fc49b8e3","/img/tiles/night/rock-5.png":"967892f11b","/img/tiles/night/second-village-effect.png":"5f190704b0","/img/tiles/night/second-village-hourglass-effect.png":"092df9122b","/img/tiles/night/second-village.png":"dc2b31cdb3","/img/tiles/night/selected-village.png":"4f4542604a","/img/tiles/night/town01.png":"5373f58974","/img/tiles/night/town02.png":"e44dce5519","/img/tiles/night/town03.png":"c37e73c40b","/img/tiles/night/town04.png":"ea688c992e","/img/tiles/night/town05.png":"875e4a6c32","/img/tiles/night/town06.png":"46e3dee77e","/img/tiles/night/transitions/desert-0.png":"8b06c18237","/img/tiles/night/transitions/desert-1.png":"d92b6ddb6b","/img/tiles/night/transitions/desert-2.png":"772cb4d5e8","/img/tiles/night/transitions/desert-3.png":"04559b7c1a","/img/tiles/night/transitions/desert-4.png":"d46f116b31","/img/tiles/night/transitions/desert-5.png":"72d36bad62","/img/tiles/night/transitions/grass-0.png":"75de4e69ab","/img/tiles/night/transitions/grass-1.png":"b8ce69a71d","/img/tiles/night/transitions/grass-2.png":"6745d9d77f","/img/tiles/night/transitions/grass-3.png":"bfa84714fd","/img/tiles/night/transitions/grass-4.png":"1aa237b507","/img/tiles/night/transitions/grass-5.png":"f85524d3fb","/img/tiles/night/transitions/rock-0.png":"6d396c7d2b",
"/img/tiles/night/transitions/rock-1.png":"23a95b12e5","/img/tiles/night/transitions/rock-2.png":"b847d1eeed","/img/tiles/night/transitions/rock-3.png":"5195ef9016","/img/tiles/night/transitions/rock-4.png":"337606e833","/img/tiles/night/transitions/rock-5.png":"7bd943a057","/img/tiles/night/transitions/waste-0.png":"7b69b3514c","/img/tiles/night/transitions/waste-1.png":"4cb469e47f","/img/tiles/night/transitions/waste-2.png":"ab51167ca2","/img/tiles/night/transitions/waste-3.png":"a1f5a0fabe","/img/tiles/night/transitions/waste-4.png":"f12ee9ca06","/img/tiles/night/transitions/waste-5.png":"22685e9b2a","/img/tiles/night/tree-1.png":"0ec19a8d44","/img/tiles/night/tree-2.png":"65ae24cb46","/img/tiles/night/tree-3.png":"f5bcf2effd","/img/tiles/night/tree-4.png":"d463f53385","/img/tiles/night/village-locator-pointer.png":"b1e4cc35bf","/img/tiles/night/village-locator.png":"eb0673183e","/img/tiles/night/village-mask.png":"6147a298d0","/img/tiles/night/waste-0.png":"eea23478cf","/img/tiles/night/waste-1.png":"8537a31791","/img/tiles/night/waste-2.png":"84eb9e52d6","/img/tiles/night/waste-3.png":"f838b4d264","/img/tiles/night/waste-4.png":"b2ccfc5186","/img/tiles/night/waste-5.png":"5ad1f52255","/img/tiles/night/water.png":"3a8f0a81f2","/img/tooltip/tooltip-title-left.png":"02c0b0f002","/img/tooltip/tooltip-title-right.png":"32a1c57c13","/img/tribe-skills/arrow.png":"530cfac4c5","/img/tribe-skills/book.png":"7844453ba6","/img/tribe-skills/collar.png":"94c783d905","/img/tribe-skills/particle.png":"d438503f5c","/img/tribe-skills/plate.png":"9930e0c863","/img/tribe/skills/header.png":"f6401721fc","/img/tribe/tribe-icon-border.png":"fc99910bf4","/img/tribe/tribe-level-gold.png":"59a3a3bf2b","/img/tribe/tribe-level-silver.png":"a09cae2698","/img/tribe/tribe-level-wood.png":"fc90d0f4a4","/img/tribe/tribe-profile-panel-bg.jpg":"3e2765c8b7","/img/tribe/tribe-profile-panel-bg.png":"5f0c68e5f9","/img/tutorial/arrow-green-angle.png":"64db9d0f5c","/img/tutorial/arrow-green.png":"09deb0ddc7","/img/tutorial/bubble-pointer-bottom.png":"272b75f64d","/img/tutorial/bubble-pointer-left.png":"fd53fcbef2","/img/tutorial/char0.png":"345ae828c2","/img/tutorial/highlight-border-left.png":"7249c875c3","/img/tutorial/highlight-border-top.png":"73ce14c36e","/img/tutorial/highlight-center.png":"db81fe6da0","/img/tutorial/highlight-circle.png":"1512f69c1c","/img/tutorial/highlight-circle2.png":"9060269265","/img/tutorial/highlight-corner.png":"20849b1c6b","/img/version.png":"4531a8ad43","/img/village/animations/archer_hq_stairs.png":"09715e63af","/img/village/animations/archer_normal.png":"a82481670a","/img/village/animations/archer_preceptory_battlement.png":"711c498fcb","/img/village/animations/archer_preceptory_bridge.png":"12861dc85c","/img/village/animations/archer_preceptory_tower.png":"43faa3a3e6","/img/village/animations/beggar.png":"b101bd1ada","/img/village/animations/blacksmith.png":"8be99833ab","/img/village/animations/clay_digger.L1-4.png":"ea96ebca46","/img/village/animations/clay_digger.L5-6.png":"eec432d3c0","/img/village/animations/clay_digger1.L1-6.png":"d850f21af8","/img/village/animations/clay_digger2.L1-4.png":"a5a8270b89","/img/village/animations/clay_digger2.L5-6.png":"aff1e049c8","/img/village/animations/construction_worker_academy0.png":"61f51c502f","/img/village/animations/construction_worker_academy0_wall0.png":"ec07650510","/img/village/animations/construction_worker_academy0_wall1.png":"a0d152436f","/img/village/animations/construction_worker_academy1.png":"fd61f44855","/img/village/animations/construction_worker_academy2.png":"f3e8aaba0d","/img/village/animations/construction_worker_barracks1.L1.png":"1a12678b0c","/img/village/animations/construction_worker_barracks1.L2.png":"10cfc2bd58","/img/village/animations/construction_worker_barracks1.L3.png":"fa04cffeb1","/img/village/animations/construction_worker_barracks1.L4.png":"1ca9fb4a8d","/img/village/animations/construction_worker_barracks1.L5.png":"50c23ca8c1","/img/village/animations/construction_worker_barracks2.L1.png":"796d529e66","/img/village/animations/construction_worker_barracks2.L2.png":"71930484df","/img/village/animations/construction_worker_barracks2.L3.png":"dfb657be85","/img/village/animations/construction_worker_barracks2.L4.png":"e770930d08","/img/village/animations/construction_worker_barracks2.L5.png":"7936d15863","/img/village/animations/construction_worker_barracks3.L3.png":"20a45bb8e5","/img/village/animations/construction_worker_barracks3.L4.png":"e997a97c12","/img/village/animations/construction_worker_barracks3.L5.png":"fc898554f2","/img/village/animations/construction_worker_chapel1.png":"2d1471ff3a","/img/village/animations/construction_worker_chapel2.png":"38fdd55973","/img/village/animations/construction_worker_church1.L0.png":"093b2d0c26","/img/village/animations/construction_worker_church1.L1.png":"1d20ad4e56","/img/village/animations/construction_worker_church1.L2.png":"cb6d484a78","/img/village/animations/construction_worker_church1.L3.png":"7570bbc40d","/img/village/animations/construction_worker_church2.L0.png":"8f85eade60","/img/village/animations/construction_worker_church2.L1.png":"8516b53562","/img/village/animations/construction_worker_church2.L2.png":"6a253e9c5f","/img/village/animations/construction_worker_church2.L3.png":"53ff40186f","/img/village/animations/construction_worker_church3.L1.png":"9cd4c0e4c5","/img/village/animations/construction_worker_church3.L2.png":"dd4a4ffd3c","/img/village/animations/construction_worker_church3.L3.png":"e4f6b26ea5","/img/village/animations/construction_worker_clay_pit1.L1.png":"5c77ab4b8f","/img/village/animations/construction_worker_clay_pit1.L2.png":"a60421eca4","/img/village/animations/construction_worker_clay_pit1.L3.png":"edc8fec681","/img/village/animations/construction_worker_clay_pit1.L4.png":"b1dfeccf89","/img/village/animations/construction_worker_clay_pit1.L5.png":"64aa04d3ce","/img/village/animations/construction_worker_clay_pit1.L6.png":"5ac0d6ff53","/img/village/animations/construction_worker_clay_pit2.L1.png":"795f16eafe","/img/village/animations/construction_worker_clay_pit2.L2.png":"154368775f","/img/village/animations/construction_worker_clay_pit2.L3.png":"c3353dd032","/img/village/animations/construction_worker_clay_pit2.L4.png":"1bce97a011","/img/village/animations/construction_worker_clay_pit2.L5.png":"3893320073","/img/village/animations/construction_worker_clay_pit2.L6.png":"8617e21d22","/img/village/animations/construction_worker_clay_pit3.L3.png":"62a8a1c0f8","/img/village/animations/construction_worker_clay_pit3.L4.png":"a2a5e3a658","/img/village/animations/construction_worker_clay_pit3.L5.png":"b2d8ed0720","/img/village/animations/construction_worker_clay_pit3.L6.png":"496770f7da","/img/village/animations/construction_worker_fortress1.L1-3.png":"6b49b62b41","/img/village/animations/construction_worker_fortress2.L1-3.png":"393fdcf226","/img/village/animations/construction_worker_fortress3.L1-3.png":"ece5bbd073","/img/village/animations/construction_worker_headquarter1.L1.png":"17b1f79c0d","/img/village/animations/construction_worker_headquarter1.L2.png":"56f055c33d","/img/village/animations/construction_worker_headquarter1.L3.png":"b96c59ccf6","/img/village/animations/construction_worker_headquarter1.L4.png":"64e507fc14","/img/village/animations/construction_worker_headquarter1.L5.png":"955387e915","/img/village/animations/construction_worker_headquarter1.L6.png":"5afbecde53","/img/village/animations/construction_worker_headquarter2.L1.png":"071eee396f","/img/village/animations/construction_worker_headquarter2.L2.png":"7a4d5d1053","/img/village/animations/construction_worker_headquarter2.L3.png":"7400029274","/img/village/animations/construction_worker_headquarter2.L4.png":"bc2d24aaaf","/img/village/animations/construction_worker_headquarter2.L5.png":"de880c92d3","/img/village/animations/construction_worker_headquarter2.L6.png":"c9984f284c","/img/village/animations/construction_worker_headquarter3.L3.png":"f4caea872e","/img/village/animations/construction_worker_headquarter3.L4.png":"8c52e3cd6e","/img/village/animations/construction_worker_headquarter3.L5.png":"dbc0ca5e9a","/img/village/animations/construction_worker_headquarter3.L6.png":"c20045a019","/img/village/animations/construction_worker_hospital1.L1.png":"d777a0faa7","/img/village/animations/construction_worker_hospital1.L2.png":"84ec85f1b6","/img/village/animations/construction_worker_hospital2.L0.png":"2a20333735","/img/village/animations/construction_worker_hospital2.L1.png":"e805185129","/img/village/animations/construction_worker_hospital2.L2.png":"a3ccefc475","/img/village/animations/construction_worker_hospital3.L1.png":"df41d00098","/img/village/animations/construction_worker_hospital3.L2.png":"eb6c9e90d7","/img/village/animations/construction_worker_iron_mine1.L1.png":"52eaf67955","/img/village/animations/construction_worker_iron_mine1.L2.png":"cbcddffb38","/img/village/animations/construction_worker_iron_mine1.L3.png":"85d00987cf","/img/village/animations/construction_worker_iron_mine1.L4.png":"bee63ad277","/img/village/animations/construction_worker_iron_mine1.L5-6.png":"211d8487a4","/img/village/animations/construction_worker_iron_mine2.L1.png":"4f92bffaa1","/img/village/animations/construction_worker_iron_mine2.L2.png":"70c6d7abc3","/img/village/animations/construction_worker_iron_mine2.L3.png":"7a8fd6c446","/img/village/animations/construction_worker_iron_mine2.L4.png":"02494300e9","/img/village/animations/construction_worker_iron_mine2.L5-6.png":"691992472f","/img/village/animations/construction_worker_iron_mine3.L3.png":"6769f8b76a","/img/village/animations/construction_worker_iron_mine3.L4.png":"6ef3f9dbad","/img/village/animations/construction_worker_iron_mine3.L5-6.png":"97d96af68f","/img/village/animations/construction_worker_market1.L2.png":"c88b8d280a","/img/village/animations/construction_worker_market1.L3.png":"d1acb44e47","/img/village/animations/construction_worker_market1.L4.png":"ddf62c884f","/img/village/animations/construction_worker_market2.L1.png":"b29314ec97","/img/village/animations/construction_worker_market2.L2.png":"a01c865826","/img/village/animations/construction_worker_market2.L3.png":"fc6c8fbd29","/img/village/animations/construction_worker_market2.L4.png":"3155b9969b","/img/village/animations/construction_worker_mill1.L1.png":"c768b4fbcd","/img/village/animations/construction_worker_mill1.L2.png":"411ee4ca2b","/img/village/animations/construction_worker_mill1.L3.png":"092d3d8c4b","/img/village/animations/construction_worker_mill1.L4.png":"df24938c0d","/img/village/animations/construction_worker_mill1.L5.png":"81f493d672","/img/village/animations/construction_worker_mill1.L6.png":"7d7cd9c753","/img/village/animations/construction_worker_mill2.L1.png":"024ff98ca1","/img/village/animations/construction_worker_mill2.L2.png":"d69d39d95e","/img/village/animations/construction_worker_mill2.L3.png":"1e63c4f8ea","/img/village/animations/construction_worker_mill2.L4.png":"fa98a69a97","/img/village/animations/construction_worker_mill2.L5.png":"4691e244c9","/img/village/animations/construction_worker_mill2.L6.png":"9f4c2a9107","/img/village/animations/construction_worker_mill3.L3.png":"cd1c58d012","/img/village/animations/construction_worker_mill3.L4.png":"c0044c032f","/img/village/animations/construction_worker_mill3.L5.png":"6c81d2ec5e","/img/village/animations/construction_worker_mill3.L6.png":"b4f23187f1","/img/village/animations/construction_worker_preceptory1.L0.png":"43dbd122ef","/img/village/animations/construction_worker_preceptory1.L1-2.png":"f85ab847f7","/img/village/animations/construction_worker_preceptory2.L0.png":"b7089aa91d","/img/village/animations/construction_worker_preceptory2.L1-2.png":"85130d6f99","/img/village/animations/construction_worker_preceptory3.L1-2.png":"ee5c6bf531","/img/village/animations/construction_worker_statue1.L0-1.png":"82d5de5be7","/img/village/animations/construction_worker_statue1.L2-3.png":"74236c8770","/img/village/animations/construction_worker_statue2.L0-1.png":"ab38f4eff4","/img/village/animations/construction_worker_statue2.L2-3.png":"5880d09b3c","/img/village/animations/construction_worker_statue3.L2-3.png":"ef01abfb7f","/img/village/animations/construction_worker_tavern1.L0.png":"02a24915bd","/img/village/animations/construction_worker_tavern1.L1.png":"25a73d3562","/img/village/animations/construction_worker_tavern1.L2.png":"908a372110","/img/village/animations/construction_worker_tavern1.L3.png":"9fd1f67d11","/img/village/animations/construction_worker_tavern2.L0.png":"fb0ef95039","/img/village/animations/construction_worker_tavern2.L1.png":"20a8ba6c19","/img/village/animations/construction_worker_tavern2.L2.png":"153ca6d0ca","/img/village/animations/construction_worker_tavern2.L3.png":"ef7dec9b42","/img/village/animations/construction_worker_tavern3.L2.png":"168986a232","/img/village/animations/construction_worker_tavern3.L3.png":"361af90cda","/img/village/animations/construction_worker_timber_camp1.L1.png":"23182bbed6","/img/village/animations/construction_worker_timber_camp1.L2.png":"2696e60b31","/img/village/animations/construction_worker_timber_camp1.L3-4.png":"5b9601bb14","/img/village/animations/construction_worker_timber_camp1.L5.png":"9674082833","/img/village/animations/construction_worker_timber_camp1.L6.png":"d80ec6f064","/img/village/animations/construction_worker_timber_camp2.L0.png":"fcc769d946","/img/village/animations/construction_worker_timber_camp2.L1.png":"a8efd5c2f3","/img/village/animations/construction_worker_timber_camp2.L2.png":"9c0a904fec","/img/village/animations/construction_worker_timber_camp2.L3-4.png":"be0c8b2e80","/img/village/animations/construction_worker_timber_camp2.L5.png":"20f00d4c94","/img/village/animations/construction_worker_timber_camp2.L6.png":"4a6b6f8723","/img/village/animations/construction_worker_timber_camp3.L3-4.png":"c1a899ff80","/img/village/animations/construction_worker_timber_camp3.L5.png":"3480ee5fa4","/img/village/animations/construction_worker_timber_camp3.L6.png":"4b619f7898","/img/village/animations/construction_worker_walls_back1.L0.png":"41a20058eb","/img/village/animations/construction_worker_walls_back1.L1.png":"77a1a0d09b","/img/village/animations/construction_worker_walls_back1.L2.png":"37246e348a","/img/village/animations/construction_worker_walls_back1.L3.png":"f3a6e70a05","/img/village/animations/construction_worker_walls_back2.L0.png":"e93bd8bf96","/img/village/animations/construction_worker_walls_back2.L1.png":"d68b01073b","/img/village/animations/construction_worker_walls_back2.L2.png":"aba96e5fbe","/img/village/animations/construction_worker_walls_back2.L3.png":"e2269f745a","/img/village/animations/construction_worker_walls_back3.L2.png":"4fba29f39d","/img/village/animations/construction_worker_walls_back3.L3.png":"6f7e1c2cb1","/img/village/animations/construction_worker_walls_front1.L0.png":"b85414e048","/img/village/animations/construction_worker_walls_front1.L1.png":"63f4d01e16","/img/village/animations/construction_worker_walls_front1.L2.png":"32b5ac4c97","/img/village/animations/construction_worker_walls_front1.L3.png":"04f5221cff","/img/village/animations/construction_worker_walls_front2.L0.png":"8ec75b019c","/img/village/animations/construction_worker_walls_front2.L1.png":"fd678bf619","/img/village/animations/construction_worker_walls_front2.L2.png":"f9e6b4faf1","/img/village/animations/construction_worker_walls_front2.L3.png":"ca988fdda2","/img/village/animations/construction_worker_walls_front3.L1.png":"e588f0ee5d","/img/village/animations/construction_worker_walls_front3.L2.png":"3f42149b2f","/img/village/animations/construction_worker_walls_front3.L3.png":"e54c6685d4","/img/village/animations/construction_worker_warehouse1.L1.png":"25cdea20ce","/img/village/animations/construction_worker_warehouse1.L2.png":"8f18c3865e","/img/village/animations/construction_worker_warehouse1.L3.png":"a89e0eb49c","/img/village/animations/construction_worker_warehouse1.L4.png":"b67d77d3e8","/img/village/animations/construction_worker_warehouse1.L5.png":"a4f7d97e2a","/img/village/animations/construction_worker_warehouse1.L6.png":"9dd56620d3","/img/village/animations/construction_worker_warehouse2.L0.png":"30adcd1758","/img/village/animations/construction_worker_warehouse2.L1.png":"338cb830fc","/img/village/animations/construction_worker_warehouse2.L2.png":"8393378db6","/img/village/animations/construction_worker_warehouse2.L3.png":"64c06efffd","/img/village/animations/construction_worker_warehouse2.L4.png":"a38263940c","/img/village/animations/construction_worker_warehouse2.L5.png":"f17de92ea3","/img/village/animations/construction_worker_warehouse2.L6.png":"7451c1a467","/img/village/animations/construction_worker_warehouse3.L3.png":"e15ce98c90","/img/village/animations/construction_worker_warehouse3.L4.png":"8bb95fb76d","/img/village/animations/construction_worker_warehouse3.L5.png":"5761d89d06","/img/village/animations/construction_worker_warehouse3.L6.png":"6dcc1aeae4","/img/village/animations/farmer_chickens.png":"86d08a2a48","/img/village/animations/farmer_rake.png":"dec65af553","/img/village/animations/farmer_sickle.png":"a2237674d5","/img/village/animations/fish.png":"1faace7f7e","/img/village/animations/fisherman.png":"8f26dbf294","/img/village/animations/fishmonger.png":"1d04c0fcc2","/img/village/animations/guards.png":"25b413df91","/img/village/animations/horse_barrow.png":"9068b00924","/img/village/animations/ironmine_lore.L1.png":"2a7e50c66c","/img/village/animations/ironmine_lore.L2.png":"886f6e4dda","/img/village/animations/ironmine_lore.L3.png":"9ace211e74","/img/village/animations/ironmine_lore.L4.png":"55e3793d10","/img/village/animations/ironmine_lore.L5.png":"081dac6d70","/img/village/animations/ironmine_lore.L6.png":"785a474884","/img/village/animations/ironmine_pick.L1.png":"696599bad8","/img/village/animations/ironmine_pick.L2.png":"dc605c18be","/img/village/animations/ironmine_pick.L3.png":"c427ee028a","/img/village/animations/ironmine_pick.L4.png":"8db5f22eca","/img/village/animations/ironmine_pick.L5.png":"3a533f0c84","/img/village/animations/ironmine_pick.L6.png":"bb7745be8b","/img/village/animations/ironmine_winch.L1.png":"85d2e45ba6","/img/village/animations/ironmine_winch.L2.png":"3e004bc482","/img/village/animations/ironmine_winch.L3.png":"ddbfda4e57","/img/village/animations/ironmine_winch.L4.png":"22e8505ebd","/img/village/animations/ironmine_winch.L5.png":"ef5263fae0","/img/village/animations/ironmine_winch.L6.png":"ee158c9b2e","/img/village/animations/marketer.png":"329b0bc793","/img/village/animations/mill.L1.night.png":"71a59b2132","/img/village/animations/mill.L1.png":"b96797c74b","/img/village/animations/mill.L2.night.png":"9da4bcb933","/img/village/animations/mill.L2.png":"7ed9392220","/img/village/animations/mill.L3.night.png":"35efdf82a3","/img/village/animations/mill.L3.png":"b636aa0465","/img/village/animations/mill.L4.night.png":"362c27386c","/img/village/animations/mill.L4.png":"a45f4eda52","/img/village/animations/mill.L5.night.png":"90d17fba15","/img/village/animations/mill.L5.png":"5ee9030644","/img/village/animations/mill.L6.night.png":"1fb4b20df4","/img/village/animations/mill.L6.png":"24a3b5415e","/img/village/animations/nobleman.png":"4aa0d9ea89","/img/village/animations/patient1.L1.png":"a72f159e07","/img/village/animations/patient1.L2.png":"420946f7cf","/img/village/animations/patient2.L1.png":"4992f91676","/img/village/animations/patient2.L2.png":"25660547ce","/img/village/animations/patient3.L1.png":"bc28c302ba","/img/village/animations/patient3.L2.png":"770c974dce","/img/village/animations/patient4.L1.png":"18901b0db5","/img/village/animations/patient4.L2.png":"71c344faea","/img/village/animations/patient5.L1.png":"5e44beb81e","/img/village/animations/patient5.L2.png":"6ac14e214a","/img/village/animations/patient6.L1.png":"92002270cb","/img/village/animations/patient6.L2.png":"a217577cff","/img/village/animations/river1.night.png":"cb10337804","/img/village/animations/river1.png":"4362109240","/img/village/animations/river2.night.png":"3d929b0d95","/img/village/animations/river2.png":"5c64ea2c85","/img/village/animations/river3.night.png":"f4d05e2c34","/img/village/animations/river3.png":"d313c92d85","/img/village/animations/stable_worker.png":"dbb1453bcd","/img/village/animations/stone_trader.png":"68304b3764","/img/village/animations/swordsman.png":"fd41b95cd7","/img/village/animations/tavern1.L1.png":"c1b5b1bc63","/img/village/animations/tavern1.L2.png":"f608eddb2d","/img/village/animations/tavern1.L3.png":"30ef7cfa10","/img/village/animations/tavern2.L2.png":"9de105c759","/img/village/animations/tavern2.L3.png":"221647a515","/img/village/animations/timbercamp_axe.L1.png":"eea93177a8","/img/village/animations/timbercamp_axe.L2.png":"f6acd8ffa6","/img/village/animations/timbercamp_axe.L3.png":"bd23dd0a7d","/img/village/animations/timbercamp_axe.L4.png":"df512100de","/img/village/animations/timbercamp_axe.L5.png":"f241559fb3","/img/village/animations/timbercamp_axe.L6.png":"d2707b7556","/img/village/animations/timbercamp_saw1.L2.png":"96ae180514","/img/village/animations/timbercamp_saw1.L3.png":"b8a6dba435","/img/village/animations/timbercamp_saw1.L4.png":"e8d173bdb1","/img/village/animations/timbercamp_saw1.L5.png":"5b53b82d05","/img/village/animations/timbercamp_saw1.L6.png":"4305624ca4","/img/village/animations/timbercamp_saw2.L3.png":"819cf50e9a","/img/village/animations/timbercamp_saw2.L4.png":"4c64acf806","/img/village/animations/timbercamp_saw2.L5.png":"d9d09fe934","/img/village/animations/timbercamp_saw2.L6.png":"cd126a08ea","/img/village/animations/waterfall.day.png":"c2027240da","/img/village/animations/waterfall.night.png":"2b2807e8a7","/img/village/animations/watermill.L5-6.night.png":"d00c4bebdf","/img/village/animations/watermill.L5-6.png":"fcf2fec09e","/img/village/day/BG_0_0.jpg":"e67aded4dc","/img/village/day/BG_0_0.png":"55faa41c68","/img/village/day/academy_l00_430_876.png":"f6ea86dcb2","/img/village/day/academy_l00_462_891_bs.png":"9db9b31c30","/img/village/day/academy_l00_bs_walls_01_437_813.png":"55f54cd539","/img/village/day/academy_l00_bs_walls_03_425_759.png":"8a6e9fd852","/img/village/day/academy_l00_wall_01_430_813.png":"74a166b4ad","/img/village/day/academy_l00_wall_02_430_813.png":"c445fd83d6","/img/village/day/academy_l00_wall_03_425_759.png":"4e517e5042","/img/village/day/academy_l00_walls_02_423_773.png":"81605ac475","/img/village/day/academy_l00_walls_02_423_773_bs.png":"81605ac475","/img/village/day/academy_l01_345_756_bs.png":"37f9d0b504","/img/village/day/academy_l01_345_771.png":"b5ef5e64f3","/img/village/day/baracks_l00_1468_716_bs.png":"220fba4167","/img/village/day/baracks_l00_1529_654.png":"d82d3d3d6f","/img/village/day/baracks_l01_1468_604.png":"6171330255","/img/village/day/baracks_l01_1468_604_bs.png":"d680f648ef","/img/village/day/baracks_l02_1477_590.png":"5c592e021e","/img/village/day/baracks_l02_1478_588_bs.png":"8600e16ebc","/img/village/day/baracks_l03_1471_593.png":"30155e1bfb","/img/village/day/baracks_l03_1471_593_bs.png":"9be9baedd1","/img/village/day/baracks_l04_1469_564.png":"d3d2b09850","/img/village/day/baracks_l04_1469_564_bs.png":"4e4354de8b","/img/village/day/baracks_l05_1468_545.png":"abecddc18c","/img/village/day/baracks_l05_1468_545_bs.png":"826312db88","/img/village/day/baracks_upgrade_academy_1727_463.png":"e932445ef6","/img/village/day/baracks_upgrade_axe_1777_676.png":"03d222ef71","/img/village/day/baracks_upgrade_ballistics_1640_877.png":"a96c791e41","/img/village/day/baracks_upgrade_compositeBow_1752_744.png":"b9915337ad","/img/village/day/baracks_upgrade_horseArmor_1438_746.png":"05b2b2138d","/img/village/day/baracks_upgrade_longBow_1818_666.png":"0391c40c58","/img/village/day/baracks_upgrade_spear_1841_511.png":"5f68d5630b","/img/village/day/baracks_upgrade_stable_1483_739.png":"959b66c0ca","/img/village/day/baracks_upgrade_sword_1771_493.png":"646e095b2d","/img/village/day/baracks_upgrade_workshop_1550_884.png":"e470787e4e","/img/village/day/baracks_walls_l00_back_1566_559_bs.png":"3387b5b386","/img/village/day/baracks_walls_l00_back_1668_558.png":"aa9a805c64","/img/village/day/baracks_walls_l00_front_1134_684_bs.png":"ee637284c6","/img/village/day/baracks_walls_l00_front_1134_714.png":"1ba2efd34d","/img/village/day/baracks_walls_l01_back_1564_538.png":"5986370c3f","/img/village/day/baracks_walls_l01_front_1146_618.png":"c2b4e70a73","/img/village/day/baracks_walls_l01_front_1146_618_bs.png":"db7ec12577","/img/village/day/baracks_walls_l02_back_1568_538.png":"4fe023eb34","/img/village/day/baracks_walls_l02_front_1145_607.png":"2aefee3f0b","/img/village/day/baracks_walls_l02_front_1145_607_bs.png":"202ff42095","/img/village/day/baracks_walls_l03_back_1568_538.png":"c4c562431a","/img/village/day/baracks_walls_l03_front_1143_615.png":"0d388f45a1","/img/village/day/baracks_walls_l03_front_1143_615_bs.png":"2bfdc53721","/img/village/day/chapel_1064_865.png":"4ff3787315","/img/village/day/chapel_1064_865_bs.png":"30764e4de6","/img/village/day/church_l00_1055_961_bs.png":"4e2e2433d3","/img/village/day/church_l00_1064_910.png":"9599229bf0","/img/village/day/church_l01_1071_865.png":"ef2ee1225b","/img/village/day/church_l01_1071_865_bs.png":"b41c834388","/img/village/day/church_l02_1051_830_bs.png":"642421ba56","/img/village/day/church_l02_1085_830.png":"de3f306cda","/img/village/day/church_l03_1038_668_bs.png":"7cd75391f8","/img/village/day/church_l03_1064_668.png":"2681b5da86","/img/village/day/claypit_l00_340_1467.png":"71d1f35260","/img/village/day/claypit_l00_340_1491_bs.png":"3436b5afa9","/img/village/day/claypit_l01_391_1473_bs.png":"36efd748d6","/img/village/day/claypit_l01_392_1477.png":"fdfd21a4f9","/img/village/day/claypit_l02_387_1477.png":"b06ee27609","/img/village/day/claypit_l02_387_1477_bs.png":"25cefcadd5","/img/village/day/claypit_l03_387_1432.png":"ed9e5216c2","/img/village/day/claypit_l03_387_1432_bs.png":"f8ce17c5bc","/img/village/day/claypit_l04_346_1432.png":"e95f4c9076","/img/village/day/claypit_l04_346_1432_bs.png":"f29cddc498","/img/village/day/claypit_l05_346_1427.png":"2e2db04091","/img/village/day/claypit_l05_346_1427_bs.png":"3e2aa3f12a","/img/village/day/claypit_l06_352_1425_bs.png":"a79dd27d47","/img/village/day/claypit_l06_353_1427.png":"fc64c05e1f","/img/village/day/fortress_l01_968_204_bs.png":"46551b1fdb","/img/village/day/fortress_l01_991_245.png":"b594452ae4","/img/village/day/fortress_l02_968_204_bs.png":"110d605cc4","/img/village/day/fortress_l02_991_226.png":"e26d3603b8","/img/village/day/fortress_l03_968_119_bs.png":"4816054a2f","/img/village/day/fortress_l03_991_144.png":"d72eff154b","/img/village/day/hamam_l01_1072_893.png":"67a608fccb","/img/village/day/hamam_l01_1072_893_bs.png":"a2ba68ae56","/img/village/day/hamam_l02_1073_909_bs.png":"52b56d0000","/img/village/day/hamam_l02_1078_899.png":"24e408d757","/img/village/day/hamam_l03_1077_840_bs.png":"dd565d4ba9","/img/village/day/hamam_l03_1079_840.png":"2ae6a3db89","/img/village/day/hamam_l04_1076_800.png":"0b24defc6f","/img/village/day/headquarter_l00_1052_442.png":"94ec6e9c0b","/img/village/day/headquarter_l01_1046_280.png":"749d63273b","/img/village/day/headquarter_l01_1046_280_bs.png":"52fb072e93","/img/village/day/headquarter_l02_1013_319.png":"8c9c285619","/img/village/day/headquarter_l02_1013_319_bs.png":"0e762d8600","/img/village/day/headquarter_l03_1018_293.png":"fd9c3635d2","/img/village/day/headquarter_l03_1018_293_bs.png":"aaf47160bb","/img/village/day/headquarter_l04_1018_272_bs.png":"3f85d0e25f","/img/village/day/headquarter_l04_1018_285.png":"9cc0a2dee5","/img/village/day/headquarter_l05_1013_266.png":"4ac1ef9fe9","/img/village/day/headquarter_l05_1013_266_bs.png":"b86dda782c","/img/village/day/headquarter_l06_1013_245.png":"885a82ee04","/img/village/day/headquarter_l06_1013_245_bs.png":"0b190c0de1","/img/village/day/hospital_l00_2034_849_bs.png":"85a1acac4f","/img/village/day/hospital_l00_2065_868.png":"ba81c50d4f","/img/village/day/hospital_l01_2022_719_bs.png":"dffaf739aa","/img/village/day/hospital_l01_2030_719.png":"5a715def3f","/img/village/day/hospital_l02_2010_672_bs.png":"3eb8bc0214","/img/village/day/hospital_l02_2012_672.png":"70ebe78fea","/img/village/day/ironmine_l00_408_133.png":"63e251d940","/img/village/day/ironmine_l01_408_133.png":"ad386afaeb","/img/village/day/ironmine_l01_408_133_bs.png":"ab6153ffbc","/img/village/day/ironmine_l02_408_133.png":"a6dd18f38b","/img/village/day/ironmine_l02_408_133_bs.png":"be477e093f","/img/village/day/ironmine_l03_408_133.png":"199f45a7a7","/img/village/day/ironmine_l03_408_133_bs.png":"7804cd67d9","/img/village/day/ironmine_l04_408_133.png":"6414b9e867","/img/village/day/ironmine_l04_408_133_bs.png":"1bfc77bb7e","/img/village/day/ironmine_l05_408_133.png":"2cf0d461f9","/img/village/day/ironmine_l05_408_133_bs.png":"126741bc49","/img/village/day/ironmine_l06_410_133.png":"e809467441","/img/village/day/ironmine_l06_410_133_bs.png":"b78c96d2c8","/img/village/day/market_l01_739_901.png":"031431ec52","/img/village/day/market_l01_739_901_bs.png":"e12070ff76","/img/village/day/market_l02_739_864_bs.png":"d388fb39ec","/img/village/day/market_l02_739_901.png":"d25c68acbf","/img/village/day/market_l03_683_863_bs.png":"93277ca33a","/img/village/day/market_l03_739_863.png":"f2af6fb3b0","/img/village/day/market_l04_645_866_bs.png":"1ca7f3aed5","/img/village/day/market_l04_705_863.png":"1d1885c8b0","/img/village/day/market_l05_643_862_bs.png":"6b05fd7014","/img/village/day/market_l05_647_863.png":"2efa7a7868","/img/village/day/market_upgrade_cart_767_897.png":"bbdfef9ab9","/img/village/day/market_upgrade_delivery_784_898.png":"53c46ebcdc","/img/village/day/market_upgrade_trade_routes_808_819.png":"da8892cf3c","/img/village/day/market_upgrade_trading_945_833.png":"f938334de4","/img/village/day/mill_l01_1977_169_bs.png":"aa7b3fa71d","/img/village/day/mill_l01_1986_169.png":"8b36a11821","/img/village/day/mill_l02_1981_169_bs.png":"a148ae9ced","/img/village/day/mill_l02_1986_169.png":"4a3fcac1f1","/img/village/day/mill_l03_1969_169_bs.png":"51f8a4483e","/img/village/day/mill_l03_1978_169.png":"df2c6d1d5c","/img/village/day/mill_l04_1977_219_bs.png":"af59a1ec99","/img/village/day/mill_l04_1980_219.png":"8e3ee224be","/img/village/day/mill_l05_1797_200_bs.png":"df59874ff7","/img/village/day/mill_l05_1806_200.png":"9ddc5fa0b0","/img/village/day/mill_l06_1797_200_bs.png":"e44dc7c66f","/img/village/day/mill_l06_1806_200.png":"7d707f48cd","/img/village/day/preceptory_l00_634_586.png":"3cab7de240","/img/village/day/preceptory_l00_634_586_bs.png":"a219c0733e","/img/village/day/preceptory_l01_709_382_bs.png":"b5bb5c818f","/img/village/day/preceptory_l01_728_392.png":"3d5244d914","/img/village/day/preceptory_l02_709_374_bs.png":"e4bd9aee11","/img/village/day/preceptory_l02_728_379.png":"55bafb9166","/img/village/day/rallyPoint_horns_1874_1116.png":"4fbec78cba","/img/village/day/rallyPoint_l00_1709_1024_bs.png":"e249ae8dc4","/img/village/day/rallyPoint_l00_1710_1059.png":"97e32339bb","/img/village/day/rallyPoint_l01_1709_1024.png":"94a6dfada7","/img/village/day/rallyPoint_l01_1709_1024_bs.png":"a2e4fec7d5","/img/village/day/rallyPoint_l02_1709_1024.png":"4111bedfe8","/img/village/day/rallyPoint_l02_1709_1024_bs.png":"442cae7f2c","/img/village/day/rallyPoint_l03_1709_1024.png":"1aaf52c407","/img/village/day/rallyPoint_l03_1709_1024_bs.png":"63421aed59","/img/village/day/statue_l00_1768_916_bs.png":"fb1710cede","/img/village/day/statue_l00_1768_923.png":"19d864a8a8","/img/village/day/statue_l01_1768_916_bs.png":"4861776b43","/img/village/day/statue_l01_1768_920.png":"2c2259380f","/img/village/day/statue_l02_1768_893_bs.png":"1c0ae09d40","/img/village/day/statue_l02_1768_924.png":"dfb123c528","/img/village/day/statue_l03_1775_883_bs.png":"273af73c82","/img/village/day/statue_l03_1775_911.png":"055b6bf253","/img/village/day/storage_l00_1425_1186.png":"f206ba3672","/img/village/day/storage_l00_1425_1264_bs.png":"f5a621c267",
"/img/village/day/storage_l01_1432_1163_bs.png":"27ed132574","/img/village/day/storage_l01_1446_1163.png":"43265ced38","/img/village/day/storage_l02_1430_1109_bs.png":"7447e18bf1","/img/village/day/storage_l02_1440_1121.png":"ae9d598f6f","/img/village/day/storage_l03_1411_1093_bs.png":"4a992d904d","/img/village/day/storage_l03_1420_1093.png":"70980e5dbd","/img/village/day/storage_l04_1370_1029_bs.png":"601d837846","/img/village/day/storage_l04_1383_1029.png":"08ad1de8b3","/img/village/day/storage_l05_1370_1030_bs.png":"c28f0f95c7","/img/village/day/storage_l05_1391_1030.png":"b91a5e2dc0","/img/village/day/storage_l06_1332_1026_bs.png":"da43c8bbac","/img/village/day/storage_l06_1359_1026.png":"0ebe8a97ef","/img/village/day/storage_upgrade_attic_1539_1046.png":"7275b8f790","/img/village/day/storage_upgrade_bunker_1592_1201.png":"337c49274f","/img/village/day/storage_upgrade_cellar_1624_1335.png":"8bdd5d144d","/img/village/day/tavern_l00_704_1194_bs.png":"5ce818bc93","/img/village/day/tavern_l00_733_1200.png":"cde8d8c145","/img/village/day/tavern_l01_708_1130_bs.png":"bcc161ddf6","/img/village/day/tavern_l01_731_1130.png":"38ed9ed013","/img/village/day/tavern_l02_697_1056_bs.png":"d666e69f6f","/img/village/day/tavern_l02_701_1056.png":"28272f4bce","/img/village/day/tavern_l03_709_1049_bs.png":"e682fffdfd","/img/village/day/tavern_l03_724_1049.png":"247b0dc79f","/img/village/day/timbercamp_l00_1919_1366.png":"3466cd34cc","/img/village/day/timbercamp_l00_1919_1366_bs.png":"37f0004d90","/img/village/day/timbercamp_l01_1832_1400.png":"3167ee8916","/img/village/day/timbercamp_l01_1919_1395_bs.png":"259213d519","/img/village/day/timbercamp_l02_1919_1395_bs.png":"de2102b5b4","/img/village/day/timbercamp_l02_1919_1398.png":"9cb93169c1","/img/village/day/timbercamp_l03_1919_1395_bs.png":"ecf397e8f6","/img/village/day/timbercamp_l03_1919_1398.png":"97a9a7df20","/img/village/day/timbercamp_l04_1919_1390.png":"4ff4d9291b","/img/village/day/timbercamp_l04_1919_1390_bs.png":"7b1f17ef45","/img/village/day/timbercamp_l05_1919_1390.png":"9d65e17e3f","/img/village/day/timbercamp_l05_1919_1390_bs.png":"459c354971","/img/village/day/timbercamp_l06_1919_1392.png":"d54612a8b5","/img/village/day/timbercamp_l06_1919_1392_bs.png":"277ea6d741","/img/village/day/walls_l00_244_503.png":"03b9bdcc01","/img/village/day/walls_l00_bs_back_479_467.png":"90e24c0293","/img/village/day/walls_l00_bs_front_405_1039.png":"09c63e96f0","/img/village/day/walls_l01_back_515_441.png":"2b27faf566","/img/village/day/walls_l01_back_515_441_bs.png":"ad8331fd64","/img/village/day/walls_l01_front_448_905.png":"06bdf18921","/img/village/day/walls_l01_front_448_905_bs.png":"7dfdf61d93","/img/village/day/walls_l01_front_reflections_991_1119.png":"c38e8cac1b","/img/village/day/walls_l01_front_reflections_991_1119_bs.png":"3ab83cad29","/img/village/day/walls_l02_back_477_454.png":"4795e2d70c","/img/village/day/walls_l02_back_477_454_bs.png":"0ffde00101","/img/village/day/walls_l02_front_423_922_bs.png":"3575fcc782","/img/village/day/walls_l02_front_423_923.png":"a57a370b19","/img/village/day/walls_l02_front_reflections_991_1119.png":"680e369b4f","/img/village/day/walls_l03_back_466_449.png":"fa8451c41e","/img/village/day/walls_l03_back_466_449_bs.png":"5312270384","/img/village/day/walls_l03_front_428_775_bs.png":"6edee89252","/img/village/day/walls_l03_front_428_930.png":"b85aeb3e73","/img/village/day/walls_l03_front_reflections_991_1119.png":"9d09adaf82","/img/village/night/BG_0_0_glow.png":"8c86c4331b","/img/village/night/BG_0_0_night.png":"42e7b2f787","/img/village/night/academy_l00_430_876_night.png":"d01f529b96","/img/village/night/academy_l00_462_891_bs_night.png":"1738fa07e6","/img/village/night/academy_l00_bs.nk_462_891_night.png":"fc0f4fdffb","/img/village/night/academy_l00_bs_462_891_night.png":"07b5e429a3","/img/village/night/academy_l00_bs_walls_01.nk_437_813_night.png":"a229cd116f","/img/village/night/academy_l00_bs_walls_01_437_813_night.png":"00531d3145","/img/village/night/academy_l00_bs_walls_02_423_773_night.png":"133fdeda0f","/img/village/night/academy_l00_bs_walls_03_425_759_night.png":"cbf1db7d2b","/img/village/night/academy_l00_wall_01_430_813_night.png":"20f32106e7","/img/village/night/academy_l00_wall_02_430_813_night.png":"f9276d5fc9","/img/village/night/academy_l00_wall_03_425_759_night.png":"bf32105e08","/img/village/night/academy_l00_walls_02_423_773_bs_night.png":"d71736f300","/img/village/night/academy_l01_345_756_bs_glow.png":"5669fa8d70","/img/village/night/academy_l01_345_756_bs_night.png":"b10b840214","/img/village/night/academy_l01_345_771_glow.png":"7e9ef2bc12","/img/village/night/academy_l01_345_771_night.png":"91ca0ec926","/img/village/night/baracks_l00_1468_716_bs_night.png":"d76fae7faf","/img/village/night/baracks_l00_1529_654_night.png":"c53e83861d","/img/village/night/baracks_l01_1468_604_bs_glow.png":"9b28086bbb","/img/village/night/baracks_l01_1468_604_bs_night.png":"adc6a7ad26","/img/village/night/baracks_l01_1468_604_glow.png":"1a0c01759a","/img/village/night/baracks_l01_1468_604_night.png":"7bc0af089c","/img/village/night/baracks_l02_1477_590_glow.png":"d0876e8960","/img/village/night/baracks_l02_1477_590_night.png":"fcef254e22","/img/village/night/baracks_l02_1478_588_bs_glow.png":"9048c19020","/img/village/night/baracks_l02_1478_588_bs_night.png":"64eef11d88","/img/village/night/baracks_l03_1471_593_bs_glow.png":"cf49f411e2","/img/village/night/baracks_l03_1471_593_bs_night.png":"0631eb97ef","/img/village/night/baracks_l03_1471_593_glow.png":"71508a305c","/img/village/night/baracks_l03_1471_593_night.png":"0ff631f93f","/img/village/night/baracks_l04_1469_564_bs_glow.png":"adb7c7af0f","/img/village/night/baracks_l04_1469_564_bs_night.png":"d43602b2e2","/img/village/night/baracks_l04_1469_564_glow.png":"7cd17c8e97","/img/village/night/baracks_l04_1469_564_night.png":"a56df4cc5d","/img/village/night/baracks_l05_1468_545_bs_glow.png":"c1ce7896b8","/img/village/night/baracks_l05_1468_545_bs_night.png":"a5d0371122","/img/village/night/baracks_l05_1468_545_glow.png":"4310436cf4","/img/village/night/baracks_l05_1468_545_night.png":"59aae29289","/img/village/night/baracks_upgrade_academy_1727_463_glow.png":"1513d97991","/img/village/night/baracks_upgrade_academy_1727_463_night.png":"3ddacb4b99","/img/village/night/baracks_upgrade_axe_1777_676_glow.png":"d3366c4a63","/img/village/night/baracks_upgrade_axe_1777_676_night.png":"bec591ff47","/img/village/night/baracks_upgrade_ballistics_1640_877_glow.png":"ed4b1f4b0d","/img/village/night/baracks_upgrade_ballistics_1640_877_night.png":"0cfe75c258","/img/village/night/baracks_upgrade_compositeBow_1752_744_glow.png":"e5c6737b10","/img/village/night/baracks_upgrade_compositeBow_1752_744_night.png":"6fd24de654","/img/village/night/baracks_upgrade_horseArmor_1438_746_glow.png":"3f33d4b4d1","/img/village/night/baracks_upgrade_horseArmor_1438_746_night.png":"40a6976f7a","/img/village/night/baracks_upgrade_longBow_1818_666_glow.png":"cc8466c869","/img/village/night/baracks_upgrade_longBow_1818_666_night.png":"305e8f089f","/img/village/night/baracks_upgrade_spear_1841_511_glow.png":"0b2b8ae621","/img/village/night/baracks_upgrade_spear_1841_511_night.png":"25615699bf","/img/village/night/baracks_upgrade_stable_1483_739_night.png":"6b8c66dfe3","/img/village/night/baracks_upgrade_sword_1771_493_glow.png":"15bf85804d","/img/village/night/baracks_upgrade_sword_1771_493_night.png":"7c2665c15a","/img/village/night/baracks_upgrade_workshop_1550_884_glow.png":"55eccb1e73","/img/village/night/baracks_upgrade_workshop_1550_884_night.png":"6ab637ff39","/img/village/night/baracks_walls_l00_back_1566_559_bs_night.png":"3819e4066c","/img/village/night/baracks_walls_l00_back_1668_558_night.png":"3997eb32f6","/img/village/night/baracks_walls_l00_front_1134_684_bs_night.png":"6b77dce2ef","/img/village/night/baracks_walls_l00_front_1134_714_night.png":"294d801dfe","/img/village/night/baracks_walls_l01_back_1564_538_night.png":"025da63cce","/img/village/night/baracks_walls_l01_front_1146_618_bs_night.png":"7f81fbbd78","/img/village/night/baracks_walls_l01_front_1146_618_night.png":"989c1f4ea4","/img/village/night/baracks_walls_l02_back_1568_538_night.png":"e745247dbf","/img/village/night/baracks_walls_l02_front_1145_607_bs_night.png":"f77a217000","/img/village/night/baracks_walls_l02_front_1145_607_night.png":"99b2716099","/img/village/night/baracks_walls_l03_back_1568_538_night.png":"c2d42f29eb","/img/village/night/baracks_walls_l03_front_1143_615_bs_night.png":"09bb700ea5","/img/village/night/baracks_walls_l03_front_1143_615_night.png":"f6dc521327","/img/village/night/chapel_1064_865_bs_glow.png":"71e7271714","/img/village/night/chapel_1064_865_bs_night.png":"156f7a13d9","/img/village/night/chapel_1064_865_glow.png":"a471162c23","/img/village/night/chapel_1064_865_night.png":"53d3e28d22","/img/village/night/church_l00_1055_961_bs_glow.png":"49d3ae1b88","/img/village/night/church_l00_1055_961_bs_night.png":"69cf65b884","/img/village/night/church_l00_1064_910_night.png":"6f9a02427c","/img/village/night/church_l01_1071_865_bs_glow.png":"80f7ba2886","/img/village/night/church_l01_1071_865_bs_night.png":"9818186bb1","/img/village/night/church_l01_1071_865_glow.png":"9f5f4375a6","/img/village/night/church_l01_1071_865_night.png":"4c8a2176a0","/img/village/night/church_l02_1051_830_bs_glow.png":"af81c2558d","/img/village/night/church_l02_1051_830_bs_night.png":"fd967eef03","/img/village/night/church_l02_1085_830_glow.png":"956b6e6b39","/img/village/night/church_l02_1085_830_night.png":"1f66954461","/img/village/night/church_l03_1038_668_bs_glow.png":"26c8e1a63d","/img/village/night/church_l03_1038_668_bs_night.png":"39de71c9b4","/img/village/night/church_l03_1064_668_glow.png":"82897e8988","/img/village/night/church_l03_1064_668_night.png":"e4821c7546","/img/village/night/claypit_l00_340_1467_night.png":"e1f5813c0f","/img/village/night/claypit_l00_340_1491_bs_glow.png":"99a4ba1858","/img/village/night/claypit_l00_340_1491_bs_night.png":"0c3b3f8678","/img/village/night/claypit_l00_407_1493_night.png":"5bb8b576f8","/img/village/night/claypit_l01_391_1473_bs_glow.png":"30a54e4803","/img/village/night/claypit_l01_391_1473_bs_night.png":"14322b702f","/img/village/night/claypit_l01_392_1477_glow.png":"9949af19a1","/img/village/night/claypit_l01_392_1477_night.png":"043c1a912e","/img/village/night/claypit_l02_387_1477_bs_glow.png":"0c857d704f","/img/village/night/claypit_l02_387_1477_bs_night.png":"add44364da","/img/village/night/claypit_l02_387_1477_glow.png":"0e04c8bb30","/img/village/night/claypit_l02_387_1477_night.png":"04898ba2fc","/img/village/night/claypit_l03_387_1432_bs_glow.png":"18b3fc01ba","/img/village/night/claypit_l03_387_1432_bs_night.png":"f6bac74cfd","/img/village/night/claypit_l03_387_1432_glow.png":"839530f744","/img/village/night/claypit_l03_387_1432_night.png":"a41fd623fd","/img/village/night/claypit_l04_346_1432_bs_glow.png":"90b60877b4","/img/village/night/claypit_l04_346_1432_bs_night.png":"a892770246","/img/village/night/claypit_l04_346_1432_glow.png":"1a2b423367","/img/village/night/claypit_l04_346_1432_night.png":"2078f34bdf","/img/village/night/claypit_l05_346_1427_bs_glow.png":"68e8d599df","/img/village/night/claypit_l05_346_1427_bs_night.png":"f2a8b079df","/img/village/night/claypit_l05_346_1427_glow.png":"8e1302e893","/img/village/night/claypit_l05_346_1427_night.png":"9e2e0f96d0","/img/village/night/claypit_l06_352_1425_bs_glow.png":"61d76784c2","/img/village/night/claypit_l06_352_1425_bs_night.png":"5e3836630d","/img/village/night/claypit_l06_353_1427_glow.png":"57056fc92a","/img/village/night/claypit_l06_353_1427_night.png":"1a4a4baa12","/img/village/night/fortress_l01_968_204_bs_glow.png":"7d93729ac5","/img/village/night/fortress_l01_968_204_bs_night.png":"bc673b46fc","/img/village/night/fortress_l01_968_204_glow.png":"722f06c77d","/img/village/night/fortress_l01_968_204_night.png":"25828915b1","/img/village/night/fortress_l01_991_245_glow.png":"cca7cc416c","/img/village/night/fortress_l01_991_245_night.png":"ddd86cc5a3","/img/village/night/fortress_l02_968_204_bs_glow.png":"a282b2ee4b","/img/village/night/fortress_l02_968_204_bs_night.png":"5433858b50","/img/village/night/fortress_l02_991_226_glow.png":"a4f9f85cd3","/img/village/night/fortress_l02_991_226_night.png":"43f463e86c","/img/village/night/fortress_l03_968_119_bs_glow.png":"25625238b1","/img/village/night/fortress_l03_968_119_bs_night.png":"619ab1bc50","/img/village/night/fortress_l03_991_144_glow.png":"0131ecebff","/img/village/night/fortress_l03_991_144_night.png":"e06e97dcdb","/img/village/night/headquarter_l00_1052_442_night.png":"388494e3b5","/img/village/night/headquarter_l01_1046_280_bs_glow.png":"8a4f5c30fc","/img/village/night/headquarter_l01_1046_280_bs_night.png":"b29ab0fafd","/img/village/night/headquarter_l01_1046_280_glow.png":"47c25f9d10","/img/village/night/headquarter_l01_1046_280_night.png":"3783da2b55","/img/village/night/headquarter_l02_1013_319_bs_glow.png":"e2a09872a9","/img/village/night/headquarter_l02_1013_319_bs_night.png":"cf7234d2ab","/img/village/night/headquarter_l02_1013_319_glow.png":"85dcc47f53","/img/village/night/headquarter_l02_1013_319_night.png":"858ebcee05","/img/village/night/headquarter_l03_1018_293_bs_glow.png":"5b730b79e4","/img/village/night/headquarter_l03_1018_293_bs_night.png":"1785cc56e5","/img/village/night/headquarter_l03_1018_293_glow.png":"79583ee551","/img/village/night/headquarter_l03_1018_293_night.png":"9d7cc0eabd","/img/village/night/headquarter_l04_1018_272_bs_glow.png":"118be3b175","/img/village/night/headquarter_l04_1018_272_bs_night.png":"24769e1597","/img/village/night/headquarter_l04_1018_285_glow.png":"e45f8161d1","/img/village/night/headquarter_l04_1018_285_night.png":"074817ce3e","/img/village/night/headquarter_l05_1013_266_bs_glow.png":"3e89fd4cb6","/img/village/night/headquarter_l05_1013_266_bs_night.png":"2e8009656c","/img/village/night/headquarter_l05_1013_266_glow.png":"17b1cab44b","/img/village/night/headquarter_l05_1013_266_night.png":"bb2a034a13","/img/village/night/headquarter_l06_1013_245_bs_glow.png":"612d4c463d","/img/village/night/headquarter_l06_1013_245_bs_night.png":"1b451d8daa","/img/village/night/headquarter_l06_1013_245_glow.png":"76f7e1ea8b","/img/village/night/headquarter_l06_1013_245_night.png":"f4342d2edf","/img/village/night/hospital_l00_2034_849_bs_glow.png":"a4debd6abd","/img/village/night/hospital_l00_2034_849_bs_night.png":"514d112df2","/img/village/night/hospital_l00_2065_868_night.png":"16c808fdc5","/img/village/night/hospital_l01_2022_719_bs_glow.png":"9735697078","/img/village/night/hospital_l01_2022_719_bs_night.png":"075c7da7f7","/img/village/night/hospital_l01_2030_719_glow.png":"094f55b516","/img/village/night/hospital_l01_2030_719_night.png":"9c3a943e7b","/img/village/night/hospital_l02_2010_672_bs_glow.png":"2ddabdf3ee","/img/village/night/hospital_l02_2010_672_bs_night.png":"7b647301b0","/img/village/night/hospital_l02_2012_672_glow.png":"caf1982432","/img/village/night/hospital_l02_2012_672_night.png":"6d5ac6e062","/img/village/night/ironmine_l00_408_133_night.png":"665e82d508","/img/village/night/ironmine_l01_408_133_bs_glow.png":"3f3c20069d","/img/village/night/ironmine_l01_408_133_bs_night.png":"536b9b76f4","/img/village/night/ironmine_l01_408_133_glow.png":"66698da070","/img/village/night/ironmine_l01_408_133_night.png":"7a668dd6c7","/img/village/night/ironmine_l02_408_133_bs_glow.png":"8bbd91ecda","/img/village/night/ironmine_l02_408_133_bs_night.png":"76983979d4","/img/village/night/ironmine_l02_408_133_glow.png":"ffcf6d5971","/img/village/night/ironmine_l02_408_133_night.png":"34f80c7cee","/img/village/night/ironmine_l03_408_133_bs_glow.png":"2052ac52ab","/img/village/night/ironmine_l03_408_133_bs_night.png":"300f0307df","/img/village/night/ironmine_l03_408_133_glow.png":"7bc14ad867","/img/village/night/ironmine_l03_408_133_night.png":"f10feefee8","/img/village/night/ironmine_l04_408_133_bs_glow.png":"89d0cc3aed","/img/village/night/ironmine_l04_408_133_bs_night.png":"e782ab7085","/img/village/night/ironmine_l04_408_133_glow.png":"a94ebe533a","/img/village/night/ironmine_l04_408_133_night.png":"9883e97342","/img/village/night/ironmine_l05_408_133_bs_glow.png":"a8f38928f9","/img/village/night/ironmine_l05_408_133_bs_night.png":"20405ee77e","/img/village/night/ironmine_l05_408_133_glow.png":"9a22921bbf","/img/village/night/ironmine_l05_408_133_night.png":"88f76c0a61","/img/village/night/ironmine_l06_410_133_bs_glow.png":"09230a86d9","/img/village/night/ironmine_l06_410_133_bs_night.png":"a94557c5c6","/img/village/night/ironmine_l06_410_133_glow.png":"afeae6dc34","/img/village/night/ironmine_l06_410_133_night.png":"00b41e490b","/img/village/night/market_l01_739_901_bs_night.png":"d8d6212e49","/img/village/night/market_l01_739_901_night.png":"a348c9cd58","/img/village/night/market_l02_739_864_bs_night.png":"7c8e20afb0","/img/village/night/market_l02_739_864_night.png":"b5c00b6a2a","/img/village/night/market_l02_739_901_night.png":"952fdb8fa4","/img/village/night/market_l03_683_863_bs_night.png":"28013d1e67","/img/village/night/market_l03_739_863_night.png":"348e10e419","/img/village/night/market_l04_645_866_bs_night.png":"1d572ff8aa","/img/village/night/market_l04_705_863_night.png":"fc7019e4e4","/img/village/night/market_l05_643_862_bs_night.png":"255b1010e1","/img/village/night/market_l05_647_863_night.png":"f4ca4ea148","/img/village/night/market_upgrade_cart_767_897_night.png":"1e5b69a763","/img/village/night/market_upgrade_delivery_784_898_night.png":"e9a9f579ef","/img/village/night/market_upgrade_trade_routes_808_819_night.png":"a17b78cf37","/img/village/night/market_upgrade_trading_945_833_night.png":"297bfb4e41","/img/village/night/mill_l01_1977_169_bs_glow.png":"0415895e91","/img/village/night/mill_l01_1977_169_bs_night.png":"621c422a0d","/img/village/night/mill_l01_1986_169_glow.png":"083db0107f","/img/village/night/mill_l01_1986_169_night.png":"506e1cc601","/img/village/night/mill_l02_1981_169_bs_glow.png":"27c7557bd3","/img/village/night/mill_l02_1981_169_bs_night.png":"a10ae6d724","/img/village/night/mill_l02_1986_169_glow.png":"7f0ee18d62","/img/village/night/mill_l02_1986_169_night.png":"ffc3e8078e","/img/village/night/mill_l03_1969_169_bs_glow.png":"02d32dd968","/img/village/night/mill_l03_1969_169_bs_night.png":"72270ba68a","/img/village/night/mill_l03_1978_169_glow.png":"4750bd7028","/img/village/night/mill_l03_1978_169_night.png":"5da1f03f04","/img/village/night/mill_l04_1977_219_bs_glow.png":"1b81811262","/img/village/night/mill_l04_1977_219_bs_night.png":"bee7d500e5","/img/village/night/mill_l04_1980_219_glow.png":"e5ef5f54a7","/img/village/night/mill_l04_1980_219_night.png":"1f096b6935","/img/village/night/mill_l05_1797_200_bs_glow.png":"58ab114f9d","/img/village/night/mill_l05_1797_200_bs_night.png":"a272297d70","/img/village/night/mill_l05_1806_200_glow.png":"2ba29d0a97","/img/village/night/mill_l05_1806_200_night.png":"28b02f2761","/img/village/night/mill_l06_1797_200_bs_glow.png":"fc65f29808","/img/village/night/mill_l06_1797_200_bs_night.png":"4dcd71894a","/img/village/night/mill_l06_1806_200_glow.png":"860bd68e8a","/img/village/night/mill_l06_1806_200_night.png":"86d2f2e07a","/img/village/night/preceptory_l00_634_586_bs_night.png":"8d64cf7764","/img/village/night/preceptory_l00_634_586_night.png":"304f6e8eb7","/img/village/night/preceptory_l01_709_382_bs_glow.png":"e07c6c0867","/img/village/night/preceptory_l01_709_382_bs_night.png":"f024abe5a6","/img/village/night/preceptory_l01_728_392_glow.png":"1518646ae1","/img/village/night/preceptory_l01_728_392_night.png":"3a1691d070","/img/village/night/preceptory_l02_709_374_bs_glow.png":"d15c78c5af","/img/village/night/preceptory_l02_709_374_bs_night.png":"ba7b009de8","/img/village/night/preceptory_l02_728_379_glow.png":"ec33a2e71a","/img/village/night/preceptory_l02_728_379_night.png":"87c179fa47","/img/village/night/rallyPoint_horns_1874_1116_night.png":"78921b3fdc","/img/village/night/rallyPoint_l00_1709_1024_bs_glow.png":"c493ee639f","/img/village/night/rallyPoint_l00_1709_1024_bs_night.png":"cf5b27966d","/img/village/night/rallyPoint_l00_1710_1059_night.png":"58a8380897","/img/village/night/rallyPoint_l01_1709_1024_bs_glow.png":"5c7979405d","/img/village/night/rallyPoint_l01_1709_1024_bs_night.png":"7f51bab4cc","/img/village/night/rallyPoint_l01_1709_1024_glow.png":"531951e17b","/img/village/night/rallyPoint_l01_1709_1024_night.png":"e7d634cf2f","/img/village/night/rallyPoint_l02_1709_1024_bs_glow.png":"33e9467468","/img/village/night/rallyPoint_l02_1709_1024_bs_night.png":"994bd9b6b5","/img/village/night/rallyPoint_l02_1709_1024_glow.png":"6e0d7fc2bf","/img/village/night/rallyPoint_l02_1709_1024_night.png":"3f2723a9ae","/img/village/night/rallyPoint_l03_1709_1024_bs_glow.png":"78966ee687","/img/village/night/rallyPoint_l03_1709_1024_bs_night.png":"60deb2567f","/img/village/night/rallyPoint_l03_1709_1024_glow.png":"01e717929d","/img/village/night/rallyPoint_l03_1709_1024_night.png":"fdce09572b","/img/village/night/statue_l00_1768_916_bs_night.png":"cb8f8a1a5a","/img/village/night/statue_l00_1768_923_night.png":"d27de5f2ad","/img/village/night/statue_l01_1768_916_bs_night.png":"0305410471","/img/village/night/statue_l01_1768_920_night.png":"9938372a76","/img/village/night/statue_l02_1768_893_bs_night.png":"9f107c3b56","/img/village/night/statue_l02_1768_924_night.png":"d316a84052","/img/village/night/statue_l03_1775_883_bs_night.png":"05282f1b64","/img/village/night/statue_l03_1775_911_night.png":"37c9438568","/img/village/night/storage_l00_1425_1186_glow.png":"db9d4badc2","/img/village/night/storage_l00_1425_1186_night.png":"9ca72a2d5e","/img/village/night/storage_l01_1432_1163_bs_glow.png":"606683681a","/img/village/night/storage_l01_1432_1163_bs_night.png":"ad859d1929","/img/village/night/storage_l01_1446_1163_glow.png":"3f1bdd92da","/img/village/night/storage_l01_1446_1163_night.png":"1edb3b70bd","/img/village/night/storage_l02_1430_1109_bs_glow.png":"84d800b9d1","/img/village/night/storage_l02_1430_1109_bs_night.png":"c7132e7b5c","/img/village/night/storage_l02_1440_1121_glow.png":"81458db55c","/img/village/night/storage_l02_1440_1121_night.png":"dbbe7bdefc","/img/village/night/storage_l03_1411_1093_bs_glow.png":"9f59bf913a","/img/village/night/storage_l03_1411_1093_bs_night.png":"d44cd068b4","/img/village/night/storage_l03_1420_1093_glow.png":"9bedf6b46b","/img/village/night/storage_l03_1420_1093_night.png":"85d9ec758f","/img/village/night/storage_l04_1370_1029_bs_glow.png":"7400651f9a","/img/village/night/storage_l04_1370_1029_bs_night.png":"8a1283482c","/img/village/night/storage_l04_1383_1029_glow.png":"017cdd20c9","/img/village/night/storage_l04_1383_1029_night.png":"e27128cb19","/img/village/night/storage_l05_1370_1030_bs_glow.png":"f5f74b203a","/img/village/night/storage_l05_1370_1030_bs_night.png":"848d88da42","/img/village/night/storage_l05_1391_1030_glow.png":"42a611a8ce","/img/village/night/storage_l05_1391_1030_night.png":"785537b02d","/img/village/night/storage_l06_1332_1026_bs_glow.png":"addba37c54","/img/village/night/storage_l06_1332_1026_bs_night.png":"658fd12681","/img/village/night/storage_l06_1359_1026_glow.png":"f49882e861","/img/village/night/storage_l06_1359_1026_night.png":"1ed27def9c","/img/village/night/storage_upgrade_attic_1539_1046_glow.png":"a99ee21b30","/img/village/night/storage_upgrade_attic_1539_1046_night.png":"d78a66b124","/img/village/night/storage_upgrade_bunker_1592_1201_glow.png":"e04fda49ca","/img/village/night/storage_upgrade_bunker_1592_1201_night.png":"9132a44b99","/img/village/night/tavern_l00_704_1194_bs_night.png":"9f6fe3c954","/img/village/night/tavern_l00_733_1200_night.png":"b57e174f22","/img/village/night/tavern_l01_708_1130_bs_glow.png":"01964017be","/img/village/night/tavern_l01_708_1130_bs_night.png":"45c013a15b","/img/village/night/tavern_l01_731_1130_glow.png":"5dd950c57b","/img/village/night/tavern_l01_731_1130_night.png":"744ae03b8a","/img/village/night/tavern_l02_697_1056_bs_glow.png":"c38ce3252a","/img/village/night/tavern_l02_697_1056_bs_night.png":"52757cd287","/img/village/night/tavern_l02_701_1056_glow.png":"6c7fbdb175","/img/village/night/tavern_l02_701_1056_night.png":"777345be3e","/img/village/night/tavern_l03_709_1049_bs_glow.png":"2c305b0504","/img/village/night/tavern_l03_709_1049_bs_night.png":"ccc693e180","/img/village/night/tavern_l03_724_1049_glow.png":"8b3e517bde","/img/village/night/tavern_l03_724_1049_night.png":"332d1af939","/img/village/night/timbercamp_l00_1919_1366_bs_night.png":"02efab2d95","/img/village/night/timbercamp_l00_1919_1366_night.png":"d5e530315d","/img/village/night/timbercamp_l01_1832_1400_glow.png":"edd1deb42b","/img/village/night/timbercamp_l01_1832_1400_night.png":"1a98f7efa6","/img/village/night/timbercamp_l01_1919_1395_bs_glow.png":"f189742d83","/img/village/night/timbercamp_l01_1919_1395_bs_night.png":"7c2023a113","/img/village/night/timbercamp_l02_1919_1395_bs_glow.png":"bf26af42c1","/img/village/night/timbercamp_l02_1919_1395_bs_night.png":"eda5acf628","/img/village/night/timbercamp_l02_1919_1398_glow.png":"2916d1b12f","/img/village/night/timbercamp_l02_1919_1398_night.png":"0087bd4d30","/img/village/night/timbercamp_l03_1919_1395_bs_glow.png":"f723ae0ce5","/img/village/night/timbercamp_l03_1919_1395_bs_night.png":"52f374601b","/img/village/night/timbercamp_l03_1919_1398_glow.png":"6b9d0e3b06","/img/village/night/timbercamp_l03_1919_1398_night.png":"10545e103b","/img/village/night/timbercamp_l04_1919_1390_bs_glow.png":"31d294ad92","/img/village/night/timbercamp_l04_1919_1390_bs_night.png":"adb6051cd4","/img/village/night/timbercamp_l04_1919_1390_glow.png":"0ca8b2b2aa","/img/village/night/timbercamp_l04_1919_1390_night.png":"693d070724","/img/village/night/timbercamp_l05_1919_1390_bs_glow.png":"cfa1997e64","/img/village/night/timbercamp_l05_1919_1390_bs_night.png":"d80939cebe","/img/village/night/timbercamp_l05_1919_1390_glow.png":"7d1b4119c9","/img/village/night/timbercamp_l05_1919_1390_night.png":"2eec202b6e","/img/village/night/timbercamp_l06_1919_1392_bs_glow.png":"d3d0fa1867","/img/village/night/timbercamp_l06_1919_1392_bs_night.png":"f79e98977a","/img/village/night/timbercamp_l06_1919_1392_glow.png":"bef00bbd88","/img/village/night/timbercamp_l06_1919_1392_night.png":"7088c48cc1","/img/village/night/walls_l00_244_503_night.png":"4524f204c1","/img/village/night/walls_l00_bs_back_479_467_night.png":"ea0cee0ab6","/img/village/night/walls_l00_bs_front_405_1039_night.png":"5b7f8232de","/img/village/night/walls_l01_back_515_441_bs_glow.png":"792dfc60dd","/img/village/night/walls_l01_back_515_441_bs_night.png":"9a65c71b13","/img/village/night/walls_l01_back_515_441_glow.png":"cf5f764e53","/img/village/night/walls_l01_back_515_441_night.png":"801ecc0058","/img/village/night/walls_l01_front_448_905_bs_glow.png":"0509c3b2ad","/img/village/night/walls_l01_front_448_905_bs_night.png":"c8b02eeb5b","/img/village/night/walls_l01_front_448_905_glow.png":"5e7815c844","/img/village/night/walls_l01_front_448_905_night.png":"44610f3ca8","/img/village/night/walls_l01_front_reflections_991_1119_bs_glow.png":"77c244aa8a","/img/village/night/walls_l01_front_reflections_991_1119_bs_night.png":"d76bc580cb","/img/village/night/walls_l01_front_reflections_991_1119_glow.png":"fd8c1276fa","/img/village/night/walls_l01_front_reflections_991_1119_night.png":"5a43da1491","/img/village/night/walls_l02_back_477_454_bs_night.png":"b49ce0318e","/img/village/night/walls_l02_back_477_454_night.png":"a58299825c","/img/village/night/walls_l02_front_423_922_bs_glow.png":"edd4c916b8","/img/village/night/walls_l02_front_423_922_bs_night.png":"360c5cc45c","/img/village/night/walls_l02_front_423_923_glow.png":"069d535cd4","/img/village/night/walls_l02_front_423_923_night.png":"fca3b33446","/img/village/night/walls_l02_front_reflections_991_1119_glow.png":"1be7a2276c","/img/village/night/walls_l02_front_reflections_991_1119_night.png":"2abcc064f3","/img/village/night/walls_l03_back_466_449_bs_glow.png":"45c51060f5","/img/village/night/walls_l03_back_466_449_bs_night.png":"9d537af594","/img/village/night/walls_l03_back_466_449_glow.png":"45c51060f5","/img/village/night/walls_l03_back_466_449_night.png":"0203ea0970","/img/village/night/walls_l03_front_428_775_bs_glow.png":"f0af32b119","/img/village/night/walls_l03_front_428_775_bs_night.png":"07915081ca","/img/village/night/walls_l03_front_428_930_glow.png":"a2dca5ab19","/img/village/night/walls_l03_front_428_930_night.png":"69f234d9e8","/img/village/night/walls_l03_front_reflections_991_1119_glow.png":"0f46be4450","/img/village/night/walls_l03_front_reflections_991_1119_night.png":"2830d3ccf5","/img/window/batch-hot.png":"5d1e9589da","/img/window/border_paper_bg.jpg":"e6db22ba87","/img/window/border_paper_bottom_left.png":"75b6300760","/img/window/border_paper_bottom_middle.png":"776d754555","/img/window/border_paper_bottom_right.png":"4f300e6c82","/img/window/border_paper_left_bg.jpg":"8a175a475b","/img/window/border_paper_left_middle.png":"0530653e46","/img/window/border_paper_middle.png":"b75d85b264","/img/window/border_paper_right_bg.jpg":"2f7ffef739","/img/window/border_paper_right_middle.png":"b8d03e2f83","/img/window/border_paper_top_left.png":"5e2c4d0c90","/img/window/border_paper_top_middle.png":"03cdd19e14","/img/window/border_paper_top_right.png":"e2381fec7e","/img/window/button_list_deco.png":"2002097044","/img/window/button_list_delimiter.png":"9eec4acff7","/img/window/button_list_modal_deco.png":"542a683e42","/img/window/delimiter.png":"089def27b9","/img/window/epicness-indicator.png":"dae1b2f099","/img/window/footer_center.png":"fe62b9f49b","/img/window/footer_left.png":"a06bce784c","/img/window/footer_right.png":"15034b109c","/img/window/green_background_high.png":"d5be064183","/img/window/headline_big.png":"78bc71f191","/img/window/headline_medium.png":"861316140e","/img/window/headline_small.png":"7cdc52f52f","/img/window/headline_stripe.png":"a69ae76ba7","/img/window/modal/frame_bottom_center.png":"635ef23cce","/img/window/modal/frame_bottom_left.png":"7a66caefb9","/img/window/modal/frame_bottom_right.png":"cc1cc4636f","/img/window/modal/frame_left_center.png":"6224b438bf","/img/window/modal/frame_right_center.png":"a95b21b2a3","/img/window/modal/frame_top_center.png":"6a8a530d91","/img/window/modal/frame_top_left.png":"7f96abe6e5","/img/window/modal/frame_top_right.png":"59bf83a5a1","/img/window/modal/pattern.png":"5aba7113cb","/img/window/modal_border.png":"7df09bdfea","/img/window/modal_bottom_center.jpg":"63f512d8e9","/img/window/modal_bottom_left_border.jpg":"7b2b7a91e2","/img/window/modal_bottom_right_border.jpg":"dd808e8755","/img/window/modal_footer_center.jpg":"3c3815094e","/img/window/modal_footer_left.jpg":"258191d25c","/img/window/modal_footer_right.jpg":"246571cc49","/img/window/modal_head_center.jpg":"e5b744f1ea","/img/window/modal_head_left.jpg":"de6330c42a","/img/window/modal_head_right.png":"3dca53b278","/img/window/modal_left_center_border.jpg":"4e0f80395d","/img/window/modal_right_center_border.jpg":"4e0f80395d","/img/window/modal_top_center_border.jpg":"3c567666f1","/img/window/modal_top_left_border.jpg":"acb2ad9f28","/img/window/modal_top_right_border.jpg":"721f28e8ce","/img/window/msg_bg.png":"a2a209c128","/img/window/new_report.png":"5c8f9cbbac","/img/window/notifiy_banner_achievement.png":"10beb34080","/img/window/notifiy_banner_news.png":"1914cf26cb","/img/window/rte_arrow.png":"c6e0147c68","/img/window/rte_bg.png":"d8d2fa95fa","/img/window/rte_footer_left.png":"f354177daa","/img/window/rte_footer_section.png":"5693112712","/img/window/window_border_not_so_small_left.jpg":"9152f669b7","/img/window/window_border_not_so_small_right.jpg":"a36b0bc827","/img/window/window_button_bar.png":"f78107ce33","/img/window/window_headline_bg.png":"cb73ad5905","/img/window/window_headline_deco.png":"04afef44ab","/img/window/window_section_headline_bg.jpg":"071a5e5361","/img/window/window_section_headline_left.jpg":"0b6aac68fb",
"/img/window/window_section_headline_right.jpg":"4a9421c1ea","/img/window/window_top_bg.png":"ce78dc73f4","/img/window/window_top_gradient_left.png":"9328dcfe8f","/img/window/window_top_gradient_right.png":"b873f11c29","/css/icons.css":"6e902fbfe9","/css/landing-mobile.css":"100b5fc18b","/css/landing.css":"2552cddb06","/css/main.css":"b172c750e7","/css/registration-landing.css":"2d95ab4103","/bin/map_dev.binmap_dev.bin":"9dc2b8cf79","/bin/mapv2-rc1.bin":"e2b0a77e82","/bin/rd119_pv35_1000x1000.bin":"a8a2f10de8","/bin/rd1_pv30_ri8_1000x1000.bin":"6f8db71deb","/bin/rd2_pv30_ri8_1000x1000.bin":"7f992bbe4e","/bin/rd3_pv30_ri8_1000x1000.bin":"2c65e32736","/bin/rd957_pv35_1000x1000.bin":"b2a0469240","/sounds/attack.mp3":"f7638fc8c1","/sounds/attack.ogg":"17d54b4ae2","/sounds/defend.mp3":"99c8cf89ce","/sounds/defend.ogg":"793e0cebc0","/sounds/main.mp3":"d7a5bdbe18","/sounds/main.ogg":"bf2b7ef139","/sounds/night.mp3":"26e4e88d92","/sounds/night.ogg":"a2e1b3f3ae","/sounds/peace.mp3":"e4ea258e1b","/sounds/peace.ogg":"9a9c388c0b","/sounds/theme.mp3":"193386bceb","/sounds/theme.ogg":"4a12349f2e","/sounds/tutorial.mp3":"a618654607","/sounds/tutorial.ogg":"b53e5b3572"}}}),define("cdn",["conf/cdn"],function(a){var b=function(b,c){var d,e,f;return a.versionMap&&a.versionMap[b]?(d=b.split("."),f="."+d.pop(),e=d.join("."),c?e+"_"+a.versionMap[b]+f:a.host+e+"_"+a.versionMap[b]+f):b};return{getPath:b}}),define("helper/i18n",["angular","conf/conf","cdn"],function(a,b,c){return function(){var d,e,f,g="%s",h="%d",i="%i",j={},k="default",l="dev",m=function(a){return~~(1!==a)},n=function(b){a.extend(j,b);try{j.Meta&&(m=new Function("return ~~("+j.Meta["Plural-Forms"].match(/plural=[\d\w\W]+/g)[0].replace(/plural=|;/g,"").replace(/n/g,"arguments[0]")+")"))}catch(c){}},o=function(a,d){var e=c.getPath(b.I18N_PATH_EXT.join(a)),f=window.injector.get("httpService");f.get(e,function(a){n(a),d()})},p=function(a){e=e||window.injector.get("$rootScope"),e.loc||(e.loc={ale:null}),a&&(e.loc.ale=d)},q=function(){var a,c,e,f=[d],g=function(){c--,0===c&&(e=e||window.injector.get("$timeout"))(function(){p(!0)})};for(b.ENV===l&&d===k&&(f.push("quests_default"),f.push("quests_tree_1")),c=f.length,a=0;a<f.length;a++)o(f[a],g)},r=function(a){return d=(a||navigator.language).toLowerCase(),2===d.length&&(d+="-"+d),d},s=function(a){r(a),p(),f=f||window.injector.get("l10nService"),f.setLocale(d),q()},t=function(a){var b,c=j;if(!a)throw new Error("No key given");if(!(a instanceof Array))throw new Error("key must be an instance of Array!");for(b=0;b<a.length;b++){if(!c[a[b]])return null;c=c[a[b]]}return c},u=function(a,b){var c,d,e=[];return b?(e=[].concat(b),e.push(a)):e=[a],c=t(e),d=!!c,d&&y(e)?!0:!1},v=function(a){return a.replace(/%%(?!\d+)/g,"%")},w=function(a){return a.replace(/%%/g,"%")},x=function(a,b){var c=0;return b.length?v(a).split(/(%[0-9isd@])[$isd@]*/).map(function(a){var d=a.match(/%(\d)/);return d?(a=b[~~d[1]-1],c++):(a===g||a===h||a===i)&&(a=b[c++]),a}).join(""):w(a)},y=function(a){var c,d,e,f=Array.prototype.slice.call(arguments,0),g=t(a);if(b.SHOW_TRANSLATE_KEYS)return f.toString();if(g instanceof Array)d=f.length-1,e=parseInt(f[d],10),c=m(isNaN(e)?1:e),isNaN(c)&&(c=0),c=Math.floor(c.bound(0,g.length-1)),g=g[c];else if(void 0===g||null===g)return a;return"string"==typeof g?(f.shift(),x(g,f)):void 0};return window.getTextObject=function(a){return j[a]},{setLanguage:s,replace:x,unescape:v,unescapeNoReplacements:w,setJSON:n,s:y,hasTranslation:u,updateLocAle:p}}()}),define("conf/locale",[],function(){return{LANGUAGE:"pt_br",LOCALE:"pt_br"}}),define("queues/EventQueue",["plugins"],function(){var a=function(){var a={},b=[],c=this;this.register=function(b,c,d,e){if("function"!=typeof c)throw new TypeError(c.valueOf()+" is not a function!");a[b]||(a[b]=[]),a[b].push([c,d,e])},this.once=function(a,b){var d=function(){b(),c.unregister(a,d)};c.register(a,d)},this.unregister=function(b,c){if(!a[b])return!1;for(var d=a[b].length;d--;)if(a[b][d][0]===c)return a[b].remove(d),!0;return a[b].length||delete a[b],!1},this.trigger=function(a,c){b.push({type:a,data:c||{}}),window.twx&&window.twx.game&&window.twx.game.map&&window.twx.game.map.engine&&window.twx.game.map.engine.isRunning()||this.handle()},this.handle=function(){for(var c,d,e,f,g,h;c=b.shift();){if(void 0===c.type)throw new Error("Wrong event type.");if(e=a[c.type],e&&(d=e.length)){for(;d--;)!g&&a[c.type][d][2]&&(g=!0),(f=a[c.type][d][1])?a[c.type][d][0].call(f,c.type,c.data):a[c.type][d][0](c.type,c.data);g&&(h=window.injector.get("$rootScope"),h.$$phase||h.$apply())}}}};return a.prototype.types=["MAPDATA_UPDATE","MAPVIEW_UPDATE","CLICK","DOUBLECLICK","MOUSEDOWN","MOUSEUP","MOUSEOUT","MOUSEMOVE","NEW_FRAME","SPRITES_READY","RESIZE"].toEnum(),new a}),define("product-version",[],function(){return{major:1,minor:37,patch:0}}),define("version",["product-version"],function(a){var b={product:a,frontend:{major:1,minor:37,patch:0},api:{major:9,minor:"*",patch:"*"}};return b.product.toString=function(){return[this.major,this.minor].join(".")},b.frontend.toString=b.api.toString=function(){return[this.major,this.minor,this.patch].join(".")},b}),define("twx",["battlecat","helper/i18n","conf/conf","conf/locale","queues/EventQueue","raven","version"],function(a,b,c,d,e,f,g){var h=function(){document.onclick=function(a){var b,c=a.target||a.srcElement;try{for(;c;){if(c&&c.getAttribute&&(b=c.getAttribute("href"))){if("#"===b||b.match("#"))return a.preventDefault(),!1;break}c=c.parentNode}}catch(d){}},b.setLanguage(d.LANGUAGE),window.twx=window.twx||{},window.twx.game=window.twx.game||{},Mousetrap.stopCallback=function(a,b){return!1},e.register(e.types.SPRITES_READY,function(){a(window).resize(function(){e.trigger(e.types.RESIZE)})}),c.SENTRY_ENABLED&&f.config(c.SENTRY,{tags:{version:g.frontend.toString()}}).install()};return{init:h}}),/**
 * @license Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2012, Tim Down
 * Licensed under the MIT license.
 * Version: 1.2.3
 * Build date: 26 February 2012
 */
window.rangy=function(){function a(a,b){var c=typeof a[b];return c==l||!(c!=k||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=k||!a[b])}function c(a,b){return typeof a[b]!=m}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&r(a,q)&&t(a,p)}function f(a){window.alert("Rangy not supported in your browser. Reason: "+a),u.initialized=!0,u.supported=!1}function g(a){var b="Rangy warning: "+a;u.config.alertOnWarn?window.alert(b):typeof window.console!=m&&typeof window.console.log!=m&&window.console.log(b)}function h(){if(!u.initialized){var c,d=!1,g=!1;a(document,"createRange")&&(c=document.createRange(),r(c,o)&&t(c,n)&&(d=!0),c.detach());var h=b(document,"body")?document.body:document.getElementsByTagName("body")[0];h&&a(h,"createTextRange")&&(c=h.createTextRange(),e(c)&&(g=!0)),d||g||f("Neither Range nor TextRange are implemented"),u.initialized=!0,u.features={implementsDomRange:d,implementsTextRange:g};for(var i=w.concat(v),j=0,k=i.length;k>j;++j)try{i[j](u)}catch(l){b(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",l)}}}function i(a){a=a||window,h();for(var b=0,c=x.length;c>b;++b)x[b](a)}function j(a){this.name=a,this.initialized=!1,this.supported=!1}var k="object",l="function",m="undefined",n=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],p=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],q=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],r=d(a),s=d(b),t=d(c),u={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:r,areHostObjects:s,areHostProperties:t,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};u.fail=f,u.warn=g,{}.hasOwnProperty?u.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:f("hasOwnProperty not supported");var v=[],w=[];u.init=h,u.addInitListener=function(a){u.initialized?a(u):v.push(a)};var x=[];u.addCreateMissingNativeApiListener=function(a){x.push(a)},u.createMissingNativeApi=i,j.prototype.fail=function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},j.prototype.warn=function(a){u.warn("Module "+this.name+": "+a)},j.prototype.createError=function(a){return new Error("Error in Rangy "+this.name+" module: "+a)},u.createModule=function(a,b){var c=new j(a);u.modules[a]=c,w.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},u.requireModules=function(a){for(var b,c,d=0,e=a.length;e>d;++d){if(c=a[d],b=u.modules[c],!(b&&b instanceof j))throw new Error("Module '"+c+"' not found");if(!b.supported)throw new Error("Module '"+c+"' not supported")}};var y=!1,z=function(a){y||(y=!0,u.initialized||h())};return typeof window==m?void f("No window found"):typeof document==m?void f("No document found"):(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",z,!1),a(window,"addEventListener")?window.addEventListener("load",z,!1):a(window,"attachEvent")?window.attachEvent("onload",z):f("Window does not have required addEventListener or attachEvent method"),u)}(),rangy.createModule("DomUtil",function(a,b){function c(a){var b;return typeof a.namespaceURI==z||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)b++;return b}function f(a){var b;return j(a)?a.length:(b=a.childNodes)?b.length:0}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(D(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function j(a){var b=a.nodeType;return 3==b||4==b||8==b}function k(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function l(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),k(c,a),c}function m(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=z)return a.ownerDocument;if(typeof a.document!=z)return a.document;if(a.parentNode)return m(a.parentNode);throw new Error("getDocument: no document found for node")}function n(a){var b=m(a);if(typeof b.defaultView!=z)return b.defaultView;if(typeof b.parentWindow!=z)return b.parentWindow;throw new Error("Cannot get a window object for node")}function o(a){if(typeof a.contentDocument!=z)return a.contentDocument;if(typeof a.contentWindow!=z)return a.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function p(a){if(typeof a.contentWindow!=z)return a.contentWindow;if(typeof a.contentDocument!=z)return a.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function q(a){return A.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]}function r(a){for(var b;b=a.parentNode;)a=b;return a}function s(a,b,c,d){var f,h,j,k,l;if(a==c)return b===d?0:d>b?-1:1;if(f=i(c,a,!0))return b<=e(f)?-1:1;if(f=i(a,c,!0))return e(f)<d?-1:1;if(h=g(a,c),j=a===h?h:i(a,h,!0),k=c===h?h:i(c,h,!0),j===k)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(l=h.firstChild;l;){if(l===j)return-1;if(l===k)return 1;l=l.nextSibling}throw new Error("Should not be here!")}function t(a){for(var b,c=m(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function u(a){if(!a)return"[No node]";if(j(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+a.childNodes.length+"]"}return a.nodeName}function v(a){this.root=a,this._next=a}function w(a){return new v(a)}function x(a,b){this.node=a,this.offset=b}function y(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var z="undefined",A=a.util;A.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),A.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var B=document.createElement("div");A.areHostMethods(B,["insertBefore","appendChild","cloneNode"]||!A.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),A.isHostProperty(B,"innerHTML")||b.fail("Element is missing innerHTML property");var C=document.createTextNode("test");A.areHostMethods(C,["splitText","deleteData","insertData","appendData","cloneNode"]||!A.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"])||!A.areHostProperties(C,["data"]))||b.fail("Incomplete Text Node implementation");var D=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},x.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+u(this.node)+":"+this.offset+")]"}},y.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},y.prototype.toString=function(){return this.message},a.dom={arrayContains:D,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,getClosestAncestorIn:i,isCharacterDataNode:j,insertAfter:k,splitDataNode:l,getDocument:m,getWindow:n,getIframeWindow:p,getIframeDocument:o,getBody:q,getRootContainer:r,comparePoints:s,inspectNode:u,fragmentFromNodeChildren:t,createIterator:w,DomPosition:x},a.DOMException=y}),rangy.createModule("DomRange",function(a,b){function c(a,b){return 3!=a.nodeType&&(M.isAncestorOf(a,b.startContainer,!0)||M.isAncestorOf(a,b.endContainer,!0))}function d(a){return M.getDocument(a.startContainer)}function e(a,b,c){var d=a._listeners[b];if(d)for(var e=0,f=d.length;f>e;++e)d[e].call(a,{target:a,args:c})}function f(a){return new N(a.parentNode,M.getNodeIndex(a))}function g(a){return new N(a.parentNode,M.getNodeIndex(a)+1)}function h(a,b,c){var d=11==a.nodeType?a.firstChild:a;return M.isCharacterDataNode(b)?c==b.length?M.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:M.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function i(a){for(var b,c,e,f=d(a.range).createDocumentFragment();c=a.next();){if(b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(e=a.getSubtreeIterator(),c.appendChild(i(e)),e.detach(!0)),10==c.nodeType)throw new O("HIERARCHY_REQUEST_ERR");f.appendChild(c)}return f}function j(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return void(c.stop=!0);if(g=a.getSubtreeIterator(),j(g,b,c),g.detach(!0),c.stop)return}else for(d=M.createIterator(f);e=d.next();)if(b(e)===!1)return void(c.stop=!0)}function k(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),k(b),b.detach(!0)):a.remove()}function l(a){for(var b,c,e=d(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),c=a.getSubtreeIterator(),b.appendChild(l(c)),c.detach(!0)):a.remove(),10==b.nodeType)throw new O("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function m(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return j(new o(a,!1),function(a){e&&!d.test(a.nodeType)||f&&!c(a)||g.push(a)}),g}function n(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+M.inspectNode(a.startContainer)+":"+a.startOffset+", "+M.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function o(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&M.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||M.isCharacterDataNode(this.sc)?M.getClosestAncestorIn(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||M.isCharacterDataNode(this.ec)?M.getClosestAncestorIn(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function p(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function q(a,b,c){this.nodes=m(a,b,c),this._next=this.nodes[0],this._position=0}function r(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,M.arrayContains(a,d))return e;e=e.parentNode}return null}}function s(a,b){if(X(a,b))throw new p("INVALID_NODE_TYPE_ERR")}function t(a){if(!a.startContainer)throw new O("INVALID_STATE_ERR")}function u(a,b){if(!M.arrayContains(b,a.nodeType))throw new p("INVALID_NODE_TYPE_ERR")}function v(a,b){if(0>b||b>(M.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new O("INDEX_SIZE_ERR")}function w(a,b){if(V(a,!0)!==V(b,!0))throw new O("WRONG_DOCUMENT_ERR")}function x(a){if(W(a,!0))throw new O("NO_MODIFICATION_ALLOWED_ERR")}function y(a,b){if(!a)throw new O(b)}function z(a){return!M.arrayContains(Q,a.nodeType)&&!V(a,!0)}function A(a,b){return b<=(M.isCharacterDataNode(a)?a.length:a.childNodes.length)}function B(a){return!!a.startContainer&&!!a.endContainer&&!z(a.startContainer)&&!z(a.endContainer)&&A(a.startContainer,a.startOffset)&&A(a.endContainer,a.endOffset)}function C(a){if(t(a),!B(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function D(){}function E(a){a.START_TO_START=ba,a.START_TO_END=ca,a.END_TO_END=da,a.END_TO_START=ea,a.NODE_BEFORE=fa,a.NODE_AFTER=ga,a.NODE_BEFORE_AND_AFTER=ha,a.NODE_INSIDE=ia}function F(a){E(a),E(a.prototype)}function G(a,b){return function(){C(this);var c,d,e=this.startContainer,f=this.startOffset,h=this.commonAncestorContainer,i=new o(this,!0);e!==h&&(c=M.getClosestAncestorIn(e,h,!0),d=g(c),e=d.node,f=d.offset),j(i,x),i.reset();var k=a(i);return i.detach(),b(this,e,f,e,f),k}}function H(b,d,e){function h(a,b){return function(c){t(this),u(c,P),u(U(c),Q);var d=(a?f:g)(c);(b?i:j)(this,d.node,d.offset)}}function i(a,b,c){var e=a.endContainer,f=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((U(b)!=U(e)||1==M.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,b,c,e,f))}function j(a,b,c){var e=a.startContainer,f=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((U(b)!=U(e)||-1==M.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,e,f,b,c))}function m(a,b,c){(b!==a.startContainer||c!==a.startOffset||b!==a.endContainer||c!==a.endOffset)&&d(a,b,c,b,c)}b.prototype=new D,a.util.extend(b.prototype,{setStart:function(a,b){t(this),s(a,!0),v(a,b),i(this,a,b)},setEnd:function(a,b){t(this),s(a,!0),v(a,b),j(this,a,b)},setStartBefore:h(!0,!0),setStartAfter:h(!1,!0),setEndBefore:h(!0,!1),setEndAfter:h(!1,!1),collapse:function(a){C(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){t(this),s(a,!0),d(this,a,0,a,M.getNodeLength(a))},selectNode:function(a){t(this),s(a,!1),u(a,P);var b=f(a),c=g(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:G(l,d),deleteContents:G(k,d),canSurroundContents:function(){C(this),x(this.startContainer),x(this.endContainer);var a=new o(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},detach:function(){e(this)},splitBoundaries:function(){C(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=a===c;M.isCharacterDataNode(c)&&e>0&&e<c.length&&M.splitDataNode(c,e),M.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=M.splitDataNode(a,b),f?(e-=b,c=a):c==a.parentNode&&e>=M.getNodeIndex(a)&&e++,b=0),d(this,a,b,c,e)},normalizeBoundaries:function(){C(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(d){var f=d.previousSibling;if(f&&f.nodeType==d.nodeType){a=d;var g=d.length;if(b=f.length,d.insertData(0,f.data),f.parentNode.removeChild(f),a==c)e+=b,c=a;else if(c==d.parentNode){var h=M.getNodeIndex(d);e==h?(c=d,e=g):e>h&&e--}}},h=!0;if(M.isCharacterDataNode(c))c.length==e&&f(c);else{if(e>0){var i=c.childNodes[e-1];i&&M.isCharacterDataNode(i)&&f(i)}h=!this.collapsed}if(h){if(M.isCharacterDataNode(a))0==b&&g(a);else if(b<a.childNodes.length){var j=a.childNodes[b];j&&M.isCharacterDataNode(j)&&g(j)}}else a=c,b=e;d(this,a,b,c,e)},collapseToPoint:function(a,b){t(this),s(a,!0),v(a,b),m(this,a,b)}}),F(b)}function I(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:M.getCommonAncestor(a.startContainer,a.endContainer)}function J(a,b,c,d,f){var g=a.startContainer!==b||a.startOffset!==c,h=a.endContainer!==d||a.endOffset!==f;a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=f,I(a),e(a,"boundarychange",{startMoved:g,endMoved:h})}function K(a){t(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null,e(a,"detach",null),a._listeners=null}function L(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},I(this)}a.requireModules(["DomUtil"]);var M=a.dom,N=M.DomPosition,O=a.DOMException;o.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,M.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!M.isCharacterDataNode(c)||c!==this.sc&&c!==this.ec?c.parentNode&&c.parentNode.removeChild(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return c(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new L(d(this.range));var b=this._current,c=b,e=0,f=b,g=M.getNodeLength(b);M.isAncestorOf(b,this.sc,!0)&&(c=this.sc,e=this.so),M.isAncestorOf(b,this.ec,!0)&&(f=this.ec,g=this.eo),J(a,c,e,f,g)}return new o(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},p.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},p.prototype.toString=function(){return this.message},q.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var P=[1,3,4,5,7,8,10],Q=[2,9,11],R=[5,6,10,12],S=[1,3,4,5,7,8,10,11],T=[1,3,4,5,7,8],U=M.getRootContainer,V=r([9,11]),W=r(R),X=r([6,10,12]),Y=document.createElement("style"),Z=!1;try{Y.innerHTML="<b>x</b>",Z=3==Y.firstChild.nodeType}catch($){}a.features.htmlParsingConforms=Z;var _=Z?function(a){var b=this.startContainer,c=M.getDocument(b);if(!b)throw new O("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:M.isCharacterDataNode(b)&&(d=M.parentElement(b)),d=null===d||"HTML"==d.nodeName&&M.isHtmlNamespace(M.getDocument(d).documentElement)&&M.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,M.fragmentFromNodeChildren(d)}:function(a){t(this);var b=d(this),c=b.createElement("body");return c.innerHTML=a,M.fragmentFromNodeChildren(c)},aa=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ba=0,ca=1,da=2,ea=3,fa=0,ga=1,ha=2,ia=3;D.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){C(this),w(this.startContainer,b.startContainer);var c,d,e,f,g=a==ea||a==ba?"start":"end",h=a==ca||a==ba?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],M.comparePoints(c,d,e,f)},insertNode:function(a){if(C(this),u(a,S),x(this.startContainer),M.isAncestorOf(a,this.startContainer,!0))throw new O("HIERARCHY_REQUEST_ERR");var b=h(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){C(this);var a,b;if(this.collapsed)return d(this).createDocumentFragment();if(this.startContainer===this.endContainer&&M.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=d(this).createDocumentFragment(),b.appendChild(a),b;var c=new o(this,!0);return a=i(c),c.detach(),a},canSurroundContents:function(){C(this),x(this.startContainer),x(this.endContainer);var a=new o(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);return a.detach(),!b},surroundContents:function(a){if(u(a,T),!this.canSurroundContents())throw new p("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);h(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){C(this);for(var a,b=new L(d(this)),c=aa.length;c--;)a=aa[c],b[a]=this[a];return b},toString:function(){C(this);var a=this.startContainer;if(a===this.endContainer&&M.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new o(this,!0);return j(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){C(this);var b=a.parentNode,c=M.getNodeIndex(a);if(!b)throw new O("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?ha:fa:e>0?ga:ia},comparePoint:function(a,b){return C(this),y(a,"HIERARCHY_REQUEST_ERR"),w(a,this.startContainer),M.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:M.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:_,toHtml:function(){C(this);var a=d(this).createElement("div");return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){if(C(this),y(a,"NOT_FOUND_ERR"),M.getDocument(a)!==d(this))return!1;var c=a.parentNode,e=M.getNodeIndex(a);y(c,"NOT_FOUND_ERR");var f=M.comparePoints(c,e,this.endContainer,this.endOffset),g=M.comparePoints(c,e+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return C(this),y(a,"HIERARCHY_REQUEST_ERR"),w(a,this.startContainer),M.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&M.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){if(C(this),d(a)!=d(this))throw new O("WRONG_DOCUMENT_ERR");var c=M.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=M.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?0>=c&&e>=0:0>c&&e>0},intersection:function(a){if(this.intersectsRange(a)){var b=M.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=M.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return-1==M.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==M.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new p("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==ia},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,M.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},createNodeIterator:function(a,b){return C(this),new q(this,a,b)},getNodes:function(a,b){return C(this),m(this,a,b)},getDocument:function(){return d(this)},collapseBefore:function(a){t(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){t(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return L.rangesEqual(this,a)},isValid:function(){return B(this)},inspect:function(){return n(this)}},H(L,J,K),a.rangePrototype=D.prototype,L.rangeProperties=aa,L.RangeIterator=o,L.copyComparisonConstants=F,L.createPrototypeRange=H,L.inspect=n,L.getRangeDocument=d,L.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},a.DomRange=L,a.RangeException=p}),rangy.createModule("WrappedRange",function(a,b){function c(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var e=c.parentElement(),f=d==e?d:h.getCommonAncestor(d,e);return f==b?f:h.getCommonAncestor(b,f)}function d(a){return 0==a.compareEndPoints("StartToEnd",a)}function e(a,b,c,d){var e=a.duplicate();e.collapse(c);var f=e.parentElement();if(h.isAncestorOf(b,f,!0)||(f=b),!f.canHaveHTML)return new i(f.parentNode,h.getNodeIndex(f));var g,j,k,l,m,n=h.getDocument(f).createElement("span"),o=c?"StartToStart":"StartToEnd";do f.insertBefore(n,n.previousSibling),e.moveToElementText(n);while((g=e.compareEndPoints(o,a))>0&&n.previousSibling);if(m=n.nextSibling,-1==g&&m&&h.isCharacterDataNode(m)){e.setEndPoint(c?"EndToStart":"EndToEnd",a);var p;if(/[\r\n]/.test(m.data)){var q=e.duplicate(),r=q.text.replace(/\r\n/g,"\r").length;for(p=q.moveStart("character",r);-1==(g=q.compareEndPoints("StartToEnd",q));)p++,q.moveStart("character",1)}else p=e.text.length;l=new i(m,p)}else j=(d||!c)&&n.previousSibling,k=(d||c)&&n.nextSibling,l=k&&h.isCharacterDataNode(k)?new i(k,0):j&&h.isCharacterDataNode(j)?new i(j,j.length):new i(f,h.getNodeIndex(n));return n.parentNode.removeChild(n),l}function f(a,b){var c,d,e,f,g=a.offset,i=h.getDocument(a.node),j=i.body.createTextRange(),k=h.isCharacterDataNode(a.node);return k?(c=a.node,d=c.parentNode):(f=a.node.childNodes,c=g<f.length?f[g]:null,d=a.node),e=i.createElement("span"),e.innerHTML="&#feff;",c?d.insertBefore(e,c):d.appendChild(e),j.moveToElementText(e),j.collapse(!b),d.removeChild(e),k&&j[b?"moveStart":"moveEnd"]("character",g),j}a.requireModules(["DomUtil","DomRange"]);var g,h=a.dom,i=h.DomPosition,j=a.DomRange;if(!a.features.implementsDomRange||a.features.implementsTextRange&&a.config.preferTextRange){if(a.features.implementsTextRange){g=function(a){this.textRange=a,this.refresh()},g.prototype=new j(document),g.prototype.refresh=function(){var a,b,f=c(this.textRange);d(this.textRange)?b=a=e(this.textRange,f,!0,!0):(a=e(this.textRange,f,!0,!1),b=e(this.textRange,f,!1,!1)),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},j.copyComparisonConstants(g);var k=function(){return this}();"undefined"==typeof k.Range&&(k.Range=g),a.createNativeRange=function(a){return a=a||document,a.body.createTextRange()}}}else!function(){function b(a){for(var b,c=k.length;c--;)b=k[c],a[b]=a.nativeRange[b]}function c(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e;(f||g)&&(a.setEnd(d,e),a.setStart(b,c))}function d(a){a.nativeRange.detach(),a.detached=!0;for(var b,c=k.length;c--;)b=k[c],a[b]=null}var e,f,i,k=j.rangeProperties;g=function(a){if(!a)throw new Error("Range must be specified");this.nativeRange=a,b(this)},j.createPrototypeRange(g,c,d),e=g.prototype,e.selectNode=function(a){this.nativeRange.selectNode(a),b(this)},e.deleteContents=function(){this.nativeRange.deleteContents(),b(this)},e.extractContents=function(){var a=this.nativeRange.extractContents();return b(this),a},e.cloneContents=function(){return this.nativeRange.cloneContents()},e.surroundContents=function(a){this.nativeRange.surroundContents(a),b(this)},e.collapse=function(a){this.nativeRange.collapse(a),b(this)},e.cloneRange=function(){return new g(this.nativeRange.cloneRange())},e.refresh=function(){b(this)},e.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");h.getBody(document).appendChild(l);var m=document.createRange();m.setStart(l,0),m.setEnd(l,0);try{m.setStart(l,1),f=!0,e.setStart=function(a,c){this.nativeRange.setStart(a,c),b(this)},e.setEnd=function(a,c){this.nativeRange.setEnd(a,c),b(this)},i=function(a){return function(c){this.nativeRange[a](c),b(this)}}}catch(n){f=!1,e.setStart=function(a,c){try{this.nativeRange.setStart(a,c)}catch(d){this.nativeRange.setEnd(a,c),this.nativeRange.setStart(a,c)}b(this)},e.setEnd=function(a,c){try{this.nativeRange.setEnd(a,c)}catch(d){this.nativeRange.setStart(a,c),this.nativeRange.setEnd(a,c)}b(this)},i=function(a,c){return function(d){try{this.nativeRange[a](d)}catch(e){this.nativeRange[c](d),this.nativeRange[a](d)}b(this)}}}e.setStartBefore=i("setStartBefore","setEndBefore"),e.setStartAfter=i("setStartAfter","setEndAfter"),e.setEndBefore=i("setEndBefore","setStartBefore"),e.setEndAfter=i("setEndAfter","setStartAfter"),m.selectNodeContents(l),m.startContainer==l&&m.endContainer==l&&0==m.startOffset&&m.endOffset==l.length?e.selectNodeContents=function(a){this.nativeRange.selectNodeContents(a),b(this)}:e.selectNodeContents=function(a){this.setStart(a,0),this.setEnd(a,j.getEndOffset(a))},m.selectNodeContents(l),m.setEnd(l,3);var o=document.createRange();o.selectNodeContents(l),o.setEnd(l,4),o.setStart(l,2),-1==m.compareBoundaryPoints(m.START_TO_END,o)&1==m.compareBoundaryPoints(m.END_TO_START,o)?e.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:e.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},a.util.isHostMethod(m,"createContextualFragment")&&(e.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),h.getBody(document).removeChild(l),m.detach(),o.detach()}(),a.createNativeRange=function(a){return a=a||document,a.createRange()};a.features.implementsTextRange&&(g.rangeToTextRange=function(a){if(a.collapsed){var b=f(new i(a.startContainer,a.startOffset),!0);return b}var c=f(new i(a.startContainer,a.startOffset),!0),d=f(new i(a.endContainer,a.endOffset),!1),e=h.getDocument(a.startContainer).body.createTextRange();return e.setEndPoint("StartToStart",c),e.setEndPoint("EndToEnd",d),e}),g.prototype.getName=function(){return"WrappedRange"},a.WrappedRange=g,a.createRange=function(b){return b=b||document,new g(a.createNativeRange(b))},a.createRangyRange=function(a){return a=a||document,new j(a)},a.createIframeRange=function(b){return a.createRange(h.getIframeDocument(b))},a.createIframeRangyRange=function(b){return a.createRangyRange(h.getIframeDocument(b))},a.addCreateMissingNativeApiListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(this)}),c=b=null})}),rangy.createModule("WrappedSelection",function(a,b){function c(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function f(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function g(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function h(b){var c;return b instanceof y?(c=b._selectionNativeRange,c||(c=a.createNativeRange(w.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof z?c=b.nativeRange:a.features.implementsDomRange&&b instanceof w.getWindow(b.startContainer).Range&&(c=b),c}function i(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!w.isAncestorOf(a[0],a[b]))return!1;return!0}function j(a){var b=a.getNodes();if(!i(b))throw new Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function k(a){return!!a&&"undefined"!=typeof a.text}function l(a,b){var c=new z(b);a._ranges=[c],e(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function m(b){if(b._ranges.length=0,"None"==b.docSelection.type)g(b);else{var c=b.docSelection.createRange();if(k(c))l(b,c);else{b.rangeCount=c.length;

for(var d,f=w.getDocument(c.item(0)),h=0;h<b.rangeCount;++h)d=a.createRange(f),d.selectNode(c.item(h)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,e(b,b._ranges[b.rangeCount-1],!1)}}}function n(a,b){for(var c=a.docSelection.createRange(),d=j(b),e=w.getDocument(c.item(0)),f=w.getBody(e).createControlRange(),g=0,h=c.length;h>g;++g)f.add(c.item(g));try{f.add(d)}catch(i){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}f.select(),m(a)}function o(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function p(a,b){for(var c,d=w.getDocument(b[0].startContainer),e=w.getBody(d).createControlRange(),f=0;f<rangeCount;++f){c=j(b[f]);try{e.add(c)}catch(g){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}e.select(),m(a)}function q(a,b){if(a.anchorNode&&w.getDocument(a.anchorNode)!==w.getDocument(b))throw new A("WRONG_DOCUMENT_ERR")}function r(a){var b=[],c=new B(a.anchorNode,a.anchorOffset),d=new B(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=y.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var s,t,u="boolean",v="_rangySelection",w=a.dom,x=a.util,y=a.DomRange,z=a.WrappedRange,A=a.DOMException,B=w.DomPosition,C="Control",D=a.util.isHostMethod(window,"getSelection"),E=a.util.isHostObject(document,"selection"),F=E&&(!D||a.config.preferTextRange);F?(s=d,a.isSelectionValid=function(a){var b=(a||window).document,c=b.selection;return"None"!=c.type||w.getDocument(c.createRange().parentElement())==b}):D?(s=c,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=s;var G=s(),H=a.createNativeRange(document),I=w.getBody(document),J=x.areHostObjects(G,["anchorNode","focusNode"]&&x.areHostProperties(G,["anchorOffset","focusOffset"]));a.features.selectionHasAnchorAndFocus=J;var K=x.isHostMethod(G,"extend");a.features.selectionHasExtend=K;var L="number"==typeof G.rangeCount;a.features.selectionHasRangeCount=L;var M=!1,N=!0;x.areHostMethods(G,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof G.rangeCount&&a.features.implementsDomRange&&!function(){var a=document.createElement("iframe");a.frameBorder=0,a.style.position="absolute",a.style.left="-10000px",I.appendChild(a);var b=w.getIframeDocument(a);b.open(),b.write("<html><head></head><body>12</body></html>"),b.close();var c=w.getIframeWindow(a).getSelection(),d=b.documentElement,e=d.lastChild,f=e.firstChild,g=b.createRange();g.setStart(f,1),g.collapse(!0),c.addRange(g),N=1==c.rangeCount,c.removeAllRanges();var h=g.cloneRange();g.setStart(f,0),h.setEnd(f,2),c.addRange(g),c.addRange(h),M=2==c.rangeCount,g.detach(),h.detach(),I.removeChild(a)}(),a.features.selectionSupportsMultipleRanges=M,a.features.collapsedNonEditableSelectionsSupported=N;var O,P=!1;I&&x.isHostMethod(I,"createControlRange")&&(O=I.createControlRange(),x.areHostProperties(O,["item","add"])&&(P=!0)),a.features.implementsControlRange=P,t=J?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var Q;x.isHostMethod(G,"getRangeAt")?Q=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:J&&(Q=function(b){var c=w.getDocument(b.anchorNode),d=a.createRange(c);return d.setStart(b.anchorNode,b.anchorOffset),d.setEnd(b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&(d.setStart(b.focusNode,b.focusOffset),d.setEnd(b.anchorNode,b.anchorOffset)),d}),a.getSelection=function(a){a=a||window;var b=a[v],c=s(a),e=E?d(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new o(c,e,a),a[v]=b),b},a.getIframeSelection=function(b){return a.getSelection(w.getIframeWindow(b))};var R=o.prototype;if(!F&&J&&x.areHostMethods(G,["removeAllRanges","addRange"])){R.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),g(this)};var S=function(b,c){var d=y.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(h(e)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};L?R.addRange=function(b,c){if(P&&E&&this.docSelection.type==C)n(this,b);else if(c&&K)S(this,b);else{var d;if(M?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(h(b)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1){if(a.config.checkSelectionRanges){var f=Q(this.nativeSelection,this.rangeCount-1);f&&!y.rangesEqual(f,b)&&(b=new z(f))}this._ranges[this.rangeCount-1]=b,e(this,b,V(this.nativeSelection)),this.isCollapsed=t(this)}else this.refresh()}}:R.addRange=function(a,b){b&&K?S(this,a):(this.nativeSelection.addRange(h(a)),this.refresh())},R.setRanges=function(a){if(P&&a.length>1)p(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(x.isHostMethod(G,"empty")&&x.isHostMethod(H,"select")&&P&&F))return b.fail("No means of selecting a Range or TextRange was found"),!1;R.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=w.getDocument(this.anchorNode);else if(this.docSelection.type==C){var b=this.docSelection.createRange();b.length&&(a=w.getDocument(b.item(0)).body.createTextRange())}if(a){var c=a.body.createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}g(this)},R.addRange=function(a){this.docSelection.type==C?n(this,a):(z.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,e(this,a,!1))},R.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?p(this,a):b&&this.addRange(a[0])}}R.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new A("INDEX_SIZE_ERR");return this._ranges[a]};var T;if(F)T=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=w.getBody(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==C?m(b):k(c)?l(b,c):g(b)};else if(x.isHostMethod(G,"getRangeAt")&&"number"==typeof G.rangeCount)T=function(b){if(P&&E&&b.docSelection.type==C)m(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],V(b.nativeSelection)),b.isCollapsed=t(b)}else g(b)};else{if(!J||typeof G.isCollapsed!=u||typeof H.collapsed!=u||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;T=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=Q(c,0),a._ranges=[b],a.rangeCount=1,f(a),a.isCollapsed=t(a)):g(a)}}R.refresh=function(a){var b=a?this._ranges.slice(0):null;if(T(this),a){var c=b.length;if(c!=this._ranges.length)return!1;for(;c--;)if(!y.rangesEqual(b[c],this._ranges[c]))return!1;return!0}};var U=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,f=c.length;f>e;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||g(a)};P?R.removeRange=function(a){if(this.docSelection.type==C){for(var b,c=this.docSelection.createRange(),d=j(a),e=w.getDocument(c.item(0)),f=w.getBody(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),m(this)}else U(this,a)}:R.removeRange=function(a){U(this,a)};var V;!F&&J&&a.features.implementsDomRange?(V=function(a){var b=!1;return a.anchorNode&&(b=1==w.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b},R.isBackwards=function(){return V(this)}):V=R.isBackwards=function(){return!1},R.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},R.collapse=function(b,c){q(this,b);var d=a.createRange(w.getDocument(b));d.collapseToPoint(b,c),this.removeAllRanges(),this.addRange(d),this.isCollapsed=!0},R.collapseToStart=function(){if(!this.rangeCount)throw new A("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},R.collapseToEnd=function(){if(!this.rangeCount)throw new A("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},R.selectAllChildren=function(b){q(this,b);var c=a.createRange(w.getDocument(b));c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},R.deleteFromDocument=function(){if(P&&E&&this.docSelection.type==C){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),a.parentNode.removeChild(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}},R.getAllRanges=function(){return this._ranges.slice(0)},R.setSingleRange=function(a){this.setRanges([a])},R.containsNode=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},R.toHtml=function(){var a="";if(this.rangeCount){for(var b=y.getRangeDocument(this._ranges[0]).createElement("div"),c=0,d=this._ranges.length;d>c;++c)b.appendChild(this._ranges[c].cloneContents());a=b.innerHTML}return a},R.getName=function(){return"WrappedSelection"},R.inspect=function(){return r(this)},R.detach=function(){this.win[v]=null,this.win=this.anchorNode=this.focusNode=null},o.inspect=r,a.Selection=o,a.selectionPrototype=R,a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)}),b=null})}),define("rangy",function(a){return function(){var b;return b||a.rangy}}(this)),/**
 * @license Selection save and restore module for Rangy.
 * Saves and restores user selections using marker invisible elements in the DOM.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Depends on Rangy core.
 *
 * Copyright 2012, Tim Down
 * Licensed under the MIT license.
 * Version: 1.2.3
 * Build date: 26 February 2012
 */
rangy.createModule("SaveRestore",function(a,b){function c(a,b){return(b||document).getElementById(a)}function d(a,b){var c,d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),e=k.getDocument(a.startContainer),f=a.cloneRange();return f.collapse(b),c=e.createElement("span"),c.id=d,c.style.lineHeight="0",c.style.display="none",c.className="rangySelectionBoundary",c.appendChild(e.createTextNode(l)),f.insertNode(c),f.detach(),c}function e(a,d,e,f){var g=c(e,a);g?(d[f?"setStartBefore":"setEndBefore"](g),g.parentNode.removeChild(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(e){e=e||window;var g=e.document;if(!a.isSelectionValid(e))return void b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");var h,i,j,k=a.getSelection(e),l=k.getAllRanges(),m=[];l.sort(f);for(var n=0,o=l.length;o>n;++n)j=l[n],j.collapsed?(i=d(j,!1),m.push({markerId:i.id,collapsed:!0})):(i=d(j,!1),h=d(j,!0),m[n]={startMarkerId:h.id,endMarkerId:i.id,collapsed:!1,backwards:1==l.length&&k.isBackwards()});for(n=o-1;n>=0;--n)j=l[n],j.collapsed?j.collapseBefore(c(m[n].markerId,g)):(j.setEndBefore(c(m[n].endMarkerId,g)),j.setStartAfter(c(m[n].startMarkerId,g)));return k.setRanges(l),{win:e,doc:g,rangeInfos:m,restored:!1}}function h(d,f){if(!d.restored){for(var g,h,i=d.rangeInfos,j=a.getSelection(d.win),k=[],l=i.length,m=l-1;m>=0;--m){if(g=i[m],h=a.createRange(d.doc),g.collapsed){var n=c(g.markerId,d.doc);if(n){n.style.display="inline";var o=n.previousSibling;o&&3==o.nodeType?(n.parentNode.removeChild(n),h.collapseToPoint(o,o.length)):(h.collapseBefore(n),n.parentNode.removeChild(n))}else b.warn("Marker element has been removed. Cannot restore selection.")}else e(d.doc,h,g.startMarkerId,!0),e(d.doc,h,g.endMarkerId,!1);1==l&&h.normalizeBoundaries(),k[m]=h}1==l&&f&&a.features.selectionHasExtend&&i[0].backwards?(j.removeAllRanges(),j.addRange(k[0],!0)):j.setRanges(k),d.restored=!0}}function i(a,b){var d=c(b,a);d&&d.parentNode.removeChild(d)}function j(a){for(var b,c=a.rangeInfos,d=0,e=c.length;e>d;++d)b=c[d],b.collapsed?i(a.doc,b.markerId):(i(a.doc,b.startMarkerId),i(a.doc,b.endMarkerId))}a.requireModules(["DomUtil","DomRange","WrappedRange"]);var k=a.dom,l="\ufeff";a.saveSelection=g,a.restoreSelection=h,a.removeMarkerElement=i,a.removeMarkers=j}),define("rangySelection",["rangy"],function(){}),PointerEventsPolyfill.initialize=function(a){return null==PointerEventsPolyfill.singleton&&(PointerEventsPolyfill.singleton=new PointerEventsPolyfill(a)),PointerEventsPolyfill.singleton},PointerEventsPolyfill.prototype.register_mouse_events=function(){$(document).on(this.options.mouseEvents.join(" "),this.options.selector,function(a){if("none"==$(this).css("pointer-events")){var b=$(this).css("display");$(this).css("display","none");var c=document.elementFromPoint(a.clientX,a.clientY);return b?$(this).css("display",b):$(this).css("display",""),a.target=c,$(c).trigger(a),!1}return!0})},define("pointerEvents",function(a){return function(){var b;return b||a.PointerEventsPolyfill}}(this)),/**
 * @license
 * Copyright 2013 Ivan Pusic
 * Contributors:
 *   Matjaz Lipus
 */
angular.module("ivpusic.cookie",["ipCookie"]),angular.module("ipCookie",["ng"]).factory("ipCookie",["$document",function(a){"use strict";return function(){function b(b,c,d){var e,f,g,h,i,j,k,l,m;if(d=d||{},void 0!==c)return c="object"==typeof c?JSON.stringify(c):String(c),"number"==typeof d.expires&&(m=d.expires,d.expires=new Date,-1===m?d.expires=new Date("Thu, 01 Jan 1970 00:00:00 GMT"):void 0!==d.expirationUnit?"hours"===d.expirationUnit?d.expires.setHours(d.expires.getHours()+m):"minutes"===d.expirationUnit?d.expires.setMinutes(d.expires.getMinutes()+m):"seconds"===d.expirationUnit?d.expires.setSeconds(d.expires.getSeconds()+m):d.expires.setDate(d.expires.getDate()+m):d.expires.setDate(d.expires.getDate()+m)),a[0].cookie=[encodeURIComponent(b),"=",encodeURIComponent(c),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join("");for(f=[],l=a[0].cookie,l&&(f=l.split("; ")),e={},k=!1,g=0;g<f.length;++g)if(f[g]&&(h=f[g],i=h.indexOf("="),j=h.substring(0,i),c=decodeURIComponent(h.substring(i+1)),void 0===b||b===j)){try{e[j]=JSON.parse(c)}catch(n){e[j]=c}if(b===j)return e[j];k=!0}return k&&void 0===b?e:void 0}return b.remove=function(a,c){var d=void 0!==b(a);return d&&(c||(c={}),c.expires=-1,b(a,"",c)),d},b}()}]),define("angular-cookie",["angular"],function(){}),/**
 * @license AngularJS v1.3.0-build.2711+sha.facd904
 * (c) 2010-2014 Google, Inc. http://angularjs.org
 * License: MIT
 */
function(a,b,c){"use strict";function d(){this.$get=["$$sanitizeUri",function(a){return function(b){var c=[];return g(b,l(c,function(b,c){return!/^unsafe/.test(a(b,c))})),c.join("")}}]}function e(a){var c=[],d=l(c,b.noop);return d.chars(a),c.join("")}function f(a){var b,c={},d=a.split(",");for(b=0;b<d.length;b++)c[d[b]]=!0;return c}function g(a,c){function d(a,d,f,g){if(d=b.lowercase(d),B[d])for(;j.last()&&C[j.last()];)e("",j.last());A[d]&&j.last()==d&&e("",d),g=x[d]||!!g,g||j.push(d);var i={};f.replace(p,function(a,b,c,d,e){var f=c||d||e||"";i[b]=h(f)}),c.start&&c.start(d,i,g)}function e(a,d){var e,f=0;if(d=b.lowercase(d))for(f=j.length-1;f>=0&&j[f]!=d;f--);if(f>=0){for(e=j.length-1;e>=f;e--)c.end&&c.end(j[e]);j.length=f}}var f,g,i,j=[],k=a;for(j.last=function(){return j[j.length-1]};a;){if(g=!0,j.last()&&D[j.last()])a=a.replace(new RegExp("(.*)<\\s*\\/\\s*"+j.last()+"[^>]*>","i"),function(a,b){return b=b.replace(s,"$1").replace(u,"$1"),c.chars&&c.chars(h(b)),""}),e("",j.last());else if(0===a.indexOf("<!--")?(f=a.indexOf("--",4),f>=0&&a.lastIndexOf("-->",f)===f&&(c.comment&&c.comment(a.substring(4,f)),a=a.substring(f+3),g=!1)):t.test(a)?(i=a.match(t),i&&(a=a.replace(i[0],""),g=!1)):r.test(a)?(i=a.match(o),i&&(a=a.substring(i[0].length),i[0].replace(o,e),g=!1)):q.test(a)&&(i=a.match(n),i&&(a=a.substring(i[0].length),i[0].replace(n,d),g=!1)),g){f=a.indexOf("<");var l=0>f?a:a.substring(0,f);a=0>f?"":a.substring(f),c.chars&&c.chars(h(l))}if(a==k)throw m("badparse","The sanitizer was unable to parse the following block of html: {0}",a);k=a}e()}function h(a){if(!a)return"";var b=I.exec(a),c=b[1],d=b[3],e=b[2];return e&&(H.innerHTML=e.replace(/</g,"&lt;"),e="textContent"in H?H.textContent:H.innerText),c+e+d}function i(a){return a.replace(/&/g,"&amp;").replace(v,function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1);return"&#"+(1024*(b-55296)+(c-56320)+65536)+";"}).replace(w,function(a){var b=a.charCodeAt(0);return 159>=b||173==b||b>=1536&&1540>=b||1807==b||6068==b||6069==b||b>=8204&&8207>=b||b>=8232&&8239>=b||b>=8288&&8303>=b||65279==b||b>=65520&&65535>=b?"&#"+b+";":a}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function j(a){var c="",d=a.split(";");return b.forEach(d,function(a){var d=a.split(":");if(2==d.length){var e=J(b.lowercase(d[0])),a=J(b.lowercase(d[1]));(("color"===e||"background-color"===e)&&(a.match(/^rgb\([0-9%,\. ]*\)$/i)||a.match(/^rgba\([0-9%,\. ]*\)$/i)||a.match(/^hsl\([0-9%,\. ]*\)$/i)||a.match(/^hsla\([0-9%,\. ]*\)$/i)||a.match(/^#[0-9a-f]{3,6}$/i)||a.match(/^[a-z]*$/i))||"text-align"===e&&("left"===a||"right"===a||"center"===a||"justify"===a)||"float"===e&&("left"===a||"right"===a||"none"===a)||("width"===e||"height"===e)&&a.match(/[0-9\.]*(px|em|rem|%)/))&&(c+=e+": "+a+";")}}),c}function k(a,b,c,d){return"img"===a&&b["ta-insert-video"]&&("ta-insert-video"===c||"allowfullscreen"===c||"frameborder"===c||"contenteditble"===c&&"false"===d)?!0:!1}function l(a,c){var d=!1,e=b.bind(a,a.push);return{start:function(a,f,g){a=b.lowercase(a),!d&&D[a]&&(d=a),d||E[a]!==!0||(e("<"),e(a),b.forEach(f,function(d,g){var h=b.lowercase(g),l="img"===a&&"src"===h||"background"===h;("style"===h&&""!==(d=j(d))||k(a,f,h,d)||G[h]===!0&&(F[h]!==!0||c(d,l)))&&(e(" "),e(g),e('="'),e(i(d)),e('"'))}),e(g?"/>":">"))},end:function(a){a=b.lowercase(a),d||E[a]!==!0||(e("</"),e(a),e(">")),a==d&&(d=!1)},chars:function(a){d||e(i(a))}}}var m=b.$$minErr("$sanitize"),n=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,o=/^<\s*\/\s*([\w:-]+)[^>]*>/,p=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,q=/^</,r=/^<\s*\//,s=/<!--(.*?)-->/g,t=/<!DOCTYPE([^>]*?)>/i,u=/<!\[CDATA\[(.*?)]]>/g,v=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,w=/([^\#-~| |!])/g,x=f("area,br,col,hr,img,wbr"),y=f("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),z=f("rp,rt"),A=b.extend({},z,y),B=b.extend({},y,f("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),C=b.extend({},z,f("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),D=f("script,style"),E=b.extend({},x,B,C,A),F=f("background,cite,href,longdesc,src,usemap"),G=b.extend({},F,f("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),H=document.createElement("pre"),I=/^(\s*)([\s\S]*?)(\s*)$/,J=function(){return String.prototype.trim?function(a){return b.isString(a)?a.trim():a}:function(a){return b.isString(a)?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}();b.module("ngSanitize",[]).provider("$sanitize",d),b.module("ngSanitize").filter("linky",["$sanitize",function(a){var c=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,d=/^mailto:/;return function(f,g){function h(a){a&&n.push(e(a))}function i(a,c){n.push("<a "),b.isDefined(g)&&(n.push('target="'),n.push(g),n.push('" ')),n.push('href="'),n.push(a),n.push('">'),h(c),n.push("</a>")}if(!f)return f;for(var j,k,l,m=f,n=[];j=m.match(c);)k=j[0],j[2]==j[3]&&(k="mailto:"+k),l=j.index,h(m.substr(0,l)),i(k,j[0].replace(d,"")),m=m.substring(l+j[0].length);return h(m),a(n.join(""))}}])}(window,window.angular),define("textAngularSanit",["angular"],function(a){return function(){var b;return b||a.textAngularSanit}}(this)),function(){"Use Strict";function a(a){try{return 0!==angular.element(a).length}catch(b){return!1}}function b(a,c){var d=[],e=a.children();return e.length&&angular.forEach(e,function(a){d=d.concat(b(angular.element(a),c))}),void 0!==a.attr(c)&&d.push(a),d}function c(b,c){if(!b||""===b||p.hasOwnProperty(b))throw"textAngular Error: A unique name is required for a Tool Definition";if(c.display&&(""===c.display||!a(c.display))||!c.display&&!c.buttontext&&!c.iconclass)throw'textAngular Error: Tool Definition for "'+b+'" does not have a valid display/iconclass/buttontext value';p[b]=c}var d=!1;/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(document.addEventListener("click",function(a){var b=a||window.event,c=b.target;if(d&&null!==c){for(var e=!1,f=c;null!==f&&"html"!==f.tagName.toLowerCase()&&!e;)e="true"===f.contentEditable,f=f.parentNode;e||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),c.focus(),c.select&&c.select())}d=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" style="width:1px;height:1px;border:none;margin:0;padding:0;position:absolute; top: -10000px; left: -10000px;" unselectable="on" tabIndex="-1">'))}));var e=function(){var a,b=-1,c=window.navigator.userAgent,d=c.indexOf("MSIE "),e=c.indexOf("Trident/");if(d>0)b=parseInt(c.substring(d+5,c.indexOf(".",d)),10);else if(e>0){var f=c.indexOf("rv:");b=parseInt(c.substring(f+3,c.indexOf(".",f)),10)}return b>-1?b:a}();String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var f,g,h,i,j;if(e>8||void 0===e){for(var k,l=document.styleSheets,m=0;m<l.length;m++)if((0===l[m].media.length||l[m].media.mediaText.match(/(all|screen)/gi))&&l[m].href){if(l[m].href.match(/textangular\.(min\.|)css/gi)){f=l[m];break}k=l[m]}!f&&k?f=k:f||(f=function(){var a=document.createElement("style");return/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&a.appendChild(document.createTextNode("")),document.head.appendChild(a),a.sheet}()),g=function(a,b){i(f,a,b)},i=function(a,b,c){var d;return a.rules?d=Math.max(a.rules.length-1,0):a.cssRules&&(d=Math.max(a.cssRules.length-1,0)),a.insertRule?a.insertRule(b+"{"+c+"}",d):a.addRule(b,c,d),d},h=function(a){j(f,a)},j=function(a,b){a.removeRule?a.removeRule(b):a.deleteRule(b)}}var n=!1,o=angular.module("textAngular",["ngSanitize","textAngularSetup"]),p={};o.constant("taRegisterTool",c),o.value("taTools",p),o.config([function(){angular.forEach(p,function(a,b){delete p[b]})}]),o.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log",function(a,b,c,d,e,f,g,h,i,j){return{require:"?ngModel",scope:{},restrict:"EA",link:function(k,l,m,n){var o,p,q,r,s,t,u,v,w,x=m.serial?m.serial:Math.floor(1e16*Math.random()),y=m.name?m.name:"textAngularEditor"+x,z=function(a,c,d){b(function(){var b=function(){a.off(c,b),d()};a.on(c,b)},100)};w=e(m.taDefaultWrap),angular.extend(k,angular.copy(c),{wrapSelection:function(a,b,c){w(a,!1,b),c&&k["reApplyOnSelectorHandlerstaTextElement"+x](),k.displayElements.text[0].focus()},showHtml:!1}),m.taFocussedClass&&(k.classes.focussed=m.taFocussedClass),m.taTextEditorClass&&(k.classes.textEditor=m.taTextEditorClass),m.taHtmlEditorClass&&(k.classes.htmlEditor=m.taHtmlEditorClass),m.taTextEditorSetup&&(k.setup.textEditorSetup=k.$parent.$eval(m.taTextEditorSetup)),m.taHtmlEditorSetup&&(k.setup.htmlEditorSetup=k.$parent.$eval(m.taHtmlEditorSetup)),m.taFileDrop?k.fileDropHandler=k.$parent.$eval(m.taFileDrop):k.fileDropHandler=k.defaultFileDropHandler,u=l[0].innerHTML,l[0].innerHTML="",k.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},k.displayElements.popover.append(k.displayElements.popoverArrow),k.displayElements.popover.append(k.displayElements.popoverContainer),k.displayElements.scrollWindow.append(k.displayElements.popover),k.displayElements.popover.on("mousedown",function(a,b){return b&&angular.extend(a,b),a.preventDefault(),!1}),k.showPopover=function(a){k.displayElements.popover.css("display","block"),k.reflowPopover(a),i.addClass(k.displayElements.popover,"in"),z(l,"click keyup",function(){k.hidePopover()})},k.reflowPopover=function(a){k.displayElements.text[0].offsetHeight-51>a[0].offsetTop?(k.displayElements.popover.css("top",a[0].offsetTop+a[0].offsetHeight+"px"),k.displayElements.popover.removeClass("top").addClass("bottom")):(k.displayElements.popover.css("top",a[0].offsetTop-54+"px"),k.displayElements.popover.removeClass("bottom").addClass("top"));var b=k.displayElements.text[0].offsetWidth-k.displayElements.popover[0].offsetWidth,c=a[0].offsetLeft+a[0].offsetWidth/2-k.displayElements.popover[0].offsetWidth/2;k.displayElements.popover.css("left",Math.max(0,Math.min(b,c))+"px"),k.displayElements.popoverArrow.css("margin-left",Math.min(c,Math.max(0,c-b))-11+"px")},k.hidePopover=function(){i.removeClass(k.displayElements.popover,"in",function(){k.displayElements.popover.css("display",""),k.displayElements.popoverContainer.attr("style",""),k.displayElements.popoverContainer.attr("class","popover-content")})},k.displayElements.resize.overlay.append(k.displayElements.resize.background),angular.forEach(k.displayElements.resize.anchors,function(a){k.displayElements.resize.overlay.append(a)}),k.displayElements.resize.overlay.append(k.displayElements.resize.info),k.displayElements.scrollWindow.append(k.displayElements.resize.overlay),k.reflowResizeOverlay=function(a){a=angular.element(a)[0],k.displayElements.resize.overlay.css({display:"block",left:a.offsetLeft-5+"px",top:a.offsetTop-5+"px",width:a.offsetWidth+10+"px",height:a.offsetHeight+10+"px"}),k.displayElements.resize.info.text(a.offsetWidth+" x "+a.offsetHeight)},k.showResizeOverlay=function(a){var b=function(b){var c={width:parseInt(a.attr("width")),height:parseInt(a.attr("height")),x:b.clientX,y:b.clientY};void 0===c.width&&(c.width=a[0].offsetWidth),void 0===c.height&&(c.height=a[0].offsetHeight),k.hidePopover();var d=c.height/c.width,e=function(b){var e={x:Math.max(0,c.width+(b.clientX-c.x)),y:Math.max(0,c.height+(b.clientY-c.y))},f=function(a,b){a=angular.element(a),"img"===a[0].tagName.toLowerCase()&&(b.height&&(a.attr("height",b.height),delete b.height),b.width&&(a.attr("width",b.width),delete b.width)),a.css(b)};if(b.shiftKey){var g=e.y/e.x;f(a,{width:d>g?e.x:e.y/d,height:d>g?e.x*d:e.y})}else f(a,{width:e.x,height:e.y});k.reflowResizeOverlay(a)};h.find("body").on("mousemove",e),z(k.displayElements.resize.overlay,"mouseup",function(){h.find("body").off("mousemove",e),k.showPopover(a)}),b.stopPropagation(),b.preventDefault()};k.displayElements.resize.anchors[3].on("mousedown",b),k.reflowResizeOverlay(a),z(l,"click",function(){k.hideResizeOverlay()})},k.hideResizeOverlay=function(){k.displayElements.resize.overlay.css("display","")},k.setup.htmlEditorSetup(k.displayElements.html),k.setup.textEditorSetup(k.displayElements.text),k.displayElements.html.attr({id:"taHtmlElement"+x,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"}),k.displayElements.text.attr({id:"taTextElement"+x,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"}),k.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),m.taDefaultWrap&&k.displayElements.text.attr("ta-default-wrap",m.taDefaultWrap),m.taUnsafeSanitizer&&(k.displayElements.text.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer),k.displayElements.html.attr("ta-unsafe-sanitizer",m.taUnsafeSanitizer)),k.displayElements.scrollWindow.append(k.displayElements.text),l.append(k.displayElements.scrollWindow),l.append(k.displayElements.html),k.displayElements.forminput.attr("name",y),l.append(k.displayElements.forminput),m.tabindex&&(l.removeAttr("tabindex"),k.displayElements.text.attr("tabindex",m.tabindex),k.displayElements.html.attr("tabindex",m.tabindex)),m.placeholder&&(k.displayElements.text.attr("placeholder",m.placeholder),k.displayElements.html.attr("placeholder",m.placeholder)),m.taDisabled&&(k.displayElements.text.attr("ta-readonly","disabled"),k.displayElements.html.attr("ta-readonly","disabled"),k.disabled=k.$parent.$eval(m.taDisabled),k.$parent.$watch(m.taDisabled,function(a){k.disabled=a,k.disabled?l.addClass(k.classes.disabled):l.removeClass(k.classes.disabled)})),a(k.displayElements.scrollWindow)(k),a(k.displayElements.html)(k),k.updateTaBindtaTextElement=k["updateTaBindtaTextElement"+x],k.updateTaBindtaHtmlElement=k["updateTaBindtaHtmlElement"+x],l.addClass("ta-root"),k.displayElements.scrollWindow.addClass("ta-text ta-editor "+k.classes.textEditor),k.displayElements.html.addClass("ta-html ta-editor "+k.classes.htmlEditor),k._actionRunning=!1;var A=!1;if(k.startAction=function(){k._actionRunning=!0},k.endAction=function(){k._actionRunning=!1,A&&g.rangy.removeMarkers(A),A=!1,k.updateSelectedStyles(),k.showHtml||k["updateTaBindtaTextElement"+x]()},s=function(){l.addClass(k.classes.focussed),v.focus()},k.displayElements.html.on("focus",s),k.displayElements.text.on("focus",s),t=function(a){return k._actionRunning||h[0].activeElement===k.displayElements.html[0]||h[0].activeElement===k.displayElements.text[0]||(l.removeClass(k.classes.focussed),v.unfocus(),b(function(){l.triggerHandler("blur")},0)),a.preventDefault(),!1},k.displayElements.html.on("blur",t),k.displayElements.text.on("blur",t),k.queryFormatBlockState=function(a){return!k.showHtml&&a.toLowerCase()===h[0].queryCommandValue("formatBlock").toLowerCase()},k.queryCommandState=function(a){return k.showHtml?"":h[0].queryCommandState(a)},k.switchView=function(){k.showHtml=!k.showHtml,i.enabled(!1,k.displayElements.html),i.enabled(!1,k.displayElements.text),k.showHtml?b(function(){return i.enabled(!0,k.displayElements.html),i.enabled(!0,k.displayElements.text),k.displayElements.html[0].focus()},100):b(function(){return i.enabled(!0,k.displayElements.html),i.enabled(!0,k.displayElements.text),k.displayElements.text[0].focus()},100)},m.ngModel){var B=!0;n.$render=function(){if(B){B=!1;var a=k.$parent.$eval(m.ngModel);void 0!==a&&null!==a||!u||""===u||n.$setViewValue(u)}k.displayElements.forminput.val(n.$viewValue),k._elementSelectTriggered||h[0].activeElement===k.displayElements.html[0]||h[0].activeElement===k.displayElements.text[0]||(k.html=n.$viewValue||"")};var C=function(a){return m.required&&n.$setValidity("required",!(!a||""===a.trim())),a};n.$parsers.push(C),n.$formatters.push(C)}else k.displayElements.forminput.val(u),k.html=u;if(k.$watch("html",function(a,b){a!==b&&(m.ngModel&&n.$viewValue!==a&&n.$setViewValue(a),k.displayElements.forminput.val(a))}),m.taTargetToolbars)v=f.registerEditor(y,k,m.taTargetToolbars.split(","));else{var D=angular.element('<div text-angular-toolbar name="textAngularToolbar'+x+'">');m.taToolbar&&D.attr("ta-toolbar",m.taToolbar),m.taToolbarClass&&D.attr("ta-toolbar-class",m.taToolbarClass),m.taToolbarGroupClass&&D.attr("ta-toolbar-group-class",m.taToolbarGroupClass),m.taToolbarButtonClass&&D.attr("ta-toolbar-button-class",m.taToolbarButtonClass),m.taToolbarActiveButtonClass&&D.attr("ta-toolbar-active-button-class",m.taToolbarActiveButtonClass),m.taFocussedClass&&D.attr("ta-focussed-class",m.taFocussedClass),l.prepend(D),a(D)(k.$parent),v=f.registerEditor(y,k,["textAngularToolbar"+x])}k.$on("$destroy",function(){f.unregisterEditor(y)}),k.$on("ta-element-select",function(a,b){v.triggerElementSelect(a,b)}),k.$on("ta-drop-event",function(a,b,c,d){k.displayElements.text[0].focus(),d&&d.files&&d.files.length>0&&(angular.forEach(d.files,function(a){try{return k.fileDropHandler(a,k.wrapSelection)||k.fileDropHandler!==k.defaultFileDropHandler&&k.defaultFileDropHandler(a,k.wrapSelection)}catch(b){j.error(b)}}),c.preventDefault(),c.stopPropagation())}),k._bUpdateSelectedStyles=!1,k.updateSelectedStyles=function(){var a;void 0!==(a=d.getSelectionElement())&&a.parentNode!==k.displayElements.text[0]?v.updateSelectedStyles(angular.element(a)):v.updateSelectedStyles(),k._bUpdateSelectedStyles&&b(k.updateSelectedStyles,200)},o=function(){k._bUpdateSelectedStyles||(k._bUpdateSelectedStyles=!0,k.$apply(function(){k.updateSelectedStyles()}))},k.displayElements.html.on("keydown",o),k.displayElements.text.on("keydown",o),p=function(){k._bUpdateSelectedStyles=!1},k.displayElements.html.on("keyup",p),k.displayElements.text.on("keyup",p),q=function(a,b){b&&angular.extend(a,b),k.$apply(function(){return v.sendKeyCommand(a)?(k._bUpdateSelectedStyles||k.updateSelectedStyles(),a.preventDefault(),!1):void 0})},k.displayElements.html.on("keypress",q),k.displayElements.text.on("keypress",q),r=function(){k._bUpdateSelectedStyles=!1,k.$apply(function(){k.updateSelectedStyles()})},k.displayElements.html.on("mouseup",r),k.displayElements.text.on("mouseup",r)}}}]).factory("taBrowserTag",[function(){return function(a){return a?""===a?void 0===e?"div":8>=e?"P":"p":8>=e?a.toUpperCase():a:8>=e?"P":"p"}}]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(a,b,c){var d=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/gi,e=/^(ul|li|ol)$/gi,f=function(b,c){var d,e,f=b.find("li");for(e=f.length-1;e>=0;e--)d=angular.element("<"+c+">"+f[e].innerHTML+"</"+c+">"),b.after(d);b.remove(),a.setSelectionToElementEnd(d[0])},g=function(b,c){var d=angular.element("<"+c+">"+b[0].innerHTML+"</"+c+">");b.after(d),b.remove(),a.setSelectionToElementEnd(d.find("li")[0])},h=function(c,d,e){for(var f="",g=0;g<c.length;g++)f+="<"+b("li")+">"+c[g].innerHTML+"</"+b("li")+">";var h=angular.element("<"+e+">"+f+"</"+e+">");d.after(h),d.remove(),a.setSelectionToElementEnd(h.find("li")[0])};return function(i){return i=b(i),function(j,k,l){var m,n,o,p,q,r,s=angular.element("<"+i+">"),t=a.getSelectionElement(),u=angular.element(t);if(void 0!==t){var v=t.tagName.toLowerCase();if("insertorderedlist"===j.toLowerCase()||"insertunorderedlist"===j.toLowerCase()){var w=b("insertorderedlist"===j.toLowerCase()?"ol":"ul");if(v===w)return f(u,i);if("li"===v&&u.parent()[0].tagName.toLowerCase()===w&&1===u.parent().children().length)return f(u.parent(),i);if("li"===v&&u.parent()[0].tagName.toLowerCase()!==w&&1===u.parent().children().length)return g(u.parent(),w);if(v.match(d)&&!u.hasClass("ta-bind")){if("ol"===v||"ul"===v)return g(u,w);var x=!1;return angular.forEach(u.children(),function(a){a.tagName.match(d)&&(x=!0)}),x?h(u.children(),u,w):h([angular.element("<div>"+t.innerHTML+"</div>")[0]],u,w)}if(v.match(d)){if(p=a.getOnlySelectedElements(),1===p.length&&("ol"===p[0].tagName.toLowerCase()||"ul"===p[0].tagName.toLowerCase()))return p[0].tagName.toLowerCase()===w?f(angular.element(p[0]),i):g(angular.element(p[0]),w);o="";var y=[];for(m=0;m<p.length;m++)if(3!==p[m].nodeType){var z=angular.element(p[m]);o+="<"+b("li")+">"+z[0].innerHTML+"</"+b("li")+">",y.unshift(z)}return n=angular.element("<"+w+">"+o+"</"+w+">"),y.pop().replaceWith(n),angular.forEach(y,function(a){a.remove()}),void a.setSelectionToElementEnd(n[0])}}else{if("formatblock"===j.toLowerCase()){for(r=l.toLowerCase().replace(/[<>]/gi,""),n="li"===v?u.parent():u;!n[0].tagName.match(d);)n=n.parent(),v=n[0].tagName.toLowerCase();if(v===r){p=n.children();var A=!1;for(m=0;m<p.length;m++)A=A||p[m].tagName.match(d);A?(n.after(p),q=n.next(),n.remove(),n=q):(s.append(n[0].childNodes),n.after(s),n.remove(),n=s)}else if(n.parent()[0].tagName.toLowerCase()!==r||n.parent().hasClass("ta-bind"))if(v.match(e))n.wrap(l);else{p=a.getOnlySelectedElements(),0===p.length&&(p=[n[0]]);var B=!1;if(angular.forEach(p,function(a){3!==a.nodeType&&a.tagName.match(d)||(B=!0)}),B)for(;3===p[0].nodeType||!p[0].tagName.match(d);)p=[p[0].parentNode];if(angular.element(p[0]).hasClass("ta-bind"))n=angular.element(l),n[0].innerHTML=p[0].innerHTML,p[0].innerHTML=n[0].outerHTML;else if("blockquote"===r){for(o="",m=0;m<p.length;m++)o+=p[m].outerHTML;n=angular.element(l),n[0].innerHTML=o,p[0].parentNode.insertBefore(n[0],p[0]),angular.forEach(p,function(a){a.parentNode.removeChild(a)})}else for(m=0;m<p.length;m++)n=angular.element(l),n[0].innerHTML=p[m].innerHTML,p[m].parentNode.insertBefore(n[0],p[m]),p[m].parentNode.removeChild(p[m])}else{var C=n.parent(),D=C.contents();for(m=0;m<D.length;m++)C.parent().hasClass("ta-bind")&&3===D[m].nodeType&&(s=angular.element("<"+i+">"),s[0].innerHTML=D[m].outerHTML,D[m]=s[0]),C.parent()[0].insertBefore(D[m],C[0]);C.remove()}return void a.setSelectionToElementEnd(n[0])}if("createlink"===j.toLowerCase()){var E=a.getSelection();if(E.collapsed)return void a.insertHtml('<a href="'+l+'">'+l+"</a>")}}}try{c[0].execCommand(j,k,l)}catch(F){}}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions",function(a,b,c,f,i,j,k,l,m,o){return{require:"ngModel",link:function(j,p,q,r){var s,t,u,v=void 0!==p.attr("contenteditable")&&p.attr("contenteditable"),w=v||"textarea"===p[0].tagName.toLowerCase()||"input"===p[0].tagName.toLowerCase(),x=!1,y=!1,z=q.taUnsafeSanitizer||o.disableSanitizer,A=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|46|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/;void 0===q.taDefaultWrap&&(q.taDefaultWrap="p"),""===q.taDefaultWrap?(s="",t=void 0===e?"<div><br></div>":e>=11?"<p><br></p>":8>=e?"<P>&nbsp;</P>":"<p>&nbsp;</p>",u=void 0===e?/^<div>(\s|&nbsp;)*<\/div>$/gi:/^<p>(\s|&nbsp;)*<\/p>$/gi):(s=void 0===e||e>=11?"<"+q.taDefaultWrap+"><br></"+q.taDefaultWrap+">":8>=e?"<"+q.taDefaultWrap.toUpperCase()+"></"+q.taDefaultWrap.toUpperCase()+">":"<"+q.taDefaultWrap+"></"+q.taDefaultWrap+">",t=void 0===e||e>=11?"<"+q.taDefaultWrap+"><br></"+q.taDefaultWrap+">":8>=e?"<"+q.taDefaultWrap.toUpperCase()+">&nbsp;</"+q.taDefaultWrap.toUpperCase()+">":"<"+q.taDefaultWrap+">&nbsp;</"+q.taDefaultWrap+">",u=new RegExp("^<"+q.taDefaultWrap+">(\\s|&nbsp;)*<\\/"+q.taDefaultWrap+">$","ig")),p.addClass("ta-bind");var B=function(){if(v)return p[0].innerHTML;if(w)return p.val();throw"textAngular Error: attempting to update non-editable taBind"},C=function(a){a||(a=B()),a===t||a.match(u)?""!==r.$viewValue&&r.$setViewValue(""):r.$viewValue!==a&&r.$setViewValue(a)};if(j["updateTaBind"+(q.id||"")]=function(){x||C()},w)if(p.on("paste",function(b,d){d&&angular.extend(b,d);var e;if(b.clipboardData||b.originalEvent&&b.originalEvent.clipboardData?(e=(b.originalEvent||b).clipboardData.getData("text/html"),e||(e=(b.originalEvent||b).clipboardData.getData("text/plain"))):c.clipboardData&&(e=c.clipboardData.getData("Text")),!e&&!x)return!0;if(b.preventDefault(),!x)if(e=a(e,void 0,z),f[0].selection){var g=f[0].selection.createRange();g.pasteHTML(e)}else f[0].execCommand("insertHtml",!1,e)}),p.on("paste cut",function(a){x?a.preventDefault():b(function(){r.$setViewValue(B())},0)}),v){if(p.on("keyup",function(a,b){if(b&&angular.extend(a,b),!x&&!A.test(a.keyCode)){if(""!==s&&13===a.keyCode&&!a.shiftKey){var c=k.getSelectionElement();if(c.tagName.toLowerCase()!==q.taDefaultWrap&&"li"!==c.tagName.toLowerCase()&&(""===c.innerHTML.trim()||"<br>"===c.innerHTML.trim())){var d=angular.element(s);angular.element(c).replaceWith(d),k.setSelectionToElementStart(d[0])}}var e=B();""!==s&&""===e.trim()&&(p[0].innerHTML=s,k.setSelectionToElementStart(p.children()[0])),C(e)}}),p.on("blur",function(){y=!1,x||C(),r.$render()}),q.placeholder&&(e>8||void 0===e)){var D;if(!q.id)throw"textAngular Error: An unique ID is required for placeholders to work";D=g("#"+q.id+".placeholder-text:before",'content: "'+q.placeholder+'"'),j.$on("$destroy",function(){h(D)})}p.on("focus",function(){y=!0,r.$render()}),p.on("mousedown",function(a,b){b&&angular.extend(a,b),a.stopPropagation()})}else p.on("change blur",function(){x||r.$setViewValue(B())});var E=function(b){return r.$oldViewValue=a(i(b),r.$oldViewValue,z)},F=function(a){return q.required&&r.$setValidity("required",!(!a||a.trim()===t||a.trim().match(u)||""===a.trim())),a};r.$parsers.push(E),r.$parsers.push(F),r.$formatters.push(E),r.$formatters.push(F);var G=function(a){return j.$emit("ta-element-select",this),a.preventDefault(),!1},H=function(a,c){if(c&&angular.extend(a,c),!n&&!x){n=!0;var d;d=a.originalEvent?a.originalEvent.dataTransfer:a.dataTransfer,j.$emit("ta-drop-event",this,a,d),b(function(){n=!1},100)}};j["reApplyOnSelectorHandlers"+(q.id||"")]=function(){x||angular.forEach(l,function(a){p.find(a).off("click",G).on("click",G)})};var I=function(a){p[0].innerHTML=a};r.$render=function(){var a=r.$viewValue||"";f[0].activeElement!==p[0]?v?(q.placeholder?""===a?(y?p.removeClass("placeholder-text"):p.addClass("placeholder-text"),I(s)):(p.removeClass("placeholder-text"),I(a)):I(""===a?s:a),x?p.off("drop",H):(angular.forEach(l,function(a){p.find(a).on("click",G)}),p.on("drop",H))):"textarea"!==p[0].tagName.toLowerCase()&&"input"!==p[0].tagName.toLowerCase()?I(m(a)):p.val(a):v&&p.removeClass("placeholder-text")},q.taReadonly&&(x=j.$eval(q.taReadonly),x?(p.addClass("ta-readonly"),("textarea"===p[0].tagName.toLowerCase()||"input"===p[0].tagName.toLowerCase())&&p.attr("disabled","disabled"),void 0!==p.attr("contenteditable")&&p.attr("contenteditable")&&p.removeAttr("contenteditable")):(p.removeClass("ta-readonly"),"textarea"===p[0].tagName.toLowerCase()||"input"===p[0].tagName.toLowerCase()?p.removeAttr("disabled"):v&&p.attr("contenteditable","true")),j.$watch(q.taReadonly,function(a,b){b!==a&&(a?(p.addClass("ta-readonly"),("textarea"===p[0].tagName.toLowerCase()||"input"===p[0].tagName.toLowerCase())&&p.attr("disabled","disabled"),void 0!==p.attr("contenteditable")&&p.attr("contenteditable")&&p.removeAttr("contenteditable"),angular.forEach(l,function(a){p.find(a).on("click",G)}),p.off("drop",H)):(p.removeClass("ta-readonly"),"textarea"===p[0].tagName.toLowerCase()||"input"===p[0].tagName.toLowerCase()?p.removeAttr("disabled"):v&&p.attr("contenteditable","true"),angular.forEach(l,function(a){p.find(a).off("click",G)}),p.on("drop",H)),x=a)})),v&&!x&&(angular.forEach(l,function(a){p.find(a).on("click",G)}),p.on("drop",H),p.on("blur",function(){/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)&&(d=!0)}))}}}]).factory("taApplyCustomRenderers",["taCustomRenderers",function(a){return function(c){var d=angular.element("<div></div>");return d[0].innerHTML=c,angular.forEach(a,function(a){var c=[];a.selector&&""!==a.selector?c=d.find(a.selector):a.customAttribute&&""!==a.customAttribute&&(c=b(d,a.customAttribute)),angular.forEach(c,function(b){b=angular.element(b),a.selector&&""!==a.selector&&a.customAttribute&&""!==a.customAttribute?void 0!==b.attr(a.customAttribute)&&a.renderLogic(b):a.renderLogic(b)})}),d[0].innerHTML}}]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){var b=angular.element("<div/>");b.html(a);var c=b.text().length;return f>=c?(d.$setValidity("taMaxText",!0),a):void d.$setValidity("taMaxText",!1)}var f=parseInt(a.$eval(c.taMaxText));if(isNaN(f))throw"Max text must be an integer";c.$observe("taMaxText",function(a){if(f=parseInt(a),isNaN(f))throw"Max text must be an integer";d.$dirty&&d.$setViewValue(d.$viewValue)}),d.$parsers.unshift(e)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){function e(a){var b=angular.element("<div/>");b.html(a);var c=b.text().length;return!c||c>=f?(d.$setValidity("taMinText",!0),a):void d.$setValidity("taMinText",!1)}var f=parseInt(a.$eval(c.taMinText));if(isNaN(f))throw"Min text must be an integer";c.$observe("taMinText",function(a){if(f=parseInt(a),isNaN(f))throw"Min text must be an integer";d.$dirty&&d.$setViewValue(d.$viewValue)}),d.$parsers.unshift(e)}}}).factory("taFixChrome",function(){var a=function(a){for(var b=angular.element("<div>"+a+"</div>"),c=angular.element(b).find("span"),d=0;d<c.length;d++){var e=angular.element(c[d]);e.attr("style")&&e.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(e.attr("style",e.attr("style").replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,"")),e.attr("style")&&""!==e.attr("style")||(e.next().length>0&&"BR"===e.next()[0].tagName&&e.next().remove(),e.replaceWith(e[0].innerHTML)))}var f=b[0].innerHTML.replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");return f!==b[0].innerHTML&&(b[0].innerHTML=f),b[0].innerHTML};return a}).factory("taSanitize",["$sanitize",function(a){return function(c,d,e){var f=angular.element("<div>"+c+"</div>");angular.forEach(b(f,"align"),function(a){a.css("text-align",a.attr("align")),a.removeAttr("align")});var g;c=f[0].innerHTML;try{g=a(c),e&&(g=c)}catch(h){g=d||""}return g}}]).directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(a,b,c,d,e,f){return{scope:{name:"@"},restrict:"EA",link:function(g,h,i){if(!g.name||""===g.name)throw"textAngular Error: A toolbar requires a name";angular.extend(g,angular.copy(c)),i.taToolbar&&(g.toolbar=g.$parent.$eval(i.taToolbar)),i.taToolbarClass&&(g.classes.toolbar=i.taToolbarClass),i.taToolbarGroupClass&&(g.classes.toolbarGroup=i.taToolbarGroupClass),i.taToolbarButtonClass&&(g.classes.toolbarButton=i.taToolbarButtonClass),i.taToolbarActiveButtonClass&&(g.classes.toolbarButtonActive=i.taToolbarActiveButtonClass),
i.taFocussedClass&&(g.classes.focussed=i.taFocussedClass),g.disabled=!0,g.focussed=!1,g._$element=h,h[0].innerHTML="",h.addClass("ta-toolbar "+g.classes.toolbar),g.$watch("focussed",function(){g.focussed?h.addClass(g.classes.focussed):h.removeClass(g.classes.focussed)});var j=function(b,c){var d;if(d=angular.element(b&&b.display?b.display:"<button type='button'>"),d.addClass(b&&b["class"]?b["class"]:g.classes.toolbarButton),d.attr("name",c.name),d.attr("unselectable","on"),d.attr("ng-disabled","isDisabled()"),d.attr("tabindex","-1"),d.attr("ng-click","executeAction()"),d.attr("ng-class","displayActiveToolClass(active)"),b&&b.tooltiptext&&d.attr("title",b.tooltiptext),d.on("mousedown",function(a,b){return b&&angular.extend(a,b),a.preventDefault(),!1}),b&&!b.display&&!c._display&&(d[0].innerHTML="",b.buttontext&&(d[0].innerHTML=b.buttontext),b.iconclass)){var e=angular.element("<i>"),f=d[0].innerHTML;e.addClass(b.iconclass),d[0].innerHTML="",d.append(e),f&&""!==f&&d.append("&nbsp;"+f)}return c._lastToolDefinition=angular.copy(b),a(d)(c)};g.tools={},g._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var k={$window:f,$editor:function(){return g._parent},isDisabled:function(){return this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(a){return a?g.classes.toolbarButtonActive:""},executeAction:e};angular.forEach(g.toolbar,function(a){var b=angular.element("<div>");b.addClass(g.classes.toolbarGroup),angular.forEach(a,function(a){g.tools[a]=angular.extend(g.$new(!0),d[a],k,{name:a}),g.tools[a].$element=j(d[a],g.tools[a]),b.append(g.tools[a].$element)}),h.append(b)}),g.updateToolDisplay=function(a,b,c){var d=g.tools[a];if(d){if(d._lastToolDefinition&&!c&&(b=angular.extend({},d._lastToolDefinition,b)),null===b.buttontext&&null===b.iconclass&&null===b.display)throw'textAngular Error: Tool Definition for updating "'+a+'" does not have a valid display/iconclass/buttontext value';null===b.buttontext&&delete b.buttontext,null===b.iconclass&&delete b.iconclass,null===b.display&&delete b.display;var e=j(b,d);d.$element.replaceWith(e),d.$element=e}},g.addTool=function(a,b,c,e){g.tools[a]=angular.extend(g.$new(!0),d[a],k,{name:a}),g.tools[a].$element=j(d[a],g.tools[a]);var f;void 0===c&&(c=g.toolbar.length-1),f=angular.element(h.children()[c]),void 0===e?(f.append(g.tools[a].$element),g.toolbar[c][g.toolbar[c].length-1]=a):(f.children().eq(e).after(g.tools[a].$element),g.toolbar[c][e]=a)},b.registerToolbar(g),g.$on("$destroy",function(){b.unregisterToolbar(g.name)})}}}]).service("taToolExecuteAction",["$q",function(a){return function(b){void 0!==b&&(this.$editor=function(){return b});var c=a.defer(),d=c.promise,e=this.$editor();d["finally"](function(){e.endAction.call(e)});var f;try{f=this.action(c,e.startAction())}catch(g){}(f||void 0===f)&&c.resolve()}}]).service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(a,b,c){var d={},e={};return{registerEditor:function(c,f,g){if(!c||""===c)throw"textAngular Error: An editor requires a name";if(!f)throw"textAngular Error: An editor requires a scope";if(e[c])throw'textAngular Error: An Editor with name "'+c+'" already exists';var h=[];return angular.forEach(g,function(a){d[a]&&h.push(d[a])}),e[c]={scope:f,toolbars:g,_registerToolbar:function(a){this.toolbars.indexOf(a.name)>=0&&h.push(a)},editorFunctions:{disable:function(){angular.forEach(h,function(a){a.disabled=!0})},enable:function(){angular.forEach(h,function(a){a.disabled=!1})},focus:function(){angular.forEach(h,function(a){a._parent=f,a.disabled=!1,a.focussed=!0})},unfocus:function(){angular.forEach(h,function(a){a.disabled=!0,a.focussed=!1})},updateSelectedStyles:function(a){angular.forEach(h,function(b){angular.forEach(b.tools,function(b){b.activeState&&(b.active=b.activeState(a))})})},sendKeyCommand:function(c){var d=!1;return(c.ctrlKey||c.metaKey)&&angular.forEach(b,function(b,e){if(b.commandKeyCode&&b.commandKeyCode===c.which)for(var g=0;g<h.length;g++)if(void 0!==h[g].tools[e]){a.call(h[g].tools[e],f),d=!0;break}}),d},triggerElementSelect:function(a,c){var d=function(a,b){for(var c=!0,d=0;d<b.length;d++)c=c&&a.attr(b[d]);return c},e=[],g={},i=!1;c=angular.element(c);var j=!1;if(angular.forEach(b,function(a,b){a.onElementSelect&&a.onElementSelect.element&&a.onElementSelect.element.toLowerCase()===c[0].tagName.toLowerCase()&&(!a.onElementSelect.filter||a.onElementSelect.filter(c))&&(j=j||angular.isArray(a.onElementSelect.onlyWithAttrs)&&d(c,a.onElementSelect.onlyWithAttrs),(!a.onElementSelect.onlyWithAttrs||d(c,a.onElementSelect.onlyWithAttrs))&&(g[b]=a))}),j?(angular.forEach(g,function(a,b){a.onElementSelect.onlyWithAttrs&&d(c,a.onElementSelect.onlyWithAttrs)&&e.push({name:b,tool:a})}),e.sort(function(a,b){return b.tool.onElementSelect.onlyWithAttrs.length-a.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(g,function(a,b){e.push({name:b,tool:a})}),e.length>0)for(var k=0;k<e.length;k++){for(var l=e[k].tool,m=e[k].name,n=0;n<h.length;n++)if(void 0!==h[n].tools[m]){l.onElementSelect.action.call(h[n].tools[m],a,c,f),i=!0;break}if(i)break}return i}}},e[c].editorFunctions},retrieveEditor:function(a){return e[a]},unregisterEditor:function(a){delete e[a]},registerToolbar:function(a){if(!a)throw"textAngular Error: A toolbar requires a scope";if(!a.name||""===a.name)throw"textAngular Error: A toolbar requires a name";if(d[a.name])throw'textAngular Error: A toolbar with name "'+a.name+'" already exists';d[a.name]=a,angular.forEach(e,function(b){b._registerToolbar(a)})},retrieveToolbar:function(a){return d[a]},retrieveToolbarsViaEditor:function(a){var b=[],c=this;return angular.forEach(this.retrieveEditor(a).toolbars,function(a){b.push(c.retrieveToolbar(a))}),b},unregisterToolbar:function(a){delete d[a]},updateToolsDisplay:function(a){var b=this;angular.forEach(a,function(a,c){b.updateToolDisplay(c,a)})},resetToolsDisplay:function(){var a=this;angular.forEach(b,function(b,c){a.resetToolDisplay(c)})},updateToolDisplay:function(a,b){var c=this;angular.forEach(d,function(d,e){c.updateToolbarToolDisplay(e,a,b)})},resetToolDisplay:function(a){var b=this;angular.forEach(d,function(c,d){b.resetToolbarToolDisplay(d,a)})},updateToolbarToolDisplay:function(a,b,c){if(!d[a])throw'textAngular Error: No Toolbar with name "'+a+'" exists';d[a].updateToolDisplay(b,c)},resetToolbarToolDisplay:function(a,c){if(!d[a])throw'textAngular Error: No Toolbar with name "'+a+'" exists';d[a].updateToolDisplay(c,b[c],!0)},removeTool:function(a){delete b[a],angular.forEach(d,function(b){delete b.tools[a];for(var c=0;c<b.toolbar.length;c++){for(var d,e=0;e<b.toolbar[c].length;e++){if(b.toolbar[c][e]===a){d={group:c,index:e};break}if(void 0!==d)break}void 0!==d&&(b.toolbar[d.group].slice(d.index,1),b._$element.children().eq(d.group).children().eq(d.index).remove())}})},addTool:function(a,b,e,f){c(a,b),angular.forEach(d,function(c){c.addTool(a,b,e,f)})},addToolToToolbar:function(a,b,e,f,g){c(a,b),d[e].addTool(a,b,f,g)},refreshEditor:function(a){if(!e[a])throw'textAngular Error: No Editor with name "'+a+'" exists';e[a].scope.updateTaBindtaTextElement(),e[a].scope.$$phase||e[a].scope.$digest()}}}]).service("taSelection",["$window","$document",function(a,b){var c=b[0],d=function(a){if(a.hasChildNodes())return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null},e=function(a){var b=a.startContainer,c=a.endContainer;if(b===c)return[b];for(var e=[];b&&b!==c;)b=d(b),b.parentNode===a.commonAncestorContainer&&e.push(b);for(b=a.startContainer;b&&b!==a.commonAncestorContainer;)b.parentNode===a.commonAncestorContainer&&e.unshift(b),b=b.parentNode;return e};return{getSelection:function(){var b,d,e;return c.selection&&c.selection.createRange?(b=c.selection.createRange(),e=b.parentElement(),d={isCollapsed:0===b.text.length}):a.getSelection&&(d=a.getSelection(),d.getRangeAt?d.rangeCount>0&&(b=d.getRangeAt(0)):(b=c.createRange(),b.setStart(d.anchorNode,d.anchorOffset),b.setEnd(d.focusNode,d.focusOffset),b.collapsed!==d.isCollapsed&&(b.setStart(d.focusNode,d.focusOffset),b.setEnd(d.anchorNode,d.anchorOffset))),b&&(e=b.commonAncestorContainer,e=3===e.nodeType?e.parentNode:e)),b?{start:{element:b.startContainer,offset:b.startOffset},end:{element:b.endContainer,offset:b.endOffset},container:e,collapsed:d.isCollapsed}:{start:{offset:0},end:{offset:0},container:void 0,collapsed:!0}},getOnlySelectedElements:function(){if(window.getSelection){var b=a.getSelection();if(!b.isCollapsed)return e(b.getRangeAt(0))}return[]},getSelectionElement:function(){return this.getSelection().container},setSelection:function(b,d,e){if(c.createRange&&a.getSelection){var f=c.createRange();f.selectNodeContents(b),f.setStart(b,d),f.setEnd(b,e);var g=a.getSelection();g.removeAllRanges(),g.addRange(f)}else if(c.selection&&c.body.createTextRange){var h=c.body.createTextRange();h.moveToElementText(b),h.moveEnd("character",d),h.moveStart("character",e),h.select()}},setSelectionToElementStart:function(b){if(c.createRange&&a.getSelection){var d=c.createRange();d.selectNodeContents(b),d.setStart(b,0),d.setEnd(b,0);var e=a.getSelection();e.removeAllRanges(),e.addRange(d)}else if(c.selection&&c.body.createTextRange){var f=c.body.createTextRange();f.moveToElementText(b),f.collapse(!0),f.moveEnd("character",0),f.moveStart("character",0),f.select()}},setSelectionToElementEnd:function(b){if(c.createRange&&a.getSelection){var d=c.createRange();d.selectNodeContents(b),d.collapse(!1);var e=a.getSelection();e.removeAllRanges(),e.addRange(d)}else if(c.selection&&c.body.createTextRange){var f=c.body.createTextRange();f.moveToElementText(b),f.collapse(!1),f.select()}},insertHtml:function(a){var b,c;if(window.getSelection){if(b=window.getSelection(),b.getRangeAt&&b.rangeCount){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var e,f,g=document.createDocumentFragment();e=d.firstChild;)f=g.appendChild(e);c.insertNode(g),f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(a)}}}])}(),define("textAngular",["angular","rangy","textAngularSanit"],function(a){return function(){var b;return b||a.textAngular}}(this)),angular.module("textAngularSetup",[]).value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","insertImage","insertLink","insertVideo"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},setup:{textEditorSetup:function(a){},htmlEditorSetup:function(a){}},defaultFileDropHandler:function(a,b){var c=new FileReader;return"image"===a.type.substring(0,5)?(c.onload=function(){""!==c.result&&b("insertImage",c.result,!0)},c.readAsDataURL(a),!0):!1}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(a){var b=angular.element("<iframe></iframe>"),c=a.prop("attributes");angular.forEach(c,function(a){b.attr(a.name,a.value)}),b.attr("src",b.attr("ta-insert-video")),a.replaceWith(b)}}]).constant("taTranslations",{html:{buttontext:"Toggle HTML",tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unqoute selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"}}).run(["taRegisterTool","$window","taTranslations","taSelection",function(a,b,c,d){a("html",{buttontext:c.html.buttontext,tooltiptext:c.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var e=function(a){return function(){return this.$editor().queryFormatBlockState(a)}},f=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(b){a(b.toLowerCase(),{buttontext:b.toUpperCase(),tooltiptext:c.heading.tooltip+b.charAt(1),action:f,activeState:e(b.toLowerCase())})}),a("p",{buttontext:"P",tooltiptext:c.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),a("pre",{buttontext:"pre",tooltiptext:c.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),a("ul",{iconclass:"fa fa-list-ul",tooltiptext:c.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),a("ol",{iconclass:"fa fa-list-ol",tooltiptext:c.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),a("quote",{iconclass:"fa fa-quote-right",tooltiptext:c.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),a("undo",{iconclass:"fa fa-undo",tooltiptext:c.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),a("redo",{iconclass:"fa fa-repeat",tooltiptext:c.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),a("bold",{iconclass:"fa fa-bold",tooltiptext:c.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),a("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:c.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(a){var b=!1;return a&&(b="left"===a.css("text-align")||"left"===a.attr("align")||"right"!==a.css("text-align")&&"center"!==a.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")),b=b||this.$editor().queryCommandState("justifyLeft")}}),a("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:c.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(a){var b=!1;return a&&(b="right"===a.css("text-align")),b=b||this.$editor().queryCommandState("justifyRight")}}),a("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:c.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(a){var b=!1;return a&&(b="center"===a.css("text-align")),b=b||this.$editor().queryCommandState("justifyCenter")}}),a("indent",{iconclass:"fa fa-indent",tooltiptext:c.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),a("outdent",{iconclass:"fa fa-outdent",tooltiptext:c.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1}}),a("italics",{iconclass:"fa fa-italic",tooltiptext:c.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),a("underline",{iconclass:"fa fa-underline",tooltiptext:c.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),a("strikeThrough",{iconclass:"fa fa-strikethrough",action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),a("clear",{iconclass:"fa fa-ban",tooltiptext:c.clear.tooltip,action:function(a,b){var c;this.$editor().wrapSelection("removeFormat",null);var e=angular.element(d.getSelectionElement()),f=function(a){a=angular.element(a);var b=a;angular.forEach(a.children(),function(a){var c=angular.element("<p></p>");c.html(angular.element(a).html()),b.after(c),b=c}),a.remove()};if(angular.forEach(e.find("ul"),f),angular.forEach(e.find("ol"),f),"li"===e[0].tagName.toLowerCase()){var g=e[0].parentNode.childNodes,h=[],i=[],j=!1;for(c=0;c<g.length;c++)g[c]===e[0]?j=!0:j?i.push(g[c]):h.push(g[c]);var k=angular.element(e[0].parentNode),l=angular.element("<p></p>");if(l.html(angular.element(e[0]).html()),0===h.length||0===i.length)0===i.length?k.after(l):k[0].parentNode.insertBefore(l[0],k[0]),0===h.length&&0===i.length?k.remove():angular.element(e[0]).remove();else{var m=angular.element("<"+k[0].tagName+"></"+k[0].tagName+">"),n=angular.element("<"+k[0].tagName+"></"+k[0].tagName+">");for(c=0;c<h.length;c++)m.append(angular.element(h[c]));for(c=0;c<i.length;c++)n.append(angular.element(i[c]));k.after(n),k.after(l),k.after(m),k.remove()}d.setSelectionToElementEnd(l[0])}var o=this.$editor(),p=function(a){a=angular.element(a),a[0]!==o.displayElements.text[0]&&a.removeAttr("class"),angular.forEach(a.children(),p)};angular.forEach(e,p),"li"!==e[0].tagName.toLowerCase()&&"ol"!==e[0].tagName.toLowerCase()&&"ul"!==e[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","<p>"),b()}});var g=function(a,b,c){var d=function(){c.updateTaBindtaTextElement(),c.hidePopover()};a.preventDefault(),c.displayElements.popover.css("width","375px");var e=c.displayElements.popoverContainer;e.empty();var f=angular.element('<div class="btn-group" style="padding-right: 6px;">'),g=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');g.on("click",function(a){a.preventDefault(),b.css({width:"100%",height:""}),d()});var h=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');h.on("click",function(a){a.preventDefault(),b.css({width:"50%",height:""}),d()});var i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');i.on("click",function(a){a.preventDefault(),b.css({width:"25%",height:""}),d()});var j=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');j.on("click",function(a){a.preventDefault(),b.css({width:"",height:""}),d()}),f.append(g),f.append(h),f.append(i),f.append(j),e.append(f),f=angular.element('<div class="btn-group" style="padding-right: 6px;">');var k=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');k.on("click",function(a){a.preventDefault(),b.css("float","left"),d()});var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');l.on("click",function(a){a.preventDefault(),b.css("float","right"),d()});var m=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');m.on("click",function(a){a.preventDefault(),b.css("float",""),d()}),f.append(k),f.append(m),f.append(l),e.append(f),f=angular.element('<div class="btn-group">');var n=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');n.on("click",function(a){a.preventDefault(),b.remove(),d()}),f.append(n),e.append(f),c.showPopover(b),c.showResizeOverlay(b)};a("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:c.insertImage.tooltip,action:function(){var a;return a=b.prompt(c.insertImage.dialogPrompt,"http://"),a&&""!==a&&"http://"!==a?this.$editor().wrapSelection("insertImage",a,!0):void 0},onElementSelect:{element:"img",action:g}}),a("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:c.insertVideo.tooltip,action:function(){var a;if(a=b.prompt(c.insertVideo.dialogPrompt,"http://"),a&&""!==a&&"http://"!==a){var d=a.match(/(\?|&)v=[^&]*/);if(d.length>0){var e="http://www.youtube.com/embed/"+d[0].substring(3),f='<img class="ta-insert-video" ta-insert-video="'+e+'" contenteditable="false" src="" allowfullscreen="true" width="300" frameborder="0" height="250"/>';return this.$editor().wrapSelection("insertHTML",f,!0)}}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:g}}),a("insertLink",{tooltiptext:c.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var a;return a=b.prompt(c.insertLink.dialogPrompt,"http://"),a&&""!==a&&"http://"!==a?this.$editor().wrapSelection("createLink",a,!0):void 0},activeState:function(a){return a?"A"===a[0].tagName:!1},onElementSelect:{element:"a",action:function(a,d,e){a.preventDefault(),e.displayElements.popover.css("width","435px");var f=e.displayElements.popoverContainer;f.empty(),f.css("line-height","28px");var g=angular.element('<a href="'+d.attr("href")+'" target="_blank">'+d.attr("href")+"</a>");g.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),f.append(g);var h=angular.element('<div class="btn-group pull-right">'),i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on"><i class="fa fa-edit icon-edit"></i></button>');i.on("click",function(a){a.preventDefault();var f=b.prompt(c.insertLink.dialogPrompt,d.attr("href"));f&&""!==f&&"http://"!==f&&(d.attr("href",f),e.updateTaBindtaTextElement()),e.hidePopover()}),h.append(i);var j=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on"><i class="fa fa-unlink icon-unlink"></i></button>');j.on("click",function(a){a.preventDefault(),d.replaceWith(d.contents()),e.updateTaBindtaTextElement(),e.hidePopover()}),h.append(j);var k=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">Open in New Window</button>');"_blank"===d.attr("target")&&k.addClass("active"),k.on("click",function(a){a.preventDefault(),d.attr("target","_blank"===d.attr("target")?"":"_blank"),k.toggleClass("active"),e.updateTaBindtaTextElement()}),h.append(k),f.append(h),e.showPopover(d)}}})}]),define("textAngularSetup",["angular","rangy","textAngular"],function(a){return function(){var b;return b||a.textAngularSetup}}(this)),/*!
 *  howler.js v1.1.25
 *  howlerjs.com
 *
 *  (c) 2013-2014, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){var a={},b=null,c=!0,d=!1;try{"undefined"!=typeof AudioContext?b=new AudioContext:"undefined"!=typeof webkitAudioContext?b=new webkitAudioContext:c=!1}catch(e){c=!1}if(!c)if("undefined"!=typeof Audio)try{new Audio}catch(e){d=!0}else d=!0;if(c){var f="undefined"==typeof b.createGain?b.createGainNode():b.createGain();f.gain.value=1,f.connect(b.destination)}var g=function(a){this._volume=1,this._muted=!1,this.usingWebAudio=c,this.ctx=b,this.noAudio=d,this._howls=[],this._codecs=a,this.iOSAutoEnable=!0};g.prototype={volume:function(a){var b=this;if(a=parseFloat(a),a>=0&&1>=a){b._volume=a,c&&(f.gain.value=a);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].volume=b._howls[d]._volume*b._volume;return b}return c?f.gain.value:b._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(a){var b=this;b._muted=a,c&&(f.gain.value=a?0:b._volume);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].muted=a},codecs:function(a){return this._codecs[a]},_enableiOSAudio:function(){var a=this;if(!b||!a._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){a._iOSEnabled=!1;var c=function(){var d=b.createBuffer(1,1,22050),e=b.createBufferSource();e.buffer=d,e.connect(b.destination),"undefined"==typeof e.start?e.noteOn(0):e.start(0),setTimeout(function(){(e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE)&&(a._iOSEnabled=!0,a.iOSAutoEnable=!1,window.removeEventListener("touchstart",c,!1))},0)};return window.addEventListener("touchstart",c,!1),a}}};var h=null,i={};d||(h=new Audio,i={mp3:!!h.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!h.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!h.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(h.canPlayType("audio/x-mp4;")||h.canPlayType("audio/mp4;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var j=new g(i),k=function(a){var d=this;d._autoplay=a.autoplay||!1,d._buffer=a.buffer||!1,d._duration=a.duration||0,d._format=a.format||null,d._loop=a.loop||!1,d._loaded=!1,d._sprite=a.sprite||{},d._src=a.src||"",d._pos3d=a.pos3d||[0,0,-.5],d._volume=void 0!==a.volume?a.volume:1,d._urls=a.urls||[],d._rate=a.rate||1,d._model=a.model||null,d._onload=[a.onload||function(){}],d._onloaderror=[a.onloaderror||function(){}],d._onend=[a.onend||function(){}],d._onpause=[a.onpause||function(){}],d._onplay=[a.onplay||function(){}],d._onendTimer=[],d._webAudio=c&&!d._buffer,d._audioNode=[],d._webAudio&&d._setupAudioNode(),"undefined"!=typeof b&&b&&j.iOSAutoEnable&&j._enableiOSAudio(),j._howls.push(d),d.load()};if(k.prototype={load:function(){var a=this,b=null;if(d)return void a.on("loaderror");for(var c=0;c<a._urls.length;c++){var e,f;if(a._format)e=a._format;else{if(f=a._urls[c],e=/^data:audio\/([^;,]+);/i.exec(f),e||(e=/\.([^.]+)$/.exec(f.split("?",1)[0])),!e)return void a.on("loaderror");e=e[1].toLowerCase()}if(i[e]){b=a._urls[c];break}}if(!b)return void a.on("loaderror");if(a._src=b,a._webAudio)l(a,b);else{var h=new Audio;h.addEventListener("error",function(){h.error&&4===h.error.code&&(g.noAudio=!0),a.on("loaderror",{type:h.error?h.error.code:0})},!1),a._audioNode.push(h),h.src=b,h._pos=0,h.preload="auto",h.volume=j._muted?0:a._volume*j.volume();var k=function(){a._duration=Math.ceil(10*h.duration)/10,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play(),h.removeEventListener("canplaythrough",k,!1)};h.addEventListener("canplaythrough",k,!1),h.load()}return a},urls:function(a){var b=this;return a?(b.stop(),b._urls="string"==typeof a?[a]:a,b._loaded=!1,b.load(),b):b._urls},play:function(a,c){var d=this;return"function"==typeof a&&(c=a),a&&"function"!=typeof a||(a="_default"),d._loaded?d._sprite[a]?(d._inactiveNode(function(e){e._sprite=a;var f=e._pos>0?e._pos:d._sprite[a][0]/1e3,g=0;d._webAudio?(g=d._sprite[a][1]/1e3-e._pos,e._pos>0&&(f=d._sprite[a][0]/1e3+f)):g=d._sprite[a][1]/1e3-(f-d._sprite[a][0]/1e3);var h,i=!(!d._loop&&!d._sprite[a][2]),k="string"==typeof c?c:Math.round(Date.now()*Math.random())+"";if(function(){var b={id:k,sprite:a,loop:i};h=setTimeout(function(){!d._webAudio&&i&&d.stop(b.id).play(a,b.id),d._webAudio&&!i&&(d._nodeById(b.id).paused=!0,d._nodeById(b.id)._pos=0,d._clearEndTimer(b.id)),d._webAudio||i||d.stop(b.id),d.on("end",k)},1e3*g),d._onendTimer.push({timer:h,id:b.id})}(),d._webAudio){var l=d._sprite[a][0]/1e3,m=d._sprite[a][1]/1e3;e.id=k,e.paused=!1,o(d,[i,l,m],k),d._playStart=b.currentTime,e.gain.value=d._volume,"undefined"==typeof e.bufferSource.start?e.bufferSource.noteGrainOn(0,f,g):e.bufferSource.start(0,f,g)}else{if(4!==e.readyState&&(e.readyState||!navigator.isCocoonJS))return d._clearEndTimer(k),function(){var b=d,f=a,g=c,h=e,i=function(){b.play(f,g),h.removeEventListener("canplaythrough",i,!1)};h.addEventListener("canplaythrough",i,!1)}(),d;e.readyState=4,e.id=k,e.currentTime=f,e.muted=j._muted||e.muted,e.volume=d._volume*j.volume(),setTimeout(function(){e.play()},0)}return d.on("play"),"function"==typeof c&&c(k),d}),d):("function"==typeof c&&c(),d):(d.on("load",function(){d.play(a,c)}),d)},pause:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.pause(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=b.pos(null,a),b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else c.pause();return b.on("pause"),b},stop:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.stop(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=0,b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else isNaN(c.duration)||(c.pause(),c.currentTime=0);return b},mute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.mute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=0:c.muted=!0),b},unmute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.unmute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=b._volume:c.muted=!1),b},volume:function(a,b){var c=this;if(a=parseFloat(a),a>=0&&1>=a){if(c._volume=a,!c._loaded)return c.on("play",function(){c.volume(a,b)}),c;var d=b?c._nodeById(b):c._activeNode();return d&&(c._webAudio?d.gain.value=a:d.volume=a*j.volume()),c}return c._volume},loop:function(a){var b=this;return"boolean"==typeof a?(b._loop=a,b):b._loop},sprite:function(a){var b=this;return"object"==typeof a?(b._sprite=a,b):b._sprite},pos:function(a,c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(a)}),"number"==typeof a?d:d._pos||0;a=parseFloat(a);var e=c?d._nodeById(c):d._activeNode();if(e)return a>=0?(d.pause(c),e._pos=a,d.play(e._sprite,c),d):d._webAudio?e._pos+(b.currentTime-d._playStart):e.currentTime;if(a>=0)return d;for(var f=0;f<d._audioNode.length;f++)if(d._audioNode[f].paused&&4===d._audioNode[f].readyState)return d._webAudio?d._audioNode[f]._pos:d._audioNode[f].currentTime},pos3d:function(a,b,c,d){var e=this;if(b="undefined"!=typeof b&&b?b:0,c="undefined"!=typeof c&&c?c:-.5,!e._loaded)return e.on("play",function(){e.pos3d(a,b,c,d)}),e;if(!(a>=0||0>a))return e._pos3d;if(e._webAudio){var f=d?e._nodeById(d):e._activeNode();f&&(e._pos3d=[a,b,c],f.panner.setPosition(a,b,c),f.panner.panningModel=e._model||"HRTF")}return e},fade:function(a,b,c,d,e){var f=this,g=Math.abs(a-b),h=a>b?"down":"up",i=g/.01,j=c/i;if(!f._loaded)return f.on("load",function(){f.fade(a,b,c,d,e)}),f;f.volume(a,e);for(var k=1;i>=k;k++)!function(){var a=f._volume+("up"===h?.01:-.01)*k,c=Math.round(1e3*a)/1e3,g=b;setTimeout(function(){f.volume(c,e),c===g&&d&&d()},j*k)}()},fadeIn:function(a,b,c){return this.volume(0).play().fade(0,a,b,c)},fadeOut:function(a,b,c,d){var e=this;return e.fade(e._volume,a,b,function(){c&&c(),e.pause(d),e.on("end")},d)},_nodeById:function(a){for(var b=this,c=b._audioNode[0],d=0;d<b._audioNode.length;d++)if(b._audioNode[d].id===a){c=b._audioNode[d];break}return c},_activeNode:function(){for(var a=this,b=null,c=0;c<a._audioNode.length;c++)if(!a._audioNode[c].paused){b=a._audioNode[c];break}return a._drainPool(),b},_inactiveNode:function(a){for(var b=this,c=null,d=0;d<b._audioNode.length;d++)if(b._audioNode[d].paused&&4===b._audioNode[d].readyState){a(b._audioNode[d]),c=!0;break}if(b._drainPool(),!c){var e;if(b._webAudio)e=b._setupAudioNode(),a(e);else{b.load(),e=b._audioNode[b._audioNode.length-1];var f=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",g=function(){e.removeEventListener(f,g,!1),a(e)};e.addEventListener(f,g,!1)}}},_drainPool:function(){var a,b=this,c=0;for(a=0;a<b._audioNode.length;a++)b._audioNode[a].paused&&c++;for(a=b._audioNode.length-1;a>=0&&!(5>=c);a--)b._audioNode[a].paused&&(b._webAudio&&b._audioNode[a].disconnect(0),c--,b._audioNode.splice(a,1))},_clearEndTimer:function(a){for(var b=this,c=0,d=0;d<b._onendTimer.length;d++)if(b._onendTimer[d].id===a){c=d;break}var e=b._onendTimer[c];e&&(clearTimeout(e.timer),b._onendTimer.splice(c,1))},_setupAudioNode:function(){var a=this,c=a._audioNode,d=a._audioNode.length;return c[d]="undefined"==typeof b.createGain?b.createGainNode():b.createGain(),c[d].gain.value=a._volume,c[d].paused=!0,c[d]._pos=0,c[d].readyState=4,c[d].connect(f),c[d].panner=b.createPanner(),c[d].panner.panningModel=a._model||"equalpower",c[d].panner.setPosition(a._pos3d[0],a._pos3d[1],a._pos3d[2]),c[d].panner.connect(c[d]),c[d]},on:function(a,b){var c=this,d=c["_on"+a];if("function"==typeof b)d.push(b);else for(var e=0;e<d.length;e++)b?d[e].call(c,b):d[e].call(c);return c},off:function(a,b){var c=this,d=c["_on"+a],e=b?b.toString():null;if(e){for(var f=0;f<d.length;f++)if(e===d[f].toString()){d.splice(f,1);break}}else c["_on"+a]=[];return c},unload:function(){for(var b=this,c=b._audioNode,d=0;d<b._audioNode.length;d++)c[d].paused||(b.stop(c[d].id),b.on("end",c[d].id)),b._webAudio?c[d].disconnect(0):c[d].src="";for(d=0;d<b._onendTimer.length;d++)clearTimeout(b._onendTimer[d].timer);var e=j._howls.indexOf(b);null!==e&&e>=0&&j._howls.splice(e,1),delete a[b._src],b=null}},c)var l=function(b,c){if(c in a)return b._duration=a[c].duration,void n(b);if(/^data:[^;]+;base64,/.test(c)){for(var d=atob(c.split(",")[1]),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);m(e.buffer,b,c)}else{var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=function(){m(g.response,b,c)},g.onerror=function(){b._webAudio&&(b._buffer=!0,b._webAudio=!1,b._audioNode=[],delete b._gainNode,delete a[c],b.load())};try{g.send()}catch(h){g.onerror()}}},m=function(c,d,e){b.decodeAudioData(c,function(b){b&&(a[e]=b,n(d,b))},function(a){d.on("loaderror")})},n=function(a,b){a._duration=b?b.duration:a._duration,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play()},o=function(c,d,e){var f=c._nodeById(e);f.bufferSource=b.createBufferSource(),f.bufferSource.buffer=a[c._src],f.bufferSource.connect(f.panner),f.bufferSource.loop=d[0],d[0]&&(f.bufferSource.loopStart=d[1],f.bufferSource.loopEnd=d[1]+d[2]),f.bufferSource.playbackRate.value=c._rate};"function"==typeof define&&define.amd&&define("howler",[],function(){return{Howler:j,Howl:k}}),"undefined"!=typeof exports&&(exports.Howler=j,exports.Howl=k),"undefined"!=typeof window&&(window.Howler=j,window.Howl=k)}(),define("services/HttpService",["app","battlecat","cdn","conf/cdn"],function(a,b,c,d){a.factory("httpService",["$rootScope",function(a){var e=function(e,f){var g=function(b){f(b),a.$$phase||a.$apply()};b.get(c.getPath(e),g,d.ENABLED)};return{get:e}}])}),define("construct/SocketWorker",["cdn","plugins"],function(a){var b=function(){var b={},c=this,d=new window.Worker(a.getPath("/js/socket-worker.js",!0)),e=["connect","reconnect"],f=function(a){return a.data.event?(c.socket.connected=e.indexOf(a.data.event)>=0,void c.trigger(a.data.event,a.data.message)):void c.trigger("msg",a.data)},g=function(a,c){b[a]||(b[a]=[]),b[a].push(c)},h=function(a,c){var d,e=b[a];if(e&&e.length)for(d=0;d<e.length;d++)b[a][d](c)},i=function(a,b){d.postMessage(b)};this.on=g,this.trigger=h,this.emit=i,this.socket={connected:!1},d.onmessage=f};return b}),define("services/SocketService",["angular","app","conf/conf","construct/SocketWorker"],function(a,b,c,d){b.factory("socketService",["$rootScope","$socket","$exceptionHandler","eventTypeProvider","errorService",function(b,e,f,g,h){var i,j,k=!1,l={},m={},n=[],o=[],p=0,q={},r="System/error",s=!1,t=function(a){var b;l[a.id]&&(b=l[a.id],window.clearTimeout(m[a.id]),delete l[a.id],delete m[a.id],b(a.data,a.type))},u=function(a){b.$apply(function(){e.handleResponse(a),b.$broadcast(a.type,a.data),t(a)}),n.length&&j(n.shift())},v=function(){if(k)throw new Error("socketService has already been initialized!");i=new d,i.on(c.SOCKET_KEY,j),i.on("reconnect",function(){b.$broadcast(g.RECONNECT)}),i.on("connect",function(){b.$broadcast(g.SOCKET_CONNECTED,i)}),i.on("error",function(){b.$broadcast(g.SOCKET_ERROR,i)}),i.on("disconnect",function(){window.twx.unloading||b.$broadcast(g.SOCKET_DISCONNECTED,i)}),i.on("reconnect",function(){}),i.on("reconnect_attempt",function(){b.$broadcast(g.SOCKET_RECONNECTED_ATTEMPT,i)}),i.on("reconnecting",function(a,c){b.$broadcast(g.SOCKET_RECONNECTING,i,a,c)}),i.on("reconnect_error",function(){b.$broadcast(g.SOCKET_RECONNECT_ERROR,i)}),i.on("reconnect_failed",function(){b.$broadcast(g.SOCKET_RECONNECT_FAILED,i)})},w=function(b,d,e){var g,h;if(s&&!i.socket.connected)return c.SOCKET_DEBUG,void o.push({route:b,data:d,opt_callback:e});if(b.data)for(g=b.data.length,h=0;g>h;h++)if(0!==b.data[h].indexOf("opt_")&&!d.hasOwnProperty(b.data[h]))throw new Error('Missing parameter "'+b.data[h]+'" for route "'+b.type+'"');p=++p,c.SOCKET_DEBUG,a.isFunction(e)&&(l[p]=e,m[p]=window.setTimeout(function(){!i.socket.connected,f(new Error("Timeout: "+b.type),{route:b})},c.LOADING_TIMEOUT)),i.emit(c.SOCKET_KEY,{type:b.type,data:d,id:p})},x=function(b,c,d){var e=b.length,f=e,g=[];b.forEach(function(b,e){w(b,c[e],function(b){g[e]=b,--f||a.isFunction(d)&&d(g)})})},y=function z(a,b,c,d){var e=a.shift(),f=b.shift();w(e,f,function(e){d=d||[],d.push(e),a.length?z(a,b,c,d):c&&c(d)})};return j=function(a){return c.SOCKET_DEBUG&&a.data,a.type===r?(h.handle(a.data,function(){a.type=g.MESSAGE_ERROR,u(a)}),void(l[a.id]&&(window.clearTimeout(m[a.id]),delete l[a.id],delete m[a.id]))):void(b.$$phase?n.push(a):u(a))},b.$on(g.SOCKET_EMIT,function(a,b,c,d){w(b,c,d)}),b.$on(g.SOCKET_EMIT_MULTIPLE,function(a,b,c,d){x(b,c,d)}),b.$on(g.LOGIN_SUCCESS,function(){s=!0}),b.$on(g.RECONNECTED,function(){}),v(),{emitMultiple:x,emitInOrder:y,emit:w,debug:q}}])}),define("helper/mapconvert",["conf/conf"],function(a){var b=a.MAP_SIZE,c=a.TILE_COUNT,d=a.BITS_IN_TILE_PER_BYTE,e=function(a,c){return 1&c?[b*(a-1)+c,b*a+c-1,b*(a+1)+c-1,b*(a+1)+c,b*(a+1)+c+1,b*a+c+1]:[b*(a-1)+c,b*(a-1)+c-1,b*a+c-1,b*(a+1)+c,b*a+c+1,b*(a-1)+c+1]},f=function(a,b){if(!(0>b||b>=c)){var e,f=b%8,g=(b-f)*d;switch(f){case 0:e=a.getUint8(g)>>3;break;case 1:e=(a.getUint8(g)<<2)+(a.getUint8(g+1)>>6);break;case 2:e=a.getUint8(g+1)>>1;break;case 3:e=(a.getUint8(g+1)<<4)+(a.getUint8(g+2)>>4);break;case 4:e=(a.getUint8(g+2)<<1)+(a.getUint8(g+3)>>7);break;case 5:e=a.getUint8(g+3)>>2;break;case 6:e=(a.getUint8(g+3)<<3)+(a.getUint8(g+4)>>5);break;case 7:e=a.getUint8(g+4)}return 31&e}},g=function(a){var b,c,d,e,f,g,h,i="Function IEBinaryToArray_ByteStr(Binary)\r\n	IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n	Dim lastIndex\r\n	lastIndex = LenB(Binary)\r\n	if lastIndex mod 2 Then\r\n		IEBinaryToArray_ByteStr_Last = AscB( MidB( Binary, lastIndex, 1 ) )\r\n	Else\r\n		IEBinaryToArray_ByteStr_Last = -1\r\n	End If\r\nEnd Function\r\n",j="",k=255;try{b=IEBinaryToArray_ByteStr(a)}catch(l){window.execScript(i,"vbscript"),b=IEBinaryToArray_ByteStr(a)}for(c=IEBinaryToArray_ByteStr_Last(a),d=0,f=b.length%8;f>d;)h=b.charCodeAt(d++),j+=String.fromCharCode(255&h,h>>8);for(f=b.length;f>d;){for(g=[],e=0;8>e;e++)h=b.charCodeAt(d++),g.push(h&k,h>>8);j+=String.fromCharCode.apply(String,g)}return c>-1&&(j+=String.fromCharCode(c)),j},h=function(a,c,d){var g,h,i,j,k=d+b*c;if(i=f(a,k))if(i>>>4){for(g=e(c,d),h=g.length;h--;)g[h]=f(a,g[h]);j={b:g,w:i>>2&1,c:i>>3&1}}else j={p:i>>2&3,l:2===(3&i),f:1===(1&i),s:3===(3&i)};else{if(void 0===i)return;j={p:3}}return{x:c,y:d,key:j}},i=function(a,b,c,d,e){var f,g,h=Math.floor(a/e),i=Math.floor(b/e),j=Math.floor((a+c)/e),k=Math.floor((b+d)/e),l=[];for(f=h;j>=f;f++)for(g=i;k>=g;g++)l.push([f,g]);return l};return{responseBodyToText:g,toTile:h,scaledGridCoordinates:i}}),define("models/MapDataModel",["conf/conf","helper/mapconvert","cdn"],function(a,b,c){{var d,e=a.MAP_SIZE,f=e-1,g=a.MAP_CHUNK_SIZE;a.TILE_COUNT*a.BITS_IN_TILE_PER_BYTE}return d=function(){var d,h,i,j,k,l=function(a){var b,c;for(b=0,c=[];a>b;b++)c[b]=null;return c.concat().map(function(){return c.concat()})},m=l(e/g),n=m.length,o=0,p={},q=[],r=[],s=function(){},t=function(a,b){return b.flags={},a[b.x]=a[b.x]||{},a[b.x][b.y]=b,a},u=function(a){j=$.browser.msie?a.target.response||b.responseBodyToText(a.target.responseBody):a.target.response,i=window.DataView?new window.DataView(j):{getUint8:function(a){return 255&j.charCodeAt(a)}},k=j.byteLength||j.length},v=function(a,c,d,f,h,i){var j,k,l,o,p=[];if(isNaN(a)&&isNaN(c))return!1;for(a=a.bound(0,e),c=c.bound(0,e),d=d.bound(0,e),f=f.bound(0,e),j=b.scaledGridCoordinates(a,c,d,f,g),k=j.length;k--;){if(l=j[k][0],o=j[k][1],l>=n||o>=n)return[];!m[l][o]||i?(s({x:l*g,y:o*g,width:g,height:g}),m[l][o]={requestedAt:Date.now(),receivedAt:0,data:null,callbacks:h?[h]:[],numChunks:j.length}):m[l][o].receivedAt?h&&h(m[l][o].data,j.length):h&&m[l][o].callbacks.indexOf(h)<0&&m[l][o].callbacks.push(h),p.indexOf(m[l][o])<0&&p.push(m[l][o])}return h?null:p},w=function(a,b,c,d){var e,f;if(m[c]&&m[c][d]&&m[c][d].data)for(e in p){if(!p[e])break;if((~~e).between(a,a+g))for(f in p[e])(~~f).between(b,b+g)&&(m[c][d].data||(m[c][d].data={}),m[c][d].data[e]=m[c][d].data[e]||{},m[c][d].data[e][f],m[c][d].data[e][f]=p[e][f])}},x=function(a,c,d,e){var g,h,j,k,l,m,n=[];for(a=Math.max(0,a),c=Math.max(0,c),l=Math.min(a+d,f),m=Math.min(c+e,f),k=c;m>=k;k++){for(g=0,h=[],j=a;l>=j;j++)j>=0&&k>=0&&((void 0===q[j]||void 0===q[j][k])&&(q[j]=q[j]||[],q[j][k]=b.toTile(i,j,k)),h[g++]=q[j][k]);n=n.concat(h)}return n},y=function(a,b,c,d){return v(a,b,c,d)},z=function(a,b,c,d){return{tiles:x(a,b,c,d),towns:y(a,b,c,d)}},A=function(a,b){var e;return d!==a?(e=new XMLHttpRequest,e.open("GET",c.getPath(a),!0),e.responseType="arraybuffer",e.addEventListener("load",function(c){d=a,u(c),b(c)},!1),e.send()):b(),this},B=function(a,b,c,d,e,f){return null===a&&null===b?void e(null):void v(a,b,c,d,function(a,b){e(a,b)},f)},C=function(a,b,c,d,e,f){return null===a&&null===b?void e(null):void v(a,b,c,d,function(c){e(c&&c[a]&&c[a][b]?c[a][b]:null)},f)},D=function(a,b){var c=y(a,b,1,1);try{if(c=c.reduce(function(c,d){return c.data&&c.data[a]&&c.data[a][b]?c:d}),!(c.data&&c.data[a]&&c.data[a][b]))return null;c=c.data[a][b]}catch(d){}return c},E=function(a,b,c,d){C(a,b,1,1,function(a){c(a)},d)},F=function(a){var b,c,d,e;for(b in p){if(!p[b])break;for(c in p[b])if(p[b][c].id===a)return p[b][c]}for(b=m.length;b--;)for(c=m[b].length;c--;)if(m[b]&&m[b][c]&&m[b][c].data)for(d in m[b][c].data)for(e in m[b][c].data[d])if(m[b][c].data[d][e].id===a)return m[b][c].data[d][e];return!1},G=function(){for(var a,b,c,d=[],e=m.length;e--;)for(a=m[e].length;a--;)if(m[e]&&m[e][a]&&m[e][a].data)for(b in m[e][a].data)for(c in m[e][a].data[b])d.push(m[e][a].data[b][c]);return d},H=function(a){var b,c=G();for(b=0;b<c.length;b++)a.call(this,c[b])},I=function(a,b){var c=F(a);c.name=b},J=function(a,b,c){var d=F(a);d.x=b,d.y=c},K=function(a){var b,c=a.x/g|0,d=a.y/g|0;if(m[c][d]=m[c][d]||{},m[c][d].data=a.villages.reduce(t,m[c][d].data||{}),w(a.x,a.y,c,d),m[c][d].callbacks)for(;b=m[c][d].callbacks.pop();)b(m[c][d].data,m[c][d].numChunks);return m[c][d].receivedAt=Date.now(),(h||r.length)&&(window.clearTimeout(h),h=null,r.length&&window.setTimeout(s,0)),m[c][d]},L=function(a){var b=a.x/g|0,c=a.y/g|0;p=a.villages.reduce(t,p),m[b][c]&&w(a.x,a.y,b,c)},M=function(a){var b,c,d=F(a);if(!d)return!1;b=d.x/g|0,c=d.y/g|0,delete p[d.x][d.y];try{delete m[b][c].data[d.x][d.y]}catch(e){}return!0},N=function(a,b){var c=a/g|0,d=b/g|0;return!!m[c][d]},O=function(b){var c=function(){h=h||window.setTimeout(function(){r.length&&(h=null,s())},1e3/a.MAP_REQUESTS_PER_SECOND+10)};s=function(d){return d&&a.MAP_REQUESTS_PER_SECOND&&Date.now()-1e3/a.MAP_REQUESTS_PER_SECOND<o?(r.push(d),void c()):(d=d||r.shift(),d&&(o=Date.now(),b(d)),void(r.length&&c()))}},P=function(a,b){var c,d,f,g,h=x(a,b,0,0)[0],i=[],j={},k=[];if(!h||!h.key||h.key.b)return null;for(g=h.key.p,i.push([a,b]);i.length;)f=i.pop(),c=f[0],d=f[1],j[c]&&j[c][d]||!c.between(0,e)||!d.between(0,e)||(h=x(c,d,0,0)[0],j[c]=j[c]||{},j[c][d]=!0,h.key.b||h.key.p!==g||(k.push(h),i.push([c,d+1],[c,d-1],[c+1,d],[c-1,d])));return k};this.loadByteLevel=x,this.loadTownData=y,this.loadTownLevel=z,this.load=A,this.loadTownDataAsync=C,this.loadMapDataAsync=B,this.getTownAt=D,this.getTownAtAsync=E,this.getTownById=F,this.getTowns=G,this.onEachTown=H,this.setTownName=I,this.setTownCoords=J,this.setTownData=K,this.setSpecialLocationData=L,this.removeSpecialLocation=M,this.hasTownDataInChunk=N,this.setRequestFn=O,this.getProvince=P}}),define("struct/MapData",["models/MapDataModel"],function(a){var b=new a;return b}),define("models/Contact",[],function(){var a="character",b="tribe",c=function(a,b,c,d){var e;this.type=a,this.name=c,this.id=b,this.icon=d;for(e in this)if(this.hasOwnProperty(e)&&void 0===e)throw new Error("Invalid argument: "+e)};return c.prototype.isCharacter=function(){return this.type===a},c.prototype.isTribe=function(){return this.type===b},c}),define("helper/time",["conf/conf"],function(a){var b,c={},d={},e=function(a,b){for(b=b||2,a=a.toString();a.length<b;)a="0"+a;return a},f=function(a,b,c,d){var e,f;return!a||b||c||d||(f="days",e=a),a||!b||c||d||(f="hours",e=b),a||b||!c||d||(f="minutes",e=c),a||b||c||!d||(f="seconds",e=d),{key:f,value:e,textObject:"time"}},g=function(a,b,c){var g,h,i,j,k=60,l=k*k,m=b&&0>a?"-":"";if(a=Math.abs(a),isNaN(a))throw new Error("seconds is not a number:",a);return g=a/d.day|0,a-=g*d.day,h=a/l|0,i=(a-h*l)/k|0,a=a%k|0,g&&(m=m+g+":"),c&&(j=f(g,h,i,a))?j:m+(g?e(h):h)+":"+e(i)+":"+e(a)},h=function(a,b,c,d){var g,h,i,j,k=60,l=k*k,m=24*l,n=b&&0>a?"-":"",o=Math.abs(.001*a);if(isNaN(o))throw new Error;return c&&(g=o/m,g>1?(g|=0,o-=g*m):g=null),h=o/l|0,i=(o-h*l)/k|0,o=o%k|0,g&&(n=n+g.toString(10)+":"),d&&(j=f(g,h,i,o))?j:n+(g?e(h):h)+":"+e(i)+":"+e(o)},i=function(a){for(var b=a.split(":"),c=0,d=1;b.length>0;)c+=d*(parseInt(b.pop(),10)||0),d*=60;return c},j=function(b){return b-a.csDiff},k=function(b){return 1e3*b-a.csDiff},l=function(b){return b-.001*a.csDiff},m=function(){this.start=Date.now(),this.stop=this.time=null},n={start:function(){return b?!1:b=new m},stop:function(){var a=b||(b=new m);return b.stop=Date.now(),b.time=b.stop-b.start,b=null,a},time:function(){return b?(b.time=Date.now()-b.start,b):!1}},o=function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())},p=function(){var b=[],c=a.TICK,d=null,e=0,f=!1,g=50,h=null,i=function(){var a=Date.now(),c=b.length;if(!(e+g>a||f)){for(;c--;)b[c]();e=a,h=h||window.injector.get("$rootScope"),h.$$phase||h.$apply()}},j=function(){return b.length?void(d||(d=window.setInterval(i,c))):(d=window.clearInterval(d),void(d=null))},k=function(a){b.unshift(a),j()},l=function(a){var c,d=b.length,e=!1;for(c=0;d>c;c++)b[c]===a&&(b.remove(c),e=!0);return j(),e},m=function(){f=!0},n=function(){f=!1},o=function(){e=0,b=[],j()};return{tick:i,add:k,remove:l,stop:m,resume:n,clear:o}}();return c.min=6e4,c.fiveMin=5*c.min,c.tenMin=10*c.min,c.hour=60*c.min,c.sixHour=6*c.hour,c.day=24*c.hour,c.threeDay=3*c.day,d.min=60,d.fiveMin=5*d.min,d.tenMin=10*d.min,d.hour=60*d.min,d.sixHour=6*d.hour,d.day=24*d.hour,d.threeDay=3*d.day,d.year=365*d.day,{inS:d,inMS:c,timer:p,zerofill:e,readableSeconds:g,readableMilliseconds:h,unreadableSeconds:i,milliseconds2ClientTime:j,server2ClientTime:k,server2ClientTimeInSeconds:l,stopWatch:n,convertDateToUTC:o,convertToTimeString:f}}),define("models/GenericJobModel",["helper/time"],function(a){var b=function(){};return b.prototype.percent=function(a){return a=a||Date.now(),Math.floor(100*(1-(this.completedAt-a)/this.duration)).bound(0,100)},b.prototype.completionTime=function(){return this.completedAt},b.prototype.countdown=function(b){return b=(b||Date.now()).bound(this.startedAt,this.completedAt),a.readableMilliseconds(b-this.completedAt)},b.prototype.cancelTime=function(a){if(!this.maxCancelTime)throw new Error("Can not calculate canceltime w/o maxCancelTime");if(this.returning)return 0;var b=(this.startedAt+this.maxCancelTime).bound(this.startedAt,this.completedAt);return a=(a||Date.now()).bound(this.startedAt,this.completedAt),b-a},b.prototype.readableCancelTime=function(b){return a.readableMilliseconds(this.cancelTime(b))},b}),define("models/CommandModel",["models/GenericJobModel","helper/time"],function(a,b){var c=function(a,b,c,d,e,f,g){if(!a||!a.village||!a.character)throw new Error("Can not write invalid destination object");a.village.id=b,a.village.name=c,a.character.name=f||null,a.character.id=g||null,a.village.x=d,a.village.y=e},d=function e(a){a.home||(a.home={x:a.start_village_x,y:a.start_village_y,id:a.start_village_id,name:a.start_village_name}),a.target||(a.target={x:a.target_village_x,y:a.target_village_y,id:a.target_village_id,name:a.target_village_name}),this.jobType="command",this.id=a.id,this.type=a.type,this.icon=a.icon,this.warPlanner=a.war_planner,this.startVillageId=a.home.id,this.startVillageName=a.home.name,this.startCharacterName=a.home.character||null,this.startCharacterId=a.home.character_id||a.home.characterId||null,this.startX=a.home.x,this.startY=a.home.y,this.targetVillageId=a.target.id,this.targetVillageName=a.target.name,this.targetCharacterName=a.target.character||null,this.targetCharacterId=a.target.character_id||a.target.characterId||null,this.targetX=a.target.x,this.targetY=a.target.y,this.targetIsBarbarian=null===a.target.character_id,this.startedAt=b.server2ClientTime(a.time_start),this.completedAt=b.server2ClientTime(a.time_completed),this.duration=this.completedAt-this.startedAt,this.returning=a.direction===e.DIRECTION_INCOMING,this.units=a.units||null,this.isSpy="buildings"===this.type||"sabotage"===this.type||"units"===this.type||/scouting/.test(this.type),this.isCommand=!0,this.isSpy?this.actionType="spying":this.actionType=this.type,this.setDestination(this.returning)};return d.DIRECTION_INCOMING="back",d.DIRECTION_OUTGOING="forward",d.inherits(a),d.prototype.setDestination=function(a){this.destination||(this.destination={},this.destination.village={},this.destination.character={}),a?c(this.destination,this.startVillageId,this.startVillageName,this.startX,this.startY,this.startCharacterName,this.startCharacterId):c(this.destination,this.targetVillageId,this.targetVillageName,this.targetX,this.targetY,this.targetCharacterName,this.targetCharacterId)},d.prototype.arrivalTime=d.prototype.completionTime,d}),define("helper/dataconversion",["struct/MapData","models/Contact","models/CommandModel"],function(a,b,c){var d=function(a){return new c(a)},e=function(a,b){void 0!==b.start_village_id&&b.start_village_id!==a.getId();var d=new c({id:b.id,type:"scouting_"+b.type,home:{id:a.getId(),x:a.getX(),y:a.getY()},target:{id:b.target_village_id,x:b.target_village_x,y:b.target_village_y},time_completed:b.time_completed,time_start:b.time_start,direction:b.direction});return d},f=function(a,b,c){var d=a&&a.icon||b;if(c="number"==typeof c&&c||6,"number"==typeof d)for(d=d.toString(16);d.length<c;)d="0"+d;return a&&(a.icon=d),d},g=function(a){return new b("character",a.character_id,a.character_name,0)},h=function(a){return new b(a.contact_type,a.contact_id,a.contact_name,0)};return{scouting:e,command:d,icon:f,friend:h,participant:g}}),define("models/TribeSkillModel",[],function(){var a=function(a){if(!a.type||"undefined"===a.max_level||"undefined"===a.current_level||"undefined"===a.points_needed||!a.effect_items)throw new Error("Missing properties in modelData.");this.type=a.type,this.maxLevel=a.max_level,this.currentLevel=a.current_level,this.points_needed=a.points_needed,this.effectItems=a.effect_items};return a.prototype.getProgress=function(){return this.currentLevel/this.maxLevel*100},a.prototype.isMaxed=function(){return this.currentLevel===this.maxLevel},a}),define("models/TribeSkillListModel",["models/TribeSkillModel"],function(a){var b=function(b){var c,d,e;for(this.skills=[],this.effectTypes=[],c=0;c<b.length;c++)for(this.skills[c]=new a(b[c]),e=b[c].effect_items[0],d=0;d<e.length;d++)this.effectTypes.pushDistinct(e[d].type)};return b.prototype.getSkillModels=function(){return this.skills},b.prototype.getEffectTypes=function(){return this.effectTypes},b.prototype.getSkillContainingEffect=function(a){var b,c,d;return-1===this.getEffectTypes().indexOf(a)?null:this.skills.filter(function(e){for(b=e.effectItems[0],c=!1,d=0;d<b.length;d++)if(b[d].type===a){c=!0;break}return c})[0]},b.prototype.isEffectFromSkill=function(a){return-1!==this.effectTypes.indexOf(a)},b.prototype.isSkillActive=function(a){return this.skills.filter(function(b){return b.type===a&&b.currentLevel>0}).length>0},b}),define("models/SecondVillageModel",["helper/time"],function(a){var b=function(a){this.data=a,this.x=a.coordinates.x,this.y=a.coordinates.y};return b.prototype.getCoordinates=function(){return this.data.coordinates||null},b.prototype.getExpirationTime=function(){return a.server2ClientTime(this.data.expiration_time)||null},b.prototype.isAvailable=function(){return null!==this.x&&null!==this.y},b}),define("conf/recruitingQueueTypes",[],function(){var a="academy",b="barracks",c="preceptory",d="statue",e="tavern",f={snob:a,knight:d,trebuchet:c,doppelsoldner:c,spy:e},g=function(a){return f[a]||b};return{ACADEMY:a,BARRACKS:b,PRECEPTORY:c,STATUE:d,TAVERN:e,getQueueTypeByUnitType:g}}),define("services/SocketModelService",["angular","app","conf/conf","version","helper/dataconversion","struct/MapData","queues/EventQueue","models/TribeSkillListModel","models/SecondVillageModel","conf/recruitingQueueTypes","helper/time"],function(a,b,c,d,e,f,g,h,i,j,k){b.factory("socketModelService",["$rootScope","modelDataService","storageService","playerModelProvider","characterModelProvider","friendListModelProvider","villageModelProvider","buildingDataModelProvider","buildingQueueModelProvider","timelineModelProvider","eventTypeProvider","routeProvider","worldConfigModelProvider","conversationModelProvider","globalInfoModelProvider","timelineDataProvider","inventoryModelHandler","questLineModelHandler","recruitJobHandler","commandHandler","gameDataResearchesModelHandler","tradeListModelHandler","inviteFriendHandler","windowManagerService","secondVillageService","effectModelHandler","forumHandler","forumThreadService","armyPresetHandler","resourceDepositHandler","tribeHandler","resourceService",function(b,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M){
var N={},O=function(a){var b;for(b in a){if(N[b])throw new Error("EventType "+b+" is already registered!");N[b]=a[b]}},P=function(a){c.csDiff=1e3*a.server_timestamp-Date.now(),delete a.server_timestamp,h.setPlayer(k(a))},Q=function(a){h.setGameDataBuildings(a)},R=function(a){h.setOfficers(a)},S=function(a){h.setGameDataBaseData(a)},T=function(a){var b=h.getGameData();b.setCostsPerCoin(a)},U=function(a){h.setGameDataUnits(a)},V=function(a){h.setGameDataPremiumCosts(a)},W=function(a){var b=h.getSelectedCharacter();b.setTotalNobles({active:a.nobles_total,training:a.nobles_training})},X=function(b){var c,d=[],e=h.getPlayer(),f=e.getSelectedCharacter(),g=h.getGameData();for(a.forEach(b.villages,function(a){a.villageId=a.id,delete a.id,null===a.x&&(a.x=0,a.y=0),d.push(n(a))}),f.setVillages(d),c=0;c<b.new_report_ids.length;c++)g.addNewReport(b.new_report_ids[c]);for(c=0;c<b.new_message_ids.length;c++)g.addNewMessage(b.new_message_ids[c]);I.updateNewThreadCount(b.new_thread_ids,!0),f.hasChapel(b.hasChapel),f.setChapelInQueue(b.chapel_in_queue),f.setGoldCoins(b.gold_coins),f.setPoints(b.points),f.setRank(b.rank),f.setTutorialStatus(b.tutorial),f.setLastRestartTime(b.time_last_restart),f.setValidatedEmail(b.email_confirmed)},Y=function(a){var b=h.getPlayer(),c=b.getSelectedCharacter(),d=c.getGoldCoins();c.setGoldCoins(d+a.amount)},Z=function(){var a=h.getPlayer();a.getSelectedCharacter().hasChapel(!1)},$=function(a){var c,d=h.getPlayer(),e=d.getSelectedCharacter(),f=n(a),g=h.getGameData(),i=e.getSelectedVillage();e.setSelectedVillage(f),i&&i.getId()===f.getId()||b.$broadcast(r.VILLAGE_SELECTED_CHANGED,{id:f.getId()}),j.setItem("lastSelectedVillageId",f.getId()),delete a.buildings.fortress,c=o(a.buildings),f.setBuildingData(c),g.setUnitStatus(c)},_=function(a){var b,c,d=h.getPlayer(),e=d.getSelectedCharacter(),f=e.getSelectedVillage(),g=f.getBuildingData(),i=[];if(!f||f.getId()===a.village_id)for(b=f.getBuildingQueue(),b?(b.setUnlockedSlots(a.unlocked_slots),a.queue.forEach(function(a){var c=b.getJobById(a.id);return c?(c.time_started=a.time_started,c.time_completed=a.time_completed,void(c.level=a.level)):(-1===i.indexOf(a.id)&&(b.addJob(a),i.push(a.id)),void("chapel"===a.building&&e.setChapelInQueue(!0)))})):f.setBuildingQueue(p(a)),g.resetUpgrading(),c=0;c<a.queue.length;c++)g.setUpgrading(a.queue[c].building,a.queue[c].level)},aa=function(a){var b=h.getPlayer(),c=b.getSelectedCharacter().getSelectedVillage(),d=c.getBuildingData(),e=c.getTimeline();"chapel"===a.building&&b.getSelectedCharacter().hasChapel(!0),a.village_id===c.getId()&&(d.setUpgrading(a.job.building,a.job.level),e.insert({type:"build",building_type:a.job.building,id:a.job.id,time:a.job.time_completed}))},ba=function(a){var b,c=h.getPlayer();b={character_id:a.id,character_name:a.name,world_id:a.world_id},c.addCharacter(l(b))},ca=function(a){h.setWorldConfig(t(a))},da=function(a){window.injector.get("socketService").emit(s.GET_CHARACTER_VILLAGES,{},function(c){var d=c.villages.filter(function(b){return b.id===a});d.length&&(d=d[0],f.loadTownDataAsync(d.x,d.y,1,1,function(){g.trigger(g.types.MAPDATA_UPDATE,null),b.$broadcast(r.VILLAGE_CONQUERED,d.name)},!0))}),window.injector.get("socketService").emit(s.CHAR_GET_INFO,{})},ea=function(a){var c=h.getSelectedCharacter(),d=c.getVillage(a),e=h.getSelectedVillage(),i=d.getX(),j=d.getY(),k=!1;a===e.getId()&&(e.data.villageId=null,k=!0),k&&(h.getSelectedCharacter().getVillages().length?b.$broadcast(r.VILLAGE_SWITCH,1,!0):(window.injector.get("windowManagerService").closeAll(),b.$broadcast(r.MAP_ZOOM_OUT_OF_VILLAGE))),c.removeVillage(a),f.loadTownDataAsync(i,j,1,1,function(){g.trigger(g.types.MAPDATA_UPDATE,null),b.$broadcast(r.VILLAGE_LOST,d.getName())},!0)},fa=function(a){var c=h.getSelectedCharacter(),d=h.getGroupList();a.characterId===c.getId()?(d.mirrorSystemGroupsOnConquer(a.villageId),da(a.villageId)):c.getVillage(a.villageId)&&(d.mirrorSystemGroupsOnConquer(a.villageId,!0),ea(a.villageId)),b.$broadcast(r.GROUPS_VILLAGES_CHANGED)},ga=function(a){var b,c=h.getSelectedVillage(),d={};c&&c.getId()===a.villageId&&((b=c.getBuildingQueue())&&b.setUnlockedSlots(a.building_queue_slots),d.resources=a.resources,d.productionRates=a.production_rates,d.lastUpdate=a.res_last_update,d.baseStorage=a.base_storage,c.setLoyalty(a.loyalty),c.getResources().setData(d),M.updateMaxStorage())},ha=function(a){var b=h.getSelectedVillage(),c={};b&&(c.wood=a.timber_camp.current_level.current_production,c.clay=a.clay_pit.current_level.current_production,c.iron=a.iron_mine.current_level.current_production,b.getResources().setProductionRates(c))},ia=function(a){var c,d,e=h.getPlayer(),f=e.getSelectedCharacter().getSelectedVillage(),g=h.getGameData();if(f&&f.getId()===a.village_id&&(c=f.getBuildingData(),c&&(d=c.getDataForBuilding(a.building_type),d&&d.researches[a.research_type]))){if(d.researches[a.research_type].researched=!0,d.researches[a.research_type].unlocked=!0,"barracks"===a.building_type){if(!g)return;g.setUnitStatus(c)}b.$broadcast(r.RESEARCH_RESEARCHED,{building:a.building_type})}},ja=function(a){var b,c,d,e,f,g,i,j=h.getPlayer(),k=j.getSelectedCharacter().getSelectedVillage(),l=h.getGameData();if(null!==k&&(b=k.getBuildingData(),"chapel"===a.building&&(a.level>0?(j.getSelectedCharacter().hasChapel(!0),j.getSelectedCharacter().setChapelInQueue(!1)):j.getSelectedCharacter().hasChapel(!1)),(!k||k.getId()===a.village_id)&&(b.setLevelForBuilding(a.building,a.level),l.setUnitStatus(b),d=k.getBuildingQueue()))){for(e=d.getQueue(),g=e.length,i=0;g>i;i++)if(f=e[i],f.building===a.building&&f.level===a.level){e.remove(i);break}c=b.getDataForBuilding(a.building).researches;for(i in c)c[i].required_level===a.level&&ia({village_id:a.village_id,bulding_type:a.building,research_type:i})}},ka=function(a){var b=h.getPlayer(),c=b.getSelectedCharacter(),d=c.getSelectedVillage();d&&d.getId()===a.village_id&&d.setOrUpdateAcademyJobs(a.jobs)},la=function(a){var b=h.getPlayer(),c=b.getSelectedCharacter(),d=c.getSelectedVillage();d&&d.addAcademyJob(a)},ma=function(a){var b=h.getPlayer(),c=b.getSelectedCharacter(),d=c.getSelectedVillage();d&&a.village_id===d.getId()&&(d.setRecruitingQueues(a.queues),d.setUnitInfo(a),c.setTotalNobles({active:a.available_units.snob.total}))},na=function(a){var b=h.getPlayer(),c=b.getSelectedCharacter(),d=c.getSelectedVillage(),e=d.getTimeline(),f=d.getBuildingQueue();"chapel"===a.job.building&&1===a.job.level&&(c.hasChapel(!1),c.setChapelInQueue(!1)),f.removeJob(a.job.id),e.removeEvent(a.job.id)},oa=function(a){var b=h.getSelectedVillage(),c=h.getWorldConfig();c.setNightModeEvents(a.events.filter(function(a){return 0===a.type.indexOf("night_")})),b.setTimeline(q(a))},pa=function(a){var b=h.getSelectedVillage();b.getId()===a.village_id&&b.setName(a.name),h.getSelectedCharacter().getVillage(a.village_id).setName(a.name),f.setTownName(a.village_id,a.name),window.setTimeout(function(){window.twx.game.map.forceRedraw(!0)},0)},qa=function(a){var b=h.getSelectedVillage();b&&b.getId()===a.village_id&&window.injector.get("socketService").emit(s.VILLAGE_UNIT_INFO,{village_id:a.village_id})},ra=function(c){var d,e,f,g,h=[r.VILLAGE,r.VILLAGE_UNIT_INFO,r.TIMELINE_EVENTS,r.COMMAND_OWN_COMMANDS,r.SCOUTING_INFO,r.BUILDING_QUEUE,r.TRADING_TRANSPORT_INDEX,r.ACADEMY_INFO];for(d in c)for(e=c[d],g=0;g<h.length;g++)f=h[g],a.isFunction(N[f])&&(N[f](e[f]),b.$broadcast(f,e[f]));b.$$phase||b.$apply(),M.updateMaxStorage()},sa=function(a){var b=h.getSelectedVillage();b.getId()===a.village_id&&b.setSelectedOrder(a.order)},ta=function(a){var b=h.getSelectedCharacter().getCurrentConversation();b&&b.id===a.message_id&&b.addMessage(a)},ua=function(a){var b=h.getSelectedCharacter().getCurrentConversation();a.participants=a.participants.map(e.participant),b&&b.id===a.message_id?b.id===a.message_id&&b.addOlderPosts(a):h.getSelectedCharacter().setCurrentConversation(u(a))},va=function(a){var b,c=h.getSelectedCharacter().getCurrentConversation(),d=[];if(c&&c.id===a.message_id){for(b=0;b<a.added_participants.length;b++)d.push(e.participant(a.added_participants[b]));c.addParticipants(d)}},wa=function(a){var b=h.getSelectedCharacter().getCurrentConversation();b&&b.id===a.message_id&&b.removeParticipant({id:a.character_id,type:"character"})},xa=function(a){var b=h.getSelectedCharacter().getCurrentConversation();b&&b.id===a.message_id&&(b.status="left")},ya=function(a){h.getPlayer().setPremium(a.premium)},za=function(a){h.getSelectedCharacter().setFriendList(m(a.friends.map(e.friend).reduce(function(a,b){return b.isCharacter()?a.character.push(b):b.isTribe()&&a.tribe.push(b),a},{character:[],tribe:[]})))},Aa=function(a){h.getSelectedCharacter().getFriendList().add(e.friend(a))},Ba=function(a){h.getSelectedCharacter().getFriendList().remove(a)},Ca=function(a){c.HOST=a.host,(c.MAINTENANCE=a.maintenance)&&E.getFramedModal("maintenance"),window.injector.get("socketService").emit(s.SYSTEM_IDENTIFY,{platform:"browser",device:encodeURI(window.navigator.userAgent),api_version:d.api.toString()})},Da=function(a){h.getAchievementList().setBalancingData(a)},Ea=function(a){h.getAchievementList().updateAchievement(a)},Fa=function(a){h.getAchievementList().addProgressData(a)},Ga=function(a){var b=h.getSelectedCharacter();b.setGlobalInfo(v(a))},Ha=function(a){var b=h.getGroupList();b.setGroups(a.groups)},Ia=function(a){var b=h.getGroupList();b.addGroup(a)},Ja=function(a){var c=h.getGroupList();c.changeGroup(a),b.$broadcast(r.GROUPS_VILLAGES_CHANGED)},Ka=function(a){var c=h.getGroupList();c.removeGroup(a.id),b.$broadcast(r.GROUPS_VILLAGES_CHANGED)},La=function(a){var b=h.getGroupList();b.setVillageGroups(a)},Ma=function(a){var c=h.getGroupList();c.attachVillageGroup(a.group_id,a.village_id),b.$broadcast(r.GROUPS_VILLAGES_CHANGED)},Na=function(a){var c=h.getGroupList();a.diff>0?c.attachVillageGroup(a.icon,a.village_id,{diff:a.diff}):a.diff<0&&c.detachVillageGroup(a.icon,a.village_id,{diff:a.diff}),b.$broadcast(r.GROUPS_VILLAGES_CHANGED)},Oa=function(a){var c=h.getGroupList();c.detachVillageGroup(a.group_id,a.village_id),b.$broadcast(r.GROUPS_VILLAGES_CHANGED)},Pa=function(a){var b="second_village",c=h.getSelectedVillage().getTimeline();c.insert({id:a.job_id||a.id,type:b,time:a.time_completed,details:!0})},Qa=function(a){var c=F.getJobInProgress(a.jobs),d=new i(a),e=h.getSelectedCharacter();e.setSecondVillage(d),c&&b.$on(r.VILLAGE_LOADED,function(){Pa(a.jobs[c])})};return N[r.LOGIN_SUCCESS]=P,N[r.MESSAGE_WELCOME]=Ca,N[r.CHARACTER_INFO]=X,N[r.BUILDING_QUEUE]=_,N[r.BUILDING_LEVEL_CHANGED]=ja,N[r.BUILDING_CHAPEL_DESTROYED]=Z,N[r.BUILD_JOB_CANCELLED]=na,N[r.BUILDING_UPGRADING]=aa,N[r.CHARACTER_CREATED]=ba,N[r.WORLD_CONFIG]=ca,N[r.WORLD_CONFIG_UPDATE]=ca,N[r.GAME_DATA_BUILDINGS]=Q,N[r.GAME_DATA_COSTS_PER_COIN]=T,N[r.GAME_DATA_UNITS]=U,N[r.GAME_DATA_BASE_DATA]=S,N[r.GAME_DATA_PREMIUM_COSTS]=V,N[r.ACHIEVEMENTS_ALL]=Da,N[r.GAME_DATA_OFFICERS]=R,N[r.ACHIEVEMENTS_ACHIEVED]=Fa,N[r.ACHIEVEMENT_PROGRESS]=Ea,N[r.VILLAGE]=$,N[r.VILLAGE_RESOURCES_CHANGED]=ga,N[r.VILLAGE_RESOURCE_INFO]=ha,N[r.VILLAGE_UNIT_INFO]=ma,N[r.VILLAGE_OWNER_CHANGED]=fa,N[r.VILLAGE_NAME_CHANGED]=pa,N[r.VILLAGE_ARMY_CHANGED]=qa,N[r.VILLAGE_BATCH_VILLAGE_DATA]=ra,N[r.HOSPITAL_PATIENT_RELEASED]=qa,N[r.RESEARCH_UNLOCKED]=ia,N[r.ACADEMY_INFO]=W,N[r.ACADEMY_TRAINING]=ka,N[r.ACADEMY_TRAINING_NOBLE]=la,N[r.ACADEMY_MINTED_COINS]=Y,N[r.TIMELINE_EVENTS]=oa,N[r.PRECEPTORY_ORDER_SELECTED]=sa,N[r.MESSAGE_SENT]=ta,N[r.MESSAGE_NEW]=ta,N[r.MESSAGE_VIEW]=ua,N[r.MESSAGE_PARTICIPATNS_ADDED]=va,N[r.MESSAGE_CHAR_KICKED]=wa,N[r.MESSAGE_CHAR_LEFT]=xa,N[r.FRIENDLIST]=za,N[r.FRIEND_ADDED]=Aa,N[r.FRIEND_REMOVED]=Ba,N[r.PREMIUM_CHANGED]=ya,N[r.GLOBAL_INFORMATION]=Ga,N[r.GROUPS_INDEX]=Ha,N[r.GROUPS_CREATED]=Ia,N[r.GROUPS_UPDATED]=Ja,N[r.GROUPS_DESTROYED]=Ka,N[r.GROUPS_VILLAGES]=La,N[r.GROUPS_VILLAGE_LINKED]=Ma,N[r.GROUPS_VILLAGE_LINKED_SYSTEM]=Na,N[r.GROUPS_VILLAGE_UNLINKED]=Oa,N[r.SECOND_VILLAGE_JOB_STARTED]=Pa,N[r.SECOND_VILLAGE_INFO]=Qa,O(x),O(y),O(B),O(C),O(D),O(G),O(z),O(A),O(H),O(J),O(K),O(L),{handle:function(a){N[a.type]&&N[a.type](a.data)}}}])}),define("services/DataDependencyResolverService",["app"],function(a){a.factory("dataDependencyResolverService",["$rootScope","eventTypeProvider","routeProvider","modelDataService",function(a,b,c,d){var e={},f=function(){var e=d.getSelectedVillage();e&&a.$broadcast(b.SOCKET_EMIT,c.VILLAGE_GET_BUILDING_QUEUE,{village_id:e.getId()})},g=function(){a.$broadcast(b.SOCKET_EMIT,c.GET_CHARACTER_VILLAGES)},h=function(){var e=d.getSelectedVillage();e&&a.$broadcast(b.SOCKET_EMIT,c.VILLAGE_UNIT_INFO,{village_id:e.getId()})},i=function(a){f(),"barracks"===a.building&&h()},j=function(a){"barracks"===a.building&&h(),f()},k=function(a){"wall"===a.building&&f()},l=function(){a.$broadcast(b.SOCKET_EMIT,c.TRIBE_RELATION_GET_LIST,{})};return e[b.BUILDING_UPGRADING]=i,e[b.BUILDING_LEVEL_CHANGED]=j,e[b.RESEARCH_RESEARCHED]=k,e[b.ACADEMY_MINED_COINS]=g,e[b.VILLAGE_CONQUERED]=g,e[b.UNIT_RECRUIT_JOB_FINISHED]=h,e[b.TRIBE_INVITATION_ACCEPTED]=l,e[b.COMMAND_SENT]=h,e[b.COMMAND_RETURNED]=h,e[b.COMMAND_WITHDRAWING_SUPPORT]=h,e[b.REPORT_NEW]=h,{handle:function(a){e[a.type]&&e[a.type](a.data)}}}])}),define("models/JobTimingModel",["models/GenericJobModel","helper/time"],function(a,b){var c=function(a,c){this.parent=a,this.onJobCompleted=c,this.startedAt=b.server2ClientTime(a.time_completed-a.duration),this.completedAt=b.server2ClientTime(a.time_completed),this.duration=this.completedAt-this.startedAt};return c.inherits(a),c.prototype.percent=function(a){var b=a||Date.now(),c=Math.round(100*(1-(this.completedAt-b)/this.duration)).bound(0,100);return this.eta=(this.completedAt-b)/1e3,100===c&&this.onJobCompleted(this.parent),c},c}),define("conf/resourceDepositJobStates",[],function(){return{READY:2,RUNNING:0,COMPLETED:1}}),define("conf/resourceDepositRewardTypes",[],function(){return{RESOURCES:"resources",UNITS:"units",OFFICER:"officer",BOOSTER:"booster",REROLL:"reroll"}}),define("models/ResourceDepositModel",["models/JobTimingModel","conf/resourceDepositJobStates","conf/resourceDepositRewardTypes"],function(a,b,c){var d={reward_resources:c.RESOURCES,reward_units:c.UNITS,premium_officer_leader:c.OFFICER,premium_officer_loot_master:c.OFFICER,premium_officer_medic:c.OFFICER,premium_officer_bastard:c.OFFICER,premium_officer_supporter:c.OFFICER,premium_officer_scout:c.OFFICER,premium_boost_wood:c.BOOSTER,premium_boost_clay:c.BOOSTER,premium_boost_iron:c.BOOSTER,premium_build_cost_reduction:"buildCostReduction",resource_deposit_reroll:c.REROLL,effect:"effect"},e={REGULAR:0,EPIC:1,LEGENDARY:2},f=function(a){return a.state===b.RUNNING},g=function(a){return a.state===b.COMPLETED},h=function(a){return a.state===b.READY},i=function(a){return a.quality===e.LEGENDARY&&a.state===b.READY},j=function(a){this.jobData=[],this.resourcesLeft=a.resources_left||0,this.milestones=[],this.x=a.x,this.y=a.y};return j.prototype.updateJobData=function(c,d,e){var f,g,h,i,j,k,l,m,n;if(j=c.jobs||c,j&&!j.length){for(h=Object.keys(j),k=[],l=0;l<h.length;l++)k.push(j[h[l]]);j=k}for(e&&(this.jobData=[]),n=j.length;n--;){for(i=j[n],h=Object.keys(i),i.state=b.READY,i.isNew=!0,l=0;l<this.jobData.length;l++)if(f=this.jobData[l],f.id===i.id){for(m=0;m<h.length;m++)g=h[m],f[g]=i[g];i=f,i.isNew=!1;break}i.isNew&&this.jobData.push(i),i.isNew=!1,i.time_completed&&(i.model=new a(i,d),i.state=i.model.completedAt>Date.now()?b.RUNNING:b.COMPLETED)}return this.jobData},j.prototype.getJobs=function(){return this.jobData},j.prototype.getCurrentJob=function(){var a=this.getJobs().filter(f);return a.length>0?a[0]:void 0},j.prototype.getCollectibleJobs=function(){var a=this.getJobs().filter(g);return a.length>0?a:void 0},j.prototype.getReadyJobs=function(){var a=this.getJobs().filter(h);return a.length>0?a:void 0},j.prototype.hasLegendaryJob=function(){var a=this.getJobs().filter(i);return a.length>0},j.prototype.jobCompleted=function(a){a.state=b.COMPLETED},j.prototype.getResourcesLeft=function(){return this.resourcesLeft||0},j.prototype.getMilestones=function(){return this.milestones},j.prototype.updateMilestones=function(a,b){var c,e;for(this.milestones=[],e=0;e<a.length;e+=1)c=a[e],c.reward.item_type&&(c.reward=b[d[c.reward.item_type]](c.reward),this.milestones.push({i18n:c.reward.i18n,target:c.goal,type:c.reward.type,icon:c.reward.icon,amount:c.reward.amount,animation:c.reward.animation,animationTarget:c.reward.animationTarget,achieved:c.reached,width:100/a.length,ignore:e>0?!a[e-1].reached:!1}));return this.milestones},j.prototype.removeJob=function(a){var b,c;for(c=0;c<this.jobData.length;c++)if(b=this.jobData[c],b.id===a)return this.jobData.splice(c,1)[0]},j.prototype.isAvailable=function(){return null!==this.x&&null!==this.y},j}),define("models/CharacterModel",["helper/time","models/ResourceDepositModel"],function(a,b){var c=function(a){this.data=a};return c.prototype.getId=function(){return this.data.character_id},c.prototype.getName=function(){return this.data.character_name},c.prototype.getOwnerId=function(){return this.data.character_owner_id},c.prototype.getOwnerName=function(){return this.data.character_owner_name},c.prototype.getWorldId=function(){return this.data.world_id},c.prototype.getTotalNobles=function(){return this.data.total_nobles},c.prototype.setTotalNobles=function(a){this.data.total_nobles=this.data.total_nobles||{},void 0!==a.active&&(this.data.total_nobles.active=a.active),void 0!==a.training&&(this.data.total_nobles.training=a.training),this.data.total_nobles.all=~~this.data.total_nobles.active+~~this.data.total_nobles.training},c.prototype.getGoldCoins=function(){return this.data.gold_coins},c.prototype.setGoldCoins=function(a){this.data.gold_coins=a},c.prototype.setTribeRelations=function(a){this.data.tribeRelationsModel=a},c.prototype.getTribeRelations=function(){return this.data.tribeRelationsModel||null},c.prototype.isInTutorial=function(){return 1===this.data.tutorialStatus?!0:2===this.data.tutorialStatus?!1:void 0},c.prototype.setTutorialStatus=function(a){this.data.tutorialStatus=a},c.prototype.getSecondVillageStatus=function(){return this.data.secondVillageStatus},c.prototype.setSecondVillageStatus=function(a){this.data.secondVillageStatus=a},c.prototype.getAmountLogins=function(){return this.data.amountLogins},c.prototype.setAmountLogins=function(a){this.data.amountLogins=a},c.prototype.getTribeId=function(){return this.data.tribeId||null},c.prototype.setTribeId=function(a){this.data.tribeId=a},c.prototype.getProperty=function(a){return this.data[a]||null},c.prototype.setProperty=function(a,b){this.data[a]=b},c.prototype.getTribeRights=function(){return this.data.tribeRights||null},c.prototype.setTribeRights=function(a){var b,c;if(this.data.tribeRights)for(c in this.data.tribeRights)delete this.data.tribeRights[c];else this.data.tribeRights={};for(b=0;b<a.length;b++)c=a[b].toUpperCase(),this.data.tribeRights[c]=c},c.prototype.getRank=function(){return this.data.rank||null},c.prototype.setRank=function(a){this.data.rank=a},c.prototype.getPoints=function(){return this.data.points||null},c.prototype.setPoints=function(a){this.data.points=a},c.prototype.hasChapel=function(a){return void 0===a?this.data.hasChapel||!1:void(this.data.hasChapel=!!a)},c.prototype.hasChapelInQueue=function(){return this.data.chapelInQueue||!1},c.prototype.setChapelInQueue=function(a){this.data.chapelInQueue=!!a},c.prototype.setPresets=function(a){var b=this;this.data.presets?a.forEach(function(a){for(var c=b.data.presets.length;c--;)if(b.data.presets[c].id===a.id)return b.data.presets[c].name=a.name,b.data.presets[c].icon=a.icon,b.data.presets[c].units=a.units,void(b.data.presets[c].officers=a.officers);b.data.presets.push(a)}):this.data.presets=a},c.prototype.deletePreset=function(a){for(var b=this.data.presets.length;b--;)if(this.data.presets[b].id===a)return this.data.presets.remove(b),!0;return!1},c.prototype.getPresets=function(){return this.data.presets},c.prototype.getPreset=function(a){for(var b=this.data.presets.length;b--;)if(this.data.presets[b].id===a)return this.data.presets[b];return!1},c.prototype.setSelectedVillage=function(a){for(var b=this.data.villages.length,c=!1;b--;)if(this.data.villages[b].getId()===a.getId()){this.data.villages[b]=a,c=!0;break}c||this.data.villages.push(a),this.data.selectedVillage=a},c.prototype.getSelectedVillage=function(){return this.data.selectedVillage||null},c.prototype.hasVillages=function(){var a=this.getVillages();return null!==a&&a.length},c.prototype.getFirstVillage=function(){var a=this.getVillages();return a&&a.length?a[0]:null},c.prototype.getVillages=function(){return this.data.villages||null},c.prototype.addVillage=function(a){this.data.villages.push(a)},c.prototype.removeVillage=function(a){var b=this.data.villages.length;for(this.data.selectedVillage&&this.data.selectedVillage.getId()===a&&(this.data.selectedVillage=null);b--;)if(a===this.data.villages[b].getId())return this.data.villages.remove(b),!0;return!1},c.prototype.getVillage=function(a){for(var b=this.data.villages.length;b--;)if(a===this.data.villages[b].getId())return this.data.villages[b];return null},c.prototype.setVillages=function(a){this.data.villages=a},c.prototype.setCurrentConversation=function(a){this.data.conversationModel=a},c.prototype.getCurrentConversation=function(){return this.data.conversationModel||null},c.prototype.getFriendList=function(){return this.data.friendListModel},c.prototype.setFriendList=function(a){this.data.friendListModel=a},c.prototype.setInventory=function(a){this.data.inventoryModel=a},c.prototype.getInventory=function(){return this.data.inventoryModel||null},c.prototype.setQuestLineListModel=function(a){this.data.questLineListModel=a},c.prototype.getQuestLineListModel=function(){return this.data.questLineListModel||null},c.prototype.getGlobalInfo=function(){return this.data.globalInfo},c.prototype.setGlobalInfo=function(a){this.data.globalInfo=a},c.prototype.getLastRestartTime=function(){return this.data.lasteRestartTime},c.prototype.setLastRestartTime=function(b){this.data.lasteRestartTime=a.server2ClientTime(b)},c.prototype.setValidatedEmail=function(a){this.data.validatedEmail=a},c.prototype.hasValidatedEmail=function(a){return this.data.validatedEmail},c.prototype.getInviteInfo=function(){return this.data.inviteInfo},c.prototype.setCoopStatus=function(a){this.data.isInCoopMode=a},c.prototype.isInCoopMode=function(){return this.data.isInCoopMode},c.prototype.setInviteInfo=function(a,b,c){var d=this.data.inviteInfo;d||(d=this.data.inviteInfo={}),b&&(d.rewards=b),c&&(d.pointsNeeded=c),d.position=a},c.prototype.getEffectList=function(){return this.data.effectList},c.prototype.setEffectList=function(a){this.data.effectList=a},c.prototype.setResourceDeposit=function(a){if(!(a instanceof b))throw new TypeError;this.data.resourceDepositModel=a},c.prototype.getResourceDeposit=function(){return this.data.resourceDepositModel||null},c.prototype.setSmartTips=function(a){this.data.smartTips=a},c.prototype.getSmartTips=function(){return this.data.smartTips},c.prototype.setSecondVillage=function(a){this.data.secondVillage=a},c.prototype.getSecondVillage=function(){return this.data.secondVillage},c.prototype.setTribeInvitations=function(a){this.data.tribeInvitations=a},c.prototype.getTribeInvitations=function(){return this.data.tribeInvitations},c}),define("models/PlayerModel",["models/CharacterModel"],function(a){var b=function(a,b){this.data=a,this.data.characters=b||null};return b.prototype.getCharacters=function(){return this.data.characters||null},b.prototype.addCharacter=function(b){if(!(b instanceof a))throw new TypeError("characterModel must be an instance of CharacterModel!");this.data.characters||(this.data.characters={}),this.data.characters[b.getId()]=b},b.prototype.getCharacter=function(a,b){return this.data.characters&&this.data.characters[a+"_"+b]||null},b.prototype.getFirstCharacter=function(){var a,b=this.getCharacters();if(!b)return null;for(a in b)if(b.hasOwnProperty(a))return b[a];return null},b.prototype.getCharacterCount=function(){var a,b=this.getCharacters(),c=0;if(!b)return 0;for(a in this.data.characters)this.data.characters.hasOwnProperty(a)&&c++;return c},b.prototype.getSelectedCharacter=function(){return this.data.selectedCharacter||null},b.prototype.setSelectedCharacter=function(b){if(!(b instanceof a))throw new TypeError("characterModel must be an instance of CharacterModel!");this.data.selectedCharacter=b},b.prototype.getNewReportsCount=function(){return this.data.newReportsCount||0},b.prototype.setNewReportsCount=function(a){this.data.newReportsCount=a},b.prototype.getId=function(){return this.data.player_id},b.prototype.getPremium=function(){return this.data.premium},b.prototype.setPremium=function(a){this.data.premium=a},b.prototype.getWorlds=function(){return this.data.worlds},b}),define("models/GameDataModel",["angular","helper/time"],function(a,b){var c=function(a){this.inventoryItemTypeProvider=a,this.data={},this.data.newReports={},this.data.newMessages={},this.data.newThreads={},this.data.maxUnitAttributes={attack:0,def_inf:0,def_kav:0,def_arc:0,load:0,speed:1/0}},d=function(a,b){var c,d=b.finishedIn,e=a.time_range,f=a.crown_range,g=0,h=a.time_range.length-1;if(d=0|d,!d)return 0;if(d<=a.time_fixed_price[0])return a.crowns_fixed_price[0];for(c=1;c<e.length;c++)if(d<=e[c]){h=c;break}return g=Math.ceil((d+1-e[h-1])*(f[h]-f[h-1])/(e[h]-e[h-1]))+f[h-1]-1};return c.prototype.setBaseData=function(a){return this.data.baseData=a},c.prototype.getBaseData=function(){return this.data.baseData||null},c.prototype.getResearchesData=function(){return this.data.researchesModel||null},c.prototype.setResearchesData=function(a){this.data.researchesModel=a},c.prototype.getInstantTradeRatio=function(){var a=this.getBaseData();return a?a.instant_trade_ratio:0},c.prototype.getHospitalHealingDuration=function(){var a=this.getBaseData();return a?a.hospital_healing_duration:0},c.prototype.getBaseResourceProduction=function(){return this.data.baseData.resource_production},c.prototype.getBaseStorageCapacity=function(){return this.data.baseData.storage_capacity},c.prototype.getBasePopulationLimit=function(){return this.data.baseData.population_limit},c.prototype.setCostsPerCoin=function(a){this.data.costPerCoin=a},c.prototype.getCostsPerCoin=function(){return this.data.costPerCoin},c.prototype.setPremiumCosts=function(a){this.data.premiumCosts=a},c.prototype.getPremiumCosts=function(){return this.data.premiumCosts},c.prototype.getPremiumCostsForType=function(a){return this.data.premiumCosts[a]||null},c.prototype.getOrderResetResourceCost=function(){return this.getBaseData().reset_order_resources},c.prototype.setOrderResetResourceCost=function(a){this.getBaseData().reset_order_resources=a},c.prototype.getPaladinWeaponPremiumCosts=function(a,b){var c=this.getPremiumCostsForType(this.inventoryItemTypeProvider.PALADIN_WEAPON);return c&&c[a]?c[a][b]:null},c.prototype.getInstantBuildPremiumCosts=function(a){return d(this.getPremiumCostsForType(this.inventoryItemTypeProvider.INSTANT_BUILD),a)},c.prototype.getInstantRecruitPremiumCosts=function(a){return"statue"===a.type?this.getPaladinInstantRecruitPremiumCosts():(a.finishedIn=a.finishedIn||(a.eta<a.duration/1e3?a.eta:a.duration/1e3),d(this.getPremiumCostsForType(this.inventoryItemTypeProvider.INSTANT_RECRUIT),a))},c.prototype.getSecondQueueJobPremiumCosts=function(){return this.getPremiumCostsForType(this.inventoryItemTypeProvider.SECOND_QUEUE_JOB)},c.prototype.getPaladinInstantRecruitPremiumCosts=function(){return this.getPremiumCostsForType("premium_paladin_instant")},c.prototype.getNewReportCount=function(a){var b,c=Object.keys(this.data.newReports),d=0;if(!a)return c.length;for(b in c)c.hasOwnProperty(b)&&(d+=-1!==a.indexOf(this.data.newReports[c[b]].type)?1:0);return d},c.prototype.getNoblemanEffect=function(){return{min:this.data.baseData.nobleman_effect_min,max:this.data.baseData.nobleman_effect_max}},c.prototype.addNewReport=function(a){this.data.newReports[a.id]={value:!0,type:a.type}},c.prototype.removeNewReport=function(a){this.data.newReports[a]&&delete this.data.newReports[a]},c.prototype.getNewReportList=function(){return this.data.newReports},c.prototype.addNewMessage=function(a){this.data.newMessages[a]=!0},c.prototype.removeNewMessage=function(a){this.data.newMessages[a]&&delete this.data.newMessages[a]},c.prototype.getNewMessageCount=function(){return Object.keys(this.data.newMessages).length},c.prototype.addNewThread=function(a){this.data.newThreads[a]=!0},c.prototype.removeNewThread=function(a){this.data.newThreads[a]&&delete this.data.newThreads[a]},c.prototype.getNewThreadCount=function(){return Object.keys(this.data.newThreads).length},c.prototype.setBuildings=function(a){this.data.buildings=a},c.prototype.getBuildings=function(){return this.data.buildings||null},c.prototype.getBuildingTypes=function(){var a,b=Object.keys(this.getBuildings()),c={};for(a=0;a<b.length;a++)c[b[a].toUpperCase()]=b[a];return c},c.prototype.getAttackableBuildings=function(){var b=a.copy(this.getBuildings());return delete b.chapel,delete b.hospital,b},c.prototype.getBuildingDataForBuilding=function(a){var b=this.getBuildings();return b?b[a]||null:null},c.prototype.getUnits=function(){return this.data.units||null},c.prototype.getUnitsObject=function(){if(this.data.unitsObject)return this.data.unitsObject;var a,b,c=this.getUnits(),d={};if(!c)return null;for(a=0;a<c.length;a++)b=c[a],d[b.name]=b;return this.data.unitsObject=d},c.prototype.setUnits=function(a){var b,c,d,e=[];for(c in a)if(a.hasOwnProperty(c)){e.push(a[c]);for(d in this.data.maxUnitAttributes)b="speed"===d?Math.min:Math.max,this.data.maxUnitAttributes[d]=b(a[c][d],this.data.maxUnitAttributes[d])}e.sort(function(a,b){return a.name<b.name?-1:1}),this.data.units=e},c.prototype.getMaxUnitAttributes=function(){return this.data.maxUnitAttributes},c.prototype.setUnitStatus=function(a){var b,c,d,e,f=this.getUnits();if(!f)throw new Error("Could not load units!");for(b=f.length,c=null,e=0;b>e;e++)d=f[e],c=a.getDataForBuilding(d.building),f[e].available=c.level>=f[e].required_level},c.prototype.getUnit=function(a){var b,c=this.getUnits(),d=c.length;for(b=0;d>b;b++)if(a===c[b].name)return c[b];return null},c.prototype.getUnitDataFor=function(a){var b,c=this.getUnits(),d=c.length,e=[];for(b=0;d>b;b++)-1!==a.indexOf(c[b].name)&&e.push(c[b]);return e},c.prototype.getLootProtectionFactor=function(){return 100*this.data.baseData.loot_protection_value},c.prototype.getLootProtectionDuration=function(){return this.data.baseData.loot_protection_duration/b.inS.day},c.prototype.getOrderedUnitNames=function(){return["spear","sword","axe","archer","light_cavalry","mounted_archer","heavy_cavalry","ram","catapult","doppelsoldner","trebuchet","snob","knight"]},c.prototype.getTypedUnitNames=function(){return{offensive:this.getOffensiveUnitNames(),defensive:this.getDefensiveUnitNames(),special:this.getSpecialUnitNames()}},c.prototype.getDefensiveUnitNames=function(){return["spear","sword","archer","heavy_cavalry"]},c.prototype.getDefensiveUnits=function(){return this.getUnitDataFor(this.getDefensiveUnitNames())},c.prototype.getOffensiveUnitNames=function(){return["axe","light_cavalry","mounted_archer","ram","catapult"]},c.prototype.getOffensiveUnits=function(){return this.getUnitDataFor(this.getOffensiveUnitNames())},c.prototype.getSpecialUnitNames=function(){return["snob","knight","doppelsoldner","trebuchet"]},c.prototype.getOrderTypes=function(){return{templar:"knight_templars",teutonic:"teutonic_knights",thieves:"thieves"}},c.prototype.getSpecialUnits=function(){return this.getUnitDataFor(this.getSpecialUnitNames())},c.prototype.getOfficers=function(){return["leader","loot_master","medic","bastard","scout","supporter"]},c.prototype.getResourceNames=function(){return["wood","clay","iron","food"]},c.prototype.getResourceTypes=function(){return{WOOD:"wood",CLAY:"clay",IRON:"iron",FOOD:"food"}},c.prototype.setAchievements=function(a){this.data.achievements=a},c.prototype.getAchievements=function(){return this.data.achievements||null;

},c.prototype.getCounterMeasureNames=function(){return["camouflage","dummies","exchange","switch_weapons"]},c.prototype.getTribeRights=function(){return{DIPLOMACY:"DIPLOMACY",FORUM:"FORUM",MEMBERS:"MEMBERS",PROFILE:"PROFILE",RECRUIT:"RECRUIT",SETTINGS:"SETTINGS",SKILLS:"SKILLS"}},c.prototype.getLuckRange=function(){return[this.data.baseData.luck_min,this.data.baseData.luck_max]},c}),define("conf/questTrees",[],function(){return{QUEST_TREE_NAME_DEFAULT:"default",QUEST_TREE_NAME_TREE_1:"tree_1"}}),define("models/WorldConfigModel",["helper/time","conf/questTrees"],function(a,b){var c="spy_costs_",d=function(a){this.data=a;try{this.getSpyCosts(1).time*=60,this.getSpyCosts(2).time*=60,this.getSpyCosts(3).time*=60,this.getSpyCosts(4).time*=60,this.getSpyCosts(5).time*=60}catch(b){}};return d.prototype.isBathHouseEnabled=function(){return this.data.bathhouse},d.prototype.getAttackProtectionDuration=function(){return this.data.noob_protection_days*a.inMS.day},d.prototype.getChurchBonus=function(){return this.data.church_bonus},d.prototype.isCooperativeModeActive=function(){return this.data.coop},d.prototype.getDefenderSuperior=function(){return this.data.defender_superior},d.prototype.getDoppelSoldnerBonus=function(){return this.data.doppelsoldner_bonus},d.prototype.getFarmRule=function(){return parseInt(this.data.farm_rule,10)},d.prototype.getLoyaltyAfterConquer=function(){return this.data.loyalty_after_conquer},d.prototype.getMoraleDays=function(){return this.data.morale_days},d.prototype.getMoraleEnd=function(){return this.data.morale_end},d.prototype.getMoraleFactor=function(){return this.data.morale_factor},d.prototype.getMoraleStart=function(){return this.data.morale_start},d.prototype.setNightModeEvents=function(b){this.data.nightModeEvents=b.map(function(b){return{time:a.server2ClientTime(b.time),type:b.type}})},d.prototype.getNightClientTimes=function(){var a=0,b=0,c=Date.now()/1e3;if(this.data.nightModeEvents&&this.data.nightModeEvents.length){for(;this.data.nightModeEvents[0]<c;)this.data.nightModeEvents.shift();if(this.data.nightModeEvents.length<2)throw new Error;"night_start"===this.data.nightModeEvents[0].type?(a=this.data.nightModeEvents[0].time,b=this.data.nightModeEvents[1].time):(b=this.data.nightModeEvents[0].time,a=b-this.getNightDuration())}return{beg:a,end:b}},d.prototype.getNightTimeLeftTo=function(a){var b=Date.now(),c=this.getNightClientTimes(),d=a?c.end:c.beg;return d>b?d-b:0},d.prototype.getNightTimeLeft=function(){var a=Date.now(),b=this.getNightClientTimes();return a>b.beg?Math.max(0,b.end-a):0},d.prototype.getNightDuration=function(){return(this.data.night_end_hour-this.data.night_start_hour).mod(24)*a.inMS.hour},d.prototype.isNight=function(){return this.getNightTimeLeft()>0},d.prototype.getOfficerMortality=function(){return this.data.officer_mortality},d.prototype.getSpeed=function(){return parseFloat(this.data.speed,10)},d.prototype.getSuperValue=function(){return this.data.super_value},d.prototype.getDailyUnitDealSlotPurchaseLimit=function(){return this.data.daily_unit_deal||0},d.prototype.getWidgetNonPaccSlots=function(){return this.data.widget_non_pacc_slots},d.prototype.isInstantRecruitEnabled=function(){return!!this.data.instant_recruit},d.prototype.isSecondQueueJobEnabled=function(){return!!this.data.second_queue_job},d.prototype.isResourceDepositEnabled=function(){return!!this.data.resource_deposits},d.prototype.isInviteToMapEnabled=function(){return this.data.invite_to_map},d.prototype.isSecondVillageEnabled=function(){return!!this.data.second_village},d.prototype.getAmountDaysAttackProtection=function(){return this.data.noob_protection_days},d.prototype.getTribeMemberLimit=function(){return~~this.data.tribe_member_limit},d.prototype.isTribeSkillsFeatureEnabled=function(){return!!this.data.tribe_skills},d.prototype.getQuestTreeFolder=function(){return this.data.quest_tree_folder||b.QUEST_TREE_NAME_DEFAULT},d.prototype.getRallyPointSpeedBonusVsBarbarians=function(){return this.data.rally_point_speed_bonus_vs_barbarians},d.prototype.getSpyCosts=function(a){return this.data[c+a]},d.prototype.getAllSpyCosts=function(){return[this.getSpyCosts(1),this.getSpyCosts(2),this.getSpyCosts(3),this.getSpyCosts(4),this.getSpyCosts(5)]},d.prototype.getSpySabotageSpeedModifier=function(){return this.data.spy_sabotage_speed_modifier},d.prototype.getSpySpeedModifier=function(){return this.data.spy_speed_modifier},d.prototype.areSmartTipsEnabled=function(){return this.data.smart_tips},d.prototype.isRallyPointSpeedBonusEnabled=function(){return this.data.rally_point_speed_bonus},d}),define("models/PresetListModel",[],function(){var a=function(){this.presets={},this.presetsByVillage={},this.isLoadedValue=!1};return a.prototype.isLoaded=function(){return this.isLoadedValue},a.prototype.addPreset=function(a,b){this.presets[b.id]=b,a&&(this.presetsByVillage[a]=this.presetsByVillage[a]||{},this.presetsByVillage[a][b.id]=b)},a.prototype.deletePresets=function(a){var b=this;this.presets[a].assigned_villages.forEach(function(c){delete b.presetsByVillage[c][a]}),delete this.presets[a]},a.prototype.assign=function(a){if(this.isLoadedValue){var b,c,d=this;for(b in this.presetsByVillage[a.village_id])(c=this.presets[b].assigned_villages.indexOf(a.village_id))>=0&&this.presets[b].assigned_villages.remove(c),delete this.presetsByVillage[a.village_id][b];a.preset_ids.forEach(function(b){d.presetsByVillage[a.village_id]=d.presetsByVillage[a.village_id]||{},d.presetsByVillage[a.village_id][b]=d.presets[b],d.presets[b].assigned_villages.push(a.village_id)})}},a.prototype.addPresets=function(a){var b=this;this.isLoadedValue=!0,a.presets.forEach(function(a){a.assigned_villages.forEach(function(c){b.addPreset(c,a)}),a.assigned_villages.length<=0&&b.addPreset(0,a)})},a.prototype.getPresetsByVillageId=function(a){return this.presetsByVillage[a]=this.presetsByVillage[a]||{},this.presetsByVillage[a]},a.prototype.getPresets=function(){return this.presets},a}),define("conf/icons",[],function(){var a={systemGroups:{attacking:"-0020",supporting:"-0028",attacked:"-001F",supported:"-001E",scouting:"-002B",attacking_back:"-0025",supporting_back:"-002A",scouting_back:"-002D"},timeline:{TOP:36,BOTTOM:76,THRESHOLD:5,fontStyle:'14px "Book Antiqua",Georgia,"Times New Roman"',segmentWidth:43,width:36,height:36,borderWidth:6,outlineOffset:2,roundRadius:3,zeroOffset:11,textOffset:{x:5,y:16}},commands:{icons:{return_attack:"01",attack:"01",return_support:"02",support:"02",trading_trade:"05",trading_transport:"05",trading_return:"05",scouting_units:"06",scouting_buildings:"06",scouting_sabotage:"06",scouting_return:"06",empty:"00",direction:"04",direction_return:"03"},imgs:{background:"/img/interface/marker-background.png",directions:"/img/icons/marker-icons.png"},fontStyle:"normal 10px Arial",clickThreshold:5,villageOffset:66,dim:{type:{offsetX:31,offsetY:3,width:26,height:26},direction:{offsetX:3,offsetY:3,width:26,height:26},time:{offsetX:30,offsetY:39},cancel:{offsetX:31,offsetY:20}}},animations:{durations:{wait:1500,waitDifference:500,execute:1e3},selectors:{"resource-wood":"div#resources-wrapper div.icon-34x34-resource-wood","resource-clay":"div#resources-wrapper div.icon-34x34-resource-clay","resource-iron":"div#resources-wrapper div.icon-34x34-resource-iron","unit-spear":"div#unit-bar span.icon-34x34-unit-spear","unit-sword":"div#unit-bar span.icon-34x34-unit-sword","unit-axe":"div#unit-bar span.icon-34x34-unit-axe","unit-light_cavalry":"div#unit-bar span.icon-34x34-unit-light_cavalry","unit-archer":"div#unit-bar span.icon-34x34-unit-archer","unit-catapult":"div#unit-bar span.icon-34x34-unit-catapult","unit-doppelsoldner":"div#unit-bar span.icon-34x34-unit-doppelsoldner","unit-trebuchet":"div#unit-bar span.icon-34x34-unit-trebuchet","unit-snob":"div#unit-bar span.icon-34x34-unit-snob","unit-mounted_archer":"div#unit-bar span.icon-34x34-unit-mounted_archer","unit-heavy_cavalry":"div#unit-bar span.icon-34x34-unit-heavy_cavalry","unit-ram":"div#unit-bar span.icon-34x34-unit-ram","unit-knight":"div#unit-bar span.icon-34x34-unit-knight",premium:"a#inventory-button",resources:"a#inventory-button","resources-gold":"a#inventory-button"}}};return a.timeline.innerWidth=a.timeline.width-2*a.timeline.outlineOffset,a.timeline.innerHeight=a.timeline.height-2*a.timeline.outlineOffset,a.timeline.middleSegmentWidth=a.timeline.width-2*a.timeline.borderWidth,a}),define("models/GroupListModel",["conf/icons"],function(a){var b;return b=function(){var b,c={groups:{},villageGroups:{},groupVillageIds:{},systemGroupVillageIds:{},systemGroups:{attacking:{id:-8,onConquer:"attacked"},supporting:{id:-7,onConquer:"supported"},attacked:{id:-5,onConquered:!0},supported:{id:-4,onConquered:!0},scouting:{id:-6},attacking_back:{id:-3},supporting_back:{id:-2},scouting_back:{id:-1}},villageSystemGroupCounts:{}},d=function(b){var d,e,f;for(d=0;d<b.length;d++){if(e=b[d],c.groups[e.id])throw new Error("groupAlreadySet");c.groups[e.id]={id:e.id,name:e.name,icon:e.icon}}for(f in c.systemGroups)c.systemGroups[f].name=f,c.systemGroups[f].icon=a.systemGroups[f],c.systemGroups[f].system=!0},e=function(a,b){var d=c[b?"systemGroups":"groups"][a];if(!d)throw new Error("groupDoesNotExist");return d},f=function(a){return c.villageSystemGroupCounts[a]||(c.villageSystemGroupCounts[a]={}),c.villageSystemGroupCounts[a]},g=function(a,c,d){var e,g=!0,h=f(c);if(d.count){if(h[a.name]!==b)throw new Error("groupCountAlreadyDefined");h[a.name]=d.count,g=!1}else d.diff&&(h[a.name]===b&&(h[a.name]=0,g=!1),e=h[a.name]+=d.diff,d.diff<0&&(0===e?(g=!1,delete h[a.name]):0>e&&(g=!0,delete h[a.name])));return g},h=function(a){return c.villageGroups[a]===b&&(c.villageGroups[a]=[]),c.villageGroups[a]},i=function(a){return c.groupVillageIds[a]===b&&(c.groupVillageIds[a]=[]),c.groupVillageIds[a]},j=function(a){if("string"!=typeof a)throw new TypeError;return c.systemGroupVillageIds[a]===b&&(c.systemGroupVillageIds[a]=[]),c.systemGroupVillageIds[a]},k=function(a){h(a).sortByProperty("id")},l=function(a,b,c){var d,f,l,m,n;"number"!=typeof b&&(b=parseInt(b,10)),d=e(a,c),c&&g(d,b,c)||(f=h(b),l=f.indexOf(d),-1!==l&&(f.remove(l),c?(n=j(a),n.remove(n.indexOf(b))):(m=i(a),m.remove(m.indexOf(b))),k(b)))},m=function(a,b,c){var d,f,l,m;"number"!=typeof b&&(b=parseInt(b,10)),d=e(a,c),c&&g(d,b,c)||(f=h(b),-1===f.indexOf(d)&&(f.push(d),c?(m=j(a),m.push(b)):(l=i(a),l.push(b)),k(b)))},n=function(a,b){var d,e,g,h=f(a);for(e in h)d=c.systemGroups[e],g=h[e],d[b?"onConquered":"onConquer"]&&(b?l(d.name,a,{diff:-1*g}):m(c.systemGroups[d.onConquer].name,a,{diff:g}))},o=function(a){var b,c,d,e;if(a){for(b in a.groups)if(a.groups.hasOwnProperty(b))for(c=a.groups[b],e=0;e<c.length;e++)m(c[e],b);for(b in a.commands)if(a.commands.hasOwnProperty(b)){c=a.commands[b];for(d in c)c.hasOwnProperty(d)&&m(d,b,{count:c[d]})}}},p=function(){return c.groups},q=function(){return c.systemGroups},r=function(a){if(c.groups[a.id])throw new Error("groupAlreadyDefined");c.groups[a.id]={id:a.id,name:a.name,icon:a.icon}},s=function(a){var b=c.groups[a&&a.id];b&&(b.name=a.name,b.icon=a.icon)},t=function(a){var b,d=i(a).slice(0);for(b=0;b<d.length;b++)l(a,d[b]);delete c.groups[a]};this.mirrorSystemGroupsOnConquer=n,this.attachVillageGroup=m,this.detachVillageGroup=l,this.setVillageGroups=o,this.setGroups=d,this.getGroups=p,this.getSystemGroups=q,this.getVillageGroups=h,this.getGroupVillageIds=i,this.getSystemGroupVillageIds=j,this.addGroup=r,this.changeGroup=s,this.removeGroup=t}}),define("models/AchievementListModel",[],function(){var a=function(){this.data={categories:{},achievements:{},lastAchievements:[],sortAchievements:[]},this.isLoadedValue=!1},b=function(a,b){a.repeatable?(a.level=a.level||0,a.level+=b.level):a.level=b.level,a.progress=b.progress,b.time_last_level&&(a.time_last_level=b.time_last_level)};return a.prototype.isLoaded=function(){return this.isLoadedValue},a.prototype.setBalancingData=function(a){this.data.achievements=a},a.prototype.updateAchievement=function(a){var c=a.type,d=this.data.achievements[c];b(d,a),!d.repeatable&&a.new_level&&0!==Object.keys(this.data.categories).length&&(this.data.categories[d.category].current+=d.points[a.level-1],this.data.achievements[a.type].totalPoints+=d.points[a.level-1]),this.sort()},a.prototype.addProgressData=function(a){var c,d,e;for(this.data.categories=a.categories,d=0;d<a.achievements.length;d++)e=a.achievements[d].type,this.data.achievements[e]=this.data.achievements[e]||{},b(this.data.achievements[e],a.achievements[d]);for(c in this.data.achievements){if(this.data.achievements[c].totalPoints=0,this.data.achievements[c].level=this.data.achievements[c].level||0,this.data.achievements[c].progress=this.data.achievements[c].progress||0,this.data.achievements[c].milestone)for(d in this.data.achievements[c].reached_levels)this.data.achievements[c].points&&this.data.achievements[c].reached_levels[d]&&(this.data.achievements[c].totalPoints+=this.data.achievements[c].points[d-1]);else for(d=0;d<this.data.achievements[c].level;d++)this.data.achievements[c].points&&(this.data.achievements[c].totalPoints+=this.data.achievements[c].points[d]);this.data.sortAchievements.push(this.data.achievements[c])}this.sort(),this.isLoadedValue=!0},a.prototype.sort=function(){var a,b;this.data.sortAchievements.sort(function(a,b){return!a.time_last_level||a.time_last_level<b.time_last_level?1:-1}),a=this.data.sortAchievements.slice(0,5),this.data.lastAchievements=[];for(b in a)a.hasOwnProperty(b)&&a[b].time_last_level&&this.data.lastAchievements.push(a[b])},a.prototype.getAchievementsData=function(){return this.data},a.prototype.getAchievementsByType=function(a){return this.data.achievements[a]},a}),define("models/TribeApplicationsModel",[],function(){var a=function(){this.applications={},this.isLoadedValue=!1};return a.prototype.isLoaded=function(){return this.isLoadedValue},a.prototype.setData=function(a){var b,c;for(b in a)a.hasOwnProperty(b)&&(c=a[b],this.applications[c.tribe_id]=c);this.isLoadedValue=!0},a.prototype.getData=function(){return this.applications},a.prototype.removeApplication=function(a){var b;if(this.isLoadedValue)for(b in this.applications)if(this.applications[b].id===a){delete this.applications[b];break}},a.prototype.addApplication=function(a){this.isLoadedValue&&(this.applications[a.tribe_id]=a)},a}),define("models/TribeSettingsModel",["helper/dataconversion"],function(a){var b={name:"name",tag:"tag",allow_applications:"allowApplications",open:"openTribe",set_open:"openTribe",icon:"icon",achievements:"achievements",description:"description",min_points:"minPoints",power:"power"},c={APPLICATION_ANYONE:"application_anyone",APPLICATION_ONLY:"application_only",APPLICATION_CLOSED:"application_closed"},d=function(a){Object.defineProperty(this,"applicationType",{set:function(a){var b,d;switch(a){case c.APPLICATION_ANYONE:b=!0,d=!0;break;case c.APPLICATION_ONLY:b=!1,d=!0;break;case c.APPLICATION_CLOSED:b=!1,d=!1}this.openTribe=b,this.allowApplications=d},get:function(){var a;return a=this.openTribe?this.applicationTypes.APPLICATION_ANYONE:this.allowApplications?this.applicationTypes.APPLICATION_ONLY:this.applicationTypes.APPLICATION_CLOSED}}),this.old={},this.update(a)};return d.prototype.applicationTypes=c,d.prototype.valid=function(){return 3===this.tag.length},d.prototype.update=function(c){var d,e;for(d in b)("allow_applications"===d||"open"===d)&&(c[d]=!!c[d]),null!==c[d]&&c[d]!==e&&(this[b[d]]=this.old[b[d]]=c[d]);this.old.applicationType=this.applicationType,this.old.icon=this.icon=a.icon(null,this.icon)},d.prototype.isModified=function(){var a;for(a in b)if(this[b[a]]!==this.old[b[a]])return!0;return!1},d.prototype.reset=function(){var a;for(a in b)this[b[a]]=this.old[b[a]]},d.prototype.apiify=function(){var a,c={};for(a in b)"open"!==a&&this[b[a]]!==this.old[b[a]]&&(c[a]=this[b[a]]);return c.icon&&(c.icon=parseInt(c.icon,16)),c},d}),define("models/OfficerDataModel",[],function(){var a=function(a){this.data=a};return a.prototype.getDataForType=function(a,b){var c,d,e=[],f=[];if(b)for(d in b)b.hasOwnProperty(d)&&b[d]&&(e=e.concat(this.data[d].abilities));else for(d in this.data)this.data.hasOwnProperty(d)&&(e=e.concat(this.data[d].abilities));for(c=0;c<e.length;c++)e[c].type===a&&f.push(e[c]);return f},a.prototype.getCommandType=function(a){return this.data[a].command_types[0]},a.prototype.getExcludeUnits=function(a){return this.data[a].exclude_unit_types||[]},a}),define("models/TribeForumThreadListModel",[],function(){var a=function(){this.forum={},this.threadIdToIndex={},this.lastIndex={},this.threadIdToForumId={}};return a.prototype.getThreadsForForum=function(a){return this.forum[a]},a.prototype.hasForum=function(a){return!!this.forum[a]},a.prototype.deleteForum=function(a){delete this.forum[a]},a.prototype.getIndexForThread=function(a,b){return this.threadIdToIndex[a][b]},a.prototype.getThreadById=function(a){var b,c=null;return void 0!==(b=this.threadIdToForumId[a])&&(c=this.forum[b].threads[this.threadIdToIndex[b][a]]),c},a.prototype.getLastLoadedIndex=function(a){return this.lastIndex[a]},a.prototype.addThreadsForForum=function(a){var b,c=a.forum_id,d=a.offset;for(this.forum[c]||(this.forum[c]={},this.threadIdToIndex[c]={},this.forum[c].threads={},this.lastIndex[c]=-1),b=d;b<d+a.threads.length;b++)this.forum[c].threads[b]=a.threads[b-d],this.threadIdToIndex[c][a.threads[b-d].id]=b,this.threadIdToForumId[a.threads[b-d].id]=c,this.lastIndex[c]<b&&(this.lastIndex[c]=b);this.forum[c].totalThreads=a.total},a.prototype.addThread=function(a){var b,c,d=a.forum_id,e=this.forum[d];if(void 0!==e){for(b=this.lastIndex[d];b>-1&&(c=e.threads[b],!c||!(c.pinned&&!a.pinned||c.pinned===a.pinned&&c.last_posted>a.last_posted));b--)e.threads[b+1]=e.threads[b],e.threads[b]&&(this.threadIdToIndex[a.forum_id][e.threads[b].id]=b+1);e.threads[b+1]=a,this.threadIdToForumId[a.id]=d,this.threadIdToIndex[a.forum_id][a.id]=b+1,e.totalThreads++,this.lastIndex[d]++,!e.threads[b+2]&&b+2<this.lastIndex[d]&&(e.threads[b+1].dirty=!0)}},a.prototype.deleteThreads=function(a,b){var c,d,e;for(d=0;d<b.length;d++)e=b[d],(c=this.getThreadsForForum(a))&&(void 0===this.getIndexForThread(a,e)?c.dirty=!0:this.deleteThread(e))},a.prototype.reorderThreads=function(a,b){var c,d,e;for(d=0;d<b.length;d++)e=b[d].id,(c=this.getThreadsForForum(a))&&(void 0===this.getIndexForThread(a,e)?c.dirty=!0:this.deleteThread(e)),this.addThread(b[d])},a.prototype.deleteThread=function(a){var b,c=this.threadIdToForumId[a],d=this.forum[c].threads;for(b=this.threadIdToIndex[c][a];b<this.lastIndex[c];b++)d[b]=d[b+1],this.threadIdToIndex[c][d[b].id]=b;delete d[b],this.forum[c].totalThreads--,this.lastIndex[c]--},a.prototype.renameThread=function(a,b){var c=this.threadIdToForumId[a],d=this.threadIdToIndex[c][a];return c&&(d||0===d)&&(this.forum[this.threadIdToForumId[a]].threads[d].name=b),c},a.prototype.closeThreads=function(a,b){var c,d,e,f=[];for(c=0;c<a.length;c++)d=a[c],e=this.threadIdToForumId[d],e&&(this.forum[e].threads[this.threadIdToIndex[e][d]].closed=b?1:0,f.push(e));return f},a.prototype.readThreads=function(a,b){var c,d,e;for(c=0;c<a.length;c++)d=a[c],e=this.threadIdToForumId[d],e&&(this.forum[e].threads[this.threadIdToIndex[e][d]].reader_id=b)},a}),define("models/InterstitialStackModel",[],function(){var a=function(a){this.data=a||[],this.prev=null,this.data.forEach(function(a){a.content=window.location.protocol+a.content})};return a.prototype.getNext=function(){return this.prev=this.data.shift()},a.prototype.getPrevious=function(){return this.prev||this.getNext()},a}),define("services/ModelDataService",["app","models/PlayerModel","models/GameDataModel","models/WorldConfigModel","models/PresetListModel","models/GroupListModel","models/AchievementListModel","models/TribeApplicationsModel","models/TribeSettingsModel","models/OfficerDataModel","models/TribeForumThreadListModel","models/InterstitialStackModel","models/TribeSkillListModel"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.factory("modelDataService",["gameDataModelProvider",function(a){var n={},o=function(){this.setGameData(a())},p=function(){return n.PLAYER||null},q=function(){return n.PLAYER?n.PLAYER.getSelectedCharacter():null},r=function(){var a=q();return a?a.getSelectedVillage():null},s=function(){return n.GROUP_LIST=n.GROUP_LIST||new f,n.GROUP_LIST},t=function(){return n.FORUM_THREAD_LIST||null},u=function(a){if(!(a instanceof k))throw new TypeError("tribeForumThreadListModel must be an instance of TribeForumThreadListModel!");n.FORUM_THREAD_LIST=a},v=function(){return n.OWN_APPLICATIONS=n.OWN_APPLICATIONS||new h,n.OWN_APPLICATIONS},w=function(){return n.PRESET_LIST=n.PRESET_LIST||new e,n.PRESET_LIST},x=function(){return n.ACHIEVEMENT_LIST=n.ACHIEVEMENT_LIST||new g,n.ACHIEVEMENT_LIST},y=function(){var a=q();return a?a.getQuestLineListModel():null},z=function(){var a=q();return a?a.getInventory():null},A=function(a){if(!(a instanceof b))throw new TypeError("playerModel must be an instance of PlayerModel!");n.PLAYER=a},B=function(){return n.WORLD_CONFIG||null},C=function(a){if(!(a instanceof d))throw new TypeError(a+" must be an instance of WorldConfigModel!");n.WORLD_CONFIG=a},D=function(){return n.GAME_DATA||null},E=function(a){if(!(a instanceof c))throw new TypeError("GameDataModel must be an instance of GameDataModel!");n.GAME_DATA=a},F=function(a){var b=D();if(!b)throw new Error("Could not get GameDataModel");b.setBaseData(a)},G=function(a){var b=D();if(!b)throw new Error("Could not get GameDataModel");b.setBuildings(a)},H=function(a){n.OFFICER_DATA=new j(a)},I=function(){return n.OFFICER_DATA},J=function(a){var b=D();if(!b)throw new Error("Could not get GameDataModel");b.setUnits(a)},K=function(a){var b=D();if(!b)throw new Error("Could not get GameDataModel");b.setPremiumCosts(a)},L=function(a){if(!(a instanceof l))throw new TypeError("stack must be an instance of InterstitialStackModel!");n.INTERSTITIALS=a},M=function(){return n.INTERSTITIALS},N=function(a){if(!(a instanceof i))throw new TypeError("settings must be an instance of TribeSettingsModel!");n.TRIBE_SETTINGS=a},O=function(){return n.TRIBE_SETTINGS},P=function(a){if(!(a instanceof m))throw new TypeError("skills must be an instance of TribeSkillListModel!");n.TRIBE_SKILLS=a},Q=function(){return n.TRIBE_SKILLS};return o.prototype={getPlayer:p,getSelectedCharacter:q,getSelectedVillage:r,getGroupList:s,getTribeForumThreadListModel:t,setTribeForumThreadListModel:u,getApplications:v,getPresetList:w,getAchievementList:x,getQuestLineListModel:y,getInventory:z,setPlayer:A,getWorldConfig:B,setWorldConfig:C,getGameData:D,setGameData:E,setGameDataBaseData:F,setGameDataBuildings:G,setOfficers:H,getOfficers:I,setGameDataUnits:J,setGameDataPremiumCosts:K,setInterstitialStack:L,getInterstitialStack:M,setTribeSettings:N,getTribeSettings:O,getTribeSkills:Q,setTribeSkills:P},new o}])}),define("services/TemplateManagerService",["angular","app","conf/conf"],function(a,b,c){b.factory("templateManagerService",["$rootScope","$compile","httpService",function(b,d,e){var f={},g={};return{load:function(d,f,h){var i,j=function(c,e,h,i){a.isFunction(f)&&f(c,e,h,i),g[d]=c,b.$$phase||b.$apply()};i=0!==d.indexOf("!")?c.TEMPLATE_PATH_EXT.join(d):d.substr(1),g[d]?j(g[d],304):e.get(i,j)},compile:function(c,e,g,h,i){var j=function(i,j,k,l){var m,n,o=a.element(i),p=e||b.$new();a.isFunction(h)&&h(i,j,k,l),f[c]?m=f[c]:(m=d(o),f[c]=m),n=m(p,function(b,c){a.isFunction(g)&&g(b,c)})},k=function(b,c,d,e){a.isFunction(i)&&i(b,c,d,e)},l=this;return b.$$phase?void this.load(c,j,k):void b.$apply(function(){l.load(c,j,k)})}}}])}),define("construct/ui/Window",["battlecat","queues/EventQueue"],function(a,b){var c="win-content",d="blocked",e=function(a){this.id=a.id,this.modal=a.modal,this.rootnode=document.createElement(a.modal?"div":"section"),this.destroyCallback=a.destroyCallback,this.templateName=a.templateName,this.mgr=a.mgr,this.hasUnsavedChanges=!1,this.zIndex=1,this.pos={},this.scope=a.scope,this.rootScope=a.rootScope,this.full=a.full;var b=[this.templateName.split("_").join("-")];if(a.modal&&a.full)throw new Error;b.push(a.modal?"twx-modal":"twx-window screen"),a.full&&b.push("fullsize"),this.rootnode.id="twx-w"+a.id,this.rootnode.className=b.join(" "),this.scope.twxWindow=this};return e.extendPrototypeWith({init:function(){b.register(b.types.RESIZE,this.resize,this)},destroy:function(c){var d=this;this.modal&&a(this.modal).remove(),a(this.rootnode).off(),this.mgr.destroy(this),c||this.rootScope.$$postDigest(function(){d.scope.$destroy()}),a(this.rootnode).off(),this.remove(),this.destroyed=!0,window.twx&&b.unregister(b.types.RESIZE,this.resize)},appendTo:function(a){return a.append(this.rootnode),this},remove:function(){return this.rootnode.parentNode&&this.rootnode.parentNode.removeChild(this.rootnode),this},hide:function(){return a(this.rootnode).hide(),this},show:function(){return a(this.rootnode).show(),this},block:function(){return a(this.rootnode).find("."+c).addClass(d),this},unblock:function(){return a(this.rootnode).find("."+c).removeClass(d),this},bindEvents:function(b){return a(this.rootnode).on(b),this},unbindEvents:function(b){return a(this.rootnode).off(b),this}}),e}),define("services/WindowManagerService",["angular","app","battlecat","construct/ui/Window","queues/EventQueue"],function(a,b,c,d,e){b.factory("windowManagerService",["$rootScope","$timeout","templateManagerService","eventTypeProvider","contextMenuService",function(b,f,g,h,i){var j,k,l=c(document.body),m=c("#wrapper"),n=[],o=null,p=[],q="left",r="modal",s="window-open",t="window-fullsize",u={building_rally_point:["screen_preset"],building_statue:["screen_village_info"],building_hospital:["report"],report_list:["report"],report:["screen_character_info","screen_tribe","screen_no_tribe","screen_village_info"],screen_village_info:["report","screen_tribe","screen_character_info","screen_province"],message_list:["message_screen","message_view","report_list","report"],screen_character_info:["screen_village_info","screen_tribe"],screen_ranking:["screen_tribe","screen_character_info"],screen_province:["screen_village_info","screen_character_info"],screen_overview:["screen_unit_overview","screen_village_info","screen_character_info"],screen_unit_overview:["screen_village_info","screen_character_info"],screen_tribe:["screen_village_info","screen_tribe","screen_character_info","report_list","report"],message_view:["screen_village_info","screen_tribe","screen_character_info","report_list","report"],"test/screen_test_rich_text":["screen_village_info","screen_tribe","screen_character_info","report_list","report"],message_screen:["report_list"],screen_settings:["message_screen"]},v=function(){var a=0;return function(){return++a}}(),w=function(a){var b;for(b=0;b<p.length;b++)if(p[b]&&p[b].templateName===a)return void p[b].destroy();for(b=0;b<n.length;b++)if(n[b]&&n[b].templateName===a)return void n[b].destroy();o&&o.templateName===a&&(o.destroy(),o=null)},x=function(a){var b;for(b=0;b<p.length;b++)if(p[b]&&p[b].templateName===a)return p[b];for(b=0;b<n.length;b++)if(n[b]&&n[b].templateName===a)return n[b];return o&&o.templateName===a?o:!1},y=function(a,b){return a.hasUnsavedChanges||b.hasUnsavedChanges},z=function(){var a;for(o&&(o.destroy(),o=null);a=p.pop();)a.destroy()},A=function(a){var b,c,d;for(b=0;b<p.length;b++)d=p[b].templateName,u[a].indexOf(d)>-1&&(c=p.splice(b,1)[0],c.destroy())},B=function(a,b){var c,d;for(c=0;c<a.length;c++)if(d=a[c].templateName,u[d]&&u[d].indexOf(b)>-1)return!0;return!1},C=function(a){return u[a]?u[a].filter(function(a){return x(a)}):[]},D=function(a){if(a){if(a.modal)return n.length&&n[0].remove(),a.appendTo(l),n.unshift(a),c(a.rootnode).addClass(r),r;if(a.appendTo(m),window.twx&&window.twx.game&&e.trigger(e.types.RESIZE,{instant:!0,right:!0}),p.length){if(B(p,a.templateName))return p.push(a),c(a.rootnode).addClass(q),q;if(p.reduce(y,!1)){if(!confirm("If you continue, your unsaved data in $screen is lost."))return!1}else z()}return p.push(a),p.length&&m.addClass(s),a.full&&m.addClass(t),c(a.rootnode).addClass(q),q}},E=function G(a){var b=0,d=0,e=c(a.getElementsByClassName("win-head")).height(),g=c(a.getElementsByClassName("win-foot")).height(),h=0;return e&&g?(c("#interface-bottom-left")[0]&&(d=c("#interface-bottom-left").height()>>2,b=c("#resource-bar").height()>>2),void c(a.getElementsByClassName("box-paper")).css("maxHeight",c(document.body).height()-b-d-h-g-e+"px")):void f(function(){G(a)})},F=function(e,f,l,m,o,p,q,r){var s,t=x(e);if(!t||(t.destroy(),!o))return f=f||b.$new(),s=new d({id:j=v(),scope:f,mgr:k,modal:p,full:q,templateName:e,rootScope:b}),s.destroyCallback=m,f.closeWindow=function(){s.destroyed||(s.destroy(),s.modal&&D(n.shift()),b.$broadcast(h.WINDOW_CLOSED,s.templateName))},f.moveBack=function(){s.modal&&!s.destroyed&&(s.remove(),n.remove(n.indexOf(s)),n.length?(D(n.shift()),n.push(s)):D(s))},g.compile(e,f,function(d,e){var f,g,j;l&&l(s,e),p?(f=document.createElement("div"),g=document.createElement("div"),j=document.createElement("div"),f.className="outer-wrapper",g.className="middle-wrapper",j.className="inner-wrapper",c(f).on("click",function(d){if(d.target===g){b.$broadcast(h.AUDIO_PLAY_SFX,"cancel_action_01");var e=a.element(c("#context-menu")[0]),f=s.rootnode.className;-1!==f.indexOf("landing-pw")||-1!==f.indexOf("character-selection")||-1!==f.indexOf("register")||-1!==f.indexOf("modal-establish-village")||-1!==f.indexOf("modal-game-over")||-1!==f.indexOf("modal-player-banned")||-1!==f.indexOf("login")&&-1===f.indexOf("daily-login-bonus")||a.element(s.rootnode.getElementsByClassName("win-content")).scope().closeWindow(),n.length||e.scope()&&i.destroy()}}),r&&(f.className+=" modal-bg-framed"),c(j).append(d),c(g).append(j),c(f).append(g),c(s.rootnode).append(f),E(s.rootnode),window.addEventListener("resize",function(){E(s.rootnode)},!1)):c(s.rootnode).append(d)},null,function(){c("#twx-w"+j).remove()}),D(s),s};return k={getScreen:function(a,b,c,d){return F(a,null,b,c,d)},getScreenWithInjectedScope:function(a,b,c,d,e){return F(a,b,c,d,e)},getFullSize:function(a,b,c,d,e){return F(a,b,c,d,e,!1,!0)},getModal:function(a,b,c,d){return F(a,b,c,d,!1,!0)},getFramedModal:function(a,b,c,d){return F(a,b,c,d,!1,!0,!1,!0)},destroy:function(a){var b;a.modal&&(n.remove(n.indexOf(a)),window.removeEventListener("resize",function(){E(a.rootnode)},!1)),window.removeEventListener("resize",function(){a.scrollbar&&a.scrollbar.recalc()},!1),(b=p.indexOf(a))>=0&&p.remove(b),p.length||a.modal||(m.removeClass(s),m.removeClass(t),window.twx&&window.twx.game&&e.trigger(e.types.RESIZE,{instant:!0,right:!0}))},isTemplateOpen:x,getScreens:function(){return p},getModals:function(){return n},getLatestWindow:function(){var a=this.getScreens(),b=this.getModals(),c=a[a.length-1],d=b[0];if(d||c)return d?d:c},closeSubScreens:A,getOpenSubscreens:C,getScopes:function(){var a=k.getScreens(),b=[];return a.forEach(function(a){b.push(a.scope.$$childTail||a.scope)}),b},closeAll:z,closeTemplate:w}}])}),define("services/WindowDisplayService",["app","conf/conf"],function(a,b){a.factory("windowDisplayService",["$rootScope","$filter","eventTypeProvider","windowManagerService","modelDataService","socketService","routeProvider",function(a,c,d,e,f,g,h){var i=function(b){var d=a.$new(),f="modal_attention_attack_noob_protection";d.title=c("i18n")("attention",a.loc.ale,f),d.text=c("i18n")("text",a.loc.ale,f),d.boxText=c("i18n")("boxtext",a.loc.ale,f),d.submitText=c("i18n")("yes",a.loc.ale,f),d.cancelText=c("i18n")("no",a.loc.ale,f),d.submit=function(){d.closeWindow(),b&&b()},d.cancel=function(){d.closeWindow()},e.getModal("modal_attention",d)},j=function(b){if(b){var c=a.$new();c.tileCoords=b,e.getScreenWithInjectedScope("screen_province",c)}},k=function(){a.$broadcast(d.AUDIO_PLAY_SFX,"button_04"),e.getScreen("screen_second_village")},l=function(){a.$broadcast(d.AUDIO_PLAY_SFX,"button_04"),e.getScreen("screen_resource_deposit")},m=function(b){var c=a.$new();b&&(c.activeTab=b),e.getFullSize("overview/screen_overview",c)},n=function(b){var c=a.$new();c.villageId=b,e.getScreenWithInjectedScope("screen_village_info",c);

},o=function(b){var c=a.$new();c.tribeId=b,e.getScreenWithInjectedScope("screen_tribe",c)},p=function(){e.getScreen("screen_no_tribe",void 0,void 0,!0)},q=function(b,c){var d=a.$new();c&&("string"==typeof c?e.isTemplateOpen(c)&&e.closeTemplate(c):c.closeWindow?c.closeWindow():this.closeWindow&&this.closeWindow()),d.characterId=b,e.getScreenWithInjectedScope("screen_character_info",d)},r=function(){var b=a.$new();b.activeTab="sale",e.getScreenWithInjectedScope("screen_shop",b)},s=function(){e.getScreen("screen_inventory")},t=function(c,d){var i,j=a.$new(),k=3,l=25;d&&(i=f.getSelectedCharacter().getVillages().map(function(a){return a.getId()}),-1===i.indexOf(c))||(j.name={newName:""},j.MIN_NAME_LENGTH=k,j.MAX_NAME_LENGTH=l,j.submit=function(){j.name.newName.length<k||j.name.newName.length>l||(c===b.RESERVED_VILLAGE_IDS.SECOND_VILLAGE?g.emit(h.SECOND_VILLAGE_RENAME,{new_name:j.name.newName}):g.emit(h.VILLAGE_CHANGE_NAME,{village_id:c,name:j.name.newName}),j.closeWindow())},e.getModal("modal_rename_village",j))},u=function(b){var c=a.$new();c.recipients=b,e.getScreenWithInjectedScope("message_screen",c)},v=function(b){var c=a.$new();c.offer=b,c.close=function(){c.closeWindow()},e.getModal("modal_packet_offer",c)},w=function(b){var c,d,g,h=a.$new(),i=f.getGameData().getOfficers();for(g=0;g<i.length;g++)if(c=b.type.indexOf(i[g]),-1!==c){d=i[g];break}h.name=d,h.close=function(){h.closeWindow()},e.getModal("modal_officer_info",h)};return{openAttackProtectionModal:i,openProvinceScreen:j,openSecondVillage:k,openOverview:m,openVillageInfo:n,openTribeProfile:o,openNoTribeScreen:p,openCharacterProfile:q,openShop:r,openInventory:s,openChangeVillageName:t,openResourceDeposit:l,openWriteMessageScreen:u,openOfferInfo:v,openOfficerInfo:w}}])}),define("services/VillageService",["app","angular","conf/conf"],function(a,b,c){a.factory("villageService",["$rootScope","routeProvider","modelDataService","socketService","eventTypeProvider","storageService","resourceTimerService","buildingTimerService","recruitingTimerService","screenFactory","buildingQueueTimerService","settingsService",function(a,d,e,f,g,h,i,j,k,l,m,n){var o=null,p=[],q=!1,r=!1,s=function(a){return{village_id:a,count:c.MAX_MERCHANTS,offset:0,order:1,ordered_by:"transport_id"}},t=function(c,e){b.isFunction(e)&&p.push(e),q||(q=!0,f.emit(d.VILLAGE_BATCH_GET_VILLAGE_DATA,{village_ids:[c]},function(){var b;for(q=!1,o=c,r||(i.init(),j.init(),k.init(),m.init(),r=!0);b=p.shift();)b();a.$broadcast("DONE"),a.$broadcast(g.VILLAGE_LOADED)}))},u=function(a,b){f.emit(d.VILLAGES_IN_PROVINCE,{village_id:a},b)},v=function(a,b){f.emit(d.VILLAGE_RESOURCE_INFO,{village_id:a},b)},w=function(a){var b,c,d=0;for(b=0;b<a.length;b++)c=a[b].chapel||a[b].church,c&&c>d&&(d=c);return d},x=function(){var a,b=e.getSelectedCharacter(),c=b.getVillages(),d=h.getItem("lastSelectedVillageId"),f=c.length;if(d&&f)for(;f--;)if(a=c[f],d===a.getId())return a},y=function(a,b){var c=e.getWorldConfig().getChurchBonus(),d=0;return 0>a||a>c.length-1?0:(d=b?c[1]:c[a],Math.floor(100*d))},z=function(a){var b,c,d,f,g=e.getSelectedVillage(),h={};if(!g)throw new Error("No Village has been selected!");if(b=g.getBuildingData(),!b)throw new Error("Could not load buildingData!");if(c=b.getDataForBuilding(a),!c)throw new Error("Could not load buildingData for building "+a);d=c.researches;for(f in d)d[f].researched&&c.level>=d[f].required_level&&(h[f]=d[f]);return h},A=function(a,b){o&&o===a?b():t(a,b)},B=function(a,b,c){l.get(b,c)},C=function(b,c){!b||!b.getId,a.$broadcast(g.MAP_SELECT_VILLAGE,b.getId()),c&&a.$broadcast(g.MAP_JUMP_TO,b.getX(),b.getY())},D=function(a,b){var c=e.getSelectedCharacter(),d=c.getSelectedVillage(),f=c.getVillages(),g=f.length;if(1!==g){for(b&&window.twx.game.map.engine.level===window.twx.game.map.engine.levels.TOWN&&(b=!1);g--;)if(f[g].getId()===d.getId())return g+=a,n.settings.game.villageRepeat?0>g?g=f.length-1:g>=f.length&&(g=0):g=g.bound(0,f.length-1),void C(f[g],b);C(f[0],b)}},E=function(a,b,c){D(b,!!c)};return a.$on(g.VILLAGE_SELECT_BUILDING,B),a.$on(g.VILLAGE_SWITCH,E),{villageTransportListParams:s,ensureVillageDataLoaded:A,getActiveResearchesForBuilding:z,getLastSelectedVillage:x,requestVillageProvinceNeighbours:u,requestVillageResourceInfo:v,getHighestGodsHouseLevel:w,getMoralBonus:y,switchVillage:D}}])}),define("helper/window",[],function(){var a=function(){return window.location},b=function(b){var c=a();c.href=b},c=function(){return window.twx.game.map.engine};return{getLocation:a,setLocation:b,getMapEngine:c}}),define("helper/uri",["helper/window"],function(a){var b=function(b){var c,d=b,e={};return void 0===d&&(d=a.getLocation().search||""),d&&-1!==d.indexOf("?")?(d.substr(1).split("&").forEach(function(a){c=a.split("="),e[c[0]]=decodeURIComponent(c[1])}),e):e},c=function(a,c,d){var e,f,g="",h=!0,i=b(a);for(f in d)i[f]=d[f];for(f in i)e=i[f],null!==e&&(g+=h?"?"+f+"="+encodeURIComponent(e):"&"+f+"="+encodeURIComponent(e),h=!1);return c&&(g+=c),g},d=function(a,c){var d=b(c),e=d[a];return e};return{getExtendedURLParams:c,getURLParamsObject:b,getURLParam:d}}),define("services/AuthService",["app","helper/time","helper/uri"],function(a,b,c){a.factory("authService",["$rootScope","socketService","modelDataService","routeProvider","eventTypeProvider","ipCookie","cookieService","windowManagerService",function(a,d,e,f,g,h,i,j){var k=null,l=null,m=null,n=null,o="globalAuthCookie",p=function(a){var b={};return b[o]=a||!0,b},q=function(a,b,e){var g=c.getURLParam("ref");d.emit(f.LOGIN,{name:a,pass:b,ref_param:g},e||null)},r=function(a){d.emit(f.LOGOUT,{},a||null)},s=function(a,b){k=l=m=n=null,b||i.remove(p()).then(function(){a&&a()},function(a){})},t=function(){i.remove(p())},u=function(){return h(o)},v=function(a,c){var d;return c&&(d={expires:b.inS.year,expirationUnit:"seconds"}),i.set(p(a),d)},w=function(){var a=u();return m&&n||a&&a.token&&a.playerName},x=function(a){m=a},y=function(){var a=u(),b=c.getURLParam("ref");n=n||a.playerName,m=m||a.token,d.emit(f.LOGIN,{name:n,token:m,ref_param:b})},z=function(){return w()?(y(),!0):!1},A=function(){d.emit(f.RECONNECT,{character:k,name:n,world:l,token:m})},B=function(){return h("portal_data")||""},C=function(){return c.getURLParam("start_page_type")||"game_v1"},D=function(a){l=a},E=function(a){n=a},F=function(){return l},G=function(){return k},H=function(a){k=a},I=function(b,c,h){var i=a.$new();i.submit=function(){d.emit(f.CLOSED_BETA_ENTER,{key:i.key})},i.$on(g.CLOSED_BETA_ENTERED,function(){e.getPlayer()&&e.getPlayer().getSelectedCharacter()||d.emit(f.CREATE_CHARACTER,{world:c},h)}),b.enterKeyOpen=!0,j.getModal("modal_enter_key",i)};return{login:q,logout:r,autoLogin:z,reconnect:A,getPortalData:B,getStartPageType:C,clearAuthData:s,clearAuthDataOnlyCookie:t,getAuthData:u,setAuthData:v,setWorldId:D,setCharacterId:H,setToken:x,getWorldId:F,getCharId:G,setPlayerName:E,enterKey:I}}])}),define("services/BuildingService",["app","helper/time"],function(a,b){a.factory("buildingService",["$rootScope","$filter","windowManagerService","modalSharedBuildingResearchDataService","modalSharedBuildingUpgradeDataService","modelDataService","socketService","routeProvider","eventTypeProvider","buildingQueueService","resourceService","premiumActionService","inventoryItemTypeProvider","inventoryService","buildingLevelScaleService",function(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=300,r={NOT_RESEARCHED:"not-researched",MAXED:"maxed",FARM_LEVEL_TOO_LOW:"farm-level-too-low",WAREHOUSE_LEVEL_TOO_LOW:"warehouse-level-too-low",NOT_ENOUGH_FOOD:"not-enough-food",UNLOCK_PREMIUM_SLOT:"unlock-premium-slot",QUEUE_FULL:"queue-full",NOT_ENOUGH_RESOURCES:"not-enough-resources",POSSIBLE:"possible"},s={},t=function(a,b){s=b},u=function(a,b,c){e.setBuildingName(a.toLowerCase()),e.setResearchName(b),e.setPremium(c),d.getModal("modal_research")},v=function(a){("possible"===a.upgradeability||"possible-premium"===a.upgradeability)&&(f.setBuildingName(a.name.toLowerCase()),d.getModal("modal_upgrade"))},w=function(e){var f,g,h=a.$new(),i="cancel_upgrade",j=k.getQueue(),l=Date.now();for(g=0;g<j.length;g++)if(j[g].id===e){f=b.server2ClientTime(j[g].time_completed);break}setTimeout(function(){h&&h.closeWindow()},f-l),h.title=c("i18n")("title",a.loc.ale,i),h.text=c("i18n")("text",a.loc.ale,i),h.boxText=c("i18n")("boxText",a.loc.ale,i),h.submitText=c("i18n")("submitText",a.loc.ale,i),h.cancelText=c("i18n")("cancelText",a.loc.ale,i),h.switchColors=!0,h.submit=function(){k.cancelJob(e),h.closeWindow()},h.cancel=function(){h.closeWindow()},d.getModal("modal_attention",h)},x=function(a,b,c,d){var e=g.getSelectedVillage(),f=e.getId(),j=n.BUILD_COST_REDUCTION,k=g.getInventory().getItemByType(j);return b?k&&k.amount?void o.useItem(g.getInventory().getItemByType(j),function(){h.emit(i.VILLAGE_UPGRADE_BUILDING,{building:a,village_id:f,location:c,premium:!0},d)},d):void m.upgradeBuilding(a,c,d):void h.emit(i.VILLAGE_UPGRADE_BUILDING,{building:a,village_id:f,location:c,premium:!1})},y=function(a){var b,c,d=g.getSelectedVillage(),e=g.getGameData(),f=d.getBuildingData(),h=f.getDataForBuilding(a);if(h&&(b=e.getBuildingDataForBuilding(a)))return c=h.level+1,c>b.max_level?!1:c},z=function(a){var b,c=g.getSelectedVillage().getBuildingData().getDataForBuilding("wall"),d=g.getGameData().getResearchesData().forBuilding("wall"),e=c.researches,f=1;if("wall"!==a)return f;for(b in e)e[b].active&&(f-=d[b]["function"]);return f},A=function(a,b){var c=g.getGameData().getBuildingDataForBuilding(a),d=z(a),e=g.getGameData().getBuildingDataForBuilding("headquarter"),f=g.getSelectedVillage().getBuildingData().getDataForBuilding("headquarter"),h=f.level,i=g.getWorldConfig().getSpeed(),j=p.getLevelScaleFloat(e["function"],e.function_factor,h),k=c.build_time*Math.pow(c.build_time_factor,b+c.build_time_offset/b);return Array.isArray(c.individual_level_costs)?k=parseInt(k*j*d/i,10):c.individual_level_costs[b]&&(k=parseInt(Math.round(c.individual_level_costs[b].build_time*j),10)),q>k?k:parseInt(Math.round(k/q)*q,10)},B=function(a){var b,c,d=g.getGameData().getBuildingDataForBuilding(a),e=g.getSelectedVillage().getBuildingData().getDataForBuilding(a),f=e.nextCalculatedLevel,h=A(a,f),i=["wood","clay","iron","food","build_time"],j="_factor",k={};return f>d.max_level?!1:!Array.isArray(d.individual_level_costs)&&(k=d.individual_level_costs[f])?k:(i.forEach(function(a){"food"===a?(b=p.getLevelScale(d[a],d[a+j],f-1),c=p.getLevelScale(d[a],d[a+j],f),k[a]=parseInt(Math.round(c-b),10)):"build_time"===a?k[a]=h:k[a]=p.getLevelScale(d[a],d[a+j],f)}),k)},C=function(a){if(!a)return!1;var b,c=.8,d={};for(b in a)d[b]=a[b],"food"!==b&&"build_time"!==b&&(d[b]=parseInt(Math.round(d[b]*c),10));return d},D=function(a,b){var c,d,e=a.upgradingLevels?a.level+a.upgradingLevels:a.level,f=b?a.allPremiumResourcesReachedIn:a.allResourcesReachedIn,g=b?a.nextLevelPremiumCosts:a.nextLevelCosts,h={queueLength:k.getQueueLength(),availableSlots:k.getUnlockedSlots(),maxSlots:k.getMaxSlots()};return a.researched?a.maxLevel<=e?r.MAXED:f===l.STATES.FARM_LEVEL_TOO_LOW?r.FARM_LEVEL_TOO_LOW:f===l.STATES.WAREHOUSE_LEVEL_TOO_LOW?r.WAREHOUSE_LEVEL_TOO_LOW:Math.max(s.food.currentProduction,0)<g.food?r.NOT_ENOUGH_FOOD:s.clay.currentProduction<g.clay||s.iron.currentProduction<g.iron||s.wood.currentProduction<g.wood?r.NOT_ENOUGH_RESOURCES:(c=h.queueLength>=h.availableSlots&&h.queueLength<h.maxSlots,d=h.queueLength>=h.maxSlots,c?r.UNLOCK_PREMIUM_SLOT:d?r.QUEUE_FULL:r.POSSIBLE):r.NOT_RESEARCHED},E=function(a){var b=g.getSelectedVillage().getBuildingData();return b.getPosition(a)},F=function(){var a=g.getSelectedCharacter(),b=g.getSelectedVillage(),c=b.getBuildingData(),d=c.getDataForBuilding("chapel"),e=c.getDataForBuilding("church"),f=k.isBuildingInQueue("church");return a.hasChapel()&&0===d.level||a.hasChapelInQueue()&&0===d.upgradingLevels?!1:e.level>0||f?!1:!0},G=function(){var a=g.getSelectedVillage(),b=a.getBuildingData(),c=b.getDataForBuilding("chapel"),d=k.isBuildingInQueue("chapel");return d||c.level>0?!1:!0},H=function(){var a,b,c,d,e,f=g.getPlayer(),h=f.getSelectedCharacter().getSelectedVillage(),i=[];if(h&&(a=h.getBuildingData(),a&&(b=a.getDataForBuilding("headquarter")))){c=b.level,d=g.getGameData().getBuildings();for(e in d)c>=d[e].required_level&&i.push(e);return i.length&&(G()||i.remove(i.indexOf("church")),F()||i.remove(i.indexOf("chapel"))),i}},I=function(){return{chapel:F(),church:G()}},J=function(a){return-1!==H().indexOf(a)},K=function(){var a,b=d.getScopes(),c=b.length;if(c)for(a=0;c>a;a++)b[a].init&&"function"==typeof b[a].init&&b[a].init()};return a&&(a.$on("DONE",K),a.$on(j.RESOURCES,t)),{UPGRADEABILITY_STATES:r,openResearchModal:u,openUpgradeModal:v,upgradeBuilding:x,openCancelUpgradeModal:w,getPosition:E,getResearchedBuildings:H,isBuildingResearched:J,getNextLevel:y,getPremiumCosts:C,getNextLevelCosts:B,getUpgradeability:D,getGodsHouseTypes:I,getBuildingFactor:z,getBuildTime:A,onComputedResources:t}}])}),define("services/BuildingLevelScaleService",["app"],function(a){a.factory("buildingLevelScaleService",function(){var a=function(a,b,c){return c?parseInt(Math.round(a*Math.pow(b,c-1)),10):0},b=function(a,b,c){return c?a*Math.pow(b,c-1):0},c=function(a,b){var c=a[0],d=a[a.length-1],e={value:null,min:c,max:d};return b>=a.length?e.value=d:0>b?e.value=c:e.value=a[b],e};return{getLevelScale:a,getLevelScaleFloat:b,getLevelScaleLookup:c}})}),define("conf/buildingTypes",[],function(){return{ACADEMY:"academy",BARRACKS:"barracks",CHAPEL:"chapel",CHURCH:"church",CLAY_PIT:"clay_pit",FARM:"farm",HEADQUARTER:"headquarter",HOSPITAL:"hospital",IRON_MINE:"iron_mine",MARKET:"market",PRECEPTORY:"preceptory",RALLY_POINT:"rally_point",STATUE:"statue",TAVERN:"tavern",TIMBER_CAMP:"timber_camp",WALL:"wall",WAREHOUSE:"warehouse",FORTRESS:"fortress"}}),define("services/BuildingTimerService",["app","helper/time","conf/buildingTypes"],function(a,b,c){a.factory("buildingTimerService",["modelDataService","resourceService","buildingService","buildingLevelScaleService",function(a,d,e,f){var g=[],h=[],i=function(a,b){var c,e,f,i=d.resourcesReachedIn(b?a.nextLevelPremiumCosts:a.nextLevelCosts),j=null;if("string"==typeof i)return void(b?a.allPremiumResourcesReachedAt=a.allPremiumResourcesReachedIn=i:a.allResourcesReachedAt=a.allResourcesReachedIn=i);c=b?h:g;for(f in i)(null===j||j<i[f])&&(j=i[f]);e=c[a.name]?(c[a.name]+j)/2:j,b?(a.allPremiumResourcesReachedIn=1e3*e,a.allPremiumResourcesReachedAt=Date.now()+1e3*e):(a.allResourcesReachedIn=1e3*e,a.allResourcesReachedAt=Date.now()+1e3*e),c[a.name]=j},j=function(a){var b,c,d=!1;for(b in a.researches)a.researches.hasOwnProperty(b)&&(c=a.researches[b],d=!0,c.researched=a.level>=c.required_level,c.active=c.researched||c.unlocked);a.hasResearches=d},k=function(b){var d,e,g,h,i,j,k,l,m=a.getSelectedVillage(),n=b,o=a.getGameData().getBuildingDataForBuilding(n.name),p=a.getGameData().getBaseResourceProduction(),q=a.getGameData().getBaseStorageCapacity(),r=m.getSelectedOrder(),s=o.function_factor,t=a.getWorldConfig(),u=t.getSpeed(),v=o["function"],w=!1,x=!0;switch(e={},e.currentValue=f.getLevelScale(o.points,o.points_factor,n.level),e.max=f.getLevelScale(o.points,o.points_factor,n.maxLevel),e.percent=100/(e.max/e.currentValue),n.nextLevel&&(e.nextValue=f.getLevelScale(o.points,o.points_factor,n.nextLevel),e.plus=e.nextValue-e.currentValue,e.nextPercent=100/(e.max/e.nextValue)),g=f.getLevelScaleFloat(v,s,n.level),h=f.getLevelScaleFloat(v,s,n.maxLevel),i=n.nextLevel?f.getLevelScaleFloat(v,s,n.nextLevel):0,d={currentValue:1>g?g:Math.round(g),max:1>h?h:Math.round(h),nextValue:1>i?i:Math.round(i)},n.name){case c.TIMBER_CAMP:case c.IRON_MINE:case c.CLAY_PIT:d.currentValue=(d.currentValue+p)*u,d.max=d.max+p,d.percent=100/(d.max/d.currentValue),n.nextLevel&&(d.nextValue=(d.nextValue+p)*u,d.plus=d.nextValue-d.currentValue,d.nextPercent=100/(d.max/d.nextValue));break;case c.FARM:d.currentValue=Math.floor(g),d.nextValue=Math.floor(i),d.percent=100/(d.max/d.currentValue),n.nextLevel&&(d.plus=d.nextValue-d.currentValue,d.nextPercent=100/(d.max/d.nextValue));break;case c.WALL:w=!0,d.currentValue=5*n.level,d.max=5*n.maxLevel,d.percent=100/(d.max/d.currentValue),d.nextValue=n.nextLevel?5*n.nextLevel:0,n.nextLevel&&(d.plus=d.nextValue-d.currentValue,d.nextPercent=100/(d.max/d.nextValue));break;case c.WAREHOUSE:d.currentValue=d.currentValue+q,d.max=d.max+q,d.percent=100/(d.max/d.currentValue),n.nextLevel&&(d.nextValue=d.nextValue+q,d.plus=d.nextValue-d.currentValue,d.nextPercent=100/(d.max/d.nextValue));break;case c.MARKET:n.level<=11?d.currentValue=n.level:d.currentValue=Math.pow(n.level,2)-20*n.level+110,d.max=Math.pow(n.maxLevel,2)-20*n.maxLevel+110,d.percent=100/(d.max/d.currentValue),n.nextLevel&&(n.nextLevel<=11?d.nextValue=n.nextLevel:d.nextValue=Math.pow(n.nextLevel,2)-20*n.nextLevel+110,d.plus=d.nextValue-d.currentValue,d.nextPercent=100/(d.max/d.nextValue));break;case c.PRECEPTORY:r?(w=!0,d.currentValue=n.level,d.max=n.maxLevel,d.percent=100/(d.max/d.currentValue),d.nextValue=n.nextLevel,b.selectedOrder=r,n.nextLevel&&(d.plus=d.nextValue-d.currentValue,d.nextPercent=100/(d.max/d.nextValue))):x=!1;break;case c.CHURCH:case c.CHAPEL:case c.HOSPITAL:w=n.name===c.CHURCH||n.name===c.CHAPEL,d.percent=100/(d.max/d.currentValue),n.nextLevel&&(d.plus=d.nextValue-d.currentValue,d.nextPercent=100/(d.max/d.nextValue));break;case c.RALLY_POINT:if(t.isRallyPointSpeedBonusEnabled()&&t.getRallyPointSpeedBonusVsBarbarians()){w=!0,j=a.getWorldConfig().getRallyPointSpeedBonusVsBarbarians(),k=f.getLevelScaleLookup(j,n.level),l=f.getLevelScaleLookup(j,n.level+1),d.currentValue=100*k.value,d.max=100*k.max,d.percent=100/((k.max-k.min)/(k.value-k.min)),d.nextValue=100*l.value,n.nextLevel&&(d.plus=d.nextValue-d.currentValue,d.nextPercent=100/((l.max-l.min)/(l.value-l.min))),x=!0;break}x=!1;break;default:x=!1}x&&(d.currentValue=~~d.currentValue,d.nextValue=~~d.nextValue,d.plus=d.nextValue-d.currentValue,d.max=~~d.max,d.percent=~~d.percent,d.nextPercent=~~d.nextPercent,d.isPercentageValue=w,b.specialFunction=d),b.points=e},l=function(){var b,d,f,g,h,l=a.getSelectedVillage().getBuildingData(),m=a.getSelectedCharacter();if(l){f=a.getGameData(),g=l.getData();for(d in g)h=f.getBuildingDataForBuilding(d),h&&(b=g[d],b.name=d,b.maxLevel=h.max_level,"chapel"===d&&m.hasChapelInQueue()?b.maxed=!0:b.upgradingLevels?b.maxed=b.maxLevel<=b.upgradingToLevel:b.maxed=b.maxLevel<=b.level,b.researched=e.isBuildingResearched(d),b.locked=!b.researched&&!b.destroyed,b.nextLevel=e.getNextLevel(d),b.nextLevelCosts=e.getNextLevelCosts(d),b.nextLevelPremiumCosts=e.getPremiumCosts(b.nextLevelCosts),i(b,!1),i(b,!0),b.upgradeability=e.getUpgradeability(b),b.upgradeabilityPremium=e.getUpgradeability(b,!0),k(b),j(b),d===c.FORTRESS&&(b.maxed=!1,b.researched=!1,b.required_level=99,b.featureLocked=!0,b.upgradeability="feature-disable",b.upgradeabilityPremium="feature-disable",b.locked=!0))}},m=function(){b.timer.add(l),b.timer.tick()};return{init:m,processBuildings:l}}])}),define("helper/object",["require","battlecat"],function(a){var b=a("battlecat");return{clone:function(a){return b.deepcopy(a)},math:function(a,b,c){var d,e=!0;switch(b){case"<":for(d in a)e=e&&a[d]<c[d];return e;case">":for(d in a)e=e&&a[d]>c[d];return e;case"===":for(d in a)e=e&&a[d]===c[d];return e;case"+":e={};for(d in a)e[d]=(a[d]||0)+(c[d]||0);return e;case"-":e={};for(d in a)e[d]=(a[d]||0)-(c[d]||0);return e;case"*":e={};for(d in a)e[d]=(a[d]||0)*(c[d]||0);return e;case"/":e={};for(d in a)if(e[d]=(a[d]||0)/(c[d]||0),isNaN(e[d]))throw new Error("invalid operation!");return e}}}}),define("helper/parse",[],function(){var a=function(a){return a?+a.toString().replace(/\D+/g,""):0},b=function(b,c){var d,e,f,g,h=c||[",","|"," "];for(e=0;e<h.length&&(d=b.split(h[e]),!d||2!==d.length);e++);if(d&&2===d.length&&(f=a(d[0]),g=a(d[1]),f&&g))return{x:f,y:g}};return{toValidInteger:a,toCoordinates:b}}),define("services/RecruitingService",["app","helper/object","helper/parse","conf/recruitingQueueTypes"],function(a,b,c,d){a.factory("recruitingService",["$rootScope","eventTypeProvider","modelDataService","socketService","routeProvider","buildingService","preceptoryOrderTypeProvider","buildingLevelScaleService",function(a,e,f,g,h,i,j,k){var l={},m=function(a,b){l=b},n=function(a){var b=f.getSelectedVillage(),c=b.getSelectedOrder(),d=b.getBuildingLevel("preceptory"),e=null;switch(c){case j.TEMPLAR:e=["spear","sword","axe","doppelsoldner","archer"];break;case j.TEUTONIC:e=["light_cavalry","heavy_cavalry","knight","mounted_archer"];break;case j.THIEVES:e=["gold_coin"]}return e&&-1!==e.indexOf(a)?1-d/100:1},o=function(a,b){var c,d,e=f.getGameData().getUnit(b),g=[];for(d in a)c="food"===d?1:n(e.name),"loyalty"!==d&&g.push(a[d].currentProduction/(e[d]*c)|0);return[].min(g)},p=function(a,b){var d=c.toValidInteger(a),e=f.getGameData().getUnit(b),g=n(b);return{wood:Math.round(e.wood*d*g),clay:Math.round(e.clay*d*g),iron:Math.round(e.iron*d*g),food:e.food*d}},q=function(a,b,c){var e;switch(a){case d.BARRACKS:e=h.BARRACKS_CANCEL_RECRUIT_JOB;break;case d.ACADEMY:e=h.ACADEMY_CANCEL_RECRUIT_JOB;break;case d.PRECEPTORY:e=h.PRECEPTORY_CANCEL_RECRUIT_JOB;break;case d.STATUE:e=h.STATUE_CANCEL_RECRUIT_JOB}g.emit(e,{village_id:f.getSelectedVillage().getId(),job_id:b},c)},r=function(a){var b=f.getGameData();return-1!==b.getOffensiveUnitNames().indexOf(a)},s=function(a){var b=f.getGameData();return-1!==b.getDefensiveUnitNames().indexOf(a)},t=function(a){var b,c=f.getGameData(),d=c.getUnits(),e=d.length;for(b=0;e>b;b++)if(d[b].name===a)return d[b].available;return!1},u=function(a,b,c){var e,i=f.getPlayer(),j=i.getSelectedCharacter().getSelectedVillage();switch(a){case d.BARRACKS:e=h.BARRACKS_RECRUIT;break;case d.ACADEMY:e=h.ACADEMY_RECRUIT;break;case d.PRECEPTORY:e=h.PRECEPTORY_RECRUIT;break;case d.STATUE:e=h.STATUE_RECRUIT}g.emit(e,{village_id:j.getId(),unit_type:b,amount:c})},v=function(a,b,c){var d="barracks",e=null,g=0,h=0;return"snob"===b||"doppelsoldner"===b||"trebuchet"===b||"knight"===b?h=1:(e=f.getGameData().getBuildingDataForBuilding(d),g=f.getSelectedVillage().getBuildingData().getDataForBuilding(d).level,h=k.getLevelScaleFloat(e["function"],e.function_factor,g),c&&c.details&&c.details.factor&&(h/=c.details.factor)),f.getGameData().getUnit(b).build_time/f.getWorldConfig().getSpeed()*a*h},w=function(a,b){var c,d,e,f,g,h,i,j=0,k=0,l=[];for(e in a.units)f=a.units[e],g=~~(b[e].in_town/f),f&&l.push(g),j+=f;i=l.min(),h=i+1;for(e in a.units)f=a.units[e],g=~~(b[e].in_town/f),f&&h>g&&(k+=f*h-b[e].in_town);return d=100*(1-k/j),c=d>0||i>0,{useable:c,completed:i,missingUnits:k,total:j,progress:d}},x=function(a){for(var b=0,c=1,d=0;a>b;)b++,d=b*c+d;return d},y=function(a){for(var b=0,c=0,d=a;d>0;)b++,d=a,c=b+c,d-=c;return 0>d?b-1:b},z=function(){var a=f.getSelectedCharacter().getGoldCoins(),b=y(a),c=b+1;return x(c)},A=function(){var a=f.getSelectedCharacter(),b=a.getGoldCoins(),c=a.getVillages().length,d=a.getTotalNobles().all,e=y(b);return e-=c-1,e-=d},B=function(){var a="snob",b=o(l,a),c=A(),d=o({food:l.food},a);return{total:Math.max(0,Math.min(b,c)),byResources:b,byCoinSlots:c,byFood:d}},C=function(a){var b;return b=p(a,"snob"),b.coins=x(a),b},D=function(a,c){var d,e,g,h,i=f.getSelectedVillage().getResources(),j={};if(e=i.getTemporaryBarracksCosts(),!e)return o(l,a);h=p(c,a),d=b.math(e,"-",h);for(g in d)j[g]={currentProduction:l[g].currentProduction-d[g]};return o(j,a)},E=function(a){var d,e,g=f.getGameData().getUnits(),h=g.length,i=0,j={wood:0,clay:0,iron:0,food:0};for(e=0;h>e;e++)d=g[e].name,g[e].available?(a[d]=c.toValidInteger(a[d]),i+=a[d],j=b.math(j,"+",p(a[d],d))):a[d]&&delete a[d];return{temporaryCosts:j,totalRecruits:i,recruits:a}},F=function(a){var b,c=f.getGameData().getCostsPerCoin(),d=a||n("gold_coin"),e={};if(1===d)return c;for(b in c)e[b]=Math.round(c[b]*d);return e};return a&&a.$on(e.RESOURCES,m),{recruit:u,maxBuildableUnits:o,calculateCost:p,calculateTime:v,calculatePreset:w,cancelRecruitJob:q,isUnitAvailable:t,isDefensiveUnit:s,isOffensiveUnit:r,getNobleCosts:C,getNobleCoinCosts:x,getMaxNoblesByGoldCoins:y,getMaxTrainableNobles:B,calculateMaxRecruitable:D,calculateRecruits:E,calculateCoinsNeededForNextNobleLimit:z,getFreeGoldCoinSlots:A,getPreceptoryFactor:n,getCostsPerCoin:F}}])}),define("services/RecruitingTimerService",["app","helper/time"],function(a,b){a.factory("recruitingTimerService",["modelDataService",function(a){var c,d,e,f,g=function(a){var b,c,g,h,i,j,k,l,m,n,o=Date.now();for(k=a.length,n=0;k>n;n++)if(m=a[n],c=m.startedAt,b=m.completedAt,l=Math.min(o,b),m.waiting=!1,c>o)m.waiting=!0;else if(m.clientRecruitingStartTime||(m.clientRecruitingStartTime=m.lastUpdatedAt||l,m.clientRecruitingTime=0,m.lastTotalClientRecruited=0,m.tpu=m.timePerUnit/d*1e3,m.totalRecruited=m.recruited),m.clientRecruitingTime=l-m.clientRecruitingStartTime,i=Math.floor(m.clientRecruitingTime/m.tpu),j=i-m.lastTotalClientRecruited){if(e&&e.recruit_units)for(g=e.recruit_units.length;g--;)h=e.recruit_units[g],h.unit_type===m.unitType&&(h.progress+=j);m.lastTotalClientRecruited=i,m.totalRecruited=m.recruited+m.lastTotalClientRecruited,f.units[m.unitType].in_town+=j,f.units[m.unitType].total+=j}},h=function(){var b,c,d,f,g,h,i,j,k,l,m=["recruit_units","have_units"],n=a.getQuestLineListModel(),o=n?n.getQuestLineModels():[],p=o.length;for(e={},j=0;p>j;j++)if(c=o[j],!c.isFinished())for(d=c.getQuestModels(),b=d.length,k=0;b>k;k++)if(g=d[k],!g.isClosed())for(h=g.getGoals(),f=h.length,l=0;f>l;l++)i=h[l],-1!==m.indexOf(i.type)&&(e.recruit_units=e.recruit_units||[],e.recruit_units.push(i))},i=function(){var b,e;c=a.getSelectedVillage(),f=c.getUnitInfo(),d=a.getWorldConfig().getSpeed(),b=c.getRecruitingQueues(),h();for(e in b)g(b[e].jobs)},j=function(){b.timer.add(i),i()};return{init:j}}])}),define("conf/effectTypes",[],function(){return{FOOD_BOOST:"food_capacity_increase",ATTACK_PROTECTION:"attack_protection",EXTRA_HOSPITAL_BEDS:"extra_hospital_beds",RESOURCE_PRODUCTION_INCREASE:"resource_production_increase",BASE_WALL_LEVELS:"base_wall_levels",LOOT_PROTECTION:"loot_protection",RECRUIT_SPEED_BOOST:"recruit_speed_boost",INCREASED_CARRYING_CAPACITY:"increased_carrying_capacity",FARM_SPEED_INCREASE:"farm_speed_increase",INCREASE_SPY_DEFENSE:"increase_spy_defense",MODIFY_ATTACK_FACTOR:"modify_attack_factor",RESOURCE_DEPOSIT_JOB_DURATION:"resource_deposit_job_duration",FASTER_TRIBE_SUPPORT:"faster_tribe_support",RESOURCE_BOOST_STOCKPILE:"resource_boost_stockpile",STORAGE_CAPACITY_INCREASE:"storage_capacity_increase"}}),define("services/ResourceService",["app","conf/effectTypes"],function(a,b){a.factory("resourceService",["$rootScope","routeProvider","socketService","buildingLevelScaleService","eventTypeProvider","modelDataService","effectService",function(a,c,d,e,f,g,h){var i,j={FARM_LEVEL_TOO_LOW:"FARM_LEVEL_TOO_LOW",WAREHOUSE_LEVEL_TOO_LOW:"WAREHOUSE_LEVEL_TOO_LOW",NOT_ENOUGH_FOOD:"NOT_ENOUGH_FOOD",MAX_LEVEL_REACHED:"MAX_LEVEL_REACHED"},k=function(){var a,b=g.getGameData().getBuildingDataForBuilding("farm"),c=g.getSelectedVillage().getBuildingData(),d=c?c.getDataForBuilding("farm"):null;return b&&d?a=e.getLevelScale(b["function"],b.function_factor,d.level):0},l=function(){var a,c,d,e,f=0;for(a=k(),c=h.getEffects(b.FOOD_BOOST),e=0;e<c.length;e++)d=c[e].details.factor,f+=Math.round(a*(d-1));return a+f},m=function(a){var b,c=0,d=a;for(b in i)(0===d?a<i[b].maxIn:a>i[b].maxIn)&&(a=i[b].maxIn,c=i[b].percent);return{finishedIn:a,percent:c}},n=function(){return m(0)},o=function(){return m(1/0)},p=function(a){var b,c,d=g.getWorldConfig().getSpeed(),e=g.getSelectedVillage(),f=e.getResources(),h=f.getData(),k={};if(!a)return j.MAX_LEVEL_REACHED;if(a.food){if(a.food>l())return j.FARM_LEVEL_TOO_LOW;if(a.food>i.food.currentProduction)return j.NOT_ENOUGH_FOOD}for(b in a)if("food"!==b&&i[b]){if(a[b]>h.maxStorage)return j.WAREHOUSE_LEVEL_TOO_LOW;c=a[b]<=i[b].realCurrentProduction?0:(a[b]-i[b].realCurrentProduction)/(h.productionRates[b]*d)*3600,k[b]=c}return k},q=function(a,b){d.emit(c.VILLAGE_STORAGE_INFO,{village_id:a},b||null)},r=function(a,b){var c=g.getWorldConfig().getSpeed(),d=g.getSelectedVillage(),e=d.getResources(),f=e.getData(),h=void 0!==a?a:f.lastUpdateClient,i=void 0!==b?b:d.getLoyalty();return Math.min(h*c+i,100)},s=function(a,b){i=b},t=function(){var a,c,d,e,f,i=g.getSelectedVillage(),j=0;if(i){for(a=i.getResources().getBaseStorage(),c=h.getEffects(b.STORAGE_CAPACITY_INCREASE),f=0;f<c.length;f++)e=c[f],d=e.details.factor,j+=~~(a*(d-1));g.getSelectedVillage().getResources().setMaxStorage(a+j)}};return a.$on(f.RESOURCES,s),{STATES:j,requestStorageInfo:q,resourcesFullIn:n,firstResourceFullIn:o,resourcesReachedIn:p,getMaxFood:l,getBaseMaxFood:k,computeLoyalty:r,onResources:s,updateMaxStorage:t}}])}),define("services/ResourceTimerService",["app","helper/time"],function(a,b){a.factory("resourceTimerService",["$rootScope","eventTypeProvider","modelDataService","resourceService",function(a,c,d,e){var f,g,h,i,j,k,l=function(a){var c,f,g,h,i,l,m=d.getWorldConfig().getSpeed(),n=e.getMaxFood(),o=e.getBaseMaxFood(),p=a||{},q={},r=Date.now();f=(r-k.lastUpdateClient)/b.inMS.hour,f=Math.max(f,0),q.loyalty=e.computeLoyalty(f,j);for(c in k.resources)if(k.resources.hasOwnProperty(c)){if("food"===c){g=k.resources[c]-(p[c]||0),l=n?g/n*100:0,l=Math.min(100,Math.max(0,~~l)),q[c]={resource:c,currentProduction:g,percent:l,maxFood:n,maxBaseFood:o};continue}g=Math.min(f*k.productionRates[c]*m+k.resources[c],k.maxStorage),g-=p[c]||0,g=Math.max(0,g),g===k.maxStorage?(h=0,i=0,l=100):(h=(k.maxStorage-g)/(k.productionRates[c]*m)*3600,i=r+1e3*h,l=100*(g/k.maxStorage)),q[c]={resource:c,realCurrentProduction:g,currentProduction:Math.floor(g),maxIn:h,maxAt:i,percent:Math.min(100,Math.max(0,~~l)),production:Math.floor(k.productionRates[c]*m)}}return q},m=function(){return(f=d.getSelectedVillage())?(g=f.getId(),i=f.getResources(),k=i.getData(),k.villageId=g,k.lastUpdateClient=b.server2ClientTime(i.getLastUpdate()),j=f.getLoyalty(),h=l(),a&&(a.$broadcast(c.RESOURCES,h),f.setComputedLoyalty(h.loyalty)),{computedResources:h}):null},n=function(){b.timer.add(m),b.timer.tick()};return{init:n,compute:m}}])}),define("conf/effectNames",[],function(){return{extra_hospital_beds:"better_hospital",base_wall_levels:"iron_walls",recruit_speed_boost:"recruit_speed_bonus",increased_carrying_capacity:"loot_bonus",farm_speed_increase:"raid_speed",increase_spy_defense:"better_spy_defense",modify_attack_factor:"attack_bonus",resource_deposit_job_amount:"resource-deposit-increase",resource_deposit_job_duration:"resource-deposit-time-reduction",increase_member_limit:"member_limit",revive_attacker_losses:"medic",faster_tribe_support:"supporter"}}),define("conf/reportTypes",[],function(){return{REPORT_TYPES:{attack:"ReportAttack",characterAchievement:"ReportCharacterAchievement",forward:"ReportForward",invitationReward:"ReportInvitationReward",inviteeJoined:"ReportInviteeJoined",lootMasterUpgrade:"ReportLootMasterUpgrade",paladinItemImproved:"ReportPaladinItemImproved",paladinItemUnlocked:"ReportPaladinItemUnlocked",premiumCurrencyReceived:"ReportPremiumCurrencyReceived",scouting:"ReportScouting",supportAttacked:"ReportSupportAttacked",supportBack:"ReportSupportBack",supportRetracted:"ReportSupportRetracted",supportStart:"ReportSupportStart",tradeAccepted:"ReportTradeAccepted",transportArrived:"ReportTransportArrived",tribeAchievement:"ReportTribeAchievement",tribeApplicationAccepted:"ReportTribeApplicationAccepted",tribeApplicationCreated:"ReportTribeApplicationCreated",tribeApplicationRejected:"ReportTribeApplicationRejected",tribeApplicationReminder:"ReportTribeApplicationReminder",tribeClosed:"ReportTribeClosed",tribeFounderChanged:"ReportTribeFounderChanged",tribeInvitation:"ReportTribeInvitationCreated",tribeInvitationAborted:"ReportTribeInvitationAborted",tribeInvitationAccepted:"ReportTribeInvitationAccepted",tribeInvitationRejected:"ReportTribeInvitationRejected",tribeMemberKicked:"ReportTribeMemberKicked",battlePrevented:"ReportBattlePrevented"},RESULT_TYPES:{OTHER:0,NO_CASUALTIES:1,CASUALTIES:2,DEFEAT:3}}}),define("services/ReportService",["app","angular","conf/effectNames","conf/effectTypes","conf/effectNames","conf/reportTypes"],function(a,b,c,d,e,f){
a.factory("reportService",["$rootScope","$filter","socketService","routeProvider","eventTypeProvider","windowManagerService","armyService","modelDataService","settingsService","effectService",function(a,g,h,i,j,k,l,m,n,o){var p=f.REPORT_TYPES,q=f.RESULT_TYPES,r={BATTLE:"battle",OTHER:"others"},s={1:"nocasualties",2:"casualties",3:"defeat"},t={FULL:"full",PARTIAL:"partial",NONE:"none"},u={attack:"attack",defense:"defense",support:"support",scouting:"scouting"},v={trade:"trade",system:"system",misc:"misc"},w={BATTLE_RESULTS:s,BATTLE_TYPES:u,OTHERS_TYPES:v,MISC:{favourite:"favourite",full_haul:"full_haul",forwarded:"forwarded"}},x=function(a,b,c,d,e,f){var g,j,k=[],l=[];if("battle"===a){for(g in e.BATTLE_TYPES)e.BATTLE_TYPES.hasOwnProperty(g)&&e.BATTLE_TYPES[g]&&k.push(g);for(g in e.MISC)e.MISC.hasOwnProperty(g)&&e.MISC[g]===!0&&l.push(g);for(g in e.BATTLE_RESULTS)if(e.BATTLE_RESULTS.hasOwnProperty(g)&&e.BATTLE_RESULTS[g]===!0)switch(g){case"1":l.push("flawless_victory");break;case"2":l.push("victory");break;case"3":l.push("defeat")}}else{for(g in e.OTHERS_TYPES)e.OTHERS_TYPES.hasOwnProperty(g)&&e.OTHERS_TYPES[g]&&k.push(g);e.MISC.favourite===!0&&l.push("favourite"),e.MISC.forwarded===!0&&l.push("forwarded")}return j={offset:b,count:c,query:d||"",types:k,filters:l},0===k.length?void f():void h.emit(i.REPORT_GET_LIST_REVERSE,j,f)},y=function(a,b){h.emit(i.REPORT_DELETE,{reports:a},b)},z=function(a){h.emit(i.REPORT_TOGGLE_FAVOURITE,{reports:a})},A=function(a){h.emit(i.REPORT_MARK_READ,{reports:a})},B=function(a){h.emit(i.REPORT_MARK_UNREAD,{reports:a})},C=function(a,b){h.emit(i.REPORT_MARK_SEEN,{ids:a},b)},D=function(a,b){var c;if(a=parseInt(a,10),b)for(c=0;c<b.length;c++)if(b[c].id===a)return c;return-1},E=function(a){h.emit(i.REPORT_GET_SETTINGS,{},a)},F=function(a,b){var c,d,e={};for(c in a)if(a.hasOwnProperty(c))for(d in a[c])a[c].hasOwnProperty(d)&&(e[c+"_"+d]=a[c][d]===!0?1:0);h.emit(i.REPORT_SET_SETTINGS,{settings:e},function(a){b(a.message?!1:!0)})},G=function(b,c){var d,e=n.settings.game.deleteReports;return e?void y(b):(d=a.$new(),d.title=g("i18n")("title",a.loc.ale,"delete_reports",b.length),d.text=g("i18n")("description",a.loc.ale,"delete_reports",b.length),d.submitText=g("i18n")("ok",a.loc.ale,"delete_reports",b.length),d.disableModalText=g("i18n")("disable_modal",a.loc.ale,"delete_reports"),d.cancelText=g("i18n")("CANCEL",a.loc.ale),d.disableModal=!1,d.submit=function(){y(b),d.disableModal&&(n.settings.game.deleteReports=d.disableModal,n.saveGameSettings()),d.closeWindow(),c&&c()},d.cancel=function(){d.closeWindow()},void k.getModal("modal_attention",d))},H=function(a,b){if(isNaN(a))throw new Error("<id> should be a number"+a);h.emit(i.REPORT_GET,{id:a},b)},I=function(b,c){var d=a.$new();d.reportData=b,d.noButtons=c,k.getScreenWithInjectedScope("report",d)},J=function(b){var c="screen_report";b.barbarian=!b.defCharacterId,b.barbarian&&(b.defCharacterName=g("i18n")("barbarian_player",a.loc.ale,c))},K=function(b,c,d){if(isNaN(b))throw new Error("<id> should be a number"+b);if(a.$broadcast(j.REPORT_SHOW,{id:b}),!c){var e=a.$new();return e.reportId=b,e.noNavigation=d,k.getScreenWithInjectedScope("report",e),e}},L=function(f,h){var i,j,k,n,p,q,r,s="screen_report_battle",t=m.getWorldConfig().getFarmRule()>0,u=m.getGameData().getLuckRange(),v=m.getTribeSkills();b.extend(f.report,h),f.revivedHospitalUnits=!1,f.type=h.type,j=h[h.type],i=f.report[h.type],f.reportData=i,f.attWon=j.attWon,i.luck=parseFloat(i.luck,10),f.luck=Math.round(100*Math.abs(1-i.luck)),f.luckProgressFactorNegative=100/(100-u[0]),f.luckProgressFactorPositive=100/(u[1]-100),void 0!==j.loyaltyBefore&&null!==j.loyaltyBefore?f.loyaltyBefore=Math.floor(parseFloat(j.loyaltyBefore,10)):delete f.loyaltyBefore,void 0!==j.loyaltyAfter&&null!==j.loyaltyAfter?f.loyaltyAfter=Math.floor(parseFloat(j.loyaltyAfter,10)):delete f.loyaltyAfter,void 0===f.loyaltyBefore?delete f.loyalty:f.loyaltyAfter<f.loyaltyBefore?f.loyalty=g("i18n")("loyalty_loss",a.loc.ale,s,f.loyaltyBefore,f.loyaltyAfter):f.loyaltyAfter>f.loyaltyBefore?f.loyalty=g("i18n")("loyalty_gain",a.loc.ale,s,f.loyaltyBefore,f.loyaltyAfter):f.loyalty=g("i18n")("loyalty_same",a.loc.ale,s,f.loyaltyBefore),f.attModifier=Math.round(100*j.attModifier),f.defModifier=Math.round(100*j.defModifier*(j.wallBonus+1)),f.officersVisible=function(a){var b;for(b in a)if(a[b])return!0;return!1}(j.officers),k=function(a){var b,c={};a.attUnits=a.attUnits||{},a.attLosses=a.attLosses||{},a.attRevived=a.attRevived||{};for(b in a.attUnits)a.attUnits[b]=a.attUnits[b]||0,a.attLosses[b]=a.attLosses[b]||0,a.attRevived[b]=a.attRevived[b]||0,c[b]=a.attUnits[b]-a.attLosses[b]+a.attRevived[b];return{units:c,officers:a.officers}}(j),f.maxLoad=l.calculateArmy(k).load,f.load=j.haul?j.haul.iron+j.haul.wood+j.haul.clay:0,f.attRevivedSum=0,f.attLossesSum=0,f.attAmount=0,f.attUnits={};for(p in i.attUnits)n={},n.amount=i.attUnits[p],f.attAmount+=n.amount,i.attRevived&&(n.revived=i.attRevived[p]||0,n.revived>0&&(f.revivedUnits=!0,f.attRevivedSum+=n.revived)),i.attLosses&&(n.losses=i.attLosses[p]||0,f.attLossesSum+=n.losses),f.attUnits[p]=n;if(f.attEffects=[],j.attEffects)for(r=0;r<j.attEffects.length;r++)q=j.attEffects[r],f.attEffects.push({type:c[q.type],value:o.getEffectValue(q),isTribeSkillEffect:v?v.isEffectFromSkill(q.type):!1}),q.type===d.INCREASED_CARRYING_CAPACITY&&(f.maxLoad+=Math.round(f.maxLoad/100*g("readablePercentFilter")(q.factor)));if(f.defEffects=[],j.defEffects)for(r=0;r<j.defEffects.length;r++)q=j.defEffects[r],f.defEffects.push({type:c[q.type],value:o.getEffectValue(q),isTribeSkillEffect:v?v.isEffectFromSkill(q.type):!1});f.defLossesSum=0,f.defRevivedSum=0,f.defAmount=0,f.defUnits={};for(p in i.defUnits)n={},n.amount=i.defUnits[p],f.defAmount+=n.amount,i.defRevived&&(n.revived=i.defRevived[p]||0,n.revived>0&&(f.revivedHospitalUnits=!0,f.defRevivedSum+=n.revived)),i.defLosses&&(n.losses=i.defLosses[p]||0,f.defLossesSum+=n.losses),f.defUnits[p]=n;for(J(i),f.attHighlight=[],f.attHighlight.push(g("i18n")("mod_belief",a.loc.ale,s,Math.round(100*j.attFaith))),f.attHighlight.push(g("i18n")("mod_morale",a.loc.ale,s,Math.round(100*j.morale))),f.attHighlight.push(g("i18n")(i.luck>=1?"mod_luck":"mod_misfortune",a.loc.ale,s,f.luck)),r=0;r<f.attEffects.length;r++)q=f.attEffects[r],q.type===e.modify_attack_factor&&f.attHighlight.push(g("i18n")(q.type,a.loc.ale,"effect_names")+" "+q.value);0!==Math.round(100*j.leader)&&f.attHighlight.push(g("i18n")("mod_officer",a.loc.ale,s,Math.round(100*j.leader))),f.attHighlight=f.attHighlight.join(", "),f.defHighlight=[],f.defHighlight.push(g("i18n")("mod_belief",a.loc.ale,s,Math.round(100*j.defFaith))),t&&f.defHighlight.push(g("i18n")("mod_farm",a.loc.ale,s,Math.round(100*j.farmRule))),0!==Math.round(100*j.night)&&f.defHighlight.push(g("i18n")("mod_night",a.loc.ale,s,Math.round(100*j.night))),0!==Math.round(100*j.wallBonus)&&f.defHighlight.push(g("i18n")("mod_wall",a.loc.ale,s,Math.round(100*j.wallBonus))),f.defHighlight=f.defHighlight.join(", ")},M=function(a,c){var d,e,f,g,h,i,j=m.getGameData().getBuildings();if(b.extend(a.report,c),a.type=c.type,d=a.report[a.type],d.resources=d.defResources||d.attResources,h=d.defBuildings||d.attBuildings,J(d),h){d.buildings=[];for(i in j)g=j[i],d.buildings.push({name:i,level:h[i],order:g.order});d.buildings.sortByProperty("order")}if(e={home:d.defUnitsVillage||d.attUnitsVillage,away:d.defUnitsAway||d.attUnitsAway},e.home||e.away){e.total={};for(f in e.home)e.total[f]=0,e.home&&(e.total[f]+=e.home[f]),e.away&&(e.total[f]+=e.away[f]);d.units=e}},N=function(a,c){b.extend(a.report,c),a.type=c.type,a.reportData=a.report[a.type],J(a.reportData)},O=function(a,b){h.emit(i.REPORT_GET_BY_TOKEN,{token:a.replace(/_/g,".")},b)};return{requestReportList:x,toggleReportFavorite:z,markReportRead:A,markReportUnread:B,markReportSeen:C,deleteReports:y,deleteReportsModal:G,getReport:H,getReportByToken:O,openReportWithData:I,showReport:K,getIndexOfReport:D,getSettings:E,setSettings:F,extendScopeWithReportData:L,extendScopeWithSpyReportData:M,extendScopeWithBattlePreventedReportData:N,TAB_TYPES:r,BATTLE_TYPES:u,OTHERS_TYPES:v,BATTLE_RESULTS:s,REPORT_FILTERS:w,REPORT_TYPES:p,HAUL_TYPES:t,RESULT_TYPES:q}}])}),define("services/MessagingService",["app"],function(a){a.factory("messagingService",["$rootScope","socketService","modelDataService","routeProvider","windowManagerService",function(a,b,c,d,e){var f=!1,g={LEFT:"left",KICKED:"kicked",NORMAL:"normal"},h=function(a){var e=a?function(){a(c.getSelectedCharacter().getFriendList())}:null;c.getSelectedCharacter().getFriendList()?e&&e():(b.emit(d.FRIENDLIST_GET,{offset:0,count:1e3},e),f=!0)},i=null,j=function(a){return i=i||c.getSelectedCharacter(),i.getFriendList()?i.getFriendList().has(a):(f||h(),!1)},k=function(b){var c=a.$new();c.conversationId=b,e.getScreenWithInjectedScope("message_view",c)},l=function(b,c){var d=a.$new();d.messageRecipients=b?[b]:[],d.attachedMessages=c,e.getScreenWithInjectedScope("message_screen",d)},m=function(a,c){var e=c?"MESSAGE_MARK_READ":"MESSAGE_MARK_UNREAD";b.emit(d[e],{message_ids:a})},n=function(a,c,e,f){b.emit(d.MESSAGE_FORWARD,{to:a,title:c,message:e,message_ids:f})},o=function(a,c,e){b.emit(d.MESSAGE_SEND,{to:a,title:c,message:e})},p=function(a,c){b.emit(d.MESSAGE_REPLY,{message_id:a,message:c})},q=function(a){b.emit(d.FRIENDLIST_ADD,{type:a.type,id:a.id})},r=function(a){b.emit(d.FRIENDLIST_REMOVE,{type:a.type,id:a.id})},s=function(a,c){return b.emit(d.MESSAGE_ADD_PARTICIPANTS,{message_id:c,entities:a}),this},t=function(a,c){return a.forEach(function(a){b.emit(d.MESSAGE_KICK,{message_id:c,character_id:a})}),this},u=function(a){a.map(function(a){a.html=a.content.replace(/\[/g,"<").replace(/\]/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ").replace(/&quot;/g,'"')})};return{STATUSES:g,sendMessage:o,openMessage:k,newMessage:l,markRead:m,forwardMessage:n,reply:p,addFriend:q,isFriend:j,removeFriend:r,getFriendList:h,addContactsToConversation:s,removeContactsFromConversation:t,renderHtml:u}}])}),define("services/StorageService",["app","conf/conf"],function(a,b){a.factory("storageService",[function(){var a={},c={},d=function(){return this.getItem("paginationLimit")||b.DEFAULT_PAGINATION_LIMITS[0]};return a=Modernizr.localstorage?{isLocalStorage:!0,setItem:function(a,b){localStorage.setItem(a,JSON.stringify(b))},getItem:function(a){var b=localStorage.getItem(a);try{return JSON.parse(b)}catch(c){return b}},removeItem:function(a){localStorage.removeItem(a)},getPaginationLimit:d}:{isLocalStorage:!1,setItem:function(a,b,d){d?document.cookie=a+"="+JSON.stringify(b)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT":c[a]=b},getItem:function(a,b){var d;if(b){if(d=document.cookie.match(new RegExp(a+"=(.*);*")),d&&d.length>1)try{return JSON.parse(d[1])}catch(e){return d[1]}throw new Error}return c[a]},removeItem:function(a,b){b&&(document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"),delete c[a]},getPaginationLimit:d}}])}),define("conf/colors",[],function(){return{village:{selected:"#ffffff",player:"#f0c800",tribe:"#8888fc",ally:"#00a0f4",friendly:"#c766c7",enemy:"#ff4b4b",ugly:"#ce8856",barbarian:"#969696",points:"#74c374",invite:"#e0ff4c"},groups:{systemBack:"#ff9c00",borderBack:"#200d00",border:"#673e24"},map:{scouting_buildings:"#8e8e8e",scouting_units:"#8e8e8e",support:"#8baddc",attack:"#ca0000",trade:"#dfd998"},timeline:{incoming_attack:"#f00","mixed-job":"#909090",resource_deposit:"#909090",second_village:"#909090",incoming_support:"#00b8fc",build:"#917739",recruit:"#909090",preview:"#bebebe",scouting:"#b100ff",text:"#FFF3D0",textshadow:"#000",returning_support:"#00b8fc",night_start:"#909090",night_end:"#909090",returning_attack:{"true":"#e7c400","false":"#ffdf00"}},arrow:{shadow:"#000000",shadowGradientStart:"rgba(0, 0, 0, 0)",gradientStart:"rgba(255, 255, 255, 0)",normal:"#dfda98",warning:"#f29024",danger:"#ed5229"},background:{night:"#222",day:"#6f6e1a"}}}),define("helper/asset",[],function(){var a=function(a){return a.iconCountConfig={preset:{all:16},crest:{back:40,fore:40,icon:57},character:{all:0},marker:{back:6},group:{back:10,icon:28,system:19},"default":0},a.iconTypeMapping={"big-crest":"crest"},a.unifyIconType=function(a){return this.iconTypeMapping[a]||a},a.getIconCountInLayer=function(a,b,c){var d;return a=this.unifyIconType(a),d=this.iconCountConfig[a],c?d&&d[b]:void 0===d?this.iconCountConfig["default"]:void 0!==d[b]?d[b]:void 0!==d.all?d.all:this.iconCountConfig["default"]},a}({});return a}),define("conf/icons/crestNoAlpha",[],function(){return{data:{0:{0:{x:870,y:435},1:{x:870,y:290},2:{x:870,y:0},3:{x:0,y:725},4:{x:145,y:290},5:{x:145,y:435},6:{x:145,y:145},7:{x:0,y:145},8:{x:0,y:580},9:{x:145,y:0},10:{x:725,y:435},11:{x:725,y:290},12:{x:725,y:145},13:{x:580,y:0},14:{x:725,y:0},15:{x:580,y:580},16:{x:870,y:145},17:{x:435,y:580},18:{x:290,y:580},19:{x:290,y:435},20:{x:145,y:580},21:{x:0,y:0},22:{x:580,y:435},23:{x:580,y:290},24:{x:580,y:145},25:{x:725,y:725},26:{x:580,y:725},27:{x:435,y:725},28:{x:290,y:725},29:{x:145,y:725},30:{x:725,y:580},31:{x:435,y:435},32:{x:0,y:435},33:{x:435,y:290},34:{x:435,y:145},35:{x:435,y:0},36:{x:0,y:290},37:{x:290,y:290},38:{x:290,y:145},39:{x:290,y:0}}},meta:{image:"/img/icons/crest-icons.jpg",w:145,h:145}}}),define("conf/icons/crestAlpha",[],function(){return{data:{1:{0:{x:870,y:1305},1:{x:725,y:1305},2:{x:870,y:1015},3:{x:580,y:1015},4:{x:1160,y:290},5:{x:1160,y:145},6:{x:290,y:1015},7:{x:145,y:1015},8:{x:1160,y:0},9:{x:1015,y:1015},10:{x:580,y:1305},11:{x:435,y:1305},12:{x:290,y:1305},13:{x:145,y:1305},14:{x:0,y:1305},15:{x:1305,y:1015},16:{x:1305,y:1160},17:{x:1305,y:870},18:{x:1305,y:725},19:{x:1305,y:580},20:{x:1305,y:435},21:{x:1305,y:290},22:{x:1305,y:145},23:{x:1305,y:0},24:{x:725,y:1015},25:{x:1160,y:1160},26:{x:1015,y:1160},27:{x:870,y:1160},28:{x:725,y:1160},29:{x:580,y:1160},30:{x:435,y:1160},31:{x:290,y:1160},32:{x:435,y:1015},33:{x:145,y:1160},34:{x:0,y:1160},35:{x:1160,y:1015},36:{x:1160,y:870},37:{x:1160,y:725},38:{x:1160,y:580},39:{x:1160,y:435}},2:{0:{x:0,y:1015},1:{x:1015,y:870},2:{x:870,y:725},3:{x:290,y:725},4:{x:290,y:580},5:{x:435,y:290},6:{x:145,y:145},7:{x:0,y:145},8:{x:870,y:870},9:{x:145,y:0},10:{x:1015,y:725},11:{x:1015,y:580},12:{x:1015,y:290},13:{x:1015,y:435},14:{x:1015,y:145},15:{x:0,y:0},16:{x:1015,y:0},17:{x:290,y:870},18:{x:145,y:870},19:{x:435,y:870},20:{x:0,y:870},21:{x:870,y:580},22:{x:870,y:145},23:{x:870,y:435},24:{x:870,y:290},25:{x:870,y:0},26:{x:725,y:725},27:{x:580,y:725},28:{x:725,y:870},29:{x:435,y:725},30:{x:145,y:725},31:{x:0,y:725},32:{x:725,y:580},33:{x:725,y:290},34:{x:725,y:145},35:{x:725,y:435},36:{x:725,y:0},37:{x:580,y:870},38:{x:435,y:580},39:{x:580,y:580},40:{x:145,y:580},41:{x:0,y:580},42:{x:580,y:435},43:{x:580,y:290},44:{x:435,y:435},45:{x:580,y:145},46:{x:580,y:0},47:{x:290,y:435},48:{x:145,y:435},49:{x:0,y:435},50:{x:435,y:145},51:{x:435,y:0},52:{x:290,y:290},53:{x:145,y:290},54:{x:0,y:290},55:{x:290,y:0},56:{x:290,y:145}}},meta:{image:"/img/icons/crest-icons.png",w:145,h:145}}}),define("conf/icons/presetNoAlpha",[],function(){return{data:{0:{0:{x:0,y:270},1:{x:270,y:270},2:{x:180,y:90},3:{x:0,y:180},4:{x:270,y:180},5:{x:180,y:180},6:{x:0,y:90},7:{x:90,y:90},8:{x:90,y:0},9:{x:180,y:0},10:{x:180,y:270},11:{x:90,y:270},12:{x:270,y:0},13:{x:270,y:90},14:{x:0,y:0},15:{x:90,y:180}}},meta:{image:"/img/icons/preset-icons.jpg",w:90,h:90}}}),define("conf/icons/presetAlpha",[],function(){return{data:{1:{0:{x:0,y:450},1:{x:90,y:450},2:{x:0,y:360},3:{x:450,y:180},4:{x:90,y:360},5:{x:360,y:270},6:{x:360,y:180},7:{x:270,y:270},8:{x:0,y:0},9:{x:450,y:90},10:{x:270,y:360},11:{x:360,y:360},12:{x:450,y:270},13:{x:450,y:360},14:{x:180,y:360},15:{x:450,y:0}},2:{0:{x:180,y:270},1:{x:90,y:270},2:{x:0,y:180},3:{x:180,y:0},4:{x:270,y:90},5:{x:90,y:90},6:{x:90,y:180},7:{x:360,y:0},8:{x:90,y:0},9:{x:0,y:90},10:{x:360,y:90},11:{x:0,y:270},12:{x:270,y:180},13:{x:180,y:180},14:{x:270,y:0},15:{x:180,y:90}}},meta:{image:"/img/icons/preset-icons.png",w:90,h:90}}}),define("conf/icons/mapAlpha",[],function(){return{data:{0:{0:{x:320,y:80},1:{x:320,y:320},2:{x:240,y:320},3:{x:160,y:320},4:{x:80,y:320},5:{x:320,y:240},6:{x:320,y:160},7:{x:0,y:320}},1:{0:{x:240,y:240},1:{x:320,y:0},2:{x:80,y:240},3:{x:160,y:240},4:{x:0,y:0},5:{x:240,y:160},6:{x:160,y:160},7:{x:240,y:0},8:{x:240,y:80},9:{x:80,y:160}},2:{0:{x:160,y:80},1:{x:0,y:160},2:{x:80,y:80},3:{x:160,y:0},4:{x:0,y:80},5:{x:0,y:240},6:{x:80,y:0}}},meta:{image:"/img/icons/map-icons.png",w:80,h:80}}}),define("conf/icons/markerAlpha",[],function(){return{data:{0:{0:{x:52,y:0},1:{x:26,y:26},2:{x:52,y:26},3:{x:26,y:0},4:{x:0,y:26},5:{x:0,y:0}}},meta:{image:"/img/icons/marker-icons.png",w:26,h:26}}}),define("conf/iconGenerator",["angular","conf/icons/crestNoAlpha","conf/icons/crestAlpha","conf/icons/presetNoAlpha","conf/icons/presetAlpha","conf/icons/mapAlpha","conf/icons/markerAlpha"],function(a,b,c,d,e,f,g){var h={},i={},j=function(a){return h[a].meta.width},k=function(a){return h[a].meta.height},l=function(a,b,c){var d,e,f=[a,b,c].join("_"),g=h[a].sprites,j=g.length;if(i[f])return i[f];for(e=0;j>e;e++)for(d in g[e].data)if(parseInt(d,10)===b)return i[f]=g[e].data[b][c],g[e].data[b][c];return null},m=function(a){return h[a].sprites},n=function(a,b){var c,d,e=h[a].sprites,f=e.length;for(d=0;f>d;d++)for(c in e[d].data)if(parseInt(c,10)===b)return e[d].meta.sprite;return null},o=function(a,b){var c=Array.prototype.slice.call(arguments,1);h[a]={meta:{width:c[0].meta.w,height:c[0].meta.h},sprites:c}};return o("crest",b,c),o("preset",d,e),o("map",f),o("marker",g),{getWidth:j,getHeight:k,getPosition:l,getSpriteData:m,getSprite:n}}),define("services/IconGeneratorService",["app","conf/colors","helper/asset","helper/dataconversion","conf/iconGenerator"],function(a,b,c,d,e){a.factory("iconGeneratorService",["canvasAssetService",function(a){var f=b.groups,g={},h={},i=function(a,b,c){return h[c]?void b(a.getContext("2d"),h[c]):(g[c]||(g[c]=[]),void g[c].push([a,b]))},j=function(a,b){var c;if(h[a]=b||!0,g[a])for(;c=g[a].pop();)i(c[0],c[1],a)},k=function(a,b,c,d){var e;for(a.fillStyle=f.borderBack,a.fillRect(0,0,b*(c+d)+d,c+2*d),a.fillStyle=f.border,a.fillRect(1,1,b*(c+d)+1,c+2*(d-1)),a.fillStyle=f.borderBack,e=0;b>=e;e++)a.fillRect(e*(c+3)+2,2,c+2,c+2)},l=function(a,b,e,g,h){var j,l,m,n,o,p,q,r,s,t,u,v=~~b.getAttribute("data-space-x")||0,w=[16,26,34,90],x=0,y=0,z=0;for(g||(g=w[0]),h||(p=w.indexOf(g),h=w[p>-1?p:0]),p=w.indexOf(h),o=h=w[p],window.angular.isArray(a)||(a=[a]),t=0;p>t;t++)x+=w[t];return b.width=e||o*a.length+v*(a.length-1),b.height=g||h,s=b.getContext("2d"),s.clearRect(0,0,e,g),0===p&&(v=z=y=3,k(s,a.length,h,y)),i(b,function(b,e){for(t=0;t<a.length;t++){for(r=a[t],"string"!=typeof r?(0>r&&(m=!0,r=Math.abs(r)),r=d.icon(null,r,4)):"-"===r[0]&&(m=!0,r=r.slice(1)),m&&(s.fillStyle=f.systemBack,s.fillRect(t*v+y,z,o,h)),u=0;u<r.length;u+=2)(q=parseInt(r.substr(u,2),16))&&(j=0===u?0:c.getIconCountInLayer("group","back"),l=c.getIconCountInLayer("group",0===u?"back":"icon"),m&&2===u&&(l+=c.getIconCountInLayer("group","system")),n=--q%l+j,b.drawImage(e,o*n,x,o,h,t*v+y,z,o,h));y+=o}},"group"),b},m=function(a,b,c,f,g){var h,j,k,m,n,o,p,q=c||document.createElement("canvas"),r=f||~~q.getAttribute("width"),s=g||~~q.getAttribute("height"),t=0,u=0;return"group"===b?l(a,q,r,s):("string"!=typeof a&&(a=d.icon(null,a)),h=e.getWidth(b),j=e.getHeight(b),m={x:r/h||1,y:s/j||1},n=q.getContext("2d"),q.width=r||h,q.height=s||j,n.clearRect(0,0,h,j),n.setTransform(m.x,0,0,m.y,0,0),i(q,function(c){for(p=0;p<a.length;p+=2)(u=parseInt(a.substr(p,2),16))&&(k=e.getSprite(b,t),o=e.getPosition(b,t,--u),c.drawImage(k,o.x,o.y,h,j,0,0,h,j)),t++},b),q)},n=function(b){a.getImage("/img/icons/"+b+"-icons.png",function(a){j(b,a)})};return["crest","map","preset","marker"].forEach(function(b){var c=e.getSpriteData(b);c.forEach(function(c){a.getImage(c.meta.image,function(a){c.meta.sprite=a,j(b)})})}),n("group"),{generate:m}}])}),define("services/IconAnimationsService",["app"],function(a){a.factory("iconAnimationsService",["$rootScope","eventTypeProvider",function(a,b){var c=function(c,d){a.$broadcast(b.ICON_ANIMATION_NEW,{icons:c,opt_animationEndTarget:d})};return{createAnimations:c}}])}),define("conf/unitTypes",[],function(){return{ARCHER:"archer",AXE:"axe",CATAPULT:"catapult",DOPPELSOLDNER:"doppelsoldner",HEAVY_CAVALRY:"heavy_cavalry",KNIGHT:"knight",LIGHT_CAVALRY:"light_cavalry",MOUNTED_ARCHER:"mounted_archer",RAM:"ram",SNOB:"snob",SPEAR:"spear",SWORD:"sword",TREBUCHET:"trebuchet"}}),define("conf/unitCategories",[],function(){return{INFANTRY:"infantry",CAVALRY:"cavalry",SIEGE:"siege",SPECIAL:"special"}}),define("services/ArmyService",["app","conf/unitTypes","conf/unitCategories"],function(a,b,c){a.factory("armyService",["modelDataService","recruitingService",function(a,d){var e,f=200,g=function(a){switch(a){case b.SPEAR:case b.SWORD:case b.AXE:case b.ARCHER:case b.DOPPELSOLDNER:return c.INFANTRY;case b.LIGHT_CAVALRY:case b.HEAVY_CAVALRY:case b.MOUNTED_ARCHER:case b.KNIGHT:return c.CAVALRY;case b.RAM:case b.CATAPULT:case b.TREBUCHET:return c.SIEGE;case b.SNOB:return c.SPECIAL;default:return null}},h=function(a){var b,c,d={};for(b in a)a[b]>0&&(c=g(b),d[c]||(d[c]=!0));return 4-Object.keys(d).length},i=function(){var b=["training_ground","large_ground","military_academy"],c=0,d=0,e=a.getSelectedVillage().getBuildingData().getDataForBuilding("barracks").researches;for(c=0;c<b.length;c++)e[b[c]]&&(e[b[c]].researched||e[b[c]].unlocked)&&(d+=3);return d},j=function(a){var b,c,d;return a.officers?(b=h(a.units),c=i(),d=Math.min(b+c,10),(10-d)/2):0},k=function(a){var b,c,e,f={wood:0,iron:0,clay:0,food:0};for(e in a){b=d.calculateCost(+a[e]||0,e);for(c in b)b.hasOwnProperty(c)&&(f[c]=(f[c]||0)+b[c])}return f},l=function(b,c){var d,e,f,g,h=a.getGameData().getUnitsObject(),i=a.getOfficers().getDataForType("change_movement_speed",b.officers),j=0;if(!Object.keys(b.units).length)return 0;for(f in h)b.units[f]&&(e=h[f].speed,e>j&&(j=e));for(g=0;g<i.length;g++)d=i[g],(c&&d.conditions.target_barbarian||!d.conditions.target_barbarian)&&(d.speed?j=h[d.speed].speed:d.bonus_percentage&&(j/=1+d.bonus_percentage/100));return+(j/a.getWorldConfig().getSpeed()*60).toFixed(2)},m=function(b,c){var e,f,g,h=a.getGameData().getUnits(),i=h.length,m=0,n=0,o=0,p=0,q=0,r=0,s=1;if(b){if(b.units)for(g=0;i>g;g++)e=h[g].name,b.units[e]>0&&(m+=b.units[e]*h[g].load,n+=d.calculateTime(b.units[e],e),o+=b.units[e]*h[g].attack,p+=b.units[e]*h[g].def_arc,q+=b.units[e]*h[g].def_inf,r+=b.units[e]*h[g].def_kav);for(f=a.getOfficers().getDataForType("boost_carrying_capacity",b.officers),g=0;g<f.length;g++)s+=f[g].bonus_percentage/100;return{load:Math.floor(m*s),recruitingTime:n,attack:o,defArc:p,defInf:q,defCav:r,costs:k(b.units),speed:l(b,c),discipline:j(b)}}},n=function(b){var c,d=Date.parse(b),e=a.getWorldConfig(),f=e.getNightClientTimes();return c=d>f.beg&&d<f.end?!0:!1},o=function(b){var c,d,e=[];return a.getGameData().getOfficers().forEach(function(f){for(d=a.getOfficers().getExcludeUnits(f),c=0;c<d.length;c++)if(b.units[d[c]]){e.push(f);break}}),e},p=function(a){e=a},q=function(){return e},r=function(b,c,d,e){var f,g,h;return e&&(h=a.getSelectedVillage().getBuildingResearch("statue","faithful_paladin"),h&&h.active&&(c=Math.max(1,c))),f=parseFloat(b)*parseFloat(c)*100,d&&(g=a.getOfficers().getDataForType("boost_attacking_power",{leader:!0})[0].bonus_percentage,f*=1+g/100),Math.floor(f)},s=function(a,b){return a.units[b]&&a.units[b]>0},t=function(a){return s(a,b.SNOB)||s(a,b.CATAPULT)||s(a,b.RAM)};return{setCurrentPreset:p,getCurrentPreset:q,getUnitCategory:g,calculateDiscipline:j,calculateSpeed:l,calculateArmy:m,calculateCost:k,checkOfficersForArmy:o,getCombatStrength:r,checkNightModeOnArrival:n,hasUnitsOfType:s,hasSlowUnits:t,NIGHT_MODE_DEFENDER_BONUS:f}}])}),define("services/BuildingQueueService",["app"],function(a){a.factory("buildingQueueService",["modelDataService","socketService","routeProvider","premiumService",function(a,b,c,d){var e={},f=function(b){var c=a.getSelectedVillage().getBuildingQueue();d.unlockBuildingQueueSlot(function(){c.addSlot(),"function"==typeof b&&b()})},g=function(){return a.getSelectedVillage().getBuildingQueue()},h=function(d){var e=a.getSelectedVillage();b.emit(c.BUILDING_QUEUE_CANCEL_JOB,{village_id:e.getId(),job_id:d})},i=function(){var b,c=a.getSelectedVillage();return c?(b=c.getBuildingQueue(),b?b.getQueue():[]):[]},j=function(a){var b=i().filter(function(b){return b.id===a});return b.length?b[0]:null},k=function(){var b,c=a.getSelectedVillage();return c?(b=c.getBuildingQueue(),b?b.getQueue().length:0):0},l=function(){var b=a.getSelectedVillage().getBuildingQueue();return b?b.getUnlockedSlots():0},m=function(){var b=a.getSelectedVillage().getBuildingQueue();return b?b.getMaxSlots():0},n=function(a){for(var b=i(),c=b.length;c--;)if(b[c].building===a)return!0;return!1},o=function(){var b=a.getSelectedVillage();return b?b.getBuildingQueue().data:{}},p=function(){var a,b,c=i();for(e={},a=0;a<c.length;a++)b=c[a],e[b.building]||(e[b.building]=b);return e};return{getData:o,addSlot:f,cancelJob:h,getJob:j,getQueue:i,getUnlockedSlots:l,getMaxSlots:m,isBuildingInQueue:n,getQueueLength:k,getNamedBuildingQueue:p,getModel:g}}])}),define("services/BuildingQueueTimerService",["app","helper/time"],function(a,b){a.factory("buildingQueueTimerService",["$rootScope","eventTypeProvider","buildingQueueService",function(a,c,d){var e=function(){var a,c,e=d.getQueue(),f=null!==e?e.length:0,g=!1;if(f)for(c=0;f>c;c++)a=e[c],a&&(a.finishedIn<0?d.getModel().removeJob(a.id):(a.waiting=g,a.duration=a.time_completed-a.time_started,a.timePassed=.001*(Date.now()-b.server2ClientTime(a.time_started)),a.finishedIn=a.duration-a.timePassed,a.finishedAt=b.server2ClientTime(a.time_completed),a.percent=~~(a.timePassed/a.duration*100).bound(0,100),a.timeStarted=b.server2ClientTime(a.time_started),g=!0))},f=function(){b.timer.add(e),a.$on(c.BUILDING_QUEUE,function(){b.timer.tick()})};return{init:f,compute:e}}])}),define("services/CanvasAssetService",["angular","app","conf/conf","cdn","queues/EventQueue"],function(a,b,c,d,e){b.factory("canvasAssetService",["$rootScope","httpService","settingsService","eventTypeProvider","villageAssetRequirementsService","$q","modelDataService",function(b,f,g,h,i,j,k){var l,m,n={tiles:null,imgCache:{}},o="academy",p="wall",q="church",r="chapel",s="bath_house_",t={},u={},v=c.VILLAGE_ASSET_PATH,w="day",x="night",y=w,z=function(a){var b=new Image;return b.src=a,b},A=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAANCAMAAACuAq9NAAAABGdBTUEAALGPC/xhBQAAAFpQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPT09VFRUV1dXfHx8OTk5Ozs7Ly8vKCgoR0dHoKCgMTExnZ2df39/goKC6enpsrKy6urqKysr////AAAAiUtOGwAAAAp0Uk5TSqivFg+6Oy0HACH4bZUAAABiSURBVAjXTcxHAoAgDETRqEiCvSuS3P+aImD5q3mbAXNHRUFhQBDmOdJDwtK5MhiijjMagk7maEhKBpXJW6aAQKzd53WzVjyMFuZpcAuzaBPZV278sW7aLhG/K/RUqFOozAXC+grqG/8vxAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAANCAMAAAB8UqUVAAAABGdBTUEAALGPC/xhBQAAAJxQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgYGAAAAAAAAAAAAFRUVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOTk5fHx8KCgoVFRUV1dXMTExOzs7PT09f39/MjIyLy8vnZ2dgoKCoKCgKysrcnJynJycwMDA29vbsrKy////AAAA8mPLoQAAAB50Uk5Turvx8HlE4ToSTwkNahP6ARqJ/gKlIgQbMgcPLTsA3XQGOgAAAJRJREFUGBkFwbFKA0EUAMB5e2uKpBC0EcJBWov8/y8FxCZi4h379jkTKzBmqNZBA7aR53OODXTwyIg0q/KIBvd95NrammO/o8EYz8vCcnmMgeXUfOf8fIH2/lV/Ry2Y2/UQERFxuO6TXhnZTVvMPGlLzop1fqD8Rn++CtyaUBOZErNEB8j4KUBXIoQ3oFFd3QIAVP0DAn1H79F0nW0AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAOCAMAAAAc7xz/AAAABGdBTUEAALGPC/xhBQAAAKhQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgYGAAAAFRUVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMzMz+Pj4OTk5r6+vfHx8TExMVFRUV1dXKCgoOzs7PT09ampqMTExR0dHLy8vgoKCQkJCoKCgnZ2df39/aWlpQUFB6urq5+fncnJyRUVFnJycwMDA29vbsrKyKysr////AAAAttVFigAAABd0Uk5TxMOMShah/bH6F/4EpTIPiSIbui0HOwCFIDwzAAAArElEQVQY023KBxLCIBBA0dVoimkkS+y99xTJcv+bSYgaZ/QPA+wD6L/ike9H/D3B63SZJ6XH3G/mTsTC3uPRC1nk8DdztCC0C6LCDlsW8po5xmVm5qTKzayMKwet90NKuvR61w6V3tby0+VWOQRdPQmxP57Oon7qBtAx2pJIre2u3OiLbBsdwPoD0XJVLpTpEBIlJNQ2m09GioUaZdLwdDwcNIzyTwgBJj9h8ASnmipwiGV20AAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAPCAMAAADXs89aAAAABGdBTUEAALGPC/xhBQAAAIpQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGhoaJSUlrKysrq6ubGxsn5+fampqm5ub5OTk6urq+/v7oaGho6OjHh4eKysr9/f3mJiYmpqa5eXl+Pj4mZmZnp6e4+Pj+fn5fHx8srKy////AAAA1MULfgAAABJ0Uk5T4+I0QxOJBCm6YTgetw8HLTsAsT7xygAAALVJREFUGNNlz+cOwjAMBGCzR4dT9t60Jfa9/+uRuCBAnGQp99l/QoUlT9oupJ3kTadGOYUl5fzDOQ+PW1HRw2nYuHGSnkyDH9PEOGPnRvjKyDnOiO29ulzKsrxe1wurTGPsvKKq6rre3G7LCup3GNOgtVfF/BFyv5/PM6juaUDd3kQEImqx57TXpX4n7BEViB5bp0+FMxaF94jXobnizbbC67rh0L2PA4kjxoy/cOD4zd9wVjwB46cn5Hi8lw4AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAASCAMAAAB2Mu6sAAAABGdBTUEAALGPC/xhBQAAAGlQTFRFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJSUlWVlZ6enpGhoaZWVlHh4eoaGho6Oj6urqk5OTf39/fHx8Kysr09PTkJCQsrKy////AAAAkDNxwgAAABF0Uk5T4uNDugSJzbcTHjQPByktOwC609NBAAAApklEQVQYV32QxxKDMAxEFXq1nQIEl0TW/39khCkTCJN30u6bvQjUSlNWVdlsEbZe5ES52AzUQk5UMnbj3cV8TIgaWprJ3Ij+6bIlttDCYLzx1HM/GeJghksLRXpFxJsLPZvecHykBSQReY/0BXpPUQJKBtG9F7ogpFqF1q+A1gfBaQaPYjH4I7gkOl+QtXS6YEn7BaIlyy0v1vPvQtAJgsXy9x2iVh/tXiuF9+mZ6wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAUCAMAAADfuh9AAAAABGdBTUEAALGPC/xhBQAAAXpQTFRFAQEBAgICAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvLy8ycnJvb295ubmr6+v0NDQ9PT0EBAQ6enpExMTl5eXGhoasLCwJSUlqampn5+f+vr6oKCgKCgoqKioIyMj2NjYt7e3eXl5MjIya2trHBwcQEBAFhYWT09PjY2NmJiY2dnZ/v7+h4eHrKysp6enlpaW+Pj4/Pz8Kioq4ODgXFxcHh4ecnJyioqK8fHxkJCQ9/f37e3tg4ODnp6evr6+4uLiq6ur3Nzc4+Pj8PDw2trahISEfHx86+vrd3d39vb2Kysr7u7uysrK+fn5z8/PoqKiy8vL29vb7+/v9fX17Ozso6Ojv7+/6urq6OjoqqqqsrKy////AAAATP5h0QAAACt0Uk5T+/kSvOvVuq+ww9hw8EUDZEIxhO3sGgg2xSKGLhQKvRZoSLs0Sh4HDy07AH3+3G8AAAGcSURBVCjPdZLnU8JAEMXP3nuvCAom2HvvXRTsHRERKQGMQSFwt/+7e8lN5IO+D5nZ7G/e7Ltd4kYNS7KhnuL6dpvNZdXSMO8S/pFAqK6tqbJCclm1ZCEyMAbgOYaGxn5FKe+xw4QG/J9sIYOgs5OExw/NVZe6rpTUwNlkaIrpMGghTofp21K9tnxC9cuy2nleKg6nhbiGYC6/6ofWjbP4AqNXi6VwlKHrMOSyEBwmHM8FYG9705eiF5nADSSj7N4cxU2MgAMQftSzB3fBu6v8xZJ2uqsYyIARnIiA2mM0CwVKfrM3EZxgmtjLPmjn31mI5YVi8PmEyOFHDFMRZ/9O8PkaXlOIqGrOkKrCZwKR24fgjcNJMM3Xy7uJUCZEuUsaMh9fmIpgml9EMJRCMiEQ2W0goXfQVqKmC3947mIicYFs4Szh1EyAu0AkAtzFQG4fvIUu5+Nj3AUx4C4Y+tfFeJjpY++zHyLYRxdKI3wBvlnzHgjej72bnIbjoZFCl9EcS6tF3Xa8Kr6j3k74R529Yo19XR3yn+ro6sP2D00A5tKCSpZHAAAAAElFTkSuQmCC"].map(z),B=z("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAMAAABAUVr7AAAABGdBTUEAALGPC/xhBQAAAwBQTFRFAAAAAAAACQcDAQEAn3UCNSsHGRQBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZzsO4M8T9+g1Ymlo4IcX15gH++tR5ccpvbEm0GogoV0aoI4WNEpKjIMW+rRA7t4h0oAPbHZRWmRne184cHp8qKMu8cJgfHQTdVMjlJplWldN8psuxIw5h3tSRzEhuZQLflQiongzYGpq06pO5daS6cZq7vLvWDsMqa2vj5GIWDoNeF0t4NWlRjoOzbkDMy4SjnMUck4Ro5hQsIYbonEXn3MN8atCrV4dy7lwcWg+QjoLTTUZ4KI+u30vzG8gm2kH9uMVRB4J8JsxjD8SXjgHg0ga26cv5s4B0pgq7KMblDwSaFAbyqkFi1gktKZIqFcbQTkvzapYjkQSp4APt6JXu65ibnZ0YDcM3rNW6rdT++w2zt7dQj854NFuUj0eiWIgf4F4ZF0019/kg1oKgVsbTEYqx8zLpoIpbF0AkIVP/u14QicHfmoG4L0AwIsHkmgY9eOJ2sp55JQvv3MjR0kJgTcQ/b1IGxoPNjIgqWwmypY/UyYKPjMEDQsDW0EGLjIuWlUGxp9GRj4Dl4k8q3oHfXNF/et9sKNjj1sWqZxFYG5yvsXEORsEgmQsXUAbwrRse1MRjJ+k5dBhd25CWFxaWVExIxEBekgMY0IOejcPmlIYFw8Dc0kXsVMXgz0TXiwN2n4kSysKmEkVw6QAlWUmMCoDRUpEJCAWOD07doeOOjEAt4k65blcm4IALBYE0NDFh1sSY3iBdmUB+egmFRIIfVQViH1L8dYAiJeaRDEM07AATzIJbDAOw2Ac13YiIxsFt2YcaWI7doKE9N4GjHoDa1YCa36HR0ElNB0FYEshTUAB3bkA4YssnJBXKSchQTwjBgMBOiQIcYSMpIsAfZCW/u1n7MoALRwF6cMAqCjE0wAAACd0Uk5TnnLbffTmyPfto9rgqbmBMlCWRTxh8eaKNBn9IVfM1AQUCgctEQIAn8FM7gAAA5VJREFUOMtjUCMIGDBE5BVVVJRwK1FVlVeUlhCQEVJWxKpEXlFBWllIRJyXiZWNWVgFQ4mqkoKyDKcsh5TU7Q99+6ayiAuryKMoUVWSlBDnmvdiw4dnufnbr0dPWy3KIySpqIpQIq+iLM79bt1am9d9Fev3rb8+re797XNigvwqqjAl8goCsj01f27lLV9l21B/Z//2E//+nQnr+CYroyAPUaKqICJ3d+2te39Pfay4VLKiO3DS3quTIsLfRO6SE1FQBSlRVZGRm/Dn1d//n4rfVC9Y0HDn6t7Nj/bfeTB18s4JcjJAuxjUFJVl7/659//hr/7ZD4ou1/v8eP8oKmb/ox9V/aF/7soCA4hBVVJwz8RXn37dvPg96LLH1qAPW7qvL+169O/f5JsPX03cIyipyqAkIbbt1pQrK0PeLbl0aeHW1suXvdru+P349+DN64d/b20Tk1BiUOH79ifvV2L8puCd61rdP2xxbktZ8ePH+wffP/769P/en298KgzSsl80Ty3++XtTp693i8tW+9OHT6/49+zZa7ePv6b8/9v4RVaaQZljhsablz/vX/jt39nU5PDt9KWFpw+dmT3b6OKVT///ps8QVWbgl5r+a57Wjt+/3/7c0Xv+xc6zH5IO/Vg4M7/q0M2H//+/mi7FD1QSn7jpWvv93z9v3Ni47LyFcVLO4eS5sU/rVn88BVWiLJpw9u39a2d3v/y90fJrs1XJwccpsU8OHnl+/dkVqEXScvMvXHhbe773WoDn7vLnBebHjsx8Ouvo5wVpS998gjhXheHcy5+/l728seNas2vyzAMnCz9/PvD4SdyJA0CbIJ5WEhL9urt22c8LN9q/5nw+WVl5dFbqorg5J2ZlFiy+YgYOOlVpnvkdz86/fbvR8evXg8+djpct2nz0eO7h1JP7lr5uAUeAmqKE3ItVK8++tC4/9/3kXNMnRx4vmnv8yeODZYcXb1gDjkZwYlhTevPM1+9SezOfPn1yYPOR40+zurKvXly1C5oYwElqTY3J8jNLjhl8fv44433h0TnH0i7aVSfAkhQoYcrIvrtbqlf8OjtrTsb650Un/n1fvuFLDyJhgpO3oBgweevqr1zy47O2juH2d7u+iYkrI5I3KJNIC4MyyZcvCfOPXT10+9xtbnEJSSVVlKymqCAJzGpyHOxS36XYxXgZ4QqQc6OikqKktLKwkICAgLA0csbHKBlU5eXlVVFEAIIu4qiat62cAAAAAElFTkSuQmCC"),C=z("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAACVZJREFUeNrsWHlUVOcdvW/ebGzDvgxIAVkEURFccMHghsStxFiXmLRWT62ennoSq0laE+Mxmpi0amqP7dHmqMWYaPScqo0muFfcWVQUEBEQBGdhGGCAWZg3M6+/b5ZTj0nUP/OH75173jDz3ve7c7/7u983cKIo4qdwSPATOV4QefKQchz3vIQVhFBCLGE0IZ0QQpARBEI3oY5QRtAQugj9BNezBmc+lT7jHjkhijCFMD0sPHD4iNEDk9MyYqTxCREIDQuAXCGFvd+Brk4zWls6UF+nc1Reb2rsNPbdome+I5wltBPsTyvEPeV99u3nEdaNGpsc96cNr2BCfgoknAn9diMcggl2oRdOlwCJRAG5NAgyaTARC4cIFS5euI/N64+i/GrjIxpjI+GwVyXxhxT5ISJMpeGEDYWzsqaueW+GfFi2PyyWVlj79RAc/fRaQG+Pk5RwIjxCAYWf1DMQleA4HjJeCX+/aEIcqm71YevH39pPHq86Q3esJzClHM8iwqYiVyaXFn+6fVHS4mXZ6OwsQ1ubHufP6BEYKIVUKsGJI3qEhydD6heKmbMNyBiqIlUkYJHE0cmu1VUm3CzvRG2VDYuXTYNWY8W7b37VLNgdv6Ia1x+fqieJ8ISpfv7yPXsPLo/Nm+QPY3c1Guq78J99AmT2UJTeqcHYl/Kx5Lcf4FG7EZcvliCAP4yFixPBTO/JRg5llzpwtkQHVfAYJA2agCsXv8VL44CBaan49fydGqvFvpRuZAo5nzQrI5Qgk/Fbjp15OzZ9sAWPOirhdLpweH8bInoTIFr02LRxB3LyC6HV6tDfb8W9miuYNsWPSHjUEF0cDux9QL7oweyi1Xh17kJ09ZkhyqVovf83vLEkG2z8mfmfbBEEZxHVfODzjC9HVMxQa96fPWTwUBGthjvkBRcREeEXwKO0rhULN+7BxIKXwQtm6NsacPjgXshc9YiIVpJhAavFhW0f1aKqQoFtnx3H3F8sgNFkwqXrV6F/sAdzFyVAo69F5hAlWB2vgVWP5wNTIzcySvXa8pW5aNKUw+5wwEEkDAY7TN1OrN3xJZRh0dBom2EytKJ4199Reb4EWaNUGJoTBmOHgA3v3EZvVxqKvziDqCg1jD29OF96DhWlH6Ho1Ui3oe2CEw/bbmHFyjyweqyur3M5r0G3f7Zz8YppRUo8bK8l43HUphwO7tZhSMZb8Fep4DS3I0IViN2ffwV9w13YFYEIUbuQlS3DnZv9SE8vwIIFr5MvQsDJFDh/7hTu1xdj3utqyJUStw9E0eOjuJhBKDluwKrlxTup9pv0mZ0pEqRQykYu+GUu9J0PSAmKSTdEKPxdOH3yG/RoqkENjD9v3Y76+pt4bWwKluclgreE4MiBLqSnTiVCI2HoMKBZo8Ge4t3UZVsxZ74avJynaeYIElKEI1C6GTRY8MYYsLqsvi8zwjIy41KkvBkmswVO0eVVRIL8GVEwttegpMSAnr4+JGWYMWtRIo4WN+CtglwUDg2AOioM1bV1kAYEYeKUAly6dAmaphNYsWoIJDIJhR8zMeU8gXmJKWJ3WCCVOEB1U29VNocTByMjEhgTGxJksZlgszvhXnqICM+J4GUc5iyOR2lJu7s9M4apcf9OLywSGd47dAuf/KYQOTnR+PJCFa5dvoKKsnLIZU343WpGgveQED0EXNRRLmLkYt0lOtBn6UNcfFgQEQn0mVUik/MSh1Mgpi6SUISDXZ2e18QI46dFuYn8a2sj7hzrxKC0CYhNSMCH//wG/rQUTk4MQtGCuWisq8HMuUlQ+suovUUi4oHNDRds/f+/OqghKBwlvs5liti6jOZ+pdxf6aDC7GRF2fSws+5WNy6f7IBLwyFFFQpVbABaezoxdHgWrJnD8M5f9mHRmIHoqn+In8+cisP7yrBoGY9ous/JVHBDdCvhFD1XprpSoUSn0Wyj+lafIt0N9Tqtv38EfXkJBEF0ZwhTw2QS8N3XWqRzcRifEAU5DWATZQgNDkV4dAzyJhdgeOEc7Dpbixy1AnG9D6FWxePAbg3KL7fDbHXBYiNYnd4r+9tJUyNBQKAK9+u0Wu/2wU2kS6fprrpRrkVESBRNDy1mgoukdeLUYS0yIzOQFh+JQ7UdSFSH4aGNx5QZ0xGTkAxzbw+aGythUVix9fhtZA+MxOgIF0akZ6P8mkjJa0Rvnx19Vgd6aaE0WwX3ghkRGoqbla3QaburvCuymwiT59SmdUeQEp9Bacq5VWFtxpR5JTuaMiMIhnYDutg3s9jQpWmEzaTD/s8/hTrZiKVkTlkcsOloBUYNGoBweycm501CWSlQcVELs8VBK7cDFoKVGiItdSA2vX+E1T/lre8mwnZQJ/57uqam5oYN6fEDwLwikCpyuQR6PS39gsAaCcnqYPSTrM0tLTi4fy/i0mxIGRpCWcFh2vwkBCbx2Px1KXLigxHe2YxxmZloaVKg5oYONpvdTSZ1UByaanvA6rG6vh2cb61hW7u1b//+oGVE5jTEhYfByYxLnjH2WNHxsBkDI0Oh7SGZ+024WHESAwb3IXNMOBnS5Y5umZLD6AI17GoOxScrkJlEnjK2YkBMAngF757umLhgzMibgHdXHrCwet6639uh+RNWj52Qtn7nFwv56gfXsHvHbUwPToVAO7DqR924192O1JFyxKcEglre/bg7tl3e0KJE7utzoOKcDngkQuYXAIPdhNyiWGRmx2LSiFysWnLAefVi/QZ6eCvB8mMbI7Y9/GP2yKTVR06v4v+x6xB0VwTctZgQn2pDbGIAAlUyDwGXh4A7oLxEfOFlMTvQ1tALM5EakBKEglnDMDFrHOYV/tVZWda0jQbY7DPp07aKwYSllLYfrPt4TsiQ0eGof1AHjcFjOl9x+K6iRwlGwp0X3vflfjwF388wJicL1062YePaf3dTd35IT+whmJ5nz8oOJSGLsG3wkAHjNm6Zj7wpCbjXfBc19feh1dNyYHNAoMRkXmIJxZPb5OSFyOhgZKanYlhqJq6da8G6NYdQW912hcb6A6HK1yXPS8Rn5AjCy4SilLSYl8bnDwobPS5ZkpgagogYJS3vPCS0BLAlwU6BZdTZ0NLQjbIrja7LF+51UlBSA+MYoYTQ8WO/cZ5F5HFCzMgxhLGEAu8uP4EQ4N3rOrzGa/Hu0k8TrhJ03vddz/qBxb34b8ALIs84/ifAAFg+cF+zinKkAAAAAElFTkSuQmCC"),D="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RkYzRDZBOTEyNjg2MTFFMzg4QzJDMjAzOEY2NTE5REMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RkYzRDZBOTIyNjg2MTFFMzg4QzJDMjAzOEY2NTE5REMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpGRjNENkE4RjI2ODYxMUUzODhDMkMyMDM4RjY1MTlEQyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpGRjNENkE5MDI2ODYxMUUzODhDMkMyMDM4RjY1MTlEQyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Ps7H4DgAAAAGUExURf8AsQAAAORtO/wAAAEcSURBVHja7JfhCsMwCIS993/pMWhLPE1zmjIYNL/WjHy1xrsYwzHsGNVnewG/B2ATgGvGeGigE9L9FNsE2CMA+NGIIGalCbBuEj2hXA+uKr6/5IVEufZDAIy7Z+PfCmD4bHQALm9gJawBMM+ByzyW2UeUASggBeAmwOvbgLwu5/pPhSRU4vkydAGxiNrmWgUkMVrB3jGPWQG4tyr1QhPg7b2PYCrfvhv7hSvxzQBkQnyw3QEG6fcBYAC2ASjmIC5gY14DogCnGvGl74vZIDceudNonQtpNn0QzDchoAIAy0ZuvsBusQGoHbrTAqsB6BRbel9WiY8ADLsASzdENNPMPhuAvIEU7TwKs3rhaN9gYhu5eRV6r39/CfgIMACTTgduvo6nGgAAAABJRU5ErkJggg==",E=function(a,b,c,e){
var f=new Image;return f.onload=function(){n.imgCache[a]=f,c&&c(f)},f.onerror=function(a){e&&e(a)},f.src=d.getPath(a),b&&(f.width=b.width,f.height=b.height),f},F=function(b,c){var d;if(a.isDefined(b.x)&&a.isDefined(b.y)&&a.isDefined(b.w)&&a.isDefined(b.h))return c(b);if(!a.isString(b)){if(a.isArray(b))for(d=b.length;d--;)b[d]=F(b[d],c);else for(d in b)b[d]=F(b[d],c);return b}},G=function(b,c){var d,f=function(b){n.tiles=F(a.copy(l,{}),function(a){var b,c,e,f=document.createElement("canvas");return f.width=a.w,f.height=a.h,b=f.getContext("2d"),c=Math.min(a.w,d.width),e=Math.min(a.h,d.height),b.clearRect(0,0,a.w,a.h),b.drawImage(d,a.x.bound(0,d.width-c),a.y.bound(0,d.height-e),c,e,0,0,a.w,a.h),f}),c(n.tiles,l),e.trigger(e.types.SPRITES_READY)},g=function(a){a.target.src=D,a.target.width=a.target.height=64,f()};d=E("/img/"+l.img,null,f,g)},H=function(a,b,d){if(!n.tiles||d){if(!b)throw new Error("Image not cached & no callback specified!");l&&!d?G(a,b):f.get(c.MAP_TILES_JSON_PATH.join(a),function(c){l=c,G(a,b)})}else b&&(n.tiles.icons=A,n.tiles.resourceDepositIcon=B,n.tiles.secondVillageIcon=C,b(n.tiles,l));return n.tiles&&(n.tiles.icons=A,n.tiles.resourceDepositIcon=B,n.tiles.secondVillageIcon=C),n.tiles||!1},I=function(a,b,d,e){var h,l,m,n,o=[],p=0,q=k.getSelectedVillage().getBuildingData().data,r=k.getSelectedVillage().getRecruitingQueue(),s=j.defer(),v={list:o,animationResult:b};for(h in t)n=t[h],m=a[n.base],(!n.set||!c.RANDOM_ANIMATION_SETS||n.set&&n.set===d)&&n.priority<=g.settings.duration.animationLevel&&i.checkAnimationRequirements(n,q,r,e)&&o.push({path:h,data:t[h]});return l=o.filter(function(a){return u[a.path]?!1:(p++,!0)}),l.length?c.DEV?l.forEach(function(a){f.get(c.DEV_ANIMATION_JSON_PATH.join(a.path),function(b){u[a.path]=b,--p||s.resolve(v)})}):f.get(c.PROD_ANIMATION_JSON_PATH,function(a){u=a,s.resolve(v)}):s.resolve(v),s.promise},J=function(a,b){var c,d,e=a.length,f=e,g=j.defer(),h=function(){--f||g.resolve()};for(n.animations={};e--;)d=u[a[e].path],c=d.meta.name,b[c]=n.animations[c]=d,d.meta.base=i.parseAnimationRequirements(a[e].data.base).building,n.animations[c].image=E("/img/village/animations/"+n.animations[c].meta.image,n.animations[c].meta,h);return g.promise},K=function(a,c,d,e,f,j){var l,t,u,w,x=[],y={},z=k.getWorldConfig().isBathHouseEnabled(),A=0,B=i.getBuildingAssetLevels(c,d,a),C=function(){--A||(x=x.sort(function(a,b){return b.data.z-a.data.z}),b.$broadcast("DONE"),j(x,y))},F=function(a){a.target.src=D,a.target.width=a.target.height=64,C()};for(l in B)for(t=!z||l!==r&&l!==q?l:s+l,m.buildings[t]&&m.buildings[t][B[l].level]?x=x.concat(m.buildings[t][B[l].level]):"market"!==l||B[l].level>0,w=B[l].researches,u=w.length;u--;)m.researches[w[u]]&&(x=x.concat(m.researches[w[u]]));x=x.map(function(a){return m._files[a]}).filter(function(a){return B[a.name]?a.is_always?!0:a.name===r?B[q].exists||B[q].underConstruction?!1:B[r].exists?!a.is_build_place:B[r].underConstruction?a.is_build_place:!B[q].researched&&B[r].researched:B[a.name].exists||a.level?B[a.name].underConstruction?a.is_construction_site:!a.is_construction_site:a.name===o?B[p].exists?a.wall_level===B[p].level&&!B[o].researched==!a.is_build_place:!B[o].researched==!a.is_build_place&&void 0===a.wall_level:a.name===q?!B[r].exists&&!B[q].researched==!a.is_build_place&&!B[r].underConstruction:a.name===p?!B[p].exists&&(!a.is_construction_site||B[p].researched):!B[a.name].researched==!a.is_build_place:!0}).map(function(b){var c,d;return c=v+a+"/"+b.filename,(d=n.imgCache[c])||(d=E(c,b,C,F),A++),{img:d,data:b||{}}}),g.settings.game.animations&&(A++,I(B,y,e,a).then(function(a){return J(a.list,a.animationResult)}).then(C)),A?f||b.$broadcast(h.MAP_LOADING_ASSETS):j(x)},L=function(a,b){return b&&n.imgCache[a]&&b(n.imgCache[a]),n.imgCache[a]||E(a,null,b)},M=function(a){for(var b={},c=a.length;c--;)b[a[c]]=L(a[c]);return b},N=function(a,b){if(a!==w&&a!==x)throw new Error;!g.settings.game.nightModeGraphics,y=g.settings.game.nightModeGraphics?a:w,H(a,b,!0)};return n.getTileset=H,n.getVillageAssets=K,n.getImage=L,n.getImages=M,n.setTimeOfDay=N,f.get(c.VILLAGE_ASSETS_JSON_PATH.join(y),function(a){m=a}),f.get(c.ANIMATION_LIST_PATH,function(a){t=a}),n}])}),define("services/ContextMenuService",["angular","app","queues/EventQueue"],function(a,b,c){b.factory("contextMenuService",["$rootScope","eventTypeProvider",function(a,b){var c,d=!1,e="possible",f=function(e){a.$broadcast(b.DESTROY_CONTEXT_MENU,e),d=!1,c=null},g=function(e,f){a.$broadcast(b.SHOW_CONTEXT_MENU,e,f),d=!0,c=e},h=function(e){a.$broadcast(b.SHOW_CONTEXT_MENU,e),d=!0,c=e},i=function(a,b,c,d,e,f){var g,h=!1;for(g=0;g<d.length;g++)d[g].getId()===b.id&&(h=!0);switch(a){case"spies":if(f||c||0===e.tavern.level)return!1;break;case"presets":if(h&&c)return!1;break;case"resources":if(h&&!c)return!0;if(c||0===e.market.level||e.market.researches.delivery.researched===!1&&e.market.researches.delivery.unlocked===!1)return!1;break;case"messages":for(g=0;g<d.length;g++)if(d[g].getId()===b.id)return!1;break;case"activate":if(c)return!1;if(h===!1)return!1;break;case"custom-army":if(c)return!1;break;case"boost":return b.data.barbarianVillage;default:return!0}return!0},j=function(a,b,c,d,f,g){switch(a){case"premiumlevelup-inactive":return g&&c.level||(f[c.name]||c.level)&&c.upgradeabilityPremium!==e;case"levelup-inactive":return(f[c.name]||c.level)&&c.upgradeability!==e;case"premiumlevelup":return!g&&(f[c.name]||c.level)&&c.upgradeabilityPremium===e;case"levelup":return(f[c.name]||c.level)&&c.upgradeability===e;case"levelup-construct-inactive":return!c.level&&c.upgradeability!==e&&!f[c.name];case"premiumlevelup-construct-inactive":return!c.level&&(g||c.upgradeabilityPremium!==e&&!f[c.name]);case"premiumlevelup-construct":return!g&&!c.level&&c.upgradeabilityPremium===e&&!f[c.name];case"levelup-construct":return!c.level&&c.upgradeability===e&&!f[c.name];case"reducetime":if(!b||d[0].building!==c.name)return!1;break;case"reducetime-inactive":return f[c.name]&&f[c.name].waiting;default:return!0}return!0},k=function(){return{isOpen:d,target:c}};return{showVillageMenu:g,showMapMenu:h,destroy:f,getMapViewSubMenuState:i,getVillageViewSubMenuState:j,getMapMenuData:k}}])}),define("services/CommandService",["app"],function(a){a.factory("commandService",["$rootScope","$filter","socketService","modelDataService","windowManagerService","routeProvider",function(a,b,c,d,e,f){var g=function(a){c.emit(a.isSpy?f.SCOUTING_CANCEL_COMMAND:f.COMMAND_CANCEL,{command_id:a.id})},h=function(a){c.emit(f.TRADING_CANCEL_TRANSPORT,{transport_id:a.id})},i=function(a){if(a){if(!a.isCommand)return"trading_transport"===a.type&&a.cancelTime()>0;var b,c,e=d.getGameData(),f=e.getResearchesData().forBuilding("rally_point").war_planner["function"],g=1e3*e.getBaseData().cancel_command_duration;return void 0!==a.warPlanner?b=a.warPlanner:(b=d.getSelectedVillage().getBuildingResearch("rally_point","war_planner"),b=b&&b.active),c=b?f:1,!a.returning&&a.startedAt>Date.now()-g*c}},j=function(c){if(c&&i(c)){var d=a.$new(),f=c.isCommand?"cancel_command":"building_market_cancel_transport";d.title=b("i18n")("title",a.loc.ale,f),d.text=b("i18n")("text",a.loc.ale,f),d.submitText=b("i18n")("submitText",a.loc.ale,f),d.cancelText=b("i18n")("cancelText",a.loc.ale,f),d.switchColors=!0,d.submit=function(){c.isCommand?g(c):h(c),d.closeWindow()},d.cancel=function(){d.closeWindow()},e.getModal("modal_attention",d)}};return{isCancelable:i,openCancelCommandModal:j}}])}),define("services/BuildingLabelService",["app","angular"],function(a,b){a.factory("buildingLabelService",["$rootScope","modelDataService","buildingQueueService","templateManagerService","settingsService","eventTypeProvider",function(a,c,d,e,f,g){var h,i="#building-label-wrapper",j=f.settings.game.levelIndicator,k=function(){return b.element($(i)[0]).scope()||{}},l=function(){return $(i).length?h:(e.compile("buildinglabel",a.$new(),function(a){$("body").append(a)}),h)},m=function(){var a;return $(i).length?((a=k()).$destroy&&a.$destroy(),$(i).remove(),h):h},n=function(a){var b,e,f=c.getGameData().getBuildings(),g=c.getSelectedVillage().getBuildingData(),h=d.getNamedBuildingQueue();a.levelIndicator=j;for(b in f)a[b]=a[b]||{},e=g.getDataForBuilding(b),j||!e.level&&!h[b]||h[b]?(a[b].level=e.level,a[b].upgrading=e.upgradingLevels):a[b].level=a[b].upgrading=null,h[b]?h[b].waiting?(a[b].progress=0,a[b].waiting=!0,a[b].finishedIn=null):(a[b].progress=h[b].percent,a[b].finishedIn=h[b].finishedIn,a[b].waiting=null):a[b].progress=null},o=function(){j=f.settings.game.levelIndicator};return a.$on(g.GAME_SETTINGS_CHANGED,o),h={getLabelData:n,show:l,hide:m}}])}),define("services/TimelineService",["app","helper/time","conf/icons","conf/colors"],function(a,b,c,d){a.factory("timelineService",["$rootScope","$filter","timelineDataProvider","routeProvider","modelDataService","socketService",function(a,e,f,g,h,i){var j="timeline",k="#ff00ff",l=d.timeline,m=function(a,b){for(var c=a.length,d=0;c--;)a[c].type===b&&d++;return d},n=function z(b){var c,d,g;if(b instanceof Array){if(b.length<f.MAX_LENGTH){for(c=b.length,d=[];c--;)d=d.concat(z(b[c]));return d}return g=[f.INCOMING_ATTACK,f.INCOMING_SUPPORT,f.RETURNING_ATTACK,f.RETURNING_SUPPORT].map(function(c){var d=m(b,c);return d?e("i18n")(c,a.loc.ale,j,d):null}).filter(function(a){return a}),[{title:g.join(", "),time:e("readableDateFilter")(b[0].time,a.loc.ale)+" - "+e("readableDateFilter")(b[b.length-1].time,a.loc.ale)}]}if(d={time:e("readableDateFilter")(b.time,a.loc.ale)},b.details)switch(b.type){case f.BUILD:d.title=e("i18n")(b.building_type,a.loc.ale,"building_names"),d.icon="rte-building";break;case f.RECRUIT:d.title=e("i18n")(b.unit_type,a.loc.ale,"unit_names")+" ("+b.details.amount+")",d.icon="rte-unit";break;case f.INCOMING_ATTACK:case f.SCOUTING:case f.RETURNING_ATTACK:case f.RETURNING_SUPPORT:d.title=(b.details.origin_name||b.details.village_name)+" ("+(b.details.origin_owner_name||b.details.village_owner_name)+")",d.icon=b.type===f.INCOMING_ATTACK?"attack-red":"info",b.details.units&&(d.units=function(a){var b,c=[];for(b in a)a[b]&&c.push({name:b,count:a[b]});return c}(b.details.units),d.haul=b.details.haul);break;case f.INCOMING_SUPPORT:d.icon="support",d.title=b.details.village_name+" ("+b.details.village_owner_name+")";break;case f.RESOURCE_DEPOSIT:d.title=e("i18n")("title",a.loc.ale,"screen_resource_deposit")+" - "+e("i18n")("current_production",a.loc.ale,"screen_resource_deposit")+" ("+b.details.amount+" "+e("i18n")(b.details.type,a.loc.ale,"resource_names")+")";break;case f.SECOND_VILLAGE:d.title=e("i18n")("title",a.loc.ale,"screen_second_village")+" - "+e("i18n")(b.id,a.loc.ale,"screen_second_village");break;case f.NIGHT_START:d.title=e("i18n")("night_mode_start",a.loc.ale,"timeline");break;case f.NIGHT_END:d.title=e("i18n")("night_mode_end",a.loc.ale,"timeline")}return[d]},o=function A(a,b){var c;a instanceof Array?a.forEach(function(d){d.requestSent||(c++,A(d,function(){--c||b(a)}))}):a.requestSent||(a.requestSent=!0,i.emit(g.TIMELINE_GET_DETAILS,{event_type:a.type,event_id:a.id,village_id:h.getSelectedVillage().getId()},function(c){a.details=c,b(a)}))},p=function(a){return a.type===f.BUILD||a.type===f.RECRUIT||a.type===f.PREVIEW||a.type===f.MIXED_JOB?f.JOB:f.COMMAND},q=function(a,d){var e,f;if(e=a-d,0>e)return 0;if(e>b.inMS.threeDay)return 1/0;if(e.between(0,b.inMS.hour)?f=e/b.inMS.fiveMin:e.between(b.inMS.hour,b.inMS.sixHour)?f=e/b.inMS.hour+11:e.between(b.inMS.sixHour,b.inMS.day)?f=e/(b.inMS.sixHour/2)+15:e.between(b.inMS.day,b.inMS.threeDay)&&(f=e/b.inMS.day+22),isNaN(f))throw new TypeError;return(f*c.timeline.segmentWidth|0)+c.timeline.zeroOffset},r=function(a,b){var c,d,e,g,h,i,j,k=a.length,l=Date.now(),m=[];for(a.length&&m.push(a[0]),c=1;k>c;c++)if(i=a[c-1],j=a[c],j.type!==f.PREVIEW&&i.type!==f.PREVIEW)if(d=Math.abs(q(i.time,l)-q(j.time,l)),b>=d){if(e=m[m.length-1],e instanceof Array?e.push(a[c]):e=[m.pop(),a[c]],g=e.length-2,h=e.length-1,e[g].type===e[h].type)switch(e.type=e[h].type,e.type){case f.BUILD:e.building_type=e[g].building_type===e[h].building_type?e[h].building_type:f.MIXED;break;case f.RECRUIT:e.unit_type=e[g].unit_type===e[h].unit_type?e[h].unit_type:f.MIXED;break;case f.RETURNING_ATTACK:e.haul=e[g].haul===e[h].haul?e[h].haul:f.MIXED,e.losses=e[g].losses===e[h].losses?e[h].losses:!0}else switch(p(e[h])){case f.COMMAND:switch(e[h].type){case f.SCOUTING:case f.RETURNING_ATTACK:case f.RETURNING_SUPPORT:case f.RESOURCE_DEPOSIT:case f.RESOURCE_SECOND_VILLAGE:e.type=f.INCOMING_MIXED;break;default:e.type=f.INCOMING_UNITS}break;case f.JOB:e.type=f.MIXED_JOB}e.details=e[g].details&&e[h].details,m.push(e)}else m.push(a[c]);return m},s=function(a,b){var c={},d=h.getWorldConfig().isBathHouseEnabled();return c[f.INCOMING_SUPPORT]=[2*a,2*b],c[f.INCOMING_ATTACK]=[3*a,2*b],c[f.INCOMING_UNITS]=[0,2*b],c[f.INCOMING_MIXED]=[8*a,2*b],c[f.RESOURCE_DEPOSIT]=[11*a,2*b],c[f.SECOND_VILLAGE]=[7*a,2*b],c[f.MIXED_JOB]=[a,2*b],c[f.RETURNING_SUPPORT]=[12*a,2*b],c[f.NIGHT_START]=[10*a,2*b],c[f.NIGHT_END]=[10*a,2*b],c[f.RETURNING_ATTACK]={full:[4*a,2*b],partial:[5*a,2*b],mixed:[6*a,2*b]},c[f.RECRUIT]={heavy_cavalry:[0,b],light_cavalry:[a,b],mounted_archer:[2*a,b],ram:[3*a,b],trebuchet:[4*a,b],catapult:[5*a,b],spy:[6*a,b],snob:[7*a,b],axe:[8*a,b],doppelsoldner:[9*a,b],knight:[10*a,b],spear:[11*a,b],sword:[12*a,b],archer:[13*a,b],mixed:[14*a,b]},c[f.BUILD]={rally_point:[a,0],statue:[2*a,0],academy:[3*a,0],iron_mine:[4*a,0],warehouse:[5*a,0],tavern:[6*a,0],wall:[7*a,0],clay_pit:[8*a,0],barracks:[9*a,0],church:d?[9*a,2*b]:[15*a,b],chapel:d?[10*a,2*b]:[10*a,0],headquarter:[11*a,0],timber_camp:[12*a,0],hospital:[13*a,0],market:[14*a,0],farm:[15*a,0],preceptory:[16*a,0],mixed:[17*a,0],fortress:[16*a,b]},c[f.SCOUTING]=[9*a,2*b],c},t=function(a){return a.type===f.INCOMING_ATTACK},u=function(a){return a.type===f.INCOMING_SUPPORT||a.type===f.RETURNING_SUPPORT},v=function(a){return(a.type===f.RETURNING_ATTACK||a.type===f.RETURNING_SUPPORT)&&a.losses},w=function(a){return!a.losses},x=function(a){return a.type===f.SCOUTING},y=function(a){return a.type===f.RETURNING_ATTACK?l[a.type][a.losses]:a.type===f.INCOMING_MIXED||a.type===f.INCOMING_UNITS?a.some(t)?l.incoming_attack:a.some(u)?l.incoming_support:a.some(v)?l.returning_attack["true"]:a.every(w)&&a.some(x)?l.scouting:l.returning_attack["false"]:"string"!=typeof l[a.type]?k:l[a.type]};return{getTooltipDataForEvent:n,getDetailedEventInformation:o,getPixelPosition:q,getStrokeStyle:y,aggregateEvents:r,getSpriteCoords:s,getEventCategory:p}}])}),define("services/AutoCompleteService",["app","conf/conf","struct/MapData"],function(a,b,c){a.factory("autoCompleteService",["$rootScope","$filter","modelDataService","socketService","routeProvider","eventTypeProvider",function(a,d,e,f,g,h){var i,j,k=[],l=function(){var b,c=e.getGameData().getUnits(),f=e.getGameData().getBuildings();i=c.map(function(b){return{key:b.name,name:d("i18n")(b.name,a.loc.ale,"unit_names")}});for(b in f)k.push({key:b,name:d("i18n")(b,a.loc.ale,"building_names")});j=!0},m=function(){j||l()},n=function(a){return!isNaN(parseInt(a.x,10))&&!isNaN(parseInt(a.y,10))},o=function(a,b,c){c=c.filter(function(a){return a.id?b?b(a):!0:!1}),c=c.map(function(b){return b.type=a,b})},p=function(a,b){return a.filter(function(a){var c=a.name.toLowerCase().match(b.toLowerCase());return c&&c.length})},q=function(a,b){m(),b({result:p(i,a)})},r=function(a,b){m(),b({result:p(k,a)})},s=function(a,c,d,e){m(),f.emit(g.AUTOCOMPLETE,{types:a,string:c,amount:e||b.AUTOCOMPLETE_AMOUNT},function(a){var b,c,e={result:[]};for(c in a.result)"village"===c&&(b=n),o(c,b,a.result[c]),e.result=e.result.concat(a.result[c]);d(e)})},t=function(a,b,c){s(["village"],a,b,c)},u=function(a,b,c){s(["character"],a,b,c)},v=function(a,b,c){s(["tribe"],a,b,c)},w=function(a,c,d){m(),f.emit(g.REPORT_GET_LIST_REVERSE,{offset:0,count:d||b.AUTOCOMPLETE_AMOUNT,types:["attack","defense","support","scouting"],query:a},function(a){c({result:a.reports})})},x=function(a,c,d){m(),f.emit(g.MESSAGE_GET_LIST,{offset:0,count:d||b.AUTOCOMPLETE_AMOUNT,folder:"all",search:a},function(a){c({result:a.messages})})},y=function(a,b){m(),c.loadTownDataAsync(a.x,a.y,1,1,function(a){a=a||{villages:[]},b(a)})};return{villageByCoordinates:y,unit:q,building:r,village:t,character:u,mixed:s,report:w,message:x,tribe:v}}])}),define("services/TradingService",["app"],function(a){a.factory("tradingService",["modelDataService","routeProvider","socketService",function(a,b,c){var d=function(d,e,f,g,h){var i=a.getSelectedVillage().getId(),j=h||{},k={village_id:i,ordered_by:d,order:e,offset:f,count:g,filters:{offered_resource:j.offeredResource||null,requested_resource:j.requestedResource||null,ratio:j.ratio||null,own_tribe:j.ownTribe||null,max_delivery_time:j.maxDeliveryTime||null,own_character:!!j.ownOffers}};c.emit(b.TRADING_LIST_OFFERS,k,j.callback||null)},e=function(d,e,f,g,h,i,j){var k=a.getSelectedVillage().getId(),l={village_id:k,offered_type:d,offered_amount:e,requested_type:f,requested_amount:g,offer_amount:h,max_delivery_time:i};c.emit(b.TRADING_CREATE_OFFER,l,j)},f=function(a,d){c.emit(b.TRADING_REMOVE_OFEER,{offer_id:a,village_id:d})},g=function(d,e,f){var g=a.getSelectedVillage().getId();c.emit(b.TRADING_ACCEPT_OFEER,{village_id:g,offer_id:d,offer_amount:e},f)},h=function(){var d=a.getSelectedVillage().getId();c.emit(b.TRADING_GET_MERCHANT_STATUS,{village_id:d})},i=function(d,e,f,g,h){var i=a.getSelectedVillage().getId();c.emit(b.TRADING_GET_TRANSPORTS,{village_id:i,offset:e,count:d,ordered_by:f,order:g},h)};return{fetchOffers:d,createOffer:e,deleteOffer:f,acceptOffer:g,requestMerchantStatus:h,requestTransports:i}}])}),define("services/InventoryService",["app"],function(a){a.factory("inventoryService",["$rootScope","modelDataService","socketService","routeProvider","windowManagerService","$filter","settingsService","inventoryItemTypeProvider",function(a,b,c,d,e,f,g,h){var i=function(a,b){var c=h.getKey(a);g.settings.item[c]=b,g.saveGameSettings()},j=function(a){return Object.keys(a.content)[0]},k=function(a){switch(a.type){case h.PACKAGE:return"premium-package-"+a.image;case h.REWARD_UNITS:return"unit-"+j(a);case h.REWARD_RESOURCES:return"resource-"+j(a);case h.REWARD_RESOURCE_PACKAGE:return"resources";case h.EFFECT:return a.content.type;default:return a.type}},l=function(a){var b=h.getKey(a);return g.settings.item[b]},m=function(a){var e=b.getSelectedVillage();c.emit(d.PREMIUM_USE_ITEM,{village_id:e.getId(),item_id:a.id})},n=function(b,c){var d,e,g,i,j="premium_items",k=void 0===c?!1:c;switch(g=k?1:b.amount,b.type){case h.REWARD_RESOURCES:return e=Object.keys(b.content)[0],d=b.content[e],i=f("i18n")(e,a.loc.ale,"resource_names",d),i=f("i18n")("premium_package",a.loc.ale,j,i,g);case h.REWARD_UNITS:return e=Object.keys(b.content)[0],d=b.content[e],i=f("i18n")(e,a.loc.ale,"unit_names",d),i=f("i18n")("premium_package",a.loc.ale,j,i,g);case h.PACKAGE:return f("i18n")("premium_package",a.loc.ale,j,b.name,g);case h.EFFECT:if(!b.content)return;return f("i18n")(b.content.type,a.loc.ale,"premium_items",g)}return f("i18n")("name_"+b.type,a.loc.ale,j,g)},o=function(b,c,d){if(!l(b.type))return void(c?c():m(b));var f,g=a.$new();g.item=b,g.name=n(b,!0),g.icon=k(b),g.onConfirm=c||m,e.getModal("modal_use_item",g),f=g.closeWindow,g.closeWindow=function(){f(),d&&d()}};return{useItem:o,isModalEnabled:l,setUseItemModalState:i,getItemName:n,getItemIcon:k}}])}),define("services/LinkService",["app"],function(a){a.factory("linkService",["$rootScope","windowManagerService","crmService",function(a,b,c){var d="crm_api",e=function(e,f,g,h,i){if(f===d)return c.linkTo(e,g,h,i);var j=a.$new(),k="screen_";"player"===f&&(f="character"),j[f+"Id"]=e,k+=f,"tribe"!==f&&(k+="_info"),b.getScreenWithInjectedScope(k,j)};return{linkTo:e}}])}),define("services/KingdomService",["app"],function(a){a.factory("kingdomService",["socketService","routeProvider","storageService",function(a,b,c){var d="kingdom_storage",e=function(e){var f=c.getItem(d);return f?void e(f):void a.emit(b.MAP_GET_KINGDOMS,{},function(a){c.setItem(d,a),e(a)})};return{getKingdoms:e}}])}),define("services/SettingsService",["app","angular","battlecat"],function(a,b,c){var d=2,e=["worldInfoOpen","villageInfoOpen","villageRepeat","smartTips","nightModeGraphics","animations","zoomAnimation","music","sfx","trees","fog","locator","premium","deleteReports","levelIndicator","commandsOwn","commandsTrade","minimizeDailyUnitDeal","resourceDepositUsed"],f={game:{worldInfoOpen:!1,villageInfoOpen:!1,locator:!1,deleteReports:!1,minimizeDailyUnitDeal:!1,resourceDepositUsed:!1}},g={fireEffect:1,animationLevel:c.browser.msie?1:4,musicVolume:50,sfxVolume:100},h=function(a,c){switch(a){case"duration":return JSON.parse(JSON.stringify(g));default:return c.reduce(function(c,d){return c[d]=b.isDefined(f[a])&&b.isDefined(f[a][d])?f[a][d]:!0,c},{})}},i="gameSettings";a.factory("settingsService",["$rootScope","storageService","inventoryItemTypeProvider","eventTypeProvider",function(a,c,j,k){var l={version:d,player:{},game:h("game",e),item:h("item",j.getOrder()),duration:h("duration")},m=function(a){var b;for(b in a)a[b]=""===a[b]?0:parseInt(a[b],10),isNaN(a[b])&&(a[b]=g[b]);return a},n=this,o={};return this.mergeSettings=function(a,b){var c,d;a.version>=b.version;for(c in b)if(b.hasOwnProperty(c))for(d in b[c])b[c].hasOwnProperty(d)&&(a[c]=a[c]||{},a[c][d]=b[c][d]);return a},this.saveGameSettings=function(e){var f=null;return m(l.duration),f={version:d,game:l.game,item:l.item,duration:l.duration},c.setItem(i,f),e||b.equals(l,o)||(a.$broadcast(k.GAME_SETTINGS_CHANGED),o=b.copy(l)),f},this.loadGameSettings=function(){var a,b=null;try{if(b=c.getItem(i,!c.isLocalStorage),!b)throw new Error}catch(f){a={version:d,game:h("game",e),item:h("item",j.getOrder()),duration:h("duration")}}return a||b},this.reset=function(a){var c;if(void 0===l[a])throw new Error;switch(a){case"version":l[a]=d;break;case"duration":l[a]=g;break;default:for(c in l[a])l[a][c]=b.isDefined(f[a])&&b.isDefined(f[a][c])?f[a][c]:!0}n.saveGameSettings()},this.resetToDefault=function(){return c.removeItem(i,!0),n.mergeSettings(n.settings,n.loadGameSettings()),n.saveGameSettings(),l},this.getOldSettings=function(){return o},n.mergeSettings(l,this.loadGameSettings()),o=b.copy(l),n.saveGameSettings(!0),this.getDefaultOptions=h,this.settings=l,this}])}),define("services/PresetListService",["app"],function(a){a.factory("presetListService",["socketService","modelDataService","routeProvider",function(a,b,c){var d=function(d){return b.getPresetList().isLoaded()||a.emit(c.GET_PRESETS,{}),b.getPresetList().getPresetsByVillageId(d)},e=function(){return b.getPresetList().isLoaded()||a.emit(c.GET_PRESETS,{}),b.getPresetList().getPresets()};return{getPresetsForVillageId:d,getPresets:e}}])}),define("helper/math",[],function(){var a=void 0===window.Float32Array?window.Float32Array:Array;return{fastMultiply:function(a,b,c){return c[0]=a[0]*b[0]+a[1]*b[2],c[1]=a[0]*b[1]+a[1]*b[3],c[2]=a[2]*b[0]+a[3]*b[2],c[3]=a[2]*b[1]+a[3]*b[3],c[4]=a[0]*b[4]+a[1]*b[5]+a[4],c[5]=a[2]*b[4]+a[3]*b[5]+a[5],c},fastVMultiply:function(a,b,c){return c[0]=a[0]*b[0]+a[1]*b[1]+a[4],c[1]=a[2]*b[0]+a[3]*b[1]+a[5],c},getVector2D:function(b,c){var d=a(2);return d[0]=b,d[1]=c,d},getMatrix2D:function(b,c,d,e,f,g){var h=a(6);return h[0]=b,h[1]=c,h[2]=d,h[3]=e,h[4]=f,h[5]=g,h},multiply:function(a,b){return[a[0]*b[0]+a[1]*b[2],a[0]*b[1]+a[1]*b[3],a[2]*b[0]+a[3]*b[2],a[2]*b[1]+a[3]*b[3],a[0]*b[4]+a[1]*b[5]+a[4],a[2]*b[4]+a[3]*b[5]+a[5]]},vmultiply:function(a,b){return[a[0]*b[0]+a[1]*b[1]+a[4],a[2]*b[0]+a[3]*b[1]+a[5],1]},invert:function(a){var b=1/(a[0]*a[3]-a[1]*a[2]);return[a[3]*b,a[1]*b,a[2]*b,a[0]*b,(a[1]*a[5]-a[4]*a[3])*b,(a[4]*a[2]-a[0]*a[5])*b,0,0,(a[0]*a[3]-a[1]*a[2])*b]},equal:function(a,b){if(a.length!==b.length)return!1;for(var c=a.length;c--;)if(a[c]!==b[c])return!1;return!0},distance:function(a,b,c,d){return Math.sqrt((a-c)*(a-c)+(b-d)*(b-d))},getRotationMatrix:function(a,b,c){return[Math.cos(a),-Math.sin(a),Math.sin(a),Math.cos(a),b||0,c||0]},vlength:function(a){return Math.sqrt(a.map(function(a){return a*a}).reduce(function(a,b){return a+b}))},normalize:function(a){var b=this.vlength(a),c=function(a){return a/b};return a.map(c)},getPointOnQuadraticCurve:function(a,b,c,d,e,f,g){var h=1-g/100,i=function(a,b,c,d){var e=1-a;return e*e*b+2*e*a*c+a*a*d};return{x:i(h,a,c,e),y:i(h,b,d,f)}},getPointOnLine:function(a,b,c,d,e){var f=this.vlength([a-c,b-d]),g=-(f/100*e),h=a-c,i=b-d,j=Math.sqrt(h*h+i*i);return{x:c+h/j*(j+g),y:d+i/j*(j+g)}},actualDistance:function(a,b){var c=a.y-b.y,d=a.x-b.x;return c%2&&(d+=a.y%2?.5:-.5),Math.sqrt(d*d+c*c*.75)},sub:function(a,b){return[a[0]-b[0],a[1]-b[1]]},isPointInPolygon:function(a,b){for(var c,d,e=b.length,f=0;e--;)c=this.sub(b[e?e-1:b.length-1],b[e]),d=this.testSegmentIntersection(a,[1,0],b[e],c),d[0]>0&&d[1].between(0,1)&&f++;return!!(1&f)},getPointInPolygon:function(a){for(var b,c,d,e,f,g,h=a.length;h--&&(b=a[h],c=a[h?h-1:a.length-1],d=a[h<a.length-2?h+1:0],e=this.sub(c,b),f=this.sub(d,b),!(Math.acos(this.dotProduct2D(e,f)/(this.vlength(e)*this.vlength(f)))<Math.PI)););return g=this.sub(c,d),g[0]*=.5,g[1]*=.5,g[0]+=d[0],g[1]+=d[1],g},crossProduct2D:function(a,b){return a[0]*b[1]-a[1]*b[0]},dotProduct2D:function(a,b){return a[0]*b[0]+a[1]*b[1]},testSegmentIntersection:function(a,b,c,d){var e,f,g=this.crossProduct2D,h=g(b,d),i=[c[0]-a[0],c[1]-a[1]];return h?(e=g(i,d)/h,f=g(i,b)/h,[e,f]):!1}}}),define("generators/generate",["require"],function(a){var b="v",c="",d="l",e="t";return{hex:function(){var a=0;return function(){return(++a).toHex()}}(),xorshift:function(a,b,c){var d=99*b+a,e=99*(a-1)+b;return c?(Math.abs(d^d<<19^(e^e<<8))>>7+(a-b%3))%c:(d^d<<19^(e^e<<8))>>7+(a-b%3)},treeRandomizer:function(a,b){var c,d=99*b+a,e=12675123;return c=d^d<<11,e=e^e>>19^(c^c>>8)},villageName:function(a){return b+a.toString()},tileName:function(a,b,f,g){return(g?d:f?e:c)+a.toString()+"_"+b.toString()}}}),define("construct/graph/GraphNode",["helper/math"],function(a){var b=function(){};return b.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this.uniqueId)},b.prototype.toString=function(){return this.constructor.name+"::"+this.uniqueId},b.prototype.getTransformation=function(){return a.multiply(a.multiply(this.translation,this.rotation),this.scale)},b.prototype.getTotalTransformation=function(){return this.parentNode?a.multiply(this.parentNode.getTotalTransformation(),this.getTransformation()):this.getTransformation()},b.prototype.getDirtyRects=function(b){if(this.frames){this.matrix||(this.matrix=this.getTotalTransformation());var c=a.vmultiply(this.matrix,[this.width,this.height]);return[this.matrix[4],this.matrix[5],c[0],c[1]]}},b.prototype.setTranslation=function(a,b){return this.translation[4]=a,this.translation[5]=b,this.modified=!0,this},b.prototype.setScale=function(a,b){return this.scale[0]=a,this.scale[3]=b||a,this.modified=!0,this},b.prototype.scheduleRedraw=function(a){return this.parentNode&&this.parentNode.scheduleRedraw(a,this.uniqueId),this.nextRedraw=a,this},b.prototype.animate=function(a){var b;for(b in a)this.animationFn[b]&&this.clearAnimation(b),this.animationFn[b]=a[b].fn,this.animationFn[b].duration=a[b].duration,this.animationFn[b].loop=a[b].loop,this.animationFn[b].startedAt=Date.now(),this.animationFn[b].onAnimationEnd=a[b].onAnimationEnd;return this.animated=!0,this.modified=!0,this},b.prototype.clearAnimation=function(a){return this[a]=this.animationFn[a](1,this[a]),this.animationFn[a].onAnimationEnd&&this.animationFn[a].onAnimationEnd(this),this.animationFn[a]=null,this},b}),define("construct/graph/Sprite",["construct/graph/GraphNode","generators/generate","helper/math","conf/conf"],function(a,b,c,d){var e=function(a,e,f,g,h,i,j,k,l,m,n,o){this.width=Math.min(f||a.width,a.width),this.height=Math.min(g||a.height,a.height),this.parentNode=null,this.uniqueId=void 0===l||null===l?b.hex():l,this.name=e,this.key="",this.img=a,this.text=null,this.color="",this.alpha=1,this.verts=[],this.matrix=null,this.translation=[1,0,0,1,h||0,i||0],this.scale=[j||1,0,0,j||1,0,0],this.rotation=c.getRotationMatrix(k||0,0,0),this.origin=null,this.modified=!0,this.redraw=!1,this.noclip=!1,this.clip=!1,this.zindex=0,this.data=n,this.frames=m||0,this.frameDuration=d.DEFAULT_FRAME_DURATION,this.lastFrame=0,this.lastFrameUpdate=Date.now(),this.sequences=null,this.currentSequence=0,this.imageCoords=o,this.animationFn={}};return e.inherits(a),e}),define("helper/color",[],function(){return{hsv2Rgb:function(a){var b,c=a[0].bound(0,360),d=a[1].bound(0,100),e=a[2].bound(0,100),f=c/60,g=e*d,h=g*(1-Math.abs(f%2-1)),i=e-g;switch(Math.floor(f)){case 0:b=[g,h,0];break;case 1:b=[h,g,0];break;case 2:b=[0,g,h];break;case 3:b=[0,h,g];break;case 4:b=[h,0,g];break;case 5:b=[g,0,h];break;default:return[0,0,0]}return[Math.round(255*(b[0]+i)),Math.round(255*(b[1]+i)),Math.round(255*(b[2]+i))]},validHex:function(a){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a)},rgb2Hsv:function(a){var b,c,d,e,f,g,h,i=0;if(a=a.map(function(a){return(a/255).bound(0,1)}),d=a[0],e=a[1],f=a[2],b=a.max(a),c=a.min(a),h=b-c)switch(b){case d:i=(e-f)/h;break;case e:i=2+(f-d)/h;break;case f:i=4+(d-e)/h}return g=b?h/b:0,[Math.round((60*i+360)%360),Math.round(100*g/100),Math.round(100*b)/100]},rgb2Hex:function(a){return a.map(function(a){return(a=a.toString(16)).length>1?a:"0"+a}).join("")},hex2Rgb:function(a){if(a=a.replace("#",""),6!==a.length)throw new TypeError;return[parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)]},setLuminance:function(a,b){var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e}}}),define("construct/Composer",["conf/conf","generators/generate","helper/color"],function(a,b,c){var d=function(d,e){var f,g,h,i=a.TILESIZE,j=i.x,k=i.y,l="source-over",m="source-atop",n=6,o="#"+c.rgb2Hex([194,71,4]),p=document.createElement("canvas"),q=document.createElement("canvas"),r={border:{},river:{}},s=function(a){for(var b,d=c.rgb2Hsv(a),e=n,f=[];e--;)b=.5*d[1]+d[1]*e/6*.5,f[e]="#"+c.rgb2Hex(c.hsv2Rgb([d[0],b,d[2]]));return f},t=([[217,204,60],[255,235,121],[160,224,169],[0,173,167]].map(s),function(b,c,e){var f,g,h,i=n,p=0,q=a.TILESIZE.shape;if(c.clearRect(0,0,j,k),c.drawImage(d.border,0,0,j,k),a.PARTY)c.globalCompositeOperation=m,c.fillStyle=o,c.fillRect(0,0,j,k);else{for(a.BLOODY_BORDERS?(c.globalCompositeOperation=m,c.fillStyle="darkred",c.fillRect(0,0,j,k),c.shadowBlur=5,c.shadowColor="black"):c.globalCompositeOperation=l;i--;)g=e.b[i],h=g>>2&3,g>>4?p++:c.drawImage(d.transitions[h][i],0,0,j,k);for(i=n,c.save(),c.setLineDash&&(c.setLineDash([6]),c.lineDashOffset=15),c.strokeStyle="#ffeeae",c.shadowBlur=3,c.shadowOffsetX=1,c.shadowOffsetY=1,c.shadowColor="#000",c.lineWidth=3,c.globalAlpha=.4;i--;)f=(n-i)%n,g=e.b[i],h=g>>2&3,g>>4&&(c.beginPath(),c.moveTo(a.TILESIZE.halfX,a.TILESIZE.halfY),c.lineTo(q[f][0]-.5*(q[f][0]-q[f!==n-1?f+1:0][0]),q[f][1]-.5*(q[f][1]-q[f!==n-1?f+1:0][1])),c.stroke(),c.closePath());c.restore()}return b}),u=function(a,b,c){var e,g,h=n;for(h=0,e=[];n>h;h++)c.b[h]>>4&&c.b[h]>>2&1&&e.push(h);return e.sort(function(a,b){return a-b}),f.clearRect(0,0,j,k),t(p,f,c),2===e.length?g=d.river2[e[0]][e[1]]:3===e.length&&(g=d.river3[e[0]][e[1]][e[2]]),g&&f.drawImage(g,0,0,j,k),b.drawImage(p,0,0,j,k),a},v=function(a,b){var c,d=[a>>2,3&a],e=[],f=n,g=1,h=!1;for(1&b||b>>5&1||d.reverse(),c=d[g],f=0;n>f;f++)b>>f&1?(e.unshift(16),h&&(h=!1,g=Math.abs(--g%2),c=d[g])):(e.unshift(c<<2),h=!0);return{b:e}},w=function(){var a,b,c,d=document.createElement("canvas"),e=d.getContext("2d");d.width=j,d.height=k;for(a in r.border)for(b in r.border[a])c=r.border[a][b].getContext("2d"),c.drawImage(t(d,e,v(a,b)),0,0,j,k);window.twx.game.map.forceRedraw()},x=function(a,b,c,d){if("linear-light"===a){b=b||h;for(var e=c.getImageData(0,0,j,k),f=e.width*e.height*4;f--;)f+1&3&&(e.data[f]=e.data[f]*(1-d)+(e.data[f]+(b.data[f]<<1)-255)*d);c.putImageData(e,0,0,0,0,j,k)}},y=function(b){var c,d,e,f,g,h,i=b.key,l=null,m=null;

if(!i.w){for(h=[],c=0;6>c;c++)f=i.b[c],g=f>>>2&3,!(f>>>4)&&h.indexOf(g)<0&&h.push(g),l<<=1,l+=f>>>4;2===h.length&&(m=(h[0]<<2)+h[1])}return m&&l&&(d=r.border[m][l])?d:(d=document.createElement("canvas"),d.width=j,d.height=k,e=d.getContext("2d"),i.w&&a.RIVERS?e.drawImage(u(d,e,i),0,0,j,k):e.drawImage(t(d,e,i),0,0,j,k),null!==m&&null!==l&&(r.border[m][l]=d),d)},z=function(a){var c,f,g=a.key,h=a.x,i=a.y;return c=d[g.p][b.xorshift(h,i,6)],g.l?c=[c,null,d.landmarks[b.xorshift(h,i,10)]]:e.trees&&!g.s&&(f=b.treeRandomizer(h,i),f%6>2&&(c.length?c[1]=d.trees[f%4]:c=[c,d.trees[f%4]])),c},A=function(a){if(a&&a.key){var b=a.key;return b.b?y(a):void 0!==b.p?z(a):void 0}},B=function(){var a,b;for(p.width=j,p.height=k,f=p.getContext("2d"),q.width=j,q.height=k,g=q.getContext("2d"),g.fillStyle="rgb(25,49,85)",g.fillRect(0,0,j,k),h=g.getImageData(0,0,j,k),a=0;4>a;a++)for(b=0;4>b;b++)a!==b&&(r.border[(a<<2)+b]={})};this.applyFilter=x,this.compose=A,this.recreateTiles=w,B()};return d}),define("services/MapService",["app","conf/conf","conf/colors","helper/math","generators/generate","construct/graph/Sprite","construct/Composer","helper/time","queues/EventQueue","struct/MapData"],function(a,b,c,d,e,f,g,h,i,j){a.factory("mapService",["$rootScope","$filter","modelDataService","villageService","groupService","settingsService","canvasAssetService","audioService","iconGeneratorService","windowManagerService","socketService","eventTypeProvider","routeProvider",function(a,k,l,m,n,o,p,q,r,s,t,u,v){var w,x,y="day",z=y,A=c.village,B=function(a,b,c,e,f){var g;return a.between(0,e)&&b.between(0,f)?(g=d.vmultiply(d.invert(c),[a,b]),{x:g[0],y:g[1],x0:a,y0:b}):!1},C=function(a,c){var d,e,f=a/b.TILESIZE.x,g=c/b.TILESIZE.y/b.TILESIZE.off,h=b.TILESIZE.tri/(b.TILESIZE.y-b.TILESIZE.tri),i=2*h,j=1&(0|g);return j&&(f-=.5),d=f-(0|f),e=g-(0|g),h>e&&(.5>d?h-e>d*i&&(g-=1,j||(f-=1)):(d-.5)*i>e&&(g-=1,j&&(f+=1))),f|=0,{x:0|f,y:0|g}},D=function(a,c){var d,e;return d=1&c?(a+.5)*b.TILESIZE.x:a*b.TILESIZE.x,e=c*b.TILESIZE.y*b.TILESIZE.off,[d,e]},E=function(a,b){b=1/(b||1);var c=C(a[0]*b,a[1]*b),d=C(a[2]*b,a[3]*b),e=[c.x-1,c.y-1,d.x+3||1,d.y+3||1];return e},F=function(a,c,d,e){var f,g=[];return c.z?(f=E([-a.x-b.TILESIZE.x,-a.y-b.TILESIZE.y,d+(b.TILESIZE.x<<1),e+(b.TILESIZE.y<<1)],a.z),g.push(f),c.x=c.y=c.z=0):(c.x&&(c.x>0?f=[-a.x,-a.y,c.x,e]:c.x<0&&(f=[-a.x+d+c.x,-a.y,-c.x,e]),f=c.x?E(f,a.z):null,c.x=0,g.push(f)),c.y&&(c.y>0?f=[-a.x,-a.y,d,c.y]:c.y<0&&(f=[-a.x,-a.y+e+c.y,d,-c.y]),f=c.y?E(f,a.z):null,c.y=0,g.push(f))),g},G=function(a,c,d){var f,g,i,j,k,o,p,q,s,t,u,v,w,x=[],y=l.getSelectedCharacter(),z=y.getTribeRelations(),B=y.getId(),C=y.getTribeId(),D=y.getSelectedVillage()||m.getLastSelectedVillage()||y.getFirstVillage(),E=D.getId(),F=y.isInCoopMode();for(f=0;f<a.towns.length;f++)for(g in a.towns[f].data)if(a.towns[f].data.hasOwnProperty(g))for(i in a.towns[f].data[g])if(a.towns[f].data[g].hasOwnProperty(i)){if(o=a.towns[f].data[g][i],t=e.villageName(o.id),c.layers.tiles.hasChild(t))continue;if(o.id===b.RESERVED_VILLAGE_IDS.INVITE_A_FRIEND&&F)continue;for(j=b.TILESIZE.x*(1&o.y?o.x+.5:o.x),k=b.TILESIZE.y*o.y*b.TILESIZE.off,p=0;b.VILLAGE_LEVELS[p]&&o.points>b.VILLAGE_LEVELS[p];)p++;if(q={x:o.x,y:o.y,name:o.name,points:o.points,attack_protection:o.attack_protection,level:p},null===o.character_id?(q.barbarianVillage=!0,q.boosted=o.barbarian_boost?h.server2ClientTime(o.barbarian_boost):null,v=A.barbarian,u=d.bvillages[p]):(o.character_id===B?(q.playerVillage=!0,v=E===o.id?A.selected:A.player):z&&(C===o.tribe_id?v=A.tribe:z.isAlly(o.tribe_id)?v=A.ally:z.isEnemy(o.tribe_id)?v=A.enemy:z.isNAP(o.tribe_id)&&(v=A.friendly)),u=d.villages[p]),s=c.makeVillage(u,d.icons[p.bound(0,d.icons.length-1)],d,t,b.TILESIZE.x,b.TILESIZE.y,j,k,q,o.id),s.color=v,o.id<0){switch(o.id){case b.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT:s.color=A.player;break;case b.RESERVED_VILLAGE_IDS.SECOND_VILLAGE:s.color=A.player;break;case b.RESERVED_VILLAGE_IDS.INVITE_A_FRIEND:s.color=A.invite}x.magicLocations=x.magicLocations||{},x.magicLocations[o.id]=o}w=n.getVillageGroupIcons(o.id),w.length&&(s.groupIcons=r.generate(w,"group",null,19*w.length+3,22)),v="",x.push(s)}return x},H=function(a,c){var d,g,h,i,j,k,l,m,n,o=[];if(!x)return w=!0,[];for(d=0;d<a.tiles.length;d++)i=a.tiles[d],m=e.tileName(i.x,i.y),c.layers.tiles.hasChild(m)||(l=null,j=b.TILESIZE.x*(1&i.y?i.x+.5:i.x),k=b.TILESIZE.y*i.y*b.TILESIZE.off,l=x.compose(i),l.length?(g=c.makeTile(l[0],m,b.TILESIZE.x,b.TILESIZE.y,j,k,0,0),l[1]&&!c.layers.tiles.hasChild(n=e.tileName(i.x,i.y,!0))&&(h=new f(l[1],n,l[1].width,l[1].height,j-(l[1].width-b.TILESIZE.x)/2,k-(l[1].height-b.TILESIZE.y)/2),h.zindex=i.x+i.y,o.push(h)),l[2]&&!c.layers.tiles.hasChild(n=e.tileName(i.x,i.y,!1,!0))&&(h=new f(l[2],n,b.TILESIZE.x,b.TILESIZE.y,j,k,0,0),h.zindex=i.x+i.y+1,o.push(h))):g=c.makeTile(l,m,b.TILESIZE.x,b.TILESIZE.y,j,k,0,0),g&&(g.zindex=1,o.push(g)));return o},I=function(){return z},J=function(a,b){z=a,p.getTileset(z,function(a){x=new g(a,o.settings.game),b&&b()},!0)},K=function(){return o.settings.game.nightModeGraphics&&"night"===z},L=function(b,c,d,e){e&&s.closeAll(),a.$broadcast(u.MAP_ZOOM_OUT_OF_VILLAGE,function(){a.$broadcast(u.MAP_JUMP_TO,b,c,null,null,d||null)},!0)},M=function(b,c,d,e){e&&s.closeAll(),a.$broadcast(u.MAP_ZOOM_OUT_OF_VILLAGE,function(){a.$broadcast(u.MAP_CENTER_ON_POSITION,b,c,!!d)},!0)},N=function(c,d){j.setSpecialLocationData({villages:[{x:d.x,y:d.y,name:k("i18n")("title",a.loc.ale,"screen_resource_deposit"),collectible:!1,id:b.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT}],x:d.x,y:d.y}),d.type=b.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT,i.trigger(i.types.MAPDATA_UPDATE,d)},O=function(a,c){c.x=c.coordinates.x,c.y=c.coordinates.y,j.setSpecialLocationData({villages:[{x:c.x,y:c.y,name:c.village_name,collectible:!1,id:b.RESERVED_VILLAGE_IDS.SECOND_VILLAGE}],x:c.x,y:c.y}),c.type=b.RESERVED_VILLAGE_IDS.SECOND_VILLAGE,i.trigger(i.types.MAPDATA_UPDATE,c)},P=function(a,b){j.setTownData(b),i.trigger(i.types.MAPDATA_UPDATE,null)},Q=function(){if(t.emit(v.STARTUP_LOG,{startup_time:h.stopWatch.stop().time,platform:"browser",device:encodeURI(window.navigator.userAgent)}),l.getSelectedCharacter().isInTutorial()){q.init("tutorial");var b=a.$on(u.TUTORIAL_COMPLETED,function(){q.initMusicSprites(null,"tutorial"),b()})}else q.init(null,"tutorial")};return p.getTileset(z,function(a){x=new g(a,o.settings.game),w&&i.trigger(i.types.MAPDATA_UPDATE,null)}),a.$on(u.RESOURCE_DEPOSIT_INFO,N),a.$on(u.SECOND_VILLAGE_INFO,O),a.$on(u.MAP_VILLAGE_DATA,P),{layer2Map:B,pixel2Tiles:C,tileCoordinate2Pixel:D,getTilesForDiff:F,getTimeOfDay:I,setTimeOfDay:J,isNight:K,convert:E,createVillages:G,createTiles:H,jumpToVillage:L,sendStartupLog:Q,centerOnPosition:M}}])}),define("states/MapState",[],function(){var a={x:0,y:0,z:0},b=function(b){a.x=b.x,a.y=b.y,a.z=b.z};return{view:a,graph:null,setView:b}}),define("services/MapHintService",["app","conf/conf","battlecat","helper/math","queues/EventQueue","states/MapState","angular"],function(a,b,c,d,e,f,g){var h="tooltip-map-resource-deposit",i="tooltip-map-second-village";a.factory("mapHintService",["$rootScope","$timeout","templateManagerService","windowManagerService","windowDisplayService","mapService","modelDataService","eventTypeProvider",function(a,j,k,l,m,n,o,p){var q="left",r="right",s=function(h,i,j,l,m){return k.compile("map_bubble",h,function(k){if(document.getElementById(h.id))return h.$destroy(),!1;var p=[1,0,0,1].concat(n.tileCoordinate2Pixel(i,j)),s=function(c,e){var g,k,m=o.getSelectedVillage();m&&(g={x:m.getX(),y:m.getY()}),g&&i<g.x&&d.actualDistance({x:i,y:j},g)<3?(h.direction=r,k=0):(h.direction=q,k=2),h.coords=l.getScreenCoords({matrix:p,width:b.TILESIZE.x*k,height:b.TILESIZE.y},e||f.view),a.$$phase||h.$digest()};c("#map").append(k),h.click=function(){g.isFunction(m)&&m(),h.close()},h.close=function(){$(k).remove(),e.unregister(e.types.MAPVIEW_UPDATE,s),h.$destroy()},h.$$postDigest(function(){s()}),e.register(e.types.MAPVIEW_UPDATE,s)}),!0},t=function(b,c,d){if(document.getElementById(h))return!1;var e,f=function(){j(function(){e.close&&e.close()})};return e=a.$new(),e.textObject="screen_resource_deposit",e.id=h,e.$on(p.RESOURCE_DEPOSIT_JOB_STARTED,f),e.$on(p.RESOURCE_DEPOSIT_INFO,f),s(e,b,c,d,function(){l.getScreen("screen_resource_deposit")})},u=function(b,c,d){if(document.getElementById(i))return!1;var e,f=function(){j(function(){e.close()})};return e=a.$new(),e.textObject="screen_second_village",e.id=i,e.$on(p.SECOND_VILLAGE_VILLAGE_CREATED,f),e.$on(p.SECOND_VILLAGE_INFO,f),s(e,b,c,d,m.openSecondVillage)};return{showResourceDepositHint:t,showSecondVillageHint:u}}])}),define("services/ForumService",["app"],function(a){a.factory("forumService",["$rootScope","$filter","socketService","routeProvider","windowManagerService","modelDataService",function(a,b,c,d,e,f){var g=32,h=3,i=function(f){var g=a.$new(),h="modal_delete_forum";g.title=b("i18n")("title",a.loc.ale,h),g.text=b("i18n")("description",a.loc.ale,h),g.submitText=b("i18n")("ok",a.loc.ale,h),g.cancelText=b("i18n")("CANCEL",a.loc.ale),g.submit=function(){c.emit(d.FORUM_DELETE_FORUM,{forum_id:f}),g.closeWindow()},g.cancel=function(){g.closeWindow()},e.getModal("modal_attention",g)},j=function(){var b=a.$new();b.name="",b.maxForumNameLength=g,b.minForumNameLength=h,b.submit=function(){!b.name||b.name.length<h||b.name.length>g||(c.emit(d.FORUM_CREATE_FORUM,{name:b.name}),b.closeWindow())},b.cancel=function(){b.closeWindow()},e.getModal("modal_create_forum",b)},k=function(b,f){var g=a.$new();g.title=b,g.submit=function(){c.emit(d.FORUM_RENAME_THREAD,{thread_id:f,name:g.title}),g.closeWindow()},g.cancel=function(){g.closeWindow()},e.getModal("modal_rename_thread",g)},l=function(b,f){var g=a.$new();g.name=b,g.submit=function(){c.emit(d.FORUM_RENAME_FORUM,{forum_id:f,name:g.name}),g.closeWindow()},g.cancel=function(){g.closeWindow()},e.getModal("modal_rename_forum",g)},m=function(a,b,e){c.emit(d.FORUM_MOVE_THREADS,{forum_id:a,thread_ids:e,target_forum_id:b})},n=function(f,g){var h=a.$new(),i="delete_threads";h.title=b("i18n")("title",a.loc.ale,i,g.length),h.text=b("i18n")("description",a.loc.ale,i,g.length),h.submitText=b("i18n")("ok",a.loc.ale,i,g.length),h.cancelText=b("i18n")("CANCEL",a.loc.ale),h.submit=function(){c.emit(d.FORUM_DELETE_THREADS,{forum_id:f,thread_ids:g}),h.closeWindow()},h.cancel=function(){h.closeWindow()},e.getModal("modal_attention",h)},o=function(a,b){n(a,[b])},p=function(a,b,e,f){c.emit(d.FORUM_LIST_POSTS,{thread_id:a,offset:b,count:e,reverse:!0},f)},q=function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id===b)return c},r=function(a){var b=f.getTribeForumThreadListModel(),c=b.threadIdToForumId[a];return b.forum[c].threads[b.threadIdToIndex[c][a]]},s=function(a,b){return a[q(a,b)]},t=function(a,b){return a[q(a,b)]},u=function(f,g){var h=a.$new(),i="modal_delete_post";h.title=b("i18n")("title",a.loc.ale,i),h.text=b("i18n")("description",a.loc.ale,i),h.submitText=b("i18n")("ok",a.loc.ale,i),h.cancelText=b("i18n")("CANCEL",a.loc.ale),h.submit=function(){c.emit(d.FORUM_DELETE_POST,{post_id:g,thread_id:f}),h.closeWindow()},h.cancel=function(){h.closeWindow()},e.getModal("modal_attention",h)},v=function(a,b,e){c.emit(d.FORUM_CREATE_POST,{thread_id:a,text:b},e)},w=function(a,b,e){c.emit(d.FORUM_EDIT_POST,{post_id:a,text:b},e)},x=function(a,b,e){c.emit(d[e?"FORUM_MARK_THREADS_READ":"FORUM_MARK_THREADS_UNREAD"],{thread_ids:b,forum_id:a})},y=function(a,b){c.emit(d[b?"FORUM_MARK_FORUM_READ":"FORUM_MARK_FORUM_UNREAD"],{forum_id:a})},z=function(a,b,e){c.emit(d[e?"FORUM_PIN_THREADS":"FORUM_UNPIN_THREADS"],{thread_ids:b,forum_id:a})},A=function(a,b,e){c.emit(d[e?"FORUM_CLOSE_THREADS":"FORUM_REOPEN_THREADS"],{thread_ids:b,forum_id:a})},B=function(a){c.emit(d.FORUM_SET_ORDER,{order:a})},C=function(c){return b("i18n")(c,a.loc.ale,"screen_tribe_forum")},D=function(a,b){return b?t(a,b).name:void 0};return{deleteForum:i,createForum:j,requestPostList:p,getIndex:q,getThread:r,getForum:t,getPost:s,deletePost:u,editPost:w,createPost:v,changeThreadTitle:k,markThreadsRead:x,pinThreads:z,closeThreads:A,markForumRead:y,deleteThreads:n,deleteThread:o,renameForum:l,setForumOrder:B,getActionName:C,getForumName:D,moveThreads:m}}])}),define("services/TribeService",["app","conf/conf"],function(a,b){a.factory("tribeService",["$rootScope","$filter","routeProvider","socketService","eventTypeProvider","windowManagerService","modelDataService","achievementListService",function(a,c,d,e,f,g,h,i){var j=function(a){e.emit(d.TRIBE_SET_FOUNDER,{new_founder_id:a})},k=function(a,b){e.emit(d.TRIBE_CREATE,{name:a,tag:b})},l=function(a){e.emit(d.TRIBE_KICK_MEMBER,{id:a})},m=function(a){e.emit(d.TRIBE_INVITATION_CREATE,{character_name:a})},n=function(a){e.emit(d.TRIBE_JOIN,{tribe_id:a})},o=function(b){var c=a.$new();e.emit(d.TRIBE_GET_APPLICATION_TEMPLATE,{tribe_id:b},function(a){c.text=a.template}),c.submit=function(){e.emit(d.TRIBE_APPLICATION_CREATE,{tribe_id:b,message:c.text},function(){}),c.closeWindow()},g.getModal("modal_write_tribe_application",c)},p=function(a){return h.getSelectedCharacter().getTribeId()===a},q=function(a){i.getTribeAchievements(a)},r=function(b,c){var d;c&&c(),h.getSelectedCharacter().setTribeId(b.tribe_id),h.getSelectedCharacter().setTribeRights(b.tribe_rights),d=a.$new(),d.activeTab="tribe-profile",g.getScreenWithInjectedScope("screen_tribe",d)},s=function(a){0!==a&&a--;var c=parseInt(a/(b.MAX_TRIBE_LEVEL/b.HIGH_LEVEL_TRIBE_CREST),10);return c.bound(b.NO_TRIBE_CREST,b.HIGH_LEVEL_TRIBE_CREST-1)+1};return{setFounder:j,createTribe:k,kickMember:l,inviteCharacter:m,writeApplication:o,isOwnTribe:p,getAchievements:q,join:n,onTribeJoined:r,getCrestLevel:s}}])}),define("services/GroupService",["app"],function(a){a.factory("groupService",["$rootScope","socketService","modelDataService","windowManagerService","routeProvider",function(a,b,c,d,e){var f=function(a){return"string"==typeof a?parseInt(a,16):a},g=function(a,c){a=f(a),b.emit(e.GROUPS_CREATE,{icon:a,name:c})},h=function(a,c,d){c=f(c),b.emit(e.GROUPS_UPDATE,{id:a,icon:c,name:d})},i=function(a){b.emit(e.GROUPS_DESTROY,{id:a})},j=function(a,c){b.emit(e.GROUPS_LINK_VILLAGE,{group_id:a,village_id:c})},k=function(a,c){b.emit(e.GROUPS_UNLINK_VILLAGE,{group_id:a,village_id:c})},l=function(){return c.getGroupList().getGroups()},m=function(a){return c.getGroupList().getGroupVillageIds(a).length},n=function(a){return c.getGroupList().getVillageGroups(a)},o=function(a){return n(a).map(function(a){return a.icon})},p=function(b,c){var e=a.$new();e.villageId=b,e.villageName=c,d.getModal("modal_groups_index",e)};return{createGroup:g,updateGroup:h,destroyGroup:i,attachGroupToVillage:j,dettachGroupFromVillage:k,getGroups:l,getVillageCountForGroup:m,getVillageGroups:n,getVillageGroupIcons:o,openGroupsIndexModal:p}}])}),define("services/AchievementListService",["app"],function(a){a.factory("achievementListService",["socketService","modelDataService","routeProvider",function(a,b,c){var d=function(b){a.emit(c.ACHIEVEMENT_GET_TRIBE_ACHIEVEMENTS,{tribe_id:b})},e=function(){return b.getAchievementList().isLoaded()||a.emit(c.ACHIEVEMENT_GET_ACHIEVED,{character_id:b.getSelectedCharacter().getId()}),b.getAchievementList().getAchievementsData()};return{getAchievementsData:e,getTribeAchievements:d}}])}),define("helper/util",[],function(){return{checkFunc:function(a,b){var c=function d(){a()?b():setTimeout(d,20)};c()},toActionList:function(a,b){var c,d=[];for(c in a)a.hasOwnProperty(c)&&d.push({name:b(a[c]).toString(),value:a[c].toString()});return d},checkEmail:function(a){var b,c;return a?(b=a.indexOf("@"),0>=b?!1:(c=a.substring(b,a.length),b=c.indexOf("."),0>=b?!1:a.indexOf(".")===a.length-1?!1:!0)):!1}}}),define("services/TutorialService",["angular","app","helper/util","helper/time"],function(a,b,c,d){b.factory("tutorialService",["$rootScope","$filter","$timeout","routeProvider","socketService","eventTypeProvider","windowManagerService",function(b,e,f,g,h,i,j){var k,l=[],m={},n=function(){},o=function(a,b){l.push({funcName:b,func:a[b],parent:a})},p=function(a,b){var c=0;for(c=0;c<l.length;c++)if(l[c].parent===a&&l[c].funcName===b)return l[c].func;return!1},q=function(){return{styles:m,functions:l}},r=function(a,b,c){a[b]=c},s=function(a,b,c){var d,e,f,g=["buildinginfo","presets","groups","info","levelup","premiumlevelup","boost"],h=a[0].querySelectorAll("*"),i=!1;for(c||(c=""),e=0;e<h.length;e++)if(d=h[e].className,-1!==d.indexOf(c)&&(-1!==d.indexOf("icon")&&-1===d.indexOf("unit-")&&-1===d.indexOf("resource-")&&-1===d.indexOf("icon-locked-large")&&-1===d.indexOf("icon-26x26-logout")&&(b?$(h[e]).removeClass("icon-inactive"):$(h[e]).addClass("icon-inactive"),i=!0),-1!==d.indexOf("btn")&&-1===d.indexOf("list-btn")&&d.indexOf("btn-locked")&&-1===d.indexOf("icon-26x26-logout")&&-1===d.indexOf("btn-interface")&&(b?$(h[e]).removeClass("btn-grey"):$(h[e]).addClass("btn-grey"),i=!0),"context-menu"===a[0].id))for(f=0;f<g.length;f++)-1!==d.indexOf(g[f])&&(b?$(h[e]).removeClass("context-icon-inactive"):$(h[e]).addClass("context-icon-inactive"));return i},t=function(a,b,d){var e;m[a]=!b,a=$(a),c.checkFunc(function(){return a[0]?(e=a[0].querySelectorAll("*"),e.length):void 0},function(){s(a,b,d)})},u=function(b){var c=a.element(b[0]);return c.scope()},v=function(a,b){h.emit(g.TUTORIAL_COMPLETE_TASK,{},function(){return b&&a?void a():void h.emit(g.TUTORIAL_START_TASK,{},a||null)})},w=function(a){var b,d,e,f=["level-indicator","building-level","building-progress-bar","building-name"];c.checkFunc(function(){return $(".twx-overlay").find(".level-indicator").length>0?!0:!1},function(){for(d=0;d<f.length;d++)for(b=$(".twx-overlay").find("."+f[d]),e=0;e<b.length;e++)$(b[e]).addClass("inactive");setTimeout(function(){if(a)for(d=0;d<f.length;d++)for(b=$(".twx-overlay").find("#label-"+a).find("."+f[d]),e=0;e<b.length;e++)$(b[e]).removeClass("inactive")},40)})},x=function(a){var b=document.createElement("div");b.className="highlight highlight-circle",$("#map").find("."+a).append(b)},y=function(){k||(h.emit(g.TUTORIAL_SKIP,{},function(){b.$broadcast(i.NOTIFICATION_ENABLE),f(function(){window.location.reload()},100)}),k=!0)},z=function(){var a=b.$new(),c="tutorial";a.title=e("i18n")("skip_tutorial",b.loc.ale,c),a.text=e("i18n")("skip_description",b.loc.ale,c),a.boxText=e("i18n")("skip_box",b.loc.ale,c),a.submitText=e("i18n")("YES",b.loc.ale),a.cancelText=e("i18n")("NO",b.loc.ale),a.submit=function(){y()},a.cancel=function(){a.closeWindow()},j.getModal("modal_attention",a)},A=function(a,b){var e;c.checkFunc(function(){return e=$(".step-"+d.zerofill(a)).find(".highlight-interface"),e.length},function(){$(e).css("zIndex","12"),$(e).css("pointerEvents","all"),$(e).click(b)})};return{emptyFunction:n,saveFunction:o,overrideFunction:r,setElemsStyles:t,getScope:u,getSaved:q,getFunction:p,completeTask:v,setBuildingLabel:w,createSubMenuHighlight:x,openSkipTutorialModal:z,appendClickToHighlight:A}}])}),define("services/PresetService",["app"],function(a){a.factory("presetService",["$rootScope","$filter","$q","modelDataService","socketService","routeProvider","eventTypeProvider","windowManagerService","windowDisplayService","effectService",function(a,b,c,d,e,f,g,h,i,j){var k=1,l=26,m="modal_preset_edit",n="building_rally_point",o="modal_preset_save",p=function(){var a={village_id:d.getSelectedVillage().getId(),icon:null,name:null,catapult_target:null,officers:{},units:{}};return d.getGameData().getOfficers().forEach(function(b){a.officers[b]=!1}),d.getGameData().getOrderedUnitNames().forEach(function(b){a.units[b]=0}),a},q=function(a){return a&&a.length.between(k,l)},r=function(b){var c=a.$new();c.preset=b,h.getModal("modal_preset_content",c)},s=function(){h.getModal("modal_load_preset_list")},t=function(a){var b=d.getSelectedVillage(),c=b.getId();e.emit(f.ASSIGN_PRESETS,{village_id:c,preset_ids:a})},u=function(a){var b,c=d.getSelectedVillage(),e=c.getId(),f=d.getPresetList(),g=f.getPresetsByVillageId(e),h=[];for(b in g)h.push(parseInt(b,10));h.splice(h.indexOf(a),1),t(h)},v=function(d){var e=a.$new(),f=c.defer();return e.text=b("i18n")("unassign_description",a.loc.ale,n,d.name),e.title=b("i18n")("unassign_title",a.loc.ale,n),e.submitText=b("i18n")("unassign",a.loc.ale,n),e.cancelText=b("i18n")("cancel",a.loc.ale,n),e.preset=d,e.switchColors=!0,e.showQuestionMarkIcon=!0,e.submit=function(){u(d.id),f.resolve(d),e.closeWindow()},e.cancel=function(){f.reject(d),e.closeWindow()},h.getModal("modal_attention",e),f.promise},w=function(d){var e=a.$new(),f=c.defer();return e.text=b("i18n")("delete_description",a.loc.ale,n,d.name),e.title=b("i18n")("delete_title",a.loc.ale,n),e.submitText=b("i18n")("delete",a.loc.ale,n),e.cancelText=b("i18n")("cancel",a.loc.ale,n),e.switchColors=!0,e.showQuestionMarkIcon=!0,e.submit=function(){f.resolve(d),e.closeWindow()},e.cancel=function(){f.reject(d),e.closeWindow()},h.getModal("modal_attention",e),f.promise},x=function(c){return c.units.knight>1?(a.$broadcast(g.MESSAGE_ERROR,{message:b("i18n")("to_many_knights",a.loc.ale,m)}),!1):(c.icon="string"==typeof c.icon?parseInt(c.icon,16):c.icon,c.units.catapult||(c.catapult_target=null),c.id?(c.preset_id=c.id,e.emit(f.SAVE_EXISTING_PRESET,c)):e.emit(f.SAVE_NEW_PRESET,c),!0)},y=function(d){var e=a.$new(),f=c.defer();return e.text=b("i18n")("text",a.loc.ale,o,d.name),e.title=b("i18n")("title",a.loc.ale,o),e.submitText=b("i18n")("save",a.loc.ale,o),e.cancelText=b("i18n")("cancel",a.loc.ale,o),e.showQuestionMarkIcon=!0,e.submit=function(){x(d),f.resolve(d),e.closeWindow()},e.cancel=function(){f.reject(d),e.closeWindow()},h.getModal("modal_attention",e),f.promise},z=function(b){var d=a.$new(),e=c.defer();return d.icon=b.icon,d.iconType="preset",d.submit=function(a){e.resolve({icon:a,changed:b.icon!==a}),d.closeWindow()},d.cancel=function(){e.reject(),d.closeWindow()},h.getModal("modal_icon_generator",d),e.promise},A=function(d){var e=a.$new(),f=c.defer();return e.options={},d?(e.title=b("i18n")("change_name_title",a.loc.ale,m,d.name),e.options.description=b("i18n")("change_name",a.loc.ale,m),e.options.value=d.name):(e.title=b("i18n")("new_preset_name_title",a.loc.ale,m),e.options.description=b("i18n")("preset_new_modal",a.loc.ale,m)),e.placeholder=b("i18n")("preset_new_placeholder",a.loc.ale,m),e.ok=b("i18n")("ok",a.loc.ale,m),e.isValidPresetName=q,e.minNameLength=k,e.maxNameLength=l,e.submit=function(){e.isValidPresetName(e.options.value)&&(f.resolve(e.options.value),e.closeWindow())},e.cancel=function(){f.reject(),e.closeWindow()},h.getModal("modal_preset_name",e),f.promise},B=function(b,d){var e=a.$new(),f=c.defer();return e.preset=b,e.hideWarning=!!d,e.updateFront=function(){f.resolve(b),e.closeWindow()},h.getModal("modal_preset_edit",e),f.promise},C=function(){var a=p();A().then(function(b){a.name=b,z(a).then(function(b){a.icon=b.icon,B(a,!0)})})},D=function(a){e.emit(f.DELETE_PRESET,{id:a})},E=function(a){var b=d.getSelectedVillage(),c=b.getId();e.emit(f.RECRUIT_PRESET,{village_id:c,preset_id:a})},F=function(){var a="armyHotkey",b=d.getSelectedCharacter();return a+"_"+b.getId()+"_"+b.getWorldId()},G=function H(a,b,c,g,h,k,l){if("attack"===b){if(g)return;if(!k&&j.getEffect("attack_protection")&&!h)return void i.openAttackProtectionModal(function(){H(a,b,g,h,!0,l)})}e.emit(f.SEND_PRESET,{start_village:d.getSelectedVillage().getId(),target_village:c,army_preset_id:a,type:b}),l&&l()};return{getBasicPresetData:p,showPresetInfoModal:r,showPresetListModal:s,showPresetNameModal:A,showPresetUnassignModal:v,showPresetDeleteModal:w,showPresetIconModal:z,showPresetEditModal:B,showPresetSaveModal:y,unassignPreset:u,assignPresets:t,recruitPreset:E,createPreset:C,deletePreset:D,savePreset:x,getStorageKey:F,sendPreset:G}}])}),define("services/CookieService",["app"],function(a){a.factory("cookieService",["$timeout","$browser","ipCookie","$q",function(a,b,c,d){var e=5e3,f=function(f,g,h){var i,j,k=d.defer();g||(g={}),void 0===g.path&&(g.path="/");for(j in f)c(j,f[j],g);return i=a(function(){k.reject("timeout of "+e+" ms reached")},h||e),b.addPollFn(function(){var c,d=b.cookies();for(c in f)if(!d[c])return;a.cancel(i),k.resolve(d)}),k.promise},g=function(f,g){var h,i,j=d.defer();for(i in f)c.remove(i),c.remove(i,{path:"/page"});return h=a(function(){j.reject("timeout of "+e+" ms reached")},g||e),b.addPollFn(function(){var c,d=b.cookies();for(c in f)if(d[c])return;a.cancel(h),j.resolve(d)}),j.promise};return{set:f,remove:g}}])}),define("services/TribeApplicationsService",["app"],function(a){a.factory("tribeApplicationsService",["socketService","modelDataService","routeProvider",function(a,b,c){var d=function(){return b.getApplications().isLoaded()||a.emit(c.TRIBE_APPLICATION_GET_OWN,{}),b.getApplications().getData()};return{getApplications:d}}])}),define("services/RavenTagService",["app"],function(a){a.factory("ravenTagService",[function(){return{tags:{}}}])}),define("services/TagManagerService",["app","helper/uri"],function(a,b){a.factory("tagManagerService",["scriptLoadingService",function(a){var c={unregistered:"unregistered",guest:"guest-player",registered:"registered-player",validated:"validated-player"},d={username_too_short:"username_too_short",username_too_long:"username_too_long",username_bad_char:"username_bad_char",password_too_short:"password_too_short",email_not_valid:"email_not_valid",terms_not_accepted:"terms_not_accepted",no_beta_key_entered:"no_beta_key_entered",email_already_in_use:"email_already_in_use",username_already_in_use:"username_already_in_use",username_invalid:"username_invalid",beta_key_invalid:"beta_key_invalid",wrong_password:"wrong_password",character_banned:"character_banned"},e="GTM-MZTCC5",f=function(){window.dataLayer=[],a.load("//www.googletagmanager.com/gtm.js?id="+e,null,!1,{async:!0})},g=function(a,b,c,d){window.dataLayer||f(),window.dataLayer.push({event:a,eventCategory:b,eventAction:c,eventLabel:d})},h=function(a,c,d,e,g){var h,i;window.dataLayer||f(),h=b.getURLParam("start_page_type"),h&&(i=h.substring(h.indexOf("_")+1,h.length),h=h.substring(0,h.indexOf("_"))),window.dataLayer.push({campaignRef:e||"none",pageArea:h||"gamepage",pageMarket:g,pageName:a,pagePool:"tw2",pageScope:"index",pageType:h||"game",pageVersion:i,visitorGameId:"",visitorLoginState:c,visitorState:d,"gtm.start":(new Date).getTime(),event:"gtm.js"})};return{VISITOR_STATES:c,ERROR_STATES:d,setTagData:h,push:g,init:f}}])}),define("services/AudioManagerService",["app","helper/time","conf/recruitingQueueTypes"],function(a,b,c){a.factory("audioManagerService",["$rootScope","audioService","eventTypeProvider","modelDataService","settingsService","reportService",function(a,d,e,f,g,h){var i,j=!1,k=0,l=null,m=null,n=null,o=null,p=null,q=!1,r=[{type:e.VILLAGE,received:!1},{type:e.COMMAND_OWN_COMMANDS,received:!1},{type:e.CHARACTER_INFO,received:!1},{type:e.VILLAGE,received:!1}],s={},t=function(a,b){var c=b||150,e=Date.now();s[a]&&e-s[a]<c||(s[a]=e,d.playSound(a))},u=function(){var a=m.getVillagesForIncoming("attack");return a[o.getId()]},v=function(a,b){!b&&u()&&t("select_attacked_village")},w=function(){return l.flush(),p.isInTutorial()?["tutorial"]:u()?["defend"]:l.hasOutgoingAttack(!0)?["attack"]:l.hasReturningCommands(!0)||!l.hasCommands(!0)?["theme","night","peace"]:["theme"]},x=function(){var a,b,c,e;g.settings.game.music&&(a=d.currentTrack,b=w(),a&&(c=a.type),-1===b.indexOf(c)&&(e=b.random(),d.playTrack(e)))},y=function(){l=o.getCommandListModel()},z=function(){o=f.getSelectedVillage(),i=o.getId()},A=function(a,b){return function(){t(a,b)}},B=function(a,b){"attack"===b.type&&t("attack_sent")},C=function(a,b){t(b)},D=function(){d.onSettingsChanged()},E=function(){r.forEach(function(a){a.unbindMethod()})},F=function(a,b){b.character_id!==f.getSelectedCharacter().getId()&&t("tribeforum")},G=function(a,b){var c=["timber_camp","clay_pit","iron_mine","barracks","statue","wall","hospital","market","tavern","academy","church","preceptory","fortress"];if(b.village_id===i)return 1===b.level&&-1!==c.indexOf(b.building)?void t("construct_"+b.building):void t("levelup_finished")},H=function(a,b){t(b.premium>k?"premium_added":"premium_spent"),k=b.premium},I=function(a,b){"attack"===b.type&&t("attack_incoming")},J=function(a,b){return f.getGameData().getNewReportCount()?void 0:h.BATTLE_TYPES[b.type]?void t("report_battle"):void t("report_01")},K=function(a,b){var d=f.getGameData().getSpecialUnitNames(),e=o.getRecruitingQueue(c.BARRACKS),g=o.getRecruitingQueue(c.ACADEMY),h=o.getRecruitingQueue(c.STATUE),j=o.getRecruitingQueue(c.PRECEPTORY);if(b.villageId===i&&0===e.jobs.length&&0===g.jobs.length&&0===h.jobs.length&&0===j.jobs.length)return"snob"===b.unitType?void t("recruit_noble_finished_01",1e3):-1!==d.indexOf(b.unitType)?void t("recruit_special_finished_01",1e3):void t("recruit_finished_01",1e3)},L=function(a,b){b.new_level&&A("achievement_01")},M=function(a,b){var c,d,e,g,h,i=f.getQuestLineListModel(),j=i?i.getQuestLineModels():[];for(g=0;g<j.length;g++)if(c=j[g],!c.isFinished())for(d=c.getQuestModels(),h=0;h<d.length;h++)e=d[h],e.data.quest_id===b.quest_id&&e.isFinishable()&&A("quest_progress_01")},N=function(a,b){b.village_id===i&&A("levelup_start_01")},O=function(a,b){b.village_id===i&&A("recruit_start_01",1e3)},P=function(a,b){b.village_id===i&&A("recruit_special_start_01")},Q=function(a,b){b.village_id===i&&A("recruit_special_start_01")},R=function(a,b){b.village_id===i&&A("recruit_noble_start_01")},S=function(a,b){b.village_id===i&&A("recruit_spy_start_01")},T=function(a,b){b.village_id===i&&A("recruit_spy_finished_01")},U=function(){var b=f.getPlayer().getId(),c=f.getSelectedCharacter().getOwnerId();a.$on(e.AUDIO_PLAY_SFX,C),a.$on(e.GAME_SETTINGS_CHANGED,D),b===c&&(a.$on(e.COMMAND_OWN_COMMANDS,y),a.$on(e.VILLAGE,z),a.$on(e.COMMAND_SENT,B),a.$on(e.COMMAND_INCOMING,I),a.$on(e.REPORT_NEW,J),a.$on(e.FORUM_POST_CREATED,F),a.$on(e.FORUM_THREAD_CREATED,F),a.$on(e.BUILDING_LEVEL_CHANGED,G),a.$on(e.PREMIUM_CHANGED,H),a.$on(e.MAP_VILLAGE_VIEW,v),a.$on(e.BUILDING_UPGRADING,N),a.$on(e.QUESTS_QUEST_PROGRESS,M),a.$on(e.ACHIEVEMENT_PROGRESS,L),a.$on(e.BARRACKS_RECRUIT_JOB_CREATED,O),a.$on(e.PRECEPTORY_RECRUIT_JOB_CREATED,P),a.$on(e.STATUE_RECRUIT_JOB_CREATED,Q),a.$on(e.ACADEMY_RECRUIT_JOB_CREATED,R),a.$on(e.SCOUTING_RECRUITING_STARTED,S),a.$on(e.SCOUTING_SPY_PRODUCED,T),a.$on(e.UNIT_RECRUIT_JOB_FINISHED,K),a.$on(e.VILLAGE_CONQUERED,A("nobled_village")),a.$on(e.QUESTS_QUEST_LINE_STARTED,A("quest_new_01")),a.$on(e.QUESTS_QUEST_FINISHED,A("quest_finished_01")),a.$on(e.QUESTS_QUEST_LINE_FINISHED,A("quest_finished_01")),a.$on(e.MESSAGE_NEW,A("message")),a.$on(e.RESEARCH_RESEARCHED,A("research_finished")),a.$on(e.PREMIUM_ITEM_BOUGHT,A("premium_spent")),a.$on(e.MAP_SELECT_VILLAGE,A("change_village")),a.$on(e.MESSAGE_ERROR,A("error")),a.$on(e.ACADEMY_MINTED_COINS,A("mint_coin")))},V=function(a){var c=0;j||(r.forEach(function(b){b.type===a.name&&(b.received=!0),b.received||c++}),c||(p=f.getSelectedCharacter(),m=p.getGlobalInfo().getCommandListModel(),o=f.getSelectedVillage(),n=f.getWorldConfig(),l=o.getCommandListModel(),k=f.getPlayer().getPremium(),E(),U(),b.timer.add(x),b.timer.tick(),j=!0))},W=function(){q||(r.forEach(function(b,c){r[c].unbindMethod=a.$on(b.type,V)}),q=!0)},X=function(){if(W(),!g.settings.game.music&&!g.settings.game.sfx){var a=function(){X(),d.off("settings:changed",a)};return void d.on("settings:changed",a)}d.init("theme")};return{init:X}}])}),define("models/EventEmitter",[],function(){var a=function(){this.events={}};return a.prototype.on=function(a,b){this.events[a]=this.events[a]||[],this.events[a].push(b)},a.prototype.off=function(a,b){var c,d,e=b.toString();if(!this.events[a])throw new Error("Could not remove event '"+a+"' event not bound.");for(c=this.events[a].length,d=0;c>d;d++)if(this.events[a][d].toString()===e)return void this.events[a].remove(d);throw new Error("Could not remove event '"+a+"' event bound but callback not found.")},a.prototype.trigger=function(a){var b=Array.prototype.slice.call(arguments,1);this.events[a]&&this.events[a].forEach(function(a){return b.length?void a.apply(null,b):void a()})},a.prototype.teardownEventsByName=function(a){
var b=this;if(!this.events[a])throw new Error("Could not remove events for name '"+a+"'. No events bound.");this.events[a].forEach(function(c){b.off(a,c)})},a.prototype.teardown=function(){var a;for(a in this.events)this.teardownEventsByName(a)},a}),define("models/audio/AudioSpriteListModel",["models/EventEmitter"],function(a){var b=function(a,b,c){this.enabled=a,this.volume=b,this.fade=c,this.sprites={}};return b.inherits(a),b.prototype.add=function(a){var b=a.type;this.sprites[b]=a},b.prototype.setVolume=function(a){this.volume=a,this.update()},b.prototype.setEnabled=function(a){this.enabled=a,this.update()},b.prototype.update=function(){var a;for(a in this.sprites)this.sprites[a].update()},b.prototype.getSprite=function(a){if(!this.sprites[a])throw new Error("Unknown type '"+a+"' given.");return this.sprites[a]},b}),define("services/AudioService",["app","conf/conf","models/audio/AudioSpriteListModel","models/EventEmitter"],function(a,b,c,d){a.factory("audioService",["$timeout","httpService","settingsService","audioSpriteModelProvider",function(a,e,f,g){var h=function(){this.data=null,this.trackEndTimeout=null,this.fadeDuration=1e3,this.minimumPlayTime=2*this.fadeDuration,this.currentTrack=null,b.PROD||(f.settings.game.music=!1,f.settings.game.sfx=!1),this.musicEnabled=f.settings.game.music,this.musicVolume=f.settings.duration.musicVolume/100,this.sfxEnabled=f.settings.game.sfx,this.sfxVolume=f.settings.duration.sfxVolume/100,this.musicInitialized={},this.sfxInitialized=!1,this.musicSprite=new c(this.musicEnabled,this.musicVolume,!0),this.sfxSprite=new c(this.sfxEnabled,this.sfxVolume)};return h.inherits(d),h.prototype.onSettingsChanged=function(){this.musicEnabled=f.settings.game.music,this.musicVolume=f.settings.duration.musicVolume/100,this.sfxEnabled=f.settings.game.sfx,this.sfxVolume=f.settings.duration.sfxVolume/100,this.musicSprite.setVolume(this.musicVolume),this.musicSprite.setEnabled(this.musicEnabled),this.sfxSprite.setVolume(this.sfxVolume),this.sfxSprite.setEnabled(this.sfxEnabled),this.musicSprite.enabled||(this.currentTrack=null),this.data&&(this.initMusicSprites(),this.initSFXSprite()),this.trigger("settings:changed")},h.prototype.initMusicSprites=function(a,b){var c;if(this.musicEnabled)for(c in this.data.tracks)a&&a!==c||b&&b===c?this.musicInitialized[c]=!1:this.musicInitialized[c]||(this.musicSprite.add(g(this.musicSprite,c,this.data.tracks[c])),this.musicInitialized[c]=!0)},h.prototype.initSFXSprite=function(){var a;if(this.sfxEnabled&&!this.sfxInitialized){for(a in this.data.sfx)this.sfxSprite.add(g(this.sfxSprite,a,this.data.sfx[a]));this.sfxInitialized=!0}},h.prototype.onData=function(a){this.data=a},h.prototype.init=function(a,c){var d=this;e.get(b.SOUND_JSON_PATH,function(b){d.onData(b),d.initSFXSprite(),d.initMusicSprites(a,c)})},h.prototype.playTrack=function(b){var c,d,e=this;return this.musicEnabled&&this.musicInitialized[b]?(c=this.musicSprite.getSprite(b),d=c.getNextPlayableTrackName(),this.currentTrack&&this.currentTrack.fadeOut(),c.play(d),this.currentTrack=c,this.trackEndTimeout&&a.cancel(this.trackEndTimeout),this.trackEndTimeout=a(function(){e.currentTrack=null,e.trigger("track:onend")},c.getTrackDuration(d)),!0):!1},h.prototype.playSound=function(a){var b;return this.sfxEnabled?(b=this.sfxSprite.getSprite("main"),b.play(a),!0):!1},new h}])}),define("services/HttpCdnRequestInterceptorService",["app","cdn"],function(a,b){a.factory("httpCdnRequestInterceptorService",[function(){return{request:function(a){return a.url=b.getPath(a.url),a}}}])}),define("services/OfficerInfoService",["app"],function(a){a.factory("officerInfoService",["$rootScope","windowManagerService",function(a,b){var c=function(c){var d=a.$new();d.name=c,d.close=function(){d.closeWindow()},b.getModal("modal_officer_info",d)};return{openOfficerInfo:c}}])}),define("services/ForumThreadService",["app"],function(a){a.factory("forumThreadService",["socketService","routeProvider","modelDataService",function(a,b,c){var d=function(a,b,c,d){var e,f,g=a.getThreadsForForum(b);if(!g)return!1;for(e=c;c+d>e&&e<g.totalThreads;e++)if(!g.threads[e]||g.threads[e].dirty)return!1;if(g.dirty)for(f=a.getLastLoadedIndex(b),c+d>=f&&(g.dirty=!1),e=0;c+d>e;e++)if(!g.threads[e])return!1;return!0},e=function(e,f,g,h){var i,j={},k={},l=c.getTribeForumThreadListModel();if(k.threads=[],k.offset=f,k.total=0,l&&d(l,e,f,g)){for(j=c.getTribeForumThreadListModel().getThreadsForForum(e),i=f;f+g>i&&i<j.totalThreads;i++)j.threads[i]&&k.threads.push(j.threads[i]);k.offset=f,k.total=j.totalThreads}else a.emit(b.FORUM_LIST_THREADS,{forum_id:e,offset:f,count:g});h(k)},f=function(a){var b,d=c.getTribeForumThreadListModel();d.reorderThreads(a.thread.forum_id,[a.thread]),(b=d.getThreadById(a.thread.id))&&(b.read=a.player_id===c.getPlayer().getId())},g=function(a,b){var d;for(d=0;d<a.length;d++)b?c.getGameData().addNewThread(a[d]):c.getGameData().removeNewThread(a[d])};return{requestThreadList:e,updateLastPost:f,updateNewThreadCount:g}}])}),define("services/PreceptoryService",["app"],function(a){a.factory("preceptoryService",["$rootScope","modelDataService","routeProvider","windowManagerService","premiumActionService","socketService","eventTypeProvider","inventoryItemTypeProvider",function(a,b,c,d,e,f,g,h){var i,j,k,l=function(){i.missingResources||(f.emit(c.PRECEPTORY_RESET_ORDER,{village_id:j.getId(),premium:!1}),i.closeWindow())},m=function(){e.resetOrder(),i.closeWindow()},n=function(a,b){a.resources=b||j.getResources().getResources(),a.missingWood=a.resources.wood<a.requiredWood,a.missingClay=a.resources.clay<a.requiredClay,a.missingIron=a.resources.iron<a.requiredIron,a.missingResources=a.missingWood||a.missingClay||a.missingIron},o=function(){var c,e=b.getGameData().getOrderResetResourceCost();j=b.getSelectedVillage(),i=a.$new(),c=i.closeWindow,i.closeWindow=function(){k(),c()},i.requiredIron=e.iron,i.requiredClay=e.clay,i.requiredWood=e.wood,i.premiumCost=b.getGameData().getPremiumCostsForType(h.RESET_ORDER),i.buyUsingResources=l,i.buyUsingPremium=m,n(i),k=i.$on(g.RESOURCES,function(a,b){n(i,{wood:b.wood.currentProduction,clay:b.clay.currentProduction,iron:b.iron.currentProduction})}),d.getModal("modal_reset_order",i)};return{resetOrder:o}}])}),define("services/UtilityService",["app","helper/util","helper/time"],function(a,b,c){a.factory("utilityService",["$rootScope","$filter","socketService","routeProvider","modelDataService","windowManagerService",function(a,b,d,e,f,g){var h=b("i18n"),i=function(a,b){if(!a||!b)throw new Error("newEmail and repeatNewEmail have to be defined.");return a!==b?!1:void d.emit(e.PLAYER_EMAIL_REQUEST_CHANGE,{new_address:a})},j=function(b,c,d,e,f){var i=a.$new();i.submitText=h("OK",a.loc.ale),i.title=h(e||"title",a.loc.ale,b),i.text=h(d||"text",a.loc.ale,b),i.boxText=h(c||"box_text",a.loc.ale,b,f),i.submit=function(){i.closeWindow()},g.getModal("modal_attention",i)},k=function(){j("mail_in_use")},l=function(d){var e,g,h,i,k=f.getSelectedCharacter().hasValidatedEmail();d&&d.timeout?(e="box_text_in_progress",g="text_rejected",h="title_rejected",i=b("readableDateFilter")(c.server2ClientTime(d.timeout),a.loc.ale)):e=k?"box_text_validated":"box_text_unvalidated",j("request_mail_change",e,g,h,i)},m=function(){j("open_mail_change")};return{changeEmail:i,showEmailInUseModal:k,showEmailChangeSentModal:l,showEmailInChangeModal:m}}])}),define("services/OverviewService",["app","models/CommandModel"],function(a,b){a.factory("overviewService",["$rootScope","$filter","socketService","routeProvider","windowManagerService","groupService","eventTypeProvider","modelDataService",function(a,c,d,e,f,g,h,i){var j={OWN:"own",ALL:"all",OUT:"out",WAY:"way"},k=function(a){var c,d,e=["target","origin"],f="_groups",h=g.getGroups();for(d=0;d<e.length;d++){for(c=0;c<a[e[d]+f].length;c++)a[e[d]+f][c]=h[a[e[d]+f][c]];a[e[d]+"Village"]={name:a[e[d]+"_village_name"],x:a[e[d]+"_x"],y:a[e[d]+"_y"],id:a[e[d]+"_village_id"]},a[e[d]+"Character"]={name:a[e[d]+"_character_name"],id:a[e[d]+"_character_id"]}}a.model=new b({id:a.command_id,start_village_id:a.origin_village_id,start_village_name:a.origin_village_name,time_completed:a.time_completed,time_start:a.time_start,type:a.command_type,x:a.origin_x,y:a.origin_y,direction:a.direction}),a.time_completed=a.model.arrivalTime()},l=function(b){var g=a.$new();g.title=b.command_name||c("i18n")("command_"+b.command_type,a.loc.ale,"screen_village_info"),g.submit=function(){g.title.length<1||g.title.length>10||(d.emit(e.COMMAND_RENAME,{command_id:b.command_id,name:g.title}),b.command_name=g.title,g.closeWindow())},f.getModal("modal_rename_command",g)},m=function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].command_id===b)return a[c]};return{formatCommand:k,renameCommand:l,getCommandFromList:m,UNIT_STATUS:j}}])}),define("services/VillageAssetRequirementsService",["app"],function(a){a.factory("villageAssetRequirementsService",function(){var a="@",b="&&",c="active",d="construction",e="=",f=">",g="<",h=f+e,i=g+e,j="!",k="min",l="max",m="day",n="night",o="fortress",p="barracks",q="hospital",r="chapel",s="bg",t=function(a,b){var c,d,e,f=b[a].level;switch(a){case"church":c=1;break;case"rally_point":c=2;break;case"statue":c=2;break;case"wall":c=6,d=3;break;default:c=5}return 0===f?0:(e=Math.floor((f-1)/c)+1,d?Math.min(e,d):e)},u=function x(e){var m,n,o,p,q,r,s,t,u,v={};if("string"==typeof e){if(m=e.split(a),t=m[0],u=m[1],u&&u.indexOf(b)>0)return x(u.split(b).map(function(b){return t+a+b}));switch(u&&0===u.indexOf(j)&&(s=!0,u=u.replace(j,"")),u){case d:v[d]=s?!1:!0;break;case c:v[c]=s?!1:!0;break;case void 0:break;default:if(n=u.match(/[<>=]+/),!n||!n[0])break;switch(r=+m[1].replace(n[0],""),n[0]){case f:v[k]=r+1;break;case g:v[l]=r-1;break;case h:v[k]=r;break;case i:v[l]=r}}v.building=t}else if(e instanceof Array){for(v=e.map(x),o=v.length,q={};o--;)if(q[v[o].building]){for(p in v[o])q[v[o].building][p]=v[o][p];v.splice(o,1)}else q[v[o].building]=v[o];if(1===v.length)return v[0];v.building=v[0].building}return v},v=function y(a,b,e,f){var g,h,i=a;if(a.base&&(i=a.base,("string"==typeof i||i instanceof Array)&&(i=u(i)),a.night&&(i.night=!0)),i instanceof Array){for(g=i.length;g--;)if(0===g&&(i[g].lvl=a.lvl),!y(i[g],b,e))return!1;return!0}if(i.night&&f===m||!i.night&&f===n)return!1;if(i.building===s)return!0;if(!i.building||i.building===o)return!1;if(h=t(i.building,b),void 0!==a.lvl&&a.lvl.length&&!h.between(a.lvl[0],a.lvl[1]))return!1;if(void 0!==a.lvl&&!a.lvl.length&&a.lvl!==h)return!1;for(g in i)switch(g){case k:if(b[i.building].level<i[g])return!1;break;case l:if(b[i.building].level>i[g])return!1;break;case d:if(void 0===b[i.building].upgradingLevels||0!==b[i.building].upgradingLevels!==i[g])return!1;break;case c:if(i.building===p){if(!e||!e.length)return!1}else if(i.building===q)return!1}return!0},w=function(a,b){var c,d,e,f,g,h={},i=function(a){a.building===c&&f.level>=a.required_level&&g.push(a.name)};for(c in a){if(f=a[c],e=t(c,a),g=[],!(f.researches instanceof Array))for(d in f.researches)f.researches[d].researched&&g.push(d);c===p?b.forEach(i):c===r&&(e=0),h[c]||(h[c]={level:e,underConstruction:f.upgradingLevels,researched:f.researched,exists:!!f.level,researches:g})}return h};return{parseAnimationRequirements:u,checkAnimationRequirements:v,getBuildingAssetLevels:w}})}),define("services/StatueService",["app"],function(a){a.factory("statueService",["$rootScope","$filter","modelDataService","socketService","routeProvider","windowManagerService","premiumActionService","inventoryService",function(a,b,c,d,e,f,g,h){var i="building_statue",j=function(j){var k=c.getInventory().getItemByType("premium_paladin_instant_item");k&&k.amount?h.useItem(k,function(){var g=a.$new();g.actionType="",g.title=b("i18n")("premium_instant_recruit_item",a.loc.ale,i),g.description=b("i18n")("premium_instant_recruit_item_description",a.loc.ale,i),g.iconName="premium_paladin_instant_item",g.costs="",g.usable=!0,g.cancelable=!1,g.extras="",g.onConfirm=function(){d.emit(e.PREMIUM_USE_ITEM,{village_id:c.getSelectedVillage().getId(),item_id:k.id})},f.getModal("modal_premium",g)}):g.paladinInstantCall(j)},k=function(g,h){var j=a.$new();j.title=b("i18n")("recruit_cancel_title",a.loc.ale,i),j.text=b("i18n")("recruit_cancel_text",a.loc.ale,i),j.submitText=b("i18n")("recruit_cancel_submit",a.loc.ale,i),j.cancelText=b("i18n")("recruit_cancel_cancel",a.loc.ale,i),j.switchColors=!0,j.submit=function(){d.emit(e.STATUE_CANCEL_RECRUIT_JOB,{village_id:h||c.getSelectedVillage().getId(),job_id:g.job_id}),j.closeWindow()},j.cancel=function(){j.closeWindow()},f.getModal("modal_attention",j)};return{recruitPaladinWithPremium:j,cancelRecruitPaladin:k}}])}),define("services/AcademyService",["app","conf/recruitingQueueTypes"],function(a,b){a.factory("academyService",["$rootScope","$filter","windowManagerService","recruitingService",function(a,c,d,e){var f=function(f){var g=a.$new(),h="cancel_recruit_job";g.title=c("i18n")("title",a.loc.ale,h),g.text=c("i18n")("text",a.loc.ale,h),g.boxText=c("i18n")("boxText",a.loc.ale,h),g.submitText=c("i18n")("submitText",a.loc.ale,h),g.cancelText=c("i18n")("cancelText",a.loc.ale,h),g.switchColors=!0,g.submit=function(){e.cancelRecruitJob(b.ACADEMY,f),g.closeWindow()},g.cancel=function(){g.closeWindow()},d.getModal("modal_attention",g)};return{cancelTraining:f}}])}),define("services/L10NService",["app","angular","conf/conf"],function(a,b,c){a.service("l10nService",["$rootScope","$locale","$timeout","$q","scriptLoadingService",function(a,d,e,f,g){var h,i={},j=function l(a,c,d){h===d&&(b.forEach(a,function(d,e){c[e]?b.isArray(c[e])&&(a[e].length=c[e].length):delete a[e]}),b.forEach(c,function(e,f){b.isArray(c[f])||b.isObject(c[f])?(a[f]||(a[f]=b.isArray(c[f])?[]:{}),l(a[f],c[f],d)):a[f]=c[f]}))},k=function(k){var l;return i[k]?i[k]:(l=f.defer(),k===h?(l.resolve(d),l.promise):(h=k,i[k]=l.promise,g.load(c.L10N_PATH_EXT.join(k),function(){e(function(){var c=b.injector(["ngLocale"]),e=c.get("$locale");j(d,e,k),delete i[k],a.$broadcast("$localeChangeSuccess",k,d),l.resolve(d)})},!0),l.promise))};return{setLocale:k}}])}),define("services/ScriptLoadingService",["angular","app","cdn","battlecat"],function(a,b,c,d){b.service("scriptLoadingService",[function(){var b=document.getElementsByTagName("body")[0],e=function(a){d(a).remove()},f=function(d,f,g,h){var i,j=document.createElement("script");if(j.onload=function(){g&&e(j),a.isFunction(f)&&f(j)},h)for(i in h)j[i]=h[i];j.src=c.getPath(d),b.appendChild(j)};return{load:f}}])}),define("services/HotkeyManagerService",["app","queues/EventQueue","struct/MapData","helper/math"],function(a,b,c,d){a.factory("hotkeyManagerService",["$rootScope","$filter","$timeout","hotkeys","eventTypeProvider","villageService","windowManagerService","mapService","modelDataService","premiumService","storageService","presetService","contextMenuService",function(a,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s=250,t={},u=function(a,b,c,d,e){var f={};t[b]||(t[b]=[]),g.bindTo(a).add(f.hotkey={combo:b,description:c,callback:d,allowIn:e}),f.scope=a,t[b].push(f),a.$on("$destroy",function(){for(var c,d=t[b].length;d--;)t[b][d].scope.$id===a.$id&&t[b].splice(d,1);t[b].length>0&&(c=t[b][t[b].length-1],g.bindTo(c.scope).add(c.hotkey))})},v=function(a,b){if(!t[b])return!1;for(var c=t[b].length;c--;)t[b][c].scope.$id===a.$id&&t[b].splice(c,1);return g.del(b)},w=function(a,b){r=b},x=function(){var b=k.pixel2Tiles(r.x,r.y),e=c.getTownAt(b.x,b.y),f=l.getSelectedVillage().getPosition(),g=a.$new();return e?f.x===b.x&&f.y===b.y?!1:(g.target={data:{barbarianVillage:null===e.character_id},id:e.id,name:e.name},g.targetCharacterName=e.character_name,g.distance=d.actualDistance(f,e),g.villageId=e.id,g):!1},y=function(a,b){return{key:(a.key+1).toString(),func:function(c){if(!q){q=f(function(){q=null},s);var d=p.getMapMenuData();d.isOpen&&o.sendPreset(b,a.type,d.target.uniqueId,d.target.data.attack_protection,d.target.data.barbarianVillage,null)}},allowed:["SELECT"]}},z=function(){var c,d,e=n.getItem(o.getStorageKey()),f=[{key:"$",description:"buy_crowns",func:function(){m.openPaymentModal()}},{key:"v",description:"switch_view",func:function(){a.$broadcast(h.MAP_TOGGLE_VIEW)}},{key:"shift+left",description:"village_switch_left",func:function(){i.switchVillage(-1)}},{key:"shift+right",description:"village_switch_right",func:function(){i.switchVillage(1)}},{key:"h",description:"open_headquarter",func:function(){a.$broadcast(h.VILLAGE_SELECT_BUILDING,"headquarter")}},{key:"b",description:"open_barracks",func:function(){a.$broadcast(h.VILLAGE_SELECT_BUILDING,"barracks")}},{key:"a",description:"open_academy",func:function(){a.$broadcast(h.VILLAGE_SELECT_BUILDING,"academy")}},{key:"s",description:"open_statue",func:function(){a.$broadcast(h.VILLAGE_SELECT_BUILDING,"statue")}},{key:"t",description:"open_tavern",func:function(){a.$broadcast(h.VILLAGE_SELECT_BUILDING,"tavern")}},{key:"m",description:"open_market",func:function(){a.$broadcast(h.VILLAGE_SELECT_BUILDING,"market")}},{key:"r",description:"open_rally_point",func:function(){a.$broadcast(h.VILLAGE_SELECT_BUILDING,"rally_point")}},{key:"esc",description:"close_window",func:function(){var a=j.getLatestWindow();a&&a.scope.closeWindow()},allowed:["INPUT","SELECT","TEXTAREA"]},{key:"e",description:"send_custom_army",func:function(){var a=x();a&&j.getModal("modal_custom_army",a)}},{key:"f",description:"send_preset",func:function(){var a=x();a&&j.getModal("modal_send_preset",a)}},{key:"enter",description:"confirm",func:function(a){var b,c,d=j.getLatestWindow();"INPUT"!==a.target.tagName&&(a.preventDefault(),d&&d.scope.$$postDigest(function(){for(b=$(d.rootnode).find(".btn-green"),c=0;c<b.length;c++)$(b[c]).isVisible()&&b[c].click()}))},allowed:["INPUT","SELECT"]},{key:"space",description:"jump_active_village",func:function(){var b=l.getSelectedVillage();a.$broadcast(h.MAP_JUMP_TO,b.getX(),b.getY())},allowed:["SELECT"]}];for(d in e)f.push(y(e[d],d));for(d=0;d<f.length;d++)c=f[d],u(a,c.key,c.description,c.func,c.allowed);b.register(b.types.MOUSEMOVE,w)};return{addKey:u,removeKey:v,init:z,createPresetHotkey:y}}])}),define("services/ResourceDepositService",["app","conf/resourceDepositJobStates","conf/resourceDepositRewardTypes"],function(a,b,c){a.factory("resourceDepositService",["$rootScope","$timeout","$filter","modelDataService","eventTypeProvider","settingsService","iconAnimationsService",function(a,d,e,f,g,h,i){var j=1e3,k="unit_names",l="premium_items",m={resources:function(b){var d=b.content.clay;return{type:b.item_type,i18n:d+" x "+e("i18n")("name_"+b.item_type,a.loc.ale,l),icon:c.RESOURCES,animation:c.RESOURCES,amount:d}},units:function(b){var c=Object.keys(b.content),d=b.content[c[0]];return{type:b.item_type,i18n:e("i18n")(c[0],a.loc.ale,k,d),icon:"unit-"+c[0],animation:"unit-"+c[0],animationTarget:"premium",amount:d}},officer:function(b){return{type:b.item_type,i18n:e("i18n")("name_"+b.item_type,a.loc.ale,l,b.amount),icon:b.item_type,animation:b.item_type,amount:b.amount}},booster:function(b){return{type:b.item_type,i18n:e("i18n")("name_"+b.item_type,a.loc.ale,l,b.amount),icon:b.item_type,animation:b.item_type,amount:b.amount}},buildCostReduction:function(b){return{type:b.item_type,i18n:e("i18n")("name_"+b.item_type,a.loc.ale,l,b.amount),icon:b.item_type,animation:b.item_type,amount:b.amount}},reroll:function(b){return{type:b.item_type,i18n:e("i18n")("name_"+b.item_type,a.loc.ale,l,b.amount),icon:c.REROLL,animation:b.item_type,amount:b.amount}},effect:function(b){return{type:b.item_type,i18n:e("i18n")("effect_"+b.content.type,a.loc.ale,l,b.amount),icon:b.content.type,animation:b.content.type,amount:b.amount}}},n=function(){return f.getSelectedCharacter().getResourceDeposit()},o=function(a){return void 0===a?h.settings.game.resourceDepositUsed:void(h.settings.game.resourceDepositUsed=a)},p=function(a){return void 0===a?h.settings.game.resourceDepositShowReroll:(h.settings.game.resourceDepositShowReroll=a,void h.saveGameSettings(!1,!0))},q=function(){o(!0),h.saveGameSettings(!0)},r=function(b){a.$broadcast(g.RESOURCE_DEPOSIT_JOB_COLLECTIBLE),n().jobCompleted(b)},s=function(a){var c=f.getSelectedCharacter().getSelectedVillage().getTimeline(),e=function(){a.state!==b.COMPLETED&&r(a)};d(e,a.model.completedAt-Date.now()+j),c&&c.insert({id:a.id,type:"resource_deposit",time:(a.model.completedAt+j)/1e3,requestSent:!0,details:{amount:a.amount,type:a.resource_type},onCompleted:e})},t=function(){return!o()},u=function(c,d){var e,f,h;for(f=n().updateJobData(c,r,d),h=f.length;h--;)e=f[h],e.time_completed&&(e.state===b.RUNNING?s(e):e.state===b.COMPLETED&&a.$broadcast(g.RESOURCE_DEPOSIT_JOB_COLLECTIBLE));return f},v=function(a,b){o()||(q(),o(!1)),u([{id:b.job_id,time_completed:b.time_completed}],!1)},w=function(a,b){var c,d,e,f,g=n(),h=g.removeJob(b.job_id),j=b.milestones_reached,k=g.getMilestones();if(g.resourcesLeft=b.resources_left,j)for(e=0;e<j.length;e+=1)for(f=0;f<k.length;f+=1)d=k[f],c=k[f+1],d.target===j[e]&&(d.achieved=!0,c&&(c.ignore=!1),i.createAnimations([d.animation],d.animationTarget));i.createAnimations(["resource-"+h.resource_type])},x=function(a){return n().updateMilestones(a,m)};return a.$on(g.RESOURCE_DEPOSIT_JOB_STARTED,v),a.$on(g.RESOURCE_DEPOSIT_JOB_COLLECTED,w),{disableHint:q,updateTimeline:s,updateJobData:u,firstUse:t,updateMilestones:x,showRerollButton:p}}])}),define("services/SecondVillageService",["app","angular","helper/time"],function(a,b,c){a.factory("secondVillageService",["$rootScope","socketService","routeProvider","eventTypeProvider","modelDataService","windowManagerService",function(a,d,e,f,g,h){var i=function(a,c,d){var e;for(e in a)if(a.hasOwnProperty(e)){if(b.isUndefined(c[e]))continue;(c[e].level||c[e])>=a[e]&&(d[e]=!0)}return Object.keys(d).length===Object.keys(a).length},j=function(a,b,c){var d,e,f,h,j,k=g.getGameData().getBuildingTypes(),l="_level",m={};for(j=0;j<c.length;j++){e=c[j];for(f in k)d=k[f],h=e[d+l],m[d]?h>m[d]&&(m[d]=h):m[d]=h}return i(a.buildings_required,m,b)},k=function(a,b,c){var d=g.getSelectedVillage(),e=d.getBuildingData().data;return i(b.buildings_required,e,a)?!0:1===g.getSelectedCharacter().getVillages().length?!1:j(b,a,c)},l=function(a,b){var c;for(c=0;c<a.jobs_required.length;c++)if(!b[a.jobs_required[c]])return!1;return!0},m=function(a,b){var c,d={};for(c in a)a[c].day===b&&(d[c]=a[c]);return d},n=function(a,b){var c,d=[];for(c in b)""!==a[c].building_graphic&&d.push(a[c].building_graphic);return d},o=function(a,b,c,d){var e,f,g,h={},i={};for(g in a)e={},l(a[g],b)&&k(e,a[g],d)&&(i[g]=a[g]);for(g in i)f=i[g],c.wood>=f.costs.wood&&c.clay>=f.costs.clay&&c.iron>=f.costs.iron&&!f.collected&&(h[g]=f);return h},p=function(a,b,c,d){var e,f,g,h={};for(g in a)e={},f=a[g],l(a[g],b)&&(!k(e,f,d)||c.wood<f.costs.wood||c.clay<f.costs.clay||c.iron<f.costs.iron)&&(h[g]=f);return h},q=function(a,b){var c,d={};for(c in a)(a[c].collected||a[c].day<b)&&(d[c]=!0);return d},r=function(a){var b,d={id:!1,time_completed:0},e=Date.now();for(b in a)if(a[b].time_started&&a[b].time_completed){if(e<c.server2ClientTime(a[b].time_completed))return b;e>=c.server2ClientTime(a[b].time_completed)&&!a[b].collected&&a[b].time_completed>d.time_completed&&(d.id=b,d.time_completed=a[b].time_completed)}return d.id},s=function(a,b){var c,d,e={};for(d in b)c=b[d],c.collected&&c.day===a-1&&(e[d]=c);return e},t=function(a){var b="celebrate_new_village";return a[b].collected},u=function(){var a=g.getSelectedCharacter();return g.getWorldConfig().isSecondVillageEnabled()?a.isInTutorial()?!1:a.getAmountLogins()<g.getGameData().getBaseData().show_second_village_after_login_nr?!1:a.getSecondVillageStatus()?!1:!0:!1};return{hasBuildingLevels:i,checkOtherVillages:j,hasRequiredBuildings:k,getCurrentDayJobs:m,getCollectedJobs:q,getAvailableJobs:o,getJobInProgress:r,getBuildings:n,getUnmetRequirementJobs:p,getYesterdaysCollected:s,hasFinishedLastJob:t,isFeatureActive:u}}])}),define("conf/tracking",[],function(){var a={};return a.TUTORIAL={NAMES:{0:{name:"tutorial_start_next_step",step:0},1:{name:"open_hq_screen_select_headquarter",step:1},2:{name:"open_hq_screen_enter_headquarter",step:1},3:{name:"upgrade_hq_resources_info",step:2},4:{name:"upgrade_hq_upgrade_in_screen",step:2},5:{name:"upgrade_hq_instant_build",step:2},6:{name:"upgrade_barracks_next_step",step:2},7:{name:"upgrade_barracks_build_in_screen",step:3},8:{name:"upgrade_barracks_instant_build",step:3},9:{name:"upgrade_barracks_build_finished",step:3},10:{name:"upgrade_barracks_close_headquarter_screen",step:3},11:{name:"open_barracks_screen_select_barracks",step:4},12:{name:"open_barracks_screen_enter_barracks",step:4},13:{name:"recruit_spearmen_provisions_info",step:5},14:{name:"recruit_spearmen_select_spearmen",step:5},15:{name:"recruit_spearmen_set_amount",step:5},16:{name:"recruit_spearmen_start_recruiting",step:5},17:{name:"recruit_spearmen_close_screen",step:5},18:{name:"recruit_spearmen_spearmen_info",step:5},19:{name:"recruit_spearmen_unitbar_info",step:5},20:{name:"recruit_spearmen_enter_map",step:5},21:{name:"attack_village_barbarian_info",step:6},22:{name:"attack_village_select_barbarian",step:6},23:{name:"attack_village_select_attack",step:6},24:{name:"attack_village_select_spearmen_amount",step:6},25:{name:"attack_village_attack",step:6},26:{name:"attack_village_attack_finished",step:6},27:{name:"start_quests_explain_quests",step:7}}},a}),define("services/TrackingService",["app","conf/tracking"],function(a,b){a.factory("trackingService",["routeProvider","socketService",function(a,c){var d=b.TUTORIAL,e=function(b){var e,f,g=d.NAMES[b];g&&(e=g.name,f=g.step,c.emit(a.TRACK_EVENT,{category:"prog",event_name:"quest",tracking_data:["tutorial",e,f,"click"]}))};return{trackTutorialAction:e}}])}),define("services/ErrorService",["app","helper/i18n"],function(a,b){a.factory("errorService",["$rootScope","errorTypeProvider","$filter",function(a,c,d){var e="error_message",f={},g=function(a){var b,c,d={};for(b=0;b<a.length;b++)c=a[b],d[c.key]=c.value;return d},h=function(c,h){var i,j,k,l;return f[c.code]?(i=c.code+"/"+c.cause,j=b.hasTranslation(c.code,e),k=b.hasTranslation(i,e),(k||j)&&(l=[a.loc.ale,"error_message"].concat(c.details.map(function(a){return a.value})),k?l.unshift(i):j&&l.unshift(c.code),c.message=d("i18n").apply(this,l)),c.details=g(c.details),void a.$apply(function(){a.$broadcast(c.code,c)})):void h()},i=function(){var a;for(a in c)f[c[a]]=a};return i(),{handle:h}}])}),define("services/FeatureService",["app"],function(a){a.factory("featureService",["modelDataService","inviteFriendService",function(a,b){var c=function(){var c=a.getWorldConfig();c.isInviteToMapEnabled()&&b.getInfo()};return{getInfo:c}}])}),define("services/InviteFriendService",["app","conf/conf","struct/MapData","helper/util","queues/EventQueue"],function(a,b,c,d,e){a.factory("inviteFriendService",["$rootScope","$filter","modelDataService","socketService","routeProvider",function(a,f,g,h,i){var j="invite_friend",k=b.RESERVED_VILLAGE_IDS.INVITE_A_FRIEND,l=function(){return c.getTownById(k)},m=function(b){if(b&&b.x&&b.y){var d=l();d||(c.setSpecialLocationData({villages:[{x:b.x,y:b.y,name:f("i18n")("fake_village_name_map",a.loc.ale,j),id:k}],x:b.x,y:b.y}),e.trigger(e.types.MAPDATA_UPDATE,null))}},n=function(){var a=l();a&&(c.removeSpecialLocation(k),e.trigger(e.types.MAPDATA_UPDATE,null))},o=function(a,b,c,e){var f=d.checkEmail(b);return!!(f&&a&&c&&e)},p=function(a,b,c,d,e,f){var j,k=g.getSelectedCharacter(),l=k.getInviteInfo();l&&o(a,b,c,e)&&(j={email:b,invitee_name:a,inviter_name:c,message:d,consent:e,x:l.position.x,y:l.position.y},h.emit(i.INVITE_FRIEND_SEND_INVITE,j),f&&f())},q=function(){h.emit(i.INVITE_FRIEND_GET_INFO)};return{getFakeVillage:l,spawnFakeVillage:m,removeFakeVillage:n,areInvitationParamsValid:o,sendInvitation:p,getInfo:q}}])}),define("services/RewardService",["app"],function(a){a.factory("rewardService",["$rootScope","$filter",function(a,b){var c={reward_resources:"resource_names",reward_units:"unit_names",premium_package:"premium_items",none:"premium_items"},d=function(a){return Object.keys(a.content)[0]},e=function(a){return a.content?a.content[d(a)]:a.amount},f=function(a){return a.content?d(a):"premium_package"===a.item_type?"premium_package_no_name":"name_"+a.item_type},g=function(d){if(!d||!d.item_type)return"Reward - N/A";var g,h=c[d.item_type]||c.none,i=f(d),j=e(d);return void 0!==j&&(g=b("number")(j)),b("i18n")(i,a.loc.ale,h,g,j)},h=function(c){var d,e="premium_items";return c&&c.item_type?(d="reward_resources"===c.item_type?"description_reward_resources":"reward_units"===c.item_type?"description_reward_units":"premium_package"===c.item_type?"description_premium_package_quest_reward":"description_"+c.item_type,b("i18n")(d,a.loc.ale,e)):""},i=function(a){if(!a||!a.item_type)return"";switch(a.item_type){case"reward_resources":return"resource-"+d(a);case"reward_units":return"unit-"+d(a);case"premium_package":return"premium-package-0"}return a.item_type};return{getIconName:i,getDisplayedName:g,getDisplayedDescription:h}}])}),define("services/TribeSkillService",["app"],function(a){a.factory("tribeSkillService",["effectService",function(a){var b=20,c=2,d=3.5,e=100,f=function(a){var b,c,d=1;for(c=0;c<a.length;c++)b=a[c],d+=b.maxLevel;return d},g=function(a){return Math.ceil(Math.pow(a,d)*e)},h=function(a){var b,c=0;for(b=1;a>b;b++)c+=g(b);return c},i=function(a){var b,c,d=0;for(c=0;c<a.length;c++)b=a[c],d+=b.currentLevel;return d},j=function(a,b,c){var d,e,g,i=f(a),j=h(c);for(g=0;i>g&&(d=h(c+g+1)-h(c+g),!(d>b))&&(e=b+j-d,e>=0);g++)b=e-j;return{levels:g,remaingingExp:b}},k=function(a,c){var d,e,f=[];for(e=0;e<a.length;e++)d=a[e],d.points_needed<c*b&&f.push(d);return(c*b-i(f)).bound(0,1/0)},l=function(a){var c,d,e,f=[];for(e=0;e<a.length;e++)c=a[e],0===c.points_needed?d=0:c.points_needed<=b?d=1:c.points_needed<=2*b&&(d=2),f[d]||(f[d]={skills:{},missingSkillPoints:k(a,d)}),f[d].skills[c.type]=c;return f},m=function(a,b){var c,d=f(a);for(c=0;d>c;c++)if(b<h(c+1))return c;return d},n=function(a,b){return c>b?0:b-i(a)-1},o=function(a,b){var c,d=0;for(c=0;b>=c;c++)d=a-h(c);return d},p=function(b,c){var d,e,f=[],g=b.effectItems[0].length,h=0,i=0;if(0===g)return f;for(b.currentLevel>0&&(i=b.currentLevel-1),d=0;g>d;d++)if(c&&b.effectItems[i][d].type===c){h=d;break}return e=a.getEffectValuePropertyName(b.effectItems[i][h].type),f.push(a.formatEffectValueForDisplay(e,b.effectItems[i][h][e],c)),0===b.currentLevel?f.unshift("0"):b.maxLevel>b.currentLevel&&f.push(a.formatEffectValueForDisplay(e,b.effectItems[i+1][h][e],c)),f};return{createTierData:l,getTribeLevel:m,getAvailableSkillPoints:n,getCurrentLevelExp:o,getExpForLevel:h,getExpForLevelStep:g,getMaxTribeLevel:f,calcDonation:j,getMissingSkillPoints:k,getLevelUpBenefits:p,getSpentSkillPoints:i,SKILL_POINTS_ONE_TIER:b,LEVELUP_TIMEOUT:3e3}}])}),define("conf/templates",[],function(){return{MODAL:{INTERSTITIAL:"modal_interstitial",PAYMENT:"modal_payment",ATTENTION:"modal_attention"},SCREEN:{SHOP:"screen_shop"}}}),define("services/InterstitialService",["app","conf/templates","models/InterstitialStackModel"],function(a,b,c){a.factory("interstitialService",["$rootScope","socketService","routeProvider","eventTypeProvider","modelDataService","windowManagerService","crmService",function(a,d,e,f,g,h,i){var j={},k=function(){var a=g.getSelectedCharacter();a&&a.isInCoopMode()||d.emit(e.GET_INTERSTITIALS,{device_type:"desktop"})},l=function(a,b){b.interstitials.length&&(g.setInterstitialStack(new c(b.interstitials)),j.showNextInterstitial())},m=function(a){return i.acceptInterstitial(a)},n=function(a){d.emit(e.REJECT_INTERSTITIAL,{campaign_id:a}),j.showNextInterstitial()},o=function(c){var d=a.$new();d.interstitial=c,h.getModal(b.MODAL.INTERSTITIAL,d),d.moveBack()},p=function(){var a=g.getInterstitialStack();a&&(a=a.getNext())&&o(a)},q=function(){var a=g.getInterstitialStack();a&&(a=a.getPrevious())&&o(a)},r=function(a,c){switch(c){case b.SCREEN.SHOP:case b.MODAL.PAYMENT:return void j.showNextInterstitial()}};return a.$on(f.INTERSTITIALS_RECEIVED,l),a.$on(f.WINDOW_CLOSED,r),j.getInterstitials=k,j.acceptInterstitial=m,
j.rejectInterstitial=n,j.showNextInterstitial=p,j.showLastInterstitial=q,j}])}),define("services/EffectService",["app","conf/effectTypes"],function(a,b){a.factory("effectService",["modelDataService",function(a){var c=function(a,c){var d,e=a[0];for(d=1;d<a.length;d++)switch(c){case b.EXTRA_HOSPITAL_BEDS:e.data.details.beds+=a[d].data.details.beds}return e},d=function(b){var c,d=a.getSelectedVillage().getEffectList(),e=a.getSelectedCharacter().getEffectList(),f=[d,e],g=[];for(c=0;c<f.length;c++)g=g.concat(f[c].getEffectsByType(b));return g},e=function(a){var b=d(a);return 0===b.length?null:c(b,a)},f=function(b){var c,d=a.getSelectedVillage().getEffectList(),e=a.getSelectedCharacter().getEffectList(),f=[d,e],g=[];for(c=0;c<f.length;c++)g=g.concat(f[c].getEffectsByContentName(b));return g},g=function(c){var d,e,f,g=a.getSelectedVillage().getEffectList(),h=a.getSelectedCharacter().getEffectList(),i=[g,h];for(e=0;e<i.length;e++)for(d=i[e].getEffectsByType(b.RESOURCE_PRODUCTION_INCREASE),f=0;f<d.length;f++)if(d[f].getDetails().resource_type===c)return d[f]},h=function(a){switch(a){case"extra_hospital_beds":return"beds";case"increased_carrying_capacity":case"resource_deposit_job_amount":case"farm_speed_increase":case"resource_deposit_job_duration":case"recruit_speed_bonus":case"recruit_speed_boost":case"faster_tribe_support":return"factor";case"increase_member_limit":case"increase_spy_defense":return"increased_by";case"base_wall_levels":return"min_level";case"modify_attack_factor":return"bonus";case"revive_attacker_losses":return"ratio"}return null},i=function(a,c,d){switch(a){case"factor":return Math.round(100*(c-1))+"%";case"bonus":case"ratio":return Math.round(100*c)+"%";case"beds":case"increased_by":case"min_level":return d===b.INCREASE_SPY_DEFENSE?c+"%":c}},j=function(a){var b=h(a.type);return b?i(b,a.details?a.details[b]:a[b]):""},k=function(a){var b,c,d,e=0;for(d=0;d<a.length;d++)a[d]&&(c=a[d].getTimeCompleted(),c>e&&(b=a[d],e=b.getTimeCompleted()));return b};return{getEffect:e,getEffects:d,getEffectByResource:g,formatEffectValueForDisplay:i,getEffectValue:j,getEffectValuePropertyName:h,getEffectsByContentName:f,getLastEndingEffect:k}}])}),define("services/QueueService",["app","helper/time"],function(a,b){a.factory("queueService",function(){var a=4*b.inMS.hour,c=8*b.inMS.hour,d=function(a){return 1e3*parseInt(a,10)-Date.now()},e=function(e){var f,g,h=[],i=d(b.server2ClientTimeInSeconds(e));return f=i-c,g=i-a,f>0&&h.push(f),g>0&&h.push(g),h},f=function(e){var f=d(b.server2ClientTimeInSeconds(e)),g=["long","medium","short"];return f>c?g[0]:c>=f&&f>a?g[1]:g[2]};return{getQueueIndicator:f,getQueueDuration:d,getIndicatorChangeDurations:e}})}),define("services/CrmService",["app","angular"],function(a,b){a.factory("crmService",["$rootScope","$q","modelDataService","premiumService","windowDisplayService","socketService","routeProvider","eventTypeProvider",function(a,c,d,e,f,g,h,i){var j={URI:"uri",CASH_SHOP:"cashShop",CASH_SHOP_PACKAGE_TAB:"cashShopPackageTab",ITEM_SHOP:"itemShop",INVENTORY:"inventory",NONE:"none"},k=function(a,c,d){var g;switch(a){case j.CASH_SHOP:case j.CASH_SHOP_PACKAGE_TAB:d?e.openPaymentModalWithUrl(d):e.openPaymentModal();break;case j.ITEM_SHOP:f.openShop();break;case j.INVENTORY:f.openInventory();break;case j.URI:window.open(d,"_blank");break;case j.NONE:if(c)for(g=c;g;){if(b.isFunction(g.closeWindow)){g.closeWindow();break}g=g.$parent}}},l=function(b,e){var f,j,k=c.defer(),l=d.getSelectedCharacter(),m=function(a,b){f(),b.campaign_id===e?k.resolve(b):k.reject()},n=function(b,c){switch(b.type){case h.ACCEPT_INTERSTITIAL.type:f=a.$on(i.INTERSTITIAL_ACCEPTED,m);break;case h.ACCEPT_IGM.type:f=a.$on(i.IGM_ACCEPTED,m)}g.emit(b,{campaign_id:c})};return l&&l.isInTutorial()?(j=function(){n(b,e)},a.$on(i.TUTORIAL_COMPLETED,j),a.$on(i.TUTORIAL_SKIPPED,j)):n(b,e),k.promise},m=function(a){return l(h.ACCEPT_INTERSTITIAL,a)},n=function(a){return l(h.ACCEPT_IGM,a)},o=function(a,b,c,d){d?n(d).then(function(e){k(a,b,e.payment_iframe_url||c,d)}):k(a,b,c,d)};return{linkTo:o,acceptMessage:n,acceptInterstitial:m,TYPES:j}}])}),define("helper/navigation",["conf/conf","helper/window","helper/uri"],function(a,b,c){var d=function(a,d){var e=b.getLocation(),f=c.getExtendedURLParams(e.search,"",d);b.setLocation(a+f)},e=function(b,d){var e="";return e+=a.IOS_APP_NAME+"://",b&&(e+=b),e+=c.getExtendedURLParams("","",d)},f=function(a){d("/page",a)},g=function(a){d("/",a)},h=function(a){var d,e=b.getLocation();a||(a={}),a.invite=null,a.email=null,d=c.getExtendedURLParams(e.search,e.hash,a),b.setLocation("/game.php"+d)};return{iosAppStartLink:e,jumpToGamePage:h,jumpToLandingPage:f,jumpToRegistrationPage:g}}),define("services/BanModalService",["app","helper/time","conf/conf","helper/uri","helper/navigation"],function(a,b,c,d,e){a.factory("banModalService",["$rootScope","$filter","windowManagerService","modelDataService","$window",function(a,c,d,f,g){var h=function(h,i){var j=a.$new(),k={};j.globalBan=h.global,j.isInCooperativeMode=f.getSelectedCharacter().isInCoopMode(),h.reason?k.reason=h.reason:k.reason=c("i18n")("no_ban_reason",a.loc.ale,"landing"),k.endDate=b.server2ClientTime(h.end_date),k.worldId=h.world_id,k.description=h.description,j.banData=k,j.close=function(){j.closeWindow(),i&&e.jumpToLandingPage()},j.contactSupport=function(){var a=g.open("about:blank","","left=20,top=20,width=1000,height=600,scrollbars=1,toolbar=0,resizable=1");a.location.replace(h.support_url)},d.getModal("modal_player_banned",j)};return{showBannedModal:h}}])}),define("services/TipService",["app"],function(a){a.factory("tipService",["$rootScope","$filter","windowManagerService","modelDataService","settingsService","eventTypeProvider",function(a,b,c,d,e,f){var g=null,h=function(c){c.message=b("i18n")(c.type,a.loc.ale,"tips",c.data.textParam1,c.data.textParam2),a.$broadcast(f.MESSAGE_SMART_TIP,c),c.show()},i=function(){var a,b,c=d.getSelectedCharacter().getSmartTips();if(c&&(a=c.length,!d.getSelectedCharacter().isInTutorial()))for(;a--;)if(b=c[a],!b.hasCooldown()&&b.check()&&(!g||g.hasOwnProperty(b.type))){h(b);break}},j=function(a){var b,c=d.getSelectedCharacter().getSmartTips();if(c)for(b=c.length;b--;)if(c[b].type===a)return void h(c[b])};return{evalTips:i,showSmartTip:j}}])}),define("services/BoostsService",["app","conf/effectTypes"],function(a,b){a.factory("boostsService",["modelDataService","effectService","inventoryItemTypeProvider",function(a,c,d){var e=function(a,b){var d,e,f,g=c.getEffectsByContentName(b);for(0===g.length&&(g=c.getEffects(b)),f=0;f<g.length;f++)e=g[f],e.data.scope===a.content.scope&&e.data.name===a.content.name&&(d=e);return d},f=function(a,d,f){return d===f||d===a.content.name?void(a.active=e(a,f)):void(f===b.RESOURCE_PRODUCTION_INCREASE&&(a.active=c.getEffectByResource(a.content.resource_type)))},g=function(a,b,c){var d,e;for(e=0;e<b.length;e++)d=b[e],d.active?d.active.id===a.effect_id&&f(d,a.name,c):d.content.name===a.name&&f(d,a.name,c)},h=function(b,c,f,g){var h,i,j,k,l=a.getInventory().getInventoryItemReference();for(f&&(f.defaultBoost=!0,b.push(f)),k=0;k<c.offers.length;k++)if(h=c.offers[k],h.type===d.EFFECT&&(h.content.name===g||h.content.type===g)){if(h.active=e(h,g),l.effect)for(j=0;j<l.effect.length;j++)i=l.effect[j],i.content.scope===h.content.scope&&i.content.name===h.content.name&&(h.item=i);b.push(h)}},i=function(a,b,c,d){var e,f=0;if(0===a.amount)if(!a.content||a.content.name!==c&&a.content.type!==c)d&&a.type===d&&(b[0].item=null);else for(f=0;f<b.length;f++)e=b[f],e.defaultBoost||a.content.scope!==e.content.scope||a.content.name!==e.content.name||(e.item=null)};return{updateBoosts:g,onPremiumOffers:h,onItemChanged:i}}])}),define("services/BackendConversionService",["app"],function(a){a.factory("backendConversionService",["eventTypeProvider","inventoryItemTypeProvider",function(a,b){var c=function(c){var d;switch(c.type){case a.INVENTORY:c.data.inventory.forEach(function(a){a.type===b.EFFECT&&(a.content=a.effect)});break;case a.INVENTORY_ITEM_CHANGED:c.data.type===b.EFFECT&&(c.data.content=c.data.effect);break;case a.PREMIUM_SHOP_OFFERS:for(d=0;d<c.data.offers.length;d++)c.data.offers[d].type===b.EFFECT&&(c.data.offers[d].content=c.data.offers[d].effect)}};return{handle:c}}])}),define("services/PremiumService",["app"],function(a){a.factory("premiumService",["$rootScope","modelDataService","socketService","routeProvider","windowManagerService","settingsService",function(a,b,c,d,e,f){var g=null,h=function(){return f.settings.game.premium},i=function(a){return g?a(g):void c.emit(d.PREMIUM_GET_IFRAME_URL,null,function(b){g=b.iframe_url,a(b.iframe_url)})},j=function(b){var c=a.$new();c.url=b,e.getModal("modal_payment",c)},k=function(){i(j)},l=function(a){f.settings.game.premium=a,f.saveGameSettings()},m=function(c,d,f,g,i,j,l,m,n){if(m=void 0===m?!0:m,m&&!h())return b.getPlayer().getPremium()<i.premium?void k():void j();var o,p=a.$new();p.actionType=c,p.title=d,p.description=f,p.iconName=g,p.costs=i,p.onConfirm=j,p.cancelable=m,p.extras=l,e.getModal("modal_premium",p),o=p.closeWindow,p.closeWindow=function(){o(),n&&n()}};return{execute:m,isModalEnabled:h,setPremiumModalState:l,openPaymentModal:k,openPaymentModalWithUrl:j}}])}),define("services/PremiumActionService",["app","helper/time","conf/recruitingQueueTypes","conf/effectTypes"],function(a,b,c,d){a.factory("premiumActionService",["$rootScope","$filter","$timeout","modelDataService","premiumService","premiumActionTypeProvider","socketService","routeProvider","inventoryItemTypeProvider","inventoryService",function(a,b,d,e,f,g,h,i,j,k){var l="premium_items",m=function(c,d){var e,k,m,n=function(){h.emit(i.PREMIUM_BUY_ITEM,{offer_id:c.id},d)};if(!c.costs)return void n();switch(c.type){case j.PACKAGE:m=b("i18n")("premium_package",a.loc.ale,l,c.name,c.amount),k=c.description,e="premium-package-"+c.image;break;case j.EFFECT:m=b("i18n")(c.content.type,a.loc.ale,l,c.amount),k=b("i18n")("description_"+c.content.type,a.loc.ale,l,b("readablePercentFilter")(c.content.factor),b("readableSecondsFilter")(c.content.duration,!1,!0),b("i18n")("scope_"+c.content.scope,a.loc.ale,l)),e=c.content.type;break;default:m=b("i18n")("name_"+c.type,a.loc.ale,l,c.amount),k=b("i18n")("description_"+c.type,a.loc.ale,l),e=c.type}m=b("i18n")("title_buy_item",a.loc.ale,"modal_premium",m),f.execute(g.BUY_ITEM,m,k,e,{premium:c.sale_costs||c.costs},n,null,null,function(){d&&d({offer_id:c.id})})},n=function(c,d,k){var m,n,o=e.getSelectedVillage(),p=o.getBuildingData().getDataForBuilding(c),q=p.nextLevelPremiumCosts,r=j.BUILD_COST_REDUCTION,s=r;n=b("i18n")("name_"+r,a.loc.ale,l),m=b("i18n")("description_"+r,a.loc.ale,l),q.premium=e.getGameData().getPremiumCostsForType(r),q.time=q.build_time,f.execute(g.UPGRADE_BUILDING,n,m,s,q,function(){h.emit(i.VILLAGE_UPGRADE_BUILDING,{village_id:o.getId(),building:c,location:d,premium:!0},k)},null,!0,k)},o=function(){var c,d,k=e.getSelectedVillage(),m=j.BUILD_QUEUE_SLOT,n=m,o={};d=b("i18n")("name_"+m,a.loc.ale,l),c=b("i18n")("description_"+m,a.loc.ale,l),o.premium=e.getGameData().getPremiumCostsForType(m),f.execute(g.BUILD_QUEUE_INCREASE,d,c,n,o,function(){h.emit(i.PREMIUM_BUY_BUILDQUEUE_SLOT,{village_id:k.getId()})})},p=function(c){var d,k,l=j.INSTANT_TRANSPORT,m="premium_items",n=l,o={};k=b("i18n")("name_"+l,a.loc.ale,m),d=b("i18n")("description_"+l,a.loc.ale,m),o.premium=e.getGameData().getPremiumCostsForType(l),f.execute(g.INSTANT_TRANSPORT,k,d,n,o,function(){h.emit(i.PREMIUM_INSTANT_TRANSPORT,{transport_id:c})})},q=function(c,d,g){var k=j.DAILY_UNIT_SLOT,m=b("i18n")("name_"+k,a.loc.ale,l),n=b("i18n")("description_"+k,a.loc.ale,l),o="paceholder-2",p={premium:e.getGameData().getPremiumCostsForType(k)};f.execute(k,m,n,o,p,function(){g&&g(),h.emit(i.PREMIUM_DAILY_UNIT_DEAL_ACCEPT,{village_id:c,slot:d})})},r=function(c,d,g){var k=j.DAILY_UNIT_REROLL,m=b("i18n")("name_"+k,a.loc.ale,l),n=b("i18n")("description_"+k,a.loc.ale,l),o=k,p={premium:e.getGameData().getPremiumCostsForType(k)};f.execute(k,m,n,o,p,function(){h.emit(i.PREMIUM_DAILY_UNIT_DEAL_REROLL,{village_id:c}),d&&d()},void 0,void 0,g)},s=function(c,g,k){var m=j.RESOURCE_DEPOSIT_REROLL,n=b("i18n")("name_"+m,a.loc.ale,l),o=b("i18n")("description_"+m,a.loc.ale,l),p=m,q={premium:e.getGameData().getPremiumCostsForType(m)};f.execute(m,n,o,p,q,function(){d(function(){h.emit(i.PREMIUM_RESOURCE_DEPOSIT_REROLL)},k||0),c&&c()},void 0,void 0,g)},t=function(c,d,k){var m,n,o,p,q=e.getSelectedVillage(),r=c,s=r,t={};switch(r){case j.BOOST_WOOD:n=g.WOOD_BOOSTER,m="wood";break;case j.BOOST_CLAY:n=g.CLAY_BOOSTER,m="clay";break;case j.BOOST_IRON:n=g.IRON_BOOSTER,m="iron"}p=b("i18n")("name_"+r,a.loc.ale,l),o=b("i18n")("description_"+r,a.loc.ale,l),t.premium=e.getGameData().getPremiumCostsForType(r),f.execute(n,p,o,s,t,function(){h.emit(i.PREMIUM_BOOST_PRODUCTION,{village_id:q.getId(),resource_type:m},d)},null,!0,k)},u=function(c){var d,g,j=e.getSelectedVillage(),k="premium_items",l=c.content.type,m={};g=b("i18n")(l,a.loc.ale,k),d=b("i18n")("description_"+l,a.loc.ale,k,b("readablePercentFilter")(c.content.factor),b("readableSecondsFilter")(c.content.duration,!1,!0),b("i18n")("scope_"+c.content.scope,a.loc.ale,k)),m.premium=c.costs,f.execute(l,g,d,l,m,function(){h.emit(i.PREMIUM_BUY_ITEM,{village_id:j.getId(),offer_id:c.id,instant_use:!0})},null,!0)},v=function(c){var d,k,m=e.getSelectedVillage(),n=j.BOOST_PROTECTION,o=g.LOOT_PROTECTION,p=n,q={};k=b("i18n")("name_"+n,a.loc.ale,l),d=b("i18n")("description_"+n,a.loc.ale,l),q.premium=e.getGameData().getPremiumCostsForType(n),f.execute(o,k,d,p,q,function(){h.emit(i.WAREHOUSE_BOOST_PROTECTION,{village_id:m.getId()},c)})},w=function(c,d){var k,m,n=d||e.getSelectedVillage().getId(),o=g.INSTANT_BUILD,p=j.INSTANT_BUILD,q=p,r={};m=b("i18n")("name_"+p,a.loc.ale,l,b("i18n")(c.building,a.loc.ale,"building_names")),k=b("i18n")("description_"+p,a.loc.ale,l),r.premium=e.getGameData().getInstantBuildPremiumCosts(c),f.execute(o,m,k,q,r,function(){h.emit(i.PREMIUM_INSTANT_BUILD,{village_id:n,job_id:c.id})},{buildJob:c},!1)},x=function(){var c,d,k=e.getSelectedVillage(),m=g.RESET_ORDER,n=j.RESET_ORDER,o=n,p={};d=b("i18n")("name_"+n,a.loc.ale,l),c=b("i18n")("description_"+n,a.loc.ale,l),p.premium=e.getGameData().getPremiumCostsForType(n),f.execute(m,d,c,o,p,function(){h.emit(i.PRECEPTORY_RESET_ORDER,{village_id:k.getId(),premium:!0})})},y=function(d,k){var m,n,o=e.getSelectedVillage(),p=g.INSTANT_RECRUIT,q=j.INSTANT_RECRUIT,r="paceholder-2",s={};n=b("i18n")("name_"+q,a.loc.ale,l,b("i18n")(d.unitType,a.loc.ale,"unit_names")),m=b("i18n")("description_"+q,a.loc.ale,l),s.premium=e.getGameData().getInstantRecruitPremiumCosts(d),f.execute(p,n,m,r,s,function(){var a;switch(d.origin.toLowerCase()){case c.STATUE:a="PALADIN_RECRUIT_INSTANTLY";break;default:a="PREMIUM_INSTANT_RECRUIT_"+d.origin}h.emit(i[a],{village_id:o.getId(),job_id:d.id}),k&&k(d)},{recruitJob:d},!1)},z=function(a,b){if(!a||!b)return!1;if(!b.waiting)return!1;var d=0,e=b.type,f=Date.now();return a.forEach(function(a){a.id!==b.id&&a.startedAt<f&&a.type===e&&!a.waiting&&(a.type===c.BARRACKS||a.type===c.PRECEPTORY)&&d++}),1===d},A=function(c,d){if(z(c.jobs||c,d)){var m,n,o=j.SECOND_QUEUE_JOB,p=e.getInventory().getItemByType(o),q=function(){var a=e.getSelectedVillage();h.emit(i["PREMIUM_SECOND_QUEUE_JOB_"+d.origin],{village_id:a.getId(),job_id:d.id})},r=g.SECOND_QUEUE_JOB,s="paceholder-2",t={};p&&p.amount?k.useItem(p,q):(n=b("i18n")("name_"+o,a.loc.ale,l,b("i18n")(d.unitType,a.loc.ale,"unit_names")),m=b("i18n")("description_"+o,a.loc.ale,l),t.premium=e.getGameData().getSecondQueueJobPremiumCosts(),f.execute(r,n,m,s,t,q,{recruitJob:d},!0))}},B=function(){return e.getWorldConfig().isInstantRecruitEnabled()},C=function(){return e.getWorldConfig().isSecondQueueJobEnabled()},D=function(c,d){var k,m,n=g.PALADIN_WEAPON_UNLOCK,o=j.PALADIN_WEAPON,p="item-"+c,q={};m=b("i18n")("name_"+o,a.loc.ale,l,b("i18n")("item_name_"+c,a.loc.ale,"building_statue")),k=b("i18n")("description_"+o,a.loc.ale,l),q.premium=e.getGameData().getPaladinWeaponPremiumCosts(c,d),f.execute(n,m,k,p,q,function(){h.emit(i.PALADIN_UNLOCK_NEXT_ITEM_LEVEL,{item:c})},{weaponName:c},!1)},E=function(c){var d,k,m=e.getSelectedVillage(),n=g.PALADIN_INSTANT_RECRUIT,o=j.PALADIN_INSTANT_RECRUIT,p=o,q={};k=b("i18n")("name_"+o,a.loc.ale,l,"paladin"),d=b("i18n")("description_"+o,a.loc.ale,l),q.premium=e.getGameData().getPaladinInstantRecruitPremiumCosts(c),f.execute(n,k,d,p,q,function(){h.emit(i.PALADIN_RECRUIT_INSTANTLY,{village_id:m.getId()})},{recruitJob:c},!1)},F=function(c,d){var k,m,n=e.getSelectedVillage(),o=g.TRIBE_DONATE,p=j.TRIBE_DONATE,q=p;m=b("i18n")("name_"+p,a.loc.ale,l),k=b("i18n")("description_"+p,a.loc.ale,l),f.execute(o,m,k,q,c,function(){h.emit(i.TRIBE_SKILL_DONATE,{village_id:n.getId(),crowns:c.premium,resources:{wood:c.wood,clay:c.clay,iron:c.iron}},d)},{},!0)},G=function(c,d,k,m){var n,o,p=e.getSelectedVillage(),q=g.INSTANT_TRADE,r=j.TRADE,s=r,t={};o=b("i18n")("name_"+r,a.loc.ale,l),n=b("i18n")("description_"+r,a.loc.ale,l),t.premium=c,t[k]=m,f.execute(q,o,n,s,t,function(){h.emit(i.PREMIUM_INSTANT_TRADE,{village_id:p.getId(),resource_pay:k,resource_get:d,amount:m})})};return{buyItem:m,upgradeBuilding:n,unlockBuildingQueueSlot:o,boostProduction:t,boostProtection:v,instantBuild:w,instantRecruit:y,instantTrade:G,instantTransport:p,paladinInstantCall:E,paladinUpgradeWeapon:D,resetOrder:x,buyDailyUnitDealSlot:q,rerollDailyUnitDealSlots:r,rerollResourceDepositJobs:s,addSecondQueueJob:A,isInstantRecruitEnabled:B,isSecondQueueJobEnabled:C,isAddSecondQueueJobPossible:z,donateToTribe:F,buyBoost:u}}])}),define("services/shared/ModalSharedUnitInfoDataService",["app"],function(a){a.factory("modalSharedUnitInfoDataService",function(){var a={};return{setUnitName:function(b){a.unitName=b},getUnitName:function(){return a.unitName||null}}})}),define("services/shared/ModalSharedBuildingUpgradeDataService",["app"],function(a){a.factory("modalSharedBuildingUpgradeDataService",function(){var a={};return{setBuildingName:function(b){a.buildingName=b},getBuildingName:function(){return a.buildingName||null},setCancelId:function(b){a.cancelId=b},getCancelId:function(){return a.cancelId||null}}})}),define("services/shared/ModalSharedBuildingResearchDataService",["app"],function(a){a.factory("modalSharedBuildingResearchDataService",function(){var a={};return{setBuildingName:function(b){a.buildingName=b},getBuildingName:function(){return a.buildingName||null},setPremium:function(b){a.premium=b},getPremium:function(){return a.premium||!1},setResearchName:function(b){a.researchName=b},getResearchName:function(){return a.researchName||null}}})}),define("services/shared/ScreenSharedReportListDataService",["app"],function(a){a.factory("screenSharedReportListDataService",function(){var a={};return{setReportList:function(b){a.reportList=b},getReportList:function(){return a.reportList||null},setOpenReport:function(b){a.openReport=b},getOpenReport:function(){return a.openReport||null},setPageInfo:function(b,c){a.firstPage=b,a.lastPage=c},getPageInfo:function(){return{firstPage:a.firstPage,lastPage:a.lastPage}}}})}),define("services/shared/ModalSharedQuestLineDataService",["app","conf/questTrees"],function(a,b){a.factory("modalSharedQuestLineDataService",["modelDataService",function(a){var c={questLineModel:null,selectedQuestIndex:0},d=function(a){c.questLineModel=a},e=function(){return c.questLineModel},f=function(a){c.selectedQuestIndex=a},g=function(){return c.selectedQuestIndex},h=function(){return a.getWorldConfig().getQuestTreeFolder()},i=function(){var a=h();return a!==b.QUEST_TREE_NAME_DEFAULT?a+"_":""};return{setQuestLineModel:d,getQuestLineModel:e,setSelectedQuestIndex:f,getSelectedQuestIndex:g,getQuestTreeName:h,getQuestTreePrefix:i}}])}),define("services/services",["conf/conf","services/HttpService","services/SocketService","services/SocketModelService","services/DataDependencyResolverService","services/ModelDataService","services/TemplateManagerService","services/WindowManagerService","services/WindowDisplayService","services/VillageService","services/AuthService","services/BuildingService","services/BuildingLevelScaleService","services/BuildingTimerService","services/RecruitingService","services/RecruitingTimerService","services/ResourceService","services/ResourceTimerService","services/ReportService","services/MessagingService","services/StorageService","services/IconGeneratorService","services/IconAnimationsService","services/ArmyService","services/BuildingQueueService","services/BuildingQueueTimerService","services/CanvasAssetService","services/ContextMenuService","services/CommandService","services/BuildingLabelService","services/TimelineService","services/AutoCompleteService","services/TradingService","services/InventoryService","services/LinkService","services/KingdomService","services/SettingsService","services/PresetListService","services/MapService","services/MapHintService","services/ForumService","services/TribeService","services/GroupService","services/AchievementListService","services/TutorialService","services/PresetService","services/CookieService","services/TribeApplicationsService","services/RavenTagService","services/TagManagerService","services/AudioManagerService","services/AudioService","services/HttpCdnRequestInterceptorService","services/OfficerInfoService","services/ForumThreadService","services/PreceptoryService","services/UtilityService","services/OverviewService","services/VillageAssetRequirementsService","services/StatueService","services/AcademyService","services/L10NService","services/ScriptLoadingService","services/HotkeyManagerService","services/ResourceDepositService","services/SecondVillageService","services/TrackingService","services/ErrorService","services/FeatureService","services/InviteFriendService","services/RewardService","services/TribeSkillService","services/InterstitialService","services/EffectService","services/QueueService","services/CrmService","services/BanModalService","services/TipService","services/BoostsService","services/BackendConversionService","services/PremiumService","services/PremiumActionService","services/shared/ModalSharedUnitInfoDataService","services/shared/ModalSharedBuildingUpgradeDataService","services/shared/ModalSharedBuildingResearchDataService","services/shared/ScreenSharedReportListDataService","services/shared/ModalSharedQuestLineDataService"],function(a){a.DEBUG}),define("controllers/AppController",["app","helper/time","raven","conf/conf","helper/uri","helper/navigation","version"],function(a,b,c,d,e,f,g){a.controller("AppController",["$rootScope","$scope","$filter","storageService","socketService","windowManagerService","templateManagerService","modelDataService","authService","featureService","eventTypeProvider","routeProvider","ravenTagService","tagManagerService","$window","audioManagerService","hotkeyManagerService","errorTypeProvider","interstitialService","banModalService",function(a,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){var A,B,C,D=!1,E=!1,F=function(a,b,c){m.compile(a,null,function(a){$(b).append(a),c&&c()})},G=function(){D||(F("interface.top","#wrapper",function(){F("interface.building_queue","#interface-building-queue"),F("interface.recruiting_queue","#interface-recruiting-queue")}),F("interface.global_information","#interface-global-information"),F("interface.bottom","#interface-bottom-container"),F("interface.quests","#interface-quests"),F("interface.chat","#interface-chat"),F("context_menu","#map"),j.getItem("hasSeenHotkeys",!0)||A||F("interface.hotkeys","#interface-hotkeys"),B||F("interface.validate_mail","#interface-mail"),D=!0)},H=function(){m.compile("tutorial/tutorial",null,function(a){var b=document.createElement("div");b.id="tutorial",$(b).append(a),$(document.body).append(b)})},I=function(){f.jumpToLandingPage()},J=function(){window.twx.unloading=!0,o.clearAuthData(I)},K=function(a,b){k.emit(r.DAILY_LOGIN_BONUS_GET_INFO,null,function(a){if(!a.reward_collected){var c=h.$new();c.data=a,l.getModal("modal_daily_login_bonus",c)}b()})},L=function(b,c){return A=n.getSelectedCharacter().isInTutorial(),B=c.email_confirmed,c.game_over?void l.getModal("modal_game_over"):(n.getSelectedCharacter().setSecondVillageStatus(c.has_second_village),n.getSelectedCharacter().setAmountLogins(c.login_amount),c.villages.length?(a.$broadcast(q.MAP_INITIALIZE),G(),1===c.length&&a.$broadcast(q.MAP_JUMP_TO,c.villages[0].x,c.villages[0].y),void(A?(y.getInterstitials(),k.emit(r.TUTORIAL_START_TASK,null,H),a.$broadcast(q.NOTIFICATION_DISABLE)):(c.login_amount>=n.getGameData().getBaseData().show_daily_bonus_after_login_nr?K(c,y.getInterstitials):y.getInterstitials(),w.init()))):void l.getFramedModal("modal_establish_village",null,null,y.getInterstitials))},M=function(a,b){var e=n.getPlayer(),f=[r.WORLD_CONFIG,r.GAME_DATA_UNITS,r.GAME_DATA_BUILDINGS,r.GAME_DATA_GET_RESEARCHES,r.GAME_DATA_GET_BASE_DATA,r.GAME_DATA_COSTS_PER_COIN,r.GAME_DATA_GET_PREMIUM,r.GAME_DATA_GET_OFFICER,r.ACHIEVEMENT_GET_ALL,r.GET_INVENTORY,r.GLOBAL_INFORMATION,r.MEDIA_PARTNER_GET_CAMPAIGN,r.EFFECT_GET_EFFECTS,r.TRIBE_INVITATION_GET_OWN];C=e.getSelectedCharacter(),s.tags={owner_name:b.owner_name,owner_id:b.owner_id,id:b.id,name:b.name,world:b.world_id,host:d.HOST,version:g.frontend.toString()},c.setUser(s.tags),e.setSelectedCharacter(e.getCharacter(b.id,b.world_id)),C.setTribeId(b.tribe_id),C.setTribeRights(b.tribe_rights),C.setCoopStatus(C.getOwnerId()!==e.getId()),k.emitInOrder(f,[],function(){k.emit(r.CHAR_GET_INFO,{}),n.getWorldConfig().isBathHouseEnabled()&&$(document.body).addClass("bathhouse"),n.getWorldConfig().isTribeSkillsFeatureEnabled()&&b.tribe_id&&k.emit(r.TRIBE_SKILLS_GET_INFO,{})}),k.emitInOrder([r.GROUPS_GET_INDEX,r.GROUPS_GET_VILLAGES],[])},N=function(){o.reconnect()},O=function(){window.location.reload()},P=function(){window.location.reload()},Q=function(a,c){var f=n.getPlayer(),g=f.getCharacter(a,c);return g?(b.stopWatch.start(),f.setSelectedCharacter(g),k.emit(r.SELECT_CHARACTER,{id:g.getId(),world_id:g.getWorldId(),ref_param:e.getURLParam("ref")},function(a){d.setMapName(a.map_name),o.setCharacterId(a.id),o.setWorldId(a.world_id)}),!0):!1},R=function(){var a,b,c,d=n.getPlayer(),f=d.getCharacterCount();return f?f>1?(b=e.getURLParam("character_id"),a=e.getURLParam("world"),b&&a?Q(b,a):!1):(c=d.getFirstCharacter(),Q(c.getId(),c.getWorldId())):!0},S=function(a,b){var c=o.getAuthData(),f=e.getURLParam("ref");o.setToken(b.token),c&&!c.autologin&&(o.clearAuthDataOnlyCookie(),o.setAuthData(c)),R()?b.first_login?t.setTagData("reg_success",!0,t.VISITOR_STATES.registered,f,d.MARKET):t.setTagData("login_success",!0,t.VISITOR_STATES.registered,f,d.MARKET):(t.setTagData("login_failed",!0,t.VISITOR_STATES.registered,f,d.MARKET),I())},T=function(){d.MAINTENANCE=!0,l.getFramedModal("maintenance")},U=function(){window.location.reload()},V=function(){l.isTemplateOpen("modal_socket")||E||l.getModal("modal_socket")},W=function(b,c){c.socket.options.reconnect=!1;var d;l.isTemplateOpen("modal_socket")||(d=a.$new(),d.eventName="error",l.getModal("modal_socket",d))},X=function(){o.logout()},Y=function(a,b){E=!0,z.showBannedModal(b,!0)},Z=function(){k.emit(r.NOTIFICATION_GET_NOTIFICATIONS)},_=function(){var a=n.getSelectedCharacter();a&&!a.isInTutorial()&&p.getInfo()},aa=function(){},ba=function(){var a=e.getURLParam("token"),b=e.getURLParam("name"),c=e.getURLParam("character_id"),d=e.getURLParam("world");c&&d&&(a&&b&&(o.clearAuthData(null,!0),o.setToken(a),o.setPlayerName(b)),o.setWorldId(d),o.setCharacterId(c)),t.init(),v.init(),o.autoLogin()||I(),u.onbeforeunload=function(){window.twx.unloading=!0}};h.$on(q.LOGIN_SUCCESS,S),h.$on(q.LOGOUT_SUCCESS,J),h.$on(q.LOGIN_ERROR,J),h.$on(q.CHARACTER_SELECTED,M),h.$on(q.RECONNECT,N),h.$on(q.CHARACTER_INFO,L),h.$on(q.CHARACTER_RESTARTED,O),h.$on(q.CHARACTER_GAME_OVER,P),h.$on(q.MAINTENANCE_BEGIN,T),h.$on(q.MAINTENANCE_END,U),h.$on(q.SOCKET_DISCONNECTED,V),h.$on(q.SOCKET_ERROR,W),h.$on(q.MAP_INITIALIZE,Z),h.$on(x.AUTH_GLOBAL_BAN,X),h.$on(x.AUTH_WORLD_BAN,X),h.$on(x.AUTH_OWNER_GLOBAL_BAN,X),h.$on(x.AUTH_OWNER_WORLD_BAN,X),h.$on(q.PLAYER_BANNED,Y),h.$on(q.MAP_INITIALIZED,_),h.$on(q.MAP_INITIALIZED,aa),h.$on(q.TUTORIAL_COMPLETED,_),ba()}])}),define("controllers/TrackingSnippetController",["app"],function(a){a.controller("TrackingSnippetController",["$rootScope","$element","socketService","eventTypeProvider","routeProvider",function(a,b,c,d,e){var f=function(a){var b,c,d=a.attributes,e=document.getElementsByTagName("script")[0],f=document.createElement("script");for(b=0;b<d.length;b++)c=d[b],f[c.name]=c.value;f.text=a.text,e.parentNode.insertBefore(f,e)},g=function(a,c){if(c.snippet)for(var d,e=Array.prototype.slice.call($.elementify(c.snippet).children);d=e.shift();)"script"===d.localName?f(d):b.append(d)},h=function(a,b){g(a,b),c.emit(e.TRACKING_SNIPPET_CONFIRM_EVENT)},i=function(a,b){b.email&&c.emit(e.TRACKING_SNIPPET_GET_VALID,b)};a.$on(d.TRACKING_EMAIL_VALIDATE,i),a.$on(d.TRACKING_SNIPPET_VALID,g),a.$on(d.TRACKING_SNIPPET_EVENT,h)}])}),define("helper/firework",[],function(){var a=function(a,b){return Math.random()*(b-a)+a},b=function(b,c){var d,e,f=document.getElementById(c),g=f.getContext("2d"),h=f.offsetWidth,i=f.offsetHeight,j=[],k=[],l=a(100,200),m=a(10,30),n=0,o=b,p=60,q=Date.now(),r=1e3/p,s=function(a,b,c,d){return Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2))},t=function(b,c){for(this.x=b,this.y=c,this.coordinates=[],this.coordinateCount=5;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=a(0,2*Math.PI),this.speed=a(1,10),this.friction=.95,this.gravity=1,this.hue=a(l-20,l+20),this.brightness=a(50,80),this.alpha=1,this.decay=a(.015,.03),this.lineWidth=a(.2,2)},u=function(b,c,d,e){for(this.x=b,this.y=c,this.sx=b,this.sy=c,this.tx=d,this.ty=e,this.distanceToTarget=s(b,c,d,e),this.distanceTraveled=0,this.coordinates=[],this.coordinateCount=3;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=Math.atan2(e-c,d-b),this.speed=50,this.acceleration=2.05,this.brightness=a(50,70),this.targetRadius=1},v=function(){g.clearRect(0,0,f.width,f.height)},w=function(){o=0,k=[],j=[],v()},x=function y(){var b;if((0!==o||0!==k.length||0!==j.length)&&(requestAnimationFrame(y),d=Date.now(),e=d-q,e>r)){for(l+=.5,g.globalCompositeOperation="destination-out",g.fillStyle="rgba(0, 0, 0, 0.5)",g.fillRect(0,0,h,i),g.globalCompositeOperation="lighter",b=j.length;b--;)j[b].update(b);for(b=k.length;b--;)k[b].draw(),k[b].update(b);n>=m&&o>0?(j.push(new u(h/2,i,a(0,h),a(0,i/2))),n=0,m=a(10,40),o--):n++,q=d-e%r}};t.prototype.update=function(a){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&k.splice(a,1)},t.prototype.draw=function(){g.beginPath(),g.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),g.lineTo(this.x,this.y),g.lineWidth=this.lineWidth,g.strokeStyle="hsla("+this.hue+", 100%, "+this.brightness+"%, "+this.alpha+")",g.stroke()},u.prototype.update=function(a){var b=Math.cos(this.angle)*this.speed,c=Math.sin(this.angle)*this.speed,d=16;if(this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.targetRadius<8?this.targetRadius+=.3:this.targetRadius=1,this.speed*=this.acceleration,this.distanceTraveled=s(this.sx,this.sy,this.x+b,this.y+c),this.distanceTraveled>=this.distanceToTarget){for(;d--;)k.push(new t(this.tx,this.ty));j.splice(a,1)}else this.x+=b,this.y+=c},u.prototype.draw=function(){g.beginPath(),g.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),g.lineTo(this.x,this.y),g.strokeStyle="hsl("+l+", 100%, "+this.brightness+"%)",g.stroke(),g.beginPath(),g.arc(this.tx,this.ty,this.targetRadius,0,2*Math.PI),g.stroke()},f.width=h,f.height=i,this.start=x,this.stop=w,this.play=function(){o||(o=b),x()}};return{FireworkSystem:b}}),define("conf/tips",[],function(){return{TIP_RATE:9e4,TIP_DURATION:7e3,
TIP_COOLDOWN_FACTOR:2,TYPES:{RD_JOBS_COLLECTIBLE:"res_depo_jobs_collectible",RD_JOBS_AVAILABLE:"res_depo_jobs_available",RD_REROLL_AVAILABLE:"res_depo_reroll_available",LOOT_MASTER:"officer_loot_master",BUILDING_QUEUE:"building_queue",ATTACK_BARBARIANS:"attack_barbs",NO_TRIBE:"no_tribe",HOSPITALIZED_UNITS:"hospital_recovered_units",RECRUITING_QUEUE:"recruit_queue",UNUSED_BOOSTERS:"unused_boosters",SECOND_VILLAGE:"second_village",SECOND_VILLAGE_EXPIRE:"second_village_expire",TRIBE_INVITATION:"tribe_invitation"}}}),define("controllers/NotificationController",["app","helper/firework","conf/effectTypes","conf/effectNames","conf/tips","helper/time"],function(a,b,c,d,e,f){a.controller("NotificationController",["$rootScope","$scope","$timeout","$interval","eventTypeProvider","modelDataService","$filter","socketService","routeProvider","premiumActionService","errorTypeProvider","settingsService","smartTipFactory","tipService","inventoryItemTypeProvider",function(a,d,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u="visible",v="debug",w="error",x="party",y="tip",z="success",A="achievement",B="news",C="specialoffer",D=!1,E=5e3,F=8e3,G=214e3,H=1e9,I=i.getPlayer()?i.getPlayer().getPremium():null,J=this,K=[],L=new b.FireworkSystem(32,"notificationCanvas"),M=function pa(b,c,e,g,h,i,j,k){var l=e;if(b&&!D){if(s)return void K.push(arguments);if(!l)switch(c){case v:l="icon-44x44-info";break;case w:l="icon-44x44-error";break;case z:l="icon-44x44-check"}d.content=b,d.type=c,d.title=h||null,d.notificationId=i||null,d.icon=l||null,d.offer=j||null,d.visible=u,d.action=k||null,c===A&&L.play(),a.$$phase||d.$digest(),(s=f(function(){d.visible=null},g||E)).then(function(){s=null,c===A&&L.stop(),pa.apply(J,K.pop())})}},N=function(){g.cancel(t),t=g(q.evalTips,e.TIP_RATE)},O=function(){var a,b=null;return i.getWorldConfig().areSmartTipsEnabled()?(o.settings.game.smartTips&&(b=p.getTips()),void((a=i.getSelectedCharacter())&&(a.setSmartTips(b),N()))):void g.cancel(t)},P=function(b,c){c.new_level&&M(j("i18n")("gz_achievement_earned",a.loc.ale,"notifications",j("i18n")(c.type,a.loc.ale,"achievements"),c.level),A,"icon-90x90-achievement-"+c.type,F,j("i18n")("title_achievement",a.loc.ale,"notifications"))},Q=function(){M(j("i18n")("recruit_job_created",a.loc.ale,"notifications"),z)},R=function(){M(j("i18n")("recruit_job_canceled",a.loc.ale,"notifications"),z,"icon-44x44-attention")},S=function(){M(j("i18n")("building_job_created",a.loc.ale,"notifications"),z)},T=function(){M(j("i18n")("building_job_canceled",a.loc.ale,"notifications"),z,"icon-44x44-attention")},U=function(b,c){c.premium>I&&M(j("i18n")("premium_received",a.loc.ale,"notifications",c.premium-I),z),I=c.premium},V=function(a,b){I=b.premium},W=function(){M(j("i18n")("quest_finished",a.loc.ale,"notifications"),z)},X=function(b,c){c.member_id===i.getSelectedCharacter().getId()&&M(j("i18n")("tribe_rights_set",a.loc.ale,"notifications"),z,"icon-44x44-attention")},Y=function(b,c){c.id===i.getSelectedCharacter().getId()&&M(j("i18n")("kicked_from_tribe",a.loc.ale,"notifications"),z,"icon-44x44-attention")},Z=function(){M(j("i18n")("tribe_disbanded",a.loc.ale,"notifications"),z,"icon-44x44-attention")},$=function(b,c){c.character_id===i.getSelectedCharacter().getId()&&M(j("i18n")("tribe_application_accepted",a.loc.ale,"notifications"),z)},_=function(b,c){var d=i.getSelectedCharacter().getVillage(c.village_id).getName();M(j("i18n")("recruit_job_finished",a.loc.ale,"notifications",d),z)},aa=function(){M(j("i18n")("offer_created",a.loc.ale,"notifications"),z)},ba=function(){M(j("i18n")("offer_removed",a.loc.ale,"notifications"),z,"icon-44x44-attention")},ca=function(a,b){M(b.message,w)},da=function(){M(j("i18n")("password_changed",a.loc.ale,"options"),z)},ea=function(){M(j("i18n")("message_send",a.loc.ale,"notifications"),z)},fa=function(b,c){c.candidate_id===i.getSelectedCharacter().getId()&&M(j("i18n")("tribe_invitation",a.loc.ale,"notifications"),z)},ga=function(b,c){M(j("i18n")("village_lost",a.loc.ale,"notifications",c),v)},ha=function(b,c){M(j("i18n")("village_conquered",a.loc.ale,"notifications",c),v)},ia=function(b,c){var d="name_"+c.type;c.change>0&&(c.type===r.EFFECT&&(d=c.content.type),M(j("i18n")("item_receive",a.loc.ale,"notifications",j("i18n")(d,a.loc.ale,"premium_items",c.change),c.change),z))},ja=function(b,d){var e;d.type===c.ATTACK_PROTECTION?M(j("i18n")(c.ATTACK_PROTECTION,a.loc.ale,"notifications",j("readableDateFilter")(1e3*d.time_completed),a.loc.ale),z):(e=j("i18n")("name_"+d.type,a.loc.ale,"premium_items",d.change),"string"==typeof e&&M(j("i18n")("item_activated",a.loc.ale,"notifications",e,7),z))},ka=function(b,c){c.offer_id?k.emit(l.PREMIUM_LIST_SHOP_OFFERS,{},function(b){var d;for(d=0;d<b.offers.length;d++)if(b.offers[d].id===c.offer_id){M(c.message,C,"premium_package"===b.offers[d].type?"icon-90x90-premium-package-"+b.offers[d].image:"icon-90x90-"+b.offers[d].type,H,j("i18n")("title_special_offer",a.loc.ale,"notifications"),c.id,b.offers[d]);break}}):M(c.message,B,"icon-90x90-info",H,j("i18n")("title_news",a.loc.ale,"notifications"),c.id)},la=function(){D=!0,d.visible=null,s=null,K=[]},ma=function(){D=!1},na=function(b,c){1===c.level?M(j("i18n")("paladin_item_new",a.loc.ale,"notifications",j("i18n")("item_name_"+c.item,a.loc.ale,"building_statue")),z):M(j("i18n")("paladin_item_level",a.loc.ale,"notifications",j("i18n")("item_name_"+c.item,a.loc.ale,"building_statue"),c.level),z)},oa=function(b,c){M(j("i18n")("coop_fluctuation_limit_reached",a.loc.ale,"notifications",j("readableDateFilter")(1e3*c.details.available_in)),w,null,F)};d.showNext=function(){f.cancel(s),d.visible=null,s=null,M.apply(J,K.pop())},d.hideNotification=function(a){k.emit(l.NOTIFICATION_MARK_READ,{id:a},d.showNext)},d.hide=function(a){a?d.hideNotification(a):d.showNext()},d.buyOffer=function(a,b){m.buyItem(a),d.hideNotification(b)},d.$on(h.ACADEMY_RECRUIT_JOB_CREATED,Q),d.$on(h.BARRACKS_RECRUIT_JOB_CREATED,Q),d.$on(h.PRECEPTORY_RECRUIT_JOB_CREATED,Q),d.$on(h.STATUE_RECRUIT_JOB_CREATED,Q),d.$on(h.UNIT_RECRUIT_JOB_FINISHED,_),d.$on(h.ACADEMY_RECRUIT_JOB_CANCELED,R),d.$on(h.BARRACKS_RECRUIT_JOB_CANCELED,R),d.$on(h.PRECEPTORY_RECRUIT_JOB_CANCELED,R),d.$on(h.STATUE_RECRUIT_JOB_CANCELED,R),d.$on(h.MESSAGE_SENT,ea),d.$on(h.SETTINGS_PASSWORD_CHANGED,da),d.$on(h.TRIBE_INVITATION_CREATED,fa),d.$on(h.TRADING_OFFER_CREATED,aa),d.$on(h.TRADING_OFFER_REMOVED,ba),d.$on(h.MESSAGE_ERROR,ca),d.$on(h.EXCEPTION_DB,ca),d.$on(h.EXCEPTION_SYSTEM,ca),d.$on(h.EXCEPTION_UNMET_REQUIREMENTS,ca),d.$on(h.ACHIEVEMENT_PROGRESS,P),d.$on(h.VILLAGE_LOST,ga),d.$on(h.VILLAGE_CONQUERED,ha),d.$on(h.PALADIN_UNLOCK_NEXT_ITEM,na),d.$on(h.BUILDING_UPGRADING,S),d.$on(h.BUILD_JOB_CANCELLED,T),d.$on(h.PREMIUM_CHANGED,U),d.$on(h.LOGIN_SUCCESS,V),d.$on(h.QUESTS_QUEST_FINISHED,W),d.$on(h.TRIBE_MEMBER_RIGHTS_SET,X),d.$on(h.TRIBE_MEMBER_KICKED,Y),d.$on(h.TRIBE_DISBANDED,Z),d.$on(h.TRIBE_APPLICATION_ACCEPTED,$),d.$on(h.INVENTORY_ITEM_CHANGED,ia),d.$on(h.EFFECT_CHANGED,ja),d.$on(h.NOTIFICATION_NEW,ka),d.$on(h.NOTIFICATION_DISABLE,la),d.$on(h.NOTIFICATION_ENABLE,ma),d.$on(h.MESSAGE_WELCOME,function(a,b){}),d.$on(h.MESSAGE_DEBUG,function(a,b){M(b.message,v)}),d.$on(h.MESSAGE_SUCCESS,function(a,b){M(b.message,z)}),d.$on(h.MESSAGE_PARTY,function(a,b){M(b.message,x,b.icon,G)}),d.$on(h.MESSAGE_SMART_TIP,function(a,b){M(b.message,y,b.icon,b.duration,null,null,null,b.action.bind(b))}),a.$on(h.GAME_SETTINGS_CHANGED,O),a.$on(h.CHARACTER_INFO,O),d.$on(n.COOP_FLUCTUATION_LIMIT_REACHED,oa),d.$on(n.VILLAGE_INSUFFICIENT_RESOURCES,ca),d.$on(n.TRIBE_NOT_ENOUGH_POINTS,ca),d.$on(n.COOP_VALIDATED_EMAIL_NEEDED,ca),d.$on(n.TRIBE_SKILL_MUST_MAINTAIN_MEMBER_LIMIT,ca),d.$on(n.COOP_MUST_BE_FOUNDER,ca),d.$on(n.SCOUTING_NOT_ENOUGH_SPIES_FOR_SABOTAGE,ca),d.$on(n.MESSAGE_NOT_ENOUGH_POINTS,ca),d.$on(n.COMMAND_CANNOT_USE_PRESET,ca),d.$on(n.PLAYER_PICK_DIFFERENT_PW,ca),d.$on(n.AUTH_INCORRECT_PASSWORD,ca),d.type=d.content="",d.SPECIALOFFER=C,d.ACHIEVEMENT=A,d.TIP=y}])}),define("helper/fx",[],function(){var a=Math.SQRT2,b=2*Math.PI;return{fogOpacity:function(a,b,c){return((c-b)/(c-a)*.9).bound(0,1)},linear:function(a){return a},sqrt:function(a){return Math.sqrt(a)},sq1:function(a){return a*a},sq2:function(a){return a-=1,-a*a+1},cubic:function(a){return a-=1,a*a*a+1},circle:function(a){return a-=1,Math.sqrt(1-a*a)},easeInOut:function(a){return.5-.5*Math.cos(a*Math.PI)},jump:function(b){return Math.pow(a*b-.5*a,4)-Math.pow(a*b-.5*a,2)+.25},easeOutBack:function(a){return.3-.3*Math.cos(1.8*a*Math.PI)+.95*a},doubleJumpEaseOut:function(a){var c=Math.sin(b*a)*Math.sin(b*a)/a;return c>0?c/b:0},selectVillageScale:function(a){return 1+.2*(1-a)},jumpToVillageScale:function(a){return 1+.25*Math.abs(Math.sin(2*(1-a)*Math.PI))}}}),define("engine2dConf",["plugins"],function(){return{FOG_COLORS:{day:["rgba(141, 167, 188, 1)","rgba(141, 167, 188, 0)"],night:["rgba(30, 40, 50, 1)","rgba(30, 40, 50, 0)"]},DEBUG:!1,DEBUG_LEVEL_TWO:!1,CLEAR_EVERY_FRAME:!0,DRAW_TILE_NUMBERS:!1,DRAW_IMAGES:!0,DRAW_VERTS:!1,DRAW_CENTER_VERTS:!1,IMAGE_SMOOTHING:!0,SHADOWS:!0,MARK_CENTER:!0,MODES:["DEFAULT","EDIT"].toEnum()}}),define("construct/Engine2d",["conf/conf","conf/colors","helper/math","helper/fx","engine2dConf","queues/EventQueue"],function(a,b,c,d,e,f){var g=function(b){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=b.rootnode,N=b.width,O=b.height,P=b.view||{x:0,y:0,z:1},Q=b.settings||{},R=[],S=[1,0,0,1,0,0],T=!1,U=0,V=0,W=0,X="day",Y=a.TILESIZE,Z=Y.x,$="#fff",_="bold 12px Trebuchet MS",aa="left",ba="right",ca="center",da=0,ea=0,fa=["TOWN","ZERO","ONE","TWO","THREE"].toEnum(),ga=fa.ZERO,ha=this,ia=!0,ja=10,ka=function(a){m=l.createLinearGradient(0,0,0,k.height),m.addColorStop(0,e.FOG_COLORS[a][0]),m.addColorStop(1,e.FOG_COLORS[a][1]),l.fillStyle=m,l.fillRect(0,0,2,k.height)},la=function(a,b,c,d){arguments.length?(A=a.bound(0,N),B=b.bound(0,O),C=c.bound(0,N),D=d.bound(0,O)):(A=0,B=0,C=N,D=O)},ma=function(){var a;if(!Modernizr.canvas)throw new Error("HTML5 Canvas is needed.");return g=document.createElement("canvas"),i=document.createElement("canvas"),k=document.createElement("canvas"),g.width=i.width=N&=-2,g.height=i.height=O&=-2,g.id="main-canvas",k.height=~~(.4*O),k.width=2,ha.canvas=g,h=g.getContext("2d"),j=i.getContext("2d"),l=k.getContext("2d"),h.textAlign=ca,h.save(),ka(X),(a=Modernizr.prefixed("imageSmoothingEnabled",h,!1))&&(h[a]=j[a]=e.IMAGE_SMOOTHING),la(0,0,N,O),M.appendChild(g),ha},na=function(a,b,c){t=!0,f.once(f.types.NEW_FRAME,function(){g.width=N=i.width=0|(a||2),g.height=O=i.height=0|(b||2),k.height=Math.max(1,~~(.4*O)),h.restore(),h.save(),ka(X),la(),c&&c()})},oa=function(a,b){b=b||h,p=a.matrix,b.save(),b.transform(p[0],p[1],p[2],p[3],p[4],p[5]),b.fillRect(-2,-2,4,4),b.restore(),ea++},pa=function(a,b){a.visible&&a.verts&&a.verts[0]&&(b=b||h,b.save(),b.lineWidth=4,b.lineJoin="round",a.draw(b,P),b.restore(),ea++)},qa=function(a){var b,c=230;a=a||h,a.save(),a.fillStyle=$,a.font="bold 12px Consolas, monospace",a.textAlign="left",a.fillText("FPS:"+ha.getFps(),2,c),a.fillText("ELEMENTS_DRAWN:"+ea,2,c+=15);for(b in e)e.hasOwnProperty(b)&&a.fillText(b+": "+e[b],2,c+=15);for(b in P)P.hasOwnProperty(b)&&a.fillText("view."+b+":"+P[b],2,c+=15);for(b in ha.mousepos)ha.mousepos.hasOwnProperty(b)&&a.fillText("m."+b+":"+ha.mousepos[b],2,c+=15);a.fillText("d.x:"+U,2,c+=15),a.fillText("d.y:"+V,2,c+=15),a.fillText(n,2,c+=15),a.fillText("dirtyRectList: "+o.length,2,c+=15),e.MARK_CENTER&&(a.fillStyle="#ff0000",a.fillRect(N/2-2,O/2-2,4,4)),a.restore()},ra=function ya(a,b,d,f,g){var i,j,k,l,m=Date.now();if(i=a.children)for(;i--;)ya(a.children[i],b,d,f,g);if((!a.matrix||a.modified||a.redraw)&&(a.matrix=a.getTotalTransformation()),a.animated){for(j in a.animationFn)(k=a.animationFn[j])&&(l=((m-k.startedAt)/k.duration).bound(0,1),a[j]=k.call(a,l,a[j]),a.modified=!0,1===l&&(k.loop?(l=0,k.startedAt=m):a.clearAnimation(j)));a.animated=a.animationFn.scale||a.animationFn.rotation||a.animationFn.translation}p=a.matrix=a.getTotalTransformation(),v=c.multiply(S,p),a.noclip||(-Z<v[4]+a.width&&N+Z>v[4]&&-Z<v[5]+a.height&&O+Z>v[5]?a.clip=!1:a.clip=!0),(U&&(v[4]-U<Z||v[4]-U+a.width>N-Z)||V&&(v[5]-V<Z||v[5]-V+a.height>O-Z))&&(a.modified=!0),(a.redraw||a.modified||a.frames||a.animated)&&(e.DRAW_IMAGES&&a.img&&0!==a.alpha&&(h.save(),h.transform(p[0],p[1],p[2],p[3],p[4],p[5]),1!==a.alpha&&(h.globalAlpha=a.alpha),a.origin&&h.translate(a.origin[0],a.origin[1]),a.frames?a.getDirtyRects(Date.now())&&(a.lastFrame=(a.lastFrame+1)%a.frames,h.drawImage(a.img,a.imageCoords[a.lastFrame][0],a.imageCoords[a.lastFrame][1],a.width,a.height,0,0,a.width,a.height)):h.drawImage(a.img,a.sx||0,a.sy||0,a.width,a.height,0,0,a.width,a.height),1!==a.alpha&&(h.globalAlpha=1),h.restore()),ea++,a.modified=!1)},sa=function za(a,b,d,f,g,i,j,k){if(j)for(var l,m,n,o,q,r,s=a.children.length,u=Date.now();s--;)l=a.children[s],l.children?za(l,b,d,f,g,i):(m=l,(!m.matrix||m.modified)&&(m.matrix=m.getTotalTransformation()),p=m.matrix,v=c.multiply(S,p),q=c.vmultiply(v,[0,0]),r=c.vmultiply(v,[m.width,m.height]),K=r[0]-q[0],L=r[1]-q[1],(t||q[0]<b+f&&r[0]>b&&q[1]<d+g&&r[1]>d)&&(h.save(),m.frames||(b-=1,d-=1,f+=2,g+=2),(t||m.frames||j||(m.redraw||m.modified)&&m.img&&0!==m.alpha)&&(h.transform(p[0],p[1],p[2],p[3],p[4],p[5]),n=m.width/K,o=m.height/L,E=q[0]<b?Math.floor((b-q[0])*n):0,F=q[1]<d?Math.floor((d-q[1])*o):0,G=r[0]>b+f?Math.ceil((f-(q[0]-b))*n)-E:m.width-E,H=r[1]>d+g?Math.ceil((g-(q[1]-d))*o)-F:m.height-F,G>0&&H>0&&E>=0&&F>=0&&(1!==m.alpha&&(h.globalAlpha=m.alpha),m.frames?(m.lastFrameUpdate+m.frameDuration<u&&(m.sequences&&m.lastFrame===m.sequences[m.currentSequence].end&&(m.sequences[m.currentSequence].cycle&&Math.random()>.5?m.lastFrame=m.sequences[m.currentSequence].start-1:m.currentSequence=(m.currentSequence+1)%m.sequences.length),m.lastFrame=(m.lastFrame+1)%m.frames,m.lastFrameUpdate=u),h.drawImage(m.img,E+m.imageCoords[m.lastFrame][0],F+m.imageCoords[m.lastFrame][1],G,H,E,F,G,H),e.DEBUG&&e.DRAW_TILE_NUMBERS&&(h.strokeStyle="#0f0",h.strokeRect(E,F,G,H),h.fillText(m.name,0,0)),ea++):(h.drawImage(m.img,E,F,G,H,E,F,G,H),ea++,e.DEBUG&&e.DRAW_TILE_NUMBERS&&(h.strokeStyle="hsl("+Math.floor(360*Math.random())+", 100%, 50%)",h.fillStyle=h.strokeStyle,h.textAlign=aa,h.strokeRect(E+1,F+1,G-2,H-2),h.fillText([b,d,f,g],E,F+H-15),h.fillText(k,E,F+H))),1!==m.alpha&&(h.globalAlpha=1)),m.modified=!1,h.restore())))},ta=function(a,b,d,f,g,i,j){var k,l;for(q=w.children.length;q--;)r=w.children[q],r.children&&!r.composite||(r.composite?(s=r.composite,p=r.getTotalTransformation()):(s=r,(!s.matrix||s.modified)&&(s.matrix=s.getTotalTransformation()),p=s.matrix),v=c.multiply(S,p),I=c.vmultiply(v,[0,0]),J=c.vmultiply(v,[s.width,s.height]),K=J[0]-I[0],L=J[1]-I[1],(t||s.frames||I[0]>a-K&&J[0]<a+d+K&&I[1]>b-L&&J[1]<b+f+L)&&(U||V||W||t||s.frames||i||(s.redraw||s.modified||g)&&s.img&&0!==s.alpha)&&(h.save(),h.transform(p[0],p[1],p[2],p[3],p[4],p[5]),k=s.width/K,l=s.height/L,E=I[0]<a?Math.floor((a-I[0])*k):0,F=I[1]<b?Math.floor((b-I[1])*l):0,G=J[0]>a+d?Math.ceil((d-(I[0]-a))*k)-E:s.width-E,H=J[1]>b+f?Math.ceil((f-(I[1]-b))*l)-F:s.height-F,G>0&&H>0&&E>=0&&F>=0&&(1!==s.alpha&&(h.globalAlpha=s.alpha),s.frames?(s.lastFrame=(s.lastFrame+1)%s.frames,h.drawImage(s.img,s.imageCoords[s.lastFrame][0],s.imageCoords[s.lastFrame][1],s.width,s.height,0,0,s.width,s.height)):s.village?((g||t||s.modified||W||s.compositeScale!==S[0])&&s.updateComposite(S[0]),h.drawImage(s.compositeImage,E,F,G,H,E,F,G,H)):h.drawImage(s.img,E,F,G,H,E,F,G,H),ea++,1!==s.alpha&&(h.globalAlpha=1)),e.DRAW_TILE_NUMBERS&&(h.save(),h.transform(1,0,0,1,20,30),h.fillText(s.name,0,5),s.data&&(h.fillText(s.data.x,20,55),h.fillText(s.data.y,20,75)),h.restore()),s.modified=!1,h.restore()),s.noclip||W||(v[4]>N+s.width||v[4]<1.5*-s.width||v[5]>O+s.height||v[5]<1.5*-s.height?s.clip=!0:s.clip=!1)),r.composite&&sa(r,a,b,d,f,g,i,j);e.DEBUG_LEVEL_TWO&&(h.save(),h.setTransform(1,0,0,1,0,0),h.strokeStyle="#ff0",h.strokeRect(a,b,d,f),h.restore())},ua=function(b,c,l,m,p){var q,r,s=Date.now();if(R.length&&(ha.setView2(R.pop()),R=[]),t=t||p,e.CLEAR_EVERY_FRAME&&h.clearRect(0,0,N,O),w=w||u.layers.tiles,x=x||u.layers.overlays,z=z||u.layers.movements,y=y||u.layers.effects,U=P.x-S[4],V=P.y-S[5],W=P.z-S[0],S[0]=S[3]=P.z,S[4]=P.x,S[5]=P.y,f.trigger(f.types.NEW_FRAME,da),ea=0,h.drawImage(i,b,c,l,m,b+U,c+V,l,m),h.textAlign=ca,h.save(),h.transform(S[0],0,0,S[3],S[4],S[5]),t||W||s>=u.getNextScheduledRedraw()?(u.lastForcedRedraw=s,ta(b,c,l,m,!0,!1)):(U>0?ta(b,c,U+ja,m):0>U&&ta(b+l+U-ja,c,-U+ja,m),V>0?ta(b,c,l,V+ja):0>V&&ta(b,c+m+V-ja,l,-V+ja)),(o=u.getDirtyRects(s,S,[b,c,l,m])).length)for(q=o.length;q--;)ta(o[q][0]-2,o[q][1]-2,o[q][2]-o[q][0]+4,o[q][3]-o[q][1]+4,!0,!0);if((ea||t)&&(j.clearRect(b,c,l,m),j.drawImage(g,b,c,l,m,b,c,l,m)),y.each(ra),h.restore(),h.save(),h.transform(P.z,0,0,P.z,P.x,P.y),h.fillStyle=$,e.DRAW_VERTS&&ga===fa.ZERO)for(q in u.verts)if(u.verts.hasOwnProperty(q))for(r in u.verts[q])u.verts[q].hasOwnProperty(r)&&(u.verts[q][r].center&&e.DRAW_CENTER_VERTS||!u.verts[q][r].center)&&oa(u.verts[q][r]);h.textAlign=aa,h.font=_,z.each(pa),x.each(pa),h.restore(),Q.fog&&(h.save(),h.globalAlpha=n=d.fogOpacity(a.ZOOM.MIN,P.z,a.ZOOM.MAP_MAX),h.drawImage(k,0,0,g.width,k.height),h.restore()),!ia||1&da||u.sweep(),e.DEBUG&&qa(),h.fillStyle=$,h.textAlign=ba,h.fillText(a.HOST,g.width-5,g.height-23),t=!1},va=function Aa(){T&&(f.handle(),requestAnimationFrame(Aa),da++,ua(A,B,C,D))},wa=function(){return!u.layers.tiles||T?!1:(T=!0,va(),!0)},xa=function(){t=!0,h&&ha.isRunning()&&ua(0,0,N,O)};this.levels=fa,this.level=ga,this.mode=e.MODES.DEFAULT,this.mousepos={x:0,y:0},this.d={},this.effects=b.effects,this.overlays=b.overlays,this.graph=u=b.graph,this.init=ma,this.resize=na,this.setRect=la,this.start=wa,this.stop=function(){T=!1},this.isRunning=function(){return T},this.setView2=this.setView=function(a){P.x=0|a.x,P.y=0|a.y,P.z=a.z||P.z},this.getView=function(){return R.length?R[R.length-1]:{x:P.x,y:P.y,z:P.z}},this.getViewMatrix=function(){var a=R.length?R[R.length-1]:P;return[a.z,0,0,a.z,a.x,a.y]},this.clearBuffer=function(){j.clearRect(0,0,N,O)},this.getCanvasSize=function(){return{x:N,y:O}},this.forceRedraw=xa,this.draw=ua,this.getTransform=function(){return S.concat()},this.setTimeOfDay=function(a){Q.nightModeGraphics&&ka(X=a)}};return g.prototype.getFps=function(){var a,b,c=[];return function(){for(b=Date.now(),c.push(1e3/(b-a)|0);c.length>1;)c.shift();return a=b,0|c.mean()}}(),g.prototype.countTiles=function(){var a=0;return this.graph.layers.tiles.children.forEach(function(b){b.children?b.each(function(){a++}):a++}),a},g}),define("construct/graph/Tile",["construct/graph/GraphNode","generators/generate"],function(a,b){var c=function(a,c,d,e,f,g,h,i){this.size={x:d,y:e},this.width=d,this.height=e,this.parentNode=null,this.uniqueId=b.hex(),this.name=c,this.img=a,this.sx=h,this.sy=i,this.translation=[1,0,0,1,f,g],this.matrix=null,this.verts=[],this.modified=!0,this.clip=!1,this.zindex=0};return c.inherits(a),c.prototype.getTransformation=function(){return this.translation},c}),define("construct/graph/SceneGraphGroup",["require","conf/conf","construct/graph/Tile","construct/graph/Sprite","helper/math","generators/generate","construct/graph/GraphNode"],function(a){var b=a("conf/conf"),c=(a("construct/graph/Tile"),a("construct/graph/Sprite")),d=a("helper/math"),e=a("generators/generate"),f=a("construct/graph/GraphNode"),g=b.TILESIZE.tri/b.TILESIZE.y,h="source-over",i="source-atop",j=2*g,k=function(a,b){this.uniqueId=e.hex(),this.matrix=null,this.translation=[1,0,0,1,0,0],this.scale=[1,0,0,1,0,0],this.rotation=[1,0,0,1,0,0],this.childrenNameTable={},this.children=[],this.name=a||"",this.hidden=!1,this.parentNode=null,this.zindex=b||1,this.boxSize=[0,0],this.animationList=[],this.composite=null,this.redrawSchedule=[]};return k.inherits(f),k.prototype.createComposite=function(a){for(var e,f,g,j,k,l=document.createElement("canvas"),m=0,n=0,o=1,p=this.children.length;p--;)f=this.children[p],f.frames||(j=d.vmultiply(f.getTransformation(),[f.width,f.height]),m=Math.max(m,j[0]),n=Math.max(n,j[1]));for(l.width=m*o|0,l.height=n*o|0,e=l.getContext("2d"),a&&(e.globalCompositeOperation=h,e.drawImage(a,0,0,m,n),e.globalCompositeOperation=b.GHOST_TOWN_ON_ZOOM?"lighter":i),this.sort(this.zCompare),p=this.children.length;p--;)f=this.children[p],f.frames||(g=f.getTransformation(),e.save(),e.transform(g[0]*o,g[1],g[2],g[3]*o,g[4],g[5]),e.drawImage(f.img,0,0),e.restore(),f.modified=!1);if(b.SHOW_CLICK_AREAS){for(p=this.children.length,e.fillStyle="#0ff",e.lineWidth=5;p--;)if(f=this.children[p],!f.frames&&f.verts&&f.verts.length){for(e.beginPath(),e.arc(f.verts[0][0]*b.BG_WIDTH,f.verts[0][1]*b.BG_HEIGHT,10,0,2*Math.PI),e.fill(),e.closePath(),e.strokeStyle="#f0f",e.beginPath(),e.moveTo(f.verts[0][0]*b.BG_WIDTH,f.verts[0][1]*b.BG_HEIGHT),k=0;k<f.verts.length;k++)e.lineTo(f.verts[k][0]*b.BG_WIDTH,f.verts[k][1]*b.BG_HEIGHT);e.closePath(),e.stroke(),e.strokeStyle="#0ff",e.beginPath(),e.moveTo(f.verts[0][0]*b.BG_WIDTH,f.verts[0][1]*b.BG_HEIGHT),e.lineTo(f.verts[1][0]*b.BG_WIDTH,f.verts[1][1]*b.BG_HEIGHT),e.stroke(),e.closePath()}f.modified=!1}return a&&(e.globalCompositeOperation=h),this.composite=new c(l,"composite",m,n,0,0,1,0),this.composite.noclip=!0,this},k.prototype.push=function(a){var b,c;if(!a)return this;for(this.childrenNameTable[a.name],a.parentNode=this,this.childrenNameTable[a.name]=a,b=0,c=this.children.length;c>b&&!(this.children[b].zindex<=a.zindex);b++);if(this.children.splice(b,0,a),a.frames>0?this.addToAnimationList(a):a.animationList&&a.animationList.length&&this.addToAnimationList(a.animationList),a.nextRedraw)this.scheduleRedraw(a.nextRedraw);else if(a.redrawSchedule&&(b=a.redrawSchedule.length))for(;b--;)this.scheduleRedraw(a.redrawSchedule[b]);return this},k.prototype.removeFromAnimationList=function(a){var b="string"==typeof a?a:a.uniqueId,c=this.animationList.indexOf(b);if(!(c>=0))throw new Error;return this.animationList.remove(c),this.parentNode&&this.parentNode.removeFromAnimationList(a),this},k.prototype.addToAnimationList=function(a){var b,c;if(b=a.length)for(;b--;){if("string"==typeof a[b])c=a[b];else{if(void 0===a[b].uniqueId)throw new Error(a[b].toString()+" has no uniqueId!");c=a[b].uniqueId}this.animationList.indexOf(c)<0&&this.animationList.push(c)}else{if(void 0===a.uniqueId)throw new Error("No uniqueId!");this.animationList.indexOf(a.uniqueId)<0&&this.animationList.push(a.uniqueId)}return this.parentNode&&this.parentNode.addToAnimationList(a),this},k.prototype.zCompare=function(a,b){return b.zindex-a.zindex||0},k.prototype.merge=function(a){for(var b,c,d;b=a.children.pop();){for(d=this.children.length;d--;)this.children[d].uniqueId===b.uniqueId&&this.children[d].remove(),(c=this.childrenNameTable[b.name])&&c.remove();this.push(b)}},k.prototype.promoteChild=function(a){a.zindex,this.children.remove(this.children.indexOf(a)),this.children.unshift(a)},k.prototype.findMovementsAt=function(a){return this.children&&this.children.filter(function(b){return b.isDrawnOn&&b.isDrawnOn(a)})},k.prototype.findTilesAt=function(a){for(var c,d,e,f,h=[],i=this.children.length;i--;)c=this.children[i],c.children?h.push.apply(h,c.findTilesAt(a)):(d=c.getTotalTransformation(),a.x.between(d[4],d[4]+c.width)&&a.y.between(d[5],d[5]+c.height)&&(e=(a.x-d[4])/b.TILESIZE.x,f=(a.y-d[5])/b.TILESIZE.y,e>.5&&(e=1-e),f>1-g&&(f=1-f),g>f?(f=g-f,e*j>=f&&h.push(c)):h.push(c)));return h},k.prototype.zIndex=function(a){return void 0===a?this.zindex:(this.zindex=a,this.parentNode.children.sort(this.zCompare),this)},k.prototype.sweep=function(){for(var a,b,c=this.children.length;c--;)if(b=this.children[c],(b.clip||b.children&&0===b.children.length)&&!b.noclip){if(b.verts&&(a=b.verts.length))for(;a--;)if(!--b.verts[a].shared){if(b.verts[a].shared<0)throw new Error;b.verts[a].graph.removeVert(b.verts[a])}b.frames&&this.removeFromAnimationList(b),delete this.childrenNameTable[b.name],this.children.remove(c)}else b.children&&b.sweep()},k.prototype.removeChild=function(a){for(var b,c,d=this.children.length;d--;)if(b=this.children[d],b.uniqueId===a&&(c=this.animationList.indexOf(b.uniqueId))>=0&&this.removeFromAnimationList(b),void 0===a||b.uniqueId===a){if(b.onRemove&&b.onRemove(),this.animationList.indexOf(b.uniqueId)>=0&&this.removeFromAnimationList(b),b.nextRedraw)this.unschedule(b.nextRedraw);else if(b.redrawSchedule&&(d=b.redrawSchedule.length))for(;d--;)this.unschedule(b.redrawSchedule[d]);delete this.childrenNameTable[b.name],b.parentNode=null,this.children.remove(d)}return this},k.prototype.remove=function(){for(var a=this.children.length;a--;)this.removeChild(this.children[a].uniqueId);return this.parentNode&&this.parentNode.removeChild(this.uniqueId),this},k.prototype.hasChild=function(a){return this.childrenNameTable[a]},k.prototype.empty=function(){return this.removeChild(),this},k.prototype.each=function(a){if(!this.hidden){var b,c=this.children.length;for(a.call(this,this);c--;)b=this.children[c],b instanceof k?b.each(a):a.call(b,b);return this}},k.prototype.sort=function(a){return a||(a=this.zCompare),this.children.forEach(function(b){b instanceof k&&b.sort(a)}),this.children.sort(a),this},k.prototype.setAlpha=function(a){for(var b=this.children.length;b--;)this.children[b].alpha=a;return this.composite&&(this.composite.alpha=a),this},k.prototype.getDirtyRects=function(a){for(var b,c=this.children.length,d=[];c--;)b=this.children[c].getDirtyRects(a),b&&b.length&&("number"==typeof b[0]?d.push(b):d=d.concat(b));return d},k.prototype.scheduleRedraw=function(a){return a>Date.now()&&(this.redrawSchedule.indexOf(a)<0&&(this.redrawSchedule.push(a),this.redrawSchedule.sort()),this.parentNode&&this.parentNode.scheduleRedraw(a)),this},k.prototype.unschedule=function(a){var b=this.redrawSchedule.indexOf(a);b>-1&&this.redrawSchedule.remove(b),this.parentNode&&this.parentNode.unschedule(a)},k}),define("construct/VillageCanvasController",["battlecat","conf/conf","engine2dConf","helper/math","helper/color","helper/time","construct/graph/Sprite","construct/graph/SceneGraphGroup","queues/EventQueue","states/MapState"],function(a,b,c,d,e,f,g,h,i,j){return function(a,c,e){var f,k,l,m,n=this,o=window.injector.get("eventTypeProvider"),p=window.injector.get("$rootScope"),q=window.injector.get("modelDataService"),r=window.injector.get("mapService"),s=window.injector.get("canvasAssetService"),t=window.injector.get("contextMenuService"),u=window.injector.get("buildingService"),v=window.injector.get("buildingLabelService"),w=window.injector.get("$rootScope"),x=window.injector.get("$timeout"),y=Math.ceil(5*Math.random()),z=(c.engine.getCanvasSize(),j.graph.findByName("highlight")),A=(b.TILESIZE,"/BG_0_0.jpg"),B=[],C=null,D=null,E=!1,F=!1,G=function(a){var c,e=[a[0]/b.BG_WIDTH,a[1]/b.BG_HEIGHT];if(!n.group)return!1;for(c=0;c<n.group.children.length;c++)if(n.group.children[c].verts&&d.isPointInPolygon(e,n.group.children[c].verts))return n.group.children[c].name.replace(/\d+/,"");return!1},H=function(a,b){var c;return c=new g(a.img,a.data.name+(b||""),null,null,a.data.x,a.data.y,1,0),c.verts=a.data.verts,c.noclip=!0,c.zindex=a.data.z||0,c},I=function(a,c){var d,e,h=a.length,i={bg:1};if(m={},n.group){for(n.group.scale[0]=n.group.scale[3]=b.VILLAGE_SCALE,n.group.translation[4]=l[0]||0,n.group.translation[5]=l[1]||0;h--;)i[a[h].data.name]=a[h].data.z,d=H(a[h],h),n.group.push(d);for(h in c)e=c[h],d=new g(e.image,e.meta.name,e.meta.width,e.meta.height,e.meta.x,e.meta.y,1,0,null,e.meta.frames,null,e.items),e.meta.seq&&(d.sequences=e.meta.seq,d.currentSequence=Math.floor(Math.random()*e.meta.seq.length)),/watermill/.test(e.meta.name)?d.zindex=i[e.meta.base]+.2:d.zindex=i[e.meta.base]+.1||500,d.noclip=!0,n.group.push(d);d=new g(f,"background",b.BG_WIDTH,b.BG_HEIGHT),d.zindex=1,n.group.push(d),n.group.createComposite(F?!1:s.tiles.villageMask)}},J=function(a){var b,c,e;if(n.group)return b=d.invert(n.group.getTransformation()),c=d.vmultiply(b,[a.x,a.y]),(e=G(c))?(n.selectedBuilding=n.group.childrenNameTable[e],e||""):void t.destroy()},K=function(a,e){var f,g,h,i,j,k,l,m;n.group&&(f=n.group.getTotalTransformation(),g=u.getPosition(a),h=d.vmultiply(f,g),i=[c.engine.getView().z,0,0,c.engine.getView().z,0,0],j=d.multiply(i,[1,0,0,1,-h[0],-h[1]]),k=c.engine.graph.getScreenCoords({matrix:d.multiply(f,[1,0,0,1,g[0],g[1]])},c.engine.getView()),l=c.engine.getCanvasSize(),m=b.SAFE_FRAME_OFFSET,k.x.between(m,l.x-m)&&k.y.between(m,l.y-m)&&!e||(C=c.animateTo({x:j[4]+(l.x>>1),y:j[5]+(l.y>>1),z:j[0]},667,"easeInOut")))},L=function(a){return a?u.isBuildingResearched(a)||q.getSelectedVillage().getBuildingLevel(a):void 0},M=function(a,b){var c=J(b);if(L(c))return D=x(function(){t.showVillageMenu({name:c},n.group),K(c)},150),c},N=function(){"function"==typeof C&&(C(),C=null)},O=function(a,b){var c=J(b);x.cancel(D),N(),L(c)&&(w.$broadcast(o.VILLAGE_SELECT_BUILDING,c),t.destroy())},P=function(a,b){n.group&&n.group.empty(),I(a,b),c.setView(c.engine.getView())},Q=function(a,b){if(!b.pressed&&!E&&n.group){E=!0;var e=d.invert(n.group.getTransformation()),f=d.vmultiply(e,[b.x,b.y]),g=G(f);g?c.setCursor("pointer"):c.setCursor(),E=!1}},R=function(){k=q.getSelectedVillage().getBuildingData(),s.getImage("/img/village/"+r.getTimeOfDay()+A,function(a){f=a,s.getVillageAssets(r.getTimeOfDay(),k.data,q.getGameData().getUnits(),y,F,function(a,b){P(a,b),c.engine.forceRedraw()})})},S=function U(){s.getImage("/img/village/"+r.getTimeOfDay()+A,function(a){f=a;var c=q.getSelectedVillage();F&&B.length&&n.destroy(),k=c.getBuildingData(),l=r.tileCoordinate2Pixel(c.getX(),c.getY()),n.boundary={x:{min:-l[0],max:-(l[0]+b.BG_WIDTH*b.VILLAGE_SCALE)},y:{min:-l[1],max:-(l[1]+b.BG_HEIGHT*b.VILLAGE_SCALE)}},F||p.$broadcast(o.MAP_LOADING_ASSETS),s.getVillageAssets(r.getTimeOfDay(),k.data,q.getGameData().getUnits(),y,F,function(a,b){F&&p.$broadcast(o.MAP_JUMP_TO,c.getX(),c.getY(),null,!0),z.hidden=!0,i.register(i.types.CLICK,M),i.register(i.types.DOUBLECLICK,O),i.register(i.types.MOUSEMOVE,Q),B.push(p.$on(o.VILLAGE,function(){U()})),B.push(p.$on(o.RESEARCH_RESEARCHED,R)),B.push(p.$on(o.BUILDING_QUEUE,R)),B.push(p.$on(o.BUILDING_LEVEL_CHANGED,function(a,b){b.village_id===q.getSelectedVillage().getId()&&(k=q.getSelectedVillage().getBuildingData(),s.getVillageAssets(r.getTimeOfDay(),k.data,q.getGameData().getUnits(),y,F,function(a,b){P(a,b),window.twx.game.map.forceRedraw()}))})),P(a,b),j.graph.layers.tiles.push(n.group),n.group.zIndex(1/0),!F&&e&&e(n),F=!0,window.twx.game.map.forceRedraw(),v.show(),p.$broadcast("DONE")})})},T=function(){var b;for(n.group.remove(),a.style.cursor="",i.unregister(i.types.CLICK,M),i.unregister(i.types.DOUBLECLICK,O),i.unregister(i.types.MOUSEMOVE,Q);b=B.pop();)b();z.hidden=!1,t.destroy(),v.hide()};this.group=new h("town"),this.scale={x:b.VILLAGE_SCALE*b.BG_WIDTH,y:b.VILLAGE_SCALE*b.BG_HEIGHT},this.destroy=T,this.init=S,this.forceRedraw=R,this.onClick=M,this.animateToBuilding=K,this.onDoubleClick=O,this.selectBuildingByPos=J,S()}}),define("construct/graph/Village",["construct/graph/GraphNode","conf/colors","conf/conf","generators/generate","helper/color"],function(a,b,c,d,e){var f="#000",g=4,h="source-atop",i="source-over",j="multiply",k=24,l=document.createElement("canvas"),m=l.getContext("2d"),n="…",o={offset:25,w:22,h:22},p=function(a,b,e,g,h,i,j,k,l,m){switch(this.width=Math.min(h||a.width,a.width),this.height=Math.min(i||a.height,a.height),this.parentNode=null,this.uniqueId=void 0===l||null===l?d.hex():l,this.name=g,this.key="",this.img=a,this.icon=b,this.protectionIcon=e.noobProtection,this.productionBoost=e.productionBoost,this.text=null,this.color="",this.alpha=1,this.verts=[],this.matrix=null,this.translation=[1,0,0,1,j||0,k||0],this.origin=null,this.modified=!0,this.redraw=!1,this.noclip=!1,this.clip=!1,this.zindex=j+k+1,this.data=m||{},this.village=!0,this.groupIcons=null,this.compositeImage=document.createElement("canvas"),this.compositeScale=null,this.compositeImage.width=h,this.compositeImage.height=i,this.ctx=this.compositeImage.getContext("2d"),this.ctx.textAlign="center",this.ctx.font="bold 14px Trebuchet MS",
this.ctx.strokeStyle=f,this.ctx.lineWidth=3,l){case c.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT:this.img=e.resourceDeposit,this.icon=e.resourceDepositIcon,this.name="resourceDeposit";break;case c.RESERVED_VILLAGE_IDS.INVITE_A_FRIEND:this.img=e.inviteAFriend,this.name="inviteAFriend";break;case c.RESERVED_VILLAGE_IDS.SECOND_VILLAGE:this.img=e.secondVillage,this.icon=e.secondVillageIcon,this.name="secondVillage"}};return l.width=34,l.height=20,p.inherits(a),p.prototype.updateComposite=function(a){var d,f,p,q,r,s,t,u,v,w=12/a,x=a*this.width-(this.data.attack_protection?2*o.w:0)-g,y=this.height*a-g-w;if(this.ctx.save(),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.img,0,0,this.width,this.height),this.data.boosted>Date.now()&&(this.scheduleRedraw(this.data.boosted),this.ctx.drawImage(this.productionBoost,0,0,this.productionBoost.width,this.productionBoost.height)),this.ctx.transform(1/a,0,0,1/a,c.TILESIZE.halfX,w),a>.5){if(d=this.data.name||"",f=this.ctx.measureText(d).width,f>x){for(;d&&d.length>1&&(f=this.ctx.measureText(d).width)>x;)d=d.slice(0,d.length-1);d=d.slice(0,d.length-1)+n}this.ctx.strokeText(d,0,5),p=this.data.points,void 0!==p&&(this.ctx.strokeText(p,0,20),this.ctx.fillStyle=b.village.points,this.ctx.fillText(p,0,20),this.data.attack_protection&&this.ctx.drawImage(this.protectionIcon,-(f/2+o.offset),-(o.w/2),o.w,o.h)),this.groupIcons&&(this.ctx.save(),this.groupIcons.width>x&&(v=x/this.groupIcons.width),k+this.groupIcons.height>y&&(v=y/(k+this.groupIcons.height)),this.ctx.transform(v,0,0,v,0,0),this.ctx.drawImage(this.groupIcons,-(this.groupIcons.width/2),k/(v||1)),this.ctx.restore()),this.ctx.fillStyle=this.color||b.village.ugly,this.ctx.fillText(d,0,5)}else if(this.uniqueId===c.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT||this.uniqueId===c.RESERVED_VILLAGE_IDS.SECOND_VILLAGE)this.ctx.drawImage(this.icon,-this.icon.width>>1,-this.icon.height>>1);else{if(m.clearRect(0,0,l.width,l.height),m.drawImage(this.icon,0,0),t=this.color||b.village.ugly,Modernizr.canvasblending)m.globalCompositeOperation=h,m.fillStyle=t,m.fillRect(0,0,this.icon.width,this.icon.height),m.globalCompositeOperation=j,m.drawImage(this.icon,0,0),m.globalCompositeOperation=i;else{for(q=m.getImageData(0,0,this.icon.width,this.icon.height),s=q.width*q.height*4,u=e.hex2Rgb(t).concat(255),r=0;s>r;r+=4)q.data[r]=q.data[r]*u[0]/255,q.data[r+1]=q.data[r+1]*u[1]/255,q.data[r+2]=q.data[r+2]*u[2]/255;m.putImageData(q,0,0)}this.ctx.drawImage(l,-this.icon.width>>1,-this.icon.height>>1)}this.ctx.restore(),this.compositeScale=a},p.prototype.getTransformation=function(){return this.translation},p}),define("construct/graph/Vert",[],function(){var a=function(a,b){this.matrix=a||[1,0,0,1,0,0],this.shared=0,this.graph=null,this.center=!!b};return a.prototype.toString=function(){return this.matrix.slice(-2).toString()},a.prototype.x=function(){return this.matrix[4]},a.prototype.y=function(){return this.matrix[5]},a}),define("construct/graph/Shape",["construct/graph/GraphNode","helper/math","generators/generate"],function(a,b,c){var d=function(){};return d.zIndex=function(){var a=0;return function(){return++a}}(),d.inherits(a),d.prototype.initialize=function(){this.uniqueId=c.hex(),this.visible=!0,this.allowCenter=!1,this.verts=[],this.mouseVert=null,this.zindex=d.zIndex(),this.textShape=null,this.textVert=null,this.textVertPercent=0,this.color="#fff"},d.prototype.setMouseVert=function(a){this.mouseVert=a},d.prototype.addVert=function(a){return this.verts.length>0&&b.equal(this.verts[0].matrix,a.matrix)?!1:(this.verts.push(a),2===this.verts.length)},d.prototype.textPosition=function(){return this.textShape?this.textShape.verts[0]:null},d}),define("construct/graph/ShapeArrow",["engine2dConf","helper/math","construct/graph/Shape","construct/graph/Vert","conf/icons","conf/colors"],function(a,b,c,d,e,f){var g=e.commands,h=f.arrow,i=[[0,0],[11,13],[-11,13],[0,0]],j=h.shadow,k=[2,2],l=function(a,c,d,e){var f,l,m=c[0].x(),n=c[0].y(),o=c[1].x(),p=c[1].y(),q=[o-m,p-n],r=b.vlength(q)-10,s=b.normalize(q),t=[s[0],s[1]],u=d?k:[0,0];a.save(),a.translate(u[0],u[1]),a.save(),a.globalAlpha=d?.5:1,l=a.createLinearGradient(g.villageOffset,-5,r,0),d?(l.addColorStop(0,h.shadowGradientStart),l.addColorStop(.2,j)):(l.addColorStop(0,h.gradientStart),l.addColorStop(.2,e)),a.translate(m,n),a.rotate(Math.atan2(t[1],t[0])),a.fillStyle=l,a.fillRect(g.villageOffset,-5,r-g.villageOffset,11),a.restore(),f=b.getRotationMatrix(-Math.atan2(n-p,m-o)+Math.PI/2,o,p),a.save(),a.fillStyle=a.strokeStyle=d?j:e,a.transform.apply(a,f),a.beginPath(),i.forEach(function(b){a.lineTo(b[0],b[1])}),a.fill(),a.closePath(),a.restore(),a.restore()},m=function(){this.initialize(),this.color=this.COLORS.DEFAULT};return m.inherits(c).extendPrototypeWith({COLORS:{DEFAULT:h.normal,WARNING:h.warning,DANGER:h.danger},textPosition:function(a){if(0===arguments.length)return this.textVertPercent;this.textVertPercent=a;var c=b.getPointOnQuadraticCurve(this.verts[0].x(),this.verts[0].y(),this.verts[0].x()+(this.verts[1].x()-this.verts[0].x()>>1)-Math.abs(this.verts[0].y()-this.verts[1].y()>>2),this.verts[0].y()+(this.verts[1].y()-this.verts[0].y()>>1)-Math.abs(this.verts[1].x()-this.verts[0].x()>>2),this.verts[1].x(),this.verts[1].y(),a);return this.textVert=new d([1,0,0,1,c.x,c.y],!1),this},draw:function(b){var c=this.mouseVert?this.verts.concat([this.mouseVert]):this.verts;if(a.SHADOWS&&l(b,c,!0),l(b,c,!1,this.color),this.textShape){if(""===this.textShape.shapeText)return void(this.textShape=null);this.textShape.color=this.color,this.textShape.addVert(this.textVert||c[c.length-1]),this.textShape.draw(b)}}}),m}),define("construct/graph/ShapeLine",["require","helper/math","construct/graph/Shape","construct/graph/Vert"],function(a){var b=a("helper/math"),c=a("construct/graph/Shape"),d=a("construct/graph/Vert"),e=function(){this.initialize()};return e.inherits(c).extendPrototypeWith({textPosition:function(a){if(0===arguments.length)return this.textVertPercent;this.textVertPercent=a;var c=b.getPointOnLine(this.verts[0].x(),this.verts[0].y(),this.verts[1].x(),this.verts[1].y(),a);return this.textVert=new d([1,0,0,1,c.x,c.y],!1),this},draw:function(a){var b,c=this.mouseVert?this.verts.concat([this.mouseVert]):this.verts,d=c.length;for(a.strokeStyle=this.color,a.beginPath(),a.moveTo(c[0].x(),c[0].y()),b=1;d>b;b++)a.lineTo(c[b].x(),c[b].y());if(a.stroke(),this.textShape){if(""===this.textShape.shapeText)return void(this.textShape=null);this.textShape.color=this.color,this.textShape.addVert(this.textVert||c[0]),this.textShape.draw(a)}}}),e}),define("construct/graph/ShapeZone",["helper/math","construct/graph/Shape","construct/graph/Vert"],function(a,b,c){var d=function(){this.initialize()};return d.inherits(b).extendPrototypeWith({addVert:function(b){if(0===this.verts.length)this.verts.push(b);else{var c=a.pathfinder(this.verts[this.verts.length-1],b);this.verts=this.verts.concat(c)}return this.verts.length>1&&a.equal(this.verts[0].matrix,this.verts[this.verts.length-1].matrix)},draw:function(b){if(0!==this.verts.length){var d,e,f,g=0,h=0,i=this.mouseVert?this.verts.concat(a.pathfinder(this.verts[this.verts.length-1],this.mouseVert)):this.verts,j=i.length;for(b.strokeStyle=this.color,b.beginPath(),d=i[0].x(),e=i[0].y(),b.moveTo(d,e),g+=d,h+=e,f=1;j>f;f++)d=i[f].x(),e=i[f].y(),g+=d,h+=e,b.lineTo(d,e);if(this.textVert=new c([1,0,0,1,g/i.length,h/i.length],!1),b.stroke(),b.closePath(),this.textShape){if(""===this.textShape.shapeText)return void(this.textShape=null);this.textShape.color=this.color,this.textShape.addVert(this.textVert||i[0]),this.textShape.draw(b)}}}}),d}),define("construct/graph/ShapeText",["construct/graph/Shape"],function(a){var b=function(a){this.initialize(),this.allowCenter=!0,this.font="10pt Arial",this.shapeText=a||"enter text",this.textOffset={x:-100,y:-35},this.TEXTPOINTER=[[0,0],[-30,-30],[-100,-30]]};return b.inherits(a).extendPrototypeWith({setMouseVert:function(a){this.verts[0]=a},addVert:function(a){return this.verts[0]=a,!0},text:function(a){return 0===arguments.length?this.shapeText:(this.shapeText=a,this)},draw:function(a){var b=this.verts[0],c=b.x(),d=b.y();a.save(),a.fillStyle=a.strokeStyle=this.color,a.lineWidth=1,a.font=this.font,a.moveTo(c,d),a.beginPath(),this.TEXTPOINTER.forEach(function(b){a.lineTo(c+b[0],d+b[1])}),a.stroke(),a.closePath(),a.fillText(this.shapeText,c+this.textOffset.x,d+this.textOffset.y),a.restore()}}),b}),define("construct/graph/Movement",["helper/time","helper/color","conf/colors","helper/math","generators/generate","construct/graph/Shape","conf/icons"],function(a,b,c,d,e,f,g){var h=g.commands,i=h.dim.type,j=h.dim.direction,k=h.dim.time,l=function(a){var b="preset",d=a.icon,e=a.returning?"direction_return":"direction",f=window.injector.get("iconGeneratorService"),g=window.injector.get("canvasAssetService");switch(this.initialize(),this.last=0,this.readable="",this.onDrawn=null,this.model=a,this.name=a.jobType+a.id,d||(d=h.icons[a.type]||h.icons.empty,b="marker"),this.icon=f.generate(d,b,null,i.width,i.height),this.direction=f.generate(h.icons[e],"marker",null,j.width,j.height),this.backgroundImg=g.getImage(h.imgs.background),this.drawnPosition={x:0,y:0},this.model.jobType){case"command":this.color=c.map[this.model.type];break;case"trading":this.color=c.map.trade}this.color=this.color||"#dfd998"};return l.inherits(f),l.prototype.isDrawnOn=function(a){var b=this.drawnPosition,c=this.backgroundImg;return a.x.between(b.x,b.x+c.width)&&a.y.between(b.y,b.y+c.height)},l.prototype.setScreenPositions=function(){var a,b=this.verts[0].matrix,c=this.verts[1].matrix,e=b[4],f=b[5],g=c[4],i=c[5],j=5,k=[g-e,i-f];for(a=d.normalize(k).map(function(a){return a*h.villageOffset}),a[0]*=1.1,a[1]*=.7;(Math.abs(a[0])>Math.abs(k[0])||Math.abs(a[1])>Math.abs(k[1]))&&j;)a[0]*=.9,a[1]*=.9,j--;this.begX=e,this.begY=f,this.endX=g,this.endY=i,this.model.returning?(this.endX-=a[0],this.endY-=a[1]):(this.begX+=a[0],this.begY+=a[1])},l.prototype.draw=function(b){var d,e=Date.now();b.lineWidth=3,b.strokeStyle=this.color,b.beginPath(),b.setLineDash&&b.setLineDash([3,6]),this.model.returning?(b.moveTo(this.endX,this.endY),b.lineTo(this.begX,this.begY)):(b.moveTo(this.begX,this.begY),b.lineTo(this.endX,this.endY)),b.stroke(),b.closePath(),this.model.startedAt&&e<this.model.completedAt?(b.save(),d=((e-this.model.startedAt)/(this.model.completedAt-this.model.startedAt)).bound(0,1),e>this.last+500&&(this.readable=a.readableMilliseconds(this.model.completedAt-e),this.last=e),this.drawnPosition.x=(this.begX+(this.endX-this.begX)*d|0)-this.backgroundImg.width/2,this.drawnPosition.y=(this.begY+(this.endY-this.begY)*d|0)-this.backgroundImg.height,b.translate(this.drawnPosition.x,this.drawnPosition.y),b.drawImage(this.backgroundImg,0,0),b.drawImage(this.direction,j.offsetX,j.offsetY),b.drawImage(this.icon,i.offsetX,i.offsetY),b.font=h.fontStyle,b.fillStyle=c.village.player,b.textAlign="center",b.fillText(this.readable,k.offsetX,k.offsetY),b.restore(),this.onDrawn&&this.onDrawn()):this.model.startedAt&&e>this.model.completedAt&&this.remove()},l.prototype.onRemove=function(){this.onDrawn&&this.onDrawn(null)},l}),define("factories/GenericFactory",[],function(){var a=function(a,b,c){this.provider=a||null,this.pattern=b||null,this.format=c||null};return a.extendPrototypeWith({setProvider:function(a){this.provider=a},setPattern:function(a){this.pattern=a},setFormat:function(a){this.format=a},get:function(a,b){var c,d,e,f,g=a;if(!this.provider)throw new Error("No provider set for GenericFactory");if(this.format&&(g=this.format.call(a)),this.pattern&&(g=this.pattern.join(g)),this.provider.hasOwnProperty(g))return f=function(){},e=[].slice.call(arguments,1),f.prototype=this.provider[g].prototype,c=new f(b),d=this.provider[g].apply(c,e),d instanceof Object&&d.constructor===Object?d:c;throw new Error('No factory match for "'+g+'"')}}),a}),define("factories/ShapeFactory",["require","construct/graph/ShapeArrow","construct/graph/ShapeLine","construct/graph/ShapeZone","construct/graph/ShapeText","construct/graph/Movement","factories/GenericFactory"],function(a){var b=a("construct/graph/ShapeArrow"),c=a("construct/graph/ShapeLine"),d=a("construct/graph/ShapeZone"),e=a("construct/graph/ShapeText"),f=a("construct/graph/Movement"),g=a("factories/GenericFactory");return function(){var a=new g,h={ARROW:b,LINE:c,ZONE:d,TEXT:e,MOVEMENT:f},i=function(b,c){return a.get(b,c)};return a.setProvider(h),a.setFormat(String.prototype.toUpperCase),{get:i}}()}),define("construct/graph/SceneGraph",["conf/conf","helper/math","construct/graph/Tile","construct/graph/Sprite","construct/graph/Village","construct/graph/SceneGraphGroup","construct/graph/Vert","generators/generate","factories/ShapeFactory"],function(a,b,c,d,e,f,g,h,i){var j=function(a){var c={},d=this,e=[1,0,0,1,0,0];this.layers=c,this.matrix=e.concat(),this.verts={},this.dirtyRects=[],this.animationList=[],this.animatedElementsMap={},this.redrawSchedule=[],this.lastForcedRedraw=null,this.mapService=a,this.sort=function(){var a=c.length;for(c.sort();a--;)c[a].sort()},this.getScreenCoords=function(a,c){var d,e=a.width?a.width/2:1,f=a.height?a.height/2:1,g=[c.z,0,0,c.z,c.x,c.y],h=[1,0,0,1,e,f];return a.matrix||(a.matrix=a.getTotalTransformation())?(d=b.multiply(a.matrix,h),d=b.multiply(g,d),{x:~~d[4],y:~~d[5]}):null},this.findTilesAt=function(a){return this.layers.tiles.findTilesAt(a)},this.findMovementsAt=function(a){return this.layers.movements.findMovementsAt(a)},this.findClosestVert=function(a,b){var c,e=function(c,d){return!b&&d.center?c:Math.pow(a.x-c.matrix[4],2)+Math.pow(a.y-c.matrix[5],2)>Math.pow(a.x-d.matrix[4],2)+Math.pow(a.y-d.matrix[5],2)?d:c};return c=d.findTilesAt(a),c.length&&(c=c[0])?c.verts.reduce(e):!1},this.addLayer=function(a,b){if(c.hasOwnProperty(a))throw new Error("Name exists already.");return c[a]=new f(a,b),c[a].parentNode=this,d},this.push=function(a,b){var e,g;if(c.hasOwnProperty(b)||(c[b]=new f(b),c[b].parentNode=this),g=c[b],a instanceof Array)for(e=a.length;e--;)g.push(a[e]),a[e].parentNode=g;else g.push(a,g),a.parentNode=g;return d},this.each=function(a){var b,d=[];for(b in c)d.push(c[b]);return d.forEach(function(b){return b.each(a)})},this.sweep=function(){var a;for(a in c)c[a].sweep()},this.find=function(a){var b=null,c=function(c){return c.uniqueId===a?b=c:!1};return d.each(c),b},this.findByName=function(a){var b=null,c=function(c){return c.name===a?b=c:!1};return d.each(c),b},this.merge=function(a,b){for(var e,f,g=c[b],h=a.length;h--;)f=a[h],e=g.hasChild(f.name),e?e.merge?e.merge(f):(e.remove(),d.push(f,b)):g.push(f)}};return j.prototype.id=h.hex(),j.prototype.removeFromAnimationList=function(a){var b=this.animationList.indexOf(a.uniqueId);return b>=0&&this.animationList.remove(b),delete this.animatedElementsMap[a.uniqueId],this},j.prototype.addToAnimationList=function(a){var b,c;if(b=a.length)for(;b--;){if(c="string"!=typeof a[b]?a[b].uniqueId:a[b],void 0===c)throw new Error;this.animationList.indexOf(c)<0&&(this.animationList.push(c),this.animatedElementsMap[c]=this.find(c))}else{if(c="string"!=typeof a?a.uniqueId:a,void 0===c)throw new Error;this.animationList.indexOf(c)<0&&(this.animationList.push(c),this.animatedElementsMap[c]=this.find(c))}return this},j.prototype.makeVillage=function(c,d,f,h,i,j,k,l,m,n){var o,p=new e(c,d,f,h,i,j,k,l,n,m),q=p.getTransformation(),r=b.vmultiply(q,[a.TILESIZE.x>>1|0,a.TILESIZE.y>>1|0]),s=r[0],t=r[1];return this.verts[s]&&(o=this.verts[s][t])?(o.shared++,p.verts.push(o)):(o=new g([q[0],q[1],q[2],q[3],s,t],!0),o.shared++,o.graph=this,p.verts.push(o),this.verts[s]=this.verts[s]||{},this.verts[s][t]=o),p},j.prototype.makeTile=function(d,e,f,h,i,j,k,l){for(var m,n,o,p,q,r=new c(d,e,f,h,i,j,k,l),s=r.getTransformation(),t=a.TILESIZE.shape.concat([[a.TILESIZE.x>>1|0,a.TILESIZE.y>>1|0]]).reverse().map(function(a){return b.vmultiply(s,a)}),u=t.length;u--;)m=t[u],p=Math.floor(m[0]),q=Math.floor(m[1]),(n=this.verts[p])&&(n=n[q])?(n.shared++,r.verts.push(n)):(o=new g([s[0],s[1],s[2],s[3],p,q],0===u),o.shared++,o.graph=this,r.verts.push(o),this.verts[p]=this.verts[p]||{},this.verts[p][q]=o);return r},j.prototype.createMovement=function(a){var b,c,d=Date.now(),e=[];if(!this.layers.movements)throw new Error;a.completedAt<d||(b=i.get("MOVEMENT",a),e[0]=this.getVertForPosition(a.startX,a.startY),e[1]=this.getVertForPosition(a.targetX,a.targetY),a.returning&&e.reverse(),b.addVert(e[0]),b.addVert(e[1]),b.setScreenPositions(),(c=this.layers.movements.hasChild(b.name))&&c.remove(),this.layers.movements.push(b))},j.prototype.getVertForPosition=function(b,c){var d=this.mapService.tileCoordinate2Pixel(b,c);return new g([1,0,0,1,d[0]+(a.TILESIZE.x>>1),d[1]+(a.TILESIZE.y>>1)])},j.prototype.removeVert=function(a){delete this.verts[a.matrix[4]][a.matrix[5]],Object.keys(this.verts[a.matrix[4]]).length||delete this.verts[a.matrix[4]]},j.prototype.getTransformation=function(){return this.matrix},j.prototype.getTotalTransformation=function(){return this.matrix},j.prototype.getDirtyRects=function(a,c,d){var e,f,g,h,i=[];for(e in this.animatedElementsMap)f=this.animatedElementsMap[e],f&&(g=f.getDirtyRects(a),g&&g.length&&("number"==typeof g[0]?i.push(g):i=i.concat(g)));for(e=i.length;e--;)h=i[e],g=b.vmultiply(c,[h[0],h[1]]),h[0]=Math.floor(g[0]),h[1]=Math.floor(g[1]),g=b.vmultiply(c,[h[2],h[3]]),h[2]=Math.ceil(g[0]),h[3]=Math.ceil(g[1]),d&&(h[2]<d[0]||d[2]<h[0]||h[3]<d[1]||d[3]<h[1])&&i.remove(e);return i},j.prototype.scheduleRedraw=function(a){return a>Date.now()&&this.redrawSchedule.indexOf(a)<0&&(this.redrawSchedule.push(a),this.redrawSchedule.sort()),this},j.prototype.unschedule=function(a){var b=this.redrawSchedule.indexOf(a);return b>-1&&this.redrawSchedule.remove(b),this},j.prototype.getNextScheduledRedraw=function(a){for(a=a||this.lastForcedRedraw;this.redrawSchedule[0]<a;)this.redrawSchedule.shift();return this.redrawSchedule[0]||1/0},j}),define("modules/MouseModule",["conf/conf","helper/math","queues/EventQueue"],function(a,b,c){return function(d,e,f,g){var h,i,j={},k={x:0,y:0,time:0},l={x:0,y:0},m={time:0},n=[0,0],o=50,p=4,q=40,r=150,s=20,t=50,u=250,v=25,w=5,x={},y=window.injector.get("$rootScope"),z=window.injector.get("eventTypeProvider"),A=function(a){if(!x[a.type]){var b=a.offsetX||a.layerX,d=a.offsetY||a.layerY;j["mouse"+a.button]=!0,l.x=k.x=b,l.y=k.y=d,i&&(i(),i=null),c.trigger(c.types.MOUSEDOWN),g.focus(),a.preventDefault()}},B=function(h){var o,s,v,x,y,z=h.offsetX||h.layerX,A=h.offsetY||h.layerY,B=f.layer2Map(z,A,d.getViewMatrix(),g.width,g.height),C=Date.now(),D=d.getView(),E=b.vlength(n),F=C-k.time;c.trigger(c.types.MOUSEUP),j.mouse0&&"canvas"===h.target.tagName.toLowerCase()&&b.distance(z,A,l.x,l.y)<w&&B&&(x=m.time+u>=C?c.types.DOUBLECLICK:c.types.CLICK,c.trigger(x,B)),a.KINETIC&&E>p&&r>F&&"mouseup"===h.type&&(y=q*D.z,E>y&&(n=b.normalize(n),n[0]*=y,n[1]*=y),o=1/Math.max(2,F/6),s=Math.max(1,.8/D.z),v=t*o*s,i=e.animateTo({x:D.x+n[0]*v,y:D.y+n[1]*v},1200,"circle"),n[0]=0,n[1]=0),m.time=C,j["mouse"+h.button]=!1},C=function(a){B(a),c.trigger(c.types.MOUSEOUT)},D=function(a){if(!x[a.type]){var h,i,l=a.offsetX||a.layerX,m=a.offsetY||a.layerY,p=f.layer2Map(l,m,d.getViewMatrix(),g.width,g.height),q=d.getView();d.mousepos=p,j.mouse0&&(p.pressed=!0,n[0]=l-k.x,n[1]=m-k.y,h=b.vlength(n),i=o*q.z,h>i&&(n=b.normalize(n),n[0]*=i,n[1]*=i),e.setView({x:q.x+n[0],y:q.y+n[1]}),k.x=l,k.y=m,k.time=Date.now()),p&&c.trigger(c.types.MOUSEMOVE,p)}},E=function(a,b,c){y.$broadcast(z.MAP_ZOOM,a,b,c)},F=function(){h=new Array(15)},G=function(a){var b;switch(h.splice(0,1),h.push(a.keyCode),b=e.engine.getView(),a.keyCode){case 37:a.ctrlKey||a.shiftKey||(b.x+=s,e.setView(b)),a.preventDefault();break;case 38:b.y+=s,e.setView(b),a.preventDefault();break;case 39:a.ctrlKey||a.shiftKey||(b.x-=s,e.setView(b)),a.preventDefault();break;case 40:b.y-=s,e.setView(b),a.preventDefault();break;case 68:if(h.join().match("73,68,68,81,68"))return $("#dev-console").toggleClass("visible"),y.$broadcast(z.MESSAGE_PARTY,{message:"hello.",icon:"icon-90x90 icon-60x60-unit-spy-dead"}),F(),a.preventDefault(),!1;break;case 65:h.join().match("38,38,40,40,37,39,37,39,66,65")&&(y.$broadcast(z.MESSAGE_PARTY,{message:"↑↑↓↓←→←→BA",icon:"icon-90x90 icon-60x60-unit-spy-dead"}),F());break;case 109:E(-1);break;case 107:E(1)}},H=function(a){x[a]=!0},I=function(a){delete x[a]},J=function(a,b){var c=a.offsetX||a.layerX,e=a.offsetY||a.layerY,h=f.layer2Map(c,e,d.getViewMatrix(),g.width,g.height);i&&(i(),i=null),E(b.bound(-v,v),h,null,150)};F(),this.events={wheel:J,mousedown:A,mouseout:C,mouseup:B,mousemove:D,keydown:G,disable:H,enable:I}}}),define("controllers/MapController",["app","angular","battlecat","conf/conf","conf/colors","helper/fx","helper/math","helper/time","generators/generate","struct/MapData","construct/Engine2d","construct/VillageCanvasController","construct/graph/SceneGraph","construct/graph/SceneGraphGroup","modules/MouseModule","queues/EventQueue","cdn","conf/effectTypes","states/MapState"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){a.controller("MapController",["$rootScope","$scope","$filter","$timeout","socketService","villageService","templateManagerService","modelDataService","canvasAssetService","contextMenuService","buildingLabelService","windowManagerService","windowDisplayService","settingsService","mapService","mapHintService","eventTypeProvider","routeProvider","resourceDepositService","secondVillageService","spriteFactory","villageModelProvider","storageService",function(a,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O){var P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra=this,sa=d.TILESIZE,ta={x:sa.x>>1,y:sa.y>>1},ua={x:sa.x>>1,y:sa.y>>1},va={x:0,y:0,z:0},wa=d.ZOOM,xa=d.ZOOM_STEPS,ya=xa.MAP_MAX,za=!1,Aa=0,Ba=1e4,Ca=!1,Da=new m(G),Ea={},Fa=c("#map"),Ga={pointer:'url("'+q.getPath("/img/cursor/link.cur")+'"), url("'+q.getPath("/img/cursor/link.png")+'"), pointer',grabbing:'url("'+q.getPath("/img/cursor/grab_pushed.cur")+'"), url("'+q.getPath("/img/cursor/grab_pushed.png")+'"), move'},Ha=null,Ia=null,Ja=!1,Ka=!1,La=!1,Ma={},Na=1/0,Oa=function(a){try{return Da.layers.effects.hasChild(a)}catch(b){return!1}},Pa=function(){Ka=!1},Qa=function(a,c,d,e){var f=V,g=b.isNumber(d)&&b.isNumber(e);g&&(f=M.make("highlight"),f.setTranslation(d+(sa.x>>1),e+(sa.y>>1)),Da.layers.effects.push(f)),p.once(p.types.NEW_FRAME,function(){f.animate({scale:{fn:function(b,c){return c[0]=c[3]=a(b),c},duration:c,onAnimationEnd:g?function(a){a.remove()}:null}})})},Ra=function(){var a,b=ga.getSelectedCharacter().getVillage(Ha);b&&(a=G.tileCoordinate2Pixel(b.getX(),b.getY()),V.setTranslation(a[0]+(sa.x>>1),a[1]+(sa.y>>1)),Qa(f.selectVillageScale,300),_=Da.findByName(i.villageName(b.getId())),p.trigger(p.types.MAPDATA_UPDATE,null))},Sa=function(){var a=500,b=5500,c=b+a,d=0,e=b;ra.engine&&ra.engine.level===ra.engine.levels.TOWN||Oa("resourceDepositEffect")||(Da.layers.effects.push(la),la.animationFn&&la.animationFn.hasOwnProperty("translation")||la.animate({translation:{fn:function(g,h){var i,j=ka||Da.findByName("resourceDeposit"),k=0;return j?(i=j.getTotalTransformation(),la.scale[0]=la.scale[3]=P.level===P.levels.TOWN?0:i[0],d>g&&(e=b,d=0),e>0?e-=(g-d)*c:k=f.doubleJumpEaseOut(1-(c-c*g)/a),h[4]=i[4],h[5]=i[5]+i[0]*-k*sa.y,d=g,h):h},duration:c,loop:!0}}))},Ta=function(a){var b;ka||(ka=Da.findByName("resourceDeposit"),la=M.make("resourceDepositEffect")),b=j.getTownById(d.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT),b&&b.collectible&&ka&&Sa(),!z.getSelectedCharacter().isInTutorial()&&K.firstUse()&&(F.settings.game.resourceDepositUsed||H.showResourceDepositHint(a.x,a.y,Da))},Ua=function(a){ma||(ma=Da.findByName("secondVillage"),z.getSelectedCharacter().isInTutorial()||O.getItem("secondVillageUsed")||qa||(qa=!0,H.showSecondVillageHint(a.x,a.y,Da)))},Va=function(a,b,c,e){if(P.levels.ZERO&&!Ca){var f,g=j.loadTownLevel(a,b,c,e);d.TILES&&Da.merge(G.createTiles(g,Da),"tiles"),f=G.createVillages(g,Da,Q),Da.merge(f,"tiles"),f.magicLocations&&(f.magicLocations[d.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT]&&Ta(f.magicLocations[d.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT]),f.magicLocations[d.RESERVED_VILLAGE_IDS.SECOND_VILLAGE]&&!z.getSelectedCharacter().getSecondVillageStatus()&&Ua(f.magicLocations[d.RESERVED_VILLAGE_IDS.SECOND_VILLAGE]))}},Wa=function(a){var b=a||ha.scale;return 1/Math.min(b.x/Z,b.y/$)},Xa=function(a,b){var c=function(){var a,c=P.getView(),d=Z;S=Fa.offset(),Z=Fa.width(),$=Fa.height(),P.level===P.levels.TOWN&&ha&&(a=Wa(),c.z<a&&(c.z=a)),b.right&&(c.x=c.x-d+Z),P.resize(Z,$,function(){ra.setView(c,!0)}),P.forceRedraw()};window.clearTimeout(ca),b.instant?c():ca=window.setTimeout(c,75)},Ya=function(){X.alpha=Y.alpha=0},Za=function(){X.alpha=Y.alpha=F.settings.game.locator?d.VILLAGE_LOCATOR_ALPHA:0},$a=function(a,c,d){var e,f;return ra.engine&&ra.engine.level===ra.engine.levels.TOWN||!F.settings.game.locator?void Ya():void(Ia&&(e=G.tileCoordinate2Pixel(Ia.getX(),Ia.getY()),f=[1,0,0,1,e[0]+ta.x,e[1]+ta.y],aa=b.isNumber(a)?a:aa,ba=b.isNumber(c)?c:ba,W.setTranslation(aa,ba),d?Y.alpha=0:Y.rotation=g.getRotationMatrix(-Math.atan2(ba-f[5],aa-f[4]))))},_a=function(a){return a.village},ab=function(a,b){if(ra.engine.level===ra.engine.levels.TOWN)return!1;var c,e,f,g,h;if(e=P.graph.findMovementsAt(b),c=e&&e[0],ra.selectMovement(c))return void ra.selectVillage();if(f=P.graph.findTilesAt(b).filter(_a)[0])switch(f.uniqueId){case d.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT:return void E.openResourceDeposit();case d.RESERVED_VILLAGE_IDS.INVITE_A_FRIEND:return void D.getModal("modal_invite_friend");case d.RESERVED_VILLAGE_IDS.SECOND_VILLAGE:return void E.openSecondVillage()}ra.selectVillage(f)||(g=G.pixel2Tiles(b.x,b.y),h=j.loadByteLevel(g.x,g.y,0,0),h&&h.length&&h[0].key.l&&!t.tutorial&&E.openProvinceScreen(g))},bb=function(b,c){if(ra.engine.level===ra.engine.levels.TOWN)return void Ya();var e,f,i,k,l,m,n,o,p=Ia,q=!1;return c.pressed?ra.setCursor("grabbing"):(i=G.pixel2Tiles(c.x,c.y),m=j.getTownAt(i.x,i.y),e=Da.findMovementsAt(c),m&&!e.length?(ra.setCursor("pointer"),k=[1,0,0,1,n=(1&i.y?i.x+.5:i.x)*sa.x-25,o=i.y*(sa.y-sa.tri)],k=g.multiply(P.getViewMatrix(),k),d.TOOLTIPS&&m.id>=0&&(t.tt={},t.tt.name=m.name,t.tt.x=m.x,t.tt.y=m.y,t.tt.province_name=m.province_name,t.tt.points=m.points,t.tt.character_name=m.character_name||"-",t.tt.character_points=m.character_points||0,t.tt.tribe_name=m.tribe_name||"-",t.tt.tribe_tag=m.tribe_tag||"-",t.tt.tribe_points=m.tribe_points||0,t.tt.morale=m.morale||0,t.tt.position={},t.tt.position.x=k[4]+ta.x*k[0],t.tt.position.y=k[5]+ta.y*k[0],t.tt.boosted=m.barbarian_boost||!1,t.tt.boostDuration=function(){return Date.now()-h.server2ClientTime(m.barbarian_boost)},t.tt.visible=!0,l=Fa.offset(),ia.toggleClass("left",t.tt.position.x+ja.x>l.width),ia.toggleClass("top",t.tt.position.y+ja.y>l.top+l.height)),U.alpha=1,U.setTranslation(n,o),q=p&&i.x===p.getX()&&i.y===p.getY()):(t.tt.visible=!1,f=j.loadByteLevel(i.x,i.y,0,0),ra.setCursor(f&&f.length&&f[0].key.l||e.length?"pointer":""),U.alpha=0)),Za(),$a(c.x,c.y,q),a.$$phase||t.$digest(),!0},cb=function(){Ya(),t.tt.visible=!1},db=function(){ra.setCursor("")},eb=function(){ra.setCursor("grabbing")},fb=function(a,b){G.setTimeOfDay(b,function(){{var a=P.getView();G.pixel2Tiles(-a.x/a.z,-a.y/a.z),G.pixel2Tiles(Z/a.z,$/a.z)}P.setTimeOfDay(b),Q=A.getTileset(b),Fa[0].style.backgroundColor=G.isNight()?e.night:e.day,U.img=Q.hover,ra.forceRedraw(!0)})},gb=function(a,b){(b.x!==Ma.x||b.y!==Ma.y||z.getSelectedCharacter().getSecondVillageStatus()!==!1)&&j.hasTownDataInChunk(b.x,b.y)&&j.getTownAtAsync(b.x,b.y,function(){Va(b.x,b.y,1,1)},!0)},hb=function(){var a,b=500,c=0,d=0;ra.engine&&ra.engine.level===ra.engine.levels.TOWN||Oa("secondVillageEffect")||(na||(na=M.make("secondVillageEffect")),z.getSelectedCharacter().getSecondVillageStatus()||(Da.layers.effects.push(na),na.animationFn&&na.animationFn.hasOwnProperty("translation")||na.animate({translation:{fn:function(e,g){var h,i=ma||Da.findByName("secondVillage"),j=0;return i?(h=i.getTotalTransformation(),a=Na+b,na.scale[0]=na.scale[3]=P.level===P.levels.TOWN?0:h[0],c>e&&(d=Na,c=0),d>0?d-=(e-c)*a:j=f.doubleJumpEaseOut(1-(a-a*e)/b),g[4]=h[4],g[5]=h[5]+h[0]*-j*sa.y,c=e,g):g},duration:a,loop:!0}})))},ib=function(a,b){if(b&&b.type)switch(b.type){case d.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT:Ta(b);break;case d.RESERVED_VILLAGE_IDS.SECOND_VILLAGE:Ua(b)}ra.forceRedraw(!0)},jb=function(){var b,d;if(ra.engine=P=new k({rootnode:Fa[0],graph:Da,width:Z,height:$,overlays:Da.layers.overlays,settings:F.settings.game,effects:{hover:Da.layers.effects}}),s.graph=Da,Q=A.getTileset(G.getTimeOfDay()),V=M.make("highlight"),U=M.make("hover"),W=new n("villageLocatorGroup"),W.noclip=!0,X=M.make("villageLocator"),Y=M.make("villageLocatorPointer"),W.push(X).push(Y),Ya(),Da.layers.effects.push(V).push(U).push(W),P.init(),P.start(),c(P.canvas).on(new o(P,ra,G,P.canvas).events),p.register(p.types.RESIZE,Xa),p.register(p.types.CLICK,ab,null,!0),p.register(p.types.MOUSEMOVE,bb),p.register(p.types.MOUSEDOWN,eb),p.register(p.types.MOUSEUP,db),p.register(p.types.MOUSEOUT,cb),p.register(p.types.MAPDATA_UPDATE,ib),p.once(p.types.NEW_FRAME,function(){a.$broadcast(I.MAP_INITIALIZED)}),!Ha){if(!z.getSelectedCharacter().hasVillages())return;Ia=x.getLastSelectedVillage()||z.getSelectedCharacter().getFirstVillage(),d=Ia.getY(),b=Ia.getX(),a.$broadcast(I.MAP_SELECT_VILLAGE,Ia.getId()),ra.jumpTo(b,d,G.sendStartupLog)}},kb=function(b,c){var d=ga.getSelectedCharacter().getVillage(c),e=d.getX(),f=d.getY();j.getTownAtAsync(e,f,function(b){return null===b?(fa=b,ea=P.graph.find(c),Ha=c,Ia=d,void a.$broadcast(I.MAP_SELECTED_VILLAGE,c)):(fa=b,ea=P.graph.find(c),Ha=b.id,Ia=d,T=null,void a.$broadcast(I.MAP_SELECTED_VILLAGE,fa.id))})},lb=function(b){var e=2,f=function(){--e||jb()};return t.isInitialized?void a.$broadcast(I.MAP_ALREADY_INITIALIZED):(S=Fa.offset(),Z=Fa.width(),$=Fa.height(),y.compile("tooltip_map",t,function(a){Fa.append(a),ia=c("#map-tooltip"),ja={x:ia.width()+50,y:ia.height()+50}}),t.tt={position:{}},window.twx.game.map=ra,ga=z.getPlayer(),ga.getSelectedCharacter().getTribeId()&&w.emit(J.TRIBE_RELATION_GET_LIST,{}),A.getTileset(G.getTimeOfDay(),f),j.setRequestFn(function(a){w.emit(J.MAP_GETVILLAGES,a)}),j.load(d.getMapPath(),f),void(t.isInitialized=!0))},mb=function(){var a,b,c=ga.getSelectedCharacter().getSelectedVillage(),d=c.getTradeListModel(),e=c.getCommandListModel();P&&P.graph&&(P.graph.layers.movements.empty(),F.settings.game.commandsOwn&&e&&(b=e.getCommands())&&b.forEach(function(a){"relocate"!==a.type&&Da.createMovement(a)}),F.settings.game.commandsTrade&&d&&(a=d.getModels())&&a.forEach(function(a){Da.createMovement(a)}))},nb=function(a,c){if(!b.isNumber(c)||isNaN(c))throw new TypeError("villageId must be a number!");x.ensureVillageDataLoaded(c,function(){mb()})},ob=function(c,d,e,f){var g,h,i=z.getSelectedCharacter();if(!b.isNumber(d)||isNaN(d))if(b.isNumber(Ha))d=Ha;else{if(!(i&&(g=i.getFirstVillage())&&b.isNumber(g.getId())))throw new TypeError("Couldn't find a villageId!");d=g.getId()}h=function(){var b,c=ga.getSelectedCharacter().getVillage(d);return c||location.reload(),f?ra.zoomInOnVillage(d,e,0):(b=P.graph.find(c.getId()),void(b?ra.zoomInOnVillage(d,e):(ra.jumpTo(c.getX(),c.getY(),e,null,!0),a.$broadcast("DONE"))))},x.ensureVillageDataLoaded(d,h)},pb=function(a){var b,c;return a?(R||(R={min:wa.MIN,unit:(wa.MAP_MAX-wa.MIN)/xa.MAP_MAX,max:wa.MAP_MAX}),c=R):(b=Wa(),c={min:b,unit:(wa.MAX-b)/(xa.MAX-xa.MAP_MAX-1),max:wa.MAX}),c},qb=function(b){if(isNaN(b))throw new Error("MapController#setZoomStepByDiff can have only number as parameter");var c,d=P.getView().z,e=d<=wa.MAP_MAX,f=e?0:xa.MAP_MAX+1,g=pb(e);for(c=g.min+g.unit;c<=g.max&&!(c>d);c+=g.unit)f++;b=b>0?Math.ceil(b):Math.floor(b),f>xa.MAP_MAX&&f+b<=xa.MAP_MAX&&Aa>0||(ya=(f+b).bound(0,xa.MAX),Aa++,za=window.setTimeout(function(){Aa--,za=!1},wa.TIMEOUT),a.$broadcast(I.MAP_ZOOM_STEP_CHANGED,ya))},rb=function(){var a=ya<=xa.MAP_MAX,b=pb(a),c=a?ya:ya-xa.MAP_MAX-1;return b.unit*c+b.min},sb=function(a,b){var c=P.getViewMatrix(),d=g.invert(g.multiply([1,0,0,1,-a.x0,-a.y0],c));

return{x:-d[4]*b+a.x0,y:-d[5]*b+a.y0,z:b}},tb=function(a,c,d,e,f,g){ra.jumpTo(c,d,function(){b.isFunction(e)&&e(),g&&j.getTownAtAsync(c,d,function(a){B.destroy(),ea=P.graph.find(g),ea||(ra.forceRedraw(!0),ea=P.graph.find(g)),B.showMapMenu(ea)},!0)},f,!!g)},ub=function(a,b,c,d){ra.jumpTo(b,c,null,null,d)},vb=function(){Ka||(Ka=!0,Ja?ra.zoomOutOfTown(Pa):ob(null,null,Pa))},wb=function(b,c){var d=ga.getSelectedCharacter().getId();j.getTownAtAsync(b,c,function(b){b&&d===b.character_id&&Ha!==b.id&&(fa=b,Ha=b.id,a.$broadcast(I.MAP_SELECTED_VILLAGE,fa.id))})},xb=function(a){var b=j.getTownAt(a.getX(),a.getY());b.attack_protection=!1},yb=function(a,b){var c;b.effect_type===r.ATTACK_PROTECTION&&(c=z.getSelectedCharacter(),xb(c.getVillage(b.village_id)),ra.forceRedraw(!0))},zb=function(){ra.forceRedraw(!0)},Ab=function(){z.getWorldConfig().isResourceDepositEnabled()&&(z.getSelectedCharacter().isInTutorial()||w.emit(J.RESOURCE_DEPOSIT_GET_INFO))},Bb=function(){var a=j.getTownById(d.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT);a&&(a.collectible=!0,(ka||Da.findByName("resourceDeposit"))&&Sa())},Cb=function(){var a,b=z.getSelectedCharacter().getResourceDeposit();la&&!b.getCollectibleJobs()&&la.remove(),(a=j.getTownById(d.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT))&&(a.collectible=!1)},Db=function(){ra.engine.level!==ra.engine.levels.TOWN&&(Oa("secondVillageHourglassEffect")||(oa||(oa=M.make("secondVillageHourglassEffect")),Da.layers.effects.push(oa),oa.animationFn&&oa.animationFn.hasOwnProperty("translation")||oa.animate({translation:{fn:function(a,b){var c,d=ma||Da.findByName("secondVillage"),e=0;return d?(c=d.getTotalTransformation(),oa.scale[0]=oa.scale[3]=P.level===P.levels.TOWN?0:c[0],e=f.doubleJumpEaseOut(a)/4,b[4]=c[4],b[5]=c[5]+c[0]*-e*sa.y,b):b},duration:2e3,loop:!0}})))},Eb=function(a,b){var c,d,e,g=Da.findByName(i.villageName(b.village_id));e=j.getTownById(b.village_id),e&&(e.barbarian_boost=b.expiration_time),g&&(c=M.make("productionBoost"),d=g.translation.slice(4),c.setTranslation(d[0]+(sa.x>>1),d[1]+(sa.y>>1)),Da.layers.effects.push(c),c.animate({scale:{fn:function(a,b){return b[0]=b[3]=f.easeOutBack(a),b},duration:750,onAnimationEnd:function(){c.remove(),c=null,ra.forceRedraw(!0)}}}))},Fb=function(a){Na=a?3e3:1/0,na.animated.duration=Na,na.animated.startedAt=Date.now()},Gb=function(a,b){var c=z.getSelectedCharacter(),e={villageId:b.village_id,name:b.village_name,x:b.coordinates.x,y:b.coordinates.y,province_id:b.coordinates.province_id,continent_id:b.coordinates.continent_id};c.setSecondVillageStatus(!0),j.removeSpecialLocation(d.RESERVED_VILLAGE_IDS.SECOND_VILLAGE),v(function(){na.remove(),oa.remove(),ma.remove()}),c.addVillage(N(e)),gb(null,Ma),P.forceRedraw(!0)},Hb=function(a,b){var c=Da.layers.tiles.hasChild("secondVillage");j.setTownName(d.RESERVED_VILLAGE_IDS.SECOND_VILLAGE,b.new_name),c&&(c.data.name=b.new_name,P.forceRedraw())},Ib=function Ob(a,b){var c,d,e=L.getCurrentDayJobs(a.jobs,a.day),f=L.getCollectedJobs(a.jobs),g=z.getSelectedVillage().getResources().getResources(),i=b||[],j=1e3,k=function(a){setTimeout(function(){Fb(a)},j)};return pa=a,hb(),Ma.x=a.x,Ma.y=a.y,(c=L.getJobInProgress(a.jobs))?(c=a.jobs[c],Date.now()<1e3*c.time_completed?(Db(),void v(function(){Ob(pa),oa.remove()},h.server2ClientTime(c.time_completed)-Date.now())):void(c&&k(!0))):(d=L.getAvailableJobs(e,f,g,i),void(d&&Object.keys(d).length>0&&k(!0)))},Jb=function(){L.isFeatureActive()&&(z.getSelectedCharacter().getSecondVillageStatus()||(na||(na=M.make("secondVillageEffect")),oa||(oa=M.make("secondVillageHourglassEffect")),1===z.getSelectedCharacter().getVillages().length?w.emit(J.SECOND_VILLAGE_GET_INFO,{},Ib):w.emitInOrder([J.GET_CHARACTER_VILLAGES,J.SECOND_VILLAGE_GET_INFO],[{},{}],function(a){var b=a[0]&&a[0].villages||null;Ib(a[1],b)})))},Kb=function(a,b){switch(b.name){case"Resource_Types":case"Resource_Depo":Jb();break;case"More_Resources":case"Second_Vill":Ab()}},Lb=function(b,c){a.$broadcast(I.AUDIO_PLAY_SFX,"levelup_start_02"),Fb(!1),Db(),v(function(){Ib(pa),oa.remove()},h.server2ClientTime(c.time_completed)-Date.now())},Mb=function(){Jb(),Ab()},Nb=function(){a.$broadcast(I.AUDIO_PLAY_SFX,"quest_finished_01"),Ib(pa)};this.onProductionBoost=Eb,this.setView=function(a,b,c){var d,e,f,g=P.getView();if(U.alpha=0,t.tt.visible=!1,a||(a=g),a.z=a.z||g.z,ra.engine.level!==ra.engine.levels.TOWN&&(f=G.tileCoordinate2Pixel(999,999),a.x=a.x.bound(-sa.x*a.z,-f[0]*a.z+Z),a.y=a.y.bound(-sa.y*a.z,-f[1]*a.z+$)),!c&&Ea&&(Ea.x&&(a.x=a.x.bound(Ea.x.min*a.z,Ea.x.max*a.z+Z)),Ea.y&&(a.y=a.y.bound(Ea.y.min*a.z,Ea.y.max*a.z+$))),va.x=va.x+a.x-g.x,va.y=va.y+a.y-g.y,va.z=va.z+a.z-g.z,b&&(va.x=Z,va.y=$,va.z=0),b||Math.abs(va.x)>ua.x*a.z||Math.abs(va.y)>ua.y*a.z||va.z)for(e=G.getTilesForDiff(a,va,Z,$),d=e.length;d--;)Va(e[d][0],e[d][1],e[d][2],e[d][3]);P.setView(a),s.setView(a),b&&P.forceRedraw(),$a(null,null,!1),p.trigger(p.types.MAPVIEW_UPDATE,P.getView())},this.centerOnTile=function(a){var b=1;a.matrix||(a.matrix=a.getTotalTransformation()),ra.animateTo({x:(-a.matrix[4]-ta.x)*b+(Z>>1),y:(-a.matrix[5]-ta.y)*b+($>>1),z:b},750,"easeInOut")},this.selectMovement=function(b){return a.$broadcast(I.MAP_MOVEMENT_SELECTED,b),P.graph.layers.movements.sort(),b&&P.graph.layers.movements.promoteChild(b),!!b},this.selectVillage=function(a){return(ea=a||null)?(ea.data.playerVillage||wb(ea.data.x,ea.data.y),B.showMapMenu(ea),!0):(B.destroy(),!1)},this.jumpTo=function(a,b,c,d,e){var h,i,j=P.getView(),k=j.x,l=j.y,m=j.z,n=Fa.width()>>1,o=Fa.height()>>1,p=function(){var d;e&&(d=z.getSelectedVillage(),a===d.getX()&&b===d.getY()?Qa(f.jumpToVillageScale,500):Qa(f.jumpToVillageScale,500,i[0],i[1])),"function"==typeof c&&c()};return B.destroy(),ha&&Ea&&(Ea=ha.boundary),i=G.tileCoordinate2Pixel(a,b),h=[k+i[0]*P.getView().z-n+ta.x*P.getView().z,l+i[1]*P.getView().z-o+ta.y*P.getView().z],g.vlength(h)>Ba||d?(ra.setView({x:k-h[0],y:l-h[1],z:m},!0,!0),p()):(da&&(da(),da=!1),ra.animateTo({x:k-h[0],y:l-h[1],z:m},800,"easeInOut",p)),!0},this.animateTo=function(a,c,d,e,g){if(da)return!1;b.isNumber(c)||(c=500);var h=P.getView(),i=[a.x-h.x,a.y-h.y,(a.z||h.z)-h.z],j=1/c,k=Date.now(),l=k,m=function o(){l=Date.now();var a=f[d]((l-k)*j);return l>=k+c?(da=!1,p.unregister(p.types.NEW_FRAME,o),ra.setView(h={x:h.x+i[0],y:h.y+i[1],z:h.z+i[2]}),"function"==typeof e&&e(!0),void qb(0)):(ra.setView({x:h.x+i[0]*a,y:h.y+i[1]*a,z:h.z+i[2]*a}),void(g&&g(a)))},n=function(){p.unregister(p.types.NEW_FRAME,m),"function"==typeof e&&e(!1),da=!1};return p.register(p.types.NEW_FRAME,m),da=n},this.setZoom=function(b,c,d,e){var f,g,h,i,k,l=d||G.layer2Map(Z/2,$/2,P.getViewMatrix(),Z,$);qb(c),ya>xa.MAP_MAX&&c>0&&ra.engine.level!==ra.engine.levels.TOWN?(i=Da.findTilesAt(l).filter(function(a){return a.village}),i.length&&i[0].village?(h=j.getTownAt(i[0].data.x,i[0].data.y),k=z.getSelectedCharacter(),h.character_id===k.getId()&&h.id===k.getSelectedVillage().getId()&&ra.zoomInOnVillage(h.id)):ra.setView(sb(l,wa.MAP_MAX))):ya<=xa.MAP_MAX&&ra.engine.level===ra.engine.levels.TOWN?a.$broadcast(I.MAP_ZOOM_OUT_OF_VILLAGE):(f=rb(),g=sb(l,f),e?ra.animateTo(g,e,"circle"):ra.setView(g))},this.zoomInOnVillage=function(c,d,e){var f,g,h=P.getView(),i=z.getSelectedVillage(),j=G.tileCoordinate2Pixel(i.getX(),i.getY());return g=b.isNumber(e)?e:F.settings.game.zoomAnimation?500:0,Ja?void("function"==typeof d&&d()):(Ja=!0,ea=P.graph.find(i.getId()),ha?void("function"==typeof d&&d()):(P.graph.layers.movements.hidden=!0,B.destroy(),V.alpha=0,U.remove(),Ya(),Ca=!0,t.tt.visible=!1,void(this.activeVillageController=ha=new l(Fa[0],this,function(b){ha=b,f=Wa(b.scale),T=h,da&&(da(),da=!1),a.$broadcast("DONE"),ra.animateTo({x:((-j[0]-ta.x)*f+(Z>>1)).bound(b.boundary.x.min*f,b.boundary.x.max*f),y:((-j[1]-ta.y)*f+($>>1)).bound(b.boundary.y.min*f,b.boundary.y.max*f),z:f},g,"easeInOut",function(c){c&&(Ea=b.boundary,a.$broadcast(I.MAP_VILLAGE_VIEW,ra.engine.level=ra.engine.levels.TOWN)),ha&&(ha.group.createComposite(),P.graph.layers.tiles.empty().push(b.group),Ya(),"function"==typeof d&&d(),b.group.setAlpha(1))},function(a){b&&b.group.setAlpha(a)})}))))},this.zoomOutOfTown=function(b,c){if(!La){if(!Ja)return void("function"==typeof b&&b());if(La=!0,Ca=!1,da)return void Pa();var d=ga.getSelectedCharacter().getSelectedVillage(),e=G.tileCoordinate2Pixel(d.getX(),d.getY()),f=F.settings.game.zoomAnimation?500:0;Ja=!1,(!T||c)&&(T={x:-e[0]+(Z-sa.x)/2,y:-e[1]+($-sa.y)/2,z:1}),B.destroy(!0),C.hide(),Ea={},ha&&ha.group.createComposite(A.tiles.villageMask),ra.animateTo(T,f,"easeInOut",function(c){c&&(a.$broadcast(I.MAP_VILLAGE_VIEW,P.level=ra.engine.levels.ZERO),P.graph.layers.movements.hidden=!1),V.alpha=1,Da.push(U,"effects"),Za(),ha&&(ha.destroy(),ha=null),"function"==typeof b&&b(),window.setTimeout(function(){P.forceRedraw(),La=!1},10)},function(a){ha&&ha.group.setAlpha(1-a)})}},this.forceRedraw=function(a){var b;P&&(a&&(P.level===P.levels.TOWN&&ha?ha.forceRedraw():(b=P.getView(),Da.layers.tiles.empty(),Va.apply(ra,G.convert([-b.x,-b.y,Z,$],b.z)))),P.forceRedraw())},this.reload=Va,this.setCursor=function(a){P.canvas.style.cursor=Ga[a]||""},this.setBoundary=function(a){Ea=a},this.drawDirtyRects=function(){for(var a,b=P.graph.dirtyRects.length,c=P.getViewMatrix();b--;){a=g.vmultiply(c,P.graph.dirtyRects[b].slice(0,2));try{P.draw(a[0],a[1],P.graph.dirtyRects[b][2]*c[0],P.graph.dirtyRects[b][3]*c[3],!0)}catch(d){}}P.graph.dirtyRects.length=0},Da.addLayer("tiles",0),Da.addLayer("movements",2),Da.addLayer("effects",3),Da.addLayer("overlays",3),this.updateSecondVillage=Ib,t.$on(I.VILLAGE_LOADED,Ra),t.$on(I.MAP_INITIALIZE,lb),t.$on(I.MAP_SELECTED_VILLAGE,nb),t.$on(I.MAP_ZOOM,this.setZoom),t.$on(I.MAP_JUMP_TO,tb),t.$on(I.MAP_CENTER_ON_POSITION,ub),t.$on(I.MAP_ZOOM_INTO_VILLAGE,ob),t.$on(I.MAP_ZOOM_OUT_OF_VILLAGE,function(a,b,c){ra.zoomOutOfTown(b,c)}),t.$on(I.MAP_TOGGLE_VIEW,vb),t.$on(I.MAP_NEW_VILLAGE,gb),t.$on(I.MAP_MOVEMENT_UPDATE,mb),t.$on(I.GAME_SETTINGS_CHANGED,mb),t.$on(I.SYSTEM_NIGHT_MODE,fb),t.$on(I.EFFECT_EXPIRED,yb),t.$on(I.GAME_SETTINGS_CHANGED,zb),t.$on(I.GROUPS_VILLAGES_CHANGED,zb),t.$on(I.VILLAGE,zb),t.$on(I.MAP_SELECT_VILLAGE,kb),t.$on(I.BARBARIAN_PRODUCTION_BOOSTED,Eb),t.$on(I.VILLAGE,Mb),t.$on(I.SECOND_VILLAGE_VILLAGE_CREATED,Gb),t.$on(I.SECOND_VILLAGE_VILLAGE_RENAMED,Hb),t.$on(I.SECOND_VILLAGE_JOB_STARTED,Lb),t.$on(I.SECOND_VILLAGE_JOB_COLLECTED,Nb),t.$on(I.QUESTS_QUEST_LINE_STARTED,Kb),a.$on(I.TUTORIAL_COMPLETED,Ab),t.$on(I.RESOURCE_DEPOSIT_JOB_COLLECTED,Cb),t.$on(I.RESOURCE_DEPOSIT_JOB_COLLECTIBLE,Bb)}])}),define("construct/TimelineRenderer",["conf/colors","conf/icons","helper/time"],function(a,b,c){return function(c,d,e,f){var g=document.getElementById("timeline"),h=g.getContext("2d"),i=f.getImage("/img/icons/sprite-timeline.png"),j=a.timeline,k=b.timeline,l=e.getSpriteCoords(k.width,k.height),m={},n=!1,o=function(){return g},p=function(a,b){var c,e;if(c=b===d.JOB?a.building_type||a.unit_type:b===d.COMMAND&&a.type===d.INCOMING_ATTACK?null:b===d.COMMAND&&void 0===a.haul&&a.type!==d.INCOMING_MIXED?a.subType:a.haul,e=l[a.type][c]||l[a.type],!e)throw new Error("Sprite coords not found");return e},q=function(a,b){h.strokeRoundedRect(a+k.outlineOffset,b+k.outlineOffset,k.innerWidth,k.innerHeight,k.roundRadius),h.drawImage(i,0,0,k.width,k.height,a,b,k.width,k.height)},r=function(a,b,c){var d=b-a+k.width;h.strokeRoundedRect(a+k.outlineOffset,c+k.outlineOffset,d-2*k.outlineOffset,k.innerHeight,k.roundRadius),h.drawImage(i,0,0,k.borderWidth,k.height,a,c,k.borderWidth,k.height),h.drawImage(i,k.borderWidth,0,k.middleSegmentWidth,k.height,a+k.borderWidth,c,d-2*k.borderWidth,k.height),h.drawImage(i,k.width-k.borderWidth,0,k.borderWidth,k.height,b+k.width-k.borderWidth,c,k.borderWidth,k.height)},s=function(a,b){var f,g,l=e.getEventCategory(a),m=l===d.COMMAND?k.TOP:k.BOTTOM,n=p(a,l);if(h.strokeStyle=e.getStrokeStyle(a),a instanceof Array){if(f=e.getPixelPosition(a[0].time,b),g=e.getPixelPosition(a[a.length-1].time,b),f>c.WIDTH)return;r(f,g,m),h.drawImage(i,n[0],n[1],k.width,k.height,f,m,k.width,k.height),h.save(),h.shadowOffsetX=h.shadowOffsetY=1,h.shadowColor=j.textshadow,h.fillStyle=j.text,h.fillText(a.length,f+k.textOffset.x,m+k.textOffset.y),h.restore(),a.x=f,a.x2=g,a.y=m}else{if(f=e.getPixelPosition(a.time,b,k),f>c.WIDTH)return;q(f,m),h.drawImage(i,n[0],n[1],k.width,k.height,f,m,k.width,k.height),a.x=f,a.y=m}},t=function(a){var b,d,f,g=Date.now();if(a&&(f=a.getEvents(g))){h.clearRect(0,0,c.WIDTH,c.HEIGHT);for(b in f)for(m[b]=e.aggregateEvents(f[b],k.THRESHOLD),d=m[b].length;d--;)s(m[b][d],g);n&&s(n,0)}},u=function(a,b){var c,d,e=m,f=b<k.BOTTOM?"top":"bottom",g=0,h=e[f].length;for(g;h>g;g++)if(d=e[f][g],void 0!==d.x&&void 0!==d.y&&a.between(d.x,(d.x2||d.x)+k.width)&&b.between(d.y,d.y+k.height)){c=d;break}return c},v=function(a){n=a},w=function(){l.preview=l.recruit,g.width=c.WIDTH,g.height=c.HEIGHT,h.font=k.fontStyle,h.lineWidth=1};this.render=t,this.findEventAtPosition=u,this.getRootElement=o,this.setPreviewEvent=v,w()}}),define("controllers/TimelineController",["app","battlecat","construct/TimelineRenderer","conf/recruitingQueueTypes"],function(a,b,c,d){a.controller("TimelineController",["$rootScope","$scope","routeProvider","eventTypeProvider","timelineDataProvider","socketService","modelDataService","canvasAssetService","timelineService","windowManagerService","windowDisplayService","buildingQueueService","premiumActionService","reportService","$timeout",function(a,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u,v,w=5e3,x={FRAME_WIDTH:903,WIDTH:1140,HEIGHT:120},y=new c(x,h,l,k),z=null,A=b("#timeline-tooltip"),B=A.find("div.tooltip"),C=null,D=function(){var a,b,c,d,e,f=Date.now();if(j&&(e=j.getSelectedVillage())&&(s=e.getTimeline())){a=s.getEvents();for(b in a)for(c=a[b].length;c--;)d=a[b][c],d.time<f&&s.removeEvent(d.id)}},E=function(a){a?v=window.setInterval(function(){D(),y.render(s)},w):window.clearInterval(v)},F=function(b){var c,e,f,i="screen_second_village";if(b.type===h.BUILD)c=o.getJob(b.id),c&&(p.instantBuild(c),e="button_premium_01");else if(b.type===h.INCOMING_ATTACK||b.type===h.INCOMING_SUPPORT)n.openOverview("incoming"),e="button_01";else if(b.type===h.RECRUIT)f=d.getQueueTypeByUnitType(b.unit_type),j.getWorldConfig().isInstantRecruitEnabled()?(c=j.getSelectedVillage().getRecruitingQueue(f).filter(function(a){return a.job_id===b.id}),c.length&&(p.instantRecruit(c[0]),e="button_premium_01")):m.isTemplateOpen("building_"+f)||(a.$broadcast(g.VILLAGE_SELECT_BUILDING,f),e="button_01");else if(b.type===h.RETURNING_ATTACK||b.type===h.RETURNING_SUPPORT)b.details.report_id&&(q.showReport(b.details.report_id,!1,!0),e="button_01");else if(b.type===h.RESOURCE_DEPOSIT)m.getScreen("screen_resource_deposit");else if(b.type===h.SECOND_VILLAGE){if(m.isTemplateOpen(i))return;m.getScreen(i)}e&&a.$broadcast(g.AUDIO_PLAY_SFX,e)},G=function(a,b){y.setPreviewEvent(b||!1),y.render(s)},H=function(a){return C=a.button,u=a.clientX,a.preventDefault(),!1},I=function(a,b){var c=a.offsetX||a.layerX,d=a.offsetY||a.layerY,f=y.findEventAtPosition(c,d),g=function(){var a=!f.details,b=~~f.length<h.MAX_LENGTH,c=!f.requestSent,d="second_village"!==f.type;return a&&b&&c&&d};!b&&f&&f.type!==h.PREVIEW?(e.tooltipData||B.removeClass("hide").addClass("show").addClass("visible"),g()?t=r(function(){l.getDetailedEventInformation(f,function(a){e.tooltipData=l.getTooltipDataForEvent(a)})},150):e.tooltipData=l.getTooltipDataForEvent(f),A.translate(c+e.translate.x,d)):(e.tooltipData="",B.addClass("hide").removeClass("show").removeClass("visible"),r.cancel(t))},J=function(a){C=u=null;var b=a.offsetX||a.layerX,c=a.offsetY||a.layerY,d=y.findEventAtPosition(b,c);return d?(F(d),!1):(I(a),!1)},K=function(a){C=u=null,I(a,!0)},L=function(b){if(0===C){var c=b.clientX-u;e.translate.x=(e.translate.x+c).bound(0,x.FRAME_WIDTH-x.WIDTH),u=b.clientX,a.$$phase||e.$digest()}else I(b);return b.preventDefault(),!1},M=function(){var a,c=[];return b("#wrapper").matchesSelector(".timeline-expanded")&&(a=b("#timeline-wrapper").offset(),c=[a.left,a.top,a.width,a.height]),c},N=function(){var a=y.getRootElement();b("#wrapper").toggleClass("timeline-expanded"),z?(b(a).off(),z=!1):(b(a).on({mousedown:H,mousemove:L,mouseup:J,mouseout:K}),z=!0,D(),y.render(s)),E(z)},O=function(){var a=j.getSelectedVillage().getId(),b=[f.TIMELINE_GET_EVENTS,f.GET_OWN_COMMANDS,f.SCOUTING_GET_INFO,f.VILLAGE_GET_BUILDING_QUEUE,f.ACADEMY_GET_INFO],c=[{village_id:a},{village_id:a},{village_id:a},{village_id:a},{village_id:a},{}];j.getWorldConfig().isResourceDepositEnabled()&&b.push(f.RESOURCE_DEPOSIT_GET_INFO),i.emitInOrder(b,c)};this.getCoveredArea=M,this.onTimelineEventClick=F,this.showTooltip=I,e.translate={x:0,y:0},a.$on(g.TIMELINE_TOGGLE,N),a.$on(g.TIMELINE_RECRUITING_PREVIEW,G),a.$on(g.TIMELINE_EVENTS,D),a.$on(g.TIMELINE_NEW_EVENT,D),a.$on(g.BUILDING_LEVEL_CHANGED,O),a.$on(g.INVENTORY_ITEM_CHANGED,D)}])}),define("controllers/CharacterSelectionController",["app"],function(a){a.controller("CharacterSelectionController",["$scope","routeProvider","modelDataService","socketService","authService","eventTypeProvider",function(a,b,c,d,e,f){var g=c.getPlayer(),h=!1;a.player=g,a.i18n_title="Character selection",a.$on(f.CHARACTER_SELECTED,function(b,c){h||a.closeWindow()}),a.$on(f.CHARACTER_CREATED,function(b,c){a.closeWindow(),h=!0,e.selectCharacter(c.id)}),a.selectCharacter=function(a){e.selectCharacter(a)},a.acceptInvitation=function(a){d.emit(b.ACCEPT_INVITATION,{id:a})},a.declineInvitation=function(a){d.emit(b.DECLINE_INVITATION,{id:a})},g.getWorlds().length&&(a.formData={name:"",world:g.getWorlds()[0].id}),a.createCharacter=function(){d.emit(b.CREATE_CHARACTER,{world:a.formData.world})}}])}),define("controllers/CharacterManagementController",["app","angular"],function(a,b){a.controller("CharacterManagementController",["$rootScope","$scope","$filter","routeProvider","socketService","eventTypeProvider","windowManagerService","modelDataService","windowDisplayService","characterModelProvider",function(a,c,d,e,f,g,h,i,j,k){var l,m={player:"player_id",invitation:"invitation_id",character:"character_id"},n=2,o=2,p=7,q=i.getSelectedCharacter(),r=q.getId(),s=!1,t=function(a){var b;for(b=0;b<l.length;b++)if(l[b].id===a)return l[b];return!1},u=function(a,b,c,d,e){var f,g=t(a);return f=d?{free:d}:{player:!!b,invite:!!c,profile_icon:g?g.profile_icon:0,name:g?g.name:"",character_id:a,invitation_id:c,player_id:b,online:e}},v=function(a,b,d){var e,f;for(f=0;f<c.partners.length;f++)e=c.partners[f],e[a]===b&&(c.partners.splice(f,1),d||c.partners.push(u(null,!1,!1,!0)))},w=function(a){for(var b=c.foreignPartners.length;b--;)c.foreignPartners[b].character_id===a&&c.foreignPartners.splice(b,1)},x=function(a){for(var b,d=c.incomingInvitations.length;d--;)b=c.incomingInvitations[d],b.invitation_id===a&&c.incomingInvitations.splice(d,1)},y=function(a,b){j.openWriteMessageScreen([{type:"character",id:a,name:b}])},z=function(a){f.emit(e.COOP_WITHDRAW_INVITATION,{invitation_id:a})},A=function(a){f.emit(e.COOP_ACCEPT_INVITATION,{invitation_id:a})},B=function(a){f.emit(e.COOP_DECLINE_INVITATION,{invitation_id:a})},C=function(a){f.emit(e.COOP_LEAVE_CHARACTER,{character_id:a})},D=function(){for(var a,d=c.$new(),e=b.copy(l),f=e.length;f--;)for(a=0;a<c.partners.length;a++)e[f]&&e[f].id===c.partners[a].character_id&&e.splice(f,1);d.members=e,h.getModal("modal_add_coop_partner",d)},E=function(b,c){var g=a.$new(),i="modal_remove_coop_player";g.title=d("i18n")("title",a.loc.ale,i),g.text=d("i18n")("text",a.loc.ale,i),g.submitText=d("i18n")("YES",a.loc.ale),g.cancelText=d("i18n")("NO",a.loc.ale),g.submit=function(){f.emit(e.COOP_REMOVE_PLAYER,{player_id:b,character_id:c}),g.closeWindow()},g.cancel=function(){g.closeWindow()},h.getModal("modal_attention",g)},F=function(a,b){v(m.player,b.player_id),w(b.remover_character_id)},G=function(a,b){v(m.character,b.leaver_character_id),w(b.character_id)},H=function(a,b){v(m.invitation,b.invitation_id),x(b.invitation_id)},I=function(a,b){v(m.invitation,b.invitation_id),x(b.invitation_id)},J=function(a,b){var d;for(d=0;d<c.partners.length;d++)c.partners[d].free&&c.partners.splice(d,1);c.partners.push(u(b.invitee_character_id,!1,b.invitation_id,!1))},K=function(a,b){c.incomingInvitations.push(u(b.inviter_character_id,!1,b.invitation_id,!1))},L=function(a,b){var d=u(b.inviter_character_id,!1,b.invitation_id,!1),e=i.getPlayer(),f=function(a){return a.invitation_id===b.invitation_id};b.inviter_character_id===r?(v(m.invitation,b.invitation_id,!0),c.partners.some(f)||c.partners.push(u(b.invitee_character_id,b.invitee_player_id,!1,!1,!0))):(x(b.invitation_id),c.foreignPartners.some(f)||(c.foreignPartners.push(u(b.inviter_character_id,b.inviter_player_id,b.invitation_id,!1)),e.addCharacter(k({character_id:d.character_id,character_name:d.name,character_owner_id:d.character_id,character_owner_name:d.character_name,world_id:q.data.world_id,world_name:q.data.world_name}))))},M=function(a,b){var d,e,f,g,h;for(l=b.short_profiles,c.ownProfile=t(r),c.partners=[],h=0;h<b.players.length;h++)e=b.players[h],e.character_id!==r&&c.partners.push(u(e.character_id,e.player_id,!1,!1,e.online));for(h=0;h<b.invitations.length;h++)f=b.invitations[h],c.partners.push(u(f.invitee_character_id,!1,f.invitation_id,!1));for(d=n-c.partners.length,h=0;d>h;h++)c.partners.push(u(null,!1,!1,!0));for(c.incomingInvitations=[],h=0;h<b.incoming_invitations.length;h++)f=b.incoming_invitations[h],c.incomingInvitations.push(u(f.inviter_character_id,!1,f.invitation_id,!1));for(c.foreignPartners=[],h=0;h<b.coop_characters.length;h++)g=b.coop_characters[h],g!==r&&c.foreignPartners.push(u(g,!1,!1,!1))},N=function(){c.ownTribeId=null},O=function(){f.emit(e.COOP_GET_STATUS),s=!0},P=function(a){"coop"===a&&!s&&c.ownTribeId&&O()};c.MAX_PARTNERS=n,c.partnerSwitchTimes=o,c.partnerSwitchDays=p,c.ownTribeId=i.getSelectedCharacter().getTribeId(),c.inviteCharacter=D,c.cancelInvitation=z,c.removeCharacter=E,c.acceptInvitation=A,c.declineInvitation=B,c.writeMessage=y,c.leaveCharacter=C,c.$on(g.COOP_STATUS,M),c.$on(g.COOP_CHARACTER_REMOVED,F),c.$on(g.COOP_CHARACTER_LEFT,G),c.$on(g.COOP_INVITATION_WITHDRAWN,H),c.$on(g.COOP_INVITATION_SENT,J),c.$on(g.COOP_INVITATION_RECEIVED,K),c.$on(g.COOP_INVITATION_ACCEPTED,L),c.$on(g.COOP_INVITATION_DECLINED,I),c.$on(g.TRIBE_DISBANDED,N),c.$on(g.TRIBE_LEFT,N),c.$on(g.TRIBE_MEMBER_KICKED,N),c.$watch("activeTab",P,!0)}])}),define("controllers/ContextMenuController",["app","factories/ShapeFactory","struct/MapData","helper/dataconversion","helper/math","helper/time","queues/EventQueue","states/MapState","battlecat"],function(a,b,c,d,e,f,g,h,i){a.controller("ContextMenuController",["$rootScope","$scope","$filter","routeProvider","modelDataService","eventTypeProvider","windowManagerService","socketService","buildingService","buildingQueueService","buildingLabelService","contextMenuService","premiumActionService","messagingService","inventoryItemTypeProvider","groupService","armyService",function(a,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z,A,B,C,D,E=w.BUILD_COST_REDUCTION,F=["info","custom-army","presets","spies","resources","groups","messages","activate","boost"],G=["open-screen","premiumlevelup","premiumlevelup-inactive","reducetime","reducetime-inactive","buildinginfo","levelup","levelup-inactive","levelup-construct","premiumlevelup-construct","levelup-construct-inactive","premiumlevelup-construct-inactive"],H=function(a,b){return t.getMapViewSubMenuState(a,b,b.id===A.getId(),m.getSelectedCharacter().getVillages(),m.getSelectedVillage().getBuildingData().getData(),b&&b.data&&b.data.attack_protection)},I=function(a){return t.getVillageViewSubMenuState(a,r.isBuildingInQueue(z.name),m.getSelectedVillage().getBuildingData().getDataForBuilding(z.name),r.getQueue(),r.getNamedBuildingQueue(),j.premiumLevelUpStarted)},J=function(){var a=h.view.z;a>.54&&1>a&&(C=C||i("#context-menu"),D=D||C.find(".menu-highlight")[0],D&&(D.style[Modernizr.prefixed("transform")]="scale("+a+")"))},K=function(){try{B&&(B.remove(),window.twx.game.map.engine.forceRedraw())}catch(a){}},L=function(a,b){var c;return z&&z.node?(c=h.graph.getScreenCoords(z.node,b),C=C||i("#context-menu"),C.translate(c.x,c.y),void J()):void j.$emit(n.DESTROY_CONTEXT_MENU)},M=function _(b,c){var d;if(c)return j.fadeout=!0,a.$$phase||j.$digest(),void i("#context-menu").one("transitionend",function(){_()});for(j.visible=!1,j.fadeout=!1,K(),d=0;d<j.subMenus.length;d++)j.availableSubMenus[j.subMenus[d]]=!1;a.$$phase||j.$digest(),g.unregister(g.types.MAPVIEW_UPDATE,L),z=null,j.visible=!1},N=function(a,c){B?B.verts=[]:(B=b.get("ARROW"),h.graph.layers.movements.push(B),B.onRemove=function(){B=null}),p.emit(l.GET_ATTACKING_FACTOR,{target_id:c},function(b){var d,e,f,g=y.getCombatStrength(b.moralFactor,b.faithFactor);50>=g?B.color=B.COLORS.DANGER:100>g&&(B.color=B.COLORS.WARNING),d=h.graph.find(a),e=h.graph.find(c),d||(f=m.getSelectedVillage(),d={verts:[h.graph.getVertForPosition(f.getX(),f.getY())]}),d&&e&&(B.addVert(d.verts[0]),B.addVert(e.verts[0]))})},O=function(b){m.getSelectedVillage().getId()!==z.id&&a.$broadcast(n.MAP_SELECT_VILLAGE,z.id),b&&(j.allowedToClick=!1,a.$broadcast(n.MAP_ZOOM_INTO_VILLAGE,null,function(){j.allowedToClick=!0},!0)),j.destroy()},P=function(){a.$broadcast(n.MAP_JUMP_TO,z.data.x,z.data.y)},Q=function(b){z.buildMode?(a.$broadcast(n.VILLAGE_SELECT_BUILDING,z.name),t.destroy()):z.playerVillage?O(b):P()},R=function(b){var f,g,h;switch(b){case"info":h="screen_village_info",o.isTemplateOpen(h)&&o.closeTemplate(h),f=a.$new(),f.villageId=z.id,o.getScreenWithInjectedScope("screen_village_info",f);break;case"custom-army":f=a.$new(),f.target=z,f.targetCharacterName=c.getTownAt(z.data.x,z.data.y).character_name,f.distance=e.actualDistance(A.getPosition(),z.data),o.getModal("modal_custom_army",f);break;case"presets":p.emit(l.GET_PRESETS_FOR_VILLAGE,{village_id:A.getId()},function(b){f=a.$new(),f.target=z,f.villageId=z.id,f.targetCharacterName=c.getTownAt(z.data.x,z.data.y).character_name,f.distance=e.actualDistance(A.getPosition(),z.data),o.getModal("modal_send_preset",f)});break;case"spies":f=a.$new(),f.targetVillage=z.data.name,f.targetX=z.data.x,f.targetY=z.data.y,f.targetId=z.id,f.distance=e.actualDistance(A.getPosition(),z.data),o.getModal("modal_send_spies",f);break;case"resources":f=a.$new(),f.targetVillage=z.data.name,f.targetX=z.data.x,f.targetY=z.data.y,f.targetId=z.id,f.distance=e.actualDistance(A.getPosition(),z.data),o.getModal("modal_send_resources",f);break;case"messages":g=c.getTownAt(z.data.x,z.data.y),v.newMessage(d.participant({character_id:g.character_id,character_name:g.character_name}));break;case"open-screen":case"activate":Q(z.id===A.getId());break;case"groups":x.openGroupsIndexModal(z.id,z.data.name);break;case"levelup":case"levelup-construct":q.upgradeBuilding(z.name,!1,"menu");break;case"premiumlevelup":case"premiumlevelup-construct":j.premiumLevelUpStarted=!0,q.upgradeBuilding(z.name,!0,"menu",function(){j.premiumLevelUpStarted=!1});break;case"reducetime":u.instantBuild(j.queue[z.name]);break;case"buildinginfo":f=a.$new(),f.buildingName=z.name,o.getModal("modal_building_info",f);break;case"boost":f=a.$new(),f.villageId=z.id,f.boosted=z.data.boosted,o.getModal("modal_barbarian_boost",f)}},S=function(){j.queue=r.getNamedBuildingQueue()},T=function(){j.buildCostReductionItem=m.getInventory().getItemByType(E)},U=function(){j.premiumCosts=m.getGameData().getPremiumCostsForType(E),j.inventory=m.getInventory().getInventoryItemReference(),j.itemType=E,j.subMenus=G,j.info=k("i18n")(z.name,a.loc.ale,"building_names"),j.building=A.getBuildingData().getDataForBuilding(z.name),T(),j.subMenus.forEach(function(a){j.availableSubMenus[a]=function(){return I(a)}}),S(),s.show()},V=function(){var a;if(a=z.buildMode||z.id===A.getId(),!a)try{N(A.getId(),z.id)}catch(b){}j.subMenus=F,j.info=z.name,j.subMenus.forEach(function(a){z.data.barbarianVillage&&"messages"===a||(j.availableSubMenus[a]=function(){return H(a,z)})}),delete j.building},W=function(b,c,d){K(),c&&(A=m.getSelectedVillage(),z=d?{i18nName:k("i18n")(c.name,a.loc.ale,"building_names"),name:c.name,buildMode:!0,node:{matrix:[1,0,0,1].concat(e.vmultiply(d.getTotalTransformation(),q.getPosition(c.name)))}}:{id:c.uniqueId,name:c.data.name,i18nName:c.data.name,data:c.data,playerVillage:c.data.playerVillage,node:c},j.target=z,z.buildMode?(U(),f.timer.tick()):V(),j.visible=!0,J(),g.register(g.types.MAPVIEW_UPDATE,L),g.trigger(g.types.MAPVIEW_UPDATE,h.view))},X=function(a,b){j.allowedToClick&&(A=m.getSelectedVillage(),b&&(b.id||b.node)&&(z=j.target=b),z&&(j.visible=!0,z.buildMode?(U(),f.timer.tick()):V()))},Y=function(a,b){j.computedResources=b},Z=function(a){j.premiumTooltip="true"===a},$=function(a,b){z&&b.village_id===z.id&&(z.name=z.data.name=j.info=b.name)};j.availableSubMenus={},j.targetVillage={},j.subMenus=F,j.villageSubMenus=G,j.selectVillage=O,j.centerVillage=P,j.centerClick=Q,j.openSubMenu=R,j.updateMenu=X,j.destroy=M,j.setArrow=N,j.allowedToClick=!0,j.premiumLevelUpStarted=!1,j.setPremiumTooltipEnabled=Z,j.$on(n.VILLAGE_NAME_CHANGED,$),j.$on(n.RESOURCES,Y),j.$on(n.BUILDING_LEVEL_CHANGED,S),j.$on(n.BUILDING_QUEUE,S),j.$on(n.VILLAGE_LOADED,X),j.$on(n.DESTROY_CONTEXT_MENU,M),j.$on(n.SHOW_CONTEXT_MENU,W),j.$on(n.INVENTORY_ITEM_CHANGED,T)}])}),define("controllers/BuildingLabelController",["app","helper/math","helper/time","helper/window","conf/conf","queues/EventQueue","states/MapState"],function(a,b,c,d,e,f,g){a.controller("BuildingLabelController",["$scope","buildingLabelService","contextMenuService","modelDataService","buildingService","premiumActionService","buildingQueueService","eventTypeProvider",function(a,h,i,j,k,l,m,n){var o=j.getSelectedVillage(),p=g.graph.findByName("town"),q="building_labels",r=function(){var c,f,g,h,i,j=d.getMapEngine().getViewMatrix(),l=0;if(p){c=b.multiply(j,p.getTotalTransformation()),g=c[0],f=$("#map").offset(),f&&(l=f.left);for(h in a.buildings)i=k.getPosition(h).slice(0,2),a.coords[h]={x:c[4]+i[0]*g+e.BUILDING_LABEL_OFFSET.x+l,y:c[5]+i[1]*g+e.BUILDING_LABEL_OFFSET.y}}},s=function(){h.getLabelData(a.data)},t=function(){f.register(f.types.MAPVIEW_UPDATE,r,null,!0),r(),c.timer.add(s),c.timer.tick()},u=function(b){var c=a.excludedBuildings;c[b]=!0,"chapel"===b?c.church=!0:"church"===b&&(c.chapel=!0)},v=function(){a.excludedBuildings={}},w=function(a){i.showVillageMenu({name:a},p)},x=function(){v()},y=function(a,b,c){v(),u(b.name)},z=function(a){var b=m.getNamedBuildingQueue();l.instantBuild(b[a])},A=function(){f.unregister(f.types.MAPVIEW_UPDATE,r),c.timer.remove(s)};a.excludedBuildings={},a.buildings=o.getBuildingData().getData(),a.buildingLabelI18nKey=q,a.openMenu=w,a.buildTimeReduction=z,a.coords={},a.data={},a.$on("$destroy",A),a.$on(n.SHOW_CONTEXT_MENU,y),a.$on(n.DESTROY_CONTEXT_MENU,x),t()}])}),define("controllers/BuildingNotResearchedController",["app"],function(a){a.controller("BuildingNotResearchedController",["$scope","$rootScope","eventTypeProvider",function(a,b,c){var d=function(){b.$broadcast(c.VILLAGE_SELECT_BUILDING,"headquarter")};a.openHeadquarter=d}])}),define("controllers/MaintenanceController",["app"],function(a){a.controller("MaintenanceController",["$scope","authService",function(a,b){var c=function(){b.clearAuthData(),window.location.reload()},d=function(){};a.restart=c,a.closeWindow=d}])}),define("helper/turbulence",[],function(){var a,b,c,d,e,f,g,h,i,j,k=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,l=0,m=0,n=30,o=Date.now(),p=1e3/n,q=1,r={alphaCutoff:25,alphaModifier:.74,alphaStep:8.5,baseHorizontalVelocityMultiplier:1.25,blue:70,blueStep:15,forceImpact:1,forcePush:28,green:50,greenStep:15,horizontalFourierResultAbove:.1,horizontalFourierResultBelow:.1,horizontalVelocityMultiplier:.9,lowAlpha:128,lowAlphaModifier:.5,maxHorizontalVelocityMultiplier:1.1,maxVerticalVelocityMultiplier:1.08,minAlpha:20,minAlphaCutoff:50,minAlphaStep:5,minBlue:60,minBlueStep:50,minGreen:50,minGreenStep:4,particleSpawnCount:32,red:100,redStep:85,validAlpha:186,verticalVelocityMultiplier:1.01,mainOffsetVertical:-2},s={dynamicForce:!1,
forcePush:28,forceStep:.05,forceOffset:5,forceImpact:1,center:[0,0],forcePos:[0,0],particleSpawnCount:32,baseHorizontalVelocityMultiplier:1.25,maxVerticalVelocityMultiplier:1.02,verticalVelocityMultiplier:1.01,maxHorizontalVelocityMultiplier:.9,horizontalVelocityMultiplier:.9,horizontalFourierResultBelow:.05,horizontalFourierResultAbove:.05,minBlue:170,minBlueStep:165,minGreen:0,minGreenStep:5,minAlphaCutoff:5,minAlphaStep:3.5,red:200,redStep:185,green:0,greenStep:15,blue:0,blueStep:15,alphaCutoff:15,alphaStep:13.5,validAlpha:248,minAlpha:52,lowAlpha:64,lowAlphaModifier:.986,alphaModifier:.84,mainOffsetVertical:5},t=function(a,b,c,d,e){this.x=a,this.y=b,this.vx=c,this.vy=d,this.r=255,this.g=255,this.b=255,this.a=255,this.t=e,0===e&&(this.vx*=s.baseHorizontalVelocityMultiplier)},u=function(){g&&0===f.length&&(window.cancelAnimationFrame(g),g=void 0)},v=function(){m++},w=function y(){var a,n,r,v,w,x,z,A;if(h=Date.now(),i=h-o,i>p){for(o=h-i%p,a=0;a<f.length;a++)if(v=f[a],v.x+=v.vx,v.y+=v.vy,1===v.t?v.vy*=s.maxVerticalVelocityMultiplier:v.vy*=s.verticalVelocityMultiplier,1===v.t?v.vx*=s.maxHorizontalVelocityMultiplier:v.vx*=s.horizontalVelocityMultiplier,v.x<s.center[0]?v.vx+=s.horizontalFourierResultBelow:v.vx-=s.horizontalFourierResultAbove,w=s.forcePos[0]-v.x,x=s.forcePos[1]-v.y,z=Math.sqrt(w*w+x*x),z<s.forcePush&&(v.vx-=w/z*s.forceImpact,v.vy-=x/z*s.forceImpact),s.dynamicForce&&(1===q?(s.forcePush+=s.forceStep,s.forcePush>j+s.forceOffset&&(q=-1)):(s.forcePush-=s.forceStep,s.forcePush<j-s.forceOffset&&(q=1))),v.y<0)f.splice(a,1);else{if(0===v.t){if(v.b>s.minBlue&&(v.b-=s.minBlueStep),v.g>s.minGreen&&(v.g-=s.minGreenStep),!(v.a>s.minAlphaCutoff)){f.splice(a,1);continue}v.a-=s.minAlphaStep}else{if(v.r>s.red&&(v.r-=s.redStep),v.b>s.blue&&(v.b-=s.blueStep),v.g>s.green&&(v.g-=s.greenStep),!(v.a>s.alphaCutoff)){f.splice(a,1);continue}v.a-=s.alphaStep}v.x>=0&&v.x<c&&v.y>=0&&v.y<d&&(A=4*((0|v.x)+(0|v.y)*c),e.data[A]=v.r,e.data[A+1]=v.g,e.data[A+2]=v.b,e.data[A+3]=v.a)}for(v=0;l-m>v;v++)f.push(new t(s.center[0],s.center[1],3*(-2+4*Math.random()),1.4*-Math.random(),Math.round(Math.random())));for(a=3,n=e.data.length;n>a;a+=4)r=e.data[a],r<s.validAlpha&&(r<s.minAlpha?e.data[a]=0:r<s.lowAlpha?e.data[a]*=s.lowAlphaModifier:e.data[a]*=s.alphaModifier);b.putImageData(e,0,0),l<s.particleSpawnCount&&l++}g=k(y),m>0&&(m++,0===f.length&&(u(),b.clearRect(0,0,c,d)))},x=function(h,i,l,n){n||(s=r),m=0,a=document.getElementById(h),a&&(b=a.getContext("2d"),c=a.width,d=a.height,e=b.getImageData(0,0,c,d),f=[],s.center=[c/2,3*d/4],s.forcePos=i||[c/2,d/2+s.mainOffsetVertical],j=s.forcePush,g=k(w),window.turbulenceConf=s,l&&setTimeout(v,l),window.onresize=v)};return{conf:s,start:x,die:v,stop:u}}),define("controllers/interface/TopInterfaceController",["app","engine2dConf","conf/conf","conf/locale","conf/effectTypes","version","helper/i18n","helper/navigation","helper/turbulence","models/TribeSettingsModel"],function(a,b,c,d,e,f,g,h,i,j){a.controller("TopInterfaceController",["$rootScope","$scope","$filter","$timeout","eventTypeProvider","modelDataService","windowManagerService","windowDisplayService","premiumService","settingsService","groupService","socketService","routeProvider","effectService","tribeService","banModalService",function(a,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=["day","night"],A=o.getPlayer(),B=o.getSelectedCharacter(),C=!1,D=!1,E=function(){i.start("turbulence-canvas",null,6e3,k.tribeCrestLevel)},F=function(a,b){k.resources=b},G=function(){h.jumpToLandingPage({world:null,character_id:null})},H=function(){p.getScreen("test/screen_test_rich_text",void 0,void 0,!0)},I=function(){var a=function(){u.emit(v.WORLD_GET_FOR_PLAYER,{},function(a){var b,c,d={},e=a.characters;for(b=0;b<e.length;b++)c=e[b].world_name,d[c]||(d[c]=[]),d[e[b].world_name].push(e[b]);k.worlds=d,Object.keys(d).length<=1&&1===e.length?G():k.showCharacterSelection=!0})};return D?(a(),void(D=!1)):(k.playerId=A.getId(),k.showCharacterSelection=!k.showCharacterSelection,void(k.showCharacterSelection&&a()))},J=function(a,b){if(a.character_id!==k.characterId||k.worldId!==b)if(a.is_banned){var c={reason:a.ban_reason,support_url:a.support_url,end_date:a.end_date};y.showBannedModal(c)}else h.jumpToGamePage({world:a.world_id,character_id:a.character_id})},K=function(){z.reverse(),a.$broadcast(n.SYSTEM_NIGHT_MODE,z[0])},L=function(b){-1===b&&k.previousVillageDisabled||1===b&&k.nextVillageDisabled||C||(C=!0,a.$broadcast(n.VILLAGE_SWITCH,b))},M=function(a){k.tribeId=a,o.getWorldConfig().isTribeSkillsFeatureEnabled()&&u.emit(v.TRIBE_SKILLS_GET_INFO,{}),u.emit(v.TRIBE_GET_PROFILE,{tribe_id:a})},N=function(a,b){M(b.tribe_id)},O=function(a,b){M(b.id)},P=function(){var a,b;return B&&(a=B.getVillages())&&(k.villageCount=a.length),!k.settings&&B&&(b=B.getTribeId())&&M(b),k.villageCount||0},Q=function(){p.getScreen("screen_ranking")},R=function(){p.getScreen("screen_devtools")},S=function(){var a=o.getSelectedVillage();t.openGroupsIndexModal(a.getId(),a.getName())},T=function(){var a=o.getSelectedVillage(),b=o.getSelectedCharacter().getVillages();k.previousVillageDisabled=!s.settings.game.villageRepeat&&a.getId()===b[0].getId(),k.nextVillageDisabled=!s.settings.game.villageRepeat&&a.getId()===b[b.length-1].getId()},U=function(){var a=o.getSelectedVillage();k.groupIcons=a?t.getVillageGroupIcons(a.getId()):[]},V=function(){var a,b,c=o.getGameData().getResourceNames();for(k.resourceBoosts={},b=0;b<c.length;b++)a=c[b],k.resourceBoosts[a]=w.getEffectByResource(a);k.stockpileBoosts=w.getEffectsByContentName(e.RESOURCE_BOOST_STOCKPILE),k.foodBoosts=w.getEffects(e.FOOD_BOOST)},W=function(){var a,b,c;for(k.boostedFood=0,c=0;c<k.foodBoosts.length;c++)a=k.foodBoosts[c].details.factor,b=Math.round(k.resources.food.maxBaseFood*(a-1)),k.boostedFood+=b},X=function(){V(),T(),U(),C=!1},Y=function(){r.openPaymentModal()},Z=function(){g.setLanguage(d.LANGUAGE)},$=function(b){var c=k.resourceBoosts[b],d=w.getLastEndingEffect(k.stockpileBoosts.concat([c]));d&&(k.lastBoostEndTitle=l("i18n")("last_boost_ends",a.loc.ale,"interface_top"),k.lastBoostEndDate=l("readableDateFilter")(d.getTimeCompleted(),a.loc.ale)),k.resourceTypeTitle=l("i18n")(b,a.loc.ale,"resource_names"),k.resourcePerHour=l("i18n")("resource_per_hour",a.loc.ale,"interface_top",l("number")(k.resources[b].production)),k.warehouseSizeTitle=l("i18n")("warehouse_size_title",a.loc.ale,"interface_top"),k.warehouseSize=l("number")(B.getSelectedVillage().getResources().getMaxStorage()),k.fullAtTitle=l("i18n")("full_at_title",a.loc.ale,"interface_top"),k.fullAtTime=l("readableDateFilter")(Date.now()+60*k.resources[b].maxIn)},_=function(b){var c={wood:"timber_camp",clay:"clay_pit",iron:"iron_mine",food:"farm"};a.$broadcast(n.VILLAGE_SELECT_BUILDING,c[b])},aa=function(a){var b=o.getTribeSettings();b&&(k.icon=b.icon,k.tag=b.tag),k.tribeCrestLevel=x.getCrestLevel(a),(k.tribeCrestLevel===c.HIGH_LEVEL_TRIBE_CREST||k.tribeLevel<a)&&E(),k.tribeLevel=a},ba=function(a,b){aa(b.level)},ca=function(a,b){b.tribe_id===B.getTribeId()&&(o.setTribeSettings(new j(b)),k.tribeSkillsEnabled&&aa(b.level))},da=function(){k.tribeLevel=null,k.icon=null,k.tag=null,k.tribeCrestLevel=0},ea=function(a,b){b.id===B.getId()&&da()},fa=function(b){a.$broadcast(n.TRIBE_TAB_SELECTED,{toggle:!0,tabName:b})},ga=function(a,b){aa(b.level)},ha=function(b){var c;return null===B.getTribeId()?void p.getScreen("screen_no_tribe",void 0,void 0,!0):void(p.isTemplateOpen("screen_tribe")?fa(b):(c=a.$new(),c.activeTab=b,p.getScreenWithInjectedScope("screen_tribe",c)))};k.player=A,k.character=B,k.characterId=B.getId(),k.villageCount=P(),k.openRankingScreen=Q,k.openCharacterProfile=q.openCharacterProfile,k.resources={},k.showCharacterSelection=!1,k.worldId=o.getSelectedCharacter().getWorldId(),k.tribeCrestLevel=0,k.tribeSkillsEnabled=o.getWorldConfig().isTribeSkillsFeatureEnabled(),k.engine2dConf=b,k.config=c,k.locale=d,k.frontEndVersion=f.frontend.toString(),k.logout=G,k.toggleNightMode=K,k.setLanguage=Z,k.switchVillage=L,k.showPremiumIframe=Y,k.editGroups=S,k.openVillageInfo=q.openVillageInfo,k.setTooltip=$,k.setFoodTooltip=W,k.openResourceBuildingScreen=_,k.characterSelection=I,k.playCharacter=J,k.showRichTextExamples=H,k.openDevTools=R,k.openTribe=ha,k.locales=["default","cs_cz","da_dk","de_de","el_gr","en_dk","en_us","es_ar","es_es","fi_fi","fr_fr","hu_hu","it_it","nb_no","nl_nl","pl_pl","pt_br","pt_pt","ro_ro","ru_ru","sk_sk","sl_si","sv_se","tr_tr"],k.previousVillageDisabled=!1,k.nextVillageDisabled=!1,k.$on(n.RESOURCES,F),k.$on(n.CHARACTER_INFO,P),k.$on(n.VILLAGE_LOADED,X),k.$on(n.VILLAGE_LOST,P),k.$on(n.VILLAGE_CONQUERED,P),k.$on(n.SECOND_VILLAGE_VILLAGE_CREATED,P),k.$on(n.GAME_SETTINGS_CHANGED,T),k.$on(n.GROUPS_DESTROYED,U),k.$on(n.GROUPS_UPDATED,U),k.$on(n.GROUPS_VILLAGES_CHANGED,U),k.$on(n.EFFECT_CHANGED,V),k.$on(n.EFFECT_EXPIRED,V),k.$on(n.TRIBE_PROFILE,ca),k.$on(n.TRIBE_SKILL_DONATED,ba),k.$on(n.TRIBE_RELATION_CHANGED,E),k.$on(n.TRIBE_SKILL_ASSIGNED,E),k.$on(n.TRIBE_SKILL_REASSIGNED,ga),k.$on(n.TRIBE_MEMBER_KICKED,ea),k.$on(n.TRIBE_DISBANDED,da),k.$on(n.TRIBE_LEFT,da),k.$on(n.TRIBE_JOINED,N),k.$on(n.TRIBE_APPLICATION_ACCEPTED,N),k.$on(n.TRIBE_INVITATION_ACCEPTED,N),k.$on(n.TRIBE_CREATED,O),k.$on(n.QUESTS_QUEST_FINISHED,E)}])}),define("conf/bottomInterface",[],function(){return{INVENTORY_HINT_DURATION:4e3,INVENTORY_HINT_FADEOUT_DURATION:500}}),define("controllers/interface/BottomInterfaceController",["app","conf/conf","conf/bottomInterface"],function(a,b,c){a.controller("BottomInterfaceController",["$rootScope","$scope","$timeout","windowManagerService","eventTypeProvider","modelDataService","tribeService",function(a,d,e,f,g,h,i){var j=[null,null],k=function(a){var b=d.selectedVillage.getRecruitJobListsContainer(),c=!0;0!==d.selectedVillage.getBuildingQueue().getQueue().length&&(c=!1),b.combined.length&&(c=!1),a.bottom&&a.top&&(0!==a.bottom.length&&(c=!1),0!==a.top.length&&(c=!1)),c&&d.newEvent&&delete d.newEvent},l=function(b){a.$broadcast(g.TRIBE_TAB_SELECTED,{toggle:!0,tabName:b})},m=function(b){var c;return null===h.getSelectedCharacter().getTribeId()?void f.getScreen("screen_no_tribe",void 0,void 0,!0):void(f.isTemplateOpen("screen_tribe")?l(b):(c=a.$new(),c.activeTab=b,f.getScreenWithInjectedScope("screen_tribe",c)))},n=function(a,c){delete d.zoomInDisabled,delete d.zoomOutDisabled,c===b.ZOOM_STEPS.MAX&&(d.zoomInDisabled=!0),0===c&&(d.zoomOutDisabled=!0)},o=function(a){switch(f.closeAll(),a){case"overview":f.getFullSize("overview/screen_overview",void 0,void 0,void 0,!0);break;case"report-list":f.getScreen("report_list",void 0,void 0,!0);break;case"messages":f.getScreen("message_list",void 0,void 0,!0);break;case"units":f.getFullSize("screen_unit_overview",void 0,void 0,void 0,!0);break;case"tribe-news":m("tribe-profile");break;case"tribe-forum":m("forum");break;case"shop":f.getScreen("screen_shop",void 0,void 0,!0);break;case"inventory":f.getScreen("screen_inventory",void 0,void 0,!0);break;case"settings":f.getScreen("screen_settings",void 0,void 0,!0);break;case"achievements":f.getScreen("screen_achievements",void 0,void 0,!0)}},p=function(){a.$broadcast(g.TIMELINE_TOGGLE),d.expanded=!d.expanded,delete d.newEvent},q=function(b){a.$broadcast(g.MAP_ZOOM,b)},r=function(){f.getScreen("character_management",void 0,void 0,!0)},s=function(b,c){d.inVillageView=!c,a.$$phase||d.$digest()},t=function(a,b){d.gameDataModel.addNewReport(b)},u=function(a,b){var c;for(c=0;c<b.ids.length;c++)d.gameDataModel.removeNewReport(b.ids[c])},v=function(a,b){d.gameDataModel.addNewMessage(b.message_id)},w=function(a,b){var c;for(c=0;c<b.message_ids.length;c++)d.gameDataModel.removeNewMessage(b.message_ids[c])},x=function(a,b){var c;for(c=0;c<b.message_ids.length;c++)d.gameDataModel.addNewMessage(b.message_ids[c])},y=function(){d.expanded||(d.newEvent="new-event",a.$$phase||d.$digest())},z=function(){j[0]&&e.cancel(j[0]),j[1]&&e.cancel(j[1]),j[0]=null,j[1]=null},A=function(a){a||void 0===a?(d.arrowHidden=!1,d.arrowFadeOut=!1,z(),j[0]=e(function(){d.arrowFadeOut=!0,j[1]=e(function(){d.arrowHidden=!0,d.arrowFadeOut=!1,j[0]=null,j[1]=null},c.INVENTORY_HINT_FADEOUT_DURATION)},c.INVENTORY_HINT_DURATION)):(d.arrowHidden=!0,d.arrowFadeOut=!1,z())},B=function(){d.newInventoryItems=h.getInventory().getNewItemCount()},C=function(a,b){B(),A(b.change>0)},D=function(b){a.$broadcast(g.WORLD_MAP_SEARCH_TOGGLE,b)},E=function(){a.$broadcast(g.MAP_TOGGLE_VIEW)},F=function(a,b){h.getWorldConfig().isTribeSkillsFeatureEnabled()&&(d.tribeLevel=b.level,d.tribeCrestLevel=i.getCrestLevel(b.level))},G=function(a,b){b.tribe_id===h.getSelectedCharacter().getTribeId()&&F(null,b)},H=function(){d.tribeCrestLevel=null,d.tribeLevel=null},I=function(){A(!1),d.selectedVillage=h.getSelectedVillage(),d.events=d.selectedVillage.getTimeline().getEvents(),B(),d.$watch("events",k,!0)};d.gameDataModel=h.getGameData(),d.tribeInvitationsModel=h.getSelectedCharacter().getTribeInvitations(),d.inVillageView=!1,d.open=o,d.toggleTimeline=p,d.zoom=q,d.openCharManagement=r,d.toggleView=E,d.toggleWorldMapSearch=D,d.$on(g.BUILDING_LEVEL_CHANGED,k),d.$on(g.UNIT_RECRUIT_JOB_FINISHED,k),d.$on(g.COMMAND_RETURNED,k),d.$on(g.RECRUIT_JOB_REMOVED,k),d.$on(g.MAP_ZOOM_STEP_CHANGED,n),d.$on(g.MAP_VILLAGE_VIEW,s),d.$on(g.REPORT_NEW,t),d.$on(g.REPORT_MARKED_SEEN,u),d.$on(g.MESSAGE_NEW,v),d.$on(g.TIMELINE_NEW_EVENT,y),d.$on(g.MESSAGE_MARKED_READ,w),d.$on(g.MESSAGE_MARKED_UNREAD,x),d.$on(g.INVENTORY_MARKED_SEEN,B),d.$on(g.TRIBE_PROFILE,G),d.$on(g.TRIBE_SKILL_DONATED,F),d.$on(g.TRIBE_DISBANDED,H),d.$on(g.TRIBE_MEMBER_KICKED,H),d.$on(g.TRIBE_LEFT,H),d.$on(g.TRIBE_SKILL_REASSIGNED,F),d.$on(g.VILLAGE_LOADED,I),d.$on(g.INVENTORY_ITEM_CHANGED,C)}])}),define("controllers/interface/BuildingQueueInterfaceController",["app"],function(a){a.controller("BuildingQueueInterfaceController",["$rootScope","$scope","$timeout","eventTypeProvider","modelDataService","buildingService","buildingQueueService","premiumActionService","windowManagerService","inventoryItemTypeProvider","inventoryService",function(a,b,c,d,e,f,g,h,i,j,k){var l=function(){b.animationDisabled=!0,c(function(){b.animationDisabled=!1},0)},m=function(a){h.instantBuild(a)},n=function(a){b.queue[a]&&f.openCancelUpgradeModal(b.queue[a].id)},o=function(){i.isTemplateOpen("building_headquarter")||a.$broadcast(d.VILLAGE_SELECT_BUILDING,"headquarter")},p=function(){return b.collapsed?void(b.collapsed=!1):(b.curItem>0&&(l(),b.curItem=null),void(b.collapsed=!0))},q=function(a){return b.queue[a]?void(b.curItem=a===b.curItem?null:a):o()},r=function(){var a=j.BUILD_QUEUE_SLOT,b=e.getInventory().getItemByType(a);return b&&b.amount?void k.useItem(b):void h.unlockBuildingQueueSlot()},s=function(){b.slotItem=e.getInventory().getItemByType(j.BUILD_QUEUE_SLOT)},t=function(a,c){l(),a>c&&a>1&&b.collapsed&&(b.collapsed=!1),c>a&&(b.curItem=null)},u=function(){l(),b.curItem=null},v=function(){b.buildingQueueData=g.getData(),b.queue=g.getQueue(),b.namedQueue=g.getNamedBuildingQueue(),b.curItem=null,s()};b.animationDisabled=!1,b.collapsed=!1,b.instantBuild=m,b.cancelJob=n,b.selectItem=q,b.addSlot=r,b.toggleQueue=p,b.$watch("queue.length",t),b.$on(d.BUILDING_QUEUE,v),b.$on(d.INTERFACE_QUEUE_SELECTED,u),b.$on(d.INVENTORY_ITEM_CHANGED,s),v()}])}),define("controllers/interface/RecruitmentQueueInterfaceController",["app","conf/recruitingQueueTypes"],function(a,b){a.controller("RecruitmentQueueInterfaceController",["$rootScope","$scope","$filter","$timeout","eventTypeProvider","modelDataService","premiumActionService","windowManagerService","recruitingService",function(a,c,d,e,f,g,h,i,j){var k=6,l=function(){c.animationDisabled=!0,e(function(){c.animationDisabled=!1},0)},m=function(a){a.origin=a.type?a.type.toUpperCase():"BARRACKS",h.instantRecruit(a)},n=function(c){var e=a.$new(),f="cancel_recruit_job";e.title=d("i18n")("title",a.loc.ale,f),e.text=d("i18n")("text",a.loc.ale,f),e.boxText=d("i18n")("boxText",a.loc.ale,f),e.submitText=d("i18n")("submitText",a.loc.ale,f),e.cancelText=d("i18n")("cancelText",a.loc.ale,f),e.switchColors=!0,e.submit=function(){j.cancelRecruitJob(c.type||b.BARRACKS,c.id),e.closeWindow()},e.cancel=function(){e.closeWindow()},i.getModal("modal_attention",e)},o=function(){i.isTemplateOpen("building_barracks")||a.$broadcast(f.VILLAGE_SELECT_BUILDING,"barracks")},p=function(){return c.collapsed?void(c.collapsed=!1):(c.curItem>0&&(l(),c.curItem=null),void(c.collapsed=!0))},q=function(a){return c.queue&&c.queue[a]?void(c.curItem=a===c.curItem?null:a):o()},r=function(){l(),c.curItem=null},s=function(a,b){b.origin=b.type?b.type.toUpperCase():"BARRACKS",h.addSecondQueueJob(a,b)},t=function(){var a=g.getSelectedVillage();a&&(c.queue=g.getSelectedVillage().getRecruitJobListsContainer().combined,c.instantRecruitEnabled=h.isInstantRecruitEnabled(),c.secondQueueJobEnabled=h.isSecondQueueJobEnabled(),c.curItem=null)},u=function(a,b){t(),l(),a>b&&a>1&&c.collapsed&&(c.collapsed=!1),b>a&&(c.curItem=null)};c.maxSlotNumber=k,c.animationDisabled=!1,c.collapsed=!1,c.toggleQueue=p,c.instantRecruit=m,c.addSecondQueueJob=s,c.cancelJob=n,c.selectItem=q,c.isAddSecondQueueJobPossible=h.isAddSecondQueueJobPossible;try{t()}catch(v){}c.$on(f.VILLAGE,t),c.$on(f.VILLAGE_UNIT_INFO,t),c.$on(f.INTERFACE_QUEUE_SELECTED,r),c.$on(f.BARRACKS_RECRUIT_JOB_CANCELED,u),c.$on(f.BARRACKS_RECRUIT_JOB_CREATED,u),c.$on(f.BARRACKS_RECRUIT_JOB_FINISHED,u),c.$on(f.BARRACKS_RECRUIT_JOB_STARTED,u),c.$on(f.STATUE_RECRUIT_JOB_CANCELED,u),c.$on(f.STATUE_RECRUIT_JOB_CREATED,u),c.$on(f.STATUE_RECRUIT_JOB_FINISHED,u),c.$on(f.STATUE_RECRUIT_JOB_FINISHED,u),c.$on(f.PALADIN_SUMMONED,u),c.$on(f.ACADEMY_RECRUIT_JOB_CANCELED,u),c.$on(f.ACADEMY_RECRUIT_JOB_CREATED,u),c.$on(f.ACADEMY_RECRUIT_JOB_FINISHED,u),c.$on(f.PRECEPTORY_RECRUIT_JOB_CANCELED,u),c.$on(f.PRECEPTORY_RECRUIT_JOB_CREATED,u),c.$on(f.PRECEPTORY_RECRUIT_JOB_FINISHED,u),c.$on(f.PRECEPTORY_RECRUIT_JOB_STARTED,u)}])}),define("controllers/interface/GlobalInformationController",["app","angular","battlecat","helper/time","queues/EventQueue","conf/effectTypes"],function(a,b,c,d,e,f){a.controller("GlobalInformationController",["$scope","$timeout","$filter","eventTypeProvider","modelDataService","windowDisplayService","settingsService","effectService",function(a,g,h,i,j,k,l,m){var n,o,p,q=j.getSelectedCharacter().getGlobalInfo(),r=q.getCommandListModel(),s=c("#map"),t="world",u="village",v=k.openOverview.bind(null,"incoming"),w={},x={},y=450,z=1e3,A={singleRowOffset:150,openedOffset:100},B={offset:27,width:28},C={INCOMING_ATTACKS:"incomingAttacks",INCOMING_ATTACK:"incomingAttack",INCOMING_SUPPORTS:"incomingSupports",INCOMING_SUPPORT:"incomingSupport",ATTACK_PROTECTION:"attackProtection",STOCKPILE:"stockpile",FARM:"farm",WAREHOUSE:"warehouse",LOYALTY:"loyalty",NIGHT:"night",WOOD:"wood",IRON:"iron",CLAY:"clay"},D=function(a,b){return{items:{},settingsKey:a,icon:b,alarm:!1,hasItems:!1,open:!1,opened:!1,shouldBeOpen:!1,switching:!1,switchPromise:null,count:0}},E=function(a,b,c,d,e,f,g,h){return{infoKey:a,icon:b,tooltip:c,action:d,alarm:e,progress:f,time:g,maxValue:h}},F=function(){w[t]=D("worldInfoOpen","global"),w[u]=D("villageInfoOpen","village"),x[C.INCOMING_ATTACKS]=E(t,"attack-red","tooltip_total_attacks",v,!0),x[C.INCOMING_ATTACK]=E(u,"attack-red","tooltip_incoming_attack",v,!0),x[C.INCOMING_SUPPORTS]=E(t,"support","tooltip_total_support",v),x[C.INCOMING_SUPPORT]=E(u,"support","tooltip_incoming_support",v),x[C.ATTACK_PROTECTION]=E(u,"noob-protection","tooltip_noob_protection_ends_in",void 0,void 0,-1,!0),x[C.LOYALTY]=E(u,"loyalty","tooltip_village_loyalty",void 0,!0,1,void 0,100),x[C.NIGHT]=E(t,"night-mode","tooltip_night_bonus",void 0,void 0,-1,!0),x[C.STOCKPILE]=E(t,"stockpile","tooltip_stockpile",void 0,void 0,-1,!0),x[C.FARM]=E(u,"food_capacity_increase","tooltip_farm"),x[C.WAREHOUSE]=E(t,"capacity","tooltip_warehouse",void 0,void 0,-1,!0),x[C.WOOD]=E(u,"resource-wood","tooltip_wood",void 0,void 0,-1,!0),x[C.IRON]=E(u,"resource-iron","tooltip_iron",void 0,void 0,-1,!0),x[C.CLAY]=E(u,"resource-clay","tooltip_clay",void 0,void 0,-1,!0)},G=function(){var a,b,c={};c.total=0,c[t]=0,c[u]=0;for(a in x)b=x[a],c[b.infoKey]++,c.total++;return c.maxByObject=Math.max(c[t],c[u]),c},H=function(){var a=G();A.singleRow=B.width*a.total+B.offset+A.singleRowOffset,A.opened=B.width*a.maxByObject+B.offset+A.openedOffset},I=function(a){a.opened=a.open===!a.switching},J=function(a,b,c){a.open=b,a.switching=!1,c||(a.shouldBeOpen=b,l.settings.game[a.settingsKey]=b,l.saveGameSettings()),I(a)},K=function(a,b){var c,d=void 0!==b;(!o||d)&&(d?(c=!!b,o=!c):c=!a.open,(!d||c!==a.open&&!a.switching)&&(a.switching?(a.switching=!1,g.cancel(a.switchPromise)):(a.switching=!0,a.switchPromise=g(function(){J(a,c,d),p()},y)),I(a)))},L=function(a){var b,c;a.count=Object.keys(a.items).length,a.hasItems=!!a.count,a.alarm=!1;for(c in a.items)b=a.items[c],b.alarm&&(a.alarm=!0)},M=function(a){var b=x[a];if(!b)throw new Error("Invalid infoObject");return b},N=function(a,c,e,f){var g=M(a),i=w[g.infoKey],j=i.items[a];if(j||(j=i.items[a]={}),j.action=g.action,j.icon=g.icon,j.alarm=g.alarm,j.tooltip=g.tooltip,j.progress=g.progress,j.getValue=b.isFunction(c)?c:function(){return c},j.displayValue=g.time?function(){return d.readableMilliseconds(j.getValue(),!1,!0)}:j.getValue,j.displayValue=function(){var a=j.getValue();return a?g.time?h("readableDateFilter")(a):a.toShortString(3):""},f&&(j.opt_value=h("readableDateFilter")(f)),j.progress){if(void 0!==e)j.getMaxValue=b.isFunction(e)?e:function(){return e};else{if(void 0===g.maxValue)throw new Error("Invalid config for icon w/ progress bar");j.getMaxValue=function(){return g.maxValue}}j.getPercentValue=function(){return Math.floor(j.getValue()/j.getMaxValue()*100)}}L(i)},O=function(a){var b=M(a),c=w[b.infoKey];delete c.items[a],L(c)},P=function(){var a,b=j.getSelectedVillage();b&&(a=b.getComputedLoyalty(),100>a?N(C.LOYALTY,function(){return Math.floor(b.getComputedLoyalty())}):O(C.LOYALTY))},Q=function(a){var b,c,d=a?C.INCOMING_ATTACK:C.INCOMING_ATTACKS,e=a?C.INCOMING_SUPPORT:C.INCOMING_SUPPORTS,f=j.getSelectedVillage();if(r.flush(),a){if(!f)return;c=f.getId()}b=r.countIncoming("attack",void 0,c),b>0?N(d,b):O(d),b=r.countIncoming("support",void 0,c),b>0?N(e,b):O(e)},R=function(){Q(),Q(!0)},S=function(){R(),P()},T=function(a,b){O(a),b&&N(a,function(){return b.getTimeLeft()},function(){return 1e3*b.details.duration},b.getTimeCompleted())},U=function(){var a,b,c,d,e=j.getWorldConfig(),g=m.getEffect(f.ATTACK_PROTECTION),h=j.getGameData().getResourceNames();for(g?N(C.ATTACK_PROTECTION,function(){return g.getTimeLeft()},function(){return e.getAttackProtectionDuration()},g.getTimeCompleted()):O(C.ATTACK_PROTECTION),a=m.getEffectsByContentName(f.RESOURCE_BOOST_STOCKPILE),a.length?N(C.STOCKPILE,null,null,m.getLastEndingEffect(a).getTimeCompleted()):O(C.STOCKPILE),d=0;d<h.length-1;d++)b=h[d],c=m.getEffectByResource(b),c&&T(b,c);a=m.getEffects(f.STORAGE_CAPACITY_INCREASE),a.length?N(C.WAREHOUSE,null,null,m.getLastEndingEffect(a).getTimeCompleted()):O(C.WAREHOUSE),a=m.getEffects(f.FOOD_BOOST),a.length?N(C.FARM):O(C.FARM)},V=function(){var a=j.getWorldConfig(),b=a.isNight();b?N(C.NIGHT,function(){return a.getNightTimeLeft()},function(){return a.getNightDuration()},a.getNightClientTimes().end):O(C.NIGHT)},W=function(){P(),U(),Q(!0)},X=function(){var a,b;for(b in w)a=w[b],a.shouldBeOpen=l.settings.game[a.settingsKey]||!1,a.shouldBeOpen&&J(a,!0,!0)},Y=function(){var a=j.getWorldConfig();g(V,a.getNightTimeLeftTo()+z),g(V,a.getNightTimeLeftTo(!0)+z)},Z=function(){var b,c=j.getSelectedCharacter();c&&(b=n&&!c.isInTutorial(),b&&(p(),Y(),a.show=!0))},$=function(){n=!0,Z()},_=function(){p()},aa=function(){e.unregister(e.types.RESIZE,_)},ba=function(){F(),H(),X(),e.register(e.types.RESIZE,_),V(),P(),R()};p=function(){var a=s.width();a&&A.singleRow&&(w.vertical=a<A.singleRow,a<A.opened?(K(w.world,!1),K(w.village,!1)):(w.world.shouldBeOpen&&K(w.world,!0),w.village.shouldBeOpen&&K(w.village,!0)))},a.INFO_TYPES=C,a.ICON_DIMS=B,a.info=w,a.toggleInfo=K,a.$on(i.VILLAGE_LOADED,W),a.$on(i.EFFECT_CHANGED,U),a.$on(i.EFFECT_EXPIRED,U),a.$on(i.VILLAGE_RESOURCES_CHANGED,S),a.$on(i.COMMAND_INCOMING,R),a.$on(i.COMMAND_OWN_COMMANDS,R),a.$on(i.COMMAND_CANCELLED,R),a.$on(i.COMMAND_SUPPORT_ARRIVED,R),a.$on(i.TUTORIAL_COMPLETED,Z),a.$on("DONE",$),a.$on("$destroy",aa),ba()}])}),define("controllers/interface/QuestsInterfaceController",["app"],function(a){a.controller("QuestsInterfaceController",["$scope","windowManagerService","socketService","routeProvider","modelDataService","modalSharedQuestLineDataService","eventTypeProvider",function(a,b,c,d,e,f,g){var h=function(a){var c=a.getFirstFinishableQuestIndex(),d=c>=0?c:a.getFirstSelectableQuestIndex();f.setQuestLineModel(a),f.setSelectedQuestIndex(d),b.getModal("modal_quest_line")},i=function(){var b,c,d,g,h=e.getSelectedCharacter().getQuestLineListModel().getQuestLineModels(),i=h.length,j=null;for(a.questTreeName=f.getQuestTreeName(),a.questTreePrefix=f.getQuestTreePrefix(),a.questLineModels=h,g=0;i>g;g++)b=h[g],c=b.getName(),j=b.getCurrentQuest(),j&&(a.currentQuests[c]=j,d=j.getCommandGoals(),d&&(a.commandGoals[c]=d))},j=function(a){return a.getFirstFinishableQuestIndex()>=0},k=function(){c.emit(d.QUESTS_GET_QUEST_LINES)};a.questLineModels=null,a.currentQuests={},a.commandGoals={},a.init=k,a.openQuestLineModal=h,a.hasFinishableQuests=j,a.$on(g.QUESTS_QUEST_LINES,i),a.$on(g.QUESTS_QUEST_LINE_STARTED,i),a.$on(g.QUESTS_QUEST_PROGRESS,i),a.$on(g.QUESTS_QUEST_FINISHED,i),k()}])}),define("controllers/interface/MediaPartnerController",["app"],function(a){a.controller("MediaPartnerController",["$scope","eventTypeProvider",function(a,b){var c=function(b,c){a.data=c};a.$on(b.MEDIA_PARTNER_CAMPAIGN,c)}])}),define("controllers/interface/ValidateMailController",["app","helper/util"],function(a,b){a.controller("ValidateMailController",["$rootScope","$scope","$filter","eventTypeProvider","modelDataService","windowManagerService","socketService","routeProvider","utilityService","errorTypeProvider",function(a,b,c,d,e,f,g,h,i,j){var k,l,m,n,o=function(){var b;k.mail.email===k.mail.oldEmail?(b="resend_validation_mail",k.closeWindow(),g.emit(h.PLAYER_EMAIL_RESEND_WELCOME_MAIL,{}),k=a.$new(),k.title=c("i18n")("title",a.loc.ale,b),k.text=c("i18n")("text",a.loc.ale,b),k.boxText=c("i18n")("box_text",a.loc.ale,b),k.submitText=c("i18n")("OK"),f.getModal("modal_attention",k),k.submit=k.closeWindow):i.changeEmail(k.mail.email,k.mail.repeatEmail)},p=function(){k=a.$new(),k.mail={email:n,repeatEmail:"",oldEmail:l},k.resendOrChange=o,k.pack=m,f.getModal("modal_validate_mail",k)},q=function(){k&&(k.closeWindow(),i.showEmailInChangeModal())},r=function(){k&&(k.closeWindow(),i.showEmailChangeSentModal())},s=function(){k.errorEmail=!0,a.$broadcast(d.MESSAGE_ERROR,{message:c("i18n")("invalid_mail",a.loc.ale,"validate_mail")})},t=function(){g.emit(h.SETTINGS_GET_ACCOUNT_INFO,{},function(a){l=a.email,n=a.email}),g.emit(h.PLAYER_EMAIL_GET_CONFIRMATION_PACKAGE,{},function(a){m=a["package"]})};b.openValidationModal=p,b.resendOrChange=o,b.$on(d.PLAYEREMAIL_CHANGE_REQUESTED,r),b.$on(j.PLAYER_EMAIL_ALREADY_IN_USE,i.showEmailInUseModal),b.$on(j.PLAYER_EMAIL_ACTIVE_CHANGE_EXISTS,q),b.$on(j.PLAYER_INVALID_EMAIL,s),t()}])}),define("controllers/interface/ChatInterfaceController",["app","helper/color","helper/time"],function(a,b,c){a.controller("ChatInterfaceController",["$rootScope","$scope","$timeout","modelDataService","eventTypeProvider","socketService","routeProvider","windowManagerService","storageService",function(a,b,d,e,f,g,h,i,j){var k,l=e.getSelectedCharacter(),m=l.getId(),n=l.getName(),o={GLOBAL:"global",TRIBE:"tribe"},p={GLOBAL:400,TRIBE:1e3},q=270,r=170,s=380,t=200,u=300,v=function(){d(function(){b.directives.scrollbar.scrollbar.recalc(),b.directives.scrollbar.scrollbar.scrollTo(0,9999999)})},w=function(){g.emit(h.CHAT_GET_TRIBE_HISTORY)},x=function(){var a;0!==b.input.length&&(a=b.activeTab===o.GLOBAL?"CHAT_SEND_GLOBAL":"CHAT_SEND_TRIBE",g.emit(h[a],{character_name:n,message:b.input}),b.input="",v())},y=function(a,d){var e=new Date(d.time_send);k=d.time_send,b.showChat&&j.setItem("chatLastTimeStamp",k),b.characterColors[d.character_name]||(b.characterColors[d.character_name]=d.character_id===m?"#ffffff":"#eeb111"),b.messages[a].length>p[a]&&b.messages[a].splice(0,1),b.messages[a].push({time:c.zerofill(e.getHours())+":"+c.zerofill(e.getMinutes()),name:d.character_name,message:d.message,character_id:d.character_id}),v()},z=function(a){b.activeTab=a,v()},A=function(){b.showChat=!1,j.setItem("showChat",!1)},B=function(){b.showChat=!0,j.setItem("showChat",!0),b.unread=0,j.setItem("chatLastTimeStamp",k),d(function(){$(".chat-input").focus()}),v()},C=function(b){var c=a.$new();c.characterId=b,i.getScreenWithInjectedScope("screen_character_info",c)},D=function(){d(function(){b.tribeId=l.getTribeId(),b.messages.tribe=[]})},E=function(a,b){var c=l.getId();b.id===c&&D()},F=function(a,c){c.tribe_id&&(b.showChat||b.unread++,y(o.TRIBE,c))},G=function(a,c){d(function(){b.tribeId=l.getTribeId(),w()})},H=function(a,c){var d,e=j.getItem("chatLastTimeStamp");if(0!==c.length){for(b.messages.tribe=[],d=c.length;d>0;d--)y(o.TRIBE,c[d-1]),b.showChat||c[d-1].time_send>e&&b.unread++;v()}},I=function(c){var d=b.width+c.movementX,e=b.height-c.movementY,f=window.innerWidth-u,g=window.innerHeight-u;q>d||r>e||d>f||e>g||(b.width=d,b.height=e,a.$$phase||(b.directives.scrollbar.scrollbar.recalc(),b.$digest()))},J=function(a){$(document).off("mousemove",I)},K=function(a){$(document).on("mousemove",I).off("mouseup",J).on("mouseup",J)},L=function(){var a;null===b.showChat&&(b.showChat=!0),$(".input-border").on("keydown",function(a){13===a.keyCode&&x()}),$(".resize").on("mousedown",K),b.tribeId&&(a=b.$on("DONE",function(){w(),a()}))};b.activeTab=o.TRIBE,b.TABS=o,b.characterColors={},b.messages={global:[],tribe:[]},b.tribeId=l.getTribeId(),b.showChat=j.getItem("showChat"),b.width=s,b.height=t,b.INPUT_ADD_WIDTH=6,b.unread=0,b.MAX_UNREAD_LENGTH=3,b.init=L,b.setActiveTab=z,b.openCharacterInfo=C,b.closeChat=A,b.openChat=B,b.$on(f.CHAT_RECEIVED_TRIBE,F),b.$on(f.TRIBE_LEFT,D),b.$on(f.TRIBE_DISBANDED,D),b.$on(f.TRIBE_MEMBER_KICKED,E),b.$on(f.TRIBE_CREATED,G),b.$on(f.TRIBE_WELCOME,G),b.$on(f.TRIBE_INVITATION_ACCEPTED,G),b.$on(f.TRIBE_APPLICATION_ACCEPTED,G),b.$on(f.CHAT_TRIBE_HISTORY,H),L()}])}),define("controllers/interface/IconAnimationsInterfaceController",["app","conf/icons"],function(a,b){a.controller("IconAnimationsInterfaceController",["$rootScope","$scope","eventTypeProvider",function(a,c,d){var e=0,f=b.animations.selectors,g="#icon-animation-",h=function(a,b){return{id:++e,name:a,target:b,coords:{x:0,y:0}}},i=function(a){var b,d=c.iconAnimations[a];if(d&&a===e){for(b in c.iconAnimations)delete c.iconAnimations[b];delete c.iconAnimationsPresent}},j=function(d){var e=c.iconAnimations[d];window.clearTimeout(e.execute),e.element=$(g+e.id),e.begPos=e.element.offset(),e.endPos=$(f[e.target]||f[e.name]||f.premium).offset(),e.coords.x=e.endPos.left+e.endPos.width/2-e.begPos.left-e.begPos.width/2,e.coords.y=e.endPos.top+e.endPos.height/2-e.begPos.top-e.begPos.height/2,e.css="",e.remove=window.setTimeout(function(){i(d)},b.animations.durations.execute),a.$$phase||c.$digest()},k=function(a,d){var e=c.iconAnimations[a],f=b.animations.durations.wait+d*b.animations.durations.waitDifference;e.css="grown",e.execute=window.setTimeout(function(){j(a)},f)},l=function(){var a,b,d=0;for(b in c.iconAnimations)a=c.iconAnimations[b],a.execute||(k(a.id,d),d++)},m=function(a,b){var d,e;if(b&&b.icons&&b.icons.length){for(c.iconAnimationsPresent=!0,d=0;d<b.icons.length;d++)e=h(b.icons[d],b.opt_animationEndTarget),c.iconAnimations[e.id]=e;c.startAnimations()}},n=function(){c.iconAnimations={}};c.startAnimations=l,c.executeAnimation=j,c.$on(d.ICON_ANIMATION_NEW,m),n()}])}),define("helper/dom",["angular"],function(a){return{matchesId:function(b,c,d,e){var f,g,h=!1,i=e.srcElement||e.target;for(a.isArray(b)||(b=[b]),f=0;f<b.length;f++)if(g=b[f],i.id===g||c&&$(i).parents("#"+g).length){h=!0;break}return!h&&d&&d(e),
h},closestAction:function(a){for(var b,c;a&&!(b=1===a.nodeType?a.getAttribute("data-action"):"")&&a.parentNode!==document;)a=a.parentNode;return c=a.getAttribute("data-params"),b=[b],c?b.concat(c.split(",")):b||""},forceRepaint:function(a){a.style.display="none",a.style.display="block"},getStyle:function(a){var b,c=document.styleSheets[0].rules||document.styleSheets[0].cssRules;for(b=0;b<c.length;b++)if(c[b].selectorText===a)return c[b].style;return!1}}}),define("controllers/interface/MovementMenuInterfaceController",["app","conf/icons","queues/EventQueue","states/MapState","helper/dom"],function(a,b,c,d,e){a.controller("MovementMenuInterfaceController",["$rootScope","$scope","eventTypeProvider","windowManagerService","commandService","premiumActionService",function(a,f,g,h,i,j){var k,l,m,n,o={x:0,y:0},p={x:0,y:0},q=function(a){$(document).off("mousedown",l),f.movement&&(f.movement.onDrawn=null,c.unregister(c.types.MAPVIEW_UPDATE,k),delete f.movement)},r=function(a){a&&f.movement!==a&&($(document).on("mousedown",l),f.movement||c.register(c.types.MAPVIEW_UPDATE,k),f.movement=a,f.movement.onDrawn=k,n=!1)},s=function(a,b){b?r(b):q()},t=function(a){return a&&a.model?a.model.isCommand?a.model.isSpy?void h.getScreen("building_tavern"):void h.getFullSize("screen_unit_overview"):void h.getFullSize("building_market"):void 0},u=function(a){j.instantTransport(a.model.id)},v=function(){var a=m.width(),c=m.height();a&&c&&(o.x=b.commands.dim.cancel.offsetX-a/2,o.y=b.commands.dim.cancel.offsetY-c,n=!0)},w=function(){l=e.matchesId.bind(this,"movement-menu",!0,q),m=$("#movement-menu")};k=function(b,c){var e,g,h,i;if(o&&f.movement){if(null===b)return void q();n||v(),c=c||d.view,e=f.movement.drawnPosition.x+o.x,g=f.movement.drawnPosition.y+o.y,i=[1,0,0,1,e,g],h=d.graph.getScreenCoords({matrix:i},c),p.x=h.x,p.y=h.y,a.$$phase||f.$digest()}},f.$on(g.MAP_MOVEMENT_SELECTED,s),f.openMovementScreen=t,f.isCancelable=i.isCancelable,f.openCancelCommandModal=i.openCancelCommandModal,f.instantTransport=u,f.movementMenuCoords=p,f.init=w,w()}])}),define("controllers/interface/VillageDropDownController",["app","queues/EventQueue","battlecat","conf/conf"],function(a,b,c,d){a.controller("VillageDropDownController",["$rootScope","$scope","$filter","$timeout","eventTypeProvider","modelDataService","windowManagerService","windowDisplayService","mapService","villageService",function(a,e,f,g,h,i,j,k,l,m){var n,o,p,q=i.getSelectedCharacter(),r=i.getGroupList(),s={groups:[],search:""},t=["attacked","supported"],u=function(a){return s.search?a.getName().toLowerCase().indexOf(s.search.toLowerCase())>=0:!0},v=function(a){var b,c,d;if(!s.groups.length)return!0;for(b=r.getVillageGroups(a.getId()),c=s.groups.length;c--;){if(null===s.groups[c]||s.groups[c]===n)return!0;for(d=b.length;d--;)if(+b[d].id===+s.groups[c])return!0}return!1},w=function(){a.$$phase||(e.height="auto",e.$digest());var b=c("#dropdown-list").offset(),d=c(document.body).height();e.height=b.height.bound(d-b.top-10,10).toString()+"px",a.$$phase||e.$digest();try{e.directives.scrollbar.scrollbar.recalc()}catch(f){}},x=function(){o&&g.cancel(o),s.groups=e.selectedGroups.map(function(a){return a.value}),null===s.groups[0]&&(s.groups=[]);for(var a=q.getVillages(),b=a.length,c=[];b--;)v(a[b])&&u(a[b])&&c.unshift(a[b]);e.filtered=c,o=g(function(){w()})},y=function(b,c){var d,e=[];for(d in b)e.push({name:b[d].name,value:b[d].id.toString(),leftIcon:b[d].icon});for(d in c)t.indexOf(d)<0||!r.getSystemGroupVillageIds(d).length||e.push({name:f("i18n")("group_"+c[d].name,a.loc.ale,"screen_village_info"),value:c[d].id.toString(),leftIcon:parseInt(c[d].icon,16)});return e},z=function(){e.groups=y(r.getGroups(),r.getSystemGroups())},A=function(a,b){e.selectedVillageId=b||i.getSelectedVillage().getId()},B=function(){var a=q.getResourceDeposit(),d=q.getSecondVillage();z(),x(),A(),p=[e.$on(h.VILLAGE_LOADED,x),e.$on(h.VILLAGE_LOST,x),e.$on(h.VILLAGE_CONQUERED,x),e.$on(h.SECOND_VILLAGE_VILLAGE_CREATED,x),e.$on(h.SELECT_SELECTED,x),e.$on(h.GROUPS_VILLAGES_CHANGED,x),e.$on(h.GROUPS_DESTROYED,z),e.$on(h.GROUPS_UPDATED,z),e.$on(h.GROUPS_CREATED,z),e.$on(h.COMMAND_INCOMING,z),e.$on(h.COMMAND_CANCELLED,z),e.$on(h.COMMAND_WITHDRAWING_SUPPORT,z),e.$on(h.MAP_SELECT_VILLAGE,A)],e.visible=!0,g(function(){c("#village-filter")[0].focus(),w(),b.register(b.types.RESIZE,w)}),e.resourceDeposit=!1,i.getWorldConfig().isResourceDepositEnabled()&&a.isAvailable()&&(e.resourceDeposit=a),e.secondVillage=!1,i.getWorldConfig().isSecondVillageEnabled()&&d&&d.isAvailable()&&(e.secondVillage=d)},C=function(){for(var a;a=p.pop();)a();e.visible=!1,b.unregister(b.types.RESIZE,w)},D=function(){e.visible?C():B()},E=function(a){switch(a){case d.RESERVED_VILLAGE_IDS.RESOURCE_DEPOSIT:return k.openResourceDeposit(),!0;case d.RESERVED_VILLAGE_IDS.SECOND_VILLAGE:return k.openSecondVillage(),!0}return!1},F=function(b){i.getSelectedVillage().getId()!==b&&a.$broadcast(h.MAP_SELECT_VILLAGE,b)};z(),e.height="auto",e.filtered=[],e.query=s,e.filter=x,e.jump=l.centerOnPosition,e.select=F,e.open=E,e.visible=!1,e.toggle=D,e.selectedGroups=[{name:f("i18n")("select_groups",a.loc.ale,"interface_top"),value:null}],e.resourceDeposit=!1,e.secondVillage=!1}])}),define("controllers/interface/UnitBarController",["app","conf/recruitingQueueTypes"],function(a,b){a.controller("UnitBarController",["$rootScope","$scope","eventTypeProvider","modelDataService","windowManagerService",function(a,c,d,e,f){var g=function(){c.unitsBarOpen=!c.unitsBarOpen},h=function(){var a;if(null===c.unitsBarOpen)for(a in c.unitInfo.units)if(c.unitInfo.units[a].in_town>0)return void(c.unitsBarOpen=!0)},i=function(c){var e=b.getQueueTypeByUnitType(c),g=f.isTemplateOpen("building_"+e),h=function(a,b){"barracks"===e&&(b.preselection=c)};g?"barracks"===e&&g.scope.$$childHead.selectUnit(c):a.$broadcast(d.VILLAGE_SELECT_BUILDING,e,h)},j=function(){var a=e.getSelectedVillage();c.unitInfo=a.getUnitInfo(),h()},k=function(){var a,b,d,f=e.getSelectedVillage();d=f.getRecruitingQueues(),c.unitsInQueue={};for(a in d)b=d[a].jobs,b.length&&(c.unitsInQueue[b[0].unitType]=b[0])};c.toggleUnitBar=g,c.openUnitBuilding=i,c.unitsBarOpen=null,c.unitInfo=null,c.unitOrder=e.getGameData().getOrderedUnitNames(),c.unitRecruitable=e.getGameData().getUnit,c.unitsObject=e.getGameData().getUnitsObject(),c.$on(d.VILLAGE_LOADED,j),c.$on(d.RECRUIT_JOB_ADDED,k),c.$on(d.RECRUIT_JOB_REMOVED,k),c.$on(d.VILLAGE_LOADED,k)}])}),define("controllers/interface/QueueController",["app","helper/time"],function(a,b){a.controller("QueueController",["$rootScope","$scope","eventTypeProvider","modelDataService","buildingQueueService","queueService",function(a,b,c,d,e,f){var g=function(d){d!==b.selectedQueue&&(b.selectedQueue=d,a.$broadcast(c.INTERFACE_QUEUE_SELECTED))},h=function(){b.buildingQueue&&(b.buildingQueueLength=b.buildingQueue.length)},i=function(){var a=d.getSelectedVillage();a&&(b.recruitingQueues=a.getRecruitJobListsContainer())},j=function(){b.buildingQueue=e.getQueue(),i(),h()},k=function(a){var b=a.last();return b?b.building?f.getQueueIndicator(b.time_completed):b.unitType?f.getQueueIndicator(Math.round(b.completedAt/1e3)):void 0:""};b.QUEUES={building:0,recruiting:1},b.selectedQueue=b.QUEUES.building,b.buildingQueueLength=0,b.recruitingQueues=null,b.selectQueue=g,b.getColor=k,b.$on(c.RECRUIT_JOB_ADDED,i),b.$on(c.RECRUIT_JOB_REMOVED,i),b.$on(c.VILLAGE_LOADED,j),b.$on(c.BUILDING_QUEUE,j)}])}),define("controllers/building/BuildingHeadquarterController",["app"],function(a){a.controller("BuildingHeadquarterController",["$rootScope","$scope","buildingService","modelDataService","eventTypeProvider","buildingQueueService","windowManagerService","premiumActionService","inventoryItemTypeProvider",function(a,b,c,d,e,f,g,h,i){var j="headquarter",k=d.getGameData(),l=i.BUILD_COST_REDUCTION,m=function(b,c){var d=a.$new();d.buildingName=c,g.getModal("modal_building_info",d),b.stopPropagation()},n=function(a,c){b.computedResources=c},o=function(){b.buildCostReductionItem=d.getInventory().getItemByType(l)},p=function(){b.namedBuildingQueue=f.getNamedBuildingQueue()};b.cancelJob=function(a){c.openCancelUpgradeModal(a)},b.upgradeBuilding=function(a,e){var f=d.getSelectedVillage().getBuildingData().getDataForBuilding(a);("possible"===f.upgradeability||"possible"===f.upgradeabilityPremium&&e)&&(e&&(b.premiumLevelUpStarted=!0),c.upgradeBuilding(a,e,"hq",function(){b.premiumLevelUpStarted=!1}))},b.premiumInstantBuild=function(a){h.instantBuild(a)},b.isString=window.angular.isString,b.init=function(){var a,e,g,h=d.getSelectedVillage().getBuildingData().getData(),i=d.getGameData().getBuildings(),m=f.getQueue(),n=c.getGodsHouseTypes();p(),b.premiumCosts=k.getPremiumCostsForType(l),b.inventory=d.getInventory().getInventoryItemReference(),b.building=d.getSelectedVillage().getBuildingData().getDataForBuilding(j),b.buildingQueue=m,b.firstQueueJob=f.getQueueLength()?m[0]:null,g=[];for(a in i)e=i[a],"church"===a&&!n.church||"chapel"===a&&!n.chapel||(h[a].order=e.order,g.push(h[a]));g.sort(function(a,b){return a.order-b.order}),b.sortedBuildings=g,o()},b.setPremiumTooltipEnabled=function(a){b.premiumTooltip="true"===a},b.namedBuildingQueue={},b.buildingQueueProgress={},b.showPremiumCosts={},b.computedResources=null,b.showBuildingInfoModal=m,b.itemType=l,b.premiumLevelUpStarted=!1,b.$on(e.RESOURCES,n),b.$on(e.BUILDING_LEVEL_CHANGED,p),b.$on(e.BUILDING_QUEUE,p),b.$on(e.INVENTORY_ITEM_CHANGED,o),b.init()}])}),define("controllers/building/BuildingGodsHouseController",["app"],function(a){a.controller("BuildingGodsHouseController",["$scope","$rootScope","eventTypeProvider","modelDataService","villageService","windowDisplayService","mapService",function(a,b,c,d,e,f,g){var h=0,i=function(){var e=d.getSelectedVillage(),f=e.getBuildingData().getDataForBuilding("chapel"),g=f.level>0?"chapel":"church";a.buildingName!==g&&b.$broadcast(c.VILLAGE_SELECT_BUILDING,g)},j=function(){var b=d.getSelectedVillage();a.buildingName=a.godsHouseType,a.building=b.getBuildingData().getDataForBuilding(a.buildingName),e.requestVillageProvinceNeighbours(b.getId(),function(b){if(!b.villages)throw new Error("No village data");a.villages=b.villages,h=e.getHighestGodsHouseLevel(b.villages),a.bonus=e.getMoralBonus(h),a.nextBonus=e.getMoralBonus(h+1)})};a.buildingName="",a.building=null,a.villages=null,a.bonus=0,a.nextBonus=0,a.jumpToVillage=g.jumpToVillage,a.openVillageInfoScreen=f.openVillageInfo,a.init=j,a.$on(c.VILLAGE_LOADED,i),a.init()}])}),define("conf/tribeSkillNames",[],function(){return{better_hospital:"better_hospital",iron_walls:"iron_walls",recruit_speed_bonus:"recruit_speed_bonus",loot_bonus:"loot_bonus",raid_speed:"raid_speed",better_spy_defense:"better_spy_defense",member_limit:"member_limit",attack_bonus:"attack_bonus",supporter:"supporter",medic:"medic"}}),define("controllers/building/BuildingWallController",["app","conf/effectTypes","conf/tribeSkillNames"],function(a,b,c){a.controller("BuildingWallController",["$scope","$filter","routeProvider","socketService","modelDataService","eventTypeProvider","effectService",function(a,d,e,f,g,h,i){var j,k,l="wall",m=g.getSelectedVillage(),n=m.getBuildingData(),o=n.getDataForBuilding(l),p=g.getTribeSkills(),q=function(a,b){"wall"===b.building&&f.emit(e.VILLAGE_WALL_INFO,{village_id:g.getSelectedVillage().getId()})},r=function(){a.ironWallsEffect=i.getEffect(b.BASE_WALL_LEVELS),a.ironWallsEffect&&p&&(a.hasActiveTribeSkill=p.isSkillActive(c.iron_walls))};a.getBuildTimeReduction=function(){var b,c=g.getGameData().getResearchesData(),d=c.forBuilding("wall"),e=a.building.researches,f=0;for(b in e)e[b].active&&(f+=d[b]["function"]);return~~(100*f)},a.init=function(){j=g.getSelectedVillage(),a.building=j.getBuildingData().getDataForBuilding(l),r(),f.emit(e.VILLAGE_WALL_INFO,{village_id:j.getId()})},a.$on(h.BUILDING_LEVEL_CHANGED,q),a.$on(h.VILLAGE_WALL_INFO,function(b,c){a.wallinfo=c,a.currentDefenseBonus=Math.round(100*(c.current_level.defense_bonus-1)),a.nextDefenseBonus=Math.round(100*(c.next_level.defense_bonus-1))}),a.$on(h.EFFECT_CHANGED,r),a.$on(h.EFFECT_EXPIRED,r),a.wallinfo={},a.building=o,k="building_"+l,a.title=d("i18n")("title",a.locale,k),a.info=d("i18n")("info",a.locale,k),a.init()}])}),define("controllers/building/BuildingAcademyController",["app","helper/time","helper/parse","conf/recruitingQueueTypes"],function(a,b,c,d){a.controller("BuildingAcademyController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","modalSharedUnitInfoDataService","windowManagerService","recruitingService","eventTypeProvider","premiumActionService","iconAnimationsService","academyService",function(a,e,f,g,h,i,j,k,l,m,n,o,p){var q,r,s=g.getGameData(),t=["tab_academy","tab_mass_minting"],u=g.getSelectedCharacter(),v=function(a,b){j.setUnitName(b),k.getModal("modal_unit_info"),a.preventDefault(),a.stopPropagation()},w=function(a){var b=e.$new();b.coinCosts=l.getCostsPerCoin(),k.getModal("modal_coin_info",b),a.preventDefault(),a.stopPropagation()},x=function(a){if(-1===t.indexOf(a))throw new Error("No such tab "+a);e.activeTab=a},y=function(){var b=e.rangeSlider.coins.value;0!==b&&h.emit(i.MINT_COINS,{village_id:r.getId(),amount:b},function(){a.$broadcast(m.MESSAGE_SUCCESS,{message:f("i18n")("minted_coins",a.loc.ale,"building_academy")})})},z=function(){0!==e.rangeSlider.snob.value&&(e.trainingNobles+=e.rangeSlider.snob.value,l.recruit(d.ACADEMY,"snob",e.rangeSlider.snob.value),e.rangeSlider.snob.value=0)},A=function(){var a;e.massOverallAmount=0;for(a in e.massAmount)e.massOverallAmount+=e.massAmount[a]},B=function(a,c){var d=l.getCostsPerCoin();return isNaN(a)?void(e.rangeSlider.coins.value=0):0===a?(e.valueCoinsEntered=!1,void(e.costs.coins={wood:0,iron:0,clay:0})):(e.costs.coins={wood:a*d.wood,iron:a*d.iron,clay:a*d.clay},a!==c&&(e.valueCoinsEntered=!0),void b.timer.tick())},C=function(c,d){return isNaN(c)?(e.nobleRecruitTime="0",void(e.rangeSlider.snob.value=0)):(a.$broadcast(m.TIMELINE_RECRUITING_PREVIEW,c?{type:"preview",unit_type:"snob",time:1e3*e.nobleRecruitTime}:!1),0===c?(e.valueNobleEntered=!1,e.costs.coins={wood:0,iron:0,clay:0,food:0},void(e.nobleRecruitTime=0)):(e.costs.snob=l.getNobleCosts(e.rangeSlider.snob.value),e.nobleRecruitTime=l.calculateTime(e.rangeSlider.snob.value,"snob"),c!==d&&(e.valueNobleEntered=!0),void b.timer.tick()))},D=function(){return Math.max(0,u.getTotalNobles().all+l.getFreeGoldCoinSlots())},E=function(){e.maxNobles=D(),e.currentCoins=u.getGoldCoins(),e.activeNobles=u.getTotalNobles().active,e.trainingNobles=u.getTotalNobles().training},F=function(a){return"thieves"!==a.preceptory_order?1:1-a.preceptory_level/100},G=function(a,b){var c,d=[],f=a,g=l.getCostsPerCoin(b?F(b):void 0);if(!f){f={};for(c in e.computedResources)f[c]=e.computedResources[c].currentProduction}for(c in g)g[c]&&d.push(~~(f[c]/g[c]));return[].min(d)},H=function(a){var b,c={},d=g.getGameData().getCostsPerCoin(),f=e.villages[a];for(b in d)d[b]&&(c[b]=d[b]*e.massAmount[a]*F(f));f.costs=c},I=function(a){var b,c={},d=l.getCostsPerCoin();if(a.id===r.getId())return G(r.getResources().getResources());for(b in d)d[b]&&(c[b]=a["res_"+b]);return G(c,a)},J=function(a,b){e.massAmount[a]=parseInt(b,10)||0,e.massAmount[a]=e.massAmount[a].bound(0,e.villages[a].maxCoins),A(),H(a)},K=function(a){e.massAmount[a]||(e.massAmount[a]=0),J(a,e.massAmount[a]+1)},L=function(a){e.massAmount[a]||(e.massAmount[a]=0),J(a,e.massAmount[a]-1)},M=function(a){e.massAmount[a]=e.massAmount[a]||0,e.massAmount[a]=e.villages[a].maxCoins,A(),H(a)},N=function(a){var b;e.maxCoins=0,e.amountAll=c.toValidInteger(a);for(b in e.villages)e.villages[b].maxCoins>e.maxCoins&&(e.maxCoins=e.villages[b].maxCoins);e.amountAll=e.amountAll.bound(0,e.maxCoins);for(b in e.villages)e.massAmount[b]=e.amountAll.bound(0,e.villages[b].maxCoins),H(b);A()},O=function(){0!==e.amountAll&&N(e.amountAll-1)},P=function(){N(e.amountAll+1)},Q=function(){var a,b=0;for(a in e.villages)e.villages[a].maxCoins>b&&(b=e.villages[a].maxCoins);e.amountAll=b;for(a in e.villages)M(a);A()},R=function(){var a;for(a in e.massAmount)e.massAmount[a]&&(e.villages[a].costs={},e.massAmount[a]=0);e.massOverallAmount=0,e.amountAll=0},S=function(){var b,c=[];if(0!==e.massOverallAmount){for(b in e.massAmount)e.massAmount[b]&&c.push({id:b,amount:e.massAmount[b]});h.emit(i.MASS_MINT_COINS,{villages:c},function(){R(),a.$broadcast(m.MESSAGE_SUCCESS,{message:f("i18n")("minted_coins",a.loc.ale,"building_academy")})})}},T=function(a,b){e.maxTrainableNobles=l.getMaxTrainableNobles(),e.computedResources=b,e.rangeSlider.coins.max=G(),e.rangeSlider.snob.max=e.maxTrainableNobles.total,e.computedResources&&e.villages[q]&&(e.villages[q].res_iron=e.computedResources.iron.currentProduction,e.villages[q].res_clay=e.computedResources.clay.currentProduction,e.villages[q].res_wood=e.computedResources.wood.currentProduction,e.villages[q].maxCoins=e.rangeSlider.coins.max)},U=function(a,b){e.villages[b.villageId]&&(e.villages[b.villageId].res_clay=b.resources.clay,e.villages[b.villageId].res_wood=b.resources.wood,e.villages[b.villageId].res_iron=b.resources.iron,e.villages[b.villageId].maxCoins=I(e.villages[b.villageId]),J(b.villageId,e.massAmount[b.villageId]))},V=function(a,b){var c;e.hasOtherVillagesWithAcademy=!1,e.villagesCount=0,e.villageIdsOrderByName=[],b.villages.forEach(function(a){c=a.id,e.villagesCount++,e.massAmount[c]||(e.massAmount[c]=0),a.academy&&(e.villages[a.id]=a,e.villages[a.id].maxCoins=I(a),a.id!==r.getId()&&(e.hasOtherVillagesWithAcademy=!0),e.villages[c].maxCoins>e.maxCoins&&(e.maxCoins=e.villages[c].maxCoins),e.villageIdsOrderByName.push(a.id))})},W=function(a,b){u.setGoldCoins(e.currentCoins+b.amount),e.currentCoins=u.getGoldCoins(),e.rangeSlider.coins.max=G(),e.maxNobles=D(),e.coinsNeededForNextNobleLimit=l.calculateCoinsNeededForNextNobleLimit(),e.rangeSlider.coins.value=0},X=function(){h.emit(i.ACADEMY_GET_INFO,{village_id:u.getSelectedVillage().getId()})},Y=function(){a.$broadcast(m.TIMELINE_RECRUITING_PREVIEW,!1)},Z=function(a){e.pendingJobConfirmations.push(a.job_id)},$=function(a){a.origin="ACADEMY",n.instantRecruit(a,Z)},_=function(a,b){var c=e.pendingJobConfirmations.indexOf(b.job_id);-1!==c&&(e.pendingJobConfirmations.splice(c,1),o.createAnimations(["unit-"+b.unit_type]))},aa=function(){var b="building_academy",c=l.getMaxTrainableNobles(),d=0===c.byFood?"not_enough_food":0===c.byResources?"not_enough_resources":"not_enough_coins";return f("i18n")(d,a.loc.ale,b)},ba=function(a){0===a.value&&(a.value="")},ca=function(a){""===a.value&&(a.value=0)},da=function(a){0===a.amountAll&&(a.amountAll="")},ea=function(a){0===e.massAmount[a]&&(e.massAmount[a]="")},fa=function(){r=u.getSelectedVillage(),q=r.getId(),e.coinCosts=l.getCostsPerCoin(),e.building=r.getBuildingData().getDataForBuilding("academy"),e.unitInfo=r.getUnitInfo(),e.academyJobs=r.getRecruitingQueue(d.ACADEMY),e.currentCoins=u.getGoldCoins(),e.coinsNeededForNextNobleLimit=l.calculateCoinsNeededForNextNobleLimit(),E(),e.costs={snob:{wood:0,clay:0,iron:0,food:0},coins:{wood:0,clay:0,iron:0}},e.rangeSlider={snob:{min:0,max:0,snap:1,value:0,enabled:!0},coins:{min:0,max:0,snap:1,value:0,enabled:!0}},R(),N(0),e.instantRecruitEnabled=g.getWorldConfig().isInstantRecruitEnabled(),e.pendingJobConfirmations=[],h.emit(i.GET_CHARACTER_VILLAGES)};e.tabs=t,e.activeTab=t[0],e.resourceOrder=s.getResourceNames(),e.amountAll=0,e.massAmount={},e.massOverallAmount=0,e.valueCoinsEntered=!1,e.valueNobleEntered=!1,e.maxCoins=0,e.mintingTime="0",e.computedResources=null,e.nobleRecruitTime=0,e.hasOtherVillagesWithAcademy=!1,e.villagesCount=0,e.villages={},e.villageIdsOrderByName=[],e.setActiveTab=x,e.showUnitInfoModal=v,e.showCoinInfoModal=w,e.trainNobles=z,e.mintCoins=y,e.floor=window.Math.floor,e.decreaseAll=O,e.increaseAll=P,e.maximizeAll=Q,e.setAll=N,e.decrease=L,e.increase=K,e.maximize=M,e.set=J,e.massMint=S,e.cancelMassMint=R,e.academyService=p,e.init=fa,e.instantRecruit=$,e.deleteJob=p.cancelTraining,e.getRecruitNoblemanTooltip=aa,e.onFocus=ba,e.onBlur=ca,e.setFocus=ea,e.setAllFocus=da,e.$on("$destroy",Y),e.$on(m.RESOURCES,T),e.$on(m.CHARACTER_VILLAGES,V),e.$on(m.ACADEMY_MINTED_COINS,W),e.$on(m.ACADEMY_RECRUIT_JOB_CREATED,X),e.$on(m.UNIT_RECRUIT_JOB_FINISHED,X),e.$on(m.UNIT_RECRUIT_JOB_FINISHED,_),e.$on(m.VILLAGE_UNIT_INFO,E),e.$on(m.ACADEMY_INFO,E),e.$on(m.VILLAGE_RESOURCES_CHANGED,U),e.$watch("rangeSlider.snob.value",C),e.$watch("rangeSlider.coins.value",B),fa()}])}),define("controllers/building/BuildingFortressController",["app"],function(a){a.controller("BuildingFortressController",["$scope","modelDataService",function(a,b){var c="fortress";a.init=function(){a.building=b.getSelectedVillage().getBuildingData().getDataForBuilding(c)},a.init()}])}),define("controllers/building/BuildingPreceptoryController",["app","conf/buildingTypes","conf/recruitingQueueTypes"],function(a,b,c){a.controller("BuildingPreceptoryController",["$rootScope","$filter","$scope","modelDataService","eventTypeProvider","preceptoryOrderTypeProvider","windowManagerService","recruitingService","premiumActionService","iconAnimationsService",function(a,d,e,f,g,h,i,j,k,l){var m=b.PRECEPTORY,n=m.toUpperCase(),o=function(){e.unitName=e.selectedOrder===h.TEMPLAR?"doppelsoldner":e.selectedOrder===h.TEUTONIC?"trebuchet":null},p=function(a,b){e.selectedOrder=f.getSelectedVillage().getSelectedOrder(),o()},q=function(a,b){var c=f.getSelectedVillage();c.getId()===b.village_id&&(c.setSelectedOrder(null),e.init())},r=function(b){var e=a.$new(),f="cancel_recruit_job";e.title=d("i18n")("title",a.loc.ale,f),e.text=d("i18n")("text",a.loc.ale,f),e.boxText=d("i18n")("boxText",a.loc.ale,f),e.submitText=d("i18n")("submitText",a.loc.ale,f),e.cancelText=d("i18n")("cancelText",a.loc.ale,f),e.switchColors=!0,e.submit=function(){j.cancelRecruitJob(c.PRECEPTORY,b),e.closeWindow()},e.cancel=function(){e.closeWindow()},i.getModal("modal_attention",e)},s=function(a){e.pendingJobConfirmations.push(a.job_id)},t=function(a){a.origin=n,k.instantRecruit(a,s)},u=function(a,b){b.origin=n,k.addSecondQueueJob(a,b)},v=function(a){return e.recruitJobs.getJobIndex(a)},w=function(a,b){var c=e.pendingJobConfirmations.indexOf(b.job_id);-1!==c&&(e.pendingJobConfirmations.splice(c,1),l.createAnimations(["unit-"+b.unit_type]))},x=function(){var b=f.getSelectedVillage();e.recruitJobs=f.getSelectedVillage().getRecruitingQueue(m),e.building=b.getBuildingData().getDataForBuilding(m),e.selectedOrder=b.getSelectedOrder(),a.$$phase||e.$apply(),o(),a.$broadcast(g.PRECEPTORY_INITIALIZED)};e.pendingJobConfirmations=[],e.instantRecruitEnabled=k.isInstantRecruitEnabled(),e.secondQueueJobEnabled=k.isSecondQueueJobEnabled(),e.addSecondQueueJob=u,e.isAddSecondQueueJobPossible=k.isAddSecondQueueJobPossible,e.init=x,e.deleteJob=r,e.instantRecruit=t,e.getJobIndex=v,e.$on(g.PRECEPTORY_ORDER_SELECTED,p),e.$on(g.PRECEPTORY_ORDER_RESET,q),e.$on(g.UNIT_RECRUIT_JOB_FINISHED,w),x()}])}),define("controllers/building/BuildingPreceptorySelectOrderController",["app"],function(a){a.controller("BuildingPreceptorySelectOrderController",["$scope","preceptoryOrderTypeProvider","modelDataService","socketService","routeProvider","windowManagerService","$rootScope",function(a,b,c,d,e,f,g){a.preceptoryOrderTypes=b;var h=function(a){d.emit(e.PRECEPTORY_SELECT_ORDER,{village_id:c.getSelectedVillage().getId(),order:a})},i=function(a,b){var c=g.$new();c.orderName=b,f.getModal("modal_order_info",c),a.stopPropagation()};a.selectOrder=function(a){var b=g.$new();b.orderName=a,b.onOrderSelected=h,f.getModal("modal_select_order",b)},a.showOrderInfoModal=i}])}),define("controllers/building/BuildingPreceptoryRecruitOrderController",["app","helper/time","conf/recruitingQueueTypes"],function(a,b,c){a.controller("BuildingPreceptoryRecruitOrderController",["$rootScope","$scope","modelDataService","eventTypeProvider","recruitingService","modalSharedUnitInfoDataService","windowManagerService","preceptoryService",function(a,d,e,f,g,h,i,j){var k=e.getGameData(),l=function(a){h.setUnitName(d.unitName),i.getModal("modal_unit_info"),a.stopPropagation()},m=function(){d.timeToRecruit=g.calculateTime(d.rangeSlider.value,d.unitName)},n=function(){d.costs=g.calculateCost(d.rangeSlider.value,d.unitName)},o=function(){d.rangeSlider.max=g.calculateMaxRecruitable(d.unitName,d.rangeSlider.value)},p=function(){a.$broadcast(f.TIMELINE_RECRUITING_PREVIEW,!1)},q=function(c){m(),n(),d.valueEntered=!!c,a.$broadcast(f.TIMELINE_RECRUITING_PREVIEW,c?{type:"preview",unit_type:d.unitName,time:1e3*d.timeToRecruit}:!1),b.timer.tick()},r=function(){d.rangeSlider.value=0,b.timer.tick()},s=function(){d.rangeSlider.value&&(g.recruit(c.PRECEPTORY,d.unitName,d.rangeSlider.value),r())},t=function(a){0===a.value&&(a.value="")},u=function(a){""===a.value&&(a.value=0)};d.rangeSlider={min:0,max:0,snap:1,value:0,enabled:!0},d.costs={wood:0,iron:0,clay:0,food:0},d.valueEntered=!1,d.resourceOrder=k.getResourceNames(),d.unitInfo=e.getSelectedVillage().getUnitInfo(),d.recruit=s,d.showUnitInfoModal=l,d.resetOrder=j.resetOrder,d.onFocus=t,d.onBlur=u,d.$on("$destroy",p),d.$on(f.RESOURCES,o),d.$on(f.PRECEPTORY_INITIALIZED,function(){d.unitInfo=e.getSelectedVillage().getUnitInfo()}),d.$watch("rangeSlider.value",q)}])}),define("controllers/building/BuildingPreceptoryThievesOrderController",["app"],function(a){a.controller("BuildingPreceptoryThievesOrderController",["$scope","preceptoryService",function(a,b){a.resetOrder=b.resetOrder}])}),define("controllers/building/BuildingFarmController",["app","conf/effectTypes"],function(a,b){a.controller("BuildingFarmController",["$scope","modelDataService","socketService","routeProvider","eventTypeProvider","effectService",function(a,c,d,e,f,g){var h=c.getWorldConfig(),i=function(){a.maxSuppliableUnits=a.building.level*h.getFarmRule(),a.supplyUsedPercent=Math.round(a.farmInfo.foreignUnitFood/a.maxSuppliableUnits*100)},j=function(b){a.farmInfo=b,a.usedPopulation=b.buildingFood+b.buildingQueueFood+b.unitFood+b.unitQueueFood,i()},k=function(){var c,d,e;for(a.foodBoosts=g.getEffects(b.FOOD_BOOST),a.boostedFood=0,e=0;e<a.foodBoosts.length;e++)c=a.foodBoosts[e].details.factor,d=Math.round(a.resources.food.maxBaseFood*(c-1)),a.boostedFood+=d},l=function(b,c){a.resources=c,k()},m=function(){var b=c.getSelectedVillage().getId();a.farmInfo.foreignUnitFood||(a.farmInfo.foreignUnitFood=0),d.emit(e.VILLAGE_FARM_INFO,{village_id:b},j),a.building=c.getSelectedVillage().getBuildingData().getDataForBuilding("farm")};a.farmInfo={},a.resources={},a.suppliableUnits=0,a.init=m,a.$on(f.RESOURCES,l),a.$on(f.VILLAGE_RESOURCES_CHANGED,m),a.$on(f.COMMAND_SUPPORT_ARRIVED,m),a.$on(f.COMMAND_WITHDRAWN_SUPPORT,m),a.$on(f.EFFECT_CHANGED,k),a.$on(f.EFFECT_EXPIRED,k),a.$watch("farmInfo.foreignUnitFood",i),a.$watch("building.level",i),m()}])}),define("controllers/building/BuildingWarehouseController",["app","helper/time","conf/effectTypes"],function(a,b,c){a.controller("BuildingWarehouseController",["$scope","$filter","resourceService","modelDataService","inventoryService","eventTypeProvider","inventoryItemTypeProvider","premiumActionService","socketService","routeProvider","effectService","boostsService",function(a,d,e,f,g,h,i,j,k,l,m,n){var o="warehouse",p=i.BOOST_PROTECTION,q=f.getGameData(),r=function(b,c){a.resources=c},s=function(){a.premiumBoostProtectionStarted=!1},t=function(b,c){o===c.building&&a.init()},u=function(b,c){var e,g,h,i=f.getSelectedCharacter(),j=0;for(c&&(a.protectedResources=c.protected_resources,a.maxResourceProtection=c.max_protected_resources,a.protectedResourcesPercent=c.protected_resources/c.max_protected_resources*100),a.baseValue=i.getSelectedVillage().getResources().getBaseStorage(),a.tooltip=d("number")(a.baseValue),h=0;h<a.boosts.length;h++)a.boosts[h].active&&(e=a.boosts[h].active.details.factor,g=~~(a.baseValue*(e-1)),j+=g,a.tooltip+=" + "+d("number")(g));a.boostedValue=a.baseValue+j,a.tooltip+=" = "+d("number")(a.boostedValue)},v=function(){var b=f.getSelectedVillage();return a.inventory[p]&&a.inventory[p].amount?void g.useItem(f.getInventory().getItemByType(p),function(){a.premiumBoostProtectionStarted=!0,k.emit(l.PREMIUM_USE_ITEM,{village_id:b.getId(),item_id:f.getInventory().getItemByType(p).id},s)}):(a.premiumBoostProtectionStarted=!0,void j.boostProtection(s))},w=function(a){var b=a.item;return b&&b.amount?void g.useItem(b,function(){k.emit(l.PREMIUM_USE_ITEM,{village_id:f.getSelectedVillage().getId(),item_id:b.id})}):void j.buyBoost(a)},x=function(b,d){a.effect=m.getEffect(c.LOOT_PROTECTION),n.updateBoosts(d,a.boosts,c.STORAGE_CAPACITY_INCREASE),u()},y=function(b,d){a.boosts=[],n.onPremiumOffers(a.boosts,d,null,c.STORAGE_CAPACITY_INCREASE),u()},z=function(b,d){n.onItemChanged(d,a.boosts,c.STORAGE_CAPACITY_INCREASE)},A=function(){var d=f.getSelectedCharacter(),g=d.getSelectedVillage(),h=g.getBuildingData();k.emit(l.PREMIUM_LIST_SHOP_OFFERS,{}),a.building=h.getDataForBuilding(o),e.requestStorageInfo(d.getSelectedVillage().getId()),x(null,{type:c.RESOURCE_PRODUCTION_INCREASE}),b.timer.tick()};a.lootProtectionFactor=q.getLootProtectionFactor(),a.lootProtectionDuration=q.getLootProtectionDuration(),a.maxStorage=0,a.protectedResourcesPercent=0,a.building=null,a.maxResourceProtection=null,a.premiumBoostProtectionStarted=!1,a.itemType=p,a.inventory=f.getInventory().getInventoryItemReference(),a.premiumCosts=q.getPremiumCostsForType(p),a.boosts=[],a.init=A,a.activateBoost=w,a.boostProtection=v,a.$on(h.RESOURCES,r),a.$on(h.RESEARCH_RESEARCHED,t),a.$on(h.BUILDING_LEVEL_CHANGED,t),a.$on(h.VILLAGE_STORAGE_INFO,u),a.$on(h.EFFECT_CHANGED,x),a.$on(h.EFFECT_EXPIRED,x),a.$on(h.PREMIUM_SHOP_OFFERS,y),a.$on(h.INVENTORY_ITEM_CHANGED,z),A()}])}),define("controllers/building/BuildingBarracksController",["app","helper/time","helper/parse","conf/buildingTypes","conf/effectTypes","conf/tribeSkillNames","conf/recruitingQueueTypes"],function(a,b,c,d,e,f,g){a.controller("BuildingBarracksController",["$rootScope","$scope","$filter","modelDataService","eventTypeProvider","recruitingService","modalSharedUnitInfoDataService","windowManagerService","premiumActionService","iconAnimationsService","socketService","routeProvider","inventoryItemTypeProvider","inventoryService","settingsService","statueService","academyService","effectService",function(a,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y,z,A,B=!1,C=d.BARRACKS,D=C.toUpperCase(),E=j.getTribeSkills(),F=j.getGameData(),G={},H=function(){h.isDailyUnitDealEnabled&&(h.slotMachine.buyDealItem=j.getInventory().getItemByType(s.DAILY_UNIT_SLOT),h.slotMachine.rerollItem=j.getInventory().getItemByType(s.DAILY_UNIT_REROLL))},I=function(){var a=5,b=3,c=h.maxRecruitable[h.selectedUnitName]||0,d=A*a;return A>b||d>c?c:d},J=function(){q.emit(r.PREMIUM_DAILY_UNIT_DEAL_GET_OFFERS,{village_id:y.getId()})},K=function(a,b){h.slotMachine.buyDealItem&&h.slotMachine.buyDealItem.amount?t.useItem(h.slotMachine.buyDealItem,function(){q.emit(r.PREMIUM_DAILY_UNIT_DEAL_ACCEPT,{village_id:y.getId(),slot:a})}):o.buyDailyUnitDealSlot(y.getId(),a,b)},L=function(a){var b=function(){q.emit(r.PREMIUM_DAILY_UNIT_DEAL_REROLL,{village_id:y.getId()},function(){h.slotMachine.rerollAnimation&&h.slotMachine.rerollAnimation()})};return a?void(h.slotMachine.rerollItem&&h.slotMachine.rerollItem.amount?t.useItem(h.slotMachine.rerollItem,function(){b()},h.slotMachine.resetSlotActionVisibility):o.rerollDailyUnitDealSlots(y.getId(),h.slotMachine.rerollAnimation,h.slotMachine.resetSlotActionVisibility)):void b()},M=function(){u.settings.game.minimizeDailyUnitDeal=h.minimized=!h.minimized,u.saveGameSettings()},N=function(){var a=h.sliderVisible.offensive?"offensive":h.sliderVisible.defensive?"defensive":null;return a?h.rangeSlider[a]:null},O=function(){var a,b;h.selectedUnitName&&(b=I(),a=N(),a.max=b,a.snap=1)},P=function(){var a=l.calculateRecruits(h.unitsToRecruit);h.totalRecruits=a.totalRecruits,h.temporaryCosts=a.temporaryCosts,z.setTemporaryBarracksCosts(h.temporaryCosts)},Q=function(){var a;h.totalTimeToRecruit=0,G[h.selectedUnitName]=l.calculateTime(h.unitsToRecruit[h.selectedUnitName],h.selectedUnitName,h.recruitSpeedEffect);

for(a in G)G.hasOwnProperty(a)&&(h.totalTimeToRecruit+=G[a])},R=function(a){return h.recruitJobs.getJobIndex(a)},S=function(d){var e,f,g=h.selectedUnitName;g&&(e=c.toValidInteger(d),f=e.bound(0,h.maxRecruitable[g]),h.unitsToRecruit[g]=f,Q(),P(),a.$broadcast(k.TIMELINE_RECRUITING_PREVIEW,d?{type:"preview",unit_type:g,time:1e3*G[g]}:!1),b.timer.tick())},T=function(a){return a.required_level<=A},U=function(){return F.getDefensiveUnits().concat(F.getOffensiveUnits()).filter(T)},V=function(a){h.pendingJobConfirmations.push(a.job_id)},W=function(a){a.origin=D,o.instantRecruit(a,V)},X=function(a,b){b.origin=D,o.addSecondQueueJob(a,b)},Y=function(){h.recruitSpeedEffect=x.getEffect(e.RECRUIT_SPEED_BOOST),h.recruitSpeedEffect&&E&&(h.hasActiveTribeSkill=E.isSkillActive(f.recruit_speed_bonus))},Z=function(a,b){var c=h.pendingJobConfirmations.indexOf(b.job_id);-1!==c&&(h.pendingJobConfirmations.splice(c,1),p.createAnimations(["unit-"+b.unit_type]))};h.unitData=F.getUnits(),h.units={defensive:F.getDefensiveUnits(),offensive:F.getOffensiveUnits()},h.totalRecruits=0,h.hasUnits=!1,h.unitsToRecruit={},h.totalTimeToRecruit=0,h.temporaryCosts={wood:0,clay:0,iron:0,food:0},h.selectedUnitName=null,h.sliderVisible={defensive:!1,offensive:!1},h.fixedHeight=!1,h.groupOrder=["defensive","offensive"],h.resourceOrder=F.getResourceNames(),h.rangeSlider={defensive:{min:0,max:0,snap:1,value:0,enabled:!0},offensive:{min:0,max:0,snap:1,value:0,enabled:!0}},h.maxRecruitable={},h.computedResources=null,h.deleteJob=function(b){var c=a.$new(),d="cancel_recruit_job";c.title=i("i18n")("title",a.loc.ale,d),c.text=i("i18n")("text",a.loc.ale,d),c.boxText=i("i18n")("boxText",a.loc.ale,d),c.submitText=i("i18n")("submitText",a.loc.ale,d),c.cancelText=i("i18n")("cancelText",a.loc.ale,d),c.switchColors=!0,c.submit=function(){l.cancelRecruitJob(g.BARRACKS,b),c.closeWindow()},c.cancel=function(){c.closeWindow()},n.getModal("modal_attention",c)},h.getGroupType=function(a){var b,c=!1;for(b=0;b<h.units.defensive.length;b++)if(h.units.defensive[b].name===a){c=!0;break}return c===!0?"defensive":"offensive"},h.selectUnitByClick=function(a,b,c){return 0!==h.maxRecruitable[b]?(a.preventDefault&&a.preventDefault(),h.selectedUnitName!==b||a.target instanceof window.HTMLInputElement?void h.selectUnit(b,c):void(h.selectedUnitName=null)):void 0},h.selectUnit=function(a,b){var d,e=b||(F.getDefensiveUnitNames().indexOf(a)<0?"offensive":"defensive");h.units[e].filter(function(b){return b.name===a&&b.available}).length&&(h.sliderVisible={defensive:!1,offensive:!1},h.selectedUnitName&&""!==h.unitsToRecruit[h.selectedUnitName]&&(h.unitsToRecruit[h.selectedUnitName]=c.toValidInteger(h.unitsToRecruit[h.selectedUnitName]).bound(0,h.maxRecruitable[h.selectedUnitName])),$("#input-unit-recruit-"+a).focus(),h.selectedUnitName=a,h.sliderVisible[e]=a,O(),d=N(),d&&(d.value=h.unitsToRecruit[a]||0))},h.cancelRecruiting=function(){h.unitsToRecruit={},h.totalTimeToRecruit=0,h.totalRecruits=0,G={},P();var a=N();a&&(a.value=0)},h.recruitUnits=function(){var a;for(a in h.unitsToRecruit)h.unitsToRecruit[a]=c.toValidInteger(h.unitsToRecruit[a]),h.unitsToRecruit[a]&&l.recruit(g.BARRACKS,a,h.unitsToRecruit[a]);h.cancelRecruiting()},h.$watch("rangeSlider.defensive.value",S),h.$watch("rangeSlider.offensive.value",S),h.showUnitInfoModal=function(a,b){m.setUnitName(b),n.getModal("modal_unit_info"),a.stopPropagation()},h.init=function(){var a;F=j.getGameData(),y=j.getSelectedVillage(),z=y.getResources(),A=y.getBuildingLevel(C),h.selectedUnitName="",h.unitData=F.getUnits(),h.units={defensive:F.getDefensiveUnits(),offensive:F.getOffensiveUnits()},a=N(),a&&(a.value=0),h.sliderVisible={defensive:!1,offensive:!1},h.building=j.getSelectedVillage().getBuildingData().getDataForBuilding(C),h.unitInfo=y.getUnitInfo(),h.recruitJobs=y.getRecruitingQueue(g.BARRACKS),h.cancelRecruiting(),b.timer.tick(),h.preselection&&h.selectUnit(h.preselection),h.dealSlotPurchaseLimit=j.getWorldConfig().getDailyUnitDealSlotPurchaseLimit(),(h.isDailyUnitDealEnabled=h.dealSlotPurchaseLimit>0)&&(h.toggleVisibility=M,h.minimized=u.settings.game.minimizeDailyUnitDeal,h.slotMachine?(h.slotMachine.provisions=y.getResources().getResources().food,(h.slotMachine.level!==y.getBuildingLevel("barracks")||h.slotMachine.villageId!==y.getId())&&(h.slotMachine.possibleData=U(),h.slotMachine.villageId=y.getId(),h.slotMachine.level=A,h.slotMachine.init())):h.slotMachine={dealLevel:"",villageId:y.getId(),provisions:y.getResources().getResources().food,level:A,levelRequirements:[3,10,15],slotPurchaseLimit:h.dealSlotPurchaseLimit,rerollItem:null,buyDealItem:null,possibleData:U(),dealCount:3,events:{setData:k.PREMIUM_DAILY_UNIT_DEAL_OFFERS,updateData:k.PREMIUM_DAILY_UNIT_DEAL_REROLLED,acceptedOffer:k.PREMIUM_DAILY_UNIT_DEAL_ACCEPTED,updateResources:k.VILLAGE_RESOURCES_CHANGED},methods:{getData:J,buyItem:K,buyReroll:L},textObjects:{view:"building_barracks",data:"unit_names"},costs:{slot:F.getPremiumCostsForType(s.DAILY_UNIT_SLOT),reroll:F.getPremiumCostsForType(s.DAILY_UNIT_REROLL)}},H()),Y()},h.onKeypress=function(){B=!0},h.onFocus=function(){var a=h.selectedUnitName,b=c.toValidInteger(h.unitsToRecruit[a]),d=b.bound(0,h.maxRecruitable[a]);0===d&&(h.unitsToRecruit[a]=""),h.justFocused=!0},h.onBlur=function(){var a=h.selectedUnitName;""===h.unitsToRecruit[a]&&(h.unitsToRecruit[a]=0)},h.onKeyup=function(){if(h.justFocused)return void(h.justFocused=!1);B=!1;var a=h.selectedUnitName,b=c.toValidInteger(h.unitsToRecruit[a]),d=b.bound(0,h.maxRecruitable[a]),e=N();h.unitsToRecruit[a]=d.toString().replace(/^0+/,""),P(),e.value=h.unitsToRecruit[a]},h.$on("$destroy",function(){a.$broadcast(k.TIMELINE_RECRUITING_PREVIEW,!1),z.clearTemporaryBarracksCosts()}),h.$on(k.RESOURCES,function(b,c){if(!B){var d,e,f,g=h.unitData,i=g.length;for(h.computedResources=c,h.hasUnits=!1,f=0;i>f;f++)e=g[f].name,g[f].available?(h.hasUnits=!0,h.unitsToRecruit.hasOwnProperty(e)||(h.unitsToRecruit[e]=0),h.maxRecruitable[e]=l.calculateMaxRecruitable(e,(+h.unitsToRecruit[e]).bound(0,+h.maxRecruitable[e]))):delete h.maxRecruitable[e];d=N(),d&&(d.enabled=h.hasUnits,d.enabled&&(O(),a.$$phase||a.$apply()))}}),h.instantRecruitEnabled=o.isInstantRecruitEnabled(),h.secondQueueJobEnabled=o.isSecondQueueJobEnabled(),h.addSecondQueueJob=X,h.isAddSecondQueueJobPossible=o.isAddSecondQueueJobPossible,h.statueService=v,h.academyService=w,h.pendingJobConfirmations=[],h.instantRecruit=W,h.getJobIndex=R,h.$on(k.UNIT_RECRUIT_JOB_FINISHED,Z),h.$on(k.INVENTORY_ITEM_CHANGED,H),h.$on(k.EFFECT_CHANGED,Y),h.$on(k.EFFECT_EXPIRED,Y),h.init()}])}),define("controllers/building/BuildingRallyPointController",["app","angular"],function(a,b){a.controller("BuildingRallyPointController",["$rootScope","$scope","$filter","modelDataService","recruitingService","presetListService","presetService","storageService","eventTypeProvider","errorTypeProvider","windowManagerService",function(a,c,d,e,f,g,h,i,j,k,l){var m=e.getPlayer(),n=m.getSelectedCharacter(),o=function(){var a,b;for(a in c.presets)b=f.calculatePreset(c.presets[a],c.unitInfo.units),c.completed[a]=b.completed,c.progress[a]=b.progress,c.total[a]=b.total,c.missing[a]=b.missingUnits;c.presetslength=Object.keys(c.presets).length},p=function(a){h.showPresetUnassignModal(a)},q=function(a){c.officer=a},r=function(b,c){var e,f=a.$new(),g="modal_cannot_recruit",h=c.details,i=0;for(e in h)i++,f["text_p_"+i]=h[e];f.title=d("i18n")("title",a.loc.ale,g),f.submitText=d("i18n")("OK",a.loc.ale),f.submit=function(){f.closeWindow()},l.getModal("modal_attention",f)},s=function(a){h.showPresetEditModal(b.copy(a))},t=function(){c.hotkeys=i.getItem(h.getStorageKey())};c.init=function(){c.building=e.getSelectedVillage().getBuildingData().getDataForBuilding("rally_point"),c.unitInfo=n.getSelectedVillage().getUnitInfo(),c.presets=g.getPresetsForVillageId(n.getSelectedVillage().getId()),c.hotkeys=i.getItem(h.getStorageKey())},c.$on(j.ARMY_PRESET_SAVED,t),c.$on(k.ARMY_PRESET_CANNOT_RECRUIT,r),c.$watch("unitInfo",o,!0),c.$watch("presets",o,!0),c.progress={},c.completed={},c.total={},c.missing={},c.createPreset=h.createPreset,c.showPresetListModal=h.showPresetListModal,c.recruitPreset=h.recruitPreset,c.showPresetInfoModal=h.showPresetInfoModal,c.showEditPresetModal=s,c.showPresetUnassignModal=p,c.officerOrder=e.getGameData().getOfficers(),c.setOfficerTooltip=q,c.init()}])}),define("controllers/building/BuildingMarketController",["app","helper/time"],function(a,b){a.controller("BuildingMarketController",["$rootScope","$scope","$filter","modelDataService","eventTypeProvider","tradingService","orderTypeProvider","windowManagerService","inventoryItemTypeProvider","premiumActionService","socketService","inventoryService","commandService","routeProvider","storageService",function(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q,r="market",s="npc",t={},u={},v={},w=!1,x={npcTrade:!0,create:!0,search:!0},y={busy:0,free:0,total:0,percent:0},z={withCart:48,withoutCart:5},A=1e3,B=function(a){c.activeTab=a,v[a].initFn&&v[a].initFn instanceof Function&&v[a].initFn()},C=function(a,b,d){c[a]=!1,0===c.tabData[b][d].offered_resource_amount&&(c[a]="no_offered_resource_amount"),c.tabData[b][d].wanted_resource===c.tabData[b][d].offered_resource&&(c[a]="different_resources"),c.resources&&0===c.resources[c.tabData[b][d].offered_resource].currentProduction&&(c[a]="resource_not_available"),0===y.free&&(c[a]="no_free_merchants")},D=function(){C("createOfferTooltip","offers","create")},E=function(){C("instantTradeTooltip","npc","trade")},F=function(a){var b=c.tabData[c.activeTab],d=b.order;v[c.activeTab].filter.offset=0,a===d.field?d.direction=h.toggle(d.direction):(d.field=a,d.direction=h.DEFAULT),v[c.activeTab].initFn()},G=function(a,b){y.busy=b.busy,y.free=b.free,y.total=b.total,y.percent=b.free/b.total*100,D(),E()},H=function(a,b){v[a].list.records=b.offers,v[a].pagination.count=b.total,v[a].pagination.offset=b.offset},I=function(a,b){v.offers.list.records.unshift(b),v.offers.initFn(),g.requestMerchantStatus()},J=function(a,b){"offers"===c.activeTab&&v.offers.initFn(),"market"===c.activeTab&&v.market.initFn(),delete t[b.offer_id],g.requestMerchantStatus()},K=function(a,b){for(var c,d=v.offers.list.records.length;d--;)if(c=v.offers.list.records[d],c.offer_id===b.offer_id)return v.offers.list.records.remove(d),void g.requestMerchantStatus()},L=function(b){var c=a.$new(),f="building_market_remove_offer",h=e.getSelectedVillage();c.title=d("i18n")("title",a.loc.ale,f),c.text=d("i18n")("text",a.loc.ale,f),c.submitText=d("i18n")("submitText",a.loc.ale,f),c.cancelText=d("i18n")("cancelText",a.loc.ale,f),c.submit=function(){g.deleteOffer(b.offer_id,h.getId()),c.closeWindow()},c.cancel=function(){c.closeWindow()},i.getModal("modal_attention",c)},M=function(a){n.openCancelCommandModal(a,"building_market_cancel_transport")},N=function(b,c){if(c){var e=a.$new(),f="building_market_accept_offer";e.title=d("i18n")("title",a.loc.ale,f),e.text=d("i18n")("text",a.loc.ale,f),e.submitText=d("i18n")("submitText",a.loc.ale,f),e.cancelText=d("i18n")("cancelText",a.loc.ale,f),e.submit=function(){g.acceptOffer(b.offer_id,c),e.closeWindow()},e.cancel=function(){e.closeWindow()},i.getModal("modal_attention",e)}},O=function(a){return parseInt(a,10).bound(u.min,u.max)},P=function(a){return a*b.inS.hour},Q=function(){var a=v.offers.create;a.offered_amount&&a.wanted_resource!==a.offered_resource&&(a.wanted_resource_amount=a.offered_resource_amount,g.createOffer(a.offered_resource,a.offered_resource_amount,a.wanted_resource,a.wanted_resource_amount,a.offered_amount,P(a.delivery_time),function(){v.offers.create.offered_resource_amount=0,v.offers.create.wanted_resource_amount=0,v.offers.create.offered_amount=0,v.offers.create.delivery_time=u.min}))},R=function(a){var b=q[a.requested_resource].realCurrentProduction,c=y.free*A,d=Math.min(c,b),e=Math.floor(d/a.requested_resource_amount).bound(0,a.offer_amount),f=t[a.offer_id];f||(f=t[a.offer_id]={}),f.maxOfferAmount=e,f.inputValue=(parseInt(f.inputValue,10)||1).bound(1,e),0===e?f.reason=b>c?"merchants":"resource":delete f.reason},S=function(a,b){var d,e=v.offers.create,f=v.npc.trade,g=b[e.offered_resource].realCurrentProduction,h=y.free*A,i=0,j=0,k=0;c.resources=b,q=b,i=Math.min(h,g),e.max_offered_resource_amount=~~i,f.max_offered_resource_amount=~~b[v.npc.trade.offered_resource].realCurrentProduction,e.offered_resource_amount?(""!==e.offered_amount&&(e.offered_amount=Math.max(1,e.offered_amount)),e.min_offered_amount=1,j=Math.ceil(e.offered_resource_amount/A),e.max_offered_amount=Math.min(y.free,g/A,Math.floor(y.free/j)),d=e.offered_resource_amount*e.offered_amount,k=e.max_offered_resource_amount,k=k*e.max_offered_amount>h?i/e.offered_amount:i,e.max_offered_resource_amount=Math.floor(k),e.offered_resource_amount*e.max_offered_amount>g&&(e.max_offered_amount=Math.floor(g/e.offered_resource_amount))):(e.min_offered_amount=0,e.max_offered_amount=0,""!==e.offered_amount&&(e.offered_amount=0)),v.market.list.records.forEach(R),D(),E()},T=function(){var a=v.npc.trade;return""===a.offered_resource_amount?void(a.wanted_resource_amount=""):""===a.wanted_resource_amount?void(a.offered_resource_amount=""):(a.offered_resource_amount=(a.wanted_resource_amount*v.npc.instant_trade_ratio).bound(0,a.max_offered_resource_amount),void(a.wanted_resource_amount=parseInt(a.wanted_resource_amount,10).bound(0,Math.round(a.max_offered_resource_amount/v.npc.instant_trade_ratio))))},U=function(){var a=v.npc.trade;return""===a.offered_resource_amount?void(a.wanted_resource_amount=""):void(a.wanted_resource_amount=Math.round(a.offered_resource_amount*v.npc.instant_trade_ratio))},V=function(){var a=v.market.filter;(a.wanted_resource!==a.offered_resource||"any"===a.wanted_resource)&&v.market.initFn()},W=function(){var a=v.npc,b=c.inventory[j.TRADE],d=a.trade;d.offered_resource_amount&&d.wanted_resource!==d.offered_resource&&(c.instantTradeStarted=!0,b&&b.amount?m.useItem(b,function(){l.emit(o.PREMIUM_INSTANT_TRADE,{village_id:e.getSelectedVillage().getId(),resource_pay:d.offered_resource,resource_get:d.wanted_resource,amount:d.offered_resource_amount})}):k.instantTrade(a.instant_trade_premium_costs,d.wanted_resource,d.offered_resource,d.offered_resource_amount))},X=function(){var a=1,b=c.building.researches.cart.active;g.requestMerchantStatus(),void 0===v.npc&&(u.min=1,v.npc={instant_trade_ratio:a,instant_trade_premium_costs:0,trade:{offered_resource:"wood",offered_resource_amount:0,max_offered_resource_amount:100,wanted_resource:"clay",wanted_resource_amount:0},list:{records:[]},order:{field:"transport_id",direction:h.DESC},filter:{},pagination:{count:0,offset:0,limit:p.getPaginationLimit()}},v.offers={create:{offered_resource:"wood",offered_resource_amount:0,max_offered_resource_amount:100,wanted_resource:"clay",wanted_resource_amount:0,min_wanted_resource_amount:0,max_wanted_resource_amount:0,offered_amount:0,min_offered_amount:0,max_offered_amount:0,delivery_time:u.min,min_delivery_time:u.min},list:{records:[]},order:{field:"offered_resource_amount",direction:h.DESC},filter:{offered_resource:"wood"},pagination:{count:0,offset:0,limit:p.getPaginationLimit()}},v.market={list:{records:[]},order:{field:"requested_resource_amount",direction:h.DESC},filter:{wanted_resource:"any",offered_resource:"any",tribe:!1,ratio:a,min_delivery_time:u.min},pagination:{count:0,offset:0,limit:p.getPaginationLimit()}},v.npc.pagination.loader=v.npc.initFn=function(){var a=e.getSelectedVillage(),b=a.getTradeListModel();b&&(v.npc.list.records=b.getModels()),v.npc.instant_trade_ratio=e.getGameData().getInstantTradeRatio(),v.npc.instant_trade_premium_costs=e.getGameData().getPremiumCostsForType(j.TRADE)},v.offers.pagination.loader=v.offers.initFn=function(){var a=c.tabData.offers,b=(a.filter,a.order),d=a.pagination;g.fetchOffers(b.field,b.direction,d.offset,d.limit,{ownOffers:!0,callback:function(a){H("offers",a)}})},v.market.pagination.loader=v.market.initFn=function(){var a=c.tabData.market,b=a.filter,d=a.order,e=a.pagination;g.fetchOffers(d.field,d.direction,e.offset,e.limit,{requestedResource:"any"===b.wanted_resource?null:b.wanted_resource,offeredResource:"any"===b.offered_resource?null:b.offered_resource,ownTribe:b.tribe,maxDeliveryTime:P(b.delivery_time),callback:function(a){a.offers.forEach(R),H("market",a)}})}),u.max=z[b?"withCart":"withoutCart"],v.offers.create.max_delivery_time=u.max,v.market.filter.delivery_time=u.max,v.market.filter.max_delivery_time=u.max,B(c.activeTab)},Y=function(){var a=e.getSelectedVillage(),b=a.getBuildingData(),d=b.getDataForBuilding(r);c.building=d,c.villageId=e.getSelectedVillage().getId(),X()},Z=function(a,b){"market"===b.building&&b.village_id===e.getSelectedVillage().getId()&&X()},$=function(a,b){"market"===b.building_type&&b.village_id===e.getSelectedVillage().getId()&&X()},_=function(){c.instantTradeStarted=!1},aa=function(a){k.instantTransport(a.id)},ba=function(a,b){0===a[b]&&(a[b]="")},ca=function(a,b){""===a[b]&&(a[b]=0)};c.orderTypeProvider=h,c.activeTab=s,c.tabData=v,c.sections=x,c.merchantStatus=y,c.acceptableOffers=t,c.instantTradeStarted=w,c.createOfferTooltip="",c.setActiveTab=B,c.deleteOffer=L,c.acceptOffer=N,c.setOrder=F,c.boundTime=O,c.createOffer=Q,c.refreshMarketResults=V,c.openCancelCommandModal=M,c.isCancelable=n.isCancelable,c.changeAcceptOfferAmount=R,c.instantTrade=W,c.inventory=e.getInventory().getInventoryItemReference(),c.tradeItemKey=j.TRADE,c.instantTransport=aa,c.onFocus=ba,c.onBlur=ca,c.$on(f.RESOURCES,S),c.$on(f.TRADING_MERCHANT_STATUS,G),c.$on(f.TRADING_OFFER_CREATED,I),c.$on(f.TRADING_OFFER_REMOVED,K),c.$on(f.TRADING_OFFER_ACCEPTED,J),c.$on(f.TRADING_TRANSPORT_NEW,g.requestMerchantStatus),c.$on(f.TRADING_TRANSPORT_RETURNED,g.requestMerchantStatus),c.$on(f.BUILDING_LEVEL_CHANGED,Z),c.$on(f.PREMIUM_INSTANT_TRADED,_),c.$on(f.RESEARCH_UNLOCKED,$),c.$watch("tabData.npc.trade.wanted_resource_amount",T),c.$watch("tabData.npc.trade.offered_resource_amount",U),c.$watch("tabData.offers.create.offered_resource_amount",D),c.$watch("tabData.offers.create.wanted_resource",D),c.$watch("tabData.offers.create.offered_resource",D),c.$watch("tabData.offers.create.offered_resource_amount",E),c.$watch("tabData.offers.create.wanted_resource",E),c.$watch("tabData.offers.create.offered_resource",E),c.init=Y,Y()}])}),define("controllers/building/BuildingTavernController",["app","helper/time","conf/effectTypes","conf/tribeSkillNames"],function(a,b,c,d){a.controller("BuildingTavernController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","windowManagerService","eventTypeProvider","reportService","effectService",function(a,e,f,g,h,i,j,k,l,m){var n,o,p,q,r,s="tavern",t=!1,u=g.getTribeSkills(),v=function(){return["camouflage","switch_weapons","dummies","exchange"]},w=function(){var a,b=v(),c={};for(a in e.building.researches)b.indexOf(a)>-1&&(c[a]=e.building.researches[a]);return c},x=function(){return Object.keys(w()).length+1},y=function(){var a,b=v(),c=e.building.researches,d=0;for(a in c)b.indexOf(a)>-1&&(c[a].unlocked||c[a].researched)&&d++;return d},z=function(){if(!e.recruitableSpy)return!1;var a=y(),b=e.recruitableSpy.id;return a>=b-1},A=function(){var a,b,c;for(a=0;a<e.spySlots.length;a++){c=e.spySlots[a],c.affordable=!0;for(b in q)if("food"!==q[b]&&q[b]<e.spyCosts[c.id-1][b]){c.affordable=!1;break}}},B=function(){var a,b,c=y()+1;for(a=0;a<e.spySlots.length;a++)b=e.spySlots[a],0!==b.type&&(b.active=!0,c--);for(a=0;a<e.spySlots.length;a++)b=e.spySlots[a],b.type>0||(c>0||b.tavernLevelReached?(b.active=!0,c--):b.locked=!0)},C=function(){e.spySlots.sort(function(a,b){return a.unlockLevel-b.unlockLevel})},D=function(){var a,b;for(a=0;a<e.spySlots.length;a++)if(b=e.spySlots[a],0===b.type&&b.active)return void(e.recruitableSpy=b);delete e.recruitableSpy},E=function(){var a,c,d,f,g,h=.001*Date.now();if(e.spyData){if(e.spyData.time_completed){if(d=e.spyData.time_completed-e.spyData.time_started,e.finishedIn=e.spyData.time_completed-h,e.finishedIn<0)return void(e.finishedIn=0);e.percentCompleted=Math.round(100*(1-e.finishedIn/d))}if(e.spyData.commands)for(a=0;a<e.spyData.commands.length;a++)for(f=e.spyData.commands[a],c=0;c<e.maxSpies;c++)g=e.commands[c],g||(g=e.commands[c]={}),0!==f["spy_"+(c+1)]&&(g.direction="back"===f.direction?"return":"outgoing",g.arrivalIn=b.readableSeconds(b.server2ClientTimeInSeconds(f.time_completed-h)))}},F=function(b,c){var d,f,h,i,j=[],k=g.getSelectedVillage(),l=!1,m=e.building.level;if(e.hasSpiesInQueue=!1,c.id===k.getId()){e.spyData=c,e.spySlots=[],e.maxSpies=x();for(d in e.building.researches)j.push(e.building.researches[d].required_level);for(d=1;d<=e.maxSpies;d++)i=j[d-2]||0,2!==c["spy_"+d]||e.hasSpiesInQueue?l=!1:(l=!0,e.hasSpiesInQueue=!0),e.spySlots.push({id:d,destroyed:!1,locked:!1,active:!1,affordable:!0,trained:d===c.spy_production,unlockLevel:i,tavernLevelReached:m>=i,type:c["spy_"+d],currentRecruit:l});B(),A(),C(),D();for(d in e.technologies)switch(e.technologies[d].enabled=0===c[d+"_enabled"]?!1:!0,e.building.researches[d].active||(e.technologies[d].enabled=!1),d){case"camouflage":e.technologies[d].building=c[d+"_building"],e.technologies[d].level=c[d+"_level"],h=k.getBuildingData().data[e.technologies[d].building],e.technologies[d].real_level=h?h.level:0;break;case"dummies":e.technologies[d].unit=c[d+"_unit"],f=n.getUnit(e.technologies[d].unit),e.technologies[d].amount=f?~~(q.food/f.food):0;break;case"switch_weapons":e.technologies[d].unit=c[d+"_unit"],e.technologies[d].replacement=c[d+"_replacement"]}E(),t=!1,a.$$phase||e.$digest()}},G=function(){t||(t=!0,h.emit(i.SCOUTING_GET_INFO,{village_id:g.getSelectedVillage().getId()}))},H=function(a,b){b.type===l.BATTLE_TYPES.scouting&&G()},I=function(){var a,b,c={},d=0;for(a in e.building.researches)b=e.building.researches[a],b.unlocked&&(d+=3,c[b.required_level]=!0);return e.recruitableSpy.affordable&&(e.recruitableSpy.tavernLevelReached||c[e.recruitableSpy.unlockLevel]||d>=e.recruitableSpy.unlockLevel)&&z()},J=function(){I()&&h.emit(i.SCOUTING_RECRUIT,{village_id:g.getSelectedVillage().getId(),slot:e.recruitableSpy.id})},K=function(b){var c=a.$new(),d="cancel_spy_recruit_job";c.title=f("i18n")("title",a.loc.ale,d),c.text=f("i18n")("text",a.loc.ale,d),c.submitText=f("i18n")("submitText",a.loc.ale,d),c.cancelText=f("i18n")("cancelText",a.loc.ale,d),c.switchColors=!0,c.submit=function(){h.emit(i.SCOUTING_CANCEL_RECRUIT,{village_id:g.getSelectedVillage().getId(),slot:b}),c.closeWindow()},c.cancel=function(){c.closeWindow()},j.getModal("modal_attention",c)},L=function(a){var b={camouflage:"building",dummies:"unit",switch_weapons:"unit"};return void 0===b[a]?!0:0!==e.technologies[a][b[a]].length},M=function(a){L(a)&&h.emit(i.SCOUTING_SET_COUNTER_MEASURE,{village_id:g.getSelectedVillage().getId(),type:a,status:e.technologies[a].enabled,building:e.technologies[a].building||"",level:e.technologies[a].level||"",unit:e.technologies[a].unit||"",replacement:e.technologies[a].replacement||""})},N=function(a){a.buildings=g.getSelectedVillage().getBuildingData().data,a.selectedBuilding=e.technologies.camouflage.building,a.realLevel=0,a.rangeSlider={min:0,max:p[e.technologies.camouflage.building]?p[e.technologies.camouflage.building].max_level:0,value:e.technologies.camouflage.level},a.selectBuilding=function(b){a.selectedBuilding=b,a.rangeSlider.max=p[b].max_level,a.rangeSlider.value=0,a.realLevel=a.buildings[b].level},p[e.technologies.camouflage.building]&&a.selectBuilding(e.technologies.camouflage.building)},O=function(a){a.units=e.units,a.unitOrder=n.getOrderedUnitNames(),a.selectedWeaponsUnit=e.technologies.switch_weapons.unit,a.selectedWeaponsReplacement=e.technologies.switch_weapons.replacement,a.selectWeaponsUnit=function(b){a.selectedWeaponsUnit=b},a.selectWeaponsReplacement=function(b){a.selectedWeaponsReplacement=b}},P=function(a){var b=n.getUnit(e.technologies.dummies.unit);a.unitOrder=n.getOrderedUnitNames(),a.selectedUnit=e.technologies.dummies.unit,a.amount=b?~~(q.food/b.food):0,a.selectUnit=function(c){a.selectedUnit=c,b=n.getUnit(a.selectedUnit),a.amount=~~(q.food/b.food)}},Q=function(b){var c=a.$new(),d="modal_technology_"+b;if(e.building.researches[b].active){switch(b){case"camouflage":N(c);break;case"switch_weapons":O(c);break;case"dummies":P(c)}c.title=f("i18n")("title",a.loc.ale,d),c.save=function(){e.technologies[b].building=c.selectedBuilding,e.technologies[b].level=c.rangeSlider?c.rangeSlider.value:"",e.technologies[b].real_level=c.realLevel||"",e.technologies[b].unit=c.selectedUnit||c.selectedWeaponsUnit||"",e.technologies[b].replacement=c.selectedWeaponsReplacement||"",c.selectedUnit&&(e.technologies[b].amount=c.amount),c.closeWindow(),M(b)},j.getModal("modal_technology_"+b,c)}},R=function(a){e.counter_measure=a},S=function(a){e.technologies[a]&&null!==e.technologies[a].enabled&&e.building.researches[a]&&e.building.researches[a].active&&(L(a)?M(a):(e.technologies[a].enabled=!1,Q(a)))},T=function(){var a,b,c=[],d=w(),e=v();for(a=0;a<e.length;a++)b=e[a],d[b].type=b,c.push(d[b]);return c},U=function(){e.increasedDefenseEffect=m.getEffect(c.INCREASE_SPY_DEFENSE),e.increasedDefenseEffect&&u&&(e.hasActiveTribeSkill=u.isSkillActive(d.better_spy_defense))},V=function(){n=g.getGameData(),o=g.getWorldConfig(),p=n.getBuildings(),q=window.angular.copy(g.getSelectedVillage().getResources().data.resources),r=n.getUnit,e.worldSpeed=o.getSpeed(),e.spyCosts=o.getAllSpyCosts(),e.building=g.getSelectedVillage().getBuildingData().getDataForBuilding(s),e.resourceOrder=g.getGameData().getResourceNames(),e.units=g.getSelectedVillage().getUnitInfo().units,e.counterMeasures=T(),e.commands={},e.resources=q,e.technologies={camouflage:{enabled:null,building:"",level:""},dummies:{enabled:null,unit:""},switch_weapons:{enabled:null,unit:"",replacement:""},exchange:{enabled:null}},G(),U(),b.timer.remove(E),b.timer.add(E)};e.init=V,e.recruitNextSpy=J,e.cancelRecruiting=K,e.setTechnology=S,e.setTechnologyOptions=Q,e.setTooltip=R,e.canRecruitNextSpy=I,e.spySlots=[],e.$on(k.SCOUTING_CANCELLED,G),e.$on(k.SCOUTING_RECRUITING_STARTED,G),e.$on(k.SCOUTING_RECRUITING_CANCELED,G),e.$on(k.SCOUTING_SENT,G),e.$on(k.SCOUTING_SPY_PRODUCED,G),e.$on(k.SCOUTING_COUNTER_MEASURE_SET,G),e.$on(k.SCOUTING_INFO,F),e.$on(k.REPORT_NEW,H),e.$on(k.EFFECT_CHANGED,U),e.$on(k.EFFECT_EXPIRED,U),e.$watch("building.researches",G,!0),e.$on(k.RESOURCES,function(a,b){var c;for(c=0;c<e.resourceOrder.length;c++)q[e.resourceOrder[c]]=b[e.resourceOrder[c]].currentProduction;A(),D()}),e.$on("$destroy",function(){b.timer.remove(E)}),e.init()}])}),define("controllers/building/BuildingStatueController",["app","helper/time"],function(a,b){a.controller("BuildingStatueController",["$rootScope","$scope","$filter","modelDataService","windowManagerService","windowDisplayService","eventTypeProvider","socketService","routeProvider","modalSharedUnitInfoDataService","premiumActionService","inventoryItemTypeProvider","mapService","statueService",function(a,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=3,q=32,r="statue",s=["tab_paladin","tab_weapons"],t=function(a){if(-1===s.indexOf(a))throw new Error("No such tab "+a);c.activeTab=a},u=function(){var a=c.$new();a.name=c.data.name,a.confirm=function(){a.name.length<p||a.name.length>q||(i.emit(j.PALADIN_RENAME,{name:a.name}),a.closeWindow())},f.getModal("modal_rename_paladin",a)},v=function(a,b){var d=c.$new();d.item=c.data.items[a],d.type=a,d.equipPaladinItem=b&&function(){c.equipPaladinItem(a),d.closeWindow()},d.noblemanEffect=e.getGameData().getNoblemanEffect(),d.premiumCosts=e.getGameData().getPaladinWeaponPremiumCosts(a,d.item.level),d.$on(h.PALADIN_UNLOCK_NEXT_ITEM,function(b,c){c.item===a&&c.next_level&&(d.premiumCosts=e.getGameData().getPaladinWeaponPremiumCosts(a,d.item.level))}),d.upgradePaladinItem=function(){c.upgradePaladinItem(a,d.item.level),d.closeWindow()},d.close=function(){d.closeWindow()},f.getModal("modal_item_info",d)},w=function(){k.setUnitName("knight"),f.getModal("modal_unit_info")},x=function(){i.emit(j.STATUE_RECRUIT,{village_id:e.getSelectedVillage().getId(),unit_type:"knight",amount:1})},y=function(){o.cancelRecruitPaladin(c.paladin,c.data.home_village_id)},z=function(){var b=c.$new();b.title=d("i18n")("relocate_cancel_title",a.loc.ale,c.textObject),b.text=d("i18n")("relocate_cancel_text",a.loc.ale,c.textObject),b.submitText=d("i18n")("relocate_cancel_submit",a.loc.ale,c.textObject),b.cancelText=d("i18n")("relocate_cancel_cancel",a.loc.ale,c.textObject),b.switchColors=!0,b.submit=function(){i.emit(j.COMMAND_CANCEL,{command_id:c.paladin.job_id}),b.closeWindow()},b.cancel=function(){b.closeWindow()},f.getModal("modal_attention",b)},A=function(){if(e.getSelectedVillage().getId()!==c.data.home_village_id&&c.data.can_relocate){var b=e.getSelectedVillage().getName(),d=a.$new();d.villageName=b,d.premiumCosts=c.relocatePremiumCosts,d.premiumPaladinInstantRelocateItem=c.premiumPaladinInstantRelocateItem,d.relocate=function(){i.emit(j.PALADIN_RELOCATE,{village_id:e.getSelectedVillage().getId()}),d.closeWindow()},d.close=function(){d.closeWindow()},f.getModal("modal_relocate_paladin",d)}},B=function(a){a!==c.data.equipped_item&&i.emit(j.PALADIN_EQUIP_ITEM,{item:a})},C=function(a,b){l.paladinUpgradeWeapon(a,b)},D=function(){var a=c.paladin.village.getPosition();n.jumpToVillage(a.x,a.y)},E=function S(){if(c.recruitPaladin){var a=c.paladin.time_completed-c.paladin.start_time,d=.001*(Date.now()-b.server2ClientTime(c.paladin.start_time));c.paladin.finishedIn=a-d,c.paladin.percent=~~(d/a*100).bound(0,100),c.paladin.finishedIn<0&&c.movePaladin&&(b.timer.remove(S),c.init())}},F=function(){var a,b,d=e.getGameData().getOrderedUnitNames();for(c.sortedItems=[],a=0;a<d.length;a++)b=c.data.items[d[a]],b&&(b.name=d[a],c.sortedItems.push(b))},G=function(){o.recruitPaladinWithPremium(c.data)},H=function(a,d){var f,g,h;c.recruitPaladin=!0,c.noPaladin=!1,c.paladin={},c.paladin.start_time=d.start_time,c.paladin.time_completed=d.time_completed,c.paladin.job_id=d.job_id,d.target&&d.target.id?h=e.getSelectedCharacter().getVillage(d.target.id):c.data&&c.data.home_village_id?h=e.getSelectedCharacter().getVillage(c.data.home_village_id):(h=e.getSelectedVillage(),c.data.home_village_id=h.getId()),c.paladin.village=h,b.timer.add(E),f=c.paladin.time_completed-c.paladin.start_time,g=(Date.now()-b.server2ClientTime(c.paladin.start_time))/1e3,c.paladin.finishedIn=f-g,c.paladin.percent=~~(g/f*100).bound(0,100)},I=function(a,b){if("relocate"===b.type){var d={job_id:b.id,start_time:b.time_start,time_completed:b.time_completed,target:b.target};c.movePaladin=!0,H(null,d)}},J=function(a,b){c.recruitPaladin=!1,c.noPaladin=!1,c.data=b,b.home_village_id?(c.paladin||(c.paladin={}),c.paladin.village=e.getSelectedCharacter().getVillage(b.home_village_id),b.recruit_job?(b.recruit_job.start_time=b.recruit_job.time_started,H(null,b.recruit_job)):b.relocate_command&&I(null,b.relocate_command)):(c.noPaladin=!0,c.recruitPaladin=!1),F()},K=function(a,b){var c,d=b.commands;for(c in d)d.hasOwnProperty(c)&&I(null,d[c])},L=function(a,b){c.data.name=b.name},M=function(a,d){c.recruitPaladin=!1,c.noPaladin=!0,b.timer.remove(E)},N=function(a,b){c.paladin.village=e.getSelectedCharacter().getVillage(b.village_id),c.data.home_village_id=b.village_id,c.data.can_relocate=!0,c.movePaladin=!1,c.recruitPaladin=!1,c.noPaladin=!1},O=function(a,b){c.data.items[b.item].level=b.level,c.data.items[b.item].bonus=b.bonus,c.data.items[b.item].next_level=b.next_level,c.data.items[b.item].progress=b.progress},P=function(a,b){c.data.equipped_item=b.item},Q=function(a,b){c.recruitPaladin=!1},R=function(){c.premiumPaladinInstantItem=e.getInventory().getItemByType("premium_paladin_instant_item"),c.premiumPaladinInstantRelocateItem=e.getInventory().getItemByType("premium_paladin_relocate")};c.init=function(){i.emit(j.PALADIN_GET_INFO,{}),c.building=e.getSelectedVillage().getBuildingData().getDataForBuilding(r),c.selectedVillageId=e.getSelectedVillage().getId(),c.movePaladin=!1,R()},c.$on(h.PALADIN_INFO,J),c.$on(h.PALADIN_RELOCATED,N),c.$on(h.COMMAND_RELOCATED,N),c.$on(h.COMMAND_SENT,I),
c.$on(h.COMMAND_OWN_COMMANDS,K),c.$on(h.PALADIN_RENAMED,L),c.$on(h.PALADIN_UNLOCK_NEXT_ITEM,O),c.$on(h.PALADIN_ITEM_EQUIPPED,P),c.$on(h.STATUE_RECRUIT_JOB_CREATED,H),c.$on(h.UNIT_RECRUIT_JOB_FINISHED,c.init),c.$on(h.PALADIN_SUMMONED,c.init),c.$on(h.STATUE_RECRUIT_JOB_CANCELED,M),c.$on(h.INVENTORY_ITEM_CHANGED,R),c.$on(h.STATUE_RECRUIT_JOB_FINISHED,Q),c.tabs=s,c.recruitPaladinTime=null,c.activeTab=s[0],c.premiumCosts=e.getGameData().getPaladinInstantRecruitPremiumCosts(),c.relocatePremiumCosts=e.getGameData().getPremiumCostsForType(m.PALADIN_RELOCATE),c.inventory=e.getInventory().getInventoryItemReference(),c.MIN_NAME_LENGTH=p,c.MAX_NAME_LENGTH=q,c.setActiveTab=t,c.startRecruitPaladin=x,c.cancelRecruitPaladin=y,c.cancelRelocatePaladin=z,c.relocatePaladin=A,c.recruitPaladinWithPremium=G,c.renamePaladin=u,c.equipPaladinItem=B,c.upgradePaladinItem=C,c.showItemInfo=v,c.jumpToVillage=D,c.openVillageInfo=g.openVillageInfo,c.showUnitInfoModal=w,c.init(),c.$on("$destroy",function(){b.timer.remove(E)})}])}),define("controllers/building/BuildingHospitalController",["app","helper/time","conf/effectTypes","conf/tribeSkillNames"],function(a,b,c,d){a.controller("BuildingHospitalController",["$scope","modelDataService","socketService","reportService","routeProvider","eventTypeProvider","effectService",function(a,e,f,g,h,i,j){var k,l="hospital",m=!1,n=e.getGameData().getHospitalHealingDuration()/e.getWorldConfig().getSpeed(),o=e.getTribeSkills(),p={},q=function(a){var b=e.getSelectedVillage().getId();a.finishedIn>0||f.emit(h.HOSPITAL_RELEASE_PATIENT,{village_id:b,patient_id:a.id})},r=function(){var b,c;for(a.all={spear:0,sword:0,axe:0,archer:0,light_cavalry:0,mounted_archer:0,heavy_cavalry:0},b=0;b<a.data.patients.length;b++)for(c in a.all)a.data.patients[b].hasOwnProperty(c)&&(a.all[c]+=a.data.patients[b][c])},s=function(b){a.data=b,r(),m=!1},t=function(b,c){var d;for(d in a.data.patients)if(a.data.patients[d].id===c.id){a.data.patients.remove(d);break}a.data.beds_in_use-=c.beds,r()},u=function(b,c){var d;for(d in a.data.patients)if(a.data.patients[d].id===c.patient_id){a.data.patients[d].healed=!0;break}},v=function(){if(!m){m=!0;var a=e.getSelectedVillage().getId();f.emit(h.HOSPITAL_GET_PATIENTS,{village_id:a},s)}},w=function(){var c,d,e;if(a.data&&a.data.patients)for(c in a.data.patients)d=a.data.patients[c],e=.001*(Date.now()-b.server2ClientTime(d.start_time)),d.finishedIn=d.healed?0:n-e,d.percent=d.healed?100:~~(e/n*100).bound(0,100)},x=function(a,b){p[b.id]=b,k===b.id&&g.openReportWithData(b)},y=function(a){void 0===p[a]&&(p[a]=!1,g.getReport(a,function(b){b.error_code&&(p[a]=null)}))},z=function(a){a&&(k=a,void 0===p[a]?y(a):p[a]&&x(void 0,p[a]))},A=function(a){return null===a||p[a]===!1||null===p[a]},B=function(a){return null===a||null===p[a]?"patient_without_report":p[a]===!1?"patient_loading_report":"patient_open_report"},C=function(){a.extraBedsEffect=j.getEffect(c.EXTRA_HOSPITAL_BEDS),a.extraBedsEffect&&o&&(a.hasActiveTribeSkill=o.isSkillActive(d.better_hospital))},D=function(){var b=e.getSelectedVillage();a.building=b.getBuildingData().getDataForBuilding(l),a.upgradeVeterinary=a.building.researches.veterinary,v(),C()};a.useReport=z,a.isReportDisabled=A,a.getReportTooltip=B,a.releasePatient=q,a.init=D,a.min=Math.min,a.init(),b.timer.add(w),a.$on(i.HOSPITAL_PATIENT_RELEASED,t),a.$on(i.HOSPITAL_PATIENT_HEALED,u),a.$on(i.REPORT_VIEW,x),a.$on(i.EFFECT_CHANGED,C),a.$on(i.EFFECT_EXPIRED,C),a.$on("$destroy",function(){b.timer.remove(w)})}])}),define("controllers/building/BuildingResourcesController",["app","conf/effectTypes"],function(a,b){a.controller("BuildingResourcesController",["$scope","$filter","eventTypeProvider","modelDataService","inventoryItemTypeProvider","inventoryService","premiumActionService","villageService","socketService","routeProvider","effectService","boostsService",function(a,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,q=e.getGameData().getResourceTypes(),r=604800,s=1.2,t=e.getInventory().getInventoryItemReference(),u=function(b,d){var f,g,h,i=0;for(d&&(a.baseValue=d[a.resourceType].current_level.basic_production*e.getWorldConfig().getSpeed()),a.tooltip=c("number")(a.baseValue),h=0;h<a.boosts.length;h++)a.boosts[h].active&&(f=a.boosts[h].active.details.factor,g=Math.round(a.baseValue*(f-1)),i+=g,a.tooltip+=" + "+c("number")(g));a.boostedValue=a.baseValue+i,a.tooltip+=" = "+c("number")(a.boostedValue)},v=function(b,c){c.building===a.resourceType&&a.init()},w=function(b){var c=b.item;return c&&c.amount?void g.useItem(c,function(){j.emit(k.PREMIUM_USE_ITEM,{village_id:e.getSelectedVillage().getId(),item_id:c.id})}):void(b.defaultBoost?h.boostProduction(a.itemType):h.buyBoost(b))},x=function(c,d){m.updateBoosts(d,a.boosts,b.RESOURCE_PRODUCTION_INCREASE),d.type===b.RESOURCE_PRODUCTION_INCREASE&&i.requestVillageResourceInfo(n.getId())},y=function(c,d){a.boosts=[],m.onPremiumOffers(a.boosts,d,{costs:e.getGameData().getPremiumCostsForType(a.itemType),content:{name:"premium_boost_"+p,type:"resource_production_increase",resource_type:p,factor:s,duration:r,scope:"village"},active:l.getEffectByResource(p),item:t[a.itemType]},b.RESOURCE_BOOST_STOCKPILE),u()},z=function(c,d){m.onItemChanged(d,a.boosts,b.RESOURCE_BOOST_STOCKPILE,a.itemType)},A=function(){switch(n=e.getSelectedVillage(),o=n.getBuildingData(),j.emit(k.PREMIUM_LIST_SHOP_OFFERS,{}),a.building=o.getDataForBuilding(a.resourceType),a.resourceType){case"timber_camp":a.itemType=f.BOOST_WOOD,p=q.WOOD;break;case"clay_pit":a.itemType=f.BOOST_CLAY,p=q.CLAY;break;case"iron_mine":a.itemType=f.BOOST_IRON,p=q.IRON}a.resourceName=p,x(null,{type:b.RESOURCE_PRODUCTION_INCREASE})};a.building=null,a.boosts=[],a.showPerHour=!0,a.init=A,a.activateBoost=w,a.$on(d.VILLAGE_RESOURCE_INFO,u),a.$on(d.BUILDING_LEVEL_CHANGED,v),a.$on(d.EFFECT_CHANGED,x),a.$on(d.EFFECT_EXPIRED,x),a.$on(d.PREMIUM_SHOP_OFFERS,y),a.$on(d.INVENTORY_ITEM_CHANGED,z),A()}])}),define("controllers/modal/ModalBuildingUpgradeController",["app","helper/time"],function(a,b){a.controller("ModalBuildingUpgradeController",["$scope","modelDataService","modalSharedBuildingUpgradeDataService","buildingService","eventTypeProvider",function(a,c,d,e,f){var g=d.getBuildingName(),h=function(b,c){a.computedResources=c};a.buildingName=g,a.building=c.getSelectedVillage().getBuildingData().getDataForBuilding(g),a.computedResources=null,a.$on(f.RESOURCES,h),b.timer.tick(),a.upgrade=function(b){e.upgradeBuilding(a.buildingName,b),a.closeWindow()}}])}),define("conf/rewardTypes",[],function(){return{reward_resources:"reward_resources",reward_resource_package:"reward_resource_package",reward_units:"reward_units",premium_officer_leader:"premium_officer_leader",premium_officer_loot_master:"premium_officer_loot_master",premium_officer_medic:"premium_officer_medic",premium_officer_bastard:"premium_officer_bastard",premium_officer_supporter:"premium_officer_supporter",premium_officer_scout:"premium_officer_scout",premium_boost_wood:"premium_boost_wood",premium_boost_clay:"premium_boost_clay",premium_boost_iron:"premium_boost_iron",premium_build_cost_reduction:"buildCostReduction",resource_deposit_reroll:"resource_deposit_reroll"}}),define("controllers/modal/ModalQuestLineController",["app","helper/i18n","cdn","conf/rewardTypes"],function(a,b,c,d){a.controller("ModalQuestLineController",["$rootScope","$scope","$filter","socketService","routeProvider","eventTypeProvider","modalSharedQuestLineDataService","windowManagerService","modelDataService","iconAnimationsService","armyService","rewardService",function(a,e,f,g,h,i,j,k,l,m,n,o){var p,q,r,s="/templates/directives/contentSliderItemViews/quest.html",t=function(){g.emit(h.QUEST_REFRESH_GOALS)},u=function(b){var c=e.$new();c.offer=b,c.offer.image=0,c.offer.amount=1,c.offer.name=f("i18n")("premium_package_no_name",a.loc.ale,"premium_items"),c.offer.description=f("i18n")("description_premium_package_quest_reward",a.loc.ale,"premium_items"),c.close=function(){c.closeWindow()},k.getModal("modal_packet_offer",c)},v=function(){var c=a.$new(),d=[e.questTreePrefix+"quest_line_"+e.data.questLineModel.getName(),"quest_"+e.data.questModel.getType()],g="quests_modal_goal_help_common",h=b.hasTranslation("help_1",d)?f("i18n")("help_1",a.loc.ale,d):null,i=b.hasTranslation("help_2",d)?f("i18n")("help_2",a.loc.ale,d):null,j=b.hasTranslation("help_3",d)?f("i18n")("help_3",a.loc.ale,d):null,l=b.hasTranslation("help_4",d)?f("i18n")("help_4",a.loc.ale,d):null,m=b.hasTranslation("help_5",d)?f("i18n")("help_5",a.loc.ale,d):null;c.title=f("i18n")("title",a.loc.ale,g),c.submitText=f("i18n")("submitText",a.loc.ale,g),c.text_p_1=h,c.text_p_2=i,c.text_p_3=j,c.text_p_4=l,c.text_p_5=m,c.showQuestionMarkIcon=!0,c.submit=function(){c.closeWindow()},k.getModal("modal_attention",c)},w=function(a,b){b===e.data.questLineModel.getName()&&e.closeWindow()},x=function(a,b){q=b},y=function(c){var d=[e.questTreePrefix+"quest_line_"+e.data.questLineModel.getName(),"quest_"+e.data.questModel.getType()];return b.hasTranslation(c,d)?f("i18n")(c,a.loc.ale,d):null},z=function(a){j.setSelectedQuestIndex(a),e.contentSlider.directive.centerItem(a),e.commandGoals=e.data.questModel.getCommandGoals(),r(),e.data.questModel.isRead()||g.emit(h.QUEST_MARK_READ,{quest_id:e.data.questModel.getId()})},A=function(){var a=e.data.questModel;return 1===p.getVillages().length||a.isClosed()?!1:a.hasGoalType("have_units")||a.hasGoalType("recruit_units")?!0:!1},B=function(a){var b=e.data.selectedQuestIndex;37===a.keyCode&&(b=Math.max(0,b-1)),39===a.keyCode&&(b=Math.min(e.data.questLineModel.getQuestModels().length-1,b+1)),b!==e.data.selectedQuestIndex&&z(b)},C=function(a,b){var c=a.map(o.getIconName);m.createAnimations(c,b)},D=function(a,b){var c,f,g,h,i,j=e.data.questLineModel.getFirstFinishableQuestIndex(),k=e.data.questModel.getRewards(),m=null;if(-1===j&&(j=e.data.questLineModel.getFirstSelectableQuestIndex()),k&&b.quest_id===e.data.questModel.getId()&&k&&k.length){for(i=l.getSelectedVillage().getResources().getMaxStorage(),f=0;f<k.length;f++)if(g=k[f],g.item_type===d.reward_resources){for(h in g.content)if(i-q[h].currentProduction<g.content[h]){c="resources";break}}else if(g.item_type===d.reward_units&&(m=n.calculateCost(g.content),q.food.currentProduction<m.food)){c="resources";break}C(k,c),z(j),delete e.data.questRewards}},E=function(){e.data.questRewards={id:e.data.questModel.getId(),rewards:e.data.questModel.getRewards()},g.emit(h.QUEST_FINISH_QUEST,{quest_id:e.data.questModel.getId(),village_id:l.getSelectedVillage().getId()})},F=function(){e.data.questModel.isFinishable()&&E()};r=function(){var a=j.getQuestLineModel(),b=j.getSelectedQuestIndex(),d=a.getQuestByIndex(b);p=l.getSelectedCharacter(),e.data.questLineModel=a,e.data.selectedQuestIndex=b,e.data.questModel=d,e.commandGoals=d.getCommandGoals(),e.questTreeName=j.getQuestTreeName(),e.questTreePrefix=j.getQuestTreePrefix(),e.questIcon=d.getIcon(),e.contentSlider||(e.contentSlider={items:a.getQuestModels(),itemView:c.getPath(s),onReady:function(){z(b)}})},e.selectQuest=z,e.finishQuest=F,e.showHelp=v,e.getIconName=o.getIconName,e.getDisplayedName=o.getDisplayedName,e.getDisplayedDescription=o.getDisplayedDescription,e.onKeyPress=B,e.refreshGoals=t,e.showSnapshotBox=A,e.openPremiumPackageModal=u,e.getTranslation=y,e.data={},e.commandGoals=[],e.questIcon=null,e.$on(i.RESOURCES,x),e.$on(i.QUESTS_QUEST_FINISHED,D),e.$on(i.QUESTS_QUEST_LINE_FINISHED,w),r()}])}),define("controllers/modal/ModalBuildingResearchController",["app","helper/time"],function(a,b){a.controller("ModalBuildingResearchController",["$scope","$rootScope","routeProvider","socketService","modelDataService","modalSharedBuildingResearchDataService","eventTypeProvider","modalSharedUnitInfoDataService","windowManagerService","inventoryItemTypeProvider",function(a,c,d,e,f,g,h,i,j,k){var l,m=g.getBuildingName(),n=g.getResearchName(),o=g.getPremium(),p=f.getGameData(),q=function(a){i.setUnitName(a),j.getModal("modal_unit_info")},r=function(b,c){a.computedResources=c};a.research=function(){l=f.getSelectedVillage().getId(),e.emit(d.VILLAGE_RESEARCH_UNLOCK,{village_id:l,research_type:n}),a.closeWindow()},a.$on(h.RESOURCES,r),a.showUnitInfoModal=q,a.researchName=n,a.premium=o,a.building=f.getSelectedVillage().getBuildingData().getDataForBuilding(m),a.researchItem=a.building.researches[n],a.premiumCosts=p.getPremiumCostsForType(k.RESEARCH),a.playerPremium=f.getPlayer().getPremium(),a.computedResources=null,a.inventory=f.getInventory().getInventoryItemReference(),a.premiumItemType=k.RESEARCH,b.timer.tick()}])}),define("controllers/modal/ModalPresetListController",["app","angular"],function(a,b){a.controller("ModalPresetListController",["$scope","modelDataService","presetListService","presetService",function(a,c,d,e){var f=c.getSelectedVillage(),g={assignedPresetList:{},presets:d.getPresets()},h=function(){var a,b=[];for(a in g.assignedPresetList)g.assignedPresetList[a]&&b.push(a);e.assignPresets(b)},i=function(){var a,b=function(b){g.assignedPresetList[+a]=f.getId()===b};g.assignedPresetList={};for(a in g.presets)g.presets[a].assigned_villages.forEach(b)},j=function(a){e.deletePreset(a.id)},k=function(a){e.showPresetDeleteModal(a).then(j)},l=function(a){e.showPresetInfoModal(a)},m=function(){e.createPreset()},n=function(a){e.showPresetEditModal(b.copy(a))},o=function(){return!!Object.keys(g.presets)[0]};a.showPresetInfoModal=l,a.showPresetEditModal=n,a.showPresetDeleteModal=k,a.updateAssignedPresets=h,a.createPreset=m,a.hasPresets=o,a.data=g,a.$watch("data.presets",i,!0)}])}),define("controllers/modal/ModalSelectUnitsController",["app"],function(a){a.controller("ModalSelectUnitsController",["$scope","$rootScope","$filter","modelDataService",function(a,b,c,d){var e=function(){a.closeWindow()},f=function(){a.closeWindow()},g=function(b){a.selectedUnits[b]=!a.selectedUnits[b],a.selectedUnits[b]?a.compilation.units[b]=1:a.compilation.units[b]=0};a.i18nOk=c("i18n")("OK"),a.i18nCancel=c("i18n")("CANCEL"),a.units=d.getGameData().getUnits(),a.selectedUnits=a.selectedUnits||{},a.compilation=a.compilation||{},a.compilation.units=a.compilation.units||{},a.toggleUnit=g,a.cancel=a.cancel||e,a.submit=a.submit||f}])}),define("controllers/modal/ModalUnitInfoController",["app"],function(a){a.controller("ModalUnitInfoController",["$scope","modelDataService","modalSharedUnitInfoDataService","recruitingService","eventTypeProvider","$element",function(a,b,c,d,e,f){var g=c.getUnitName(),h=b.getGameData(),i=function(b,c){a.computedResources=c},j=function(){a.recruitmentTime=d.calculateTime(1,g),a.costs=d.calculateCost(1,g),a.noblemanEffect=h.getNoblemanEffect()},k=function(a,b){-1!==["barracks","preceptory"].indexOf(b.building)&&j()};a.$on(e.RESOURCES,i),a.unitName=g,a.unitInfo=h.getUnit(g),a.maxUnitAttributes=h.getMaxUnitAttributes(),a.speed=a.unitInfo.speed/b.getWorldConfig().getSpeed()*60,a.$on(e.BUILDING_LEVEL_CHANGED,k),j()}])}),define("controllers/modal/ModalOfficerInfoController",["app"],function(a){a.controller("ModalOfficerInfoController",["$rootScope","$scope","$filter","modelDataService","modalSharedUnitInfoDataService","recruitingService","eventTypeProvider","$element",function(a,b,c,d,e,f,g,h){var i=d.getInventory(),j=function(a,d){var e=a.percentage||a.bonus_percentage||100*a.chance,f=d+"_"+a.type;return a.speed&&(e=c("i18n")(a.speed,b.locale,"unit_names")),c("i18n")(f,b.locale,"modal_officer_info",e)},k=function(){var a=d.getOfficers();b.abilities=a.data[b.name].abilities,b.translatedName=c("i18n")(b.name,b.locale,"officer_names"),b.amount=i.getItemAmountByType("premium_officer_"+b.name)};b.getAbility=j,k()}])}),define("controllers/modal/ModalBuildingInfoController",["app"],function(a){a.controller("ModalBuildingInfoController",["$scope","modelDataService","eventTypeProvider","inventoryItemTypeProvider",function(a,b,c,d){var e=d.BUILD_COST_REDUCTION,f=function(b,c){a.computedResources=c},g=function(){var c=b.getSelectedVillage(),d=c.getBuildingData().getDataForBuilding(a.buildingName),f=c.getSelectedOrder();a.building=d,a.selectedOrder=f,a.premiumCosts=b.getGameData().getPremiumCostsForType(e),a.inventory=b.getInventory().getInventoryItemReference(),a.itemType=e};a.$on(c.RESOURCES,f),g()}])}),define("controllers/modal/ModalCustomArmyController",["app","helper/time","conf/effectTypes","struct/MapData","conf/tribeSkillNames","conf/buildingTypes"],function(a,b,c,d,e,f){a.controller("ModalCustomArmyController",["$rootScope","$scope","$filter","modelDataService","windowDisplayService","armyService","socketService","routeProvider","eventTypeProvider","premiumActionService","presetService","officerInfoService","effectService","windowManagerService",function(a,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u,v=i.getGameData(),w=i.getSelectedVillage(),x=i.getSelectedCharacter(),y=i.getInventory(),z=i.getTribeSkills(),A=i.getWorldConfig(),B=null,C=0,D=0,E=0,F="N/A",G=i.getGameData().getOfficers(),H=d.getTownAt(g.target.data.x,g.target.data.y)||{},I=h("i18n")("tribe_skill",a.loc.ale)+" - ",J=!!x.getTribeId(),K=function(){var a=new Date,c=new Date;null!==B&&B!==1/0?(a.setSeconds(a.getSeconds()+B),c.setSeconds(c.getSeconds()+C),g.properties.arrivalIn=b.zerofill(a.getHours())+":"+b.zerofill(a.getMinutes())+":"+b.zerofill(a.getSeconds()),g.properties.arrivalInWithoutOfficers=b.zerofill(c.getHours())+":"+b.zerofill(c.getMinutes())+":"+b.zerofill(c.getSeconds())):g.properties.arrivalIn=F,g.nightModeActiveOnArrival=k.checkNightModeOnArrival(a)},L=function(){var a=p.getBasicPresetData();g.armyEmpty||(g.closeWindow(),p.showPresetNameModal().then(function(b){return a.name=b,p.showPresetIconModal(a)}).then(function(b){var c,d;a.icon=b.icon;for(c in g.officers)a.officers[c]=g.officers[c].checked;for(d in g.unitsToSend)a.units[d]=g.unitsToSend[d];a.catapult_target=g.catapultTarget.value,p.showPresetSaveModal(a)}))},M=function(){var a,c,d,e,h,i={units:{},officers:{}},j=!1;g.unitsToSend={};for(c in g.rangeSlider)g.rangeSlider.hasOwnProperty(c)&&g.rangeSlider[c].value>0&&(g.unitsToSend[c]=g.rangeSlider[c].value);i.units=g.unitsToSend;for(a in g.officers)g.officers.hasOwnProperty(a)&&g.officers[a].checked===!0&&(i.officers[a]=!0,j=!0);d=k.checkOfficersForArmy(i),G.forEach(function(a){-1!==d.indexOf(a)?(g.officers[a].checked=!1,g.switchesEnabled[a]=!1):g.switchesEnabled[a]=!0}),g.properties=k.calculateArmy(i,g.target.data.barbarianVillage),g.propertiesWithoutOfficers=k.calculateArmy({units:i.units,officers:{}},g.target.data.barbarianVillage),g.speedEffect&&(e=g.speedEffect.getDetails().factor,g.speedEffect.effectValue=e,g.properties.speed/=e,g.propertiesWithoutOfficers.speed/=e),g.supportEffect&&(g.properties.speed/=g.supportEffect.getDetails().factor),A.isRallyPointSpeedBonusEnabled()&&A.getRallyPointSpeedBonusVsBarbarians()&&g.target.data.barbarianVillage&&!k.hasSlowUnits(i)&&(h=w.getBuildingData().getDataForBuilding(f.RALLY_POINT),g.properties.speed/=h.specialFunction.currentValue/100,g.propertiesWithoutOfficers.speed/=h.specialFunction.currentValue/100),B=g.distance*g.properties.speed,C=g.distance*g.propertiesWithoutOfficers.speed,g.properties.duration=b.readableSeconds(B),g.properties.durationWithoutOfficers=b.readableSeconds(C),g.properties.combatStrength=k.getCombatStrength(E,D,i.officers.leader,!!i.units.knight),g.attackBonusEffect&&(e=1+parseFloat(g.attackBonusEffect.getDetails().bonus,10),g.attackBonusEffect.effectValue=e,g.properties.combatStrength=Math.round(g.properties.combatStrength*e)),g.lootBonusEffect&&(e=g.lootBonusEffect.details.factor,g.lootBonusEffect.effectValue=e,g.properties.load=g.properties.load*e),g.armyEmpty=0===Object.keys(g.unitsToSend).length,K()},N=function(a){var b;for(b in a.units)a.units.hasOwnProperty(b)&&(g.unitAmountInTown[b]=a.units[b].in_town)},O=function W(b,d){var e={},f=function(){var a;for(a in g.officers)g.officers.hasOwnProperty(a)&&g.officers[a].checked===!0&&(e[a]=1);l.emit(m.SEND_CUSTOM_ARMY,{start_village:w.getId(),target_village:g.target.id,type:b,units:g.unitsToSend,icon:0,officers:e,catapult_target:g.catapultTarget.value}),g.closeWindow()};if(!g.officerOffersVisible&&!g.armyEmpty)if("attack"===b){if(t)return;if(!d&&r.getEffect(c.ATTACK_PROTECTION)&&!g.target.data.barbarianVillage)return void j.openAttackProtectionModal(function(){W(b,!0)});l.emit(m.MAP_GET_VILLAGE_DETAILS,{my_village_id:w.getId(),village_id:g.target.id,num_reports:0},function(b){var c,d,e;for(e in b.supporting_units)if(b.supporting_units[e]>0){c=!0;break}c?(d=a.$new(),d.units=b.supporting_units,d.sendAttack=function(){f(),d.closeWindow()},d.sendAllUnitsHome=function(){l.emit(m.COMMAND_WITHDRAW_ALL_SUPPORT_FROM_VILLAGE,{village_id:g.target.id}),d.closeWindow()},s.getModal("modal_support_warning",d)):f()})}else f()},P=function(a){g.officer=a},Q=function(a){var b,c;for(c in g.officers)if(b=g.officers[c],b&&b.checked&&0===b.amount)return void(g.officerOffersVisible=!0);g.officerOffersVisible=!1},R=function(a,b){var c,d,e,f,h=g.officerOrder;for(d=b.offers.length,e=0;d>e;e++)c=b.offers[e],-1===c.type.indexOf("premium_officer_")||"officer"!==c.category&&"sale"!==c.category||(f=c.type.split("premium_officer_")[1],g.officers[f].offers.push(c));for(e=0;e<h.length;e++)g.officers[h[e]].offers.sortByProperty("amount")},S=function(a){var b,c;g.officersType=i.getOfficers().getCommandType(a);for(b in g.officers)g.officers[b]&&g.officers[b].checked&&i.getOfficers().getCommandType(b)!==g.officersType&&(g.officers[b].checked=!1);Q(c)},T=function(){var a;for(g.officerOrder=G,a=0;a<G.length;a++)g.officers[G[a]]={checked:g.officers.hasOwnProperty(G[a])?g.officers[G[a]].checked:!1,amount:y.getItemAmountByType("premium_officer_"+G[a]),offers:g.officers.hasOwnProperty(G[a])?g.officers[G[a]].offers:[]};Q()},U=function(){g.lootBonusEffect=r.getEffect(c.INCREASED_CARRYING_CAPACITY),g.attackBonusEffect=r.getEffect(c.MODIFY_ATTACK_FACTOR),g.target.data.barbarianVillage&&(g.speedEffect=r.getEffect(c.FARM_SPEED_INCREASE)),g.lootBonusOrigin="",g.lootBonusEffect&&J&&z.isSkillActive(e.loot_bonus)&&(g.lootBonusOrigin=I),g.speedOrigin="",g.speedEffect&&J&&z.isSkillActive(e.raid_speed)&&(g.speedOrigin=I),g.attackBonusOrigin="",g.attackBonusEffect&&J&&z.isSkillActive(e.attack_bonus)&&(g.attackBonusOrigin=I),g.villageOfOwnTribe&&(g.supportEffect=r.getEffect(c.FASTER_TRIBE_SUPPORT),g.supportEffect&&(g.supportEffectTooltip=r.formatEffectValueForDisplay("factor",g.supportEffect.details.factor),g.supportEffectTooltip=h("i18n")("supporter_desc",a.loc.ale,"modal_improve_skill",g.supportEffectTooltip),J&&z.isSkillActive(e.supporter)&&(g.supportEffectTooltip=I+g.supportEffectTooltip)))},V=function(){var a,c;for(a in g.units)if(g.units.hasOwnProperty(a))for(c in g.units[a])g.units[a].hasOwnProperty(c)&&(g.rangeSlider[g.units[a][c].name]={min:0,max:0,snap:1,value:g.rangeSlider[g.units[a][c].name]?g.rangeSlider[g.units[a][c].name].value:0,enabled:!0});for(a=0;a<G.length;a++)g.switchesEnabled[G[a]]=!0;for(a in g.unitInfo.units)g.unitInfo.units.hasOwnProperty(a)&&g.unitInfo.units[a].in_town>0&&(g.hasAvailableUnits=!0);l.emit(m.GET_ATTACKING_FACTOR,{target_id:g.target.id},function(a){D=parseFloat(a.faithFactor),E=parseFloat(a.moralFactor),t=a.attack_protection,g.targetIsNoobProtected=t,M()}),T(),l.emit(m.PREMIUM_LIST_SHOP_OFFERS,{}),b.timer.add(K),U()};g.officers=g.officers||{},g.officersTyp="attack",g.inventory=y,g.hasAvailableUnits=!1,g.selectedVillageModel=w,g.unitInfo=w.getUnitInfo(),g.unitAmountInTown={};for(u in g.unitInfo.units)g.unitInfo.units.hasOwnProperty(u)&&(g.unitAmountInTown[u]=g.unitInfo.units[u].in_town);g.$watch("unitInfo",N,!0),g.rangeSlider=g.rangeSlider||{},g.unitsToSend={},g.switchesEnabled={},g.properties={arrivalIn:F,duration:F,load:F,discipline:F,combatStrength:F},g.units={defensive:v.getDefensiveUnits(),offensive:v.getOffensiveUnits(),special:v.getSpecialUnits()},g.armyEmpty=!1,g.catapultTarget=g.catapultTarget||{},g.catapultTarget.value=g.catapultTarget.value||Object.keys(i.getGameData().getBuildings())[0],g.catapultTarget.name=h("i18n")(g.catapultTarget.value,a.loc.ale,"building_names"),g.villageOfOwnTribe=H.tribe_id===x.getTribeId(),g.NIGHT_MODE_DEFENDER_BONUS=k.NIGHT_MODE_DEFENDER_BONUS,g.init=V,g.sendArmy=O,g.savePreset=L,g.updateProperties=M,g.setTooltip=P,g.updateOfficerChanged=S,g.openOfficerInfo=q.openOfficerInfo,g.buyItem=o.buyItem,g.$on(n.PREMIUM_SHOP_OFFERS,R),g.$on(n.INVENTORY_ITEM_CHANGED,T),g.$on(n.EFFECT_CHANGED,U),g.$on(n.EFFECT_EXPIRED,U),g.$on("$destroy",function(){b.timer.remove(K)}),g.$watch("rangeSlider",M,!0),g.$watch("officers",M,!0),V()}])}),define("controllers/modal/ModalPremiumController",["app","helper/time"],function(a,b){a.controller("ModalPremiumController",["$scope","premiumService","modelDataService","premiumActionTypeProvider","eventTypeProvider",function(a,c,d,e,f){var g=["premium","wood","clay","iron","time"],h=[],i=function(){a.resources[0].amount=d.getGameData().getInstantBuildPremiumCosts(a.extras.buildJob)},j=function(){e.INSTANT_BUILD===a.actionType&&b.timer.remove(i)},k=function(b,c){c.job.id===a.extras.buildJob.id&&a.closeWindow()},l=function(){a.closeWindow()},m=function(b,c){c.job_id===a.extras.recruitJob.job_id&&a.closeWindow()},n=function(b,c){if(c.building===a.extras.buildJob.building){var e=d.getSelectedVillage().getBuildingQueue().getJobById(a.extras.buildJob.id);null===e&&a.closeWindow()}},o=function(b,c){c.item===a.extras.weaponName&&(c.next_level||a.closeWindow(),a.resources[0].amount=d.getGameData().getPaladinWeaponPremiumCosts(a.extras.weaponName))},p=function(){g.forEach(function(b){a.costs[b]&&h.push({type:b,amount:a.costs[b]})}),a.resources=h,e.INSTANT_BUILD===a.actionType&&(b.timer.add(i),a.$on(f.BUILD_JOB_CANCELLED,k),a.$on(f.BUILDING_LEVEL_CHANGED,n)),e.PALADIN_INSTANT_RECRUIT===a.actionType&&(a.$on(f.PALADIN_SUMMONED,l),a.$on(f.STATUE_RECRUIT_JOB_CANCELED,m)),e.PALADIN_WEAPON_UNLOCK===a.actionType&&a.$on(f.PALADIN_UNLOCK_NEXT_ITEM,o)},q=function(){c.setPremiumModalState(!a.premiumModalEnabled),a.closeWindow(),a.$parent.onConfirm&&a.$parent.onConfirm()},r=function(){c.openPaymentModal()},s=function(){return d.getPlayer().getPremium()>=a.costs.premium};a.premiumModalEnabled=!c.isModalEnabled(),a.confirm=q,a.purchasePremium=r,a.hasEnoughPremium=s,a.$on("$destroy",j),p()}])}),define("controllers/modal/ModalSelectOrderController",["app"],function(a){a.controller("ModalSelectOrderController",["$scope","eventTypeProvider","modelDataService",function(a,b,c){var d=function(){a.onOrderSelected(a.orderName),a.closeWindow()},e=function(){a.closeWindow()},f=function(){a.selectedOrder=c.getSelectedVillage().getSelectedOrder()};a.selectedOrder=null,a.confirmSelection=d,a.declineSelection=e,a.init=f,a.$on(b.PRECEPTORY_ORDER_SELECTED,f),f()}])}),define("controllers/modal/ModalOrderInfoController",["app"],function(a){a.controller("ModalOrderInfoController",[function(){}])}),define("controllers/modal/ModalSendSpiesController",["app","helper/time","helper/math"],function(a,b,c){a.controller("ModalSendSpiesController",["$scope","modelDataService","socketService","routeProvider","eventTypeProvider",function(a,d,e,f,g){var h=d.getWorldConfig(),i=a.distance/h.getSpeed()*d.getGameData().getBaseData().spy_speed*60,j=d.getSelectedVillage(),k="sabotage",l=function(){return a.option===k?i/h.getSpySabotageSpeedModifier():i/h.getSpySpeedModifier()},m=function(){var c=new Date;c.setSeconds(c.getSeconds()+l()),a.arrivalIn=b.zerofill(c.getHours())+":"+b.zerofill(c.getMinutes())+":"+b.zerofill(c.getSeconds())},n=function(c){a.option=c,m(),a.duration=b.readableSeconds(l())},o=function(){e.emit(f.SCOUTING_GET_INFO,{village_id:j.getId()})},p=function(b,c){if(c.id===j.getId()){var d,e=5;for(a.availableSpies=0,d=1;e>=d;d++)1===c["spy_"+d]&&a.availableSpies++}},q=function(e,f){j=d.getSelectedVillage(),a.distance=c.actualDistance(j.getPosition(),{x:a.targetX,y:a.targetY}),i=a.distance/d.getWorldConfig().getSpeed()*d.getGameData().getBaseData().spy_speed*60,a.duration=b.readableSeconds(l()),a.canSabotage="thieves"===j.getSelectedOrder()&&j.getBuildingData().getDataForBuilding("preceptory").level>0,m(),o()},r=function(){0!==a.availableSpies&&0!==a.option.length&&0!==a.rangeSlider.value&&e.emit(f.SCOUTING_SEND_COMMAND,{startVillage:j.getId(),targetVillage:a.targetId,spys:a.rangeSlider.value,type:a.option},function(b){a.closeWindow()})},s=function(){b.timer.add(m),a.duration=b.readableSeconds(l()),a.option="",a.availableSpies=0,a.rangeSlider={min:0,max:0,snap:1,value:0,enabled:!0},o()};a.init=s,a.selectOption=n,a.sendSpies=r,a.canSabotage="thieves"===j.getSelectedOrder()&&j.getBuildingData().getDataForBuilding("preceptory").level>0,a.$on("$destroy",function(){b.timer.remove(m)}),a.$on(g.SCOUTING_SENT,function(){o()}),a.$on(g.SCOUTING_SPY_PRODUCED,function(){o()}),a.$on(g.SCOUTING_INFO,p),a.$on(g.VILLAGE_SELECTED_CHANGED,q),s()}])}),define("controllers/modal/ModalSendResourcesController",["app","helper/time"],function(a,b){a.controller("ModalSendResourcesController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","eventTypeProvider",function(a,c,d,e,f,g,h){var i=360*c.distance,j=e.getSelectedVillage(),k=function(){var a=new Date;a.setSeconds(a.getSeconds()+i),c.arrivalIn=b.zerofill(a.getHours())+":"+b.zerofill(a.getMinutes())+":"+b.zerofill(a.getSeconds())},l=function(){var a,b=0;for(a in c.rangeSlider)""!==c.rangeSlider[a].value&&(c.rangeSlider[a].value=parseInt(c.rangeSlider[a].value,10),c.rangeSlider[a].value=isNaN(c.rangeSlider[a].value)?0:c.rangeSlider[a].value),b+=c.rangeSlider[a].value;for(a in c.rangeSlider)c.rangeSlider[a].max=Math.min(c.resources[a],c.maxCapacity-b+c.rangeSlider[a].value);c.merchants.tmpFree=c.merchants.free-Math.ceil(b/1e3),c.merchants.percent=c.merchants.tmpFree/c.merchants.total*100},m=function(){0===c.merchants.free||0===c.rangeSlider.wood.value&&0===c.rangeSlider.clay.value&&0===c.rangeSlider.iron.value||f.emit(g.TRADING_SEND_RESOURCES,{start_village:j.getId(),target_village:c.targetId,wood:c.rangeSlider.wood.value,clay:c.rangeSlider.clay.value,iron:c.rangeSlider.iron.value},function(b){a.$broadcast(h.MESSAGE_SUCCESS,{message:d("i18n")(g.TRADING_SEND_RESOURCES.type,a.loc.ale,"success_message")}),c.closeWindow()})},n=function(a){0===a.value&&(a.value="")},o=function(a){""===a.value&&(a.value=0)},p=function(){var a;for(c.resources={wood:Math.ceil(j.getResources().getResources().wood),clay:Math.ceil(j.getResources().getResources().clay),iron:Math.ceil(j.getResources().getResources().iron)},c.maxCapacity=0,c.merchants={total:0,free:0,busy:0,percent:0,tmpFree:0},a=0;a<c.resourceOrder.length;a++)c.rangeSlider[c.resourceOrder[a]]={min:0,max:0,snap:1,value:0,enabled:!0};f.emit(g.TRADING_GET_MERCHANT_STATUS,{village_id:j.getId()},function(b){for(c.merchants.total=b.total,c.merchants.free=b.free,c.merchants.busy=b.busy,c.merchants.percent=c.merchants.free/c.merchants.total*100,c.merchants.tmpFree=b.free,c.maxCapacity=1e3*c.merchants.free,a=0;a<c.resourceOrder.length;a++)c.rangeSlider[c.resourceOrder[a]].max=c.maxCapacity>c.resources[c.resourceOrder[a]]?c.resources[c.resourceOrder[a]]:c.maxCapacity})};c.duration=b.readableSeconds(i),c.maxCapacity=0,c.resourceOrder=e.getGameData().getResourceNames(),c.resourceOrder.splice(c.resourceOrder.indexOf("food"),1),c.rangeSlider={},c.merchants={},c.resources={},c.init=p,c.sendResources=m,c.onFocus=n,c.onBlur=o,c.$on("$destroy",function(){b.timer.remove(k)}),c.$on(h.RESOURCES,function(a,b){var d;for(d=0;d<c.resourceOrder.length;d++)c.resources[c.resourceOrder[d]]=b[c.resourceOrder[d]].currentProduction}),c.$on(h.TRADING_OFFER_LIST,p),c.$on(h.TRADING_OFFER_CREATED,p),c.$on(h.TRADING_OFFER_REMOVED,p),c.$on(h.TRADING_OFFER_ACCEPTED,p),c.$on(h.TRADING_TRANSPORT_NEW,p),c.$on(h.TRADING_TRANSPORT_RETURNED,p),c.$watch("rangeSlider",l,!0),b.timer.add(k),p()}])}),define("controllers/modal/ModalFoundTribeController",["app"],function(a){a.controller("ModalFoundTribeController",["$rootScope","$scope","$filter","eventTypeProvider","routeProvider","socketService","tribeService","errorTypeProvider",function(a,b,c,d,e,f,g,h){var i=function(){var a;for(a in b.errors)if(b.errors.hasOwnProperty(a)&&b.errors[a])return!1;

return!b.name||0===b.name.length||b.name.length>b.nameLength.max||b.name.length<b.nameLength.min?!1:b.tag&&b.tag.length===b.tagLength.eql?!0:!1},j=function(){i()&&g.createTribe(b.name,b.tag)},k=function(g){a.$broadcast(d.MESSAGE_SUCCESS,{message:c("i18n")("tribe_created",a.loc.ale,"modal_found_tribe")}),f.emit(e.TRIBE_RELATION_GET_LIST),b.closeWindow()},l=function(d){var e=c("i18n")(d.name,a.loc.ale,"error_message");b.errors[d.name]=e},m=function(){b.errors[b.TRIBE_NAME_ALREADY_TAKEN]=!1,b.errors[b.TRIBE_NAME_CONTAINS_NO_LETTER]=!1},n=function(){b.errors[b.TRIBE_TAG_ALREADY_TAKEN]=!1,b.errors[b.TRIBE_TAG_CONTAINS_NO_LETTER]=!1},o=function(){b.name=b.tag="",b.nameLength={min:3,max:32},b.tagLength={eql:3},b.errors={},b.TRIBE_NAME_ALREADY_TAKEN=h.TRIBE_NAME_ALREADY_TAKEN,b.TRIBE_TAG_ALREADY_TAKEN=h.TRIBE_TAG_ALREADY_TAKEN,b.TRIBE_NAME_CONTAINS_NO_LETTER=h.TRIBE_NAME_CONTAINS_NO_LETTER,b.TRIBE_TAG_CONTAINS_NO_LETTER=h.TRIBE_TAG_CONTAINS_NO_LETTER,b.TRIBE_TAG_TRIBE_NAME_FORBIDDEN_CHARACTER=h.TRIBE_NAME_FORBIDDEN_CHARACTER};b.createTribe=j,b.tribeAttributesValid=i,b.onNameChange=m,b.onTagChange=n,b.$on(d.TRIBE_CREATED,k),b.$on(h.TRIBE_NAME_ALREADY_TAKEN,l),b.$on(h.TRIBE_TAG_ALREADY_TAKEN,l),b.$on(h.TRIBE_NAME_CONTAINS_NO_LETTER,l),b.$on(h.TRIBE_TAG_CONTAINS_NO_LETTER,l),b.$on(h.TRIBE_NAME_FORBIDDEN_CHARACTER,l),o()}])}),define("controllers/modal/ModalAddContactsToConversationController",["app"],function(a){a.controller("ModalAddContactsToConversationController",["$scope","socketService","modelDataService","messagingService","routeProvider",function(a,b,c,d,e){var f=null,g=c.getSelectedCharacter().getCurrentConversation(),h=function(c,d){b.emit(e.FRIENDLIST_REMOVE,{type:d,id:c},function(b){var c;for(c in a.friendlist[b.type])if(a.friendlist[b.type][c].id===b.id){a.friendlist[b.type].splice(c,1);break}})},i=function(b,c){var d,e,f=a.friendlist[c];for(d in f)if(e=f[d],e.id===b)return e;return null},j=function(b,c){var e,f,g,h,j,k,l=[];for(e in b)if(f=+e,j=i(f,c),h={id:f,type:c,name:j?j.name:null},!b[f]||a.conversation&&a.conversation.hasParticipant(h)||l.push(h),!b[f]&&a.conversation&&a.conversation.hasParticipant(h)){k=a.conversation.participants,d.removeContactsFromConversation([f],a.messageId);for(g in k)k[g].id===f&&k.splice(g,1)}else b[f]||a.conversation||a.removeRecipient(h);return l},k=function(b,c){var d=[];d=d.concat(j(b,"character")),d=d.concat(j(c,"tribe")),a.addRecipients(d),a.closeWindow()},l=125,m=null,n=function(b){window.clearTimeout(m),window.setTimeout(function(){var c=b.target.value.toLowerCase(),d=function(a){return a.name.toLowerCase().indexOf(c)>=0};a.friendlist.character=f.character.filter(d),a.friendlist.tribe=f.tribe.filter(d)},l)};a.setSelected=k,a.removeContact=h,a.friendlist=[],a.selectedCharacters=a.selectedCharacters||g.getParticipants().reduce(function(a,b){return"character"===b.type&&(a[b.id]=!0),a},{}),a.selectedTribes=a.selectedTribes||g.getParticipants().reduce(function(a,b){return"tribe"===b.type&&(a[b.id]=!0),a},{}),a.onKeyUp=n,d.getFriendList(function(c){var d,g=[];f=c.list,a.friendlist=window.angular.copy(c.list);for(d in a.friendlist.character)a.friendlist.character.hasOwnProperty(d)&&g.push(a.friendlist.character[d].id);b.emit(e.CHAR_GET_BASE_PROFILES,{character_ids:g},function(b){var c,d,e;for(c in b.characters)if(b.characters.hasOwnProperty(c)){for(d in a.friendlist.character)a.friendlist.character.hasOwnProperty(d)&&b.characters[c].id===a.friendlist.character[d].id&&(a.friendlist.character[d].icon=b.characters[c].profile_icon);for(e in f.character)f.character.hasOwnProperty(e)&&f.character[e].id===b.characters[c].id&&(f.character[e].icon=b.characters[c].profile_icon)}})})}])}),define("controllers/modal/ModalFriendListController",["app"],function(a){a.controller("ModalFriendListController",["$rootScope","$scope","$filter","modelDataService","messagingService",function(a,b,c,d,e){var f,g=d.getSelectedCharacter(),h=function(a){a.type=a.type||"character",e.addFriend(a)},i=function(a){e.removeFriend(a)},j=function(a){e.newMessage(a),b.closeWindow()};b.remove=i,b.add=h,b.messageTo=j,b.friendlist=[],b.selectedCharacters={},b.selectedTribes={},b.autoComplete={type:["character","tribe"],focus:!0,onEnter:h,placeholder:c("i18n")("add_contact",b.locale,"friendlist"),exclude:function(a){return!(f||d.getSelectedCharacter().getFriendList()).has({id:a.id,type:a.type})&&a.id!==g.getId()&&"character"===a.type}},e.getFriendList(function(a){f=a,b.friendlist=a.list})}])}),define("controllers/modal/ModalIconGeneratorController",["app","helper/asset","helper/dataconversion"],function(a,b,c){a.controller("ModalIconGeneratorController",["$scope","$rootScope",function(a,d){var e=function(){var b,e="";for(b=0;b<a.iconLayer.length;b++)e+=c.icon(null,a.iconLayer[b].n,2),a.iconLayer[b].str=e;a.icon=e,d.$$phase||a.$digest()},f=function(b){a.iconLayer[b].n=a.iconLayer[b].n%a.iconLayer[b].l+1,a.activeKey=b,e()},g=function(b){--a.iconLayer[b].n<1&&(a.iconLayer[b].n=a.iconLayer[b].l),a.activeKey=b,e()},h=function(){var b;for(b in a.iconLayer)a.iconLayer[b].n=Math.floor(a.iconLayer[b].l*Math.random()+1);e()},i=function(b){a.name=a.newName=b},j=function(){return!(a.withName&&!(a.name&&a.name.length>2&&a.name.length<51))},k=function(b,c){j()&&a.submit(b,c)},l=function(){a.icon&&"000000"!==a.icon||(a.icon="010101"),i(a.name),a.iconLayer=[{str:"00",l:b.getIconCountInLayer(a.iconType,"back")},{str:"00",l:b.getIconCountInLayer(a.iconType,"fore")},{str:"00",l:b.getIconCountInLayer(a.iconType,"icon")}].filter(function(a){return 0!==a.l}).map(function(b,c){return b.n=parseInt(a.icon.substr(2*c,2),16),b}),e()};a.activeKey="",a.canSubmit=j,a.random=h,a.up=f,a.down=g,a.setName=i,a.submitWrapper=k,l()}])}),define("controllers/modal/ModalUseItemController",["app"],function(a){a.controller("ModalUseItemController",["$scope","inventoryService","inventoryItemTypeProvider",function(a,b,c){var d=function(){b.setUseItemModalState(a.item.type,!a.useItemModalEnabled),a.closeWindow(),a.$parent.onConfirm&&a.$parent.onConfirm(a.item)};a.useItemModalEnabled=!b.isModalEnabled(a.item.type),a.inventoryItemTypeProvider=c,a.confirm=d}])}),define("controllers/modal/ModalPaymentController",["app","conf/conf"],function(a,b){a.controller("ModalPaymentController",["$scope","$sce",function(a,b){var c=function(a){return b.trustAsResourceUrl(a)},d=function(){a.showIframe=!0};a.trustSrc=c,a.iframeLoaded=d}])}),define("controllers/modal/ModalPresetEditController",["app","angular","helper/parse"],function(a,b,c){a.controller("ModalPresetEditController",["$scope","$rootScope","modelDataService","eventTypeProvider","presetService","$filter","officerInfoService","storageService","hotkeyManagerService",function(a,d,e,f,g,h,i,j,k){var l,m={ATTACK:"attack",SUPPORT:"support"},n=9,o=e.getInventory(),p=0,q=function(){var b;p=0;for(b in a.preset.units)a.preset.units[b]=c.toValidInteger(a.preset.units[b]),p+=a.preset.units[b];a.showCatapultSelect=a.preset.units.catapult},r=function(b){b.changed&&(a.updatePreset=!0,a.preset.icon=b.icon)},s=function(a){g.showPresetIconModal(a).then(r)},t=function(a){g.showPresetInfoModal(a,!0)},u=function(b,c){var d;if(void 0!==a.hotkey){for(d in l)l[d].key===a.hotkey&&delete l[d];l[c.id]={key:a.hotkey,type:a.hotkeyType},j.setItem(g.getStorageKey(),l),k.init()}},v=function(){q(),a.updatePreset&&0!==p&&g.savePreset(a.preset)&&(a.updatePreset=!1,a.updateFront())},w=function(b){a.preset.name!==b&&(a.updatePreset=!0,a.preset.name=b)},x=function(){g.showPresetNameModal(a.preset).then(w)},y=function(b,c){a.preset.catapult_target=c,a.catapultTarget.name=h("i18n")(c,d.loc.ale,"building_names"),a.catapultTarget.value=c,a.updatePreset=!0},z=function(){q(),a.updatePreset=!!p},A=function(b){a.officer=b},B=function(b){a.hotkey=b,a.showHotkeyTypeSelector=!0,0!==p&&(a.updatePreset=!0)},C=function(b){a.hotkeyType=b,a.showHotkeyTypeSelector=!1,0!==p&&(a.updatePreset=!0)},D=function(a){var b;for(b in l)if(l[b].key===a)return!0;return!1},E=function(b){0===a.preset.units[b]&&(a.preset.units[b]="")},F=function(b){""===a.preset.units[b]&&(a.preset.units[b]=0)},G=function(){var c,f,i=e.getGameData().getAttackableBuildings(),k=[];for(f in i)k.push({name:h("i18n")(f,d.loc.ale,"building_names"),value:f});q(),l=j.getItem(g.getStorageKey())||{},c=l[a.preset.id],c?(a.hotkeyType=c.type,a.hotkey=c.key):a.hotkeyType=m.ATTACK,a.updatePreset=!1,a.unitOrder=b.copy(e.getGameData().getOrderedUnitNames()),a.attackableBuildings=k,a.preset.catapult_target=a.preset.catapult_target||a.attackableBuildings[0].value,a.catapultTarget.name=h("i18n")(a.preset.catapult_target,d.loc.ale,"building_names"),a.catapultTarget.value=a.preset.catapult_target,a.unitOrder.splice(a.unitOrder.indexOf("catapult"),1)};a.ARMY_TYPES=m,a.MAX_HOTKEYS=n,a.inventory=o,a.showCatapultSelect=!1,a.catapultTarget=a.catapultTarget||{},a.save=v,a.keyup=z,a.showPresetIconModal=s,a.showPresetInfoModal=t,a.renamePreset=x,a.setOfficerTooltip=A,a.openOfficerInfo=i.openOfficerInfo,a.setHotkeyType=C,a.setHotkey=B,a.isHotkeyUsed=D,a.onFocus=E,a.onBlur=F,d.$on(f.SELECT_SELECTED,y),d.$on(f.ARMY_PRESET_SAVED,u),a.$watch("preset.officers",function(b,c){b!==c&&(a.updatePreset=!0)},!0),G()}])}),define("controllers/modal/ModalPresetContentController",["app","conf/effectTypes"],function(a,b){a.controller("ModalPresetContentController",["$scope","modelDataService","armyService","effectService","$filter",function(a,c,d,e,f){var g=function(){var g;a.specs=d.calculateArmy(a.preset),a.officerOrder=c.getGameData().getOfficers(),a.unitOrder=c.getGameData().getOrderedUnitNames(),a.lootBonusEffect=e.getEffect(b.INCREASED_CARRYING_CAPACITY),a.lootTooltip=f("i18n")("carry_capacity",a.locale,"military_operations"),a.attackBonusEffect=e.getEffect(b.MODIFY_ATTACK_FACTOR),a.attackToolTip=f("i18n")("attack_power",a.locale,"military_operations"),a.recruitSpeedEffect=e.getEffect(b.RECRUIT_SPEED_BOOST),a.recruitToolTip=f("i18n")("total_recruiting_time",a.locale,"military_operations"),a.lootBonusEffect&&(a.modifiedLootValue=a.specs.load*a.lootBonusEffect.details.factor,a.lootTooltip+=" (+"+100*(a.lootBonusEffect.details.factor-1)+"%)"),a.attackBonusEffect&&(a.modifiedAttackValue=Math.round(a.specs.attack*(1+parseFloat(a.attackBonusEffect.details.bonus,10))),a.attackToolTip+=" (+"+100*a.attackBonusEffect.details.bonus+"%)"),a.recruitSpeedEffect&&(g=a.recruitSpeedEffect.details.factor-1,a.modifiedRecruitingSpeed=a.specs.recruitingTime-a.specs.recruitingTime*g,a.recruitToolTip+=" (-"+parseInt(100*g,10)+"%)")},h=function(b){a.officer=b};a.setTooltip=h,g()}])}),define("controllers/modal/ModalSendPresetController",["app","angular","helper/time","struct/MapData","helper/math","conf/effectTypes"],function(a,b,c,d,e,f){a.controller("ModalSendPresetController",["$scope","$rootScope","modelDataService","presetListService","recruitingService","socketService","routeProvider","armyService","windowManagerService","presetService","eventTypeProvider","premiumActionService","storageService","effectService",function(a,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u=h.getSelectedVillage(),v=(h.getPlayer(),h.getSelectedCharacter()),w=h.getInventory(),x=d.getTownAt(a.target.data.x,a.target.data.y)||{},y=function(){var b,d;a.amountPresets=0;for(b in a.presets)d=a.presets[b],d.speed=m.calculateSpeed(d,a.target.data.barbarianVillage),d.durationInSeconds=a.distance*d.speed,d.duration=c.readableSeconds(d.durationInSeconds),d.status=j.calculatePreset(d,a.unitInfo.units),a.amountPresets++},z=function(b,c,d){o.sendPreset(b.id,c,a.villageId,t,a.target.data.barbarianVillage,d,function(){a.closeWindow()})},A=function(b,c,d,e){var f,h,i,j,k=g.$new(),l={};if(b&&b.useable){for(n.closeTemplate("modal_preset_buy_officer"),a.pendingPresetAction=null,j=0;j<a.officerOrder.length;j++)i=a.officerOrder[j],h=a.officers[i],c.officers[i]&&0===h.amount&&(l[i]=h);if(f=Object.keys(l),!f.length)return void z(c,d,e);a.pendingPresetAction={status:b,preset:c,type:d,opt_force:e},k.preset=c,k.officers=l,k.ses=f,k.buyItem=function(a){q.buyItem(a,k.closeWindow)},k.sendWithoutOfficer=function(){z(c,d,e),k.closeWindow()},k.setTooltip=function(a){k.officer=a},k.closeWindow=function(){a.pendingPresetAction=null},n.getModal("modal_preset_buy_officer",k)}},B=function(){var b,d;for(d in a.presets)b=new Date,b.setSeconds(b.getSeconds()+a.presets[d].durationInSeconds),a.presets[d].arrivalIn=c.zerofill(b.getHours())+":"+c.zerofill(b.getMinutes())+":"+c.zerofill(b.getSeconds()),a.presets[d].nightModeActiveOnArrival=m.checkNightModeOnArrival(b);g.$$phase||a.$digest()},C=function(b){a.officer=b},D=function(){var b,c=a.officerOrder,d=a.pendingPresetAction;for(b=0;b<c.length;b++)a.officers[c[b]]={amount:w.getItemAmountByType("premium_officer_"+c[b]),offers:a.officers.hasOwnProperty(c[b])?a.officers[c[b]].offers:[]};d&&A(d.status,d.preset,d.type,d.opt_force)},E=function(b,c){var d,e,f,g=c.offers.length,h=a.officerOrder;for(f=0;g>f;f++)d=c.offers[f],-1===d.type.indexOf("premium_officer_")||"officer"!==d.category&&"sale"!==d.category||(e=d.type.split("premium_officer_")[1],a.officers[e].offers.push(d));for(f=0;f<h.length;f++)a.officers[h[f]].offers.sortByProperty("amount")},F=function(a){o.showPresetEditModal(b.copy(a))},G=function(b,c){var d;a.hotkeys=r.getItem(o.getStorageKey());for(d in a.presets)parseInt(d,10)===c.id&&(a.presets[d]=c,y())},H=function(){a.attackBonusEffect=s.getEffect(f.MODIFY_ATTACK_FACTOR),a.villageOfOwnTribe&&(a.supportEffect=s.getEffect(f.FASTER_TRIBE_SUPPORT))},I=function(){var b=d.getTownById(a.villageId);k.emit(l.GET_ATTACKING_FACTOR,{target_id:a.villageId},function(d){t=d.attack_protection,a.targetIsNoobProtected=t,a.presets=i.getPresetsForVillageId(u.getId()),a.targetCharacterName=b.character_name,a.distance=e.actualDistance(u.getPosition(),{x:b.x,y:b.y}),a.combatStrength=m.getCombatStrength(d.moralFactor,d.faithFactor),a.combatStrengthWithLeader=m.getCombatStrength(d.moralFactor,d.faithFactor,!0),a.attackBonusEffect&&(a.combatStrength=Math.round(a.combatStrength*(1+parseFloat(a.attackBonusEffect.getDetails().bonus,10))),a.combatStrengthWithLeader=Math.round(a.combatStrengthWithLeader*(1+parseFloat(a.attackBonusEffect.getDetails().bonus,10)))),c.timer.add(B),y(),D(),H(),k.emit(l.PREMIUM_LIST_SHOP_OFFERS,{})})},J=function(){o.createPreset()},K=function(){o.showPresetListModal()};a.unitInfo=h.getSelectedVillage().getUnitInfo(),a.officerOrder=h.getGameData().getOfficers(),a.amountPresets=0,a.officers={},a.NIGHT_MODE_DEFENDER_BONUS=m.NIGHT_MODE_DEFENDER_BONUS,a.hotkeys=r.getItem(o.getStorageKey()),a.villageOfOwnTribe=x.tribe_id===v.getTribeId(),a.init=I,a.sendPreset=z,a.checkPreset=A,a.showPresetInfoModal=o.showPresetInfoModal,a.editPreset=F,a.setTooltip=C,a.newPreset=J,a.showPresetListModal=K,a.$on(p.PREMIUM_SHOP_OFFERS,E),a.$on(p.INVENTORY_ITEM_CHANGED,D),a.$on(p.ARMY_PRESET_SAVED,G),a.$on(p.EFFECT_CHANGED,H),a.$on(p.EFFECT_EXPIRED,H),a.$on("$destroy",function(){c.timer.remove(B)}),a.$watch("presets",y,!0),I()}])}),define("controllers/modal/ModalGroupController",["app","helper/dataconversion"],function(a,b){a.controller("ModalGroupController",["$rootScope","$scope","$filter","groupService","windowManagerService","eventTypeProvider",function(a,c,d,e,f,g){var h=function(a){return!a.system},i=function(a){return c.villageGroups.filter(h).length<4&&c.villageGroups&&-1===c.villageGroups.indexOf(a)},j=function(a){i(a)&&e.attachGroupToVillage(a.id,c.villageId)},k=function(a){e.dettachGroupFromVillage(a.id,c.villageId)},l=function(g){var h=a.$new(),i=(a.$new(),void 0!==g);if(h.iconType="group",h.withName=!0,g)h.icon=b.icon(null,g.icon,4),h.name=g.name;else{if(c.sortedGroups.length>=10)return;h.namePlaceholder=d("i18n")("new_group_name_placeholder",a.loc.ale,"modal_groups_index")}h.submit=function(a,b){i?e.updateGroup(g.id,a,b):e.createGroup(a,b),h.closeWindow()},h.cancel=function(){h.closeWindow()},f.getModal("modal_icon_generator",h)},m=function(b){var c=a.$new(),g="modal_groups_destroy";c.title=d("i18n")("title",a.loc.ale,g),c.text=d("i18n")("text",a.loc.ale,g),c.additionalText=d("i18n")("additionalText",a.loc.ale,g),c.submitText=d("i18n")("submitText",a.loc.ale,g),c.boxText=e.getVillageCountForGroup(b.id).toString(),c.switchColors=!0,c.submit=function(){e.destroyGroup(b.id),c.closeWindow()},f.getModal("modal_attention",c)},n=function(){var a,b=e.getGroups(),d=[];for(a in b)d.push(b[a]);c.sortedGroups=d.sort(function(a,b){return a.id-b.id}),c.villageGroups=e.getVillageGroups(c.villageId)},o=function(){if(!c.villageId||!c.villageName)throw new Error("Can not use group modal without villageId or villageName");n()};c.nonSystemGroup=h,c.activeGroup=i,c.attachGroupToVillage=j,c.dettachGroupFromVillage=k,c.openEditGroupModal=l,c.openDestroyGroupModal=m,c.init=o,c.$on(g.GROUPS_CREATED,n),c.$on(g.GROUPS_DESTROYED,n),o()}])}),define("controllers/modal/ModalEstablishVillageController",["app"],function(a){a.controller("ModalEstablishVillageController",["$rootScope","$scope","$timeout","routeProvider","socketService","modelDataService","eventTypeProvider","villageService",function(a,b,c,d,e,f,g,h){var i,j,k=function(a){e.emit(d.CHAR_CREATE_VILLAGE,{name:i.getName()+"'s ville",direction:a})},l=function(a,b){e.emit(d.CHAR_GET_INFO,null,function(){h.ensureVillageDataLoaded(b.village_id)})},m=function(){c(function(){b.closeWindow()},0)},n=function(a,c){b.tribeName=c.name,b.canRestartNearTribe=!!c.num_villages},o=function(){e.emit(d.TRIBE_GET_PROFILE,{tribe_id:j})},p=function(){b.selectedCharacter=i=f.getSelectedCharacter(),a.$broadcast(g.NOTIFICATION_DISABLE),j=i.getTribeId(),j&&o()};b.createVillage=k,b.selectedCharacter=null,b.tribeName=null,b.canRestartNearTribe=!1,b.$on(g.CHARACTER_VILLAGE_CREATED,l),b.$on(g.MAP_INITIALIZED,m),b.$on(g.MAP_ALREADY_INITIALIZED,m),b.$on(g.TRIBE_PROFILE,n),p()}])}),define("controllers/modal/ModalGameOverController",["app"],function(a){a.controller("ModalGameOverController",["$scope","windowManagerService",function(a,b){var c=function(){b.getFramedModal("modal_establish_village"),a.closeWindow()};a.restart=c}])}),define("controllers/modal/ModalSocketController",["app"],function(a){a.controller("ModalSocketController",["$scope","eventTypeProvider","authService",function(a,b,c){var d=3,e=0,f=a.closeWindow,g=function(){},h=function(){window.location.reload()},i=function(){c.clearAuthData(),h()},j=function(a,b){f()},k=function(b,c,d,f){e=f,a.eventName="onSocketReconnecting"},l=function(){return e>=d},m=function(b,c){a.eventName="error"};a.eventName="onSocketReconnecting",a.connectionAttemptThresholdReached=l,a.closeWindow=g,a.logout=i,a.reload=h,a.$on(b.SOCKET_CONNECTED,j),a.$on(b.SOCKET_RECONNECTING,k),a.$on(b.SOCKET_RECONNECT_ERROR,m),a.$on(b.SOCKET_RECONNECT_FAILED,m),a.$on(b.SOCKET_ERROR,m)}])}),define("controllers/modal/ModalBarbarianBoostController",["app","helper/time"],function(a,b){a.controller("ModalBarbarianBoostController",["$scope","modelDataService","socketService","routeProvider","eventTypeProvider",function(a,c,d,e,f){var g="barbarian_boost_",h=[],i=b.timer,j=c.getGameData().getPremiumCosts(),k=function(b){return c.getPlayer().getPremium()>=a.cost[b]},l=function(b){k(b)&&d.emit(e.BARBARIAN_BOOST_PRODUCTION,{village_id:a.villageId,resource_type:b})},m=function(a){for(var c=a.length,d={};c--;)d[a[c].effect_type.replace(g,"")]=b.server2ClientTime(a[c].time_completed)-Date.now();return d},n=function(){a.effectDuration=m(h)},o=function(){d.emit(e.MAP_GET_VILLAGE_DETAILS,{my_village_id:c.getSelectedVillage().getId(),num_reports:0,village_id:a.villageId})},p=function(b,c){a.villageId===c.village_id&&o()},q=function(b,c){a.villageId===c.village_id&&(h=c.effects,n(),i.remove(n),i.add(n))};a.$on(f.BARBARIAN_PRODUCTION_BOOSTED,p),a.$on(f.MAP_VILLAGE_DETAILS,q),a.$on("$destroy",function(){i.remove(n)}),a.boost=l,a.hasEnoughPremium=k,a.cost={wood:j[g+"wood"],iron:j[g+"iron"],clay:j[g+"clay"]},a.boosted&&o()}])}),define("controllers/modal/ModalDailyLoginBonusController",["app"],function(a){a.controller("ModalDailyLoginBonusController",["$rootScope","$scope","$filter","modelDataService","groupService","windowManagerService","eventTypeProvider","iconAnimationsService","socketService","routeProvider",function(a,b,c,d,e,f,g,h,i,j){var k=d.getSelectedCharacter(),l=function(){var a={normal:"resources",lastDay:"resources-gold"},c=b.currentDay<b.days-1?a.normal:a.lastDay;b.currentDay===b.selectedDay&&i.emit(j.DAILY_LOGIN_BONUS_CLAIM_REWARD,null,function(){h.createAnimations([c]),b.closeWindow()})},m=function(a){b.selectedDay=a},n=function(){b.rewards=b.data.rewards,b.currentDay=b.data.login_chain,b.selectedDay=b.currentDay,b.days=b.rewards.length};b.characterName=k.getName(),b.blurSupport="webkit"===$.browser.vendor,b.claimReward=l,b.selectDay=m,n()}])}),define("controllers/modal/ModalShowHotkeyController",["app"],function(a){a.controller("ModalShowHotkeyController",["$scope","windowManagerService","storageService",function(a,b,c){var d,e,f=function(){a.helpVisible?(d=a.$new(),c.setItem("hasSeenHotkeys",!0),b.getModal("modal_show_hotkeys",d,function(){e=d.closeWindow,d.closeWindow=a.toggleCheatSheet})):d&&e()};a.$watch("helpVisible",f)}])}),define("controllers/modal/ModalInviteFriendController",["app"],function(a){a.controller("ModalInviteFriendController",["$rootScope","$scope","modelDataService","inviteFriendService","rewardService","errorTypeProvider","eventTypeProvider",function(a,b,c,d,e,f,g){var h,i=function(){b.closeWindow(),d.removeFakeVillage()},j=function(c,d){a.$broadcast(g.MESSAGE_ERROR,d),b.twxWindow.unblock()},k=function(){b.twxWindow.block(),b.$on(f.PLAYER_INVALID_EMAIL,j),b.$on(g.INVITE_FRIEND_INVITATION_SENT,i)},l=function(){var a=c.getSelectedCharacter(),d=a.getInviteInfo();h=d&&d.rewards,h&&(b.pointsNeeded=d.pointsNeeded,b.rewards=h,b.consent=!0,b.ownName=a.getName())};b.areInvitationParamsValid=d.areInvitationParamsValid,b.sendInvitation=d.sendInvitation,b.onSendInvitation=k,b.getIconName=e.getIconName,b.getDisplayedName=e.getDisplayedName,l()}])}),define("controllers/modal/ModalDonateResourcesController",["app","angular"],function(a,b){a.controller("ModalDonateResourcesController",["$rootScope","$scope","$timeout","modelDataService","socketService","tribeSkillService","routeProvider","eventTypeProvider","windowManagerService","premiumActionService",function(a,c,d,e,f,g,h,i,j,k){var l,m,n=e.getGameData().getBaseData(),o="premium",p=["wood","clay","iron","premium"],q=n.crown_to_exp_exponent,r=n.resource_to_exp_factor,s=250,t=e.getPlayer(),u=g.getMaxTribeLevel(c.skills),v=function(a){var b,d,e,f,h,i,j,k=c.tribeLevel+a,l=0,n=c.curAbsExp,o=m.premium,s=0;for(j=c.tribeLevel;u>j;j++)h=j===c.tribeLevel?g.getExpForLevelStep(c.tribeLevel)-c.curLevelExp:g.getExpForLevelStep(j),l+=h*r;for(j in c.rangeSlider)j!==p[3]&&(i=l,c.rangeSlider[j].max>i&&(c.rangeSlider[j].max=Math.round(i)));if(0===o)return void(c.rangeSlider.premium.max=0);if(k===u-1&&c.tribeLevel===u-1)return f=Math.ceil(Math.pow(k,q)),b=g.getExpForLevel(k+1)-n,d=Math.ceil(b/f),c.rangeSlider.premium.max=Math.min(o,d-1),void(n+=e*f);for(;u-1>k&&(k=g.getTribeLevel(c.skills,n),f=Math.ceil(Math.pow(k,q)),b=g.getExpForLevel(k+1)-n,d=Math.ceil(b/f),e=Math.min(o,d),s+=e,o-=e,n+=e*f,0!==o););if(b=g.getExpForLevel(k+1)-n,f=Math.ceil(Math.pow(k,q)),a!==u-c.tribeLevel-1){if(f>b&&c.tribeLevel===u-1||k===u)return void(c.rangeSlider.premium.max=0);o>0&&s--,c.rangeSlider.premium.max>s&&(c.rangeSlider.premium.max=s)}},w=function(a,b){(m.wood!==b.wood.currentProduction||m.clay!==b.clay.currentProduction||m.iron!==b.iron.currentProduction)&&(m.wood=b.wood.currentProduction,m.clay=b.clay.currentProduction,m.iron=b.iron.currentProduction,c.rangeSlider.wood.max=m.wood,c.rangeSlider.iron.max=m.iron,c.rangeSlider.clay.max=m.clay,v(c.levels))},x=function(){var a={wood:c.rangeSlider.wood.value,clay:c.rangeSlider.clay.value,iron:c.rangeSlider.iron.value,premium:c.rangeSlider[o].value};0===c.donation&&0===c.levels||c.exceededDonation||(c.rangeSlider[o].value?k.donateToTribe(a):f.emit(h.TRIBE_SKILL_DONATE,{village_id:e.getSelectedVillage().getId(),crowns:0,resources:{wood:a.wood,clay:a.clay,iron:a.iron}}))},y=function(){var b=a.$new();b.curLevelExp=c.curLevelExp,b.curAbsExp=c.curAbsExp,b.nextLevelExp=c.nextLevelExp,b.tribeLevel=c.tribeLevel,b.skills=c.skills,j.getModal("modal_mass_donation",b)},z=function(){var a,b,d,e,f,h,i,j,k,m=0;if(l=null,c.levels=0,c.exceededDonation=0,c.rangeSlider[o]){for(a in c.rangeSlider)a!==o&&(m+=c.rangeSlider[a].value);for(m=Math.floor(m/r),h=g.calcDonation(c.skills,m+c.curLevelExp,c.tribeLevel),k=h.levels+c.tribeLevel,i=c.rangeSlider[o].value,d=m+c.curAbsExp;i>0&&k!==u+1;)k=g.getTribeLevel(c.skills,d),b=g.getExpForLevel(k+1)-d,e=Math.ceil(b/Math.pow(k,q)),f=Math.min(i,e),i-=f,d+=f*Math.ceil(Math.pow(k,q));j=g.calcDonation(c.skills,d-c.curAbsExp+c.curLevelExp,c.tribeLevel),c.donation=j.remaingingExp,c.levels=j.levels,c.levels||(c.donation-=c.curLevelExp),c.newLevelEndExp=g.getExpForLevel(k+1),c.newLevelStartExp=g.getExpForLevel(k),c.maxLevelReached=c.levels+c.tribeLevel>=u,c.maxLevelReached&&(c.exceededDonation=d-g.getExpForLevel(u)),v(c.levels)}},A=function(a){var b,d;if(c.tribeLevel=g.getTribeLevel(c.skills,c.curAbsExp),c.curLevelExp=g.getCurrentLevelExp(c.curAbsExp,c.tribeLevel),c.nextLevelExp=g.getExpForLevel(c.tribeLevel+1),a)for(d=0;d<p.length;d++)b=p[d],c.rangeSlider[b].value=0;else z()},B=function(a,b){c.curAbsExp=b.new_power,A(!0)},C=function(a,b){var d,e,f;for(d in b.points)for(f=0;f<c.skills.length;f++)e=c.skills[f],e.type===d&&(e.currentLevel=b.points[d]);c.curAbsExp=b.power,A()},D=function(){m.premium=t.getPremium(),c.rangeSlider.premium.max=m.premium,v(c.levels)},E=function(){var a,d,f=e.getSelectedVillage();for(m=b.copy(f.getResources().getResources()),delete m.food,m.premium=t.getPremium(),c.newLevelExp=c.nextLevelExp,A(),d=0;d<p.length;d++)a=p[d],c.rangeSlider[a]={},c.rangeSlider[a].max=m[a];v(0)};c.rangeSlider={},c.donation=0,c.PREMIUM=o,c.RESOURCE_ORDER=p,c.RATIO=r,c.PREMIUM_RATIO=q,c.donation=0,c.levels=0,c.calcDonation=z,c.requestDonation=x,c.openMassDonation=y,c.pow=Math.pow,c.ceil=Math.ceil,c.$on(i.RESOURCES,w),c.$on(i.TRIBE_SKILL_REASSIGNED,C),c.$on(i.TRIBE_SKILL_DONATED,B),c.$on(i.PREMIUM_CHANGED,D),c.$watch("rangeSlider",function(){l||(l=d(z,s))},!0),E()}])}),define("controllers/modal/ModalDonationRankingController",["app"],function(a){a.controller("ModalDonationRankingController",["$scope","modelDataService","socketService","routeProvider","windowDisplayService","eventTypeProvider",function(a,b,c,d,e,f){var g={NAME:"name",HONOR_LAST_WEEK:"honor_last_week",HONOR_THIS_WEEK:"honor_this_week"},h=1e3,i=function(b){b===a.orderBy?a.asc=!a.asc:a.orderBy=b},j=function(b){e.openCharacterProfile(b),a.closeWindow()},k=function(){c.emit(d.TRIBE_SKILL_GET_DONATION_RANKING,{})},l=function(b,c){a.rankings=c},m=function(b,c){var d,e;for(d=0;d<a.rankings.length;d++)if(e=a.rankings[d],e.character_id===c.donor_id){e.honor_this_week=c.honor.honor_this_week,e.honor_total=c.honor.honor_total;break}};a.ORDER_TYPES=g,a.ownId=b.getSelectedCharacter().getId(),a.asc=!0,a.orderBy=g.HONOR_THIS_WEEK,a.rankings=[],a.HONOR_RATIO=h,a.setOrder=i,a.openCharacterProfile=j,a.$on(f.TRIBE_SKILL_DONATION_RANKING,l),a.$on(f.TRIBE_SKILL_DONATED,m),k()}])}),define("controllers/modal/ModalImproveSkillController",["app","helper/firework","conf/effectNames"],function(a,b,c){a.controller("ModalImproveSkillController",["$rootScope","$scope","$timeout","modelDataService","socketService","routeProvider","eventTypeProvider","tribeSkillService",function(a,d,e,f,g,h,i,j){var k,l=14e3,m=5,n=200,o=j.LEVELUP_TIMEOUT,p=!1,q=function(){var a,b,e;for(b=0;b<d.tiers.length;b++)for(a in d.tiers[b].skills)if(a===d.name){for(d.skill=d.tiers[b].skills[d.name],d.missingSkillPoints=d.tiers[b].missingSkillPoints,d.skillEffects=[],e=0;e<d.skill.effectItems[0].length;e++)d.skillEffects.push({name:c[d.skill.effectItems[0][e].type],skillBenefits:j.getLevelUpBenefits(d.skill,d.skill.effectItems[0][e].type)});break}},r=function(a){e(function(){d.particleAnimation[a]=!0},a*n)},s=function(){d.levelUpAnimation=!1},t=function(){var a;for(d.skillPoints--,d.WIDTH_ONE_SKILL_LEVEL||(d.WIDTH_ONE_SKILL_LEVEL=$(".progress-improve").width()/d.skill.maxLevel),d.levelUpAnimation=!0,e(s,o),a=0;m>a;a++)d.particleAnimation[a]=!1,r(a);k||(k=new b.FireworkSystem(32,"improve-skill-canvas")),d.skill.currentLevel===d.skill.maxLevel&&(k.play(),e(k.stop,l)),q()},u=function(){var a={};0!==d.skillPoints&&d.tribeRights[d.TRIBE_RIGHTS.SKILLS]&&!p&&(p=!0,a[d.skill.type]=1,g.emit(h.TRIBE_SKILL_ASSIGN_SKILL_POINTS,{points:a},function(){p=!1}))},v=function(){k&&k.stop()},w=function(){0!==d.skill.currentLevel&&(d.skillPoints++,d.skill.currentLevel--,q())};d.particleAnimation=[],d.TRIBE_RIGHTS=f.getGameData().getTribeRights(),d.improveSkill=u,d.decreaseSkill=w,d.$on("$destroy",v),d.$on(i.TRIBE_SKILL_ASSIGNED,t),q()}])}),define("controllers/modal/ModalMassDonationController",["app","angular"],function(a,b){a.controller("ModalMassDonationController",["$rootScope","$scope","$timeout","modelDataService","socketService","tribeSkillService","storageService","routeProvider","eventTypeProvider","groupService",function(a,b,c,d,e,f,g,h,i,j){var k,l,m=80,n=100,o=d.getSelectedCharacter(),p=o.getId(),q=d.getGameData(),r=function(a){var b,c=q.getResourceNames(),d="donation_",e="res_";for(a.resources=0,b=0;b<c.length;b++)"food"!==c[b]&&(a.resources+=a[d+c[b]]=Math.round(a[e+c[b]]/100*a.percentage))},s=function(){var a,c,d,e;for(b.resources=0,e=0;e<b.villages.length;e++)d=b.villages[e],d.included&&(b.resources+=d.resources);a=Math.floor(b.resources/n),c=f.calcDonation(b.skills,a+b.curLevelExp,b.tribeLevel),b.donation=c.remaingingExp,c.levels||(b.donation-=b.curLevelExp),b.levels=c.levels,b.newLevelEndExp=f.getExpForLevel(b.tribeLevel+b.levels+1),b.newLevelStartExp=f.getExpForLevel(b.tribeLevel+b.levels)},t=function(){b.tribeLevel=f.getTribeLevel(b.skills,b.curAbsExp),b.curLevelExp=f.getCurrentLevelExp(b.curAbsExp,b.tribeLevel),b.nextLevelExp=f.getExpForLevel(b.tribeLevel+1),s()},u=function(a,c){b.curAbsExp=c.new_power,t()},v=function(a,c){var d,e,f;for(d in c.points)for(f=0;f<b.skills.length;f++)e=b.skills[f],e.type===d&&(e.currentLevel=c.points[d]);b.curAbsExp=c.power,t()},w=function(a,b){b=parseInt(b,10),a.percentage=b.bound(0,100),r(a),l&&c.cancel(l),l=c(s,m)},x=function(a){var d,e;a=parseInt(a,10),b.maxPercentage=a.bound(0,100),g.setItem("tribeSkillsMassDonationMaxPercentage",b.maxPercentage),k&&c.cancel(k),k=c(function(){for(e=0;e<b.villages.length;e++)d=b.villages[e],w(d,a)},m)},y=function(){var a,c,d=[];if(0!==b.resources){for(c=0;c<b.villages.length;c++)a=b.villages[c],a.included&&d.push({id:a.village_id,resources:{wood:a.donation_wood,iron:a.donation_iron,clay:a.donation_clay}});e.emit(h.TRIBE_SKILL_DONATE_MASS,{villages:d}),b.closeWindow()}},z=function(a,c){b.villages=c.villages},A=function(){var a,c,d=[],e=0;for(c=0;c<b.villages.length;c++)a=b.villages[c],a.included&&(d.push(a.village_id),e++);b.allVillages=e===b.villages.length,s(),g.setItem("tribeSkillsMassDonationSelection"+p,d)},B=function(){var a,c,d,e=g.getItem("tribeSkillsMassDonationSelection"+p),f=0;if(e){for(c=0;c<b.villages.length;c++)for(a=b.villages[c],a.included=!1,d=0;d<e.length;d++)a.village_id===e[d]&&(a.included=!0,f++);b.allVillages=f===b.villages.length}},C=function(){b.groups=j.getGroups(),b.amountGroups=Object.keys(b.groups).length},D=function(a,b){e.emit(h.OVERVIEW_GET_VILLAGES,{count:d.getSelectedCharacter().getVillages().length,offset:0,sorting:"village_name",reverse:0,groups:a||[]},b)},E=function(a){var c,d=[];b.groupFilter[a]=!b.groupFilter[a];for(c in b.groupFilter)b.groupFilter[c]===!0&&d.push(c);D(d)},F=function(){var a;for(a=0;a<b.villages.length;a++)b.villages[a].included=b.allVillages;A()},G=function(){D(null,function(){x(g.getItem("tribeSkillsMassDonationMaxPercentage")||100),B()}),C(),b.newLevelExp=b.nextLevelExp};b.maxPercentage=100,b.groupFilter=[],b.displayedVillages=[],b.includedVillages=[],b.floor=window.Math.floor,b.setMaxPercentage=x,b.setPercentage=w,b.calcDonation=s,b.storeVillageSelection=A,b.donate=y,
b.toggleGroupFilter=E,b.selectAllVillages=F,b.$on(i.OVERVIEW_VILLAGES,z),b.$on(i.TRIBE_SKILL_REASSIGNED,v),b.$on(i.TRIBE_SKILL_DONATED,u),b.$on(i.GROUPS_CREATED,C),b.$on(i.GROUPS_DESTROYED,C),b.$on(i.GROUPS_UPDATED,C),G()}])}),define("controllers/modal/ModalInterstitialController",["app","conf/templates"],function(a,b){a.controller("ModalInterstitialController",["$rootScope","$scope","interstitialService","windowManagerService","modelDataService","crmService","$filter",function(a,c,d,e,f,g,h){var i,j=g.TYPES,k="modal_interstitial",l=h("i18n"),m=function(a){var b=a?a.payment_iframe_url:null;switch(i(),c.interstitial.cta_type){case j.CASH_SHOP:case j.CASH_SHOP_PACKAGE_TAB:case j.ITEM_SHOP:case j.INVENTORY:g.linkTo(c.interstitial.cta_type,null,b);break;case j.URI:case j.NONE:d.showNextInterstitial()}c.twxWindow.unblock(),c.closeWindow()},n=function(a){return c.twxWindow.block(),f.getSelectedCharacter().isInTutorial()?(d.acceptInterstitial(a),void m()):void d.acceptInterstitial(a).then(m)},o=function(f){var g=a.$new();g.submit=function(){d.rejectInterstitial(c.interstitial.campaign_id),g.closeWindow()},g.cancel=function(){d.showLastInterstitial(),g.closeWindow()},g.submitText=l("dismiss",a.loc.ale,k),g.cancelText=l("cancel",a.loc.ale,k),g.text=l("text",a.loc.ale,k),g.title=l("attention",a.loc.ale,k),e.getModal(b.MODAL.ATTENTION,g)};c.interstitial.cta_type===j.URI&&(c.interstitial.cta_value=c.interstitial.cta_value.replace(/\{\w+\}/,f.getPlayer().getId())),c.acceptInterstitial=n,i=c.$on("$destroy",o)}])}),define("controllers/modal/ModalAddCoopPartnerController",["app","angular"],function(a,b){a.controller("ModalAddCoopPartnerController",["$rootScope","$scope","socketService","routeProvider","eventTypeProvider","modelDataService","windowDisplayService",function(a,b,c,d,e,f,g){var h=function(a){c.emit(d.COOP_INVITE_PLAYER,{character_id:a})},i=function(){var a,c,d,e;for(b.filteredMembers=[],e=0;e<b.members.length;e++)d=b.members[e],a=d.name.toLowerCase(),c=b.query.toLowerCase(),-1!==a.indexOf(c)&&b.filteredMembers.push(d)},j=function(a){var c,d;for(d=0;d<b.members.length;d++)if(c=b.members[d],c.id===a)return void b.members.splice(d,1)},k=function(a,c){b.closeWindow(),g.openWriteMessageScreen([{type:"character",id:a,name:c}])},l=function(a,c){b.closeWindow()},m=function(){j(b.ownCharacterId),i()};b.ownCharacterId=f.getSelectedCharacter().getId(),b.query="",b.addPartner=h,b.filterMembers=i,b.writeMessage=k,b.$on(e.COOP_INVITATION_SENT,l),m()}])}),define("controllers/modal/ModalTribeSettingsController",["app","angular","helper/dataconversion"],function(a,b,c){a.controller("ModalTribeSettingsController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","eventTypeProvider","windowManagerService","errorTypeProvider",function(a,d,e,f,g,h,i,j,k){var l,m="i18n",n=function(){var b=a.$new(),c="screen_tribe",f=a.loc.ale;return l&&l.isModified()?(b.title=e(m)("discard_title",f,c),b.text=e(m)("discard_text",f,c),b.boxText=e(m)("discard_box_text",f,c),b.submitText=e(m)("discard_submit",f,c),b.cancelText=e(m)("discard_cancel",f,c),b.submit=function(){l.reset(),d.closeWindow(),b.closeWindow()},b.cancel=function(){b.closeWindow()},void j.getModal("modal_attention",b)):void d.closeWindow()},o=function(){var c=a.$new();c.category="tribe",c.selected=b.copy(l.achievements),c.maxAchievements=6,c.tribe=!0,j.getModal("modal_select_achievements",c)},p=function(){var b=a.$new();b.iconType="crest",b.icon=c.icon(null,d.icon),b.submit=function(a){l.icon=a,b.closeWindow()},b.cancel=function(){b.closeWindow()},j.getModal("modal_icon_generator",b)},q=function(b){var c=e("i18n")(b.name,a.loc.ale,"error_message");d.errors[b.name]=c},r=function(){l.isModified()&&(d.errors={},g.emit(h.TRIBE_CHANGE_SETTINGS,l.apiify(),function(a){d.closeWindow()})),(d.settings.name.length<3||d.settings.tag.length<3)&&d.settings.reset()};d.settings=l=f.getTribeSettings(),d.saveTribeSettings=r,d.discardSettings=n,d.generateCrest=p,d.setAchievements=o,d.errors={},d.TRIBE_NAME_ALREADY_TAKEN=k.TRIBE_NAME_ALREADY_TAKEN,d.TRIBE_TAG_ALREADY_TAKEN=k.TRIBE_TAG_ALREADY_TAKEN,d.TRIBE_NAME_CONTAINS_NO_LETTER=k.TRIBE_NAME_CONTAINS_NO_LETTER,d.TRIBE_TAG_CONTAINS_NO_LETTER=k.TRIBE_TAG_CONTAINS_NO_LETTER,d.TRIBE_TAG_TRIBE_NAME_FORBIDDEN_CHARACTER=k.TRIBE_NAME_FORBIDDEN_CHARACTER,d.$on(k.TRIBE_NAME_ALREADY_TAKEN,q),d.$on(k.TRIBE_TAG_ALREADY_TAKEN,q),d.$on(k.TRIBE_NAME_CONTAINS_NO_LETTER,q),d.$on(k.TRIBE_TAG_CONTAINS_NO_LETTER,q),d.$on(k.TRIBE_NAME_FORBIDDEN_CHARACTER,q)}])}),define("controllers/modal/ModalSelectAchievementsController",["app"],function(a){a.controller("ModalSelectAchievementsController",["$rootScope","$scope","achievementListService","modelDataService",function(a,b,c,d){var e=b.selected,f="tribe",g="character",h=c.getAchievementsData().achievements,i=function(a){var c=e.indexOf(a);return c>=0?void e.remove(c):0>c&&e.length<b.maxAchievements?void b.selected.push(a):void 0},j=function(){var a;switch(b.category){case f:a=d.getTribeSettings(),a&&(a.achievements=e);break;case"character":b.onSubmit&&b.onSubmit(e)}b.closeWindow()},k=function(a){return b.category===f?a.level&&a.category===f:b.category===g?a.level&&a.category!==f:!1};if(!b.category||!e)throw new Error;b.unlockedAchievements=Object.keys(h).map(function(a){return h[a]}).filter(k),b.toggleAchievement=i,b.submit=j}])}),define("controllers/modal/ModalTribeRelationController",["app"],function(a){a.controller("ModalTribeRelationController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider",function(a,b,c,d,e,f){var g,h="screen_tribe_diplomacy",i=function(a){b.selectedRelation=a},j=function(){return b.ownTag!==b.tag&&!!b.selectedRelation&&3===b.tag.length&&!!b.autoComplete.inputValueReadOnly&&b.autoComplete.inputValueReadOnly===g},k=function(a){b.tag=a.tag,g=a.name},l=function(){b.enabled()&&e.emit(f.TRIBE_RELATION_CHANGE,{tribe_tag:b.tag,relation:b.selectedRelation},function(a){a.error_code||b.closeWindow()})};b.autoComplete={type:["tribe"],placeholder:c("i18n")("add_tribe_by_tag_and_name",a.loc.ale,h),onEnter:k,keepSelected:!0},b.tag="",b.ownTag=d.getSelectedCharacter().getProperty("ownTribeTag"),b.selectRelation=i,b.enabled=j,b.addTribe=l,b.translateTribe=k}])}),define("controllers/screen/ReportBattleSupportController",["app"],function(a){a.controller("ReportBattleSupportController",["$scope","reportService","eventTypeProvider",function(a,b,c){var d=function(c){var d=c||a.data;b.extendScopeWithReportData(a,d)},e=function(a){d()},f=function(){d()};a.attUnits={},a.defUnits={},a.BATTLE_RESULTS=b.BATTLE_RESULTS,f(),a.$on(c.REPORT_SHOW,e)}])}),define("controllers/screen/ReportTradeAcceptedController",["app"],function(a){a.controller("ReportTradeAcceptedController",["$rootScope","$scope","modelDataService",function(a,b,c){var d=c.getSelectedCharacter().getId(),e=function(a){var b,c=d!==a.targetCharacterId,e={},f={};return e.amount=a.offeredAmount*a.count,e.type=a.offeredType,e.charId=a.originCharacterId,e.profileIcon=a.originProfileIcon,e.villageName=a.originVillageName,e.villageX=a.originVillageX,e.villageY=a.originVillageY,f.amount=a.requestedAmount*a.count,f.type=a.requestedType,f.charId=a.targetCharacterId,f.profileIcon=a.targetProfileIcon,f.villageName=a.targetVillageName,f.villageX=a.targetVillageX,f.villageY=a.targetVillageY,b=c?[f,e]:[e,f],b[1].own=!0,b},f=function(a){a&&"ReportTradeAccepted"===a.type&&(b.traders=e(b.data.ReportTradeAccepted))},g=function(){b.traderData={},b.ownData={}};b.$watch("data",f,!1),g()}])}),define("controllers/screen/ReportSupportController",["app","conf/reportTypes"],function(a,b){a.controller("ReportSupportController",["$scope","$filter","modelDataService",function(a,c,d){var e=b.REPORT_TYPES,f=function(b){var f,g;if(a.report=b[b.type],a.leftUnits=!1,a.type=b.type,a.returning=!1,a.outgoing=!1,a.barbarian=!a.report.targetCharacterId,a.barbarian&&(a.report.targetCharacterName=c("i18n")("barbarian_player",a.loc.ale,"screen_report")),a.report.allUnits){a.report.leftUnits={};for(g in a.report.units)f=a.report.allUnits[g]-a.report.units[g],f>0&&(a.leftUnits=!0,a.report.leftUnits[g]=f)}return b.type===e.supportRetracted?void(a.retracted=!0):b.type===e.supportBack?void(a.returning=!0):void(a.outgoing=a.report.originCharacterId===d.getSelectedCharacter().getId())};a.$watch("data",function(a){a&&(a.type===e.supportBack||a.type===e.supportRetracted||a.type===e.supportStart)&&f(a)},!1)}])}),define("controllers/screen/reports/tribe/InvitationController",["app"],function(a){a.controller("ReportTribeInvitationController",["$rootScope","$scope","windowManagerService","socketService","routeProvider","$filter","modelDataService",function(a,b,c,d,e,f,g){var h=function(g,h){if(b.invitations[b.data[b.data.type].tribeId]){var i=a.$new(),j="modal_decline_invitation";i.title=f("i18n")("title",a.loc.ale,j),i.text=f("i18n")("text",a.loc.ale,j),i.boxText=g,i.additionalText=f("i18n")("additional_text",a.loc.ale,j),i.submitText=f("i18n")("decline",a.loc.ale,j),i.submit=function(){d.emit(e.TRIBE_INVITATION_REJECT,{id:h}),i.closeWindow()},c.getModal("modal_attention",i)}},i=function(g,h){if(b.invitations[b.data[b.data.type].tribeId]){var i=a.$new(),j="modal_accept_invitation";i.title=f("i18n")("title",a.loc.ale,j),i.text=f("i18n")("text",a.loc.ale,j),i.boxText=g,i.submitText=f("i18n")("accept",a.loc.ale,j),i.submit=function(){d.emit(e.TRIBE_INVITATION_ACCEPT,{id:h}),i.closeWindow()},c.getModal("modal_attention",i)}};b.acceptInvite=i,b.declineInvite=h,b.invitations=g.getSelectedCharacter().getTribeInvitations().getData()}])}),define("controllers/screen/reports/tribe/ApplicationController",["app"],function(a){a.controller("ReportTribeApplicationController",["$rootScope","$scope","windowManagerService","socketService","routeProvider","$filter","eventTypeProvider",function(a,b,c,d,e,f,g){var h=function(g,h){if(b.data[b.data.type].isOpen){var i=a.$new(),j="modal_recruit_management";i.title=f("i18n")("reject_application",a.loc.ale,j),i.text=f("i18n")("reject_application_text",a.loc.ale,j),i.boxText=g,i.additionalText="",i.submitText=f("i18n")("submit",a.loc.ale,j),i.submit=function(){d.emit(e.TRIBE_APPLICATION_REJECT,{id:h}),i.closeWindow()},c.getModal("modal_attention",i)}},i=function(g,h){if(b.data[b.data.type].isOpen){var i=a.$new(),j="modal_accept_application";i.title=f("i18n")("title",a.loc.ale,j),i.text=f("i18n")("text",a.loc.ale,j),i.boxText=g,i.submitText=f("i18n")("submit",a.loc.ale,j),i.submit=function(){d.emit(e.TRIBE_APPLICATION_ACCEPT,{id:h}),i.closeWindow()},c.getModal("modal_attention",i)}},j=function(a,c){c.id===b.data[b.data.type].applicationId&&(b.data[b.data.type].isOpen=!1)};b.acceptInvite=i,b.declineInvite=h,b.$on(g.TRIBE_APPLICATION_REJECTED,j),b.$on(g.TRIBE_APPLICATION_ABORTED,j),b.$on(g.TRIBE_APPLICATION_ACCEPTED,j)}])}),define("controllers/screen/ReportPaladinController",["app"],function(a){a.controller("ReportPaladinController",["$rootScope","$scope","windowManagerService",function(a,b,c){var d=function(b){var d=a.$new();c.getScreenWithInjectedScope("building_statue",d)};b.openStatueBuilding=d}])}),define("controllers/screen/ReportListController",["angular","app","helper/time","helper/util","queues/EventQueue","conf/reportTypes"],function(a,b,c,d,e,f){b.controller("ReportListController",["$rootScope","$scope","$filter","reportService","eventTypeProvider","modelDataService","screenSharedReportListDataService","storageService",function(b,g,h,i,j,k,l,m){var n,o,p="choose",q={Delete:"delete",DeleteWithFavourites:"delete_with_favourites",MarkFavorite:"mark_as_favorite",MarkNonFavorite:"mark_as_non_favorite",MarkRead:"mark_as_read",MarkUnread:"mark_as_unread"},r={Link:"link_to_message"},s=k.getGameData(),t=function(){var b,c,d;if(g.activeFilters=m.getItem("reportFilters"),!g.activeFilters){g.activeFilters=a.copy(g.FILTERS);for(b in g.activeFilters)if(g.activeFilters.hasOwnProperty(b))switch(c=g.activeFilters[b],b){case"BATTLE_TYPES":case"OTHERS_TYPES":for(d in c)c.hasOwnProperty(d)&&(c[d]=!0);break;case"BATTLE_RESULTS":case"MISC":for(d in c)c.hasOwnProperty(d)&&c.hasOwnProperty(d)&&(c[d]=!1)}}},u=function(a){var b,c=s.getNewReportList();for(b in c)parseInt(b,10)===a&&(s.removeNewReport(a),i.markReportSeen([a]))},v=function(c){var d,e,f,h=[],k=s.getNewReportList();if(g.reports=c&&c.reports||[],g.unfilteredReports=a.copy(g.reports),g.pagination.offset=c&&c.offset||0,g.pagination.count=c&&c.total||0,l.setReportList(g.reports),g.calcVisibleReports(),f=l.getOpenReport(),g.reports.length){for(d=0;d<g.reports.length;d++)e=g.reports[d].id,f===e&&(g.openReportId=f),k[e]&&(h.push(e),s.removeNewReport(e));h.length&&i.markReportSeen(h)}delete g.reportsLoading,b.$broadcast(j.REPORT_PAGE_SWITCHED),l.setPageInfo(0===g.pagination.offset,g.pagination.offset>g.pagination.count-g.pagination.limit)},w=function(){g.reportsLoading=!0,n=g.searchQuery,i.requestReportList(g.selectedTab,g.pagination.offset,g.pagination.limit,g.searchQuery,g.activeFilters,function(a){v(a)})},x=function(){var a,b=[];for(a in g.selectedReports)g.selectedReports[a]&&b.push(a);return b},y=function(a){i.deleteReportsModal(a)},z=function(a,b){var c,d;for(c=0;c<b.reports.length;c++)d=i.getIndexOfReport(b.reports[c],g.reports),g.reports[d].read=a===!0?1:0},A=function(a,b,c){var d,e,f,h=[];for(d=0;d<a.length;d++)f=i.getIndexOfReport(a[d],g.reports),-1!==f&&(e=g.reports[f].favourite,b?c?e&&h.push(a[d]):h.push(a[d]):e||h.push(a[d]));return h},B=function(){var a,b,c,d,e=x();if(e.length>0)switch(g.selectedAction.value){case q.Delete:a=A(e,!1),y(a);break;case r.Link:for(b=[],d=0;d<g.reports.length;d++)c=g.reports[d],-1!==e.indexOf(c.id.toString())&&b.push(c);g.rteOnReportSelected&&g.rteOnReportSelected(b),g.closeWindow();break;case q.DeleteWithFavourites:a=A(e,!0),y(a);break;case q.MarkFavorite:a=A(e,!1),g.toggleReportFavorite(a);break;case q.MarkNonFavorite:a=A(e,!0,!0),g.toggleReportFavorite(a);break;case q.MarkRead:g.markReportRead(!0,e);break;case q.MarkUnread:g.markReportRead(!1,e)}},C=function(b,c){g.rteReportPicker&&b!==g.TAB_TYPES.Battle||(g.selectedTab=b,b===g.TAB_TYPES.Settings?i.getSettings(function(b){var c,d,e;for(c in b.settings)b.settings.hasOwnProperty(c)&&(d=c.substring(0,c.indexOf("_")),e=c.substring(c.indexOf("_")+1,c.length),void 0===g.settings[d]&&(g.settings[d]={}),g.settings[d][e]=1===b.settings[c]);g.tmpSettings=a.copy(g.settings)}):(c&&(g.activeFilters=a.copy(g.FILTERS)),g.pagination={count:0,offset:0,loader:w,limit:m.getPaginationLimit()},g.reports=[],w()))},D=function(a,b){g.reportsLoading||(g.reportsLoading=!0,m.setItem("reportFilters",g.activeFilters),g.selectTab(g.selectedTab))},E=function(){var a=$("#report-list"),b=a.find(".list-scroll").height(),c=41,d=a.find(".outer-scroll-wrap")[0];d&&(g.firstVisible=Math.max(Math.floor(d.scrollTop/c)-3,0),g.lastVisible=g.reports?Math.min(Math.floor((d.scrollTop+b)/c)+1,g.reports.length):0,a.find(".reports-margin-before").css("height",g.firstVisible*c+"px"),a.find(".reports-margin-after").css("height",(g.reports?g.reports.length-g.lastVisible:0)*c+"px"))},F=function(){null!==g.directives.scrollbar&&null!==g.directives.scrollbar["report-list"]&&g.directives.scrollbar["report-list"].recalc()},G=function(a){if(clearTimeout(o),a){if(!g.reports.length&&0===g.searchQuery.indexOf(n))return;o=setTimeout(function(){g.selectTab(g.selectedTab)},400)}else g.selectTab(g.selectedTab)},H=function(){return k.getGameData().getNewReportCount(["attack","defense","support","scouting"])},I=function(){return k.getGameData().getNewReportCount(["trade","system","misc"])},J=function(a,c){(g.selectedTab===i.TAB_TYPES.BATTLE&&-1!==Object.keys(i.BATTLE_TYPES).indexOf(c.type)||g.selectedTab===i.TAB_TYPES.OTHER&&-1!==Object.keys(i.OTHERS_TYPES).indexOf(c.type))&&g.unfilteredReports.unshift(c),(-1!==g.searchQuery.toLowerCase().indexOf(c.title.toLowerCase())||0===g.searchQuery.length)&&(g.reports=h("reportListFilter")(g.selectTab,g.unfilteredReports,g.activeFilters),g.totalReports++,-1!==i.getIndexOfReport(c.id,g.reports)&&u(c.id),b.$broadcast(j.REPORT_NEW_ON_LIST)),l.setReportList(g.reports)},K=function(a,c){var d="screen_report_list";b.$broadcast(j.MESSAGE_SUCCESS,{message:h("i18n")("save_confirmation",b.loc.ale,d)})},L=function(a,b){var c,d,e;for(c=0;c<b.reports.length;c++)d=i.getIndexOfReport(b.reports[c],g.reports),g.reports[d].favourite=0===g.reports[d].favourite?1:0,e=i.getIndexOfReport(b.reports[c],g.unfilteredReports),g.unfilteredReports[e].favourite=0===g.reports[e].favourite?1:0},M=function(a,b){null!==b.id&&(g.reports[i.getIndexOfReport(b.id,g.reports)].read=1),g.openReportId=b.id},N=function(){i.setSettings(g.tmpSettings,function(b){b?g.settings=a.copy(g.tmpSettings):g.tmpSettings=a.copy(g.settings)})},O=function(){var a;for(a=0;a<g.reports.length;a++)g.selectedReports[g.reports[a].id]=g.selectAll;g.selectAll=!g.selectAll},P=function(a,b){a?i.markReportRead(b):i.markReportUnread(b)},Q=function(a,b){z(!0,b)},R=function(a,b){z(!1,b)},S=function(a){g.expandedCategories[a]=!g.expandedCategories[a]},T=function(a){a.stopPropagation(),g.filterVisible=!g.filterVisible},U=function(a){$(a.target).matchesSelector(".outer-scroll-wrap")&&(g.filterVisible=!1)},V=function(a){return c.server2ClientTime(a)},W=function(a){return h("i18n")(a,b.loc.ale,"screen_report_list")},X=function(a){i.toggleReportFavorite(a)},Y=function(a,b){var c=g.pagination.offset;1===b?c+=g.pagination.limit:c-=g.pagination.limit,0>c||c>g.pagination.count||(g.pagination.offset=c,w())},Z=function(a,b){var c=b.reports.length;c&&(g.pagination.offset+c>=g.pagination.count&&(g.pagination.offset-=c),w())},_=function(){e.unregister(e.types.RESIZE,E)};g.reports=[],g.unfilteredReports=[],g.FILTERS=i.REPORT_FILTERS,g.HAUL_TYPES=i.HAUL_TYPES,g.RESULT_TYPES=f.RESULT_TYPES,g.activeFilters=null,g.openReportId=null,g.selectedReports={},g.totalReports=0,g.searchQuery="",g.filterVisible=!1,g.actionListVisible=!1,g.settings={},g.tmpSettings={},g.expandedCategories={},g.selectAll=!0,g.selectedAction={name:W(p),value:p},g.selectedTab=null,g.battleCount=H,g.miscCount=I,g.TAB_TYPES={Battle:i.TAB_TYPES.BATTLE,Others:i.TAB_TYPES.OTHER,Settings:"settings"},g.rteReportPicker?(g.ACTIONS=d.toActionList(r,W),g.selectedAction.name=W(r.Link),g.selectedAction.value=r.Link):g.ACTIONS=d.toActionList(q,W),g.pagination={count:0,offset:0,loader:w},g.reportsLoading=!0,g.showReport=i.showReport.bind(i),g.selectTab=C,g.executeActionOnSelectedReports=B,g.toggleFilter=D,g.searchReports=G,g.recalcScrollbar=F,g.calcVisibleReports=E,g.saveSettings=N,g.markReportRead=P,g.toggleReportSelection=O,g.toggleExpandedCategory=S,g.toggleFilterVisibility=T,g.getDate=V,g.toggleReportFavorite=X,g.hideFilters=U,g.$on(j.REPORT_NEW,J),g.$on(j.REPORT_TOGGLED_FAVOURITE,L),g.$on(j.REPORT_SHOW,M),g.$on(j.REPORT_DELETED,Z),g.$on(j.REPORT_SETTINGS_SAVED,K),g.$on(j.REPORT_MARKED_READ,Q),g.$on(j.REPORT_MARKED_UNREAD,R),g.$on(j.REPORT_SWITCH_PAGE,Y),g.$on("$destroy",_),g.$watch("reports",function(){var a;for(a in g.selectedReports)delete g.selectedReports[a];g.selectAll=!0},!0),g.$watch("selectedReports",function(){g.selectAll=x().length!==g.reports.length},!0),g.$watch("activeFilters",function(){var a;for(a=0;a<g.reports.length;a++)u(g.reports[a].id)},!0),t(),e.register(e.types.RESIZE,E),g.selectTab(g.TAB_TYPES.Battle)}])}),define("controllers/screen/ReportAchievementController",["app"],function(a){a.controller("ReportAchievementController",["$rootScope","$scope","windowManagerService","modelDataService",function(a,b,c,d){var e=d.getAchievementList().getAchievementsData(),f=function(b){var d=a.$new();d.jumpToType=b,c.getScreenWithInjectedScope("screen_achievements",d)};b.openAchievementScreen=f,b.achievementData=e.achievements}])}),define("controllers/screen/ReportController",["app","helper/time","helper/math","conf/reportTypes"],function(a,b,c,d){a.controller("ReportController",["$rootScope","$scope","reportService","eventTypeProvider","modelDataService","screenSharedReportListDataService","windowManagerService","windowDisplayService","linkService","mapService","rewardService",function(a,e,f,g,h,i,j,k,l,m,n){var o,p,q=function(){var b=a.$new();b.tribeId=p,j.getScreenWithInjectedScope("screen_tribe",b)},r=function(a){return b.server2ClientTime(a)},s=function(a,b){var c;if(void 0!==a)c=f.getIndexOfReport(a,e.reportList);else{if(void 0===b)throw new Error("either id or direction must be defined");if(isNaN(b))throw new Error("direction must be a number");c=(e.curReportIndex+b).bound(0,e.reportList.length-1)}return c===e.curReportIndex?-1:(e.curReportIndex=c,c)},t=function(a,b){s(b.id)},u=function(b){var c,d=0===e.curReportIndex&&-1===b,h=e.curReportIndex===e.reportList.length-1&&1===b;e.firstPage&&d||e.lastPage&&h||(d||h?(a.$broadcast(g.REPORT_SWITCH_PAGE,b),o=b):(c=s(void 0,b),-1!==c&&(f.getReport(e.reportList[c].id),e.reportList[c].read=1)))},v=function(){f.toggleReportFavorite([e.report.id])},w=function(a){switch(e.footer=!1,e.achievement=!1,e.trade=!1,e.tribe=!1,a){case e.REPORT_TYPES.attack:case e.REPORT_TYPES.supportAttacked:e.title="battle",e.footer=!0;break;case e.REPORT_TYPES.characterAchievement:case e.REPORT_TYPES.tribeAchievement:e.achievement=!0,e.title="achievement";break;case e.REPORT_TYPES.scouting:e.title="spy",e.footer=!0;break;case e.REPORT_TYPES.paladinItemImproved:case e.REPORT_TYPES.paladinItemUnlocked:e.title="paladin";break;case e.REPORT_TYPES.transportArrived:case e.REPORT_TYPES.tradeAccepted:e.title="trade",e.trade=!0;break;case e.REPORT_TYPES.supportStart:case e.REPORT_TYPES.supportBack:case e.REPORT_TYPES.supportRetracted:e.title="support";break;case e.REPORT_TYPES.tribeInvitation:case e.REPORT_TYPES.tribeApplicationAccepted:case e.REPORT_TYPES.tribeApplicationCreated:case e.REPORT_TYPES.tribeApplicationRejected:case e.REPORT_TYPES.tribeApplicationReminder:case e.REPORT_TYPES.tribeClosed:case e.REPORT_TYPES.tribeFounderChanged:case e.REPORT_TYPES.tribeInvitationAborted:case e.REPORT_TYPES.tribeInvitationAccepted:case e.REPORT_TYPES.tribeInvitationRejected:case e.REPORT_TYPES.tribeMemberKicked:e.title="tribe",e.tribe=!0}},x=function(){f.deleteReportsModal([e.report.id],function(){e.closeWindow()})},y=function(){var b,d,f,g,i,k=a.$new(),l=e.report[e.data.type],m=h.getGameData(),n=m.getTypedUnitNames();k.target={data:{barbarianVillage:0===l.defCharacterId?!0:!1},name:l.defVillageName,id:l.defVillageId},k.targetCharacterName=l.defCharacterName,k.distance=c.actualDistance(h.getSelectedVillage().getPosition(),{x:l.defVillageX,y:l.defVillageY}),k.rangeSlider={};for(g in n)for(i=0;i<n[g].length;i++)b=n[g][i],f=h.getSelectedVillage().getUnitInfoFor(b).in_town,d=l.attUnits[b],k.rangeSlider[b]={},k.rangeSlider[b].value=f>d?d:f;k.catapultTarget={},k.catapultTarget.value=l.building,k.officers={};for(g in l.officers)k.officers[g]={},k.officers[g].offers=[],k.officers[g].checked=l.officers[g];j.getModal("modal_custom_army",k)},z=function(){a.$broadcast("Internal/Report/show",{id:null})},A=function(a,b){var c;for(c=0;c<b.reports.length;c++)parseInt(b.reports[c],10)===e.report.id&&e.closeWindow()},B=function(a,b){var c;for(c=0;c<b.reports.length;c++)parseInt(b.reports[c],10)===e.report.id&&(e.report.favourite=0===e.report.favourite?1:0)},C=function(a,b){e.reportList=i.getReportList()},D=function(a,b){var c;e.data=b,e.icon=b[b.type].tribeIcon,e.noNavigation=!e.reportList,p=b[b.type].tribeId,f.showReport(b.id,!0),i.setOpenReport(b.id),w(b.type),c=i.getPageInfo(),e.firstPage=c.firstPage,e.lastPage=c.lastPage},E=function(){e.reportList=i.getReportList(),e.curReportIndex=1===o?0:e.reportList.length-1,-1!==e.curReportIndex&&(f.getReport(e.reportList[e.curReportIndex].id),e.reportList[e.curReportIndex].read=1)},F=function(){e.curReportIndex=Math.max(0,e.curReportIndex+1)},G=function(){e.reportData&&D(void 0,e.reportData),e.reportId&&f.getReport(e.reportId)};e.report={},e.title="",e.footer=!1,e.reportList=i.getReportList(),e.unitOrder=h.getGameData().getOrderedUnitNames(),e.REPORT_TYPES=d.REPORT_TYPES,e.RESULT_TYPES=d.RESULT_TYPES,e.HAUL_TYPES=f.HAUL_TYPES,e.ownCharacterId=h.getSelectedCharacter().getId(),e.toggleFavourite=v,e.deleteReport=x,e.pageReport=u,e.getDate=r,e.jumpToVillage=m.jumpToVillage,e.centerOnPosition=m.centerOnPosition,e.openCharacterProfile=k.openCharacterProfile,e.openTribeScreen=q,e.attackAgain=y,e.linkto=l.linkTo,e.openVillageInfo=k.openVillageInfo,e.openShop=k.openShop,e.getIconName=n.getIconName,e.getDisplayedName=n.getDisplayedName,e.$on("$destroy",z),e.$on(g.REPORT_NEW,C),e.$on(g.REPORT_VIEW,D),e.$on(g.REPORT_SHOW,t),e.$on(g.REPORT_DELETED,A),e.$on(g.REPORT_TOGGLED_FAVOURITE,B),e.$on(g.REPORT_PAGE_SWITCHED,E),e.$on(g.REPORT_NEW_ON_LIST,F),G()}])}),define("controllers/screen/BattleReportController",["app","conf/reportTypes"],function(a,b){a.controller("BattleReportController",["$scope","$filter","reportService","storageService",function(a,c,d,e){var f=b.REPORT_TYPES,g=b.RESULT_TYPES,h=function(){a.showCasual=!a.showCasual,e.setItem("reportBattleCasual",a.showCasual)},i=function(b){var c,e;d.extendScopeWithReportData(a,b),a.attWon?a.casualAttLost=!1:(c=a.report.result===g.DEFEAT,e=a.ownCharacterId===a.report[a.type].attCharacterId,a.casualAttLost=c&&e||!e&&!c)};a.attUnits={},a.defUnits={},a.BATTLE_RESULTS=d.BATTLE_RESULTS,a.toggleCasual=h,a.showCasual=e.getItem("reportBattleCasual"),a.$watch("data",function(a){a&&a.type===f.attack&&i(a)},!1)}])}),define("controllers/screen/SpyReportController",["app","conf/reportTypes"],function(a,b){a.controller("SpyReportController",["$scope","reportService","modelDataService",function(a,c,d){var e=b.REPORT_TYPES,f=function(b){c.extendScopeWithSpyReportData(a,b)};a.resourceOrder=d.getGameData().getResourceNames(),a.$watch("data",function(a){a&&a.type===e.scouting&&f(a)},!1)}])}),define("controllers/screen/BattlePreventedReportController",["app"],function(a){a.controller("BattlePreventedReportController",["$scope","reportService","eventTypeProvider",function(a,b,c){var d=function(c){var d=c||a.data;b.extendScopeWithBattlePreventedReportData(a,d)},e=function(a){d()},f=function(){d()};f(),a.$on(c.REPORT_SHOW,e)}])}),define("models/CommandListModel",[],function(){var a="S",b="A",c=function(c){if("number"==typeof c)return b+c;switch(c.type){case"attack":case"return_attack":case"incoming_attack":case"incoming_support":return b+c.id;case"scouting_buildings":case"scouting_units":case"scouting_return":return a+c.id;default:return b+c.id}},d=function(a,b){if(this.data=[],this.villageId=b,this.commandMap={},this.incoming=[],this.outgoing=[],this.incomingNoSpy=[],this.outgoingNoSpy=[],a)for(var c=a.length;c--;)this.add(a[c])};return d.prototype.belongsToVillage=function(a){return a?this.villageId===a||!this.villageId:!1},d.prototype.getCommands=function(a){return this.flush(a),this.data},d.prototype.getIncomingCommands=function(a,b){return this.flush(b),a?this.incomingNoSpy:this.incoming},d.prototype.getOutgoingCommands=function(a,b){return this.flush(b),a?this.outgoingNoSpy:this.outgoing},d.prototype.hasCommandsFor=function(a,b,c,d){var e,f,g=a.length;for(f=0;g>f;f++)if(e=a[f],!(d&&e.targetIsBarbarian||e.type!==b||e.returning!==!!c))return!0;return!1},d.prototype.getCommandsFor=function(a,b,c,d,e){var f,g,h=a.length,i=[];for(f=0;h>f;f++)g=a[f],d&&g.targetIsBarbarian||e&&g.targetVillageId!==e||g.type===b&&g.returning===!!c&&i.push(g);return i},d.prototype.getVillages=function(a,b,c,d){var e,f,g={},h=this.getCommandsFor(a,b,c,d);for(e=0;e<h.length;e++)f=h[e].targetVillageId,g[f]||(g[f]=!0);return g},d.prototype.hasCommands=function(a){var b,c=this.data.length;if(!a)return this.data.length;for(b=0;c>b;b++)if(!this.data[b].targetIsBarbarian)return!0;return!1},d.prototype.hasOutgoingAttack=function(a){return this.hasCommandsFor(this.outgoing,"attack",!1,a)},d.prototype.countIncoming=function(a,b,c){var d=this.getCommandsFor(this.incoming,a,!1,b,c);return d&&d.length||0},d.prototype.getVillagesForIncoming=function(a,b){return this.getVillages(this.incoming,a,!1,b)},d.prototype.hasReturningCommands=function(a){return this.hasCommandsFor(this.outgoing,"attack",!0,a)},d.prototype.add=function(a){var b,d=c(a);if((b=this.commandMap[d])&&this.remove(b),this.belongsToVillage(a.targetVillageId))this.incoming.push(a),a.isSpy||this.incomingNoSpy.push(a);else{if(!this.belongsToVillage(a.startVillageId))return;this.outgoing.push(a),a.isSpy||this.outgoingNoSpy.push(a)}this.data.push(a),this.commandMap[d]=a},d.prototype.remove=function(a){var b,d,e=a.id||a;if("number"==typeof a&&(a=this.has(e)),a){for(d=this.belongsToVillage(a.targetVillageId)?this.incoming:this.outgoing,b=d.length,delete this.commandMap[c(a)];b--;)if(d[b].id===e){d.remove(b);break}if(!a.isSpy)for(d=this.belongsToVillage(a.targetVillageId)?this.incomingNoSpy:this.outgoingNoSpy,b=d.length;b--;)if(d[b].id===e){d.remove(b);break}for(b=this.data.length;b--;)if(this.data[b].id===e){this.data.remove(b);break}}},d.prototype.has=function(a){return this.commandMap[c(a)]||null},d.prototype.flush=function(a){for(var b=a||Date.now(),c=this.data.length;c--;)this.data[c].completedAt<b&&this.remove(this.data[c])},d}),define("controllers/screen/UnitListController",["app","models/CommandListModel","models/CommandModel"],function(a,b,c){a.controller("UnitListController",["$scope","socketService","routeProvider","eventTypeProvider","modelDataService",function(a,d,e,f,g){var h,i,j,k=!1,l=g.getWorldConfig(),m=g.getSelectedCharacter(),n=g.getGameData().getOrderedUnitNames(),o=function(){d.emit(e.UNITSCREEN_SEND_SURPLUS_BACK,{village_id:a.villageId})},p=function(a){k||(k=!0,d.emit(e.VILLAGE_GET_UNITSCREEN_INFO,{village_id:a}))},q=function(a){var b,c,d={};for(b=0;b<n.length;b++)c=n[b],d[c]=a[c],delete a[c];return d},r=function(a,b){var c=a.village,d={},e={},f={};return f.id=a.id,f.type=a.command_type,f.direction=a.direction,f.time_start=a.time_start,f.time_completed=a.time_completed,f.units=q(a),d.id=c.village_id,d.name=c.village_name,d.x=c.village_x,d.y=c.village_y,d.characterId=c.character_id,d.character=c.character_name,e.id=j.getId(),e.name=j.getName(),e.x=j.getX(),e.y=j.getY(),e.characterId=m.getId(),e.character=m.getName(),b?(f.home=d,f.target=e):(f.home=e,f.target=d),f},s=function(a,b){var d,e,f,g;for(d=0;d<b.length;d++)f=b[d],g=r(f),e=new c(g),a.add(e)},t=function(a,b){var d,e,f=[];for(d=0;d<a.length;d++)e=new c(r(a[d],b)),b&&e.setDestination(!0),f.push(e);return f},u=function(c,d){d.village_id===g.getSelectedVillage().getId()&&(a.deffactor=d.deffactor,a.defArmies=t(d.defArmies,!0),a.awayArmies=t(d.awayArmies),i=new b([],g.getSelectedVillage().getId()),h=new b([],g.getSelectedVillage().getId()),s(i,d.outgoingArmies),s(h,d.incomingArmies),a.outgoingArmies=i.getCommands(),a.incomingArmies=h.getCommands(),a.foreignUnitFood=d.food.foreignUnitFood,a.maxSuppliableUnits=a.farmLevel*l.getFarmRule(),a.supplyUsedPercent=Math.round(a.foreignUnitFood/a.maxSuppliableUnits*100),k=!1)},v=function(){h&&h.flush(),i&&i.flush()},w=function(b,c){v(),c&&(c.home.id===a.villageId||c.target.id===a.villageId)&&p(a.villageId)},x=function(b,c){v(),c&&(c.home.id===a.villageId||c.target.id===a.villageId)&&p(a.villageId)},y=function(a,b){v(),p(g.getSelectedVillage().getId())},z=function(a,b){v()},A=function(b,c){c.villageId===a.villageId&&(v(),p(a.villageId))},B=function(){j=g.getSelectedVillage(),a.farmLevel=j.getBuildingLevel("farm"),a.villageId=j.getId(),p(a.villageId)};a.init=B,a.sendSurplusBack=o,a.isMinimized={def:!0,incommingDef:!0,ownTroops:!0,troopMovement:!0},a.$on(f.REPORT_NEW,v),a.$on(f.COMMAND_SENT,w),a.$on(f.COMMAND_SUPPORT_ARRIVED,B),a.$on(f.VILLAGE_RESOURCES_CHANGED,A),a.$on(f.VILLAGE_UNITSCREEN_INFO,u),a.$on(f.VILLAGE_UNIT_INFO,y),a.$on(f.VILLAGE_OWNER_CHANGED,z),a.$on(f.COMMAND_INCOMING,x),a.init()}])}),define("models/ConversationModel",["models/Contact","helper/time"],function(a,b){var c=function(a){var c={content:a.content,createdAt:b.server2ClientTime(a.time_created),id:a.id,author:{name:a.character_name,id:a.character_id,profileIcon:null===a.profile_icon?"system":a.profile_icon},meta:{campaignId:this.campaignId,unrestricted:0===this.authorId}};return a.fwd_character_id&&(c.forwarded=!0),
c},d=function(b){if(this.id=b.message_id,this.title=b.title,this.campaignId=b.campaign_id,this.authorId=b.author_id,this.messages=b.messages.map(c,this),this.participants=b.participants,this.messageCount=b.message_count,this.status=b.status,this.participants&&!this.participants.every(function(b){return b instanceof a}))throw new TypeError("participants must be contacts");this.messages&&this.messages.sortByProperty("createdAt")};return d.prototype.addMessage=function(a){var b=this.messages.length,d=c(a.message,this);for(this.messageCount=a.message_count;b--;)if(this.messages[b].createdAt<d.createdAt)return void this.messages.splice(b+1,0,d)},d.prototype.addOlderPosts=function(a){var b,d=a.messages.map(c,this);for(b=0;b<d.length;b++)this.messages.splice(0,0,d[b]);this.messageCount=a.message_count},d.prototype.addParticipants=function(a){this.participants.push.apply(this.participants,a)},d.prototype.removeParticipant=function(a){for(var b,c=this.participants.length;c--;)if(b=this.participants[c],b.id===a.id&&b.type===a.type)return void this.participants.remove(c)},d.prototype.getParticipants=function(){return this.participants},d.prototype.hasParticipant=function(a){for(var b=this.participants.length;b--;)if(this.participants[b].id===a.id&&this.participants[b].type===a.type)return!0;return!1},d}),define("controllers/screen/MessageScreenController",["angular","app","models/ConversationModel"],function(a,b,c){b.controller("MessageScreenController",["$rootScope","$scope","$filter","modelDataService","messagingService","windowManagerService",function(a,b,d,e,f,g){var h=e.getSelectedCharacter(),i="new_message",j=3,k=45,l={TRIBE:"tribe",CHARACTER:"character"},m=function(){return 0!==b.messageRecipients.length&&b.message.title.length.between(j,k)&&b.richTextEditor.valid},n=function(){if(m()){var a=b.messageRecipients.map(function(a){return{type:a.type,id:a.entity_id||a.id}}),c=b.richTextEditor.getBBCode(!0);b.attachedMessages.length?f.forwardMessage(a,b.message.title,c,b.attachedMessages.map(function(a){return a.id})):f.sendMessage(a,b.message.title,c),b.closeWindow()}},o=function(a){var c,d,e=b.messageRecipients;for(c=0;c<e.length;c++)if(d=e[c],d.id===a.id&&a.type===d.type)return!0;return!1},p=function(a){var c,d;for(c=0;c<a.length;c++)d=a[c],d&&!o(d)&&b.messageRecipients.push(d)},q=function(a){var c,d,e=b.messageRecipients;if(a)for(c=0;c<e.length;c++)if(d=e[c],d.id===a.id&&a.type===d.type){e.splice(c,1);break}},r=function(a){var c;for(c=0;c<b.attachedMessages.length;c++)if(b.attachedMessages[c].id===a)return void b.attachedMessages.splice(c,1)},s=function(a){b.attachedMessages=b.attachedMessages||[],b.attachedMessages.push({id:a.message_id,title:a.title})},t=function(){if(b.hasFriends){var a,c=b.$new();for(c.addRecipients=p,c.removeRecipient=q,c.selectedCharacters={},c.selectedTribes={},a=0;a<b.messageRecipients.length;a++)b.messageRecipients[a].type===l.TRIBE?c.selectedTribes[b.messageRecipients[a].id]=!0:c.selectedCharacters[b.messageRecipients[a].id]=!0;g.getModal("modal_add_contacts_to_conversation",c)}},u=function(){f.getFriendList(function(a){b.hasFriends=!(!a||!a.list||!a.list.character.length&&!a.list.tribe.length)}),h.setCurrentConversation(new c({id:"new",title:"",messages:[],participants:b.messageRecipients},!0)),b.recipients&&p(b.recipients)};b.MIN_SUBJECT_LENGTH=j,b.MAX_SUBJECT_LENGTH=k,b.hasFriends=!1,b.message={title:"",titlePlaceholder:d("i18n")("subject",a.loc.ale,i)},b.autoComplete={type:["character","tribe"],placeholder:d("i18n")("add_recipient",a.loc.ale,i),onEnter:function(a){p([a])},dropDown:!0},b.autoCompleteMessageTitle={type:"message",placeholder:d("i18n")("add_more_messages",a.loc.ale,i),onEnter:s,dropDown:!0},b.richTextEditor={},b.attachedMessages=b.attachedMessages||!1,b.messageRecipients=b.messageRecipients||[],b.isFriend=f.isFriend,b.addAsFriend=f.addFriend,b.removeAttachedMessage=r,b.canSend=m,b.send=n,b.friendList=t,b.addRecipients=p,u()}])}),define("controllers/screen/MessageListController",["app"],function(a){a.controller("MessageListController",["$rootScope","$scope","$filter","routeProvider","eventTypeProvider","windowManagerService","socketService","storageService","messagingService","modelDataService",function(a,b,c,d,e,f,g,h,i,j){var k=125,l=null,m=function(){f.getScreen("message_screen")},n=i.STATUSES,o=function(a,c){f.getOpenSubscreens("message_list").length||(b.messages=c.messages,b.pagination.count=c.total,b.pagination.offset=c.offset,b.paginationInfo=": "+(parseInt(b.pagination.offset/b.pagination.limit,10)+1)+" / "+(1+parseInt(b.pagination.count/b.pagination.limit,10)))},p=function(a){b.selectedTab=a,b.allSelected=!0,g.emit(d.MESSAGE_GET_LIST,{folder:a,offset:b.pagination.offset=0,count:b.pagination.limit,search:b.searchQuery||""})},q=function(a){var c=b.messages.length;for(i.openMessage(a);c--;)if(b.messages[c].message_id===a)return b.messages[c].has_read=1,void b.gameDataModel.removeNewMessage(a)},r=function(){var a=$("#message_list"),c=a.find("div.message-list-scroll").height(),d=41,e=$(".outer-scroll-wrap")[0].scrollTop,f=b.messages.length;b.firstVisible=Math.max(Math.floor(e/d)-3,0),b.lastVisible=Math.min(Math.floor((e+c)/d)+1,f),a.find(".reports-margin-before").css("height",b.firstVisible*d+"px"),a.find(".reports-margin-after").css("height",(f-b.lastVisible)*d+"px")},s=function(a,c,e){g.emit(d.MESSAGE_GET_LIST,{folder:b.selectedTab,offset:e,count:c,search:b.searchQuery||""}),b.selectedMessages={}},t=function(){b.messages.forEach(function(a){b.selectedMessages[a.message_id]=b.allSelected}),b.allSelected=!b.allSelected},u=function(d){b.actionListVisible=!b.actionListVisible,d&&(b.selectedAction={name:c("i18n")(d,a.loc.ale,"message_list"),value:d})},v=function(a){for(var c=b.messages.length;c--;)if(b.messages[c].message_id===a)return b.messages[c].title;return""},w=function(a){var c,d=[];for(c in b.selectedMessages)b.selectedMessages[c]&&d.push(a?{id:+c,title:v(+c)}:+c);return d},x=function(){s(null,b.pagination.limit,Math.max(0,b.pagination.offset-1))},y=function(e){{var h=a.$new(),i="delete_messages";j.getSelectedVillage()}h.title=c("i18n")("title",a.loc.ale,i,e.length),h.text=c("i18n")("description",a.loc.ale,i,e.length),h.submitText=c("i18n")("YES",a.loc.ale),h.cancelText=c("i18n")("NO",a.loc.ale),h.submit=function(){var a;for(g.emit(d.MESSAGE_DELETE,{message_ids:e},x),a=0;a<e.length;a++)b.gameDataModel.removeNewMessage(e[a]);h.closeWindow()},h.cancel=function(){h.closeWindow()},f.getModal("modal_attention",h)},z=function(){switch(b.selectedAction.value){case"inbox":case"favs":case"archive":g.emit(d.MESSAGE_MOVE_TO_FOLDER,{message_ids:w(),new_folder:b.TAB_TYPES[b.selectedAction.value]},x);break;case"delete":y(w());break;case"report":alert("The message hasn't been reported. Because it's not implemented yet.");break;case"forward":i.newMessage(null,w(!0));break;case"mark_read":i.markRead(w(),!0);break;case"mark_unread":i.markRead(w(),!1)}},A=function(){f.getModal("modal_friendlist")},B=function(){window.clearTimeout(l),l=window.setTimeout(function(){s(1,b.pagination.limit,b.pagination.offset)},k)},C=function(a,c){var d,e;for(d=0;d<b.messages.length;d++)for(e=0;e<c.message_ids.length;e++)b.messages[d].message_id===c.message_ids[e]&&(b.messages[d].has_read=1)},D=function(a,c){var d,e;for(d=0;d<b.messages.length;d++)for(e=0;e<c.message_ids.length;e++)b.messages[d].message_id===c.message_ids[e]&&(b.messages[d].has_read=0)},E=function(a,c){var d,e=j.getSelectedCharacter().getId();if(c.character_id===e)for(d=0;d<b.messages.length;d++)b.messages[d].message_id===c.message_id&&(b.messages[d].status=n.LEFT)},F=function(a,c){var d,e=j.getSelectedCharacter().getId();if(c.character_id===e)for(d=0;d<b.messages.length;d++)b.messages[d].message_id===c.message_id&&(b.messages[d].status=n.KICKED)};b.newMessage=m,b.openMessage=q,b.selectTab=p,b.toggleSelection=t,b.calcVisibleMessages=r,b.toggleActionList=u,b.executeAction=z,b.friendList=A,b.search=B,b.gameDataModel=j.getGameData(),b.allSelected=!0,b.TAB_TYPES={inbox:"inbox",favs:"favorite",archive:"archiv"},b.searchQuery="",b.STATUSES=n,b.queryVisible=!1,b.selectedMessages={},b.ACTIONS=["report","delete","forward","inbox","favs","archive","mark_read","mark_unread"].map(function(b){return{name:c("i18n")(b,a.loc.ale,"message_list"),value:b}}),b.selectedAction={name:c("i18n")("choose",a.loc.ale,"message_list"),value:"choose"},b.pagination={offset:0,loader:s,limit:h.getPaginationLimit()},b.$on(e.MESSAGE_LIST,o),b.$on(e.MESSAGE_NEW,x),b.$on(e.MESSAGE_SENT,x),b.$on(e.MESSAGE_MARKED_READ,C),b.$on(e.MESSAGE_MARKED_UNREAD,D),b.$on(e.MESSAGE_CHAR_KICKED,F),b.$on(e.MESSAGE_CHAR_LEFT,E),b.selectTab("inbox")}])}),define("controllers/screen/MessageViewController",["app"],function(a){a.controller("MessageViewController",["$rootScope","$scope","$filter","routeProvider","eventTypeProvider","socketService","messagingService","modelDataService","windowManagerService",function(a,b,c,d,e,f,g,h,i){var j,k=h.getSelectedCharacter(),l=!1,m=235,n=g.STATUSES,o=function(){return b.richTextEditor.valid},p=function(){if(o()){var a=b.richTextEditor.getBBCode(!0);g.reply(b.conversation.id,a)}},q=function(a,c){b.richTextEditor.quote(a,c)},r=function(){l?(l=!1,b.$$postDigest(function(){b.directives.scrollbar.scrollbar.content.scrollTop=$(".messageId-"+j).offset().top-m})):b.$$postDigest(function(){b.directives&&b.directives.scrollbar&&b.directives.scrollbar.scrollbar.tweenTo(0,1/0)})},s=function(b,c){var d,e=a.$new();c&&("character"===b?(d="screen_character_info",e.characterId=c):(d="screen_tribe",e.tribeId=c),i.getScreenWithInjectedScope(d,e))},t=function(a){var c;if(a.length){for(c=0;c<a.length;c++)a[c].entity_id=a[c].id;g.addContactsToConversation(a,b.conversation.id)}},u=function(a){b.conversation.participants.length>1&&(g.removeContactsFromConversation([b.conversation.participants[a].id],b.conversation.id),k.getCurrentConversation().participants.splice(a,1))},v=function(a){g.addFriend(a)},w=function(){var a=b.$new();a.addRecipients=b.addRecipients,a.conversation=k.getCurrentConversation(),i.getModal("modal_add_contacts_to_conversation",a)},x=function(){var a=b.$new();a.conversation=k.getCurrentConversation(),a.isFriend=g.isFriend,a.addAsFriend=b.addAsFriend,a.removeParticipant=b.removeParticipant,a.ownId=b.ownId,a.authorId=b.conversation.authorId,i.getModal("modal_participants_list",a)},y=function(){var e=a.$new(),g="message_leave";e.title=c("i18n")("title",a.loc.ale,g),e.text=c("i18n")("text",a.loc.ale,g),e.boxText=c("i18n")("box_text",a.loc.ale,g),e.submitText=c("i18n")("submit_text",a.loc.ale,g),e.cancelText=c("i18n")("cancel_text",a.loc.ale,g),e.switchColors=!0,e.submit=function(){f.emit(d.MESSAGE_LEAVE,{message_id:b.conversation.id},function(){b.closeWindow()}),e.closeWindow()},e.cancel=function(){e.closeWindow()},i.getModal("modal_attention",e)},z=function(a){f.emit(d.MESSAGE_GET,{message_id:b.conversationId,offset:b.conversation?b.conversation.messages.length:0,count:a,reverse:!0})},A=function(a,c,d){if(a){if(a.messageCount===a.messages.length)return;a.messages.length&&(j=a.messages[0].id)}l=d,z(a&&c?a.messageCount-a.messages.length:b.reloadAmount)},B=function(a){b.conversation=a,r()},C=function(a,c){var d=h.getSelectedCharacter().getId();c.character_id===d&&c.message_id===b.conversation.id&&(b.status=n.KICKED)},D=function(){var a=k.getCurrentConversation();f.emit(d.CHAR_GET_BASE_PROFILES,{character_ids:a.participants.map(function(a){return a.id})},function(b){var c,d,e,f;try{for(d in a.participants){e=a.participants[d];for(c in b.characters)f=b.characters[c],e.id===f.id&&void 0!==e.id&&(e.data=f)}}catch(g){}}),B(a)},E=function(a,c){var d=c.message_id;d===b.conversation.id&&(b.gameDataModel.removeNewMessage(d),g.markRead([d],!0),b.messageCount=b.conversation.messageCount,r())},F=function(){var a=k.getCurrentConversation();b.conversation&&a.id===b.conversationId?B(a):A()};if(b.STATUSES=n,b.gameDataModel=h.getGameData(),b.ownId=k.getId(),b.offset=0,b.reloadAmount=10,b.MAX_SHOWN_PARTICIPANTS=6,b.autoComplete={type:["character","tribe"],onEnter:function(a){t([a])},placeholder:c("i18n")("search_name",a.loc.ale,"message_view"),dropDown:!0},b.richTextEditor={},b.canReply=o,b.reply=p,b.addRecipients=t,b.removeParticipant=u,b.addAsFriend=v,b.friendList=w,b.attendeeList=x,b.isFriend=g.isFriend,b.openProfile=s,b.loadPosts=A,b.leaveConversation=y,b.addQuote=q,b.init=F,b.$on(e.MESSAGE_CHAR_KICKED,C),b.$on(e.MESSAGE_VIEW,D),b.$on(e.MESSAGE_NEW,E),b.$on("$destroy",function(){h.getSelectedCharacter().setCurrentConversation(null)}),!b.conversationId)throw new Error;F()}])}),define("helper/format",[],function(){var a=function(a){if(!a)return"";var b=[],c=a.name||a.village_name||"-",d=a.x||a.village_x,e=a.y||a.village_y;return b.push(c),void 0!==d&&void 0!==e&&(b.push(" ("),b.push(d),b.push("|"),b.push(e),b.push(")")),b.join("")};return{villageNameWithCoordinates:a}}),define("models/BuildingQueueModel",[],function(){var a=function(a){this.data=a,this.data.maxSlots=6,this.data.minSlots=2};return a.prototype.getVillageId=function(){return this.data.village_id},a.prototype.getJobById=function(a){var b,c=this.getQueue(),d=c?c.length:0;for(b=0;d>b;b++)if(c[b].id===a)return c[b];return null},a.prototype.setUnlockedSlots=function(a){this.data.unlocked_slots=a},a.prototype.setMaxSlots=function(a){this.data.maxSlots=a},a.prototype.addJob=function(a){this.data.queue.push(a)},a.prototype.removeJob=function(a){var b,c=this.getQueue(),d=c?c.length:0;for(b=0;d>b;b++)if(c[b].id===a)return c.splice(b,1),!0;return!1},a.prototype.getDataForBuilding=function(a){return this.data[a]||null},a.prototype.getQueue=function(){return this.data.queue||null},a.prototype.setQueue=function(a){this.data.queue=a},a.prototype.getUnlockedSlots=function(){return this.data.unlocked_slots},a.prototype.getMinSlots=function(){return this.data.minSlots},a.prototype.getMaxSlots=function(){return this.data.maxSlots},a.prototype.addSlot=function(){this.data.unlocked_slots<this.data.maxSlots&&this.data.unlocked_slots++},a}),define("models/BuildJobModel",["models/GenericJobModel","helper/time"],function(a,b){var c=function(a){this.id=a.id,this.building=a.building,this.level=a.level,this.type=a.type,this.startedAt=b.server2ClientTime(a.time_started),this.completedAt=b.server2ClientTime(a.time_completed),this.duration=this.completedAt-this.startedAt,Object.defineProperty(this,"finishedIn",{get:function(){return(this.completedAt-Date.now())/1e3}})};return c.inherits(a),c}),define("conf/commandTypes",[],function(){return{TYPES:{ATTACK:"attack",SUPPORT:"support"},DIRECTIONS:{OUTGOING:"outgoing",RETURNING:"returning"},ICON_KEYS:{ATTACK_OUTGOING:"attack-outgoing",SUPPORT_OUTGOING:"support-outgoing"}}}),define("controllers/screen/VillageInfoController",["app","helper/time","helper/math","helper/format","helper/dataconversion","models/CommandListModel","models/BuildingQueueModel","models/BuildJobModel","conf/effectTypes","conf/commandTypes"],function(a,b,c,d,e,f,g,h,i,j){a.controller("VillageInfoController",["$rootScope","$scope","modelDataService","socketService","routeProvider","eventTypeProvider","mapService","buildingService","buildingQueueService","reportService","windowDisplayService","premiumActionService","groupService","resourceService","effectService",function(a,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y=l.getGameData(),z=null,A=null,B=null,C=function(a){q.openCancelUpgradeModal(a)},D=function(a){u.instantBuild(a,k.villageId)},E=function(a){return b.server2ClientTime(a)},F=function(a){s.toggleReportFavorite(a)},G=function(){if(100===k.villageData.loyalty)return 100;var a=(Date.now()-b.server2ClientTime(k.villageData.res_last_update))/b.inMS.hour;return a=Math.max(a,0),~~w.computeLoyalty(a,k.villageData.loyalty)},H=function(a){return!a.returning||k.villageData.character_id===l.getSelectedCharacter().getId()},I=function(a){var b,c,d,g="back";if(a){if(a.foreign){for(b=a.foreign,d=0;d<b.length;d++)b[d].direction===g&&b.splice(d,1);c=b.map(e.command),z=new f(c),k.villageData.commands.foreign=z.data}a.own&&(c=a.own.map(e.command).filter(H),A=new f(c),k.villageData.commands.own=A.data)}},J=function(a,b){return b||a?b?a?(a.own&&b.own&&(a.own=a.own.concat(b.own)),a.foreign&&b.foreign&&(a.foreign=a.foreign.concat(b.foreign)),a):b:a:null},K=function(a){var d,e,f=x.getEffect(i.FARM_SPEED_INCREASE);for(k.own=!!a.building_queue,k.villageData=a,k.provinceData=a.province,k.attackProtected=!!a.attack_protection,k.villageX=a.village_x,k.villageY=a.village_y,k.distance=c.actualDistance(k.selectedVillage.getPosition(),{x:a.village_x,y:a.village_y}),k.villageData.province_bonus=k.villageData.province_bonus||0,k.supporting_units=a.supporting_units,I(J(a.commands,a.commands_scouting)),a.building_queue&&(B=new g({queue:a.building_queue.map(function(a){return new h(a)})}),k.villageData.buildingQueue=B.data.queue),d=0;d<k.unitOrder.length;d++)e=y.getUnit(k.unitOrder[d]).speed/l.getWorldConfig().getSpeed()*60,f&&k.barbarian&&(e/=f.getDetails().factor),k.unitArrivals[k.unitOrder[d]]=b.readableSeconds(k.distance*e);if(k.own)for(d in a.resources)k.villageData.resources[d]=~~a.resources[d];k.villageData.morale&&(k.villageData.morale=~~(100*k.villageData.morale)),k.villageData.last_reports&&k.villageData.last_reports.length&&s.markReportSeen(k.villageData.last_reports.map(function(a){return a.id}))},L=function(a){a&&(k.charProfileData=a,k.icon=a.profile_icon)},M=function(a,b){b.village_id===k.villageId&&k.villageData&&(k.villageData.village_name=b.name)},N=function(){k.groups=v.getVillageGroups(k.villageId)},O=function(){k.villageData&&v.openGroupsIndexModal(k.villageId,k.villageData.village_name)},P=function(a){var b=a.actionType;return a.actionType===j.TYPES.ATTACK&&k.villageId===a.startVillageId?b=j.ICON_KEYS.ATTACK_OUTGOING:a.actionType===j.TYPES.SUPPORT&&k.villageId===a.startVillageId&&(b=j.ICON_KEYS.SUPPORT_OUTGOING),b},Q=function(){m.emit(n.COMMAND_WITHDRAW_ALL_SUPPORT_FROM_VILLAGE,{village_id:k.villageId})},R=function(){var a;k.selectedVillage=l.getSelectedVillage(),k.unitOrder=y.getOrderedUnitNames(),k.resourceOrder=y.getResourceNames(),a={village_id:k.villageId,my_village_id:k.selectedVillage.getId(),num_reports:5},N(),m.emit(n.MAP_GET_VILLAGE_DETAILS,a,function(a){return a.character_id||(k.barbarian=!0),K(a),a.character_id?void m.emit(n.CHAR_GET_PROFILE,{character_id:a.character_id},L):(k.charProfileData={},void(k.icon="b"))})};k.unitArrivals={},k.icon="0",k.charId=!1,k.HAUL_TYPES=s.HAUL_TYPES,k.MIN_NAME_LENGTH=3,k.MAX_NAME_LENGTH=25,k.units=y.getOrderedUnitNames(),k.init=R,k.cancelJob=C,k.editGroups=O,k.completeNow=D,k.getDate=E,k.toggleReportFavorite=F,k.commandIconFilter=P,k.sendAllUnitsHome=Q,k.showReport=s.showReport,k.openChangeVillageName=t.openChangeVillageName,k.openTribeProfile=t.openTribeProfile,k.openCharacterProfile=t.openCharacterProfile,k.openProvinceScreen=t.openProvinceScreen,k.getCurrentLoyalty=G,k.centerOnPosition=p.centerOnPosition,k.villageNameWithCoordinates=d.villageNameWithCoordinates,k.commandIconFilter=P,k.$on(o.COMMAND_SENT,R),k.$on(o.COMMAND_CANCELLED,R),k.$on(o.COMMAND_RETURNED,R),k.$on(o.COMMAND_INCOMING,R),k.$on(o.COMMAND_WITHDRAWING_SUPPORT,R),k.$on(o.REPORT_TOGGLED_FAVOURITE,R),k.$on(o.REPORT_DELETED,R),k.$on(o.REPORT_NEW,R),k.$on(o.BUILDING_UPGRADING,R),k.$on(o.BUILDING_LEVEL_CHANGED,R),k.$on(o.BUILD_JOB_CANCELLED,R),k.$on(o.MAP_SELECT_VILLAGE,R),k.$on(o.GROUPS_DESTROYED,N),k.$on(o.GROUPS_UPDATED,N),k.$on(o.GROUPS_VILLAGES_CHANGED,N),k.$on(o.VILLAGE_NAME_CHANGED,M),R()}])}),define("controllers/screen/TribeController",["app","models/TribeSettingsModel"],function(a,b){a.controller("TribeController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","eventTypeProvider","windowManagerService","tribeService","errorTypeProvider",function(a,c,d,e,f,g,h,i,j,k){var l,m=function(){i.getScreen("screen_no_tribe")},n=function(){f.emit(g.TRIBE_GET_PROFILE,{tribe_id:c.tribeId})},o=function(a,b,d){var e;return"skills"===a&&(e=h.TRIBE_TAB_DISCARD_CHANGED_SKILLS),e&&c.$broadcast(e,{tabName:b,callback:d}),!!e},p=function(a,b){var c=e.getSelectedCharacter();b.id===c.getId()&&m(),n()},q=function(a){void 0===a&&(a=c.DEFAULT_TAB[c.ownTribe?"own":"foreign"]),c.activeTab!==a&&-1!==c.TABS.indexOf(a)&&(j.isOwnTribe(c.tribeId)||c.FOREIGN_TABS[a])&&(c.INACTIVE_TABS[a]||o(c.activeTab,a)||(c.activeTab=a))},r=function(){var a=function(){c.$parent.closeWindow()};o(c.activeTab,void 0,a)||a()},s=function(a,b){c.founderId=b.new_founder_id},t=function(a,d){l=new b(d),c.settings=l,e.setTribeSettings(l),c.tribeProfile=d,c.tribeProfile.averagePoints=Math.round(d.total_points/d.num_members),c.founderId=d.founder_id,c.selectedAchievements=d.achievements,c.settings.level=c.tribeProfile.level,c.tribeCrestLevel=j.getCrestLevel(c.settings.level),e.getSelectedCharacter().setProperty("ownTribeTag",d.tag),e.getSelectedCharacter().setProperty("ownTribeName",d.name),c.$broadcast(h.TRIBE_PROFILE_DATA_SET)},u=function(a,b){b?b():c.$emit(h.TRIBE_TAB_SET,{tabName:a})},v=function(){var a=e.getSelectedCharacter().getTribeId();c.tribeId=c.tribeId||a,c.ownTribe=c.tribeId===a,c.ownTribeId=a,c.isInCooperativeMode&&(c.INACTIVE_TABS.settings=!0,c.tribeRights[c.TRIBE_RIGHTS.MEMBERS]=!1,c.tribeRights[c.TRIBE_RIGHTS.RECRUIT]=!1),q(c.activeTab),n()},w=function(a,b){!b||!b.tabName,c.activeTab=b.tabName},x=function(a,b){n()},y=function(b,c){a.$broadcast(h.MESSAGE_SUCCESS,{message:d("i18n")("edit_saved",a.loc.ale,"screen_tribe")}),v()},z=function(a,b){!b||!b.tabName,c.ownTribe||(c.tribeId=e.getSelectedCharacter().getTribeId(),v()),q(b.tabName)},A=function(a,b){c.settings.level=b.level,c.tribeLevel=b.level,c.tribeCrestLevel=j.getCrestLevel(b.level)},B=function(a){var b={},c="right-",d="tribe-";return b[a.DIPLOMACY]=c+a.DIPLOMACY.toLowerCase(),b[a.FORUM]=c+a.FORUM.toLowerCase(),b[a.MEMBERS]=c+a.MEMBERS.toLowerCase(),b[a.PROFILE]=c+a.PROFILE.toLowerCase(),b[a.RECRUIT]=c+a.RECRUIT.toLowerCase(),b[a.SETTINGS]=c+a.SETTINGS.toLowerCase(),b[a.SKILLS]=d+a.SKILLS.toLowerCase(),b},C=function(){c.tribeNotFound=!0};c.isInCooperativeMode=e.getSelectedCharacter().isInCoopMode(),c.TABS=["tribe-profile","memberlist","diplomacy","forum","skills"],c.DEFAULT_TAB={own:"tribe-profile",foreign:"tribe-profile"},c.FOREIGN_TABS={"tribe-profile":!0,memberlist:!0},c.INACTIVE_TABS={noble:!0,wars:!0,quests:!0,skills:!e.getWorldConfig().isTribeSkillsFeatureEnabled()},c.TRIBE_RIGHTS=e.getGameData().getTribeRights(),c.rightIconNames=B(c.TRIBE_RIGHTS),c.tribeRights=e.getSelectedCharacter().getTribeRights(),c.setActiveTab=q,c.broadcastSetTab=u,c.closeWindow=r,c.init=v,c.$on(h.TRIBE_LEFT,m),c.$on(h.TRIBE_DISBANDED,m),c.$on(h.TRIBE_MEMBER_KICKED,p),c.$on(h.TRIBE_PROFILE,t),c.$on(h.TRIBE_FOUNDER_UPDATED,s),c.$on(h.TRIBE_TAB_SELECTED,z),c.$on(h.TRIBE_TAB_SET,w),c.$on(h.TRIBE_SETTINGS_CHANGED,y),c.$on(h.TRIBE_JOINED,x),c.$on(h.TRIBE_SKILL_REASSIGNED,A),c.$on(h.TRIBE_SKILL_DONATED,A),c.$on(k.TRIBE_NOT_FOUND,C),v()}])}),define("controllers/screen/TribeProfileController",["app","helper/util","helper/i18n","conf/tribeSkillNames"],function(a,b,c,d){a.controller("TribeProfileController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","eventTypeProvider","windowManagerService","tribeService","achievementListService","tribeApplicationsService","effectService",function(a,e,f,g,h,i,j,k,l,m,n,o){var p,q=function(b,d){return c.hasTranslation(b,d)?f("i18n")(b,a.loc.ale,d):null},r=function(){var b=a.$new(),c="modal_leave_tribe";e.coopPlayer||(b.title=f("i18n")("title",a.loc.ale,c),b.text=f("i18n")("text",a.loc.ale,c),b.boxText=e.tribeProfile.name,b.submitText=f("i18n")("submit",a.loc.ale,c),b.cancelText=f("i18n")("cancel",a.loc.ale,c),b.submit=function(){h.emit(i.TRIBE_LEAVE,{}),b.closeWindow()},b.cancel=function(){b.closeWindow()},k.getModal("modal_attention",b))},s=function(){var b=a.$new(),c="modal_disband_tribe";e.num_members>1||!e.ownTribe||(b.title=f("i18n")("disband_title",a.loc.ale,c),b.text=f("i18n")("disband_text",a.loc.ale,c),b.boxText=f("i18n")("disband_box_text",a.loc.ale,c),b.submitText=f("i18n")("disband_submit",a.loc.ale,c),b.cancelText=f("i18n")("disband_cancel",a.loc.ale,c),b.submit=function(){h.emit(i.TRIBE_DISBAND,{}),b.closeWindow()},b.cancel=function(){b.closeWindow()},k.getModal("modal_attention",b))},t=function(){var b=a.$new();b.tribeProfile=e.tribeProfile,k.getModal("modal_more_tribe_information",b)},u=function(){e.tribeRights[e.TRIBE_RIGHTS.PROFILE]&&l.isOwnTribe(e.tribeId)&&k.getModal("modal_tribe_settings")},v=function(a,b){e.unlockedAchievements=b.achievements},w=function(){var a;if(e.ownAchievementAmount=0,e.ownAchievementData)for(a in e.ownAchievementData.achievements)e.ownAchievementData.achievements[a].level&&0!==e.ownAchievementData.achievements[a].level&&"tribe"===e.ownAchievementData.achievements[a].category&&e.ownAchievementAmount++},x=function(b,c){var d=a.$new(),e="modal_accept_invitation";d.title=q("title",e),d.text=q("text",e),d.boxText=b,d.submitText=q("accept",e),d.submit=function(){h.emit(i.TRIBE_INVITATION_ACCEPT,{id:c}),d.closeWindow()},k.getModal("modal_attention",d)},y=function(b,c){var d=a.$new(),f="modal_decline_invitation";d.title=q("title",f),d.text=q("text",f),d.boxText=b,d.additionalText=q("additional_text",f),d.submitText=q("decline",f),d.submit=function(){h.emit(i.TRIBE_INVITATION_REJECT,{id:c}),d.closeWindow(),e.hasInvitation=!1},k.getModal("modal_attention",d)},z=function(b,c){var d=a.$new();g.getSelectedCharacter().getId()===c.character_id&&(e.closeWindow(),d.activeTab="tribe-profile",k.getScreenWithInjectedScope("screen_tribe",d))},A=function(a,b){g.getSelectedCharacter().getId()===b.character_id&&l.onTribeJoined(b,function(){e.closeWindow()})},B=function(){l.isOwnTribe(e.tribeId)?e.ownAchievementData=m.getAchievementsData():l.getAchievements(e.tribeId)},C=function(a){var b,c="increase_member_limit",f=o.getEffect(c);p&&(e.isTribeSkillMemberLimitActive=p.isSkillActive(d.member_limit)),f&&(e.memberLimitEffect=f.getDetails().increased_by,!a&&e.tribeProfile&&(b=p.getSkillContainingEffect(f.type),e.isTribeSkillMemberLimitActive&&b.currentLevel>0&&(e.tribeProfile.member_limit-=b.effectItems[b.currentLevel-1][0].increased_by),e.tribeProfile.member_limit+=e.memberLimitEffect))},D=function(){var a,b,c=e.tribeProfile.skills,f={};for(b in d)f[d[b]]=!1;for(a=0;a<c.length;a++)f.hasOwnProperty(c[a])&&(f[c[a]]=!0);e.allSkills=Object.keys(d).map(function(a){return d[a]}),e.learnedSkills=f},E=function(){p=g.getTribeSkills(),e.maxAchievements=6,e.hasInvitation=!1,e.applications=n.getApplications(),e.invitations=g.getSelectedCharacter().getTribeInvitations().getData(),e.ownAchievementData=null,e.ownAchievementAmount=0,e.unlockedAchievements=null,C(!0),B(),e.tribeProfile&&D()},F=function(a,b){var c,d=b.points;for(c in d)-1===e.tribeProfile.skills.indexOf(c)&&e.tribeProfile.skills.push(c);D(),C(!1)},G=function(){h.emit(i.TRIBE_GET_PROFILE,{tribe_id:e.tribeId})},H=function(){e.initialMemberLimit=e.tribeProfile.member_limit,D(),E()};e.leaveTribe=r,e.writeApplication=l.writeApplication,e.joinTribe=l.join,e.acceptInvitation=x,e.declineInvitation=y,e.openMoreTribeInfoModal=t,e.openTribeSettingsModal=u,e.disbandTribe=s,e.$on(j.TRIBE_SETTINGS_CHANGED,B),e.$on(j.TRIBE_ACHIEVEMENTS,v),e.$on(j.TRIBE_INVITATION_ACCEPTED,z),e.$on(j.TRIBE_JOINED,A),e.$on(j.TRIBE_PROFILE_DATA_SET,H),e.$on(j.EFFECT_CHANGED,C),e.$on(j.EFFECT_EXPIRED,C),a.$on(j.TRIBE_SKILL_ASSIGNED,F),a.$on(j.TRIBE_SKILL_REASSIGNED,G),e.$watch("ownAchievementData.achievements",w,!0),e.$watch("activeTab",function(a){"tribe-profile"===a&&(E(),b.checkFunc(function(){return e.directives},function(){e.directives.scrollbar.scrollbar.recalc()}))},!0)}])}),define("helper/bbcode",[],function(){var a="",b="span",c="br",d="p",e="a",f="font",g="color",h="size",i="crm_api",j="uri",k="LINK",l="TAG",m="ONE_TAG",n="open",o="closed",p="container",q={toBB:{5:"XL",4:"large",3:"medium",1:"small"},toHTML:{XL:"5",large:"4",medium:"3",small:"1"}},r={URL:"url",report:"report",autocomplete:["character","village","tribe"]},s={BB:{open:{beg:"[",end:"]"},close:{beg:"[/",end:"]"}},HTML:{open:{beg:"<",end:">"},close:{beg:"</",end:">"}}},t=function(b,c){var d,e,f=a;for(e in c)d=c[e],void 0!==d&&(f+=" "+e+'="'+c[e]+'"');return s.HTML.open.beg+b+f+s.HTML.open.end},u=function(a){return s.HTML.close.beg+a+s.HTML.close.end},v=function(b,c){return s.BB.open.beg+b+(void 0!==c?"="+c:a)+s.BB.open.end},w=function(a){return s.BB.close.beg+a+s.BB.close.end},x=v(c),y={toHTML:{before:[{name:"openHTMLTagChar",match:/</g,result:"&lt;"},{name:"closeHTMLTagChar",match:/>/g,result:"&gt;"}],after:[{name:"newLinesToBRTags",match:/\n/g,result:t(c)},{name:"recallAmpersand",match:/&amp;/g,result:"&"},{name:"openBBTagChar",match:/\[/g,result:"&#91;"},{name:"closeBBTagChar",match:/\]/g,result:"&#93;"}]},toBB:{before:[{name:"openBBTagChar",match:/\[/g,result:"&#91;"},{name:"closeBBTagChar",match:/\]/g,result:"&#93;"}],after:[{name:"specialSpacesToSpaces",match:/&nbsp;/g,result:" "},{name:"newlinesToEmpty",match:/\n*$/,result:a},{name:"lowerThen",match:/</g,result:"&lt;"},{name:"greaterThen",match:/>/g,result:"&gt;"}]}},z={b:l,i:l,u:l},A={b:l,i:l,u:l,br:m,color:f,size:f,quote:p,url:k,image:k,spoiler:k,building:k,unit:k,player:k,report:k,village:k,tribe:k},B={crm_api:k},C={bbCode:/(\[[^\[\]]+\])/,html:/(<[^<>]+>)/,quotes:/"/g,color:/#+/i},D=function(b,c){var d,e=new RegExp(c+'=".+?"'),f=b.match(e);return f&&(f=f[0])?(d=f.indexOf('"')+1,f=f.substring(d,f.indexOf('"',d))):a},E=function(a){var b,c=a.indexOf("=");if(-1!==c)return b=a.substring(c+1,a.length-1),b=b.replace(C.quotes,"")},F=function(b){var c=D(b,"data-bb-type"),d=D(b,"data-bb-value");if(c)return d===a&&(d=void 0),[c,d]},G=function(a,b){var c=b.length-1;return 0===b.indexOf(a.close.beg)&&b.indexOf(a.close.end)===c?o:0===b.indexOf(a.open.beg)&&b.indexOf(a.open.end)===c?n:void 0},H=function(a){var b=a.split(";"),c=b.shift(),d=b.reduce(function(a,b){var c,d;return b=b.split("="),c=b.shift(),d=b.join("="),a[c]=d,a},{});return{value:c,extra:d}},I=function(a,c){var d,o,r,v=G(s.BB,a),w=v&&a.match(/\w+/),x=v===n,y={};if(!v)return!1;if(!w||!w.length)return!1;if(w=w[0].toLowerCase(),d=c&&c.unrestricted?A[w]||B[w]:A[w],!w||!d)return!1;switch(x&&(o=E(a)),d===f?(w===h&&(y[h]=q.toHTML[o]),w===g&&(y[g]="#"+o)):(y={"data-bb-type":w,"data-bb-value":o},w===i&&(o&&(r=H(o),y["data-bb-value"]=r.value,0===o.indexOf(j)&&(y["data-bb-link"]=r.extra?r.extra.value:"")),c&&c.campaignId&&(y["data-bb-campaign"]=c.campaignId))),d){case m:return t(w);case l:return x?t(w):u(w);case p:return x?t(b,y):u(b);case k:return x?t(e,y):u(e);case f:return x?t(f,y):u(f)}return!1},J=function(g,h){var i,j=G(s.HTML,g),k=j&&g.match(/\w+/),l=j===n;if(!j)return!1;if(k=k[0],l){if(k===f&&(i=["size",q.toBB[D(g,"size")]],i[1]||(i=["color",D(g,"color").replace(C.color,a)]),i[1]||(i=void 0)),(k===e||k===b)&&(i=F(g)),i)return h.push(i[0]),v(i[0],i[1])}else if((k===b||k===e||k===f)&&h.length)return w(h.pop());return k===c?v(k):z[k]?l?v(k):w(k):k===d?l?a:"[br][br]":a},K=function(a,b){var c,d;for(c in a)d=a[c],b=b.replace(d.match,d.result);return b},L=function(a){for(var b;;)if(0!==a.indexOf(x)){if(b=a.length-x.length,0>b)break;if(a.lastIndexOf(x)!==b)break;a=a.substring(0,b)}else a=a.substring(x.length);return a},M=function(b,c){return b?(b=K(y.toHTML.before,b),b=b.split(C.bbCode),b=b.map(function(a){var b=I(a,c);return"string"==typeof b?b:a}).join(a),b=K(y.toHTML.after,b)):a},N=function(b){if(!b)return a;var c=[];return b=K(y.toBB.before,b),b=b.split(C.html),b=b.map(function(a){var b=J(a,c);return"string"==typeof b?b:a}).join(a),b=K(y.toBB.after,b),b=L(b)},O=function(a,b){var c="tribe";return v(c,b)+a+w(c)},P=function(a,b){var c="player";return v(c,b)+a+w(c)};return{toHTML:M,toBBCode:N,LINK_TYPES:r,FONT_SIZES:q,createTribeTag:O,createPlayerTag:P}}),define("controllers/screen/TribeNewsController",["app","helper/util","helper/bbcode"],function(a,b,c){a.controller("TribeNewsController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","eventTypeProvider","windowManagerService","storageService",function(a,d,e,f,g,h,i,j,k){
var l=0,m=5,n=[5,10,25],o="tribe-skills",p=function(){b.checkFunc(function(){return d.directives?d.directives.scrollbar:void 0},function(){setTimeout(function(){d.directives.scrollbar.scrollbar.recalc()},200)})},q=function(b){var f,g,h,i,j,k,l,m,n="tribe_event_types";for(l=b.entries.length;l--;){switch(i=b.entries[l],h=i.data,m=f=i.type,i.type){case"name_changed":g=h.character_name,h.tribe_tag&&h.tribe_name?(f="name_changed_both",j=h.tribe_name,k=h.tribe_tag):(h.tribe_tag&&(j=h.tribe_tag),h.tribe_name&&(j=h.tribe_name));break;case"member_kicked":g=c.createPlayerTag(h.character_name,h.character_id),j=c.createPlayerTag(h.member_name,h.member_id);break;case"member_left":case"member_joined":g=c.createPlayerTag(h.member_name,h.member_id);break;case"village_conquered":case"village_lost":g=h.character_name;break;case"war_declared":case"war_ended":g=c.createTribeTag(h.tribe_name,h.tribe_id);break;case"level_up":g=h.level,m=o;break;case"skill_points_assigned":case"skill_points_reset":g=c.createPlayerTag(h.character_name,h.character_id),m=o}b.entries[l].text=e("i18n")(f,a.loc.ale,n,g,j,k),b.entries[l].icon=m}d.log=b.entries,d.totalLog=b.total,d.pagination.count=b.total,p()},r=function(a,b,c,e){d.offset=0===a?0:a||d.offset,d.limit=0===b?0:b||d.limit,g.emit(c,{start:d.offset,count:d.limit},function(a){e(a)})},s=function(a,b,c){r(c,b,h.TRIBE_GET_LOG,q)},t=function(a,b){s()},u=function(){s()};d.offset=l,d.pagination={count:l,offset:l,loader:s,limit:m,limits:n},d.limit=d.pagination.limit,d.limits=d.pagination.limits,d.$on(i.TRIBE_SETTINGS_CHANGED,t),d.$on(i.TRIBE_JOINED,t),d.$on(i.TRIBE_SKILL_ASSIGNED,t),d.$on(i.TRIBE_SKILL_REASSIGNED,t),d.$on(i.TRIBE_SKILL_DONATED,t),u()}])}),define("controllers/screen/TribeDiplomacyController",["app","helper/util"],function(a,b){a.controller("TribeDiplomacyController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","windowManagerService","windowDisplayService",function(a,c,d,e,f,g,h,i){var j=function(){var b=a.$new();b.relationTypes=c.relationTypes,h.getModal("modal_tribe_relation",b)},k=function(a){0!==c.relations[a].length&&(c.relationExpanded[a]=!c.relationExpanded[a])},l=function(b,c,e){var i=a.$new(),j="screen_tribe_diplomacy";i.title=d("i18n")("modal_title",a.loc.ale,j),i.text=d("i18n")("modal_text",a.loc.ale,j,d("i18n")("section_"+e,a.loc.ale,j)),i.boxText=c,i.submitText=d("i18n")("modal_submit",a.loc.ale,j),i.cancelText=d("i18n")("modal_cancel",a.loc.ale,j),i.submit=function(){f.emit(g.TRIBE_RELATION_CHANGE,{tribe_tag:b,relation:null}),i.closeWindow()},i.cancel=function(){i.closeWindow()},h.getModal("modal_attention",i)};c.edit=c.tribeRights[c.TRIBE_RIGHTS.DIPLOMACY],c.relationTypes=["ally","nap","enemy"],c.relationExpanded={ally:!0,nap:!0,enemy:!0},c.addTribe=j,c.toggleExpanded=k,c.deleteTribe=l,c.openTribeProfile=i.openTribeProfile,c.$watch("activeTab",function(a){"diplomacy"===a?(c.relations=e.getSelectedCharacter().getTribeRelations().relations,b.checkFunc(function(){return c.directives},function(){c.directives.scrollbar.scrollbar.recalc()})):delete c.relations},!0)}])}),define("controllers/screen/TribeMemberListController",["app","helper/util"],function(a,b){a.controller("TribeMemberListController",["$rootScope","$scope","$filter","modelDataService","socketService","routeProvider","eventTypeProvider","windowManagerService","windowDisplayService","tribeService","orderTypeProvider",function(a,c,d,e,f,g,h,i,j,k,l){var m=!1,n=e.getSelectedCharacter().getId(),o={semi:1728e5,inactive:6048e5},p={reset:"reset",leader:"leader",diplomat:"diplomat",forum_admin:"forum_admin",recruiter:"recruiter",warlord:"warlord"},q={rank:"local_rank",name:"name",points:"points",villages:"villages",global_rank:"global_rank",honor_points:"honor"},r=function(a){a===c.order.field?c.order.direction=l.toggle(c.order.direction):(c.order.field=a,c.order.direction=l.DEFAULT)},s=function(a){return c.applications.filter(function(b){return b.id===a})[0]},t=function(){return 1===c.members.length},u=function(a){t()||f.emit(g.CHAR_GET_BASE_PROFILES,{character_ids:c.members.map(function(a){return a.id})},function(a){var b,d,e=c.$new(),f=function(c){return c.id===a.characters[b].id};for(b=0;b<a.characters.length;b++)d=c.members.filter(f)[0],d.icon=a.characters[b].profile_icon;e.selectedMemberId=c.founderId,e.selectMember=function(a){e.selectedMemberId=a},e.submit=function(a){k.setFounder(a),e.closeWindow()},i.getModal("modal_set_founder",e)})},v=function(b){if(!t()){var e,h=c.$new();h.selectedRights={};for(e in b.rights)h.selectedRights[e]=!0;h.presetOrder=[p.reset,p.leader,p.diplomat,p.forum_admin,p.recruiter,p.warlord],h.PRESET_NAMES=p,h.selectedPreset=p.reset,h.id=b.id,h.name=b.name,h.customTitle=b.title||"",h.trustedMember=b.trusted,h.founder=b.id===c.founderId,h.selectPreset=function(b){if(h.resetRights(),b===p.reset)return void h.resetPreset();var c;for(h.customTitle=d("i18n")(b,a.loc.ale,"preset_names"),c=0;c<h.presets[b].length;c++)h.selectedRights[h.presets[b][c].toUpperCase()]=!0;h.selectedPreset=b},h.resetRights=function(){var a;for(a in h.TRIBE_RIGHTS)delete h.selectedRights[a]},h.toggleSelectedRight=function(a){h.selectedRights[a]=!h.selectedRights[a]},h.resetPreset=function(a){h.selectedPreset=p.reset,a||(h.customTitle="")},h.submit=function(){var a,c=[];if(h.customTitle!==b.title&&f.emit(g.TRIBE_SET_MEMBER_TITLE,{member_id:b.id,title:h.customTitle}),b.id===h.founderId)return void h.closeWindow();h.trustedMember!==b.trusted&&f.emit(g.TRIBE_SET_MEMBER_TRUSTED,{member_id:b.id,trusted:h.trustedMember});for(a in h.selectedRights)h.selectedRights[a]&&c.push(a.toLowerCase());f.emit(g.TRIBE_SET_MEMBER_RIGHTS,{member_id:b.id,rights:c}),h.closeWindow()},i.getModal("modal_edit_rights",h)}},w=function(b,e){var f=a.$new(),g="modal_recruit_management";b===c.founderId||b===n||c.isInCooperativeMode||(f.title=d("i18n")("kick_title",a.loc.ale,g),f.text=d("i18n")("kick_text",a.loc.ale,g),f.submitText=d("i18n")("submit",a.loc.ale,g),f.cancelText=d("i18n")("cancel",a.loc.ale,g),f.boxText=e,f.submit=function(){k.kickMember(b),f.closeWindow()},f.cancel=function(){f.closeWindow()},i.getModal("modal_attention",f))},x=function(b,c,e){var h=a.$new(),j="modal_recruit_management",k="application"===e?"reject":"revoke",l="application"===e?g.TRIBE_APPLICATION_REJECT:g.TRIBE_INVITATION_ABORT;h.title=d("i18n")(k+"_"+e,a.loc.ale,j),h.text=d("i18n")(k+"_"+e+"_text",a.loc.ale,j),h.boxText=c,h.submitText=d("i18n")("submit",a.loc.ale,j),h.cancelText=d("i18n")("cancel",a.loc.ale,j),h.submit=function(){f.emit(l,{id:b}),h.closeWindow()},h.cancel=function(){h.closeWindow()},i.getModal("modal_attention",h)},y=function(b){var c=a.$new();c.text=s(b).message,i.getModal("modal_application_text",c)},z=function(b,c){var e=a.$new(),h="modal_accept_application";e.title=d("i18n")("title",a.loc.ale,h),e.text=d("i18n")("text",a.loc.ale,h),e.boxText=c,e.submitText=d("i18n")("submit",a.loc.ale,h),e.cancelText=d("i18n")("cancel",a.loc.ale,h),e.submit=function(){f.emit(g.TRIBE_APPLICATION_ACCEPT,{id:b}),e.closeWindow()},e.cancel=function(){e.closeWindow()},i.getModal("modal_attention",e)},A=function(){var b=a.$new();b.autoComplete={type:["character"],placeholder:d("i18n")("placeholder",a.loc.ale,"modal_invite_player"),inputBorder:!0,keepSelected:!0},b.submit=function(){k.inviteCharacter(b.autoComplete.inputValueReadOnly),b.closeWindow()},i.getModal("modal_invite_player",b)},B=function(){var b=a.$new();f.emit(g.TRIBE_GET_WELCOME_MESSAGE,{},function(a){b.message=a.message}),b.submit=function(){f.emit(g.TRIBE_CHANGE_WELCOME_MESSAGE,{message:b.message}),b.closeWindow()},i.getModal("modal_edit_welcome_message",b)},C=function(a,b){c.invitations=b.invitations},D=function(a,b){c.applications=b.applications},E=function(){f.emit(g.TRIBE_INVITATION_GET_TRIBE_INVITATIONS)},F=function(){f.emit(g.TRIBE_APPLICATION_GET_TRIBE_APPLICATIONS)},G=function(){var b=a.$new();c.isInCooperativeMode||(F(),E(),b.openCharacterInfo=j.openCharacterProfile,b.removeCharacter=function(a,b,c){x(a,b,c)},b.showApplication=function(a){y(a)},b.acceptApplication=function(a,b){z(a,b)},b.invitePlayer=function(){A()},b.editWelcomeMessage=function(){B()},c.$watch("applications",function(){b.applications=c.applications}),c.$watch("invitations",function(){b.invitations=c.invitations}),i.getModal("modal_recruit_management",b))},H=function(){var a=c.$new();c.isInCooperativeMode||(a.kickMember=function(a,b){w(a,b)},a.editRights=function(a){v(a)},a.openSetFounderModal=function(){u(a)},i.getModal("modal_right_management",a))},I=function(a){var b,c,d,e=Date.now();for(b=0;b<a.length;b++)c=a[b],c.last_login&&(d=e-1e3*c.last_login,d>=o.inactive?c.activity="inactive":d>=o.semi?c.activity="semi":c.activity="active")},J=function(a,b){var c,d;for(a.rights||(a.rights={}),c=0;c<b.length;c++)d=b[c].toUpperCase(),a.rights[d]=!0},K=function(a){var b,c,d;for(b=0;b<a.length;b++)c=a[b],d=c.rights,delete c.rights,J(c,d)},L=function(){f.emit(g.TRIBE_GET_RIGHT_PRESETS,{})},M=function(a,b){var d,e={};for(d=0;d<b.presets.length;d++)e[b.presets[d].name]=b.presets[d].rights;c.presets=e},N=function(a){m||(m=!0,f.emit(g.TRIBE_GET_MEMBERLIST,{tribe:c.ownTribe?null:c.tribeId},function(){m=!1}))},O=function(a){var b;for(a.sortByProperty("points",!0),b=0;b<a.length;b++)a[b].local_rank=b+1},P=function(a,b){O(b.members),I(b.members),c.ownTribe&&K(b.members),c.members=b.members},Q=function(a,b){var d;for(d=0;d<c.members.length;d++)c.members[d].id===b.id&&c.members.remove(d)},R=function(a,b){var d=c.members.filter(function(a){return a.id===b.new_founder_id})[0];d&&J(d,Object.keys(e.getGameData().getTribeRights()))},S=function(){L(),N()};c.applications=[],c.invitations=[],c.characterId=n,c.PRESET_NAMES=p,c.ORDER_TYPES=q,c.orderTypeProvider=l,c.order={field:q.rank,direction:l.ASC},c.openCharacterInfo=j.openCharacterProfile,c.openRecruitManagement=G,c.openRightManagement=H,c.setOrder=r,c.isOnlyMember=t,c.kickMember=w,c.$watch("activeTab",function(a){"memberlist"===a&&(S(),b.checkFunc(function(){return c.directives},function(){c.directives.scrollbar.scrollbar.recalc()}))},!0),c.$on(h.TRIBE_APPLICATION_ACCEPTED,F),c.$on(h.TRIBE_APPLICATION_REJECTED,F),c.$on(h.TRIBE_APPLICATION_ABORTED,F),c.$on(h.TRIBE_APPLICATION_CREATED,F),c.$on(h.TRIBE_APPLICATION_INDEX,D),c.$on(h.TRIBE_INVITATION_ACCEPTED,E),c.$on(h.TRIBE_INVITATION_REJECT,E),c.$on(h.TRIBE_INVITATION_ABORTED,E),c.$on(h.TRIBE_INVITATION_CREATED,E),c.$on(h.TRIBE_INVITATION_INDEX,C),c.$on(h.TRIBE_MEMBER_LIST,P),c.$on(h.TRIBE_JOINED,N),c.$on(h.TRIBE_MEMBER_RIGHTS_SET,N),c.$on(h.TRIBE_MEMBER_TITLE_SET,N),c.$on(h.TRIBE_MEMBER_TRUSTED_SET,N),c.$on(h.TRIBE_MEMBER_KICKED,Q),c.$on(h.TRIBE_FOUNDER_UPDATED,R),c.$on(h.TRIBE_PRESETS_INDEX,M),c.$on(h.TRIBE_APPLICATION_ACCEPTED,N),c.$on(h.TRIBE_INVITATION_ACCEPTED,N)}])}),define("controllers/screen/TribeSkillController",["app","models/TribeSkillModel","conf/tribeSkillNames"],function(a,b,c){a.controller("TribeSkillController",["$rootScope","$scope","$timeout","$filter","modelDataService","socketService","routeProvider","eventTypeProvider","tribeSkillService","windowManagerService","tribeService",function(a,b,d,e,f,g,h,i,j,k,l){var m=1e3,n=f.getWorldConfig().getTribeMemberLimit(),o=0,p=function(a){var c,d;for(d=0;d<b.skills.length;d++)if(c=b.skills[d],c.type===a)return c;return null},q=function(a){var d,e,f,g,h;return e=p(c.member_limit),f=e.currentLevel,e.currentLevel=a,g=j.getLevelUpBenefits(e,null),h=parseInt(g[0],10),e.currentLevel=f,d=b.skillReset?n+h:b.tribeProfile.member_limit,b.tribeProfile.num_members<=d},r={member_limit_requirement:function(a){return a.type===c.member_limit?!0:q(p(c.member_limit).currentLevel)},tier_unlocked_requirement:function(a,c){return 0===b.tiers[c].missingSkillPoints}},s=function(a){return a.type===c.member_limit?q(a.currentLevel-1):!0},t=function(){var c=a.$new();c.curLevelExp=b.curLevelExp,c.nextLevelExp=b.nextLevelExp,c.tribeLevel=b.tribeLevel,c.skills=b.skills,c.curAbsExp=b.curAbsExp,k.getModal("modal_donate_resources",c)},u=function(c){if(!b.skillReset){var d=a.$new();d.name=c,d.skillPoints=b.skillPoints,d.tiers=b.tiers,d.skillReset=b.skillReset,d.blurSupport=b.blurSupport,d.requirements=b.requirements,d.requirementsMessages=b.requirementsMessages,d.tribeRights=b.tribeRights,k.getModal("modal_improve_skill",d)}},v=function(a,b){var c,d={},e=!0;for(c in r)d[c]=r[c](a,b),d[c]||(e=!1);return d.enabled=e,d.decreaseAllowed=s(a),d},w=function(){var a,c,d,e;for(a=0;a<b.tiers.length;a++)b.tiers[a].missingSkillPoints=j.getMissingSkillPoints(b.skills,a);for(b.requirements={},a=0;a<b.tiers.length;a++){e=b.tiers[a].skills;for(c in e)d=e[c],b.requirements[d.type]=v(d,a)}},x=function(){b.tiers=j.createTierData(b.skills),b.tribeLevel=j.getTribeLevel(b.skills,b.curAbsExp),b.skillPoints=j.getAvailableSkillPoints(b.skills,b.tribeLevel),b.curLevelExp=j.getCurrentLevelExp(b.curAbsExp,b.tribeLevel),b.nextLevelExp=j.getExpForLevel(b.tribeLevel+1),b.nextLevelStartExp=j.getExpForLevel(b.tribeLevel),b.spentSkillPoints=j.getSpentSkillPoints(b.skills),b.tribeCrestLevel=l.getCrestLevel(b.tribeLevel),w()},y=function(){var a,c;if(b.skills&&b.skillReset){for(b.skillReset=!1,c=0;c<b.skills.length;c++)a=b.skills[c],a.currentLevel=a.oldCurrentLevel;for(c=0;c<b.tiers.length;c++)b.tiers[c].missingSkillPoints=j.getMissingSkillPoints(b.skills,c);b.curAbsExp+=o,x()}},z=function(c,d){var f=a.$new(),g="screen_tribe_skills",h=a.loc.ale,i="i18n";return b.skillReset?(f.title=e(i)("discard_title",h,g),f.text=e(i)("discard_text",h,g),f.boxText=e(i)("discard_box_text",h,g),f.submitText=e(i)("discard_submit",h,g),f.cancelText=e(i)("discard_cancel",h,g),f.submit=function(){y(),b.broadcastSetTab(d.tabName,d.callback),f.closeWindow()},f.cancel=function(){f.closeWindow()},void k.getModal("modal_attention",f)):void b.broadcastSetTab(d.tabName,d.callback)},A=function(a){var c,d=b.tiers[a];for(c in d.skills)d.skills[c].currentLevel=0},B=function(a,c){var d,e,f,g;if(b.skills&&(!(0>c)||s(p(a)))&&b.skillReset&&(f=p(a),null!==f)){for(d=b.skillPoints-j.getSpentSkillPoints(b.skills),d-c>=0&&(e=f.currentLevel+c,e>=0&&e<=f.maxLevel&&(f.currentLevel=e,b.virtualSkillPoints=b.skillPoints-j.getSpentSkillPoints(b.skills))),g=0;g<b.tiers.length;g++)b.tiers[g].missingSkillPoints=j.getMissingSkillPoints(b.skills,g).bound(0,1/0),b.tiers[g].missingSkillPoints&&A(g);w()}},C=function(a,c){b.curAbsExp=c.new_power,x()},D=function(){k.getModal("modal_donation_ranking")},E=function(){var a,c,d,e=0;for(d=0;d<b.skills.length;d++)a=b.skills[d],a.oldCurrentLevel=a.currentLevel,e+=a.currentLevel,a.currentLevel=0;b.skillPoints+=e,c=j.getExpForLevel(b.tribeLevel),b.tribeLevel--,o=c-j.getExpForLevel(b.tribeLevel),b.curAbsExp-=o,x(),b.virtualSkillPoints=b.skillPoints,b.skillReset=!0,w()},F=function(){var c,d="modal_reset_skills";0!==b.spentSkillPoints&&(c=a.$new(),c.title=e("i18n")("title",a.loc.ale,d),c.text=e("i18n")("text",a.loc.ale,d),c.boxText=e("i18n")("box_text",a.loc.ale,d),c.submitText=e("i18n")("YES"),c.cancelText=e("i18n")("NO"),k.getModal("modal_attention",c),c.submit=function(){c.closeWindow(),E()},c.cancel=c.closeWindow)},G=function(){var a,c={};for(b.skillReset=!1,a=0;a<b.skills.length;a++)c[b.skills[a].type]=b.skills[a].currentLevel;g.emit(h.TRIBE_SKILL_REASSIGN_SKILL_POINTS,{points:c})},H=function(a){var c,e;if(b.skills){for(e=0;e<b.skills.length&&(c=b.skills[e],c.type!==a.type);e++);c&&(b.WIDTH_ONE_SKILL_LEVEL=$(".progress-improve").width()/c.maxLevel,c.currentLevel=a.currentLevel,c.levelUpAnimation=!0,d(function(){c.levelUpAnimation=!1},j.LEVELUP_TIMEOUT))}},I=function(a,c){var d,e,f;if(b.skills){for(d in c.points)for(f=0;f<b.skills.length;f++)e=b.skills[f],e.type===d&&(e.currentLevel=c.points[d]);b.curAbsExp=c.power,x()}},J=function(a,c){var e,f,g,h,i,k=function(a){a.missingSkillPoints!==e&&0===a.missingSkillPoints&&(a.animationLocked=!0,b.animationLocked=!0,d(function(){a.animationLocked=!1,b.animationLocked=!1},m))};if(b.skills){for(h in c.points)for(g=0;g<b.skills.length;g++)i=b.skills[g],i.type===h&&(i.currentLevel+=c.points[h],b.skillPoints-=c.points[h]);for(g=0;g<b.tiers.length;g++)f=b.tiers[g],e=f.missingSkillPoints,f.missingSkillPoints=j.getMissingSkillPoints(b.skills,g).bound(0,1/0),k(f);w();for(h in c.points)c.points.hasOwnProperty(h)&&(i=p(h),H(i));b.spentSkillPoints=j.getSpentSkillPoints(b.skills)}},K=function(){return!b.skillReset&&b.tribeLevel<b.maxTribeLevel},L=function(){b.$watch("activeTab",function(a){"skills"!==a||b.INACTIVE_TABS[a]||(b.curAbsExp=f.getTribeSettings().power,b.skills=f.getTribeSkills().getSkillModels(),b.maxTribeLevel=j.getMaxTribeLevel(b.skills),x())},!0)};b.INACTIVE_TABS.skills||(b.skillReset=!1,b.blurSupport="webkit"===$.browser.vendor,b.donateResources=t,b.improveSkill=u,b.onSkillRedistribute=B,b.openDonationRanking=D,b.resetSkills=F,b.saveSkills=G,b.discardSkills=y,b.tribeSkillNames=c,b.donationPossible=K,b.$on(i.TRIBE_SKILL_ASSIGNED,J),b.$on(i.TRIBE_SKILL_REASSIGNED,I),b.$on(i.TRIBE_SKILL_DONATED,C),b.$on(i.TRIBE_TAB_DISCARD_CHANGED_SKILLS,z),b.$on("$destroy",y),L())}])}),define("controllers/screen/NoTribeController",["app"],function(a){a.controller("NoTribeController",["$rootScope","$scope","$filter","modelDataService","eventTypeProvider","routeProvider","windowManagerService","windowDisplayService","socketService","tribeService","tribeApplicationsService",function(a,b,c,d,e,f,g,h,i,j,k){var l=d.getSelectedVillage().getId(),m=function(a){b.activeTab=a,"invitations"===a&&d.getSelectedCharacter().getTribeInvitations().markAsSeen(Object.keys(b.invitations))},n=function(b,d){var e=a.$new(),h="modal_accept_invitation";e.title=c("i18n")("title",a.loc.ale,h),e.text=c("i18n")("text",a.loc.ale,h),e.boxText=b,e.submitText=c("i18n")("accept",a.loc.ale,h),e.submit=function(){i.emit(f.TRIBE_INVITATION_ACCEPT,{id:d}),e.closeWindow()},g.getModal("modal_attention",e)},o=function(b,d){var e=a.$new(),h="modal_decline_invitation";e.title=c("i18n")("title",a.loc.ale,h),e.text=c("i18n")("text",a.loc.ale,h),e.boxText=b,e.additionalText=c("i18n")("additional_text",a.loc.ale,h),e.submitText=c("i18n")("decline",a.loc.ale,h),e.submit=function(){i.emit(f.TRIBE_INVITATION_REJECT,{id:d}),e.closeWindow()},g.getModal("modal_attention",e)},p=function(b,d){var e=a.$new(),h="modal_retract_application";e.title=c("i18n")("title",a.loc.ale,h),e.text=c("i18n")("text",a.loc.ale,h),e.boxText=b,e.additionalText=c("i18n")("additional_text",a.loc.ale,h),e.submitText=c("i18n")("retract",a.loc.ale,h),e.submit=function(){i.emit(f.TRIBE_APPLICATION_ABORT,{id:d}),e.closeWindow()},g.getModal("modal_attention",e)},q=function(){b.ownerId===b.playerId&&g.getModal("modal_found_tribe")},r=function(){i.emit(f.MAP_GET_TRIBES_NEAR_VILLAGE,{village_id:l},function(a){b.tribes=a.tribes})},s=function(a,b){a.name===e.TRIBE_JOINED&&d.getSelectedCharacter().setTribeId(b.tribe_id),g.getScreen("screen_tribe",function(a,b){b.activeTab="tribe-profile"})},t=function(){r()};b.activeTab="",b.ownerId=d.getSelectedCharacter().getOwnerId(),b.playerId=d.getPlayer().getId(),b.invitations=d.getSelectedCharacter().getTribeInvitations().getData(),b.applications=k.getApplications(),b.setActiveTab=m,b.openTribeInfo=h.openTribeProfile,b.acceptInvitation=n,b.declineInvitation=o,b.abortApplication=p,b.foundNewTribe=q,b.writeApplication=j.writeApplication,b.joinTribe=j.join,b.$on(e.TRIBE_INVITATION_ACCEPTED,s),b.$on(e.TRIBE_APPLICATION_ACCEPTED,s),b.$on(e.TRIBE_JOINED,s),b.$on(e.TRIBE_CREATED,s),t(),b.setActiveTab("applications")}])}),define("controllers/screen/ShopController",["app"],function(a){a.controller("ShopController",["$scope","modelDataService","eventTypeProvider","socketService","routeProvider","premiumActionService","inventoryItemTypeProvider","windowDisplayService",function(a,b,c,d,e,f,g,h){var i=["sale","officer","misc"],j={},k=function(b){if(-1===i.indexOf(b))throw new Error("No such tab "+b);a.activeTab=b},l=function(a){j[a.id]||(j[a.id]=!0,f.buyItem(a,function(a){j[a.offer_id]=!1}))},m=function(b,c){var d,e;for(a.offers={sale:[],officer:[],misc:[]},a.uniqueOffers={sale:[],officer:[],misc:[]},e=0;e<c.offers.length;e++)d=c.offers[e],a[d.limit_unique?"uniqueOffers":"offers"][d.category].push(d)},n=function(){d.emit(e.PREMIUM_LIST_SHOP_OFFERS,{})};a.activeTab=a.activeTab||i[2],a.tabs=i,a.openOrders=j,a.ITEM_TYPES=g,a.showOfferInfo=h.openOfferInfo,a.showOfficerInfo=h.openOfficerInfo,a.setActiveTab=k,a.buyItem=l,a.init=n,a.$on(c.PREMIUM_SHOP_OFFERS,m),a.$on(c.PREMIUM_ITEM_BOUGHT,n),n()}])}),define("controllers/screen/InventoryController",["app"],function(a){a.controller("InventoryController",["$scope","$filter","modelDataService","eventTypeProvider","socketService","routeProvider","windowManagerService","inventoryService","armyService","iconAnimationsService","inventoryItemTypeProvider","windowDisplayService","effectService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o=!1,p=function(){a.newInventoryItems&&e.emit(f.INVENTORY_MARK_SEEN)},q=function(a){var b,d=c.getGameData().getOfficers();for(b=0;b<d.length;b++)if(a.type==="premium_officer_"+d[b])return!0;return!1},r=function(b){var d=c.getSelectedVillage(),e=d.getBuildingQueue();switch(b.type){case"premium_build_queue_slot":if(!e||e.getUnlockedSlots()>=e.getMaxSlots())return!1;break;case"premium_paladin_instant_item":return!a.isPaladinAlive;case"effect":return 0===b.content.duration?0===m.getEffectsByContentName(b.content.name).length:!0}return!0},s=function(c){var d=a.$new();d.showQuestionMarkIcon=!0,d.title=h.getItemName(c,!0),d.text=b("i18n")("item_not_usable_in_shop_"+c.type,a.locale,"premium_items"),d.submitText=b("i18n")("not_usable_help_window_submit_text",a.locale,"screen_shop"),d.submit=function(){d.closeWindow()},g.getModal("modal_attention",d)},t=function(b){var d=c.getSelectedVillage();h.useItem(b,function(){a.useItemStarted[b.id]=!0,e.emit(f.PREMIUM_USE_ITEM,{village_id:d.getId(),item_id:b.id},function(){var d,e=[],f=c.getGameData().getResourceNames(),g=c.getGameData().getOrderedUnitNames();if(a.useItemStarted[b.id]=!1,"reward_resources"===b.type||"reward_resource_package"===b.type)for(d=0;d<f.length;d++)b.content[f[d]]&&e.push("resource-"+f[d]);else if("reward_units"===b.type)for(d=0;d<g.length;d++)b.content[g[d]]&&e.push("unit-"+g[d]);j.createAnimations(e)})})},u=function(b){var d,e,f,h,j;if("reward_resources"===b.type||"reward_resource_package"===b.type){d=c.getSelectedVillage().getResources().getMaxStorage();for(e in b.content)if(d-n[e].currentProduction<b.content[e]){f=!0;break}}else"reward_units"===b.type&&(h=i.calculateCost(b.content),n.food.currentProduction<h.food&&(f=!0));f?(j=a.$new(),j.type="shop",j.resource=h?"food":"storage",j.content=h?"units":"resources",j.finish=function(){t(b),j.closeWindow()},g.getModal("modal_reward_full",j)):t(b)},v=function(){var b=a.newInventoryItems;a.twoColumnItemList=c.getInventory().get2ColumnInventoryItemList(),a.newInventoryItems=a.inventory.getNewItemCount(),b<a.newInventoryItems&&(o=!1)},w=function(a,b){n=b},x=function(b,c){a.isPaladinAlive=!!c.home_village_id},y=function(){e.emit(f.PALADIN_GET_INFO,{}),v(),p()};a.inventory=c.getInventory(),a.twoColumnItemList=c.getInventory().get2ColumnInventoryItemList(),a.useItemStarted={},a.ITEM_TYPES=k,a.useItem=u,a.getItemName=h.getItemName,a.getItemIcon=h.getItemIcon,a.canUseItem=r,a.showNotUsableModal=s,a.isItemOfficer=q,a.showOfferInfo=l.openOfferInfo,a.showOfficerInfo=l.openOfficerInfo,a.init=y,a.$on(d.INVENTORY_ITEM_CHANGED,v),a.$on(d.INVENTORY_MARKED_SEEN,v),a.$on(d.RESOURCES,w),a.$on(d.PALADIN_INFO,x),a.$on(d.PREMIUM_ITEM_BOUGHT,y),a.$on("$destroy",p),y()}])}),define("controllers/screen/RankingController",["app"],function(a){a.controller("RankingController",["$rootScope","$scope","$filter","modelDataService","windowManagerService","eventTypeProvider","socketService","routeProvider","kingdomService","linkService","storageService",function(a,b,c,d,e,f,g,h,i,j,k){var l=["tab_char","tab_tribe"],m=d.getSelectedCharacter(),n=k.getPaginationLimit(),o=parseInt((m.getRank()-1)/n,10)*n,p={tab_char:{awards:["achievement_average","achievement_count","achievement_points"],defeat_units:["bash_points_total","bash_points_off","bash_points_def"],points:["points_per_villages","villages","points","bash_points_total"]},tab_char_order:{0:"points",1:"defeat_units",2:"awards"},tab_tribe:{points:["points_per_member","members","points"],villages:["points_per_villages","villages","points"],defeat_units:["bash_points_total","bash_points_off","bash_points_def"],awards:["achievement_average","achievement_count","achievement_points"],wars:["war_ratio","wars_lost","wars_won"]},tab_tribe_order:{0:"points",1:"villages",2:"defeat_units",3:"awards",4:"wars"}},q={tab_char:h.RANKING_CHARACTER,tab_tribe:h.RANKING_TRIBE},r=function(){var d="screen_ranking",e=c("i18n")(b.areaType,a.loc.ale,d),f=c("i18n")(b.mode,a.loc.ale,d);b.filterText=c("i18n")("filter_by",a.loc.ale,d,e,f)},s=function(a,c,d){var e=b.asc?1:0;g.emit(q[b.activeTab],{area_type:b.areaType,offset:d,count:c,order_by:b.orderBy,order_dir:e,area_id:b.areaId,query:b.query})},t=function(a){if(-1===l.indexOf(a))throw new Error("No such tab "+a);b.activeTab!==a&&(b.activeTab=a,b.orderBy="rank",b.mode="points",s(null,b.pagination.limit,l[0]===a?o:0))},u=function(a,c){b.ranking=c.ranking,b.pagination.count=c.total,b.pagination.offset=c.offset,b.$$postDigest(function(){b.directives.scrollbar.scrollbar.recalc()})},v=function(a,c){a.stopPropagation(),b.mode!==c&&s(null,b.pagination.limit,null),b.mode=c,r()},w=function(f){var g=a.$new(),h=d.getSelectedVillage().getKingdomId();f.stopPropagation(),g.kingdoms=[],g.filteredKingdoms=g.kingdoms,g.areaId=b.areaId,i.getKingdoms(function(b){var d,e;for(d in b)e={id:parseInt(d,10),name:b[d]},g.kingdoms.push(e);for(g.kingdoms.sortByProperty("name"),d=0;d<g.kingdoms.length;d++)e=g.kingdoms[d],e.id===h&&(g.kingdoms.remove(d),g.kingdoms.unshift(e),e.name+=" "+c("i18n")("current_kingdom",a.loc.ale,"screen_ranking"));g.filteredKingdoms=g.kingdoms}),g.setKingdom=function(a){g.areaId=b.areaId=a},g.saveCloseWindow=function(){b.areaId&&(b.areaType="kingdom",s(null,b.pagination.limit,null)),g.closeWindow(),r()},g.$watch("searchKingdom",function(a){g.filteredKingdoms=c("filter")(g.kingdoms,a)}),e.getModal("modal_select_kingdom",g)},x=function(a){a.stopPropagation(),"world"!==b.areaType&&(b.areaType="world",s(null,b.pagination.limit,null),r())},y=function(a){a===b.orderBy?b.asc=!b.asc:b.orderBy=a,s(null,b.pagination.limit,0)},z=function(a){a.stopPropagation(),b.filterVisible=!b.filterVisible},A=function(){b.filterVisible=!1,a.$$phase||b.$digest()},B=function(){s(null,b.pagination.limit,b.pagination.offset=0)},C=function(){s(null,b.pagination.limit,b.pagination.offset),r()};b.ownId=m.getId(),b.ownTribeId=m.getTribeId(),b.tabs=l,b.activeTab=l[0],b.filterVisible=!1,b.orderBy="rank",b.asc=!1,b.options=p,b.mode="points",b.areaType="world",b.areaId=0,b.pagination={offset:o,loader:s,limit:n},b.linkTo=j.linkTo,b.selectMode=v,b.openKingdomModal=w,b.setWorldMode=x,b.setOrder=y,b.setActiveTab=t,b.toggleFilterVisibility=z,b.searchRanking=B,b.$on(f.RANKING_CHARACTER_LIST,u),b.$on(f.RANKING_TRIBE_LIST,u),$(".win-main").on("click",A),C()}])}),define("controllers/screen/CharacterProfileController",["app","helper/time","helper/dataconversion","angular"],function(a,b,c,d){a.controller("CharacterProfileController",["$rootScope","$scope","$filter","modelDataService","messagingService","socketService","routeProvider","eventTypeProvider","windowManagerService","windowDisplayService","achievementListService","tribeService","mapService","errorTypeProvider",function(a,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=e.closeWindow,s=g.getSelectedCharacter(),t=s.getId(),u={},v=function(a){e.activeTab=a},w=function(){var c=a.$new();c.amountIcons=61,c.selectedIcon="",c.zerofill=b.zerofill,c.selectIcon=function(a){c.selectedIcon=a},c.submit=function(){e.icon=c.selectedIcon,c.closeWindow()},l.getModal("modal_profile_icon",c)},x=function(){e.edit=!e.edit,e.edit||(e.selectedAchievements=d.copy(e.profile.profile_achievements),e.icon=e.profile.profile_icon,e.profileText=e.profile.profile_text,e.title=e.profile.profile_title)},y=function(){i.emit(j.CHAR_SET_PROFILE,{icon:e.icon,title_id:e.titleId,achievements:e.selectedAchievements,text:e.profileText},function(b){b.achievements&&(a.$broadcast(k.MESSAGE_SUCCESS,{message:f("i18n")("edit_saved",a.loc.ale,"screen_tribe")}),e.edit=!1)})},z=function(){var b=a.$new();b.selectedTitle=e.title,b.selectTitle=function(a,c){b.selectedTitle=a,e.titleId=c},b.submit=function(){e.title=b.selectedTitle,b.closeWindow()},i.emit(j.CHAR_GET_TITLES,{},function(a){b.titles=a}),l.getModal("modal_select_title",b)},A=function(){var a;e.ownAchievementAmount=0;for(a in e.ownAchievementData.achievements)e.ownAchievementData.achievements[a].level&&0!==e.ownAchievementData.achievements[a].level&&e.ownAchievementAmount++},B=function(){var b=a.$new();b.category="character",b.selected=e.selectedAchievements,b.maxAchievements=e.maxAchievements,b.onSubmit=function(a){e.selectedAchievements=a},b.unlockedAchievements=e.ownAchievementData.achievements,l.getModal("modal_select_achievements",b)},C=function(a){var b,c=[];for(b=0;b<e.selectedAchievements.length;b++)e.selectedAchievements[b]!==a&&c.push(e.selectedAchievements[b]);e.selectedAchievements=c},D=function(){var b;return e.edit?(b=a.$new(),b.title=f("i18n")("discard_title",a.loc.ale,e.textObject),b.text=f("i18n")("discard_text",a.loc.ale,e.textObject),b.boxText=f("i18n")("discard_box_text",a.loc.ale,e.textObject),b.submitText=f("i18n")("discard_submit",a.loc.ale,e.textObject),b.cancelText=f("i18n")("discard_cancel",a.loc.ale,e.textObject),b.submit=function(){b.closeWindow(),r()},b.cancel=function(){b.closeWindow()},void l.getModal("modal_attention",b)):void r()},E=function(a,b){var c,d=0;for(c=0;c<b.level;c++)d+=a[b.type||b.name].points[c];return d},F=function(){var a,b,c,d,f,g=e.ownAchievementData.achievements,h=function(a,b){return a.lastDate>b.lastDate?-1:a.lastDate<b.lastDate?1:0};for(e.sortedAchievements=[],e.comparedAchievements={},e.totalPoints={own:0,foreign:0},a=0;a<e.unlockedAchievements.length;a++)b=e.unlockedAchievements[a],0!==b.level&&(d=g[b.type].limits,f=d?d[0]>d[1]?!1:!0:!1,e.comparedAchievements[b.type]={name:b.type,foreign:{rawDate:b.time_last_level,points:g[b.type].repeatable?0:E(g,b),level:b.level,levels:g[b.type].levels,hasProgress:f}},e.totalPoints.foreign+=e.comparedAchievements[b.type||b.name].foreign.points);for(c in g)b=g[c],b.level&&0!==b.level&&(e.comparedAchievements[c]||(e.comparedAchievements[c]={name:c}),d=g[c].limits,f=d?d[0]>d[1]?!1:!0:!1,e.comparedAchievements[c].own={rawDate:b.time_last_level,points:g[c].repeatable?0:E(g,b),level:b.level,levels:g[c].levels,hasProgress:f},e.totalPoints.own+=e.comparedAchievements[b.type||b.name].own.points);for(a in e.comparedAchievements)b=e.comparedAchievements[a],b.own?b.foreign?b.own.rawDate>b.foreign.rawDate?b.lastDate=b.own.rawDate:b.lastDate=b.foreign.rawDate:b.lastDate=b.own.rawDate:b.lastDate=b.foreign.rawDate;for(a in e.comparedAchievements)e.sortedAchievements.push(e.comparedAchievements[a]);e.sortedAchievements.sort(h)},G=function(){h.newMessage(c.participant({character_id:e.profile.character_id,character_name:e.profile.character_name}))},H=function(a){void 0!==a&&(a?delete u[e.characterId]:u[e.characterId]=!0),e.characterInvitable=!u[e.characterId]},I=function(b){if(e.characterInvitable){var c=e.$new();c.title=f("i18n")("confirm_invitation_title",a.loc.ale,e.textObject),c.text=f("i18n")("confirm_invitation_text",a.loc.ale,e.textObject,b),c.submitText=f("i18n")("confirm_invitation_submit_text",a.loc.ale,e.textObject),c.cancelText=f("i18n")("confirm_invitation_cancel_text",a.loc.ale,e.textObject),c.submit=function(){o.inviteCharacter(b),H(!1),c.closeWindow()},c.cancel=function(){c.closeWindow()},l.getModal("modal_attention",c)}},J=function(a,b){b.character_id===e.characterId&&(e.unlockedAchievements=b.achievements,F())},K=function(a,b){e.ownCharacter&&e.ownCharacterId===b.character_id?e.ownProfile=b:(e.profile=b,e.icon=e.profile.profile_icon,e.profileText=e.profile.profile_text,
e.selectedAchievements=e.profile.profile_achievements,e.title=e.profile.profile_title,e.titleId=e.profile.profile_title_id,e.initialized=!0)},L=function(a,b){var c;for(u={},c=0;c<b.invitations.length;c++)u[b.invitations[c].invitee_id]=!0;H()},M=function(a,b){H(!1)},N=function(a,b){"INVALID_COMMAND"===b.error_code&&D()},O=function(){var b=a.$new(),c="modal_character_unknown";e.closeWindow(),b.title=f("i18n")("title",a.loc.ale,c),b.text=f("i18n")("text",a.loc.ale,c),b.boxText=f("i18n")("box_text",a.loc.ale,c),b.submitText=f("i18n")("OK",a.loc.ale),b.submit=function(){b.closeWindow()},l.getModal("modal_attention",b)},P=function(){delete e.ownCharacter,delete e.ownCharacterId,delete e.ownCharacterRecruiter,i.emit(j.CHAR_GET_PROFILE,{character_id:e.characterId}),e.characterId!==t&&(e.ownCharacter=s,e.ownCharacterId=t,e.ownCharacterRecruiter=s.getTribeRights().RECRUIT,i.emitInOrder([j.CHAR_GET_PROFILE,j.ACHIEVEMENT_GET_CHAR_ACHIEVEMENTS],[{character_id:e.ownCharacterId},{character_id:e.characterId}]),e.ownCharacterRecruiter&&i.emit(j.TRIBE_INVITATION_GET_TRIBE_INVITATIONS))};e.characterId=parseInt(e.characterId||t,10),e.TABS=["overview","compare"],e.maxAchievements=6,e.activeTab=e.TABS[0],e.selectedAchievements=[],e.title="",e.edit=!1,e.ownAchievementData=n.getAchievementsData(),e.ownAchievementAmount=0,e.newMessage=G,e.confirmTribeInvitation=I,e.toggleEditProfile=x,e.saveProfile=y,e.setAchievements=B,e.removeAchievement=C,e.pickIcon=w,e.centerOnPosition=p.centerOnPosition,e.openVillageInfo=m.openVillageInfo,e.selectTitle=z,e.closeWindow=D,e.openTribeProfile=m.openTribeProfile,e.setActiveTab=v,e.$on(k.CHARACTER_PROFILE_SET,P),e.$on(k.CHARACTER_PROFILE,K),e.$on(k.CHARACTER_ACHIEVEMENTS,J),e.$on(k.TRIBE_INVITATION_INDEX,L),e.$on(k.TRIBE_INVITATION_SENT,M),e.$on(k.MESSAGE_ERROR,N),e.$on(q.CHARACTER_NOT_FOUND,O),e.$watch("ownAchievementData.achievements",A,!0),P()}])}),define("controllers/screen/SettingsScreenController",["app","conf/conf","helper/time","helper/util","version","cdn"],function(a,b,c,d,e,f){a.controller("SettingsScreenController",["$rootScope","$scope","$filter","routeProvider","eventTypeProvider","errorTypeProvider","socketService","settingsService","windowManagerService","modelDataService","ipCookie","utilityService",function(a,d,g,h,i,j,k,l,m,n,o,p){var q=4,r=2,s="https://app.adjust.com/8k45ow?campaign=ingam_nn_nn",t="https://app.adjust.com/wdx6lt?campaign=ingam_nn_nn",u=n.getPlayer(),v=n.getSelectedCharacter(),w=(v.getGlobalInfo(),function(){var a,b,c;if(d.supportData="",d.supportData+="BUILD: \n",window.build)for(a in window.build)window.build.hasOwnProperty(a)&&(c=window.build[a])&&(d.supportData+="\n"+a+": "+c);else d.supportData+="\nVERSION: "+e.product.toString(),d.supportData+="\nFRONTEND: "+e.frontend.toString();if(window.Modernizr.localstorage){d.supportData+="\n\nLOCAL STORAGE: \n";for(a in window.localStorage)window.localStorage.hasOwnProperty(a)&&"kingdom_storage"!==a&&"gameSettings"!==a&&(d.supportData+="\n"+a+": "+window.localStorage[a])}localStorage.hasOwnProperty("gameSettings")&&(d.supportData+="\ngameSettings: "+JSON.stringify(l.settings.game)),d.supportData+="\n\nBROWSER: \n";for(a in window.navigator)(c=window.navigator[a])&&-1===c.toString().indexOf("[object ")&&-1===c.toString().indexOf("function ")&&(d.supportData+="\n"+a+": "+c);if(d.supportData+="\n\n",window.navigator.plugins){d.supportData+="BROWSER PLUGINS: \n";for(a in window.navigator.plugins)window.navigator.plugins.hasOwnProperty(a)&&(b=window.navigator.plugins[a])&&(b.name||b.version||b.filename||b.description)&&(d.supportData+="-----------",d.supportData+="\nname: "+b.name,d.supportData+="\nversion: "+b.version,d.supportData+="\nfilename: "+b.filename,d.supportData+="\ndescription: "+b.description,d.supportData+="\n")}}),x=function(a){d.tabsInactive[a]||(d.activeTab=a),d.directives&&d.directives.scrollbar.scrollbar.resetScrollTop()},y=function(){d.password.oldValid=!!d.password.oldValue.length,d.password.newValid=d.password.newValue.length>=q,d.password.rptValid=d.password.rptValue===d.password.newValue&&d.password.newValid},z=function(){d.password.oldValue=d.password.newValue=d.password.rptValue="",y()},A=function(){return d.password.newValid&&d.password.rptValid&&d.password.oldValid},B=function(a,b,c){A()&&k.emit(h.SETTINGS_CHANGE_PASSWORD,{old_pass:a,pass:b,pass_repeat:c})},C=function(){return u.getId()!==v.getOwnerId()?"CHARACTER_FOUNDER":Date.now()-v.getLastRestartTime()<c.inMS.threeDay?"WITHIN_3_DAYS":v.getVillages().length>r?"VILLAGES":null},D=function(){if(!C()){var b=a.$new(),c="modal_restart";b.title=g("i18n")("title",a.loc.ale,c),b.text=g("i18n")("text",a.loc.ale,c),b.submitText=g("i18n")("submitText",a.loc.ale,c),b.cancelText=g("i18n")("CANCEL",a.loc.ale),b.submitInactive=!0,b.input={type:"password"},b.switchColors=!0,b.submit=function(){b.submitInactive||k.emit(h.CHAR_RESTART,{pass:b.input.value},function(){b.closeWindow()})},b.cancel=function(){b.closeWindow()},b.$watch("input",function(){return b.text_error=!1,b.input.value?void(b.submitInactive=!b.input.value.length):void(b.submitInactive=!0)},!0),b.$on(j.AUTH_INVALID_PASSWORD,function(c,d){b.text_error=g("i18n")(d.code,a.loc.ale,"error_message")}),m.getModal("modal_attention",b)}},E=function(){var a=window.open("about:blank","","left=20,top=20,width=1000,height=600,scrollbars=1,toolbar=0,resizable=1");k.emit(h.SUPPORT_GET_URL,{},function(b){a.location.replace(b.support_url)})},F=function(){l.settings.game.premium=!0,l.reset("item"),l.saveGameSettings(),a.$broadcast(i.MESSAGE_SUCCESS,{message:g("i18n")("reset_premium_success",a.loc.ale,"options")})},G=function(){l.settings.game.deleteReports=!1,l.reset("item"),l.saveGameSettings(),a.$broadcast(i.MESSAGE_SUCCESS,{message:g("i18n")("reset_delete_report_modals_success",a.loc.ale,"options")})},H=function(){l.resetToDefault(),a.$broadcast(i.MESSAGE_SUCCESS,{message:g("i18n")("reset_success",a.loc.ale,"options")})},I=function(a,b){d.email=b.email,d.logins=b.logins.reverse().slice(0,20).map(function(a){return a.date=c.server2ClientTime(a.date),a})},J=function(a,b){var c={};b.date_process_timeout&&(c.timeout=b.date_process_timeout),p.showEmailChangeSentModal(c)},K=function(){var a=l.getOldSettings(),b=d.duration.musicVolume,c=d.duration.sfxVolume,e=a.duration.musicVolume,f=a.duration.sfxVolume;b!==e&&(d.game.music=!!b),c!==f&&(d.game.sfx=!!c)},L=function(){K(),l.saveGameSettings()},M=function(){var a=d.proxy.textAreaElement?d.proxy.textAreaElement[0]:null;a&&(a.focus(),a.select(),d.supportDataSelected=!0)},N=function(){var a=v.getWorldId().slice(0,2),c=b.ALL_MARKETS,d=-1!==c.indexOf(a)?a:c[0];return d},O=function(){var a,b=n.getWorldConfig(),c=b.isCooperativeModeActive();d.isInCooperativeMode=n.getSelectedCharacter().isInCoopMode(),d.worldConfig={smartTips:b.areSmartTipsEnabled()},d.isInCooperativeMode&&(d.tabsInactive.coop=!0,d.tabsInactive.account=!0),c||(d.tabsInactive.coop=!0),k.emit(h.SETTINGS_GET_ACCOUNT_INFO),a=n.getSelectedCharacter().isInCoopMode()?d.tabs[1]:d.tabs[0],x(a),w()};d.tabs=["account","game","coop","friends","mobile","surveys","gifts","support"],d.tabsInactive={friends:!0,surveys:!0,gifts:!0},d.appLanguage=N(),d.iosImgUrl=f.getPath("/img/registration-landing/appstore/btn-"+d.appLanguage+".png"),d.androidImgUrl=f.getPath("/img/registration-landing/gplay/btn-"+d.appLanguage+".png"),d.androidAppLink=s,d.iosAppLink=t,d.proxy={},d.setTab=x,d.game=l.settings.game,d.duration=l.settings.duration,d.changeEmail=p.changeEmail,d.validatePassword=y,d.canSetPassword=A,d.setPassword=B,d.getRestartError=C,d.getSupport=E,d.showRestartModal=D,d.resetToDefault=H,d.resetPremiumModals=F,d.resetDeleteReportModals=G,d.selectData=M,d.password={oldValue:"",newValue:"",rptValue:"",oldValid:!1,newValid:!1,rptValid:!1,minLength:q},d.$watch("game",L,!0),d.$watch("duration",L,!0),d.$on(i.SETTINGS_PASSWORD_CHANGED,z),d.$on(i.SETTINGS_ACCOUNT_INFO,I),d.$on(i.PLAYEREMAIL_CHANGE_REQUESTED,J),d.$on(j.PLAYER_EMAIL_ALREADY_IN_USE,p.showEmailInUseModal),d.$on(j.PLAYER_EMAIL_ACTIVE_CHANGE_EXISTS,p.showEmailInChangeModal),O()}])}),define("controllers/screen/AchievementScreenController",["app"],function(a){a.controller("AchievementScreenController",["$rootScope","$scope","$filter","achievementListService",function(a,b,c,d){var e={rueler:"crown"},f=function(a){"overall"!==a&&(b.activeTab=a,b.jumpToType=null)},g=function(){var a,c,d={},f={};if(0!==Object.keys(b.achievementData.categories).length){for(b.categories=[],d.current=0,d.max=0,d.category="overall",d.img="overview",c=0;c<b.tabs.length;c++)a=b.tabs[c],"overview"!==a&&(f=window.angular.copy(b.achievementData.categories[a]),f.category=a,f.img=e[a]||a,b.categories.push(f),d.current+=f.current,d.max+=f.max);b.categories.unshift(d)}},h=function(a){b.activeTab=b.achievementData.achievements[a].category,b.expanded[a]=!0,b.jumpToType=a},i=function(){return b.jumpToType?void h(b.jumpToType):void f(b.tabs[0])},j=function(a){var d;return d=a.level===a.levels?a.levels-1:a.world_level>a.level?a.world_level:a.level,c("i18n")(a.name+"_desc",b.locale,"achievements",a.limits?a.limits[d]:"")};b.tabs=["overview","battle","quest","points","tribe","repeatable","special","friends","milestone","ruler"],b.setTab=f,b.getAchievementDescription=j,b.jumpTo=h,b.achievementData=d.getAchievementsData(),b.expanded={},b.$watch("achievementData.categories",g,!0),i()}])}),define("controllers/screen/ProvinceController",["app"],function(a){a.controller("ProvinceController",["$scope","modelDataService","socketService","routeProvider","windowManagerService","windowDisplayService","eventTypeProvider","mapService",function(a,b,c,d,e,f,g,h){var i=["tab_villages","tab_ranking"],j={own:!0,foreign:!0,villageRank:!0,provinceRank:!0},k={},l=.5,m=99,n=function(b){if(-1===i.indexOf(b))throw new Error("No such tab "+b);a.activeTab=b},o=function(b,c){var d,e,f;for(a.provinceRanking=c.ranking,a.hasRanks=0!==c.ranking.length,d=0;d<c.ranking.length;d++)e=c.ranking[d],e.villagesInProvince=k[e.character_id],f=e.villagesInProvince/a.villages.length*100,f!==Math.round(f)&&(f=f.toFixed(2)),e.percent=f},p=function(){var b=a.$new();b.newName=a.name,b.confirm=function(){a.name=b.newName,c.emit(d.MAP_RENAME_PROVINCE,{name:b.newName,province_id:a.province_id}),b.closeWindow()},e.getModal("modal_rename_province",b)},q=function(b,c){a.province_id===c.province_id&&(a.name=c.name)},r=function(e,f){var g,h,i,j,n=f.villages.sortByProperty("points",!0),o=b.getSelectedCharacter().getId();for(a.name=f.name,a.villages=n,a.hasVillages=0!==n.length,a.ownVillages=[],a.foreignVillages=[],k={},g=0;g<n.length;g++)i=n[g],j=i.character_id,j&&(k[j]=k.hasOwnProperty(j)?++k[j]:1),j===o?a.ownVillages.push(i):a.foreignVillages.push(i);for(h in k)if(k.hasOwnProperty(h)&&k[h]/f.villages.length>l){a.lordId=parseInt(h,10);break}a.isLord=a.lordId===o,a.province_id=f.province_id,c.emit(d.RANKING_CHARACTER,{area_type:"province",area_id:f.province_id,offset:0,count:m,order_by:"rank",order_dir:0})},s=function(a){j[a]=!j[a]},t=function(){a.tabs=i,a.activeTab=i[0],a.ownId=b.getSelectedCharacter().getId(),c.emit(d.MAP_GETPROVINCE,{x:a.tileCoords.x,y:a.tileCoords.y})};a.setActiveTab=n,a.centerOnPosition=h.centerOnPosition,a.openVillageInfo=f.openVillageInfo,a.toogleMinimized=s,a.renameProvince=p,a.openCharacterProfile=f.openCharacterProfile,a.minimized=j,a.$on(g.MAP_PROVINCE,r),a.$on(g.MAP_PROVINCE_RENAMED,q),a.$on(g.RANKING_CHARACTER_LIST,o),t()}])}),define("controllers/screen/TribeForumController",["app","helper/util"],function(a,b){a.controller("TribeForumController",["$rootScope","$scope","$timeout","socketService","routeProvider","eventTypeProvider","modelDataService","storageService","forumService","windowManagerService","forumThreadService",function(a,c,d,e,f,g,h,i,j,k,l){var m,n,o,p=h.getGameData().getTribeRights(),q={showThreads:"showThreads",adminForum:"adminForum",readThread:"readThread",createThread:"createThread",createPost:"createPost",editPost:"editPost",showForum:"showForum"},r={markRead:"mark_as_read",markUnread:"mark_as_unread",markForumRead:"mark_forum_read",markForumUnread:"mark_forum_unread"},s={deleteThreads:"delete",close:"close",reopen:"reopen",pin:"pin",unpin:"unpin",move:"move"},t=30,u=function(a){(a!==q.createPost||1!==c.thread.closed)&&(c.mode=a,a!==q.readThread&&a!==q.showThreads&&d(function(){c.directives.scrollbar.scrollbar.tweenTo(0,1/0)},100))},v=function(){var a,b={};for(a=0;a<c.forumOrder.length;a++)b[c.forumOrder[a]]=a;c.forums.sort(function(a,c){return b[a.id]<b[c.id]?-1:b[a.id]>b[c.id]?1:0})},w=function(a){c.threads=a.threads,c.threadPagination.offset=a.offset,c.threadPagination.count=a.total},x=function(a){return c.forums[j.getIndex(c.forums,a)]},y=function(){c.selectedForumId&&(l.requestThreadList(c.selectedForumId,c.threadPagination.offset,c.threadPagination.limit,w),c.selectedThreads={})},z=function(a){j.requestPostList(c.thread.id,c.postPagination.offset,c.postPagination.limit,function(b){var d,e,f=9999999;c.posts=b.posts,c.postPagination.offset=b.offset,c.postPagination.count=b.total,n=b.thread_id;for(e in c.posts)d=c.posts[e],d.date=1e3*d.time_created;a&&c.$$postDigest(function(){c.directives.scrollbar.scrollbar.content.scrollTop=f})})},A=function(a,b){h.getPlayer().getId()!==b.thread.reader_id&&(x(b.thread.forum_id).read=0),!c.thread||c.mode!==q.createPost&&c.mode!==c.MODES.editPost&&c.mode!==c.MODES.readThread||b.thread.id===c.thread.id&&z(c.mode===c.MODES.createPost||c.mode===c.MODES.editPost)},B=function(a){var b=a||i.getItem("selectedTribeForumId");c.forumOrder&&((null===b||-1===c.forumOrder.indexOf(b))&&(b=c.forumOrder.length?c.forumOrder[0]:null),i.setItem("selectedTribeForumId",b),c.selectedForumId=b,c.selectedForum={value:b,name:j.getForumName(c.forums,b)})},C=function(a){B(a),y(),u(q.showThreads)},D=function(){u(q.showForum),c.threadPagination.offset=0},E=function(a,b){o=a,b||(c.postPagination.offset=0),c.thread=j.getThread(a),c.gameDataModel.removeNewThread(o),z(b),u(q.readThread)},F=function(a){var b=j.getThread(a),d=Math.ceil(b.post_count/c.postPagination.limit);c.postPagination.offset=c.postPagination.limit*(d-1),E(a,!0)},G=function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(parseInt(a[b],10));return c},H=function(a,b){x(b.forum_id).read=1},I=function(a,b){x(b.forum_id).read=0},J=function(a,b){c.forumOrder=b.order,v()},K=function(){c.forums&&0===c.forums.length&&c.admin&&u(q.adminForum)},L=function(a,b){c.forums.splice(j.getIndex(c.forums,b.forum_id),1),c.forumOrder.splice(c.forumOrder.indexOf(b.forum_id),1),c.selectedForumId===b.forum_id&&c.mode!==q.adminForum&&u(q.showForum),v(),B(),K()},M=function(a,b){c.forums[j.getIndex(c.forums,b.forum_id)].name=b.name},N=function(a,b){c.posts.splice(j.getIndex(c.posts,b.post_id),1)},O=function(a,b){b.error_code||(c.richTextEditor.setContent(),u(q.readThread))},P=function(a,b){var d;for(d=0;d<c.posts.length;d++)c.posts[d].id===b.id&&n===b.thread_id&&(c.posts[d]=b)},Q=function(a,b){var d,e=G(b.thread_ids);if(c.thread&&c.mode===q.readThread)for(d=0;d<e.length;d++)c.thread.id===e[d]&&u(q.showThreads);x(b.forum_id).num_threads-=b.thread_ids.length},R=function(a,b){var c=x(b.thread.forum_id);c.num_threads++,c.last_modified_thread=b.thread},S=function(a,b){var c=x(b.threads[0].forum_id),d=x(b.forum_id),e=b.threads.reduce(function(a,b){return a?b.last_posted>a.last_posted?b:a:b},c.last_modified_thread);d.num_threads-=b.threads.length,c.num_threads+=b.threads.length,c.last_modified_thread=e,l.requestThreadList(b.forum_id,0,1,function(a){0===a.threads.length&&(d.last_modified_thread=null),d.last_modified_thread=a.threads[0]})},T=function(a,b){x(b.forum_id).read=0},U=function(a,b){var d;for(d=0;d<b.ids.length;d++)if(b.ids[d]===c.selectedForumId){y();break}},V=function(a,b){var d=0;for(c.forums=b.forums,c.forumOrder=[],d=0;d<c.forums.length;d++)c.forumOrder.push(c.forums[d].id);B(),v(),K()},W=function(){e.emit(f.FORUM_LIST_FORUMS,{})},X=function(a,b){var d,e;for(d=0;d<c.forumOrder.length&&c.forumOrder[d]!==a;d++);0===d&&b||d===c.forumOrder.length&&!b||(e=b?d-1:d+1,c.forumOrder.splice(e,0,c.forumOrder.splice(d,1)[0]),j.setForumOrder(c.forumOrder),v())},Y=function(){return c.message.title.length&&c.message.title.length<=t&&c.richTextEditor.valid},Z=function(){if(Y()){var a=c.richTextEditor.getBBCode();e.emit(f.FORUM_CREATE_THREAD,{forum_id:c.selectedForumId,name:c.message.title,text:a},function(a,b){"Message/error"!==b&&(c.message.title="",c.richTextEditor.setContent(),u(q.showThreads))})}},$=function(){return c.richTextEditor.valid},_=function(){if($()){var a=c.richTextEditor.getBBCode();j.createPost(c.thread.id,a,O),c.postPagination.offset=~~(c.postPagination.count/c.postPagination.limit)*c.postPagination.limit,z(!0)}},aa=function(){if($()){var a=c.richTextEditor.getBBCode();j.editPost(m,a,O)}},ba=function(a){var b=j.getPost(c.posts,a).content;u(q.editPost),m=a,c.richTextEditor.tasks.push({setContentFromBB:[b]}),c.directives.scrollbar.scrollbar.tweenTo(0,1/0)},ca=function(){c.thread.closed||(u(q.createPost),d(function(){c.richTextEditor.tasks.push({setContent:void 0})}))},da=function(a,b,d){c.richTextEditor.tasks.push({quote:[void 0,{author:a,content:b}]}),u(q.createPost),c.directives.scrollbar.scrollbar.tweenTo(0,1/0)},ea=function(){alert("Not implemented.")},fa=function(){var a,b=0;for(a=0;a<c.threads.length;a++)c.selectedThreads[c.threads[a].id]===!0&&b++;if(c.selectedThreads={},!(b>=c.threads.length))for(a=0;a<c.threads.length;a++)c.selectedThreads[c.threads[a].id]=!0},ga=function(){var a,b,d=[];for(a in c.selectedThreads)c.selectedThreads[a]===!0&&d.push(parseInt(a,10));switch(c.selectedAction.value){case r.markForumRead:j.markForumRead(c.selectedForumId,!0);break;case r.markForumUnread:j.markForumRead(c.selectedForumId,!1)}if(0!==d.length){switch(c.selectedAction.value){case r.markRead:j.markThreadsRead(c.selectedForumId,d,!0);break;case r.markUnread:j.markThreadsRead(c.selectedForumId,d,!1);break;case s.pin:j.pinThreads(c.selectedForumId,d,!0);break;case s.unpin:j.pinThreads(c.selectedForumId,d,!1);break;case s.close:j.closeThreads(c.selectedForumId,d,!0);break;case s.reopen:j.closeThreads(c.selectedForumId,d,!1);break;case s.deleteThreads:j.deleteThreads(c.selectedForumId,d);break;case s.move:b=c.$new(),b.moveToForum=function(a){j.moveThreads(c.selectedForumId,a,d),b.closeWindow()},k.getModal("modal_tribe_forum_thread_move",b)}c.selectedThreads={}}},ha=function(){j.closeThreads(c.selectedForumId,[c.thread.id],1!==c.thread.closed)},ia=function(b){var c=a.$new();c.characterId=b,k.getScreenWithInjectedScope("screen_character_info",c)},ja=function(a,d){var e=d?d.rights.indexOf(p.FORUM.toLowerCase())>-1:h.getSelectedCharacter().getTribeRights()[p.FORUM];c.ACTIONS=b.toActionList(r,j.getActionName),c.moderator=!!e,c.moderator&&(c.ACTIONS=c.ACTIONS.concat(c.MODERATOR_ACTIONS))},ka=function(){ja(),c.mode=q.showForum,W()},la=function(){c.message&&c.message.title&&(c.message.title=""),u(q.showThreads)};c.MODES=q,c.mode=q.showForum,c.maxThreadTitleLength=t,c.forumPosition=0,c.threads=[],c.posts=[],c.threadPagination={count:0,offset:0,loader:y,limit:i.getPaginationLimit()},c.postPagination={count:0,offset:0,loader:z,limit:i.getPaginationLimit()},c.message={title:"",titlePlaceholder:"",body:""},c.richTextEditor={maxLength:8e3,tasks:[]},c.actionListVisible=!1,c.ACTIONS=b.toActionList(r,j.getActionName),c.MODERATOR_ACTIONS=b.toActionList(s,j.getActionName),c.moderator=!!h.getSelectedCharacter().getTribeRights()[p.FORUM],c.admin=!!h.getSelectedCharacter().getTribeRights()[p.SETTINGS],c.selectedAction={value:"choose",name:j.getActionName("choose")},c.selectedForum={},c.forums={},c.selectedThreads={},c.ownCharId=h.getSelectedCharacter().getId(),c.ownPlayerId=h.getPlayer().getId(),c.gameDataModel=h.getGameData(),c.setMode=u,c.openForum=C,c.openForumList=D,c.forumService=j,c.canCreateThread=Y,c.createThread=Z,c.createSurvey=ea,c.openThread=E,c.canPost=$,c.createPost=_,c.editPost=ba,c.newPost=ca,c.updatePost=aa,c.addQuote=da,c.moveForum=X,c.toggleSelection=fa,c.closeCurrentThread=ha,c.executeActionOnSelectedThreads=ga,c.openCharacterProfile=ia,c.jumpToLastPost=F,c.cancelThreadCreation=la,c.setSelectedForumId=B,c.$on(g.FORUM_FORUM_DELETED,L),c.$on(g.FORUM_FORUM_CREATED,W),c.$on(g.FORUM_FORUM_LIST,V),c.$on(g.FORUM_POST_CREATED,A),c.$on(g.FORUM_POST_DELETED,N),c.$on(g.FORUM_POST_EDITED,P),c.$on(g.FORUM_FORUM_MARKED_READ,H),c.$on(g.FORUM_FORUM_MARKED_UNREAD,I),c.$on(g.FORUM_FORUM_RENAMED,M),c.$on(g.FORUM_FORUM_ORDER_SET,J),c.$on(g.FORUM_THREAD_CREATED,R),c.$on(g.FORUM_THREADS_UPDATED,U),c.$on(g.FORUM_THREADS_DELETED,Q),c.$on(g.FORUM_THREADS_MARKED_UNREAD,T),c.$on(g.FORUM_THREADS_MOVED,S),c.$on(g.TRIBE_MEMBER_RIGHTS_SET,ja),c.$watch("activeTab",function(a){"forum"===a&&(ka(),b.checkFunc(function(){return c.directives},function(){c.directives.scrollbar.scrollbar.recalc()}))},!0)}])}),define("models/ErrandModel",[],function(){var a=function(a){this.data=a};return a.prototype.hiddenFromPlayer=function(){this.data.hiddenFromPlayer=!this.data.hiddenFromPlayer},a.prototype.insertedFromBackend=function(){this.data.insertedFromBackend=!this.data.insertedFromBackend},a}),define("controllers/screen/ResourceDepositScreenController",["app","helper/time","models/ErrandModel","conf/effectTypes","conf/tribeSkillNames","conf/resourceDepositJobStates"],function(a,b,c,d,e,f){a.controller("ResourceDepositScreenController",["$rootScope","$scope","$timeout","$filter","eventTypeProvider","routeProvider","socketService","resourceDepositService","modelDataService","premiumActionService","windowManagerService","inventoryService","effectService","inventoryItemTypeProvider",function(a,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u,v,w,x,y=300,z=60,A=1500,B=1e4,C=s.RESOURCE_DEPOSIT_REROLL,D="isNew",E="insert",F="insertingDone",G="insertedFromBackend",H="hiddenFromPlayer",I=!1,J=n.getTribeSkills(),K=function(a,b){t=b},L=function(){g.rerollItem=n.getInventory().getItemByType(C)},M=function(a,b,c){var d;for(d=0;d<a.length;d++)a[d][b]=void 0!==c?c:!a[d][b]},N=function(a,b,d,e){var f,g=[],i=function(){g.pop()[b]()};for(f=0;f<a.length;f++)g.push(new c(a[f])),h(i,f*d);e&&h(function(){e(a,b)},a.length*d+y)},O=function(a){var b=n.getSelectedCharacter().getResourceDeposit(),c=b.getCurrentJob();g.remainingResources=b.getResourcesLeft(),g.usedRes=g.maxResources-g.remainingResources,g.milestones=b.getMilestones(),g.jobs=b.getReadyJobs(),g.jobs&&(a===!0?(M(g.jobs,D),N(g.jobs,G,z,function(){M(g.jobs,G),M(g.jobs,D,!1)})):(M(g.jobs,F),M(g.jobs,D,!1),g.firstUse=m.firstUse())),g.collectibleAndRunningJobs=[].concat(c||[],b.getCollectibleJobs()||[]),c&&c.hiddenFromPlayer&&(c.hiddenFromPlayer=!1,c.insertedFromBackend=!0),c&&c.amount>=g.remainingResources&&(g.showRerollButton=!1,m.showRerollButton(!1)),L()},P=function(a){I||!a||g.collectibleAndRunningJobs.length>0||g.resetExpired||(a.hiddenFromPlayer=!0,I=a.id,h(function(){l.emit(k.RESOURCE_DEPOSIT_START_JOB,{job_id:a.id})},y))},Q=function(a){if(a){var c=parseInt(b.server2ClientTime(a.time_completed)-Date.now(),10);x=a.id,a.hiddenFromPlayer=!0,h(function(){l.emit(k.RESOURCE_DEPOSIT_COLLECT,{job_id:a.id,village_id:n.getSelectedVillage().getId()})},c>0?c:0)}},R=function(a){var b;a.state!==g.JOB_STATE.COMPLETED||x||(a.amount<g.remainingResources&&(g.showRerollButton=!0,m.showRerollButton(!0)),n.getSelectedVillage().getResources().getMaxStorage()-t[a.resource_type].currentProduction<a.amount?(b=g.$new(),b.type="errand",b.resource="storage",b.content="resources",b.finish=function(){Q(a),b.closeWindow()},p.getModal("modal_reward_full",b)):Q(a))},S=function(a,b){var c,d=n.getSelectedCharacter().getResourceDeposit();return b.job_id===I&&(I=!1),g.hasRemainingTime?void((c=d.getCurrentJob())&&(c.hiddenFromPlayer=!1,c.insertedFromBackend=!0,h(function(){c.insertedFromBackend=!1},y),O())):void l.emit(k.RESOURCE_DEPOSIT_GET_INFO)},T=function(){g.jobs&&(g.waitingForResponse=!0,N(g.jobs,H,z))},U=function(){g.rolling||g.waitingForResponse||g.usedRes>=B||(g.rerollItem&&g.rerollItem.amount?q.useItem(g.rerollItem,function(){var b=a.$new(),c="modal_premium";b.actionType="",b.title=i("i18n")("use_reroll_item",a.loc.ale,c),b.description=i("i18n")("use_reroll_item_description",a.loc.ale,c),b.iconName=C,b.costs="",b.usable=!0,b.cancelable=!1,b.extras="",b.onConfirm=function(){l.emit(k.PREMIUM_USE_ITEM,{village_id:n.getSelectedVillage().getId(),item_id:g.rerollItem.id}),T(),h(function(){g.waitingForResponse=!1,l.emit(k.RESOURCE_DEPOSIT_GET_INFO)},A)},p.getModal("modal_premium",b)}):o.rerollResourceDepositJobs(T,null,(g.jobs?g.jobs.length:1)*z))},V=function(){var a=Date.now(),b=Math.max(0,u-a)/1e3,c=Math.max(0,v-a)/1e3;return(0>=b||0>=c)&&!g.resetExpired&&(g.resetExpired=!0,h(function(){l.emit(k.RESOURCE_DEPOSIT_GET_INFO)},A)),{errands:b,milestones:c}},W=function(a,c,d){g.maxResources=B,g.resetExpired=!1,c.time_next_reset&&(u=b.server2ClientTime(c.time_next_reset)),c.time_new_milestones&&(v=b.server2ClientTime(c.time_new_milestones)),g.hasRemainingTime||(g.hasRemainingTime=u),g.remainingResources=c.resources_left,g.usedRes=g.maxResources-g.remainingResources,g.rerollCost=n.getGameData().getPremiumCostsForType(C),g.milestones=w.getMilestones(),O(d)},X=function(a,b){h(function(){g.jobs&&M(g.jobs,H,!1),W(a,b,!0),(g.rolling=w.hasLegendaryJob())&&h(function(){g.rolling=!1},A),h(function(){g.waitingForResponse=!1,M(g.jobs,E),h(function(){M(g.jobs,E),M(g.jobs,F)},A)},(g.jobs?g.jobs.length:1)*z+y)},(g.jobs?g.jobs.length:1)*z+y)},Y=function(a){var b,c,d=g.usedRes,e=0;for(b=0;b<g.milestones.length;b++)c=g.milestones[b],c.target<a.target&&(e=c.target);return 100*(a.achieved?1:a.ignore?0:(d-e)/(a.target-e))},Z=function(){g.lootBonusEffect=r.getEffect(d.INCREASED_CARRYING_CAPACITY),g.lootBonusEffect&&(g.lootBonusEffectValue=r.getEffectValue(g.lootBonusEffect)),g.lootBonusEffect&&J&&(g.hasActiveTribeSkillLootBonus=J.isSkillActive(e.loot_bonus)),g.speedEffect=r.getEffect(d.RESOURCE_DEPOSIT_JOB_DURATION),g.speedEffect&&(g.speedEffectValue=r.getEffectValue(g.speedEffect)),g.speedEffect&&J&&(g.hasActiveTribeSkillWalkingSpeed=J.isSkillActive(e.raid_speed))},$=function(){l.emit(k.RESOURCE_DEPOSIT_OPEN),m.disableHint(),w=n.getSelectedCharacter().getResourceDeposit(),Z()};g.getTimeUntilAutomaticReroll=V,g.startJob=P,g.collectJob=R,g.reroll=U,g.getProgressValue=Y,g.jobs=[],g.JOB_STATE=f,g.showRerollButton=m.showRerollButton(),g.$on(j.RESOURCES,K),g.$on(j.RESOURCE_DEPOSIT_INFO,W),g.$on(j.RESOURCE_DEPOSIT_JOBS_REROLLED,function(a,b){h(function(){X(a,b)},y)}),g.$on(j.RESOURCE_DEPOSIT_JOB_STARTED,S),g.$on(j.INVENTORY_ITEM_CHANGED,L),g.$on(j.RESOURCE_DEPOSIT_JOB_COLLECTED,function(a,b){b.job_id===x&&(x=null),h(O,y)}),a.$on(j.RESOURCE_DEPOSIT_JOB_COLLECTIBLE,O),a.$on(j.EFFECT_CHANGED,Z),a.$on(j.EFFECT_EXPIRED,Z),$()}])}),define("conf/secondVillageJobIcons",[],function(){return{break_day_1:"break",break_day_2:"break",break_day_3:"break",break_day_4:"break",brief_workers:"workers",build_shelter:"Craft",celebrate_founding:"celebrate",celebrate_hq:"celebrate",celebrate_new_village:"celebrate",clean_buildings:"reset-preceptory",collect_hay:"farm",construct_barracks:"barracks",construct_basement_hq:"constructionSite",construct_farm:"farm",construct_first_floor:"constructionSite",construct_gates:"item-upgrade",construct_roof:"Craft",construct_second_floor:"constructionSite",construct_storage:"storage",construct_weapons_chamber:"constructionSite",craft_basic_tools:"item-upgrade",craft_bricks:"Craft",craft_even_more_bricks:"Craft",craft_iron_doors:"item-upgrade",craft_ladder:"Craft",craft_more_bricks:"Craft",craft_nails_and_hinges:"item-upgrade",craft_palisade:"Craft",craft_wooden_boards:"Craft",cut_down_trees:"timberCamp",dig_building_pit:"constructionSite",find_foundation_stone:"foundation-stone",find_pegs_for_border:"pegs",gather_food_for_craftsmen:"farm",gather_more_wood:"resource-wood",gather_some_clay:"resource-clay",gather_some_iron:"resource-iron",gather_wood_for_shelter:"resource-wood",hire_some_farmers:"workers",hire_workers:"workers",lay_down_foundation_stone:"foundation-stone",mark_village_border:"pegs",pave_rally_point:"rallyPoint",prepare_rations:"farm",prepare_roof_materials:"resources",provide_first_aid:"quest-hospital",replace_injured_workers:"workers",scout_surroundings:"scout",setup_provisional_production:"resources",store_rations:"resources"}}),define("controllers/screen/SecondVillageScreenController",["app","angular","conf/conf","cdn","helper/time","conf/secondVillageJobIcons","conf/rewardTypes"],function(a,b,c,d,e,f,g){a.controller("SecondVillageScreenController",["$rootScope","$scope","$filter","$timeout","eventTypeProvider","routeProvider","socketService","modelDataService","secondVillageService","iconAnimationsService","windowManagerService","windowDisplayService","storageService","resourceService","armyService",function(a,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v,w,x,y,z,A,B,C,D,E=11,F=10,G={NOT_STARTED:0,HINT:1,STARTED:2,FINISHED_LAST_JOB:3},H=5e3,I=n.getSelectedCharacter(),J=n.getSelectedVillage(),K=[],L=function(){return o.hasFinishedLastJob(h.allJobs)?G.FINISHED_LAST_JOB:h.jobInProgress.id?G.STARTED:Object.keys(y).length>0&&!h.jobInProgress.id?G.HINT:G.NOT_STARTED},M=function(){m.emit(l.SECOND_VILLAGE_FINISH_VILLAGE)},N=function(a){var b,c=a.costs;for(b in c)if(c[b]>0)return b;return!1},O=function(){var a,b,c,d,f,g=h.allJobs[h.selectedJobId],i=Date.now();return g&&g.takes_until_end_of_day&&(g.duration=(B-i)/1e3),h.jobInProgress.id?(f=h.allJobs[h.jobInProgress.id],a=e.server2ClientTime(f.time_completed),h.jobInProgress.completed=i>=a,void(h.jobInProgress.completed||(b=e.server2ClientTime(f.time_started),c=a-b,d=i-b,h.jobInProgress.percent=Math.round(d/c*100),h.jobInProgress.timeLeft=a-i))):void(h.jobInProgress.rewards=null)},P=function(a){var b=Object.keys(o.getCollectedJobs(w)).length,c=1;h.onJobCollectedTimeout||(h.state=G.STARTED,h.selectedJobId=a,h.selectedJob=h.allJobs[h.selectedJobId],h.selectedJobRequiredResource=N(h.selectedJob),h.selectedJobHasBuildingRequirements=Object.keys(h.selectedJob.buildings_required).length,e.timer.add(O),h.jobInProgress.collectableFromYesterday||b?h.currentJobPoints=c:C>0?b||(h.currentJobPoints=E-Object.keys(o.getYesterdaysCollected(C,h.allJobs)).length):h.currentJobPoints=c)},Q=function(){var b,c=z.village_name,d=I.getName();return b=c===i("i18n")("second_village",a.loc.ale,"village_name",d)?i("i18n")("label",a.loc.ale,"screen_second_village"):c},R=function(a,b){var c;return b?(h.jobInProgress.id=null,h.jobInProgress.completed=!1,void(h.jobInProgress.collectableFromYesterday=!1)):(a?(h.jobInProgress.id=a,h.jobInProgress.percent=0):h.jobInProgress.id=o.getJobInProgress(h.allJobs),h.jobInProgress.completed&&(c=z.end_of_day-e.inS.day,h.allJobs[h.jobInProgress.id].time_completed<c&&(h.jobInProgress.collectableFromYesterday=!0)),void(h.jobInProgress.id&&(P(h.jobInProgress.id),h.jobInProgress.rewards||(h.jobInProgress.rewards=h.allJobs[h.jobInProgress.id].rewards))))},S=function(){var a=0,b=0,c=Object.keys(o.getCollectedJobs(w)).length;return C>1&&(a=(C-1)*F),C>0&&(b=0===c?Object.keys(o.getYesterdaysCollected(C,h.allJobs)).length:F),a+b+c},T=function(a,b){h.unmetRequirementJobs=o.getUnmetRequirementJobs(w,y,h.resources,x),h.availableJobs=o.getAvailableJobs(w,y,h.resources,x)},U=function(a){var b,c=[];if(z=a,h.allJobs=a.jobs,C=a.day,w=o.getCurrentDayJobs(h.allJobs,C),y=o.getCollectedJobs(h.allJobs,C),T(),K=o.getBuildings(h.allJobs,y),!h.initialized){h.initialBuildings=K;for(b in h.availableJobs)c.push(h.availableJobs[b].id);h.initialJobs=c}R(),h.buildings=K,h.state=L(),h.secondVillageName=Q(),h.totalPoints=Object.keys(h.allJobs).length,h.points=S(),h.WIDTH_ONE_POINT=$(".progressbar").width()/h.totalPoints,B=e.server2ClientTime(a.end_of_day),A&&j.cancel(A),A=j(D,B-Date.now()+H),h.initialized=!0,O()},V=function(a){h.jobInProgress.id||h.unmetRequirementJobs[h.selectedJobId]||m.emit(l.SECOND_VILLAGE_START_JOB,{village_id:n.getSelectedVillage().getId(),job_id:a})},W=function(){m.emit(l.SECOND_VILLAGE_COLLECT_JOB_REWARD,{village_id:n.getSelectedVillage().getId(),job_id:h.jobInProgress.id})},X=function(){r.openChangeVillageName(c.RESERVED_VILLAGE_IDS.SECOND_VILLAGE);

},Y=function(a,b){a!==b&&(h.bubbleAnimation=!0),v()},Z=function(a,b){b&&a!==b&&(h.pointsDiff=h.points-b,h.pointsAddAnimation=!1,j(function(){h.pointsAddAnimation=!0}))},_=function(a){return d.getPath("/img/second-village/"+a+".png")},aa=function(a,b){R(b.job_id),h.allJobs[h.jobInProgress.id].time_completed=b.time_completed,h.allJobs[h.jobInProgress.id].time_started=b.time_started,h.startJobAnimation=!1,j(function(){h.startJobAnimation=!0})},ba=function(a,b){var c,d,e,f,i,k,q,r,t=[],v=h.allJobs[h.jobInProgress.id],A=h.jobInProgress.rewards||{},B=1e3,C=n.getSelectedVillage().getResources().getMaxStorage(),D={};for(""!==v.building_graphic&&K.push(v.building_graphic),q=0;q<v.rewards.length;q++)for(r in v.rewards[q].content)D[r]=v.rewards[q].content[r],k=v.rewards[q].item_type;for(q in D)if(k===g.reward_resources){if(C-h.resources[q]<D[q]){f="resources";break}}else if(k===g.reward_units&&(i=u.calculateCost(v.rewards[0].content),h.resources.food<i.food)){f="resources";break}for(q=0;q<A.length;q++)c=A[q],d=Object.keys(c.content)[0],c.item_type===h.REWARD_TYPES.reward_resources?e="resource-"+d:c.item_type===h.REWARD_TYPES.reward_units&&(e="unit-"+d),t.push(e);s.setItem("secondVillageUsed",!0),p.createAnimations(t,f),h.allJobs[h.jobInProgress.id].collected=!0,y=o.getCollectedJobs(h.allJobs),h.onJobCollectedTimeout=!0,j(function(){h.jobInProgress.collectableFromYesterday&&m.emit(l.SECOND_VILLAGE_GET_INFO,{},U),R(null,!0),h.selectedJobId=null,h.availableJobs=o.getAvailableJobs(w,y,h.resources,x),h.state=L(),h.onJobCollectedTimeout=!1,U(z)},B)},ca=function(a,b){h.resources.wood!==b.wood.currentProduction&&h.resources.clay!==b.clay.currentProduction&&h.resources.iron!==b.iron.currentProduction&&(h.resources.wood=b.wood.currentProduction,h.resources.clay=b.clay.currentProduction,h.resources.iron=b.iron.currentProduction,h.resources.food=b.food.currentProduction,T())},da=function(a,b){h.secondVillageName=b.new_name},ea=function(a){a&&U(z)},fa=function(){h.closeWindow()},ga=function(){e.timer.remove(O)};D=function(){J=n.getSelectedVillage(),h.resources=b.copy(J.getResources().getResources()),h.buildingData=J.getBuildingData(),h.bubbleAnimation=!0,h.pointsDiff=0,1===I.getVillages().length?m.emit(l.SECOND_VILLAGE_OPEN,{},U):m.emitInOrder([l.GET_CHARACTER_VILLAGES,l.SECOND_VILLAGE_OPEN],[{},{}],function(a){x=a[0].villages,U(a[1])})},h.STATES=G,h.JOB_ICONS=f,h.REWARD_TYPES=g,h.amountDaysAttackProtection=n.getWorldConfig().getAmountDaysAttackProtection(),h.jobInProgress={completed:!1,percent:0,timeLeft:0,id:null,rewards:null,collectableFromYesterday:!1},h.showAvailableJob=P,h.startJob=V,h.collectReward=W,h.getImagePath=_,h.finishFeature=M,h.openChangeVillageName=X,h.$on(k.SECOND_VILLAGE_JOB_STARTED,aa),h.$on(k.SECOND_VILLAGE_JOB_COLLECTED,ba),h.$on(k.RESOURCES,ca),h.$on(k.BUILDING_LEVEL_CHANGED,T),h.$on(k.SECOND_VILLAGE_VILLAGE_RENAMED,da),h.$on(k.SECOND_VILLAGE_VILLAGE_CREATED,fa),h.$on("$destroy",ga),v=h.$watch("state",Y),h.$watch("jobInProgress.completed",ea),h.$watch("points",Z),D()}])}),define("controllers/screen/DevToolsScreenController",["app","angular","conf/conf","conf/tips","helper/time","struct/MapData","queues/EventQueue"],function(a,b,c,d,e,f,g){a.controller("DevToolsScreenController",["$rootScope","$scope","modelDataService","socketModelService","tipService","timelineDataProvider","eventTypeProvider",function(a,b,h,i,j,k,l){var m=0,n=0,o=["Slartibartfast","Zaphod Beeblebrox","Ford Prefect","Trillian","Arthur Dent","Humma Kavula"],p=["Magrathea","Golgafrincham","Earth","Vogsphere","Milliways","Betelgeuse 7"],q="attack",r="support",s=function(){return Math.floor(Date.now()/1e3+b.timeline.timeframe.begin+Math.random()*Math.random()*Math.random()*b.timeline.timeframe.end)},t=function(){return p.random()},u=function(){return o.random()},v=function(a){return{id:n++,type:"attack",icon:"",home:{id:2,name:p.random(),x:Math.floor(1e3*Math.random()),y:Math.floor(1e3*Math.random()),character_id:2},target:{id:a.getId(),name:a.getName(),x:a.getX(),y:a.getY(),character_id:h.getSelectedCharacter().getId()},time_start:Date.now()/1e3,time_completed:Date.now()/1e3+e.inS.threeDay}},w=function(a,b,c){var d=(b?"returning_":"incoming_")+a;return{village_id:1,event_type:d,event_id:m,command_type:a,village_name:t(),village_owner_id:1,village_owner_name:u()+"::"+d,report_id:null,units:{},haul:c?{wood:123,clay:123,iron:123}:null}},x={scouting:function(){return{type:"scouting",subType:"buildings",id:m++,time:s()}},building:function(){return{type:"build",building_type:Object.keys(h.getGameData().getBuildings()).random(),id:m++,time:s()}},recruit:function(){return{type:"recruit",unit_type:h.getGameData().getUnits().random().name,id:m++,time:s(),amount:Math.ceil(50*Math.random())}},returningAttack:function(){var a=["full","partial",void 0].random();return{type:k.RETURNING_ATTACK,id:m++,time:s(),losses:!!Math.round(Math.random()),haul:a,requestSent:!0,details:w(q,!0,a)}},"încomingAttack":function(){return{type:k.INCOMING_ATTACK,id:m++,time:s(),requestSent:!0,details:w(q,!1)}},returningSupport:function(){return{type:k.RETURNING_SUPPORT,id:++m,time:s(),requestSent:!0,details:w(r,!0)}},"încomingSupport":function(){return{type:k.INCOMING_SUPPORT,id:m++,time:s(),requestSent:!0,details:w(r,!1)}}},y=function(b){for(var c=h.getSelectedVillage();b--;)i.handle({type:l.COMMAND_INCOMING,data:v(c)});a.$broadcast(l.COMMAND_INCOMING,{})},z=function(a,b){var c=h.getSelectedVillage().getTimeline(),d=Object.keys(x);if("random"!==b)for(;a--;)c.insert(x[b]());else for(;a--;)c.insert(x[d.random()]())},A=function(){var a,d,e=h.getSelectedVillage(),i=f.getProvince(e.getX(),e.getY());if(i&&(a=i.length))for(;a--;)if(d=i[a],d.key.f)return f.setSpecialLocationData({villages:[{x:b.invite.x=d.x,y:b.invite.y=d.y,name:"InviteAFriendName",id:c.RESERVED_VILLAGE_IDS.INVITE_A_FRIEND}],x:d.x,y:d.y}),void g.trigger(g.types.MAPDATA_UPDATE,null)},B=function(){f.removeSpecialLocation(c.RESERVED_VILLAGE_IDS.INVITE_A_FRIEND),b.invite.x=null,b.invite.y=null,g.trigger(g.types.MAPDATA_UPDATE,null)},C=function(a){j.showSmartTip("random"===a.value?b.smartTips.TYPES.random().value:a.value)};b.components={minimized:!0},b.timeline={minimized:!0,amount:50,insertEvents:z,TYPES:[{name:"Build job",value:"building"},{name:"Recruit job",value:"recruit"},{name:"Returning attack",value:"returningAttack"},{name:"Returning Support",value:"returningSupport"},{name:"Incoming attack",value:"incomingAttack"},{name:"Incoming Support",value:"incomingSupport"},{name:"Scouting",value:"scouting"}],type:{name:"random",value:"random"},timeframe:{begin:0,end:e.inS.threeDay},max:e.inS.threeDay},b.invite={minimized:!0,spawn:A,remove:B,x:null,y:null},b.attacks={minimized:!0,amount:50,spawnAttacks:y},b.smartTips={minimized:!0,TYPES:function(a){var b,c=[];for(b in a)c.push({name:b,value:a[b]});return c}(d.TYPES),type:{name:"random",value:"random"},worldConfig:h.getWorldConfig().areSmartTipsEnabled(),showSmartTip:C}}])}),define("controllers/screen/overview/OverviewController",["app","angular","models/CommandModel"],function(a,b,c){a.controller("OverviewController",["$rootScope","$scope","$filter","groupService","modelDataService","overviewService","windowDisplayService","mapService","eventTypeProvider","storageService",function(a,d,e,f,g,h,i,j,k,l){var m=null,n=256,o=g.getGameData().getOrderedUnitNames(),p=g.getGameData().getOfficers(),q=Object.keys(g.getGameData().getBuildings()),r={VILLAGES:"villages",INCOMING:"incoming",COMMANDS:"commands",UNITS:"units"},s=[r.VILLAGES,r.INCOMING,r.COMMANDS,r.UNITS],t={VILLAGE_NAME:"village_name",GROUPS:"groups",STATUS:"status",UNITS:"units",INFO:"info",ORIGIN_VILLAGE:"origin_village_name",ORIGIN_GROUPS:"origin_groups",COMMAND_TYPE:"command_type",TARGET_CHARACTER:"target_character_name",TARGET_VILLAGE:"target_village_name",TARGET_GROUPS:"target_groups",TIME_COMPLETED:"time_completed",COMMAND_PROGRESS:"command_progress",CAPACITY:"capacity",OFFICERS:"officers",ORIGIN_CHARACTER:"origin_character_name",IGNORE:"ignore",PROVINCE_NAME:"province_name",BUILDINGS:"buildings",MERCHANTS:"merchants_free",LOYALTY:"loyalty",POINTS:"points",WOOD:"wood",CLAY:"clay",IRON:"iron",FOOD:"food",STORAGE:"storage",BUILD_JOBS:"build_jobs",RECRUIT_JOBS:"recruit_jobs",BOOST:"premium_boost_active",SCOUTS:"scouts",COUNTER_MEASURES:"counter_measures",PRECEPTORY_ORDER:"preceptory_order"},u={ATTACK:"attack",SUPPORT:"support"},v={OUTGOING:"outgoing",RETURNING:"returning"},w=h.UNIT_STATUS,x=["ALL","OWN","OUT","WAY"],y={VIEW:"view",COMMAND_TYPES:"commandTypes",DIRECTIONS:"directions",UNIT_STATUS:"unitStatus",GROUPS:"groups",VILLAGE:"village"},z=function(a){d.activeTab=a},A=function(){d.groups=f.getGroups(),d.amountGroups=Object.keys(d.groups).length},B=function(a){return d.groups[a]},C=function(){var a,c,e,f=l.getItem("overviewFilters");if(f){d.filters=f;for(c in d.filters[y.GROUPS]){a=!1;for(e in d.groups)e===c&&(a=!0);a||delete d.filters[y.GROUPS][c]}}else{d.filters={},d.filters[y.PREDEFINED]="all",d.filters[y.COMMAND_TYPES]=b.copy(u),d.filters[y.DIRECTIONS]=b.copy(v),d.filters[y.UNIT_STATUS]=b.copy(w),d.filters[y.GROUPS]={},d.filters[y.VILLAGE]=!1;for(c in d.groups)d.filters[y.GROUPS][d.groups[c].id]=!1;for(c in d.filters.unitStatus)d.filters.unitStatus[c]=c===x[0]?!0:!1}},D=function(a){m&&clearTimeout(m),m=setTimeout(function(){a(),m=null},2e3)},E=function(){var a,b,e=[y.GROUPS,y.DIRECTIONS,y.COMMAND_TYPES],f=g.getSelectedVillage().getId(),h={};for(a=0;a<e.length;a++)for(b in d.filters[e[a]])if(h[e[a]]||(h[e[a]]=[]),d.filters[e[a]][b])switch(e[a]){case y.GROUPS:h[e[a]].push(b);break;case y.DIRECTIONS:h[e[a]].push("OUTGOING"===b?c.DIRECTION_OUTGOING:c.DIRECTION_INCOMING);break;case y.COMMAND_TYPES:h[e[a]].push("ATTACK"===b?d.COMMAND_TYPES.ATTACK:d.COMMAND_TYPES.SUPPORT)}d.params=h,d.params.village=d.filters[y.VILLAGE]?[f]:[]},F=function(a,b){var c,e=0;b?d.filters[a][b]=!d.filters[a][b]:d.filters[a]=!d.filters[a];for(c in d.filters.unitStatus)d.filters.unitStatus[c]&&(e++,d.onlyActiveStatusFilter=w[c]);e>1&&(d.onlyActiveStatusFilter=!1),E(),l.setItem("overviewFilters",d.filters),d.$broadcast(k.OVERVIEW_FILTERS_CHANGED,d.filters)},G=function(a,b){var c,d=window.innerWidth;for(c=0;c<a.length;c++)a[c].visible=d>(b.hasOwnProperty(a[c].priority)?b[a[c].priority]:n)},H=function(a,b,c){var d,e,f,g,h,i;for("unit"===a?(e="units",f="unit_names",h=c||o):(e="buildings",f="building_names",h=c||q),i=0;i<b.length;i++)b[i].name===e&&(d=b[i].priority,b.splice(i,1),g=i);for(i=0;i<h.length;i++)b.splice(g+i,0,{name:h[i],priority:d,textObject:f,icon:a})},I=function(a,b){j.jumpToVillage(a,b),d.closeWindow()},J=function(a){return e("i18n")(a,d.locale,"screen_overview")},K=function(a){var b,c=[];for(b in a)c.push({name:J(b.toLowerCase()),value:b});return c},L=function(){A(),C(),E(),d.activeTab||z(r.VILLAGES)};d.TAB_ORDER=s,d.TABS=r,d.COMMAND_TYPES=u,d.DIRECTIONS=v,d.UNIT_STATUS=w,d.UNIT_STATUS_ORDER=x,d.FILTER_TYPES=y,d.ITEMS_PER_PAGE=25,d.ORDERED_UNIT_NAMES=o,d.ORDERED_OFFICER_NAMES=p,d.ORDERED_BUILDING_NAMES=q,d.viewList=[],d.selectedAction={},d.setActiveTab=z,d.toggleFilter=F,d.updateColumnVisibility=G,d.getGroup=B,d.insertColumns=H,d.openVillageInfo=i.openVillageInfo,d.jumpToVillage=I,d.openCharacterProfile=i.openCharacterProfile,d.openChangeVillageName=i.openChangeVillageName,d.getViewList=K,d.delayedReload=D,d.COLUMN_TYPES=t,d.$on(k.GROUPS_CREATED,A),d.$on(k.GROUPS_DESTROYED,A),d.$on(k.GROUPS_UPDATED,A),L()}])}),define("controllers/screen/overview/OverviewCommandsController",["app","helper/time","queues/EventQueue"],function(a,b,c){a.controller("OverviewCommandsController",["$rootScope","$scope","socketService","routeProvider","commandService","eventTypeProvider","overviewService","storageService",function(a,d,e,f,g,h,i,j){var k=!1,l={},m=[d.COLUMN_TYPES.OFFICERS],n={DEFAULT:{columns:[{name:d.COLUMN_TYPES.ORIGIN_VILLAGE,priority:1},{name:d.COLUMN_TYPES.ORIGIN_GROUPS,priority:1},{name:d.COLUMN_TYPES.COMMAND_TYPE,priority:1},{name:d.COLUMN_TYPES.TARGET_CHARACTER,priority:2},{name:d.COLUMN_TYPES.TARGET_VILLAGE,priority:1},{name:d.COLUMN_TYPES.TARGET_GROUPS,priority:3},{name:d.COLUMN_TYPES.TIME_COMPLETED,priority:1},{name:d.COLUMN_TYPES.COMMAND_PROGRESS,priority:1},{name:d.COLUMN_TYPES.UNITS,priority:4},{name:d.COLUMN_TYPES.CAPACITY,priority:6},{name:d.COLUMN_TYPES.OFFICERS,priority:5}],priorityWidths:{2:1124,3:1230,4:1806,5:2120,6:2200}}},o=function(){d.updateColumnVisibility(d.columns,n.DEFAULT.priorityWidths)},p=function(a){var b;for(d.commands=a.commands,d.pagination.count=a.total,d.pagination.offset=a.offset,b=0;b<d.commands.length;b++)i.formatCommand(d.commands[b])},q=function(){e.emit(f.OVERVIEW_GET_COMMANDS,{count:d.pagination.limit,offset:d.pagination.offset,sorting:d.sorting.column,reverse:d.sorting.reverse?1:0,groups:d.params[d.FILTER_TYPES.GROUPS]||[],directions:d.params[d.FILTER_TYPES.DIRECTIONS],command_types:d.params[d.FILTER_TYPES.COMMAND_TYPES],villages:d.params[d.FILTER_TYPES.VILLAGE]},p)},r=function(a){-1===m.indexOf(a)&&(d.sorting.column===a&&(d.sorting.reverse=!d.sorting.reverse),d.sorting.column=a,d.pagination.offset=0,j.setItem("overviewCommandsSorting",d.sorting),q())},s=function(){var a;for(a=0;a<d.commands.length;a++)if(100===d.commands[a].model.percent()&&!d.commands[a].model.done)return d.commands[a].model.done=!0,void d.delayedReload(q)},t=function(){var a;c.unregister(c.types.RESIZE,o);for(a in l)l[a]();b.timer.remove(s)},u=function(){d.delayedReload(q)},v=function(a,b){var c=i.getCommandFromList(d.commands,b.id);c&&d.delayedReload(q)},w=function(a,b){var c=i.getCommandFromList(d.commands,b.id);c&&d.delayedReload(q)},x=function(a,b){var c;for(c=0;c<d.commands.length;c++)d.commands[c].origin_village_id===b.village_id&&(d.commands[c].origin_village_name=b.name,d.commands[c].originVillage.name=b.name)},y=function(e){return e!==d.TABS.COMMANDS?void t():(k||d.insertColumns("unit",n.DEFAULT.columns),k=!0,o(),c.register(c.types.RESIZE,o),b.timer.add(s),d.sorting=j.getItem("overviewCommandsSorting")||d.sorting,l[h.COMMAND_SENT]=a.$on(h.COMMAND_SENT,u),l[h.COMMAND_CANCELLED]=a.$on(h.COMMAND_CANCELLED,v),l[h.COMMAND_RETURNED]=a.$on(h.COMMAND_RETURNED,w),l[h.COMMAND_RETURNED]=a.$on(h.VILLAGE_NAME_CHANGED,x),void(l.filters=d.$watch("filters",q,!0)))};d.commands=[],d.columns=n.DEFAULT.columns,d.SORT_BLACKLIST=m,d.pagination={count:0,limit:d.ITEMS_PER_PAGE,limits:[d.ITEMS_PER_PAGE],offset:0,loader:q},d.sorting={column:d.COLUMN_TYPES.ORIGIN_VILLAGE,reverse:!1},d.renameCommand=i.renameCommand,d.commandService=g,d.toggleSorting=r,d.$watch("activeTab",y),d.$on("$destroy",t)}])}),define("controllers/screen/overview/OverviewVillagesController",["app","angular","queues/EventQueue"],function(a,b,c){a.controller("OverviewVillagesController",["$scope","socketService","routeProvider","eventTypeProvider","modelDataService","queueService","$timeout","storageService",function(a,d,e,f,g,h,i,j){var k=j.getItem("overviewVillagesPredefinedFilter"),l=g.getGameData(),m=!1,n={},o=l.getCounterMeasureNames(),p=l.getBuildingTypes(),q=[a.COLUMN_TYPES.BUILD_JOBS,a.COLUMN_TYPES.RECRUIT_JOBS],r={COMBINED:{buildings:[p.HEADQUARTER,p.BARRACKS,p.CHURCH,p.WALL,p.FARM],columns:[{name:a.COLUMN_TYPES.VILLAGE_NAME,priority:1},{name:a.COLUMN_TYPES.GROUPS,priority:6},{name:a.COLUMN_TYPES.PROVINCE_NAME,priority:4},{name:a.COLUMN_TYPES.BUILDINGS,priority:1},{name:a.COLUMN_TYPES.UNITS,priority:1},{name:a.COLUMN_TYPES.MERCHANTS,priority:5},{name:a.COLUMN_TYPES.LOYALTY,priority:2},{name:a.COLUMN_TYPES.POINTS,priority:3}],priorityWidths:{2:1111,3:1257,4:1357,5:1441,6:1580}},PRODUCTION:{columns:[{name:a.COLUMN_TYPES.VILLAGE_NAME,priority:1},{name:a.COLUMN_TYPES.GROUPS,priority:10},{name:a.COLUMN_TYPES.PROVINCE_NAME,priority:8},{name:a.COLUMN_TYPES.POINTS,priority:7},{name:a.COLUMN_TYPES.WOOD,priority:1,icon:"resource"},{name:a.COLUMN_TYPES.CLAY,priority:1,icon:"resource"},{name:a.COLUMN_TYPES.IRON,priority:1,icon:"resource"},{name:a.COLUMN_TYPES.STORAGE,priority:2},{name:a.COLUMN_TYPES.FOOD,priority:1,icon:"resource"},{name:a.COLUMN_TYPES.MERCHANTS,priority:4},{name:a.COLUMN_TYPES.BUILD_JOBS,priority:5},{name:a.COLUMN_TYPES.RECRUIT_JOBS,priority:6},{name:a.COLUMN_TYPES.BOOST,priority:3}],priorityWidths:{6:1370,7:1450,8:1550,9:1550,10:1700}},BUILDINGS:{columns:[{name:a.COLUMN_TYPES.VILLAGE_NAME,priority:1},{name:a.COLUMN_TYPES.GROUPS,priority:10},{name:a.COLUMN_TYPES.PROVINCE_NAME,priority:8},{name:a.COLUMN_TYPES.POINTS,priority:7},{name:a.COLUMN_TYPES.BUILDINGS,priority:1},{name:a.COLUMN_TYPES.BUILD_JOBS,priority:4}],priorityWidths:{4:1140,5:1140,6:1140,7:1230,8:1320,9:1320,10:1470}},UNITS:{columns:[{name:a.COLUMN_TYPES.VILLAGE_NAME,priority:1},{name:a.COLUMN_TYPES.GROUPS,priority:10},{name:a.COLUMN_TYPES.PROVINCE_NAME,priority:8},{name:a.COLUMN_TYPES.POINTS,priority:7},{name:a.COLUMN_TYPES.UNITS,priority:1},{name:a.COLUMN_TYPES.SCOUTS,priority:2},{name:a.COLUMN_TYPES.COUNTER_MEASURES,priority:3},{name:a.COLUMN_TYPES.PRECEPTORY_ORDER,priority:4},{name:a.COLUMN_TYPES.RECRUIT_JOBS,priority:5}],priorityWidths:{3:1060,4:1150,5:1490,6:1490,7:1590,8:1690,9:1690,10:1850}}},s=function(a){var b;if(a.updateTimer&&a.updateTimer.length>0)for(b=0;b<a.updateTimer.length;b++)i.cancel(a.updateTimer[b]);a.updateTimer=[]},t=function(){var b,c,d;if(a.villages)for(b=0;b<a.villages.length;b++){if(d=a.villages[b],d.recruit_jobs)for(c=0;c<d.recruit_jobs.length;c++)s(d.recruit_jobs[c]);if(d.build_jobs)for(c=0;c<d.build_jobs.length;c++)s(d.build_jobs[c])}},u=function I(a,b){var c,d,e,f;if(a&&(a.jobDuration=h.getQueueIndicator(a.time_completed),b))for(s(a),c=function(a){return function(){I(a,!1)}}(a),d=h.getIndicatorChangeDurations(a.time_completed),f=0;f<d.length;f++)e=i(c,d[f]+100),a.updateTimer.push(e)},v=function(a){var b;if(a)for(b=0;b<a.length;b++)u(a[b],!0)},w=function(){var b;if(a.villages)for(b=0;b<a.villages.length;b++)v(a.villages[b].recruit_jobs),v(a.villages[b].build_jobs)},x=function(b){var c,d=l.getResourceNames();for(b.data={name:b.village_name,x:b.x,y:b.y,id:b.village_id},c=0;c<b.groups.length;c++)b.groups[c]=a.getGroup(b.groups[c]);for(b.loyalty=Math.floor(b.loyalty),b.resources={},c=0;c<d.length;c++)b.resources[d[c]]={current:b["res_"+d[c]],max:d[c]===a.COLUMN_TYPES.FOOD?b.max_food:b.storage}},y=function(){a.updateColumnVisibility(a.columns,a.view.priorityWidths)},z=function(b){var c;for(a.villages=b.villages,a.pagination.count=b.total,a.pagination.offset=b.offset,c=0;c<a.villages.length;c++)x(a.villages[c]);w()},A=function(){d.emit(e.OVERVIEW_GET_VILLAGES,{count:a.pagination.limit,offset:a.pagination.offset,sorting:a.sorting.column,reverse:a.sorting.reverse?1:0,groups:a.params[a.FILTER_TYPES.GROUPS]||[]},z)},B=function(b){-1===q.indexOf(b)&&(a.sorting.column===b&&(a.sorting.reverse=!a.sorting.reverse),a.sorting.column=b,a.pagination.offset=0,j.setItem("overviewVillagesSorting",a.sorting),A())},C=function(b){var c;for(c=0;c<a.columns.length;c++)a.columns[c].name===a.COLUMN_TYPES.BUILDINGS&&a.insertColumns("building",a.columns,a.view.buildings),a.columns[c].name===a.COLUMN_TYPES.UNITS&&a.insertColumns("unit",a.columns)},D=function(b,c){j.setItem("overviewVillagesPredefinedFilter",a.selectedAction),a.view=r[b.value],a.columns=a.view.columns,C(),y(),a.pagination.offset=0},E=function(){var a;t(),c.unregister(c.types.RESIZE,y);for(a in n)n[a]()},F=function(){a.delayedReload(A)},G=function(b,c){var d;for(d=0;d<a.villages.length;d++)a.villages[d].village_id===c.village_id&&(a.villages[d].village_name=c.name,a.villages[d].name=c.name)},H=function(d){return d!==a.TABS.VILLAGES?void E():(m||C(),m=!0,a.$parent.$parent.viewList=a.getViewList(r),a.$parent.$parent.selectedAction=j.getItem("overviewVillagesPredefinedFilter")||b.copy(a.viewList[0]),a.sorting=j.getItem("overviewVillagesSorting")||a.sorting,y(),c.register(c.types.RESIZE,y),n.selectedAction=a.$watch("selectedAction",D,!0),n.filters=a.$watch("filters",A,!0),n[f.VILLAGE_LOST]=a.$on(f.VILLAGE_LOST,F),n[f.VILLAGE_RESOURCES_CHANGED]=a.$on(f.VILLAGE_RESOURCES_CHANGED,F),n[f.VILLAGE_STORAGE_INFO]=a.$on(f.VILLAGE_STORAGE_INFO,F),n[f.VILLAGE_UNIT_INFO]=a.$on(f.VILLAGE_UNIT_INFO,F),n[f.VILLAGE_NAME_CHANGED]=a.$on(f.VILLAGE_NAME_CHANGED,G),n[f.VILLAGE_OWNER_CHANGED]=a.$on(f.VILLAGE_OWNER_CHANGED,F),void(n[f.GROUPS_VILLAGES_CHANGED]=a.$on(f.GROUPS_VILLAGES_CHANGED,F)))};a.ORDER_TYPES=l.getOrderTypes(),a.COUNTER_MEASURES=o,a.view=k?r[k.value]:r.COMBINED,a.columns=a.view.columns,a.SORT_BLACKLIST=q,a.pagination={count:0,limit:a.ITEMS_PER_PAGE,limits:[a.ITEMS_PER_PAGE],offset:0,loader:A},a.sorting={column:a.COLUMN_TYPES.VILLAGE_NAME,reverse:!1},a.toggleSorting=B,a.$watch("activeTab",H),a.$on("$destroy",E)}])}),define("controllers/screen/overview/OverviewIncomingController",["app","helper/time","queues/EventQueue"],function(a,b,c){a.controller("OverviewIncomingController",["$rootScope","$scope","socketService","routeProvider","commandService","eventTypeProvider","overviewService","storageService",function(a,d,e,f,g,h,i,j){var k=!1,l={},m=[d.COLUMN_TYPES.IGNORE],n={DEFAULT:{columns:[{name:d.COLUMN_TYPES.TARGET_VILLAGE,priority:1},{name:d.COLUMN_TYPES.TARGET_GROUPS,priority:1},{name:d.COLUMN_TYPES.COMMAND_TYPE,priority:1},{name:d.COLUMN_TYPES.ORIGIN_CHARACTER,priority:2},{name:d.COLUMN_TYPES.ORIGIN_VILLAGE,priority:1},{name:d.COLUMN_TYPES.ORIGIN_GROUPS,priority:3},{name:d.COLUMN_TYPES.TIME_COMPLETED,priority:1},{name:d.COLUMN_TYPES.COMMAND_PROGRESS,priority:1},{name:d.COLUMN_TYPES.IGNORE,priority:1}],priorityWidths:{2:1124,3:1230}}},o=function(){d.updateColumnVisibility(d.columns,n.DEFAULT.priorityWidths)},p=function(a){var b;for(d.commands=a.commands,d.pagination.count=a.total,d.pagination.offset=a.offset,b=0;b<d.commands.length;b++)i.formatCommand(d.commands[b])},q=function(){e.emit(f.OVERVIEW_GET_INCOMING,{count:d.pagination.limit,offset:d.pagination.offset,sorting:d.sorting.column,reverse:d.sorting.reverse?1:0,groups:d.params[d.FILTER_TYPES.GROUPS]||[],command_types:d.params[d.FILTER_TYPES.COMMAND_TYPES],villages:d.params[d.FILTER_TYPES.VILLAGE]},p)},r=function(a){-1===m.indexOf(a)&&(d.sorting.column===a&&(d.sorting.reverse=!d.sorting.reverse),d.sorting.column=a,d.pagination.offset=0,j.setItem("overviewIncomingSorting",d.sorting),q())},s=function(){var a,b=Date.now();for(a=0;a<d.commands.length;a++)if(100===d.commands[a].model.percent(b))return d.commands.splice(a,1),void d.delayedReload(q)},t=function(){var a;c.unregister(c.types.RESIZE,o);for(a in l)l[a]();b.timer.remove(s)},u=function(){d.delayedReload(q)},v=function(a,b){var c=i.getCommandFromList(d.commands,b.id||b.command_id);c&&d.delayedReload(q)},w=function(a){e.emit(f.COMMAND_IGNORE,{command_id:a.command_id},v)},x=function(a,b){var c=i.getCommandFromList(d.commands,b.id);c&&d.delayedReload(q)},y=function(a,b){var c;for(c=0;c<d.commands.length;c++)d.commands[c].command_id===b.command_id&&d.commands.splice(c,1)},z=function(a,b){var c;for(c=0;c<d.commands.length;c++)d.commands[c].target_village_id===b.village_id&&(d.commands[c].target_village_name=b.name,d.commands[c].targetVillage.name=b.name)},A=function(e){return e!==d.TABS.INCOMING?void t():(k=!0,o(),c.register(c.types.RESIZE,o),b.timer.add(s),d.sorting=j.getItem("overviewIncomingSorting")||d.sorting,l[h.COMMAND_INCOMING]=a.$on(h.COMMAND_INCOMING,u),l[h.COMMAND_CANCELLED]=a.$on(h.COMMAND_CANCELLED,v),l[h.COMMAND_RETURNED]=a.$on(h.COMMAND_RETURNED,x),l[h.VILLAGE_NAME_CHANGED]=d.$on(h.VILLAGE_NAME_CHANGED,z),l[h.COMMAND_IGNORED]=a.$on(h.COMMAND_IGNORED,y),void(l.filters=d.$watch("filters",q,!0)))};d.commands=[],d.columns=n.DEFAULT.columns,d.SORT_BLACKLIST=m,d.pagination={count:0,limit:d.ITEMS_PER_PAGE,limits:[d.ITEMS_PER_PAGE],offset:0,loader:q},d.sorting={column:d.COLUMN_TYPES.TARGET_VILLAGE,reverse:!1},d.renameCommand=i.renameCommand,d.commandService=g,d.toggleSorting=r,d.ignoreCommand=w,d.$watch("activeTab",A),d.$on("$destroy",t)}])}),define("controllers/screen/overview/OverviewUnitsController",["app","angular","queues/EventQueue"],function(a,b,c){a.controller("OverviewUnitsController",["$rootScope","$scope","socketService","routeProvider","eventTypeProvider","windowManagerService","modelDataService","overviewService","storageService",function(a,d,e,f,g,h,i,j,k){var l,m=k.getItem("overviewUnitsPredefinedFilter"),n=i.getGameData(),o=n.getTypedUnitNames(),p=!1,q={},r=[d.COLUMN_TYPES.INFO],s={columns:[{name:d.COLUMN_TYPES.VILLAGE_NAME,priority:1},{name:d.COLUMN_TYPES.GROUPS,priority:2},{name:d.COLUMN_TYPES.STATUS,priority:1},{name:d.COLUMN_TYPES.UNITS,priority:1},{name:d.COLUMN_TYPES.INFO,priority:1}],priorityWidths:{2:1257}},t={ALL:b.copy(s),OFFENSIVE:b.copy(s),DEFENSIVE:b.copy(s)},u=function(a){var b,c,e,f,g=["own","all","out","way"];for(a.data={name:a.village_name,x:a.x,y:a.y,id:a.village_id},e=0;e<a.groups.length;e++)a.groups[e]=d.getGroup(a.groups[e]);for(e=0;e<d.ORDERED_UNIT_NAMES.length;e++)for(c=d.ORDERED_UNIT_NAMES[e],f=0;f<g.length;f++)b=g[f],a[b]||(a[b]={}),a[b][c]=a[b+"_"+c]},v=function(){d.updateColumnVisibility(d.columns,d.view.priorityWidths)},w=function(a){var b;for(d.villages=a.units,d.pagination.count=a.total,d.pagination.offset=a.offset,b=0;b<d.villages.length;b++)u(d.villages[b])},x=function(){var a;if(l&&(a=l.unitStatus,a&&!a.ALL)){if(a.OUT&&!a.OWN&&!a.WAY)return j.UNIT_STATUS.OUT+"_";if(!a.OUT&&a.OWN&&!a.WAY)return j.UNIT_STATUS.OWN+"_";if(!a.OUT&&!a.OWN&&a.WAY)return j.UNIT_STATUS.WAY+"_"}return j.UNIT_STATUS.ALL+"_"},y=function(){var a=x();e.emit(f.OVERVIEW_GET_UNITS,{count:d.pagination.limit,offset:d.pagination.offset,sorting:a+d.sorting.column,reverse:d.sorting.reverse?1:0,groups:d.params[d.FILTER_TYPES.GROUPS]||[]},w)},z=function(a){-1===r.indexOf(a)&&(d.sorting.column===a&&(d.sorting.reverse=!d.sorting.reverse),d.sorting.column=a,d.pagination.offset=0,k.setItem("overviewUnitsSorting",d.sorting),y())},A=function(){d.pendingUnitDetails&&(h.getFullSize("screen_unit_overview"),d.pendingUnitDetails=!1)},B=function(b){var c=i.getSelectedCharacter().getSelectedVillage().getId();d.pendingUnitDetails=!0,c!==b?a.$broadcast(g.MAP_SELECT_VILLAGE,b):A()},C=function(a){k.setItem("overviewUnitsPredefinedFilter",d.selectedAction),d.view=t[a.value],d.columns=d.view.columns,v(),d.pagination.offset=0},D=function(){var a;c.unregister(c.types.RESIZE,v);for(a in q)q[a]()},E=function(){d.delayedReload(y)},F=function(a,b){var c;for(c=0;c<d.villages.length;c++)d.villages[c].village_id===b.village_id&&(d.villages[c].village_name=b.name,d.villages[c].village.name=b.name)},G=function(a,b){l=b,y()},H=function(e){return e!==d.TABS.UNITS?void D():(p||(d.insertColumns("unit",t.ALL.columns),d.insertColumns("unit",t.OFFENSIVE.columns,o.offensive.concat("doppelsoldner")),d.insertColumns("unit",t.DEFENSIVE.columns,o.defensive.concat("trebuchet")),a.$on("DONE",A)),p=!0,d.$parent.$parent.viewList=d.getViewList(t),d.$parent.$parent.selectedAction=k.getItem("overviewUnitsPredefinedFilter")||b.copy(d.viewList[0]),d.sorting=k.getItem("overviewUnitsSorting")||d.sorting,v(),c.register(c.types.RESIZE,v),q.selectedAction=d.$watch("selectedAction",C,!0),q.handleFilterChange=d.$on(g.OVERVIEW_FILTERS_CHANGED,G),q[g.VILLAGE_LOST]=d.$on(g.VILLAGE_LOST,E),q[g.VILLAGE_UNIT_INFO]=d.$on(g.VILLAGE_UNIT_INFO,E),q[g.VILLAGE_NAME_CHANGED]=d.$on(g.VILLAGE_NAME_CHANGED,F),q[g.VILLAGE_OWNER_CHANGED]=d.$on(g.VILLAGE_OWNER_CHANGED,E),q[g.GROUPS_VILLAGES_CHANGED]=d.$on(g.GROUPS_VILLAGES_CHANGED,E),void y())};d.view=m?t[m.value]:t.ALL,d.columns=d.view.columns,d.SORT_BLACKLIST=r,d.pagination={count:0,limit:d.ITEMS_PER_PAGE,limits:[d.ITEMS_PER_PAGE],offset:0,loader:y},d.sorting={column:d.COLUMN_TYPES.VILLAGE_NAME,reverse:!1},d.toggleSorting=z,d.unitDetails=B,d.$watch("activeTab",H),d.$on("$destroy",D)}])}),define("controllers/screen/test/TestRichTextScreenController",["app"],function(a){a.controller("TestRichTextScreenController",["$rootScope","$scope","routeProvider","eventTypeProvider","socketService",function(a,b,c,d,e){var f,g=function(){e.emit(c.MESSAGE_REPLY,{message_id:f,message:b.richTextEditor.getBBCode(!0)})},h=function(a,c){b.messages=c.messages},i=function(){e.emit(c.MESSAGE_GET,{message_id:f,offset:0,count:10,reverse:!0})},j=function(a,b){f=b.messages[0].message_id,i()},k=function(){e.emit(c.MESSAGE_GET_LIST,{folder:"inbox",offset:0,count:25,search:""})},l=function(a,c){b.richTextEditor.quote(a,c)},m=function(b){a.$broadcast(d.MESSAGE_VIEW,{messages:[{author:"simulator",content:b}]})},n=function(){k()};b.richTextEditor={},b.simulateMessage=m,b.reply=g,b.addQuote=l,a.$on(d.MESSAGE_LIST,j),a.$on(d.MESSAGE_VIEW,h),n()}])}),define("controllers/tutorial/TutorialController",["app","helper/math","helper/time","helper/util","queues/EventQueue"],function(a,b,c,d,e){a.controller("TutorialController",["$rootScope","$scope","eventTypeProvider","templateManagerService","buildingTimerService","tutorialService","socketService","routeProvider","settingsService","trackingService",function(a,f,g,h,i,j,k,l,m,n){var o,p,q,r,s=$("#tutorial"),t=function(){var a=$("#map").offset(),b=714;r&&f.positionBubble&&(0!==a.left?r.css("left",b+"px"):r.css("left","0px"))},u=function(){f.selectedBuilding&&f.map.activeVillageController&&setTimeout(function(){f.map.activeVillageController.animateToBuilding(f.selectedBuilding,!0)},200)},v=function(){var a=$(".character")[0],b=1470,c=876;window.innerWidth<=b||window.innerHeight<=c?(a.style[Modernizr.prefixed("transform")]="scale(0.7)",$(".character").css({bottom:"-190px",right:"-138px"}),f.smallRes=!0):(a.style[Modernizr.prefixed("transform")]="scale(1)",$(".character").css({bottom:"0",right:"0"}),f.smallRes=!1)},w=function(){var a=j.getScope($("#interface-bottom"));a.$on(g.TIMELINE_NEW_EVENT,function(b,c){a.newEvent=""})},x=function(a,c){var d,e,g,h=f.map.engine.getView().z,i=10;q=$(f.mapDiv).find(".highlight-map"),r=$(s).find(".bubble"),(f.mapVisible||f.map.activeVillageController)&&f.pos&&(f.mapVisible&&(d=f.map.engine.graph.getScreenCoords(f.pos,c)),f.map.activeVillageController&&!f.mapVisible&&(d=f.map.engine.graph.getScreenCoords({matrix:[1,0,0,1].concat(b.vmultiply(f.map.activeVillageController.group.getTotalTransformation(),f.pos))},c)),e=f.highlightWidth*c.z,g=f.highlightHeight*c.z,q[0]&&(q[0].style.width=e+"px",q[0].style.height=g+"px"),h>=i?$(s).find(".bubble-dynamic").removeClass("highlight-margin-left"):$(s).find(".bubble-dynamic").addClass("highlight-margin-left"),q.translate(d.x-e/2,d.y-g/2),f.translateBubbleEnabled&&(f.positionBubbleToHighlight?r.translate(d.x+e/2,d.y):r.translate(d.x,d.y)))},y=function(a,b){f.step=a,b&&n.trackTutorialAction(a-1),d.checkFunc(function(){return p=$(".step-"+c.zerofill(f.step)).find(".bubble"),p.length>0},function(){setTimeout(function(){p.addClass("bubble-visible"),x(null,f.map.engine.getView())},40)})},z=function(b){var c;k.emit(l.TUTORIAL_START_TASK,{},function(){switch(f.jump[b]=!0,b){case 0:f.positionBubble=!1,y(0);break;case 1:y(1);break;case 2:y(3);break;case 3:a.$broadcast(g.VILLAGE_SELECT_BUILDING,"headquarter"),d.checkFunc(function(){return c=j.getScope($($(".building-headquarter")[0].firstChild))},function(){var a,b;for(b=0;b<c.sortedBuildings.length;b++)c.sortedBuildings[b].upgradeability="impossible",c.sortedBuildings[b].upgradeabilityPremium="impossible";for(a=["icon-26x26-info","icon-26x26-close"],b=0;b<a.length;b++)j.setElemsStyles(".building-headquarter",!1,a[b]);$(".building-headquarter").find(".jssb-y").addClass("inactive")}),f.positionBubble=!1,y(6);break;case 4:e.register(e.types.MAPVIEW_UPDATE,f.updatePos),d.checkFunc(function(){return f.map.activeVillageController?e.unregister(e.types.CLICK,f.map.activeVillageController.onClick)&&e.unregister(e.types.DOUBLECLICK,f.map.activeVillageController.onDoubleClick):!1},function(){y(11)});break;case 5:a.$broadcast(g.VILLAGE_SELECT_BUILDING,"barracks"),f.positionBubble=!1,y(13);break;case 6:e.register(e.types.MAPVIEW_UPDATE,f.updatePos),f.positionBubble=!1,y(21);break;case 7:e.unregister(e.types.MAPVIEW_UPDATE,x),f.positionBubble=!1,y(26)}})},A=function(a){h.compile("tutorial_highlight_map",f,function(b,g){var h,k,l;h=[{elem:$("#interface-bottom"),funcs:["open","zoomOutOfVillage","zoom","toggleTimeLine"]},{elem:$('div[ng-controller="TopInterfaceController"]'),
funcs:["switchVillage","editGroups","openCharacterProfile","openRankingScreen","showPremiumIframe","toggleUnitBar","openUnitBuilding","openVillageInfo","openResourceBuildingScreen"]},{funcs:["selectItem","addSlot","toggleQueue","cancelJob","instantBuild"]},{scope:f.map,funcs:["zoomOutOfTown"]},{scope:$($(".validate-mail")[0]),funcs:["openValidationModal"]}],d.checkFunc(function(){return $(".interface-building-queue")[0]&&j.getScope($(".interface-building-queue"))?!0:!1},function(){for(f.mapDiv=$("#map"),f.mapDiv.append(b),e.register(e.types.RESIZE,t),k=0;k<h.length;k++)for(g=h[k].scope?h[k].scope:j.getScope(h[k].elem?h[k].elem:$(".interface-building-queue")),l=0;l<h[k].funcs.length;l++)j.saveFunction(g,h[k].funcs[l]),j.overrideFunction(g,h[k].funcs[l],j.emptyFunction);j.setElemsStyles("#interface-bottom",!1),j.setElemsStyles("#interface-top",!1),j.setElemsStyles(".interface-building-queue",!1),j.setElemsStyles(".validate-mail",!1),$(".animation-60x60-shop ").addClass("icon-inactive"),$(".bubble").addClass("bubble-visible"),e.register(e.types.RESIZE,v),v(),e.register(e.types.RESIZE,u),w(),j.getScope($("#map")).tutorial=!0,m.settings.game.locator=!1,d.checkFunc(function(){return c.timer.remove(i.processBuildings)},function(){}),z(a)})})},B=function(){o||(o=!0,k.emit(l.TUTORIAL_GET_CURRENT_TASK,{},function(b){var c=b.task;f.selectedBuilding="headquarter",6!==c&&7!==c?(c>=2&&(f.selectedBuilding="barracks"),a.$broadcast(g.MAP_ZOOM_INTO_VILLAGE,null,function(){f.map.activeVillageController.animateToBuilding(f.selectedBuilding),j.setBuildingLabel(),f.initialized=!0,A(c)},!0)):(A(c),f.initialized=!0)}),a.$on(g.MESSAGE_ERROR,function(a,b){"Character is not in tutorial"===b.message&&window.location.reload()}))};f.step=null,f.steps=28,f.jump=[],f.highlightWidth=0,f.highlightHeight=0,f.pos=null,f.translateBubbleEnabled=!1,f.positionBubbleToHighlight=!1,f.positionBubble=!0,f.map=window.twx.game.map,f.mapDiv=null,f.selectedBuilding=null,f.nextStep=y,f.timeHelper=c,f.openSkipTutorialModal=j.openSkipTutorialModal,f.updatePos=x,f.scaleCharacter=v,f.repositionBubble=t,f.centerBuilding=u,f.settingsService=m,f.$on("DONE",function(){B()});try{B()}catch(C){}}])}),define("controllers/tutorial/Tutorial01Controller",["app","queues/EventQueue","helper/util"],function(a,b,c){a.controller("Tutorial01Controller",["$scope","tutorialService","buildingService",function(a,d,e){var f=a.$parent.$parent.$parent;f.jump[1]||d.completeTask(),d.setBuildingLabel("headquarter"),f.pos=e.getPosition("headquarter"),f.showMapHighlight=!0,f.translateBubbleEnabled=!0,f.positionBubbleToHighlight=!0,f.highlightWidth=20,f.highlightHeight=20,c.checkFunc(function(){return f.map.activeVillageController?b.unregister(b.types.CLICK,f.map.activeVillageController.onClick)&&b.unregister(b.types.DOUBLECLICK,f.map.activeVillageController.onDoubleClick):!1},function(){$(".highlight-map")[0].onclick=function(){f.nextStep(2,!0)}}),b.register(b.types.MAPVIEW_UPDATE,f.updatePos)}])}),define("controllers/tutorial/Tutorial02Controller",["app","helper/util"],function(a,b){a.controller("Tutorial02Controller",["$scope","tutorialService","contextMenuService",function(a,c,d){var e,f=a.$parent.$parent.$parent;d.showVillageMenu({name:"headquarter"},f.map.activeVillageController.group),f.map.activeVillageController.animateToBuilding("headquarter"),f.showMapHighlight=!1,b.checkFunc(function(){return $("#context-menu").length>0&&$(a.mapDiv).find(".open-screen").length>0},function(){var a,b=["buildinginfo","levelup","premuimlevelup"];for(e=c.getScope($("#context-menu")),a=0;a<b.length;a++)c.setElemsStyles("#context-menu",!1,b[a]);c.createSubMenuHighlight("open-screen"),c.saveFunction(e,"centerClick"),c.saveFunction(e,"openSubMenu"),c.overrideFunction(e,"openSubMenu",c.emptyFunction),c.overrideFunction(e,"centerClick",c.emptyFunction),$("#context-menu").css("zIndex","12"),$(".open-screen")[0].onclick=function(){c.completeTask(),$(".open-screen").find("highlicht-circle").remove(),f.translateBubbleEnabled=!1,e.centerClick=c.getFunction(e,"centerClick"),e.openSubMenu=c.getFunction(e,"openSubMenu"),e.destroy(),f.nextStep(3,!0)}})}])}),define("controllers/tutorial/Tutorial03Controller",["app","helper/util","helper/time","angular"],function(a,b,c,d){a.controller("Tutorial03Controller",["$rootScope","$scope","tutorialService","eventTypeProvider","buildingTimerService",function(a,c,e,f,g){var h,i=c.$parent.$parent.$parent;a.$broadcast(f.VILLAGE_SELECT_BUILDING,"headquarter"),i.positionBubble=!1,e.setBuildingLabel(),b.checkFunc(function(){var a=d.element($(".building-headquarter")[0].firstChild);return 0===a.length?!1:(h=a.scope(),h.directives.researches?!0:!1)},function(){var a,b=["icon-26x26-info","icon-26x26-close"];for(e.setElemsStyles(".building-headquarter",!1,"btn-research"),e.setElemsStyles(".building-headquarter",!1,"icon-20x20-premium"),$(".building-headquarter").find(".jssb-y").addClass("inactive"),a=0;a<h.sortedBuildings.length;a++)h.sortedBuildings[a].upgradeability="impossible",h.sortedBuildings[a].upgradeabilityPremium="impossible";for(a=0;a<b.length;a++)e.setElemsStyles(".building-headquarter",!1,b[a])})}])}),define("controllers/tutorial/Tutorial04Controller",["app","helper/util"],function(a,b){a.controller("Tutorial04Controller",["$rootScope","$scope","tutorialService","eventTypeProvider","trackingService",function(a,b,c,d,e){var f,g=b.$parent.$parent.$parent,h=c.getScope($($(".building-headquarter")[0].firstChild));for(f=0;f<h.sortedBuildings.length;f++)"headquarter"===h.sortedBuildings[f].name&&(h.sortedBuildings[f].upgradeability="possible");c.appendClickToHighlight(g.step,function(){e.trackTutorialAction(4),h.upgradeBuilding("headquarter",!1)}),a.$on(d.BUILDING_UPGRADING,function(a,b){if(4===g.step){for(f=0;f<h.sortedBuildings.length;f++)h.sortedBuildings[f].upgradeability="impossible";g.data=b,g.nextStep(5)}})}])}),define("controllers/tutorial/Tutorial05Controller",["app","helper/util"],function(a,b){a.controller("Tutorial05Controller",["$rootScope","$scope","tutorialService","eventTypeProvider","socketService","routeProvider","modelDataService","trackingService",function(a,c,d,e,f,g,h,i){var j=c.$parent.$parent.$parent;d.appendClickToHighlight(j.step,function(){i.trackTutorialAction(5),f.emit(g.PREMIUM_INSTANT_BUILD,{village_id:h.getSelectedVillage().getId(),job_id:j.data.job.id})}),b.checkFunc(function(){return $(".queue-item").length>0},function(){d.setElemsStyles(".queue-item",!1,"icon-34x34-premium"),d.setElemsStyles(".queue-item",!1,"icon-26x26-close")}),a.$on(e.BUILDING_LEVEL_CHANGED,function(){5===j.step&&(b.checkFunc(function(){var a=$($(".interface-building-queue").find(".slot-0"))[0];return a?(a=a.className.indexOf("btn-grey"),-1===a):!1},function(){d.setElemsStyles(".interface-building-queue",!1,"slot-icon"),d.setElemsStyles(".building-headquarter",!1,"btn-research"),d.setElemsStyles(".building-headquarter",!1,"icon-20x20-premium"),d.setBuildingLabel()}),d.completeTask(function(){j.nextStep(6)}))})}])}),define("controllers/tutorial/Tutorial07Controller",["app"],function(a){a.controller("Tutorial07Controller",["$rootScope","$scope","tutorialService","eventTypeProvider","buildingTimerService","trackingService",function(a,b,c,d,e,f){var g,h=b.$parent.$parent.$parent,i=c.getScope($($(".building-headquarter")[0].firstChild)),j=504;for(e.processBuildings(),c.setElemsStyles(".building-headquarter",!1,"btn-research"),c.setElemsStyles(".building-headquarter",!1,"icon-20x20-premium"),g=0;g<i.sortedBuildings.length;g++)i.sortedBuildings[g].upgradeability="impossible",i.sortedBuildings[g].upgradeabilityPremium="impossible","barracks"===i.sortedBuildings[g].name&&(i.sortedBuildings[g].upgradeability="possible");c.saveFunction(i.directives.scrollbar.scrollbar,"_scroll"),c.overrideFunction(i.directives.scrollbar.scrollbar,"_scroll",function(a,b){var d;i.directives.scrollbar.scrollbar.content.scrollTop+b<0||(d=$(".step-07").find(".highlight"),d.translate(0,-b),d=$(".step-07").find(".bubble"),d.translate(0,-b),c.getFunction(i.directives.scrollbar.scrollbar,"_scroll").call(i.directives.scrollbar.scrollbar,a,b),c.setElemsStyles(".building-headquarter",!1,"icon-26x26-info"),c.setElemsStyles(".building-headquarter",!1,"icon-20x20-premium"))}),i.directives.scrollbar.scrollbar.tweenTo(0,j),c.appendClickToHighlight(h.step,function(){f.trackTutorialAction(7),i.upgradeBuilding("barracks",!1)}),a.$on(d.BUILDING_UPGRADING,function(a,b){if(7===h.step){for(h.data=b,g=0;g<i.sortedBuildings.length;g++)i.sortedBuildings[g].upgradeability="impossible";h.nextStep(8)}})}])}),define("controllers/tutorial/Tutorial08Controller",["app","helper/util"],function(a,b){a.controller("Tutorial08Controller",["$rootScope","$scope","tutorialService","eventTypeProvider","socketService","routeProvider","modelDataService","trackingService",function(a,c,d,e,f,g,h,i){var j,k,l=c.$parent.$parent.$parent,m=d.getScope($($(".building-headquarter")[0].firstChild));d.appendClickToHighlight(l.step,function(){i.trackTutorialAction(8),f.emit(g.PREMIUM_INSTANT_BUILD,{village_id:h.getSelectedVillage().getId(),job_id:l.data.job.id})}),b.checkFunc(function(){return j=$(".step-08").find(".bubble"),k=$(".step-08").find(".highlight"),j.length&&k.length},function(){var a=$(".building-barracks").offset().top;j.css({top:a+"px"}),k.css({top:a+"px"})}),b.checkFunc(function(){return $(".queue-item").length>0},function(){d.setElemsStyles(".queue-item",!1,"icon-34x34-premium"),d.setElemsStyles(".queue-item",!1,"icon-26x26-close")}),a.$on(e.BUILDING_LEVEL_CHANGED,function(){var a;if(8===l.step){for(a=0;a<m.sortedBuildings.length;a++)"barracks"===m.sortedBuildings[a].name&&(m.sortedBuildings[a].upgradeability="impossible");b.checkFunc(function(){return(j=$($(".interface-building-queue").find(".slot-0"))[0])?(j=j.className.indexOf("btn-grey"),-1===j):!1},function(){d.setElemsStyles(".interface-building-queue",!1,"slot-icon"),d.setElemsStyles(".building-headquarter",!1,"btn-research"),d.setElemsStyles(".building-headquarter",!1,"icon-20x20-premium"),d.setBuildingLabel()}),l.nextStep(9)}})}])}),define("controllers/tutorial/Tutorial10Controller",["app","helper/util"],function(a,b){a.controller("Tutorial10Controller",["$rootScope","$scope","tutorialService",function(a,b,c){var d=b.$parent.$parent.$parent,e=c.getScope($($(".building-headquarter")[0].firstChild));c.setElemsStyles(".building-headquarter",!0,"icon-26x26-close"),c.appendClickToHighlight(d.step,function(){e.closeWindow(),c.completeTask(function(){d.nextStep(11,!0)})})}])}),define("controllers/tutorial/Tutorial11Controller",["app","helper/util"],function(a,b){a.controller("Tutorial11Controller",["$rootScope","$scope","tutorialService","buildingService",function(a,b,c,d){var e=b.$parent.$parent.$parent;e.selectedBuilding="barracks",e.map.activeVillageController.animateToBuilding("barracks"),$(".highlight").css({top:"-4px",left:"-12px"}),c.setBuildingLabel("barracks"),e.pos=d.getPosition("barracks"),e.showMapHighlight=!0,e.translateBubbleEnabled=!0,e.positionBubbleToHighlight=!0,e.highlightWidth=15,e.highlightHeight=15,$(".highlight-map")[0].onclick=function(){e.nextStep(12,!0)}}])}),define("controllers/tutorial/Tutorial12Controller",["app","helper/util"],function(a,b){a.controller("Tutorial12Controller",["$rootScope","$scope","tutorialService","contextMenuService","eventTypeProvider",function(a,c,d,e,f){var g,h,i=c.$parent.$parent.$parent;e.showVillageMenu({name:"barracks"},i.map.activeVillageController.group),i.showMapHighlight=!1,b.checkFunc(function(){return $("#context-menu").length>0&&$(c.mapDiv).find(".open-screen").length>0},function(){var b,c=["buildinginfo","levelup","premuimlevelup"];for(g=d.getScope($("#context-menu")),b=0;b<c.length;b++)d.setElemsStyles("#context-menu",!1,c[b]);d.createSubMenuHighlight("open-screen"),d.saveFunction(g,"centerClick"),d.saveFunction(g,"openSubMenu"),d.overrideFunction(g,"openSubMenu",d.emptyFunction),d.overrideFunction(g,"centerClick",d.emptyFunction),h=i.map.engine.getView(),i.map.animateTo({x:h.x-2100,y:h.y,z:h.z+2},600,"easeInOut"),$("#context-menu").css("zIndex","12"),$(".open-screen")[0].onclick=function(){for(d.completeTask(),a.$broadcast(f.VILLAGE_SELECT_BUILDING,"barracks"),$(".open-screen").find("highlicht-circle").remove(),i.translateBubbleEnabled=!1,b=0;b<c.length;b++)d.setElemsStyles("#context-menu",!0,c[b]);g.centerClick=d.getFunction(g,"centerClick"),g.openSubMenu=d.getFunction(g,"openSubMenu"),g.destroy(),i.nextStep(13,!0)}})}])}),define("controllers/tutorial/Tutorial13Controller",["app","helper/util","angular"],function(a,b,c){a.controller("Tutorial13Controller",["$rootScope","$scope","tutorialService",function(a,d,e){{var f;d.$parent.$parent.$parent}b.checkFunc(function(){var a;return $(".building-barracks")[0]?(a=c.element($(".building-barracks")[0].firstChild),0===a.length?!1:(f=a.scope(),f.directives&&f.directives.researches?!0:!1)):!1},function(){var a,b=["icon-26x26-info","icon-26x26-close","btn-enter-value","btn-research","icon-20x20-premium"];for($(".building-barracks").find(".jssb-y").addClass("inactive"),e.setBuildingLabel(),a=0;a<b.length;a++)e.setElemsStyles(".building-barracks",!1,b[a])})}])}),define("controllers/tutorial/Tutorial14Controller",["app","helper/util","angular"],function(a,b,c){a.controller("Tutorial14Controller",["$rootScope","$scope","tutorialService",function(a,b,d){var e=b.$parent.$parent.$parent,f=c.element($(".building-barracks")[0].firstChild).scope();d.setElemsStyles(".building-barracks",!0,"btn-enter-value"),d.appendClickToHighlight(e.step,function(){f.selectUnitByClick({preventDefault:d.emptyFunction},"spear","defensive"),e.nextStep(15,!0)})}])}),define("controllers/tutorial/Tutorial15Controller",["app","helper/util","angular"],function(a,b,c){a.controller("Tutorial15Controller",["$rootScope","$scope","tutorialService",function(a,d,e){var f=d.$parent.$parent.$parent,g=c.element($(".building-barracks")[0].firstChild).scope();b.checkFunc(function(){return $(".btn-slider").length},function(){setTimeout(function(){e.setElemsStyles(".range-track",!1,"btn-slider")},20)}),e.appendClickToHighlight(f.step,function(){g.directives.rangeSlider.defensive.setPreciseValue(g.directives.rangeSlider.defensive.max),f.nextStep(16,!0)})}])}),define("controllers/tutorial/Tutorial16Controller",["app","helper/util","angular"],function(a,b,c){a.controller("Tutorial16Controller",["$rootScope","$scope","tutorialService",function(a,d,e){var f,g=d.$parent.$parent.$parent,h=c.element($(".building-barracks")[0].firstChild).scope();b.checkFunc(function(){return $(".range-value-min").length},function(){setTimeout(function(){e.setElemsStyles(".building-barracks",!1,"range-value-min"),e.setElemsStyles(".building-barracks",!1,"btn-cancel")},20)}),b.checkFunc(function(){return f=$(".step-16").find(".highlight"),0!==f.length},function(){var a=$(".btn-start-recruit").offset(),b=12;f.css({top:a.top+"px",left:a.left+"px",width:a.width+b+"px"})}),e.appendClickToHighlight(g.step,function(){h.recruitUnits(),g.nextStep(17,!0)})}])}),define("controllers/tutorial/Tutorial17Controller",["app","helper/util","angular"],function(a,b,c){a.controller("Tutorial17Controller",["$rootScope","$scope","tutorialService",function(a,d,e){var f=d.$parent.$parent.$parent,g=c.element($(".building-barracks")[0].firstChild).scope();e.setElemsStyles(".building-barracks",!1,"btn-start-recruit"),b.checkFunc(function(){return $(".queue-item").find(".icon-26x26-close").length>0},function(){e.setElemsStyles(".queue-item",!1,"icon-26x26-close")}),e.setElemsStyles(".building-barracks",!0,"icon-26x26-close"),e.appendClickToHighlight(f.step,function(){g.closeWindow(),e.setBuildingLabel(),f.nextStep(18,!0)})}])}),define("controllers/tutorial/Tutorial19Controller",["app","helper/util"],function(a,b){a.controller("Tutorial19Controller",["$rootScope","$scope","tutorialService",function(a,b,c){var d=(b.$parent.$parent.$parent,c.getScope($($("#interface-top")[0].firstChild)));0===$("#topinterface-right-wrapper").cls("expanded").length&&d.toggleUnitBar()}])}),define("controllers/tutorial/Tutorial20Controller",["app","helper/util","queues/EventQueue","struct/MapData"],function(a,b,c,d){a.controller("Tutorial20Controller",["$rootScope","$scope","tutorialService","eventTypeProvider","modelDataService",function(a,e,f,g,h){var i,j=e.$parent.$parent.$parent,k=(f.getScope($("#interface-bottom")),function(){var a=$(".icon-44x44-view-map").offset();i=$(".step-20").find(".highlight"),i.css({top:a.bottom+"px",left:a.left+"px"}),i=$(".step-20").find(".bubble"),i.css({top:a.bottom+"px",left:a.left+"px"})});j.positionBubble=!1,b.checkFunc(function(){return i=$(".step-20").find(".highlight"),0!==i.length},function(){c.register(c.types.RESIZE,k),k(),f.setElemsStyles("#interface-bottom",!0,"icon-44x44-view-map")}),f.appendClickToHighlight(j.step,function(){{var b=h.getSelectedVillage();b.getX(),b.getY()}j.step>=21||(j.step=21,f.completeTask(function(){}),j.$on(g.MAP_TUTORIAL_VILLAGE_SET,function(b,e){d.setTownCoords(h.getSelectedVillage().getId(),e.x,e.y),h.getSelectedVillage().setPosition(e.x,e.y),h.getSelectedVillage().setId(e.village_id),j.map.zoomOutOfTown=f.getFunction(j.map,"zoomOutOfTown"),a.$broadcast(g.MAP_JUMP_TO,e.x,e.y,function(){a.$broadcast(g.MAP_ZOOM_OUT_OF_VILLAGE,function(){c.unregister(c.types.RESIZE,k),j.nextStep(21,!0),j.map.forceRedraw()},!0)},!0)}))})}])}),define("controllers/tutorial/Tutorial22Controller",["app","helper/util","conf/conf","generators/generate"],function(a,b,c,d){a.controller("Tutorial22Controller",["$rootScope","$scope","tutorialService","socketService","routeProvider","contextMenuService","modelDataService","mapService",function(a,e,f,g,h,i,j,k){var l=e.$parent.$parent.$parent;$(".highlight").css({transform:"none",left:"0px",top:"-10px"}),l.highlightWidth=180,l.highlightHeight=134,e.mapVisible=!0,b.checkFunc(function(){return null===j.getSelectedVillage().getX()?!1:!0},function(){g.emit(h.TUTORIAL_GET_VILLAGE_TO_ATTACK,{x:j.getSelectedVillage().getX(),y:j.getSelectedVillage().getY()},function(a){l.map.jumpTo(a.x+1,a.y,function(){l.showMapHighlight=!0,l.mapVisible=!0,l.pos=k.tileCoordinate2Pixel(a.x,a.y),l.pos={x:l.pos[0]+(c.TILESIZE.x>>1),y:l.pos[1]+(c.TILESIZE.y>>1)},l.pos=l.map.engine.graph.findTilesAt(l.pos)[0],$(".highlight-map")[0].onclick=function(){i.showMapMenu(window.twx.game.map.engine.graph.findByName(d.villageName(a.id))),l.showMapHighlight=!1,l.nextStep(23,!0)}})})})}])}),define("controllers/tutorial/Tutorial23Controller",["app","helper/util"],function(a,b){a.controller("Tutorial23Controller",["$rootScope","$scope","tutorialService","contextMenuService",function(a,c,d,e){var f,g=c.$parent.$parent.$parent;b.checkFunc(function(){return 0!==$(".custom-army").length},function(){var a,b=["presets","groups","info","boost"],c=["centerClick","openSubMenu"],h=$("#context-menu");for(f=d.getScope($("#context-menu")),d.createSubMenuHighlight("custom-army"),a=0;a<b.length;a++)d.setElemsStyles("#context-menu",!1,b[a]);for(a=0;a<c.length;a++)d.saveFunction(f,c[a]),d.overrideFunction(f,c[a],d.emptyFunction);h.css("zIndex","12"),$(".custom-army")[0].onclick=function(){for(h.css("zIndex","3"),d.getFunction(f,"openSubMenu")("custom-army"),a=0;a<c.length;a++)f[c[a]]=d.getFunction(f,c[a]);for(a=0;a<b.length;a++)d.setElemsStyles("#context-menu",!0,b[a]);$(".highlight-circle").remove(),e.destroy(),g.nextStep(24,!0)}})}])}),define("controllers/tutorial/Tutorial24Controller",["app","helper/util","queues/EventQueue"],function(a,b,c){a.controller("Tutorial24Controller",["$rootScope","$scope","tutorialService",function(a,d,e){var f,g,h,i=d.$parent.$parent.$parent,j=function(){g=$(".range-value-max").offset(),h=$(".step-24").find(".highlight"),h.css({top:g.top+"px",left:g.left+"px"}),h=$(".step-24").find(".bubble"),h.css({top:g.top-h.offset().height+"px",left:g.left+"px"})};b.checkFunc(function(){return h=$(".step-24").find(".highlight"),g=$(".range-value-max").offset(),0!==h.length&&g},function(){f=e.getScope($(".modal-custom-army").find(".win-content")),e.saveFunction(f,"closeWindow"),f.closeWindow=function(){},e.setElemsStyles(".modal-custom-army",!1,"range-thumb"),e.setElemsStyles(".modal-custom-army",!1,"icon-26x26-close"),e.appendClickToHighlight(i.step,function(){f.directives.rangeSlider.spear.setPreciseValue(f.directives.rangeSlider.spear.max),setTimeout(function(){e.setElemsStyles(".modal-custom-army",!1,"btn-save"),e.setElemsStyles(".modal-custom-army",!1,"btn-support")},1),c.unregister(c.types.RESIZE,j),i.nextStep(25,!0)}),c.register(c.types.RESIZE,j),j(),h=document.createElement("div"),h.className="blocker blocker-tutorial24-top",$(".box-paper").append(h),h=document.createElement("div"),h.className="blocker blocker-tutorial24-bottom",$(".box-paper").append(h)})}])}),define("controllers/tutorial/Tutorial25Controller",["app","helper/util","queues/EventQueue"],function(a,b,c){a.controller("Tutorial25Controller",["$rootScope","$scope","tutorialService",function(a,d,e){var f,g,h=d.$parent.$parent.$parent,i=e.getScope($(".modal-custom-army").find(".win-content")),j=function(){f=$(".send-attack").offset(),g=$(".step-25").find(".highlight"),g.css({top:f.top+"px",left:f.left+"px"}),g=$(".step-25").find(".bubble"),g.css({top:f.top+"px",left:f.left+"px"})};e.appendClickToHighlight(h.step,function(){i.sendArmy("attack"),e.getFunction(i,"closeWindow")(),c.unregister(c.types.RESIZE,j),e.completeTask(),h.nextStep(26,!0)}),b.checkFunc(function(){return g=$(".step-25").find(".highlight"),f=$(".send-attack"),0!==g.length&&0!==f.length},function(){c.register(c.types.RESIZE,j),j()})}])}),define("controllers/tutorial/Tutorial27Controller",["app","helper/util","queues/EventQueue","helper/time","struct/MapData"],function(a,b,c,d,e){a.controller("Tutorial27Controller",["$rootScope","$scope","tutorialService","buildingTimerService","modelDataService","eventTypeProvider","routeProvider","socketService","contextMenuService","trackingService","hotkeyManagerService","templateManagerService",function(a,f,g,h,i,j,k,l,m,n,o,p){var q,r=f.$parent.$parent.$parent,s=function(b){var f=g.getSaved();n.trackTutorialAction(27),g.completeTask(function(){var m;$("#tutorial").remove();for(m in f.styles)("#interface-bottom"===m||"#context-menu"===m)&&(f.styles[m]=!0),g.setElemsStyles(m,f.styles[m]);for($(".icon-44x44-view-worldmap").addClass("btn-orange"),$(".animation-60x60-shop ").removeClass("context-icon-inactive"),m=0;m<f.functions.length;m++)f.functions[m].parent[f.functions[m].funcName]=f.functions[m].func;g.getScope($("#map")).tutorial=!1,c.unregister(c.types.RESIZE,r.scaleCharacter),c.unregister(c.types.MAPVIEW_UPDATE,r.updatePos),c.unregister(c.types.RESIZE,r.repositionBubble),c.unregister(c.types.RESIZE,r.centerBuilding),d.timer.add(h.processBuildings),e.getTownAtAsync(i.getSelectedVillage().getX(),i.getSelectedVillage().getY(),function(b){a.$broadcast(j.MAP_SELECTED_VILLAGE,i.getSelectedVillage().getId()),i.getSelectedCharacter().setTutorialStatus(2),a.$broadcast(j.TUTORIAL_COMPLETED),l.emit(k.TIMELINE_GET_EVENTS,{village_id:i.getSelectedVillage().getId()})}),p.compile("interface.hotkeys",null,function(a){$("#interface-mail").append(a)}),o.init(),b&&b()},!0)};b.checkFunc(function(){return q=g.getScope($(".quest-queue"))},function(){g.appendClickToHighlight(r.step,function(){s(function(){q.openQuestLineModal(q.questLineModels[0])})})}),f.finishTutorial=s}])}),define("controllers/controllers",["conf/conf","controllers/AppController","controllers/TrackingSnippetController","controllers/NotificationController","controllers/MapController","controllers/TimelineController","controllers/CharacterSelectionController","controllers/CharacterManagementController","controllers/ContextMenuController","controllers/BuildingLabelController","controllers/BuildingNotResearchedController","controllers/MaintenanceController","controllers/interface/TopInterfaceController","controllers/interface/BottomInterfaceController","controllers/interface/BuildingQueueInterfaceController","controllers/interface/RecruitmentQueueInterfaceController","controllers/interface/GlobalInformationController","controllers/interface/QuestsInterfaceController","controllers/interface/MediaPartnerController","controllers/interface/ValidateMailController","controllers/interface/ChatInterfaceController","controllers/interface/IconAnimationsInterfaceController","controllers/interface/MovementMenuInterfaceController","controllers/interface/VillageDropDownController","controllers/interface/UnitBarController","controllers/interface/QueueController","controllers/building/BuildingHeadquarterController","controllers/building/BuildingGodsHouseController","controllers/building/BuildingWallController","controllers/building/BuildingAcademyController","controllers/building/BuildingFortressController","controllers/building/BuildingPreceptoryController","controllers/building/BuildingPreceptorySelectOrderController","controllers/building/BuildingPreceptoryRecruitOrderController","controllers/building/BuildingPreceptoryThievesOrderController","controllers/building/BuildingFarmController","controllers/building/BuildingWarehouseController","controllers/building/BuildingBarracksController","controllers/building/BuildingRallyPointController","controllers/building/BuildingMarketController","controllers/building/BuildingTavernController","controllers/building/BuildingStatueController","controllers/building/BuildingHospitalController","controllers/building/BuildingResourcesController","controllers/modal/ModalBuildingUpgradeController","controllers/modal/ModalQuestLineController","controllers/modal/ModalBuildingResearchController","controllers/modal/ModalPresetListController","controllers/modal/ModalSelectUnitsController","controllers/modal/ModalUnitInfoController","controllers/modal/ModalOfficerInfoController","controllers/modal/ModalBuildingInfoController","controllers/modal/ModalCustomArmyController","controllers/modal/ModalPremiumController","controllers/modal/ModalSelectOrderController","controllers/modal/ModalOrderInfoController","controllers/modal/ModalSendSpiesController","controllers/modal/ModalSendResourcesController","controllers/modal/ModalFoundTribeController","controllers/modal/ModalAddContactsToConversationController","controllers/modal/ModalFriendListController","controllers/modal/ModalIconGeneratorController","controllers/modal/ModalUseItemController","controllers/modal/ModalPaymentController","controllers/modal/ModalPresetEditController","controllers/modal/ModalPresetContentController","controllers/modal/ModalSendPresetController","controllers/modal/ModalGroupController","controllers/modal/ModalEstablishVillageController","controllers/modal/ModalGameOverController","controllers/modal/ModalSocketController","controllers/modal/ModalBarbarianBoostController","controllers/modal/ModalDailyLoginBonusController","controllers/modal/ModalShowHotkeyController","controllers/modal/ModalInviteFriendController","controllers/modal/ModalDonateResourcesController","controllers/modal/ModalDonationRankingController","controllers/modal/ModalImproveSkillController","controllers/modal/ModalMassDonationController","controllers/modal/ModalInterstitialController","controllers/modal/ModalAddCoopPartnerController","controllers/modal/ModalTribeSettingsController","controllers/modal/ModalSelectAchievementsController","controllers/modal/ModalSelectAchievementsController","controllers/modal/ModalTribeRelationController","controllers/screen/ReportBattleSupportController","controllers/screen/ReportTradeAcceptedController","controllers/screen/ReportSupportController","controllers/screen/reports/tribe/InvitationController","controllers/screen/reports/tribe/ApplicationController","controllers/screen/ReportPaladinController","controllers/screen/ReportListController","controllers/screen/ReportAchievementController","controllers/screen/ReportController","controllers/screen/BattleReportController","controllers/screen/SpyReportController","controllers/screen/BattlePreventedReportController","controllers/screen/UnitListController","controllers/screen/MessageScreenController","controllers/screen/MessageListController","controllers/screen/MessageViewController","controllers/screen/VillageInfoController","controllers/screen/TribeController","controllers/screen/TribeProfileController","controllers/screen/TribeNewsController","controllers/screen/TribeDiplomacyController","controllers/screen/TribeMemberListController","controllers/screen/TribeSkillController","controllers/screen/NoTribeController","controllers/screen/ShopController","controllers/screen/InventoryController","controllers/screen/RankingController","controllers/screen/CharacterProfileController","controllers/screen/SettingsScreenController","controllers/screen/CharacterProfileController","controllers/screen/AchievementScreenController","controllers/screen/ProvinceController","controllers/screen/TribeForumController","controllers/screen/ResourceDepositScreenController","controllers/screen/SecondVillageScreenController","controllers/screen/DevToolsScreenController","controllers/screen/overview/OverviewController","controllers/screen/overview/OverviewCommandsController","controllers/screen/overview/OverviewVillagesController","controllers/screen/overview/OverviewIncomingController","controllers/screen/overview/OverviewUnitsController","controllers/screen/test/TestRichTextScreenController","controllers/tutorial/TutorialController","controllers/tutorial/Tutorial01Controller","controllers/tutorial/Tutorial02Controller","controllers/tutorial/Tutorial03Controller","controllers/tutorial/Tutorial04Controller","controllers/tutorial/Tutorial05Controller","controllers/tutorial/Tutorial07Controller","controllers/tutorial/Tutorial08Controller","controllers/tutorial/Tutorial10Controller","controllers/tutorial/Tutorial11Controller","controllers/tutorial/Tutorial12Controller","controllers/tutorial/Tutorial13Controller","controllers/tutorial/Tutorial14Controller","controllers/tutorial/Tutorial15Controller","controllers/tutorial/Tutorial16Controller","controllers/tutorial/Tutorial17Controller","controllers/tutorial/Tutorial19Controller","controllers/tutorial/Tutorial20Controller","controllers/tutorial/Tutorial22Controller","controllers/tutorial/Tutorial23Controller","controllers/tutorial/Tutorial24Controller","controllers/tutorial/Tutorial25Controller","controllers/tutorial/Tutorial27Controller"],function(a){a.DEBUG}),define("filters/BuildingResearchesOrderFilter",["app"],function(a){a.filter("buildingResearchesOrder",function(){return function(a){var b,c,d=[];for(c in a.researches)b=a.researches[c],b.name=c,d.push(b);return d.sort(function(a,b){return a.required_level<b.required_level?-1:1}),d}})}),define("filters/VersionFilter",["app"],function(a){a.filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}])}),define("filters/I18NFilter",["app","helper/i18n"],function(a,b){a.filter("i18n",[function(){var a=function(a,c,d){var e=Array.prototype.slice.call(arguments);return e.remove(0),e.remove(1),d?(e[0]=[].concat(d),e[0].push(a)):e[0]=[a],b.s.apply(null,e)};return a}])}),define("filters/ExcludeKeyFilter",["app"],function(a){a.filter("excludeKeyFilter",function(){return function(a,b){var c,d=[];for(c in a)c!==b&&d.push(c);return d}})}),define("filters/ReadableSecondsFilter",["app","helper/time"],function(a,b){a.filter("readableSecondsFilter",["$rootScope","$filter",function(a,c){return function(d,e,f){var g;return d?(g=b.readableSeconds(d,e,f),g.key?c("i18n")(g.key,a.loc.ale,g.textObject,g.value):g):"00:00:00"}}])}),define("filters/ReadableMillisecondsFilter",["app","helper/time"],function(a,b){a.filter("readableMillisecondsFilter",["$rootScope","$filter",function(a,c){return function(d,e,f,g){var h;return d?(h=b.readableMilliseconds(d,e,f,g),h.key?c("i18n")(h.key,a.loc.ale,h.textObject,h.value):h):"00:00:00"}}])}),define("filters/ReadableDateFilter",["app","helper/time"],function(a,b){a.filter("readableDateFilter",["$rootScope","$locale","$filter","dateFilter",function(a,c,d,e){
var f=function(c,f,g){var h,i,j,k,l,m;return g=g||"medium",c&&(l=new Date,l.setHours(0),l.setMinutes(0),l.setSeconds(0),k=l.getTime(),h=k-b.inMS.day,i=k+b.inMS.day,j=i+b.inMS.day,c.between(h,k)?m=d("i18n")("yesterday",a.loc.ale,"date_format",e(c,"mediumTime")):c.between(k,i)?m=d("i18n")("today",a.loc.ale,"date_format",e(c,"mediumTime")):c.between(i,j)&&(m=d("i18n")("tomorrow",a.loc.ale,"date_format",e(c,"mediumTime")))),m||e(c,g)};return f}])}),define("filters/AvailableBuildingsFilter",["app"],function(a){a.filter("availableBuildings",["buildingService",function(a){return function(b){var c,d,e,f,g=a.getResearchedBuildings();if(b instanceof Array){for(e=b.length,c=[],f=0;e>f;f++)(b[f].level>0||-1!==g.indexOf(b[f].name))&&c.push(b[f]);return c}c={};for(d in b)(b[d].level>0||-1!==g.indexOf(d))&&(c[d]=b[d]);return c}}])}),define("filters/ReportListFilter",["app"],function(a){a.filter("reportListFilter",[function(){return function(a,b,c){var d,e,f,g,h,i=!0,j=[];for(e=0;e<b.length;e++){f=b[e],i=!0;for(g in c)if(c.hasOwnProperty(g))switch(h=c[g],g){case"BATTLE_RESULTS":for(d in h)h.hasOwnProperty(d)&&f.result===parseInt(d,10)&&h[d]===!0&&(i=!1);h[1]===!0&&h[2]===!0&&h[3]===!0&&(i=!0);break;case"BATTLE_TYPES":for(d in h)h.hasOwnProperty(d)&&f.type===d&&h[d]===!1&&(i=!1);break;case"OTHERS_TYPES":for(d in h)h.hasOwnProperty(d)&&f.type===d&&h[d]===!1&&(i=!1);break;case"MISC":0===f.favourite&&c.MISC.favourite===!0&&(i=!1),"others"!==a&&0===f.haul&&c.MISC.haul===!0&&(i=!1),0===f.forwarded&&c.MISC.forwarded===!0&&(i=!1)}i===!0&&j.push(f)}return j}}])}),define("filters/RangeFilter",["app"],function(a){a.filter("range",function(){return function(a,b){var c;for(b=parseInt(b,10),c=0;b>c;c++)a.push(c);return a}})}),define("filters/ZeroToHyphenFilter",["app"],function(a){a.filter("zeroToHyphenFilter",function(){return function(a){return 0===a||"0"===a?"-":a}})}),define("filters/ReverseFilter",["app"],function(a){a.filter("reverse",function(){return function(a){return a.slice().reverse()}})}),define("filters/RoundFloating",["app"],function(a){a.filter("roundFloating",function(){return function(a){return Math.round(a)||0}})}),define("filters/EllipsisFilter",["app"],function(a){a.filter("characters",function(){return function(a,b,c,d){if(c)return a;if(isNaN(b))return a;if(0>=b)return"";if(a&&a.length>=b){if(a=a.substring(0,b),d)for(;" "===a.charAt(a.length-1);)a=a.substr(0,a.length-1);else{var e=a.lastIndexOf(" ");-1!==e&&(a=a.substr(0,e))}return a+" ..."}return a}}),a.filter("words",function(){return function(a,b,c){if(c)return a;if(isNaN(b))return a;if(0>=b)return"";if(a){var d=a.split(/\s+/);d.length>b&&(a=d.slice(0,b).join(" ")+" ...")}return a}})}),define("filters/PaginationFilter",["app"],function(a){a.filter("paginationFilter",["orderTypeProvider",function(a){return function(b,c,d){var e,f=[];for(c.count=b.length,e=0;e<b.length;e++)f.push(b[e]);return f.sortByProperty(d.field,d.direction===a.DESC),f.slice(c.offset,c.offset+c.limit)}}])}),define("filters/UniqueFilter",["app","angular"],function(a,b){a.filter("unique",function(){return function(a,c){var d=[],e=[];return b.forEach(a,function(a){var b=a[c];-1===e.indexOf(b)&&(e.push(b),d.push(a))}),d}})}),define("filters/ReadablePercentFilter",["app"],function(a){a.filter("readablePercentFilter",[function(){var a=function(a){return Math.round(100*(a-1))};return a}])}),define("filters/filters",["conf/conf","filters/BuildingResearchesOrderFilter","filters/VersionFilter","filters/I18NFilter","filters/ExcludeKeyFilter","filters/ReadableSecondsFilter","filters/ReadableMillisecondsFilter","filters/ReadableDateFilter","filters/AvailableBuildingsFilter","filters/ReportListFilter","filters/RangeFilter","filters/ZeroToHyphenFilter","filters/ReverseFilter","filters/RoundFloating","filters/EllipsisFilter","filters/PaginationFilter","filters/UniqueFilter","filters/ReadablePercentFilter"],function(a){a.DEBUG}),define("directives/ngVisibleDirective",["app"],function(a){a.directive("ngVisible",function(){return function(a,b,c){a.$watch(c.ngVisible,function(a){b.css("visibility",a?"visible":"hidden")})}})}),define("directives/ngTranslateDirective",["app","battlecat"],function(a,b){a.directive("ngTranslate",function(){return function(a,c,d){a.$watch(d.ngTranslate,function(a){a&&b(c).translate(a.x,a.y)},!0)}})}),define("directives/ngEmbeddedIncludeDirective",["app"],function(a){a.directive("ngEmbeddedInclude",function(){return{scope:!0,priority:9999}})}),define("directives/ngRepeatFinishedDirective",["app"],function(a){a.directive("ngRepeatFinished",function(){return function(a,b,c){a.$last&&c.ngRepeatFinished&&window.setTimeout(a[c.ngRepeatFinished],0)}})}),define("directives/RangeSliderDirective",["app","battlecat","conf/conf"],function(a,b,c){a.directive("rangeSlider",["$rootScope",function(a){var d=0;return{templateUrl:c.DIRECTIVE_TEMPLATE_PATH_EXT.join("range_slider"),scope:{min:"=",max:"=",snap:"=?",enabled:"=",value:"=",showMaxButton:"=",simple:"=",inlineText:"@",inputField:"@",inputFieldWrapper:"&",inputFieldBlur:"&",inputFieldFocus:"&"},link:function(c,e,f){var g,h=500,i=b(e[0]),j=i.find(".range-thumb"),k=i.find(".range"),l=c.inputFieldWrapper()||null,m=c.inputFieldBlur()||null,n=i.find(".range-input-field")[0],o=!1,p=!1,q=f.rangeSliderName||"rangeSlider",r=!1,s=function(){a.$$phase||a.$digest()},t=function(){return c.max-c.min},u=function(a){var b=k[0].getBoundingClientRect();return a.clientX-b.left},v=function(){l instanceof Function?c.displayValue=l(c.value):p===!0&&0===c.value?c.displayValue="":c.displayValue=c.value},w=function(a){return t()?(a=Math.max(0,a-c.min),(a||0)/t()):0},x=function(a){return a?a/k.width():0},y=function(a){return c.enabled?(o===!1&&r===!0&&(j.addClass("transition"),o=!0),""===a&&(a=0),a=a.bound(c.min,c.max),j.css("left",100*w(a)+"%"),c.value=isNaN(a)?0:a,v(),void s()):void v()},z=function(a){var b;a=parseInt(a,10)||0,c.snap=c.snap||1,y(a),g&&window.clearTimeout(g),g=window.setTimeout(function(){b=1/c.snap,a=Math.round(a*b)/b,y(a)},h)},A=function(a){var b=u(a),d=x(b)*t()+c.min;return a.target!==j[0]&&a.srcElement!==j[0]&&c.enabled?(z(d),!0):!1},B=function(a){var b=u(a),d=x(b)*t()+c.min;return z(d),j.removeClass("transition"),!0},C=function(a){c.enabled&&(b(document).off("mousemove",B),j.addClass("transition"),o=!0)},D=function(a){return c.enabled&&(b(document).on("mousemove",B).off("mouseup",C).on("mouseup",C),j.removeClass("transition"),o=!1,a.preventDefault()),!1},E=function(){p=!0,c.inputFieldFocus instanceof Function&&(v(),c.inputFieldFocus())},F=function(){var a=c.displayValue;c.blurFn instanceof Function&&(a=c.blurFn(a)),c.inputFieldBlur instanceof Function&&c.inputFieldBlur(),z(a||c.min)},G=function(){p=!1,F()},H=function(a){13===a.which?window.setTimeout(function(){n.blur()},0):F()},I=function J(a){if(a){if(!a.directives)return a=a.$parent,void J(a);a.directives=a.directives||{},a.directives.rangeSlider=a.directives.rangeSlider||{},a.directives.rangeSlider[q]=c}};j.on("mousedown",D),I(c),d++,c.setPreciseValue=y,c.handleClick=A,c.blurFn=m,c.tabIndex=d,c.handle=j,c.handleMouseDown=D,c.onFocus=E,c.onBlur=G,c.onKeyup=H,c.$watch("value",function(a){""!==a&&z(a),r||setTimeout(function(){r=!0},200)}),c.$watch("max",function(){p||(c.max=~~(c.max/c.snap)*c.snap,y(c.value))})}}}])}),define("directives/SwitchSliderDirective",["app","battlecat","conf/conf"],function(a,b,c){a.directive("switchSlider",["$rootScope",function(a){return{templateUrl:c.DIRECTIVE_TEMPLATE_PATH_EXT.join("switch_slider"),scope:{enabled:"=",vertical:"=",size:"=",onChange:"&",value:"=",reset:"=",icon:"=",border:"=",premium:"="},link:function(c,d){var e,f=b(d[0]),g=f.find(".switch-thumb"),h=f.find(".switch"),i=c.vertical?"top":"left",j=0,k=0,l=0,m=0,n=0,o=function(){a.$$phase||a.$digest()},p=function(){var a=c.vertical?c.value?-1:n:c.value?n:-1;g.css(i,a+"px")},q=function(a){c.value=a,p(),o(),c.onChange({mouseEvent:!0})},r=function(){c.enabled&&q(!c.value)},s=function(a){var b=c.vertical?a.clientY:a.clientX;b-=l,m=b.bound(-1,j-1),g.css(i,m+"px")},t=function x(){if(c.enabled){var a,d,f=Date.now()-160>e;f?(a=j/2>m,d=c.vertical&&a||!c.vertical&&!a,q(d)):r(),b(document).off("mousemove",s),b(document).off("mouseup",x)}},u=function(){c.enabled&&(e=Date.now(),b(document).on("mousemove",s),b(document).on("mouseup",t))},v=function(){var a=h[0].getBoundingClientRect();j=c.vertical?g[0].getBoundingClientRect().height:g[0].getBoundingClientRect().width,k=c.vertical?a.height:a.width,l=c.vertical?a.top:a.left,n=k-j-1,h.off().on("mousedown",u),c.$watch("value",function(){p()},!1),c.$on("$destroy",function(){h.off()})},w=function y(){"undefined"===c.value||null===c.value?setTimeout(y,2):(setTimeout(v,80),c.$watch("reset",v,!1))};w()}}}])}),define("directives/BindEventDirective",["app"],function(a){a.directive("bindEvent",["$parse",function(a){return function(b,c,d){var e=b.$eval(d.bindEvent);c=$(c),window.angular.forEach(e,function(d,e){var f=a(d);c.on(e,function(a){var c=Array.prototype.slice.call(arguments).splice(1);b.$apply(function(){f(b,{$event:a,$params:c})})})})}}])}),define("directives/ForceModelUpdateDirective",["app"],function(a){a.directive("forceModelUpdate",["eventTypeProvider",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){b.$on(a.FORCE_MODEL_UPDATE,function(){e.$setViewValue(c.val())})}}}])}),define("directives/TooltipElementDirective",["app"],function(a){a.directive("tooltipElement",["$rootScope","eventTypeProvider",function(a,b){return{scope:!0,link:function(c,d){var e=20,f=20,g=null,h=$(d[0]),i=null,j=$(h[0].children[0]),k=function(){parseInt(h.css("opacity"),10)||(h.removeClass("show"),h.addClass("hide"))},l=function(b){if(b){var d=$(document.body).width(),g=$(document.body).height(),j=h.width(),k=h.height();i=b,c.coords.x=b.clientX+e,c.coords.y=b.clientY+f,c.coords.y>=g-k&&(c.coords.y=b.clientY-k),c.coords.x+j>=d&&(c.coords.x=b.clientX-j),a.$$phase||c.$digest()}},m=function(a,b,c,d,e){g=b,j.html(""),j.append(c),d?j.addClass("text-only"):j.removeClass("text-only"),h.removeClass("hide"),h.addClass("show"),h.addClass("visible"),l(e),document.addEventListener("mousemove",l)},n=function(a,b){b===g&&(document.removeEventListener("mousemove",l),h.removeClass("visible"))};h.on("transitionend",k),a.$on(b.TOOLTIP_SHOW,m),a.$on(b.TOOLTIP_HIDE,n),$(h[0]).attrChange(function(){i&&l(i)}),c.coords={x:0,y:0}}}}])}),define("directives/TooltipDirective",["app","conf/conf"],function(a,b){b.TOOLTIPS&&a.directive("tooltip",["$rootScope","eventTypeProvider","templateManagerService",function(a,b,c){var d=0,e=function(){return++d};return{restrict:"A",priority:-999,link:function(d,f,g){var h,i,j=e(),k=$(f),l=function(e){if(i=!0,g.tooltipBeforeShow&&(d[g.tooltipBeforeShow](g.tooltipBeforeShowArgs),d.$apply(d)),g.hasOwnProperty("tooltipContent")){if(!g.tooltipContent)return;return void a.$broadcast(b.TOOLTIP_SHOW,j,g.tooltipContent,!0,e)}if(!g.tooltipTemplate)throw new Error("tooltip directive needs either a tooltipContent or tooltipTemplate attribute!");c.compile("tooltip/"+g.tooltipTemplate,d,function(c){a.$broadcast(b.TOOLTIP_SHOW,j,c,!1,e)})},m=function(c){i=!1,a.$broadcast(b.TOOLTIP_HIDE,j,c)},n=function(a){i&&(m(),l())},o=function(){h=!0,k.on("mouseover",l),k.on("mouseout",m),k.on("click",m)},p=function(){h=!1,k.off("mouseover",l),k.off("mouseout",m),k.off("click",m)},q=function(a){h?a?n():(m(),p()):a&&o()},r=function(){g.tooltipIf?d.$watch(g.tooltipIf,q):o()};r()}}}])}),define("directives/SelectElementDirective",["app","angular","queues/EventQueue"],function(a,b,c){a.directive("selectElement",["$rootScope","eventTypeProvider","$filter","$timeout",function(a,d,e,f){return{scope:!0,link:function(g,h){var i,j,k=null,l=$(h[0]),m=function(){if(j){var b=$(j).outerWidth()-i,c=$(j).offset();c&&(g.coords.x=c.left,g.coords.y=g.dropDown?c.bottom:c.top,g.width=b,a.$$phase||g.$digest())}},n=function(a,d,h,n,o,p,q,r,s){delete g.hoverIndex;var t,u=$(".action-list");if(c.register(c.types.RESIZE,m),k=d,g.list=h,b.isArray(n))for(g.multi={},t=n.length;t--;)g.multi[n[t].value]=!0;else g.multi=!1,n&&(g.list=e("filter")(g.list,function(a){return a.value!==n.value&&a.name!==n.name}));g.emptyTranslation=!g.list.length&&s,g.dropDown=!!q,g.dropDown?u.addClass("action-list-bottom"):u.removeClass("action-list-bottom"),g.multi?g.select=function(a,c){var d,e,f=function(a){return a.value===n[d].value};if(n){for(d=n.length;d--;)n[d].value===a.value?(delete g.multi[n[d].value],n.remove(d),e=!0):h.some(f)||(delete g.multi[n[d].value],n.remove(d));e||(g.multi[a.value]=!0,n.push(b.copy(a)))}c.stopPropagation(),o(n,c)}:g.select=function(a,b){n&&(n.name=a.name,n.value=a.value),b.stopPropagation(),o(a,b)},r=parseInt(r,10),i=isNaN(r)?0:r,j=p,m(),l.addClass("show").addClass("visible"),g.cellStyle||f(function(){u.height()>window.innerHeight/2&&(g.cellStyle={"float":"left",width:g.width/2-10+"px"})})},o=function(a,b){b===k&&(c.unregister(c.types.RESIZE,m),g.list=[],l.removeClass("visible").removeClass("show"))},p=function(a,b,c){b===k&&(g.hoverIndex=c)};g.$on(d.SELECT_SHOW,n),g.$on(d.SELECT_HIDE,o),g.$on(d.SELECT_KEY_HOVER,p),g.coords={x:0,y:0},g.isNumber=b.isNumber,g.isString=b.isString}}}])}),define("directives/SelectDirective",["app","angular","battlecat","conf/conf","helper/dom","generators/generate"],function(a,b,c,d,e,f){a.directive("select",["$rootScope","eventTypeProvider",function(a,g){return{scope:{list:"=",selected:"=",dropDown:"="},restrict:"A",priority:-999,templateUrl:d.DIRECTIVE_TEMPLATE_PATH_EXT.join("select"),link:function(d,h){if(!(d.list&&d.list instanceof Array&&d.selected&&d.selected instanceof Object))throw new TypeError("wrong parameter");var i,j=f.hex(),k=c(h[0]),l=k.find(".select-button")?28:0,m=k.find(".select-handler")[0]||k,n={},o=function t(b){b&&(b.preventDefault(),b.stopPropagation()),a.$broadcast(g.SELECT_HIDE,j,b),c(window).off("click",i),c(".win-main").off("mousewheel",t),d.expanded=!1},p=function(c,e){b.isArray(d.selected)?(a.$broadcast(g.SELECT_SELECTED,c.map(function(a){return a.value})),c.length||(d.selected.name=n.name,d.selected.value=n.value)):(d.selected.name=c.name,d.selected.value=c.value,o(e),a.$broadcast(g.SELECT_SELECTED,c.value))},q=function(b){b.preventDefault(),b.stopPropagation(),a.$broadcast(g.SELECT_SHOW,j,d.list,d.selected,p,m,d.dropDown,l),c(window).on("click",i),c(".win-main").on("mousewheel",o),d.expanded=!0},r=function(a){d.expanded?o(a):q(a)};try{n.name=d.selected.name||d.selected[0].name,n.value=d.selected.value||d.selected[0].value}catch(s){n.name="",n.value=""}i=e.matchesId.bind(this,"select-field",!0,o),d.$on("$destroy",function(){o(),a.$broadcast(g.SELECT_HIDE,j)}),d.toggleSelect=r,d.expanded=!1,d.isNumber=b.isNumber,d.isString=b.isString,d.onItemSelected=p}}}])}),define("directives/LoadingScreen",["app","battlecat","helper/time","conf/conf","version"],function(a,b,c,d,e){a.directive("townSwitchLoading",["$rootScope","eventTypeProvider","$filter",function(a,f,g){return{restrict:"A",link:function(h,i,j,k){var l,m,n=Modernizr.csstransitions,o=6,p=0,q=0,r="hidden",s="visible",t="first-load",u=function(a){q=Math.max(q-1,0),q||(window.clearTimeout(m),c.timer.tick(),n?b(i).one("transitionend",function(){i.addClass(r).removeClass(t)[0].innerHTML=""}):i.addClass(r).removeClass(t),i.removeClass(s))},v=function(b){q=q>=1?q:q+1,i.removeClass(r).addClass(s),window.clearTimeout(m),m=window.setTimeout(function(){a.$broadcast(f.MESSAGE_DEBUG,{message:g("i18n")(f.MESSAGE_DEBUG,a.loc.ale,"error_message")}),q=0,u()},d.LOADING_TIMEOUT)},w=function(){var a;if(h.progress+=p,h.progress=h.progress.bound(0,100),100===h.progress)for(;a=l.pop();)a()},x=function(){p=Math.ceil(100/o)};h.conf=d,h.version=e,h.progress=0,h.$on(f.MAP_ZOOM_INTO_VILLAGE,v),h.$on(f.MAP_LOADING_ASSETS,v),l=[h.$on(f.MAP_SELECT_VILLAGE,w),h.$on(f.CHARACTER_SELECTED,w),h.$on(f.CHARACTER_INFO,w),h.$on(f.VILLAGE,w),h.$on(f.LOGIN_SUCCESS,w),h.$on(f.MESSAGE_WELCOME,w)],h.$on("DONE",u),x()}}}])}),define("directives/ScrollbarDirective",["app"],function(a){a.directive("scrollbar",function(){return{restrict:"A",link:function(a,b,c){var d,e,f,g=c.scrollbarName||"scrollbar",h=0,i=!1,j=!1,k=function(){e.recalc()},l=function(){i=!0},m=function n(){if(d=$(b[0]).find(".scroll-wrap"),0===$(b).height()||0===d.length){if(h>2e3)return;h++,setTimeout(n,1)}else{if(e=window.jsScrollbar(b),e&&(e.resetScrollTop=l),a.directives=a.directives||{},a.directives.scrollbar=a.directives.scrollbar||{},a.directives.scrollbar[g]=e,f=b[0].parentNode.parentNode,null===e)return;a.$on("DONE",k),window.addEventListener("resize",k,!1),a.destroy=function(){var a=window.jsScrollbar.scrollbars.length;for(window.removeEventListener("resize",k,!1);a--;)if(window.jsScrollbar.scrollbars[a].__objId===e.__objId)return void window.jsScrollbar.scrollbars.remove(a)},a.$on("$destroy",a.destroy),a.$watch(function(){return d||(d=$(b[0]).find(".scroll-wrap")),$(d).height()},function(){j&&clearTimeout(j),j=setTimeout(function(){i&&(e.content.scrollTop=0,i=!1),e.recalc()},2)},!0),f.parentNode.getElementsByClassName("twx-window").length>0&&a.$watch(function(){return $(f).offset().bottom},k),e.focus()}};m()}}})}),define("directives/InfiniteScrollDirective",["app"],function(a){a.directive("infiniteScroll",["$rootScope","$timeout",function(a,b){return{link:function(c,d,e){var f,g,h,i,j,k,l=0;return g=function(){var b=d.offsetHeight+d.scrollTop,g=i.offsetTop+i.offsetHeight,k=g-b,m=k<=d.offsetHeight*l,n=b-d.offsetHeight,o=Math.floor(n/e.infiniteScrollRowHeight),p=Math.ceil(b/e.infiniteScrollRowHeight)+1;for(j=0;j<c[e.infiniteScrollContent].length;j++)c[e.infiniteScrollContent][j].scrollVis=j>=o&&p>=j?!0:!1;if(a.$$phase||c.$digest(),m&&h){if(c[e.infiniteScrollContent].length!==c[e.infiniteScrollTotalRows])return a.$$phase?c.$eval(e.infiniteScroll):c.$apply(e.infiniteScroll)}else if(m)return f=!0},c.initInfiniteScroll=function(){if(k++,0===c[e.infiniteScrollContent].length)setTimeout(c.initInfiniteScroll,2);else for(j=0;j<c[e.infiniteScrollContent].length;j++)c[e.infiniteScrollContent][j].scrollVis=!0},d=d[0],i=d.childNodes[1],null!==e.infiniteScrollDistance&&c.$watch(e.infiniteScrollDistance,function(a){return l=parseInt(a,10)}),h=!0,f=!1,null!==e.infiniteScrollDisabled&&c.$watch(e.infiniteScrollDisabled,function(a){return h=!a,h&&f?(f=!1,g()):void 0}),d.addEventListener("scroll",g,!1),c.$on("$destroy",function(){return d.removeEventListener("scroll",g,!1)}),c.initInfiniteScroll(),b(function(){return e.infiniteScrollImmediateCheck?c.$eval(e.infiniteScrollImmediateCheck)?g():void 0:g()},0)}}}])}),define("directives/UnitScreenTableDirective",["app","conf/conf","helper/parse"],function(a,b,c){a.directive("unitScreenTable",["$rootScope","socketService","routeProvider","windowManagerService","windowDisplayService","modelDataService","commandService","eventTypeProvider","mapService",function(a,d,e,f,g,h,i,j,k){var l="awayArmies";return{templateUrl:b.DIRECTIVE_TEMPLATE_PATH_EXT.join("unit_screen_table"),scope:{minimized:"=",villageId:"=",armyData:"=",sectionTitle:"=",options:"=",type:"=",time:"="},link:function(b){var j=h.getGameData().getOrderedUnitNames(),m=h.getSelectedCharacter(),n=(m.getSelectedVillage(),function(){b.minimized=!b.minimized}),o=function(a,b,c){c||(c={});var f={id:a.id,units:c};d.emit(b===l?e.COMMAND_WITHDRAWSUPPORT:e.COMMAND_SEND_SUPPORT_BACK,f)},p=function(b,c){var d=a.$new();d.confirm=function(){o(b,c),d.closeWindow()},f.getModal("modal_withdraw_all_units",d)},q=function(b,d){var e,g=a.$new();g.army=b,g.units={},g.rangeSlider={};for(e in j)j.hasOwnProperty(e)&&(g.units[j[e]]=b.units[j[e]],g.rangeSlider[j[e]]={value:0});g.onKeyup=function(a){g.rangeSlider[a].value=c.toValidInteger(g.rangeSlider[a].value)},g.confirm=function(){var a,c={};for(a in j)j.hasOwnProperty(a)&&(c[j[a]]=g.rangeSlider[j[a]].value,g.army[j[a]]-=g.rangeSlider[j[a]].value);o(b,d,c),g.closeWindow()},f.getModal("modal_withdraw_part_units",g)};b.openCancelCommandModal=i.openCancelCommandModal,b.isCancelable=i.isCancelable,b.toggleMinimized=n,b.openVillageInfo=g.openVillageInfo,b.jumpToVillage=k.jumpToVillage,b.openCharacterProfile=g.openCharacterProfile,b.openSendArmyBackModal=p,b.openSendArmyPartBackModal=q}}}])}),define("directives/ResearchesDirective",["app","battlecat","conf/conf"],function(a,b,c){a.directive("researches",["buildingService","eventTypeProvider","inventoryItemTypeProvider","modelDataService",function(a,b,d,e){return{templateUrl:c.DIRECTIVE_TEMPLATE_PATH_EXT.join("researches"),scope:{building:"="},link:function(c,f,g){var h=e.getGameData(),i=function(b){a.openResearchModal(c.building.name,b,!0)},j=function(a,b,e){var f=(c.building.level-a+1)/(b-a+1)*100;c.building.level>=b?f=100:c.building.level<a&&(f=0),c.levels.push({text:b!==a?a+" - "+b:a,progress:f,costs:e?h.getPremiumCostsForType(d.RESEARCH):null})},k=function m(a){var b=g.researchesName||"researches";if(a){if(!a.directives)return a=a.$parent,void m(a);a.directives=a.directives||{},a.directives.researches=a.directives.researches||{},a.directives.researches[b]=c}},l=function(){var a,b=0;k(c),c.research={};for(a in c.building.researches)c.research[c.building.researches[a].required_level]=c.building.researches[a],c.research[c.building.researches[a].required_level].name=a;c.levels=[];for(a in c.research)j(b,c.research[a].required_level-1),j(c.research[a].required_level,c.research[a].required_level,!0),b=c.research[a].required_level+1;c.research[a].required_level!==c.building.maxLevel&&j(c.research[a].required_level+1,c.building.maxLevel),c.groupWidth=100/c.levels.length,c.item=e.getInventory().getItemByType(d.RESEARCH)};c.openResearchModal=i,c.$on(b.BUILDING_LEVEL_CHANGED,l),c.$watch("building",function(a){c.building=a,l()}),l()}}}])}),define("directives/UnitOperateSliders",["app","conf/conf"],function(a,b){a.directive("unitOperateSliders",["$rootScope","$filter","modelDataService",function(a,c,d){return{templateUrl:b.DIRECTIVE_TEMPLATE_PATH_EXT.join("unit_operate_sliders"),scope:{sliders:"=",units:"=",simple:"=",showMaxButton:"=",catapultTarget:"="},link:function(b,e,f){var g=d.getGameData().getOrderedUnitNames(),h=function(){var e,h=d.getGameData().getAttackableBuildings(),i=[];for(b.unitOrderVisibleOnly=[],e=0;e<g.length;e++)0!==b.units[g[e]]&&(b.empty=!1,b.unitOrderVisibleOnly.push(g[e]));for(e in h)i.push({name:c("i18n")(e,a.loc.ale,"building_names"),value:e});b.attackableBuildings=i,b.hideCatapultTarget=f.hideCatapultTarget},i=function(b){return c("i18n")(b,a.loc.ale,"building_names")},j=function(a){0===a.value&&(a.value="")},k=function(a){""===a.value&&(a.value=0)};b.empty=!0,b.buildingListVisible=!1,b.attackableBuildings=[],b.unitOrderVisibleOnly=[],b.getBuildingName=i,b.onFocus=j,b.onBlur=k,b.$watch("units",h,!0),h()}}}])}),define("directives/PaginationDirective",["app","conf/conf"],function(a,b){a.directive("pagination",["storageService",function(a){return{templateUrl:b.DIRECTIVE_TEMPLATE_PATH_EXT.join("pagination"),name:"pagination",scope:{pagination:"=pagination"},link:function(c,d){var e=null,f=function(){return Math.ceil(c.pagination.count/c.pagination.limit)||1},g=function(){return~~(c.pagination.offset/c.pagination.limit)},h=function(a,b){var c,d=[1],e="...";if(a+=1,5>b){for(c=1;b>c;)d.push(++c);return d}return a.between(1,3)?3===a?d.push(2,3,4,e):d.push(2,3,e):a.between(b,b-2)?a===b-2?d.push(e,b-3,b-2,b-1):d.push(e,b-2,b-1):d.push(e,a-1,a,a+1,e),d.push(b),d},i=function(a,b){var d,e=$(".directive-pagination");b&&a--,c.page=Math.floor(a).bound(0,f()-1),c.displayPage=c.page+1,c.pagination.offset=c.page*c.pagination.limit,c.pages=h(c.page,f()),c.pagination.loader(c.page,c.pagination.limit,c.pagination.offset),e.length&&((d=e.parents(".outer-scroll-wrap")[0])?d.scrollTop=0:e.parents(".scroll-wrap")[0].scrollTop=0)},j=function(d){c.page=0,c.displayPage=1,c.pagination.limit=d,c.pages=h(c.page,f()),-1!==b.DEFAULT_PAGINATION_LIMITS.indexOf(d)&&a.setItem("paginationLimit",d),i(0)},k=function(){c.limits[0]>=c.pagination.count?$(d).hide():$(d).show()},l=function(){c.pages=h(c.page,f()),-1===c.limits.indexOf(c.pagination.limit)&&(c.pagination.limit=c.limits[0]),k()},m=function(a){(!e&&a||(window.clearTimeout(e),e=null,a))&&(e=window.setTimeout(function(){i(a,!0)},250))};c.limits=c.pagination.limits||b.DEFAULT_PAGINATION_LIMITS,c.displayPage=1,c.page=g(),c.pages=h(c.page,f()),c.setLimit=j,c.loadPage=i,c.onKeyUp=m,c.$watch("pagination",function(){var a=g();c.page=a,c.displayPage=a+1,c.pages=h(a,f()),k()},!0),l()}}}])}),define("directives/AutoCompleteDirective",["app","conf/conf","helper/dom","helper/format","helper/parse","generators/generate"],function(a,b,c,d,e,f){a.directive("autoComplete",["$rootScope","$filter","eventTypeProvider","autoCompleteService",function(a,g,h,i){var j;return{templateUrl:b.DIRECTIVE_TEMPLATE_PATH_EXT.join("autocomplete"),scope:{autoComplete:"="},link:function(b,k,l){var m,n,o,p,q=f.hex(),r=$(k[0]),s=function(a){void 0!==a&&(b.inputValue=a),b.autoComplete.inputValueReadOnly=b.inputValue},t=function(){o=[],p=-1,s("")},u=function(a){var b,c=[];if(a.participants)for(b=0;b<a.participants.length;b++)c.push(a.participants[b].character_name);return c},v=function(a){return a.message_id&&(a.name=a.title,a.smalls=u(a)),"village"===a.type&&(a.displayedName=d.villageNameWithCoordinates(a)),a.type&&(a.leftIcon="size-34x34",a.leftIcon+=" icon-26x26-rte-"+a.type),a},w=function(){a.$broadcast(h.SELECT_HIDE,q),$(window).off("click",m)},x=function(a){a&&(b.autoComplete.onEnter&&b.autoComplete.onEnter(a),b.autoComplete.keepSelected?s(a.name):t(),w())},y=function(){j||(j=g("i18n")("no_results",a.loc.ale,"directive_autocomplete")),a.$broadcast(h.SELECT_SHOW,q,o,void 0,x,r,b.autoComplete.dropDown,void 0,j),$(window).off("click",m).on("click",m)},z=function(a){var c=a.result;o=b.autoComplete.exclude?c.filter(b.autoComplete.exclude):c,o=o.map(v),o.length>0?y():w(),p=-1},A=function(a){var b=a&&a.villages&&a.villages[0],c=[];!b&&a.id&&(b=a),b&&c.push({id:b.id,x:b.x,y:b.y,name:b.name,type:"village"}),z({result:c})},B=function(a){n=a,b.autoComplete.byCoordinates?i.villageByCoordinates(a,A):"function"==typeof b.autoComplete.type?b.autoComplete.type(a,z):"string"==typeof b.autoComplete.type?i[b.autoComplete.type](a,z):b.autoComplete.type instanceof Array&&i.mixed(b.autoComplete.type,a,z)},C=function(a){return b.autoComplete.byCoordinates?e.toCoordinates(a):a.length<=1?!1:0===o.length&&n&&n.length<a.length&&n===a.substr(0,n.length)?!1:a},D=function(){return o&&o.length&&p.between(0,o.length-1)&&o[p]},E=function(c){var d,e=!1;try{switch(c.keyCode){case 27:t();break;case 39:p=p.bound(0,o.length-1);break;case 13:p=p.bound(0,o.length-1),e=!0;break;case 38:p=((p||o.length)-1)%o.length;break;case 40:p=(p+1)%o.length;break;default:d=C(b.inputValue),d&&B(d)}}catch(f){a.$broadcast(h.MESSAGE_ERROR,{message:"No such "+b.autoComplete.type+"."})}D()?(s(o[p].name),a.$broadcast(h.SELECT_KEY_HOVER,q,p),e&&x(o[p])):s()};r.addClass("auto-complete-wrapper"),r.addClass(q),b.$on("$destroy",function(){w()}),b.autoCompleteKeyUp=E,b.autoComplete.clear=t,m=c.matchesId.bind(this,"select-field",!0,w),t()}}}])}),define("directives/IconGeneratorDirective",["app"],function(a){a.directive("iconGenerator",["iconGeneratorService",function(a){return function(b,c,d){b.$watch(d.iconGenerator,function(e){void 0!==e&&a.generate(e,b.$eval(d.iconType),c[0])})}}])}),define("directives/FocusDirective",["app"],function(a){a.directive("focus",["$timeout",function(a){return{link:function(b,c,d){b.$eval(d.focus)&&a(function(){c[0].focus()})}}}])}),define("directives/ContentSliderDirective",["app","battlecat","conf/conf","cdn"],function(a,b,c,d){a.directive("contentSlider",["$timeout",function(a){return{templateUrl:c.DIRECTIVE_TEMPLATE_PATH_EXT.join("content_slider"),restrict:"A",name:"contentSlider",link:function(c,e){var f,g,h,i,j,k,l,m,n,o,p=0,q={},r={},s=0,t=300,u={x:0,y:0};f=function(){q.main=b(e),q.outer=q.main.find(".content-slider"),q.itemsWrapper=q.main.find(".sliding-items-wrapper"),q.testItem=b(q.itemsWrapper.find(".sliding-item")[0])},g=function(){r.outer={width:q.outer.width(),innerWidth:q.outer.innerWidth()},r.itemWrapper={width:q.itemsWrapper.width()},r.item={width:q.testItem.width(),outerWidth:q.testItem.outerWidth()}},h=function(){r.itemWrapper.width=c.contentSlider.items.length*r.item.outerWidth,s=r.outer.innerWidth-r.itemWrapper.width,c.contentSlider.directive.canScrollLeft=u.x<0,c.contentSlider.directive.canScrollRight=r.itemWrapper.width>r.outer.innerWidth&&u.x!==s,q.itemsWrapper.css("width",r.itemWrapper.width+"px")},i=function(){c.contentSlider.directive.canScrollLeft&&k(u.x+t)},j=function(){c.contentSlider.directive.canScrollRight&&k(u.x-t)},k=function(a){u.x=a.bound(s,0),h()},l=function(a){k(-(a*r.item.outerWidth))},m=function(a){r.itemWrapper.width<r.outer.innerWidth||k(-(a*r.item.outerWidth)+r.outer.innerWidth/2-r.item.width/2)},n=function(){if(!c.contentSlider)throw new Error("No 'contentSlider' property found in controller scope");if(!c.contentSlider.items)throw new Error("No 'contentSlider.items' referenced in controller scope");if(!c.contentSlider.itemView)throw new Error("No 'contentSlider.itemView' referenced in controller scope")},o=function(){n(),f(),g(),c.cdn=d,c.$watch("contentSlider.items",h),c.contentSlider.onReady&&a(function(){c.contentSlider.onReady()},p)},a(function(){a(function(){c.contentSlider.directive={},c.contentSlider.directive.canScrollLeft=!1,c.contentSlider.directive.canScrollRight=!1,c.contentSlider.directive.coords=u,c.contentSlider.directive.slideLeft=i,c.contentSlider.directive.slideRight=j,c.contentSlider.directive.centerItem=m,c.contentSlider.directive.alignItemLeft=l,o()},p)},p)}}}])}),define("directives/TextareaGrowDirective",["app","angular"],function(a,b){a.directive("textareaGrow",[function(){return{restrict:"A",scope:{linkElementToProperty:"=linkElementToProperty"},link:function(a,c,d){var e=c[0].offsetHeight,f=b.element("<div></div>").addClass("hiddendiv"),g=function(){f.text(c.val()+"\n"),c.css("height",Math.max(f[0].offsetHeight+10,e)+"px")};b.element(document.body).append(f),d.linkElementToProperty&&(a.linkElementToProperty=c),c.bind("keyup keydown keypress change",g),setTimeout(g,1e3),a.$on("$destroy",function(){f.remove()})}}}])}),define("directives/MessageDirective",["app","helper/time","conf/conf"],function(a,b,c){a.directive("message",["$rootScope","windowDisplayService",function(a,d){return{templateUrl:c.DIRECTIVE_TEMPLATE_PATH_EXT.join("message"),scope:{id:"=",index:"=",icon:"=",name:"=",date:"=",content:"=",hasRight:"=",updaterName:"=",updaterDate:"=","delete":"&",edit:"&",quote:"&"},link:function(a,c,e){a.updaterDate=b.server2ClientTime(a.updaterDate),a.openProfile=function(){d.openCharacterProfile(a.id)}}}}])}),define("directives/PlaceholderDirective",["app"],function(a){a.directive("placeholder",function(){var a;return function(b,c,d){$(c).on("focus",function(){a=c[0].placeholder,c[0].placeholder=""}),$(c).on("blur",function(){c[0].placeholder=a})}})}),define("directives/ScrollToDirective",["app"],function(a){a.directive("scrollToDirective",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){var e,f=b.$eval(d.scrollToDirective),g=d.elementIndex;f&&a(function(){var a=b.directives.scrollbar,d=Object.keys(a);e=$(c).offset(),a&&a.hasOwnProperty("scrollbar")?a=a.scrollbar:d.length>0&&(a=a[d[0]]),a.tweenTo(0,g?g*$(c).height():$(c).pos().top)},0)}}}])}),define("directives/IframeOnloadDirective",["app"],function(a){a.directive("iframeOnload",function(){return function(a,b,c){b.on("load",function(){a[c.iframeOnload]()})}})}),define("directives/WorldMapSearchDirective",["app","conf/conf","helper/dom","helper/parse","generators/generate"],function(a,b,c,d,e){a.directive("worldMapSearch",["$rootScope","eventTypeProvider","linkService","$filter","mapService","storageService","modelDataService","autoCompleteService",function(a,f,g,h,i,j,k,l){var m="directive_world_map";return{templateUrl:b.DIRECTIVE_TEMPLATE_PATH_EXT.join("world_map_search"),scope:!0,link:function(n,o,p){var q,r,s=10,t=e.hex(),u=$(o[0]),v=!1,w=u.find(".directive-world-map-search"),x={},y={},z=function(){
var a="autocompleteFavourites",b=k.getSelectedCharacter();return a+"_"+b.getId()+"_"+b.getWorldId()},A=function(a){y.x=d.toValidInteger(a.x).bound(0,b.MAP_SIZE-1),y.y=d.toValidInteger(a.y).bound(0,b.MAP_SIZE-1)},B=function(a){return a.type+"_"+a.id},C=function(){var a;for(a in x)q[a]||delete x[a]},D=function(a){return!x[B(a)]},E=function(a){C(),x[B(a)]=a},F=function(){v=!0,w.addClass("visible"),$(window).on("click",r),u.find(".auto-focus input").focus()},G=function(){$(window).off("click",r),v=!1,w.removeClass("visible")},H=function(a,b,c){c=void 0===c?!v:!!c,c?(b&&b.stopPropagation(),F()):G()},I=function(a){A(a),"village"===a.type?i.jumpToVillage(a.x,a.y,a.id):l.villageByCoordinates(a,function(b){i.jumpToVillage(a.x,a.y,b.id)})},J=function(a){G(),g.linkTo(a.id,a.type)},K=function(){n.maxFavourites=Object.keys(q).length===s},L=function(a,b){var c=b.type+"_"+b.id;if(a.stopPropagation(),q[c])delete q[c],delete x[c];else{if(Object.keys(q).length===s)return;q[c]=b,b.favourite=!0,x[c]||(x[c]=b)}K(),j.setItem(z(),q)},M=function(){var a,b;q=j.getItem(z())||{};for(b in q)a=q[b],x[a.type+"_"+a.id]=a;K()};r=c.matchesId.bind(this,["world-map-search-"+t,"main-canvas","select-field"],!0,G),n.id=t,n.linkTo=J,n.jumpTo=I,n.textObject=m,n.coordinates=y,n.selectedItems=x,n.validateCoordinates=A,n.toggleFavourite=L,n.autoComplete={type:["character","tribe","village"],placeholder:h("i18n")("placeholder_autocomplete",a.loc.ale,m),onEnter:E,exclude:D},n.$on(f.WORLD_MAP_SEARCH_TOGGLE,H),M()}}}])}),define("directives/AudioDirective",["app","angular"],function(a,b){a.directive("audio",["$rootScope","eventTypeProvider",function(a,c){return{priority:-1,restrict:"A",link:function(d,e,f){var g="click",h=b.element(document.body),i=[],j=function(){return d.$eval(f.audio)},k=function(d){return function(){var e,f=j(),g=d?f[d]:f,h=[];if(g){if(b.isObject(g))for(e in g)g[e]&&h.push(e);else h.push(g);h.forEach(function(b){a.$broadcast(c.AUDIO_PLAY_SFX,b)})}}},l=function(){var a="mouseup",b=function(c){k(a)(c),h.off(a,b)};h.on(a,b)},m=function(){var a,c,d=j();if(!d||b.isString(d))return c=k(),i.push([g,c]),void e.on(g,c);for(a in d)"mouseup"!==a.toLowerCase()?(c=k(a),i.push([a,c]),e.on(a,c)):(i.push(["mousedown",l]),e.on("mousedown",l))},n=function(){var a,b=i.length;for(a=0;b>a;a++)e.off(i[a][0],i[a][1])};m(),d.$on("$destroy",n)}}}]);var c=function(a,b){return{priority:-1,restrict:"E",link:function(c,d){var e=d[0].type,f=function(c){return function(){a.$broadcast(b.AUDIO_PLAY_SFX,c)}},g=[];"checkbox"===e||"radio"===e?g.push(["click",f("checkbox_01")]):(g.push(["focus",f("textbox_activate_01")]),g.push(["blur",f("textbox_confirm_01")])),g.forEach(function(a){d.on(a[0],a[1])}),c.$on("$destroy",function(){g.forEach(function(a){d.off(a[0],a[1])})})}}},d=function(a,c){return{priority:-1,restrict:"A",link:function(d,e,f){var g,h=function(a){return b.isArray(a)?a.filter(h).length:-1!==e[0].className.indexOf(a)},i=[{className:["-radio","-checkbox"],sound:"checkbox_01"},{className:"btn-grey",sound:"click_failed"},{className:"btn-red",sound:"cancel_action_01"},{className:"btn-yellow",sound:"button_premium_01"},{className:"btn-orange",sound:"button_04"}],j=i.length,k=function(){for(g=0;j>g;g++)if(h(i[g].className))return void a.$broadcast(c.AUDIO_PLAY_SFX,i[g].sound);return h("tab")?void(h("tab-active")||a.$broadcast(c.AUDIO_PLAY_SFX,"switch_tab_01")):void a.$broadcast(c.AUDIO_PLAY_SFX,"button_04")};f.audio||(e.on("click",k),d.$on("$destroy",function(){e.off("click",k)}))}}};a.directive("input",["$rootScope","eventTypeProvider",c]),a.directive("textarea",["$rootScope","eventTypeProvider",c]),a.directive("ngClick",["$rootScope","eventTypeProvider",d]),a.directive("ngHref",["$rootScope","eventTypeProvider",d])}),define("helper/richtext",["battlecat","cdn"],function(a,b){var c,d,e="directive_rich_text_editor",f={url:!0,image:!0,quote:!0,spoiler:!0,building:!0,unit:!0,player:!0,village:!0,report:!0,tribe:!0,crm_api:!0},g={size:!0,color:!0,"data-bb-type":!0,"data-bb-value":!0,"data-bb-content":!0,"data-bb-link":!0},h={village:"internal-link",player:"internal-link",tribe:"internal-link",url:"external-link",image:"external-link",crm_api:"internal-link"},i={url:"value",crm_api:"link",image:"value",spoiler:"content",player:"content",village:"content",tribe:"content",building:"translatedContent",unit:"translatedContent"},j=function(b,c){var d=a(document.createElement(b));return c&&d.html("<br>"),d},k=function(a){return{type:a.attr("data-bb-type")[0],value:a.attr("data-bb-value")[0],content:a.attr("data-bb-content")[0],link:a.attr("data-bb-link")[0]}},l=function(a){return a?"{{ '"+a.content+"' | i18n:loc.ale:'"+a.type+"_names' }}":void 0},m=function(a,b){var c,d;b||(b=k(a)),c=b.tooltip,c||(d=i[b.type],"translatedContent"===d?c=l(b):d&&(c=b[d])),c&&(a.attr("tooltip",""),a.attr("tooltip-content",c))},n=function(a,b,c){b&&(b.type&&a.attr("data-bb-type",b.type),b.value&&a.attr("data-bb-value",b.value),b.content&&(c?a.html(b.content):a.attr("data-bb-content",b.content)),c||m(a,b))},o=function(a,d,e){return e||(e=c),"player"===a&&(a="character"),"building"===a&&(a="building-"+d,!e||"church"!==d&&"chapel"!==d||(a+="-bathhouse")),"unit"===a&&(a="unit-"+d),b.getPath("/img/rte/"+a+".png")},p=function(a,b,c){a.attr("src",o(b.type,b.content,c)),a.attr("unselectable","on"),a.attr("class","img-link")},q=function(a){a.attr("data-bb-content",a.html())},r=function(a){var b=a[0].parentNode,c=j("a"),d=k(a);if(!d.type)throw new Error("Invalid rich text element without data-bb-type attribute.");b.replaceChild(c[0],a[0]),n(c,d,!0)},s=function(a){var b=a[0].parentNode,c=j("img"),d=k(a);if(!d.type)throw new Error("Invalid rich text element without data-bb-type attribute.");b.replaceChild(c[0],a[0]),p(c,d),n(c,d)},t=function(a){var b=a.attr("data-bb-type")[0],c="rich-text-";c+=h[b]||b,a.attr(c,"true"),a.attr("ng-click","action()")},u=function(a){a.children(".quote-author").remove(),a.removeAttr("class")},v=function(a){var b=a.html(),c=a.attr("data-bb-value")[0],d=j("span");d.attr("class","quote-author"),d.html("{{ 'has_written' | i18n:loc.ale:'"+e+"':'"+c+"' }}"),a.html(b),a.prepend(d[0])},w=function(a){t(a),a.html("")},x=function(a){t(a),m(a)},y=function(b){var c,d,e=b.find("p");for(c=0;c<e.length;c++)d=a(e[c]),""===d.html()&&d.remove();return b},z=function(a){var b,c,d=a.attr("size")[0],e=a.attr("color")[0];d&&e&&(b=a[0].parentNode,c=j("font"),c.attr("size",d),a.removeAttr("size"),b.replaceChild(c[0],a[0]),c.append(a[0]))},A=function(b){var c,d=b.find("font");for(c=0;c<d.length;c++)z(a(d[c]));return b},B=function(b,c,e,g){for(var h,i,j,k,l,m=!1,n=b.find(c);!m;){for(h=0;h<n.length;h++)i=a(n[h]),j=i.attr("data-bb-type")[0],f[j]&&(l=d[e][j],k=d[e].general,l&&void 0!==l.digest?l.digest&&l.digest(i):k.digest(i),l&&l.cssClass&&(i.attr("class")[0]?i.addClass(l.cssClass):i.attr("class",l.cssClass)));n=b.find(c),m=!(g&&n&&n.length>0)}return b},C=function(a){var b,c,d;if(c=a[0].attributes)for(b=0;b<c.length;b++)d=c[b].name,g[d]||a.removeAttr(d)},D=function(b){var c,d=b.find("*");for(c=0;c<d.length;c++)C(a(d[c]));return b},E=function(a,b){return b?a.html():a[0].childNodes},F=function(a){var b=j("div");return b.html(a),b},G=function(a){var b=F(a);return b=D(b),b=B(b,'span[data-bb-type="quote"]:not(".quote")',"read",!0),b=B(b,"a","read")},H=function(a,b){var c=F(a);return c=y(c),c=B(c,'span.quote[data-bb-type="quote"]',"parse",!0),c=B(c,"img","parse"),c=A(c),E(c,!b)},I=function(a,b,d){var e;return c=d,e=G(a),e=B(e,"a","show"),E(e,b)},J=function(a,b,d){var e;return c=d,e=G(a),e=B(e,"a","edit"),E(e,b)};return d={read:{general:{digest:q},spoiler:{cssClass:"img-link icon-20x20-spoiler"},village:{cssClass:"img-link icon-20x20-village"},player:{cssClass:"img-link icon-20x20-character"},report:{cssClass:"img-link icon-20x20-report"},tribe:{cssClass:"img-link icon-20x20-tribe"},image:{cssClass:"img-link icon-20x20-url"},url:{cssClass:"img-link icon-20x20-url"},quote:{digest:v,cssClass:"quote textfield-border"},crm_api:{cssClass:"img-link icon-20x20-favourite"}},parse:{general:{digest:r},quote:{digest:u}},show:{general:{digest:t},building:{digest:s},unit:{digest:s},spoiler:{digest:w,cssClass:"spoiler"},village:{cssClass:"btn btn-orange padded"},player:{cssClass:"btn btn-orange padded"},report:{digest:w,cssClass:"btn btn-orange padded"},tribe:{cssClass:"btn btn-orange padded"},image:{digest:x,cssClass:"btn btn-orange padded"},url:{digest:x,cssClass:"btn btn-orange padded"},quote:{digest:null},crm_api:{digest:x,cssClass:"btn btn-orange padded"}},edit:{general:{digest:s},quote:{digest:null}}},{createElement:j,setBBAttributes:n,formatImageTag:p,forParse:H,forShow:I,forEdit:J}}),define("directives/RichTextDirective",["app","helper/bbcode","helper/richtext"],function(a,b,c){a.directive("richText",["$compile","modelDataService",function(a,d){var e="directive_rich_text_editor",f=d.getWorldConfig().isBathHouseEnabled();return{scope:{bbCode:"=",bbCodeMeta:"="},link:function(d,g){d.textObject=e,g.addClass("rich-text"),g.append(c.forShow(b.toHTML(d.bbCode,d.bbCodeMeta),void 0,f)),a(g.contents())(d)}}}])}),define("directives/RichTextReportDirective",["app","conf/conf"],function(a,b){a.directive("richTextReport",["$rootScope","eventTypeProvider","reportService",function(a,c,d){return{templateUrl:b.DIRECTIVE_TEMPLATE_PATH_EXT.join("rich_text_report"),scope:!0,link:function(b,e){var f,g=!1,h=!1,i=e.attr("data-bb-content").replace(/\_/g,"."),j=function(a){b.isOpen=g=!!a},k=function(){f&&(j(!1),d.openReportWithData(f,!0))},l=function(){g&&f&&k()},m=function(a,b){b.token===i&&(f=b,l())},n=function(){b.deleted=h=!0,e.removeClass("btn-orange"),e.addClass("btn-grey icon-inactive")},o=function(a){a.error_code&&n()},p=function(){f||d.getReportByToken(i,o)},q=function(){h||(j(!g),p(),l())};a.$on(c.REPORT_VIEW,m),b.action=q}}}])}),define("directives/RichTextInternalLinkDirective",["app"],function(a){a.directive("richTextInternalLink",["linkService",function(a){return{scope:!0,link:function(b,c){var d=c.attr("data-bb-value"),e=c.attr("data-bb-type"),f=c.attr("data-bb-link"),g=c.attr("data-bb-campaign"),h=function(){a.linkTo(d,e,b,f,g)};b.action=h}}}])}),define("directives/RichTextExternalLinkDirective",["app"],function(a){a.directive("richTextExternalLink",["$rootScope","$filter","windowManagerService",function(a,b,c){var d="directive_rich_text_editor";return{scope:!0,link:function(e,f){var g,h=["tribalwars2.com","innogames.com","grepolis.com","forgeofempires.com","elvenar.com","the-west.de","the-west.net","the-west.pl","the-west.nl","the-west.se","the-west.ro","the-west.com.pt","the-west.cz","the-west.es","the-west.ru","the-west.com.br","the-west.org","the-west.hu","the-west.gr","the-west.dk","the-west.sk","the-west.fr","the-west.it","the-west.no.com","public.beta.the-west.net","die-staemme.de","staemme.ch","tribalwars.net","tribalwars.nl","plemiona.pl","tribalwars.se","tribalwars.com.br","tribalwars.com.pt","divokekmeny.cz","bujokjeonjaeng.org","triburile.ro","voyna-plemyon.ru","fyletikesmaxes.gr","tribalwars.no.com","divoke-kmene.sk","klanhaboru.hu","tribalwars.dk","tribals.it","klanlar.org","guerretribale.fr","guerrastribales.es","tribalwars.fi","tribalwars.ae","tribalwars.co.uk","vojnaplemen.si","plemena.com","tribalwars.asia","tribalwars.works","tribalwars.us","tribalwarsmasters.net"],i=function(a){0!==a.indexOf("http")&&0!==a.indexOf("ftp")&&(a="http://"+a);var b=function(a){var b=document.createElement("a");return b.href=a,b};return b(a).hostname},j=function(){return g=decodeURIComponent(f.attr("data-bb-value"))},k=function(){window.open(g,"_blank")},l=function(){var c=a.$new();return c.title=b("i18n")("external_link_title",a.loc.ale,d),c.text=b("i18n")("external_link_disclaimer",a.loc.ale,d,g),c.submitText=b("i18n")("external_link_confirm",a.loc.ale,d),c.cancelText=b("i18n")("external_link_cancel",a.loc.ale,d),c.href=g,c.submit=function(a){a.preventDefault(),k(),c.closeWindow()},c.cancel=function(){c.closeWindow()},c},m=function(a){var b,c=i(a);for(b=0;b<h.length;b++)if(new RegExp("^(.*)"+h[b]+"$","i").test(c))return!0;return!1},n=function(){if(m(g))k();else{var a=l();c.getModal("modal_attention",a)}},o=function(){g=j()};o(),e.action=n,e.isWhitelisted=m}}}])}),define("directives/RichTextSpoilerDirective",["app","conf/conf"],function(a,b){a.directive("richTextSpoiler",[function(){return{templateUrl:b.DIRECTIVE_TEMPLATE_PATH_EXT.join("rich_text_spoiler"),scope:!0,link:function(a,b){var c=!1,d=b.attr("data-bb-content"),e=function(){c?b.removeClass("open"):b.addClass("open"),a.isOpen=c=!c};a.content=d,a.action=e}}}])}),define("directives/RichTextEditorDirective",["app","battlecat","rangy","conf/conf","helper/dom","helper/bbcode","helper/richtext","generators/generate"],function(a,b,c,d,e,f,g,h){a.directive("richTextEditor",["$rootScope","$compile","$filter","$timeout","textAngularManager","modelDataService","eventTypeProvider",function(a,i,j,k,l,m,n){var o="directive_rich_text_editor",p=m.getWorldConfig().isBathHouseEnabled(),q=8e3,r=500,s=f.LINK_TYPES;return{templateUrl:d.DIRECTIVE_TEMPLATE_PATH_EXT.join("rich_text_editor"),scope:{richTextEditor:"="},link:function(d,m){var t,u,v,w,x,y,z,A="rich-text-editor-"+h.hex(),B=b(m).find('input[type="hidden"][tabindex="-1"]').attr("name")[0],C=l.retrieveEditor(B),D=C.scope,E=b(D.displayElements.text),F=function(b,c){return'<button class="{{ isDisabled() && \'btn-grey\' }}" type="button" tooltip="" tooltip-content="'+j("i18n")(c,a.loc.ale,o)+'"><i class="icon-26x26-'+b+" {{ isDisabled() && 'icon-inactive' }}\"></i></button>"},G=function(a){x.HTML=a||""},H=function(a){var b,c,d=x.HTML;return b=g.forParse(d),c=f.toBBCode(b),a&&G(),c},I=function(a){var b;if(a)for(a=a.replace(/^\s+|\s+$/g,""),b=0;b<a.length;b++)if(65279!==a.charCodeAt(b))return!1;return!0},J=function(){var a=H(),b=a.length,c=x.maxLength;I(a)?d.bbCodeLength=0:d.bbCodeLength=b,x.valid=d.bbCodeLength<c&&d.bbCodeLength>0},K=function(){z&&k.cancel(z),z=k(J,r)},L=function(){i(E.children())(d),k(function(){l.refreshEditor(B),K()})},M=function(a){var b=f.toHTML(a);b=g.forEdit(b,!0,p),E.html(b),L(),E.focus()},N=function(a,b){var d;E.focus(),d=c.getSelection(),t=a,v=b,w&&c.removeMarkers(w),w=d.rangeCount?c.saveSelection():null},O=function(a){u=a},P=function(){u&&u.resolve()},Q=function(a,b){var d,e,f;for(E.focus(),a.deleteContents(),a.collapse(!1),d=0;d<b.length;d++)e=b[d],a.insertNode(e);a.collapseAfter(e),f=c.getSelection(),f.setSingleRange(a),L()},R=function(a){var b=g.createElement("img");return g.setBBAttributes(b,a),g.formatImageTag(b,a,p),b[0]},S=function(a,b,c,d){var e,f=g.createElement(a);if(g.setBBAttributes(f,b),c&&f.addClass(c),d)for(("string"==typeof d||d instanceof String)&&(d=[d]),e=d.length;e--;)f.append(d[0]);return f.attr("unselectable","on"),f[0]},T=function(){var a=g.createElement("p",!0),b=c.getSelection(),d=c.createRange(),e=a[0];E.append(e),d.setStartAfter(e),d.setEnd(e),b.removeAllRanges(),b.addRange(d)},U=function(){return this.$editor().wrapSelection("bold",null)},V=function(){return this.$editor().queryCommandState("bold")},W=function(){return this.$editor().wrapSelection("italic",null)},X=function(){return this.$editor().queryCommandState("italic")},Y=function(){return this.$editor().wrapSelection("underline",null)},Z=function(){return this.$editor().queryCommandState("underline")},$=function(a,b){v("foreColor",b)},_=function(a,b){v("fontSize",b)},aa=function(a,b){var c=R({type:"spoiler",content:b});Q(a,[c])},ba=function(a,b){var c,d,e,f,g=[];if(b.length)for(c=0;c<b.length;c++)d=b[c],f={content:d.token.replace(/\./g,"_"),tooltip:d.title,type:s.report},g.push(R(f));else e="character"===b.type?"player":b.type,f={type:e,value:b.id,content:b.displayedName||b.name},g.push(R(f));Q(a,g)},ca=function(a,b,c){var d=R({type:b,content:c});Q(a,[d])},da=function(a,c,d){var e="{{ 'has_written' | i18n:loc.ale:'"+o+"':'"+c+"' }}",f=S("span",void 0,"quote-author",e),g=S("span",{type:"quote",value:c},"quote textfield-border",d),h=b(g);h.prepend(f),E.append(h[0].outerHTML),T(),L()},ea=function(b,c){d.menuOpen?a.$broadcast(n.RICH_TEXT_EDITOR_MENU_HIDE):a.$broadcast(n.RICH_TEXT_EDITOR_MENU_SHOW,{editorId:A,menuName:c,triggerElement:b})},fa=function(b,e){if(!e||!e.editorId||e.editorId===A){d.menuOpen&&a.$broadcast(n.RICH_TEXT_EDITOR_MENU_HIDE);var f=e&&e.args||Array.prototype.slice.call(arguments,1);w&&(c.restoreSelection(w),f.unshift(c.getSelection().getRangeAt(0)),t.apply(this,f),P(),v=w=null)}},ga=function(a,b){var c=g.forEdit(f.toHTML(b.content),void 0,p);N(da,null),fa(a,b.author.name||b.author,c)},ha=function(a){var b=C&&C.toolbars&&C.toolbars[0];l.removeTool(a.name),l.addToolToToolbar(a.name,{display:a.display,commandKeyCode:a.commandKeyCode,activeState:a.activeState,action:a.action||function(b){P(),ea(this.$element,a.name),O(b),N(a.finishAction,this.$editor().wrapSelection)}},b)},ia=function(){ha({name:"twx-newline",display:F("normal-arrow-down","insert_newline_bottom"),action:T}),ha({name:"twx-bold",display:F("font-bold","bold"),action:U,activeState:V,commandKeyCode:98}),ha({name:"twx-italics",display:F("font-italic","italic"),action:W,activeState:X,commandKeyCode:105}),ha({name:"twx-underline",display:F("font-underlined","underlined"),action:Y,activeState:Z,commandKeyCode:117}),ha({name:"twx-color",display:F("rte-color-picker","color"),finishAction:$}),ha({name:"twx-link",display:F("rte-link","link"),finishAction:ba}),ha({name:"twx-size",display:F("font-size","size"),finishAction:_}),ha({name:"twx-spoiler",display:F("rte-spoiler","spoiler"),finishAction:aa}),ha({name:"twx-unit",display:F("rte-unit","unit"),finishAction:ca}),ha({name:"twx-building",display:F("rte-building","building"),finishAction:ca})},ja=function(a){var c=b("."+a.target.className).parents(".jssb-y").length>0;c||E[0].blur()},ka=function(a){if(a)for(var b,c,d,e=a;c=e.pop();)for(d in c){if(b=x[d],!b)return;b.apply(this,c[d])}},la=function(){d.menuOpen=!1},ma=function(){d.menuOpen=!0},na=function(){x=d.richTextEditor,x||(x=d.richTextEditor={}),d.editorId=A,d.menuOpen=!1,d.toggleActionMenu=ea,x.quote=ga,x.valid=!1,x.getBBCode=H,x.maxLength=x.maxLength||q,x.setContent=G,x.setContentFromBB=M,y=e.matchesId.bind(this,A,!0,ja),b(window).on("mousedown",y),d.$on("$destroy",function(){a.$broadcast(n.RICH_TEXT_EDITOR_MENU_HIDE,{editorId:A}),b(window).off("mousedown",y)}),E.on("blur",function(){L()}),G(),ia(),d.$watch("richTextEditor.tasks",function(a){ka(a)},!0),d.$watch("richTextEditor.HTML",function(){K()}),d.$on(n.RICH_TEXT_EDITOR_MENU_ACTION,fa),d.$on(n.RICH_TEXT_EDITOR_MENU_HIDE,la),d.$on(n.RICH_TEXT_EDITOR_MENU_SHOW,ma)};na()}}}])}),define("directives/RichTextEditorMenuDirective",["app","battlecat","helper/dom","helper/bbcode"],function(a,b,c,d){a.directive("richTextEditorMenu",["$rootScope","$timeout","$filter","eventTypeProvider","modelDataService","windowManagerService",function(a,e,f,g,h,i){var j="directive_rich_text_editor",k="rich-text-editor-menu",l=d.FONT_SIZES,m=d.LINK_TYPES,n=[["ffffff","ffd1d1","aee7ff","c0ffd0","ffe7cf","fff9a1","ffdaee","ffd5b6","dfceff","cde4ff","d8dcff","ffcff8"],["dfdfdf","e21f1f","03709d","0a8028","aa6b2b","ffee00","b2146b","d96a19","5c32a9","47617f","0111af","d315b6"],["646464","980e0e","014a69","04571a","7f5122","7b730c","870d50","a44c0b","452483","2a3e55","000b74","9d0886"],["000000","730202","00293a","02350f","572412","494500","6a043e","723305","2f1460","152232","000645","6c055b"]];return{scope:!0,link:function(d,o){var p,q,r=function(a){d.coordinates||(d.coordinates={});var b=a;b||(b={}),d.coordinates.x=b.x||0,d.coordinates.y=b.y||0},s=function(a){d.show=!!a,p&&e(function(){d.show?(b(window).off("click",q),b(window).on("click",q)):b(window).off("click",q)})},t=function(a){d.menuName=a},u=function(b){var c=Array.prototype.slice.call(arguments,1),d={args:c,editorId:p};b&&(b.stopPropagation(),b.preventDefault()),s(!1),a.$broadcast(g.RICH_TEXT_EDITOR_MENU_ACTION,d)},v=function(a,b){b&&b.editorId?b.editorId===p&&s(!1):s(!1)},w=function(d,e){if(e&&e.triggerElement&&e.menuName&&e.editorId){p!==e.editorId&&(p=e.editorId,q=c.matchesId.bind(this,[k,p,"select-field"],!0,function(){a.$broadcast(g.RICH_TEXT_EDITOR_MENU_HIDE,void 0,{editorId:p})}));var f=b(e.triggerElement),h=f.offset(),i={x:h.left+h.width/2,y:h.top};s(!0),t(e.menuName),r(i)}},x=function(a){u(void 0,a)},y=function(a){u(void 0,a)},z=function(b){var c,e,g=b;g||(g=m.autocomplete[0]),c=g===m.URL,g===m.report?(e=a.$new(),e.rteReportPicker=!0,e.rteOnReportSelected=x,s(!1),i.getScreenWithInjectedScope("report_list",e)):(delete d.autoComplete.byCoordinates,d.selectedLinkExternal=c,d.selectedLinkType=g,c||(d.autoComplete.type=g,d.autoComplete.placeholder=f("i18n")(g+"_search_placeholder",a.loc.ale,j)))},A=function(){d.autoComplete.byCoordinates=!d.autoComplete.byCoordinates,d.autoComplete.placeholder=f("i18n")(d.autoComplete.byCoordinates?"village_search_by_coordinates_placeholder":"village_search_placeholder",a.loc.ale,j),d.autoComplete.tooltip=d.autoComplete.byCoordinates?f("i18n")("village_search_by_coordinates_tooltip",a.loc.ale,j):"",d.autoComplete.clear()},B=function(){var a=h.getGameData();a&&(d.buildingPairs=Object.keys(a.getBuildings()).reshape(2),d.unitPairs=a.getOrderedUnitNames().reshape(2)),d.textObject=j,d.colorPalettes=n,d.finishAction=u,d.fontSizes=l.toHTML,d.selectLinkType=z,d.linkTypes=m,d.toggleVillageSearch=A,d.$on(g.RICH_TEXT_EDITOR_MENU_SHOW,w),d.$on(g.RICH_TEXT_EDITOR_MENU_HIDE,v),d.autoComplete={onEnter:y},d.$on("$destroy",function(){q&&b(window).off("click",q)}),z(),r()};d.$on("DONE",B)}}}])}),define("directives/SlotMachineDirective",["app","angular","conf/conf","helper/time"],function(a,b,c,d){a.directive("slotMachine",["$interval","$timeout","$rootScope","$filter","modelDataService","eventTypeProvider","iconAnimationsService","windowManagerService",function(a,d,e,f,g,h,i,j){return{templateUrl:c.DIRECTIVE_TEMPLATE_PATH_EXT.join("slot_machine"),name:"slotMachine",scope:{slotMachine:"=slotMachine"},link:function(f){var h,k,l,m,n,o=g.getGameData(),p={regular:1,jackpot:2,"super jackpot":3},q={none:"regular",regular:"jackpot","super":"super jackpot"},r=function(a,b){return a.filter(function(a){return a.slot===b})[0]},s=function(a){return a?Math.floor(f.slotMachine.provisions/o.getUnit(a).food):void 0},t=function(){var a;for(f.rollUnavailable=!0,f.rollWaitUntilTomorrow=!1,f.rollLevelRequirement=!1,f.rollUnavailableMulti=!1,a=0;a<f.maxDealCount;a++)0!==f.slotSettings[a].purchased||f.slotSettings[a].locked||(f.rollUnavailable=!1),f.slotSettings[a].purchased>0&&(f.rollWaitUntilTomorrow=!0),f.slotSettings[a].locked&&(f.rollLevelRequirement=!0);f.rollUnavailable&&f.rollWaitUntilTomorrow&&f.rollLevelRequirement&&(f.rollUnavailableMulti=!0)},u=function(a){var b="regular";if(a.length)try{b=a.reduce(function(a,b){return p[a.type]>p[b.type]?a:b}).type.replace(" ","_")}catch(c){}return f.slotMachine.dealLevel=b!==q.none?"_"+b:"",b},v=function(a,b){var c,d,e,g=[],h=[];if(a.offers.length)g=a.offers;else{d=Object.keys(a.offers);for(e in d)a.offers.hasOwnProperty(d[e])&&g.push(a.offers[d[e]])}for(e=g.length;e--;)c=g[e],b[c.slot-1]={unitName:c.unit_type||c.unitName,unitAmount:c.amount,type:q[c.jackpot],slot:c.slot},c.purchased||h.push({type:q[c.jackpot]}),f.slotSettings[c.slot-1].purchased=c.purchased,f.slotSettings[c.slot-1].missingProvisions=0===s(c.unit_type||c.unitName);if(u(h),t(),g.length<f.maxDealCount)for(e=0;e<f.maxDealCount;e++)b[e]||(b[e]={slot:e+1,placeholder:!0,done:!0})},w=function(){return Math.max(0,n-(new Date).getTime()-c.csDiff)/1e3},x=function(a){var b;if("closeWindow"!==a)for(b=0;b<f.maxDealCount;b++)f.slotSettings[b].hide=!1},y=function(a){return a.done&&!a.placeholder||f.slotSettings[a.slot-1].purchased>0},z=function(){f.rerollDelay=!1},A=function(){f.rerollDelay=!0,d(z,2e3)},B=function L(){var c,d,e,g,h=f.slotSettings;if(f.roll=!0,0===--f.currentAnimationCount["speed"+f.speed+"RunCount"]){if(f.speed+=f.acceleration,f.speed>f.maxSpeed&&(f.speed=f.maxSpeed-1,f.acceleration=-f.acceleration,f.currentAnimationCount={speed1RunCount:f.animationConfig.speed1RunCount,speed2RunCount:f.animationConfig.speed2RunCount,speed3RunCount:f.animationConfig.speed3RunCount,speed4RunCount:f.animationConfig.speed4RunCount}),a.cancel(f.timerFnRef),!f.currentAnimationCount.hasOwnProperty("speed"+f.speed+"RunCount"))return f.roll=!1,f.rerolledDeals=[],void x();f.timerFnRef=a(L,f.animationConfig["speed"+f.speed])}for(g=0;g<f.maxDealCount;g++)c=f.finalDeals[g],d=null,f.acceleration>0?h[c.slot-1].purchased>0||c.placeholder||(d=b.copy(f.deals.random()),d.slot=c.slot):f.speed<=f.maxDealCount&&(e=f.maxSpeed-f.speed,c.done||h[c.slot-1].purchased>0||(c.slot>e-1?(d=b.copy(f.deals.random()),d.slot=c.slot):c.slot===e-1&&(d=b.copy(r(f.rerolledDeals,e-1)),d?(d.done=!0,h[d.slot-1].missingProvisions=0===s(d.unitName),h[d.slot-1].hide=!1):(f.roll=!1,a.cancel(f.timerFnRef),f.slotMachine.methods.getData())))),d&&(f.finalDeals[g]=d);f.dealCount===f.finalDeals.filter(y).length&&(f.roll=!1,a.cancel(f.timerFnRef))},C=function(){f.currentAnimationCount={speed1RunCount:f.animationConfig.speed1RunCount,speed2RunCount:f.animationConfig.speed2RunCount,speed3RunCount:f.animationConfig.speed3RunCount,speed4RunCount:f.animationConfig.speed4RunCount,speed5RunCount:f.animationConfig.speed5RunCount},f.speed=1,f.acceleration=1,f.maxSpeed=5,f.roll=!0,f.timerFnRef=a(B,f.animationConfig["speed"+f.speed])},D=function(){var a,b;if(!(f.roll||f.rollUnavailable||f.rerollDelay)){for(f.rerolledDeals=[],a=f.finalDeals.length-1;a>=0;a--)b=f.finalDeals[a],f.slotSettings[b.slot-1].purchased>0||(f.slotSettings[b.slot-1].hide=!0);f.slotMachine.methods.buyReroll(f.rerolledForFree)}},E=function(){f.waitForResponse=!0},F=function(a){var b,c=f.slotSettings[a.slot-1],d=s(a.unit_type||a.unitName);c.locked||c.purchased>=f.purchaseLimit||c.missingProvisions||f.waitForResponse||(d<a.unitAmount?(b=e.$new(),b.textObject=f.textObjectView,b.textObjectData=f.textObjectData,b.maxRecruitable=d,b.unitName=a.unit_type||a.unitName,b.confirm=function(){f.slotMachine.methods.buyItem(a.slot,E),b.closeWindow()},j.getModal("modal_confirm_daily_unit_deal",b)):f.slotMachine.methods.buyItem(a.slot,E))},G=function(b,c){var d,e,g;if(c.village_id===f.slotMachine.villageId){for(f.roll&&(a.cancel(f.timerFnRef),f.roll=!1),f.rerolledForFree=c.rerolled,f.finalDeals=[],f.dealCount=0,f.maxDealCount=f.slotMachine.dealCount,f.slotSettings={},g=0;g<f.maxDealCount;g++)f.slotSettings[g]={purchased:0,locked:!0,missingProvisions:!1};for(e=f.slotMachine.level,g=0;g<f.maxDealCount;g++)d=f.levelRequirement[g],e>=d&&(f.dealCount++,f.slotSettings[g].locked=!1);v(c,f.finalDeals)}},H=function(a,b){var c,e;if(b.village_id===f.slotMachine.villageId&&b.offers.length){for(c=0;c<b.offers.length;c++)e=b.offers[c],"none"!==e.jackpot&&d(A,1500+400*(c+1));f.rerolledForFree=!0,v(b,f.rerolledDeals=[])}},I=function(a,b){var c;b.village_id===f.slotMachine.villageId&&(f.waitForResponse=!1,c=r(f.finalDeals,b.slot),f.slotSettings[b.slot-1].purchased++,t(),i.createAnimations(["unit-"+c.unitName]),u(f.finalDeals.filter(function(a){return!(b.slot===a.slot||f.slotSettings[a.slot-1].purchased)})))},J=function(a,b){var c,d,e;if(b.villageId===f.slotMachine.villageId)for(f.slotMachine.provisions=b.resources.food,c=f.finalDeals,e=0;e<c.length;e++)d=c[e],d.placeholder||(f.slotSettings[e].missingProvisions=0===s(d.unitName))},K=function(){var a;for(f.textObjectView=f.slotMachine.textObjects.view,f.textObjectData=f.slotMachine.textObjects.data,n=new Date,n.setHours(24,0,0,0),n=n.getTime(),f.rerollCost=f.slotMachine.costs.reroll,f.slotCost=f.slotMachine.costs.slot,f.getTimeUntilAutomaticReroll=w,f.reroll=D,f.buyItem=F,f.blurSupport="webkit"===$.browser.vendor,f.dealTypes=q,f.deals=[],a=0;a<f.slotMachine.possibleData.length;a++)f.deals.push({unitName:f.slotMachine.possibleData[a].name,unitAmount:Math.floor(212*Math.random()),type:q.none});f.finalDeals=[],f.rerolledDeals=[],f.animationConfig={speed1RunCount:1,speed2RunCount:1,speed3RunCount:5,speed4RunCount:1,speed5RunCount:1,speed1:500,speed2:300,speed3:100,speed4:100,speed5:100},f.levelRequirement=f.slotMachine.levelRequirements,f.purchaseLimit=f.slotMachine.slotPurchaseLimit,h&&h(),h=f.$on(f.slotMachine.events.setData,G),k&&k(),k=f.$on(f.slotMachine.events.updateData,H),l&&l(),l=f.$on(f.slotMachine.events.acceptedOffer,I),m&&m(),m=f.$on(f.slotMachine.events.updateResources,J),f.slotMachine.rerollAnimation=C,window.rerollAnimation=C,f.slotMachine.resetSlotActionVisibility=x,f.slotMachine.level>=f.slotMachine.levelRequirements[0]&&f.slotMachine.methods.getData()};f.slotMachine.init=K,K()}}}])}),define("directives/TranslatedLinkDirective",["app","conf/conf"],function(a,b){a.directive("translatedLink",["$compile",function(a){var c="zz"===b.MARKET;return{scope:!0,link:function(b,d,e){var f=void 0!==e.translatedLinkForum,g=function(){var a=e.translatedLink;return f&&c?a.replace("en","beta"):a},h=function(){return e.translatedLink},i=function(){e.$set("href",g())},j=function(a){a&&(a.stopPropagation(),a.preventDefault()),window.open(g(),"_blank")};b.open=j,e.ngClick?b.$watch(h,i):(e.$set("ngClick","open($event)"),a(d)(b))}}}])}),define("directives/HotkeyMDirective",["app","angular"],function(a,b){a.directive("hotkeym",["hotkeyManagerService",function(a){return{restrict:"A",link:function(c,d,e){var f,g;b.forEach(c.$eval(e.hotkeym),function(b,d){g="string"==typeof e.hotkeyallowin?e.hotkeyallowin.split(/[\s,]+/):[],f=d,a.addKey(c,d,e.hotkeyDescription,b,g)}),c.$on("$destroy",function(){a.removeKey(c,f)})}}}])}),define("directives/ComponentDirective",["app","conf/conf"],function(a,b){a.directive("component",["templateManagerService",function(a){var b="components/";return{scope:{src:"=",params:"="},link:function(c,d){a.compile(b+c.src,c,function(a){var b,c=$(a).find(".content"),e=$(d).children();for(b=0;b<e.length;b++)c.append(e[b]);$(d).append(a)})}}}])}),define("directives/CharacterAnimateDirective",["app"],function(a){a.directive("characterAnimate",["$timeout",function(a){var b=180,c=2e3,d=10;return{link:function(e,f){var g,h=0,i=function(b,c){e[b]=!0,a(function(){e[b]=!1},c)},j=function(){h++,h>=d&&(h=0,i("crazyEyes",c)),i("closedEyes",b)},k=function n(){var c=15e3,d=2e3,e=parseInt(Math.random()*(c-d)+d,10);g=a(function(){i("closedEyes",b),n()},e)},l=function(){a.cancel(g)},m=function(){k()};e.blinkEyes=j,e.$on("$destroy",l),m()}}}])}),define("directives/QuestGoalIndicatorDirective",["app"],function(a){a.directive("questGoal",["$rootScope","modelDataService","$compile","eventTypeProvider",function(a,b,c,d){var e="icon-70x70-quest-indicator",f=['<span class="size-70x70 '+e+"\" tooltip tooltip-content=\"{{ 'have_building_level'| i18n:loc.ale:'quests_goal_progress':("," | number):( building.name | i18n:loc.ale:'building_names')}}\"></span>"],g=function(a,d,g){var h=b.getQuestLineListModel(),i=h.getQuestLineModels();i.forEach(function(b){b.getQuestModels().forEach(function(b){b.closed||b.rewarded||b.getGoals().forEach(function(b){if(g.level){var h=$(a[0]).find("."+e);if(b.building_type===g.level)if(d.building.level<b.limit){if(!h.length)return void a.append(c(f.join(b.limit))(d))}else h.remove()}})})})};return{restrict:"A",scope:!0,link:function(a,b,c){var e=a.$eval(c.questGoal),f=function(){g(b,a,e)};f(),a.$on(d.QUESTS_QUEST_PROGRESS,f),a.$on(d.QUESTS_QUEST_LINE_STARTED,f),a.$on(d.QUESTS_QUEST_PROGRESS,f),a.$on(d.QUESTS_QUEST_FINISHED,f),e.level&&a.$on(d.BUILDING_LEVEL_CHANGED,f)}}}])}),define("directives/directives",["conf/conf","directives/ngVisibleDirective","directives/ngTranslateDirective","directives/ngEmbeddedIncludeDirective","directives/ngRepeatFinishedDirective","directives/RangeSliderDirective","directives/SwitchSliderDirective","directives/BindEventDirective","directives/ForceModelUpdateDirective","directives/TooltipElementDirective","directives/TooltipDirective","directives/SelectElementDirective","directives/SelectDirective","directives/LoadingScreen","directives/ScrollbarDirective","directives/InfiniteScrollDirective","directives/UnitScreenTableDirective","directives/ResearchesDirective","directives/UnitOperateSliders","directives/PaginationDirective","directives/AutoCompleteDirective","directives/IconGeneratorDirective","directives/FocusDirective","directives/ContentSliderDirective","directives/TextareaGrowDirective","directives/MessageDirective","directives/PlaceholderDirective","directives/ScrollToDirective","directives/IframeOnloadDirective","directives/WorldMapSearchDirective","directives/AudioDirective","directives/RichTextDirective","directives/RichTextReportDirective","directives/RichTextInternalLinkDirective","directives/RichTextExternalLinkDirective","directives/RichTextSpoilerDirective","directives/RichTextEditorDirective","directives/RichTextEditorMenuDirective","directives/SlotMachineDirective","directives/TranslatedLinkDirective","directives/AudioDirective","directives/HotkeyMDirective","directives/ComponentDirective","directives/CharacterAnimateDirective","directives/QuestGoalIndicatorDirective"],function(a){
a.DEBUG}),define("models/GenericJobListModel",[],function(){var a=function(){};return a.prototype.requiredProperties=["id","type","returning","startedAt","completedAt","startVillageId","startVillageName","startX","startY","targetVillageId","targetVillageName","targetX","targetY"],a.prototype.validateModel=function(a){var b;for(b=0;b<this.requiredProperties.length;b++)if(void 0===a[this.requiredProperties[b]])throw new Error("Invalid model")},a.prototype.getModels=function(){return this.flush(),this.models},a.prototype.flush=function(a){for(var b,c=this.models,d=a||Date.now(),e=c.length,f=!1;e--;)b=c[e],b.completedAt<d&&(this.removeModel(b),f=!0);return f},a.prototype.createModels=function(a){if(a&&a.length){for(var b=a.length;b--;)this.createModel(a[b]);return this.getModels()}},a.prototype.createModel=function(){throw new Error("Implement me in the inheriting prototype.")},a.prototype.addModel=function(a){return this.validateModel(a),this.has(a)?void 0:(this.models.push(a),a)},a.prototype.removeModel=function(a){var b=this.models.indexOf(a);return b>-1?(this.models.remove(b),!0):!1},a.prototype.removeId=function(a){var b;for(b=0;b<this.models.length;b++)if(this.models[b].id===a)return this.models.remove(b),!0;return!1},a.prototype.has=function(a){var b;for(b=0;b<this.models.length;b++)if(this.models[b].id===a.id)return!0;return!1},a}),define("models/GameDataResearchesModel",[],function(){var a=function b(a){this.data=a,this.buildings={};var c,d;for(c in a)d=a[c],this.buildings[d.building]=this.buildings[d.building]||{},this.buildings[d.building][c]=d;b.prototype.forBuilding=function(a){return this.buildings[a]||null}};return a}),define("models/BuildingDataModel",[],function(){var a=function(a){this.data=a};return a.prototype.getDataForBuilding=function(a){return this.data[a]||null},a.prototype.getResearches=function(){var a,b={};for(a in this.data)b[a]=this.data[a].researches;return b},a.prototype.setLevelForBuilding=function(a,b){var c=this.getDataForBuilding(a);if(!c)throw new Error("Could not load building data for '"+a+"'");c.level=b,c.upgradingLevels&&(c.upgradingLevels=Math.max(c.upgradingToLevel-b,0),c.nextCalculatedLevel=c.level+c.upgradingLevels+1)},a.prototype.setUpgrading=function(a,b){var c=this.getDataForBuilding(a);if(null===c)throw new Error("Could not get building data for building "+a);c.upgradingLevels=b-c.level,c.upgradingLevels&&(c.upgradingToLevel=b,c.nextCalculatedLevel=c.upgradingToLevel+1)},a.prototype.resetUpgrading=function(){var a;for(a in this.data)this.data.hasOwnProperty(a)&&(this.data[a].upgradingLevels=0,this.data[a].nextCalculatedLevel=this.data[a].level+1)},a.prototype.getData=function(){return this.data},a.prototype.positions={clay_pit:[620,1520],timber_camp:[2199,1490],wall:[1311,1332],academy:[597,924],church:[1194,940],chapel:[1194,1e3],market:[878,959],tavern:[878,1201],warehouse:[1557,1250],rally_point:[1912,1144],hospital:[2205,888],preceptory:[917,648],barracks:[1617,715],farm:[2136,398],iron_mine:[603,325],statue:[1853,1e3],headquarter:[1369,564]},a.prototype.getPosition=function(a){return this.positions[a]},a}),define("models/RecruitJobModel",["models/GenericJobModel","helper/time","conf/recruitingQueueTypes"],function(a,b,c){var d="parallel",e=function(a){this.data=a,this.id=a.job_id,this.unitType=a.unit_type,this.amount=a.amount,this.recruited=a.recruited,this.type=a.type||c.getQueueTypeByUnitType(this.unitType),this.timePerUnit=a.time_per_unit,this.parallel=a.queue_type===d,this.villageId=a.village_id,this.waiting=a.waiting||!1,Object.defineProperty(this,"startedAt",{get:function(){return b.server2ClientTime(this.data.start_time)}}),Object.defineProperty(this,"lastUpdatedAt",{get:function(){return b.server2ClientTime(this.data.last_update)}}),Object.defineProperty(this,"completedAt",{get:function(){return b.server2ClientTime(this.data.time_completed)}}),Object.defineProperty(this,"duration",{get:function(){return this.completedAt-this.startedAt}}),Object.defineProperty(this,"eta",{get:function(){return Math.max(0,(this.completedAt-Date.now())/1e3)}}),Object.defineProperty(this,"finishedAt",{get:function(){return this.completedAt}})};return e.inherits(a),e.prototype.update=function(a){this.data=a,this.amount=a.amount,this.recruited=a.recruited,this.timePerUnit=a.time_per_unit,this.parallel=a.queue_type===d,delete this.clientRecruitingStartTime},e}),define("models/RecruitJobListModel",["models/RecruitJobModel"],function(a){var b="parallel",c=function(a,b){return a.completedAt-b.completedAt},d=function(a){return a.parallel||a.queue_type===b},e=function(a){return!(a.parallel||a.queue_type===b)},f=function(b){return b instanceof a},g=function(a){if(this.parent=null,a&&!a.every(f))throw new TypeError;Object.defineProperty(this,"parallelJobs",{get:function(){return this.jobs.filter(d)}}),Object.defineProperty(this,"serialJobs",{get:function(){return this.jobs.filter(e)}}),Object.defineProperty(this,"jobs",{value:a||[]}),Object.defineProperty(this,"length",{get:function(){return this.jobs.length}})};return g.prototype.updateParent=function(){this.parent&&this.parent.update()},g.prototype.getJobIndex=function(a){if(!f(a))throw new TypeError("Not a RecruitJobModel!");return this.jobs.indexOf(a)},g.prototype.getRecruitJobById=function(a){for(var b=this.jobs,c=b.length;c--;)if(b[c].id===a)return b[c];return null},g.prototype.addRecruitJob=function(b){f(b)||(b=new a(b)),this.jobs.push(b),this.updateParent(),this.jobs.sort(c)},g.prototype.updateRecruitJob=function(b){var d,e;if(f(b)){for(e=this.jobs.length;e--;)if(this.jobs[e].id===b.id)return this.jobs.splice(e,1,b),this.jobs.sort(c),void this.updateParent();this.addRecruitJob(b)}else{if(d=this.getRecruitJobById(b.job_id))return d.update(b),this.jobs.sort(c),void this.updateParent();this.addRecruitJob(new a(b))}},g.prototype.removeRecruitJob=function(a){for(var b=this.jobs,c=b.length;c--;)if(b[c].id===a)return b.remove(c),this.updateParent(),!0;return!1},g.prototype.getAmountOfUnitType=function(a){var b,c,d=0;for(c=0;c<this.jobs.length;c++)b=this.jobs[c],b.unitType===a&&(d+=b.amount-(b.totalRecruited||0));return d},g}),define("models/RecruitJobListsContainerModel",["models/RecruitJobListModel","conf/recruitingQueueTypes"],function(a,b){var c=function(a,b){return a.completedAt-b.completedAt},d=function(a,b){return a.startedAt-b.startedAt},e=function(e){if(!e)throw new TypeError("no queues");var f,g,h,i={};for(f in b)if(g=b[f],g&&e[g]){if(!(e[g]instanceof a))throw new TypeError("not a RecruitJobListModel");i[g]=e[g],i[g].parent=this}Object.defineProperty(this,"queues",{value:i}),Object.defineProperty(this,"combined",{get:function(){var a;if(!h){h=[];for(a in i)i[a]&&(h=h.concat(i[a].jobs));h.sort(d),h.sort(c)}return h}}),this.update=function(){h=null}};return e.prototype.TYPES={BARRACKS:b.BARRACKS,ACADEMY:b.ACADEMY,PRECEPTORY:b.PRECEPTORY,STATUE:b.STATUE},e.prototype.addRecruitJob=function(b,c){this.queues[b]=this.queues[b]||new a,this.queues[b].addRecruitJob(c)},e.prototype.removeRecruitJob=function(a){var b,c,d=this.queues;for(b in d)if(c=d[b].removeRecruitJob(a))return!0;return!1},e.prototype.getRecruitJobById=function(a){var b,c,d=this.queues;for(b in d)if(c=d[b].getRecruitJobById(a))return c;return null},e}),define("models/VillageModel",["models/BuildingDataModel","models/BuildingQueueModel","models/CommandListModel","models/RecruitJobListModel","models/RecruitJobListsContainerModel"],function(a,b,c,d,e){var f=function(a,b){this.data=a,this.data.resourceModel=b,this.jobListsContainer=new e({barracks:new d,academy:new d,preceptory:new d,statue:new d}),this.data.unitInfo={},this.data.computedLoyalty=this.data.loyalty,this.data.computedLoyaltyDisplayValue=this.data.loyalty};return f.prototype.getId=function(){return this.data.villageId},f.prototype.setId=function(a){this.data.villageId=a},f.prototype.getProvinceId=function(){return this.data.province_id},f.prototype.getKingdomId=function(){return this.data.continent_id},f.prototype.getName=function(){return this.data.name},f.prototype.setName=function(a){this.data.name=a},f.prototype.getX=function(){return this.data.x},f.prototype.getY=function(){return this.data.y},f.prototype.setPosition=function(a,b){this.data.x=a,this.data.y=b},f.prototype.getPosition=function(){return{x:this.getX(),y:this.getY()}},f.prototype.getFlags=function(){return this.data.flags||null},f.prototype.getResources=function(){return this.data.resourceModel||null},f.prototype.getBuildingData=function(){return this.data.buildingData||null},f.prototype.setBuildingData=function(b){if(!(b instanceof a))throw new TypeError("buildingDataModel must be an instance of BuildingDataModel!");this.data.buildingData=b},f.prototype.getBuildingQueue=function(){return this.data.buildingQueue||null},f.prototype.setBuildingQueue=function(a){if(!(a instanceof b))throw new TypeError("buildingQueueModel must be an instance of BuildingQueueModel!");this.data.buildingQueue=a},f.prototype.getBuildingLevel=function(a){return this.getBuildingData().getDataForBuilding(a).level},f.prototype.getBuildingResearch=function(a,b){var c,d,e=this.getBuildingData();if(e&&(c=e.getDataForBuilding(a),c&&(d=c.researches)))return d[b]},f.prototype.setUnitInfo=function(a){this.data.unitInfo.units=a.available_units},f.prototype.getUnitInfo=function(){return this.data.unitInfo},f.prototype.getUnitInfoFor=function(a){return this.data.unitInfo.units[a]},f.prototype.getUnitCountInTown=function(){var a,b=this.data.unitInfo.units,c=0;for(a in b)b.hasOwnProperty(a)&&b[a].in_town&&(c+=b[a].in_town);return c},f.prototype.setRecruitingQueues=function(a){var b,c;for(b in a)if(!a[b],a[b]instanceof Array)for(c=a[b].length;c--;)this.jobListsContainer.queues[b].updateRecruitJob(a[b][c])},f.prototype.getRecruitingQueue=function(a){return this.jobListsContainer.queues[a]||null},f.prototype.getRecruitingQueues=function(){return this.jobListsContainer.queues},f.prototype.getRecruitJobListsContainer=function(){return this.jobListsContainer},f.prototype.getRecruitJobById=function(a){return this.jobListsContainer.getRecruitJobById(a)},f.prototype.addRecruitJob=function(a,b){this.jobListsContainer.addRecruitJob(a,b)},f.prototype.removeRecruitJob=function(a){var b,c,d=this.getRecruitingQueues();for(b in d)if(c=d[b].removeRecruitJob(a))return!0;return!1},f.prototype.setPresets=function(a){var b=this;this.data.presets?a.forEach(function(a){for(var c=b.data.presets.length;c--;)if(b.data.presets[c].id===a.id)return b.data.presets[c].name=a.name,b.data.presets[c].icon=a.icon,b.data.presets[c].units=a.units,void(b.data.presets[c].officers=a.officers);b.data.presets.push(a)}):this.data.presets=a.concat()},f.prototype.getPresets=function(){return this.data.presets||[]},f.prototype.deletePreset=function(a){for(var b=this.data.presets.length;b--;)if(this.data.presets[b].id===a)return void this.data.presets.remove(b)},f.prototype.getPreset=function(a){for(var b=this.data.presets.length;b--;)if(this.data.presets[b].id===a)return this.data.presets[b];return!1},f.prototype.assignPresets=function(a){for(var b=this.data.presets.length;b--;)a.indexOf(this.data.presets[b].id)<0&&this.data.presets.remove(b)},f.prototype.setTimeline=function(a){this.data.timeline=a},f.prototype.getTimeline=function(){return this.data.timeline||null},f.prototype.setTradeListModel=function(a){if(void 0!==this.data.trades)throw new Error("Can not redefine TradeListModel");return this.data.trades=a},f.prototype.getTradeListModel=function(){return this.data.trades},f.prototype.setCommandListModel=function(a){this.data.commands=a},f.prototype.getCommandListModel=function(){return this.data.commands||(this.data.commands=new c([],this.getId()))},f.prototype.getSelectedOrder=function(){return this.data.preceptory_order},f.prototype.setSelectedOrder=function(a){this.data.preceptory_order=a},f.prototype.getEffectList=function(){return this.data.effectList},f.prototype.getLoyalty=function(){return this.data.loyalty},f.prototype.setLoyalty=function(a){this.data.loyalty=a,this.setComputedLoyalty(a)},f.prototype.getComputedLoyalty=function(){return this.data.computedLoyalty},f.prototype.setComputedLoyalty=function(a){this.data.computedLoyalty=a,this.data.computedLoyaltyDisplayValue=~~a},f}),define("models/EffectModel",["helper/time"],function(a){var b=function(a){this.data=a,this.type=a.type,this.id=a.effect_id,this.details=a.details,this.setTimeCompleted(a.time_completed)};return b.prototype.setTimeCompleted=function(b){return b?void(this.timeCompleted=a.server2ClientTime(b)):void(this.timeCompleted=0)},b.prototype.getTimeCompleted=function(){return this.timeCompleted},b.prototype.getDetails=function(){return this.details},b.prototype.getTimeLeft=function(){return Math.max(0,this.timeCompleted-Date.now()||0)},b}),define("models/EffectListModel",["models/EffectModel"],function(a){var b=function(b){var c,d=[];for(c=0;c<b.length;c++)d[c]=new a(b[c]);this.effects=d};return b.prototype.getEffects=function(){return this.effects},b.prototype.getEffectsByType=function(a){var b,c,d=[];for(c=0;c<this.effects.length;c++)b=this.effects[c],b.type===a&&d.push(b);return d},b.prototype.getEffectsByContentName=function(a){var b,c,d=[];for(c=0;c<this.effects.length;c++)b=this.effects[c],b.data.name===a&&d.push(b);return d},b.prototype.getEffectById=function(a){var b,c;for(c=0;c<this.effects.length;c++)if(b=this.effects[c],b.id===a)return b},b.prototype.updateEffect=function(b){var c,d;for(d=0;d<this.effects.length;d++)if(c=this.effects[d],c.id===b.effect_id)return this.effects[d]=new a(b),!0;return!1},b.prototype.addEffect=function(b){this.updateEffect(b)||this.effects.push(new a(b))},b.prototype.removeEffect=function(a){var b,c;for(c=0;c<this.effects.length;c++)b=this.effects[c],b.id===a&&this.effects.splice(c,1)},b}),define("models/TradeModel",["models/GenericJobModel","helper/time"],function(a,b){var c,d=["wood","clay","iron"],e=function(a){var e,f,g,h=0;for(this.validate(a),this.jobType="trading",this.id=a.transport_id,this.returning="return"===a.type,this.type=this.jobType+"_"+a.type,this.startedAt=b.server2ClientTime(a.time_start),this.completedAt=b.server2ClientTime(a.time_completed),this.duration=this.completedAt-this.startedAt,this.startVillageId=a.start_village_id,this.startVillageName=a.start_village_name,this.startX=a.start_x,this.startY=a.start_y,this.targetVillageId=a.target_village_id,this.targetVillageName=a.target_village_name,this.targetX=a.target_x,this.targetY=a.target_y,this.maxCancelTime=b.inMS.fiveMin,this.merchantAmount=a.merchant_amount,this.destination=this.returning?this.startVillageName:this.targetVillageName,this.resourceAmount=0,e=0;e<d.length;e++)c=d[e],f=a["res_"+c],f&&(h++,g=c,this.resourceAmount+=f);this.resourceType=h>1?"multi":g};return e.inherits(a),e.prototype.validate=function(a){if(void 0===a.transport_id||void 0===a.type||void 0===a.time_start||void 0===a.time_completed||void 0===a.start_village_id||void 0===a.start_village_name||void 0===a.start_x||void 0===a.start_y||void 0===a.target_village_id||void 0===a.target_village_name||void 0===a.target_x||void 0===a.target_y)throw new Error("Improper data for TradeModel")},e}),define("models/TradeListModel",["models/GenericJobListModel","models/TradeModel"],function(a,b){var c=function(a){this.models=[],this.villageId=a};return c.inherits(a),c.prototype.createModel=function(a){var c=new b(a);(c.startVillageId===this.villageId||c.targetVillageId===this.villageId)&&this.addModel(c)},c}),define("models/FriendListModel",["models/Contact"],function(a){var b=function(b){return b instanceof a},c=function(a){if(a&&(!a.character.every(b)||!a.tribe.every(b)))throw new TypeError;this.list=a||{character:[],tribe:[]}};return c.prototype.has=function(a){return this.list[a.type].some(function(b){return b.id===a.id})},c.prototype.add=function(b){if(!(b instanceof a))throw new TypeError;return this.has(b)||this.list[b.type].push(b),this},c.prototype.remove=function(a){for(var b=this.list[a.type].length;b--;)if(this.list[a.type][b].id===a.id)return this.list[a.type].remove(b),this;return this},c}),define("models/InventoryModel",[],function(){var a=["premium_package","reward_resources","reward_units","reward_resource_package","effect"],b=function(a){var b,c,d=[],e=a.length;for(b=0;e>b;b++)c=~~(b/2),d[c]=d[c]||[],d[c].push(a[b]);return d},c=function(b){var c,d=0;if(b.type===a[1])for(c in b.content)b.content[c]>0&&d++;d>1&&(b.type=a[3])},d=function(d){var e=this;this.items={},d.forEach(function(b){return-1!==a.indexOf(b.type)?(c(b),e.items[b.type]=e.items[b.type]||[],void e.items[b.type].push(b)):void(e.items[b.type]=b)}),this.twoColumnList=b(this.getInventoryItems())};return d.prototype.getInventoryItemReference=function(){return this.items},d.prototype.get2ColumnInventoryItemList=function(){return this.twoColumnList},d.prototype.getItemAmountByType=function(a,b){var c,d,e,f,g=0;if(!this.items[a])return 0;try{d=this.getItemByType(a),g=d.amount>0?d.amount:0}catch(h){for(c=this.items[a],e=c.length,f=0;e>f;f++)if(d=c[f],d.name===b||d.content.name===b)return d.amount>0?d.amount:0}return g},d.prototype.hasItem=function(a){return this.items[a]?this.getItemByType(a).amount>0:!1},d.prototype.hasAnyItem=function(a){return[].slice.call(arguments).some(this.hasItem.bind(this))},d.prototype.getItemByType=function(b){if(-1!==a.indexOf(b))throw new Error("Meh ... thats an edge case ....");return this.items[b]||null},d.prototype.getNewItemCount=function(){var a,b,c=this.getInventoryItems(),d=c.length,e=0;for(b=0;d>b;b++)a=c[b],a.amount>a.last_amount&&e++;return e},d.prototype.getInventoryItems=function(){var b,c,d=[],e=this;for(b in this.items)c=this.items[b],-1===a.indexOf(b)&&d.push(c);return a.forEach(function(a){e.items[a]&&e.items[a].length&&(d=d.concat(e.items[a]))}),d.filter(function(a){return a.amount>0})},d.prototype.getSpecialItemIndexById=function(a,b){var c,d;if(!this.items[a])return null;for(c=this.items[a].length,d=0;c>d;d++)if(b===this.items[a][d].id)return d;return null},d.prototype.markSeen=function(){var a,b,c=this.getInventoryItems(),d=c.length;for(b=0;d>b;b++)a=c[b],a.last_amount=a.amount},d.prototype.removeFrom2ColumnList=function(a){var b,c,d,e=this.twoColumnList.length;for(b=0;e>b;b++)d=this.twoColumnList[b],d[0]&&d[0].id===a.id?(d.remove(0),c=!0):d[1]&&d[1].id===a.id&&(d.remove(1),c=!0),c&&this.twoColumnList[b+1]&&d.push(this.twoColumnList[b+1].shift());this.twoColumnList[e-1].length||this.twoColumnList.remove(e-1)},d.prototype.addTo2ColumnList=function(a){this.twoColumnList.length&&this.twoColumnList.last().length<2?this.twoColumnList.last().push(a):this.twoColumnList.push([a])},d.prototype.itemChanged=function(d){var e,f=null;if(c(d),-1===a.indexOf(d.type)){if(!d.amount)return delete this.items[d.type],void this.removeFrom2ColumnList(d);this.items[d.type]||(this.items[d.type]={last_amount:0},this.addTo2ColumnList(d));for(e in d)d.hasOwnProperty(e)&&(this.items[d.type][e]=d[e]);this.twoColumnList=b(this.getInventoryItems())}else{if(f=this.getSpecialItemIndexById(d.type,d.id),!d.amount){if(null===f)return;return this.items[d.type].remove(f),void this.removeFrom2ColumnList(d)}if(null===f)return d.last_amount=0,this.items[d.type]=this.items[d.type]||[],this.items[d.type].push(d),void this.addTo2ColumnList(d);for(e in d)d.hasOwnProperty(e)&&(this.items[d.type][f][e]=d[e])}},d}),define("models/TribeInvitationsModel",[],function(){var a=function(a){var b,c;this.invitation={};for(b in a)a.hasOwnProperty(b)&&(c=a[b],this.invitation[c.tribe_id]=c)},b="seenTribeInvitations";return a.prototype.getData=function(){return this.invitation},a.prototype.removeInvitation=function(a){var b;for(b in this.invitation)if(this.invitation[b].id===a){delete this.invitation[b];break}},a.prototype.addInvitation=function(a){this.invitation[a.tribe_id]=a},a.prototype.markAsSeen=function(a){var c=JSON.parse(localStorage.getItem(b))||[],d=Object.keys(this.getData());c=c.concat(a).filter(function(a){return d.indexOf(a.toString())>=0}).map(function(a){return parseInt(a,10)}),localStorage.setItem(b,JSON.stringify(c))},a.prototype.getNewInvitationCount=function(){var a,c=JSON.parse(localStorage.getItem(b)),d=Object.keys(this.getData());return c&&c.length?(a=d.filter(function(a){return c.indexOf(parseInt(a,10))<0}),a.length):d.length},a}),define("models/quest/QuestLineListModel",[],function(){var a=function(a){this.data={questLines:a}};return a.prototype.getQuestLineModels=function(){return this.data.questLines},a.prototype.getQuestById=function(a){var b,c,d,e=this.getQuestLineModels(),f=e.length;for(d=0;f>d;d++)if(b=e[d],c=b.getQuestById(a))return c;return null},a.prototype.removeQuestLineByName=function(a){var b,c,d=this.getQuestLineModels(),e=d.length;for(c=0;e>c;c++)if(b=d[c],a===b.getName())return d.remove(c),!0;return!1},a.prototype.addQuestLineModel=function(a){this.data.questLines.push(a)},a}),define("conf/questTypes",[],function(){return{ICON_MAPPING:{more_special:"default",another_step:"default"},QUEST_PREFIX:"quest-"}}),define("models/quest/QuestLineModel",["conf/questTypes"],function(a){var b=function(a){this.data=a};return b.prototype.setQuestModels=function(a){this.data.quests=a},b.prototype.getName=function(){return this.data.name},b.prototype.getLowerName=function(){return this.getName().toLowerCase()},b.prototype.getIconName=function(){var b,c,d=this.getName().toLowerCase(),e=this.getQuestModels();for(c=0;c<e.length;c++)if(!e[c].isClosed()&&(b=e[c].data.icon))return b.toLowerCase();return a.QUEST_PREFIX+(a.ICON_MAPPING[d]||d)},b.prototype.isRead=function(){return!!this.data.read},b.prototype.getQuestModels=function(){return this.data.quests},b.prototype.getQuestByIndex=function(a){return this.getQuestModels()[a]||null},b.prototype.getQuestById=function(a){var b,c,d=this.getQuestModels(),e=d.length;for(c=0;e>c;c++)if(b=d[c],a===b.getId())return b;return null},b.prototype.getProgress=function(){return this.data.quest_line_progress},b.prototype.setProgress=function(a){this.data.quest_line_progress=a},b.prototype.getTarget=function(){return this.getQuestModels().length},b.prototype.isFinished=function(){return this.data.quest_line_progress>=this.getTarget()},b.prototype.getFirstSelectableQuestIndex=function(){var a,b,c=this.getQuestModels(),d=c.length;for(b=0;d>b;b++)if(a=c[b],!a.isClosed())return b;return 0},b.prototype.getFirstFinishableQuestIndex=function(){var a,b,c=this.getQuestModels(),d=c.length;for(b=0;d>b;b++)if(a=c[b],a.isFinishable())return b;return-1},b.prototype.markAsRead=function(){this.data.read=1},b.prototype.getCurrentQuest=function(){var a,b,c=this.getQuestModels(),d=c.length;for(b=0;d>b;b++)if(a=c[b],!a.isClosed()&&!a.isFinishable())return a;return null},b}),define("models/quest/QuestModel",["conf/questTypes"],function(a){var b=function(a){return"send_command"===a.type},c=function(a,b){this.data=a,this.data.questLineModel=b};return c.prototype.getId=function(){return this.data.quest_id},c.prototype.getGoalPercent=function(a){return Math.min(a.progress,a.limit)/a.limit*100},c.prototype.getType=function(){return this.data.type},c.prototype.isClosed=function(){return this.data.closed},c.prototype.setClosed=function(a){this.data.closed=a},c.prototype.isRead=function(){return!!this.data.read},c.prototype.getGoals=function(){return this.data.goals},c.prototype.hasRewards=function(){return!!this.getRewards().length},c.prototype.getRewards=function(){return this.data.rewards},c.prototype.getCommandGoals=function(){return this.getGoals().filter(b)},c.prototype.getQuestLineModel=function(){return this.data.questLineModel},c.prototype.markAsRead=function(){this.data.read=1},c.prototype.isAlreadyRewarded=function(){return this.data.rewarded},c.prototype.getIcon=function(){var b;return this.data.icon?this.data.icon.toLowerCase():(b=this.getQuestLineModel().getName().toLowerCase(),a.QUEST_PREFIX+(a.ICON_MAPPING[b]||b))},c.prototype.isFinishable=function(){var a,b,c=this.getGoals(),d=c.length;if(this.isClosed())return!1;for(b=0;d>b;b++)if(a=c[b],a.progress<a.limit)return!1;return!0},c.prototype.hasGoalType=function(a){var b,c,d=this.getGoals(),e=d.length;for(c=0;e>c;c++)if(b=d[c],a===b.type)return!0;return!1},c}),define("models/audio/AudioSpriteModel",[],function(){var a=function(a,b,c,d){this.audioSpriteListModel=a,this.type=b,this.sprite=c,this.manager=d,this.trackNameList=Object.keys(c),this.lastPlayedTrackName=null,this.fadeDuration=2e3,this.isPlaying=!1};return a.prototype.getTrackDuration=function(a){return this.manager._sprite[a][1]},a.prototype.getNextPlayableTrackName=function(){var a=this;return 1===this.trackNameList.length?this.trackNameList[0]:this.trackNameList.filter(function(b){return a.lastPlayedTrackName!==b}).random()},a.prototype.update=function(){this.manager.volume(this.audioSpriteListModel.volume),!this.audioSpriteListModel.enabled&&this.isPlaying&&this.stop()},a.prototype.play=function(a){var b=a||this.getNextPlayableTrackName(),c=this.audioSpriteListModel.fade;if(-1===this.trackNameList.indexOf(b))throw new Error("Unknown track name '"+b+"' given. Known: '"+this.trackNameList.join(", ")+"'");this.manager.volume(this.audioSpriteListModel.volume).play(b),c&&this.manager.fade(0,this.audioSpriteListModel.volume,this.fadeDuration),this.isPlaying=!0,this.lastPlayedTrackName=b},a.prototype.stop=function(){this.manager.stop(),this.isPlaying=!1},a.prototype.fadeOut=function(){var a=this;this.manager.fade(this.audioSpriteListModel.volume,0,this.fadeDuration,function(){a.stop()})},a.prototype.teardown=function(){this.manager.unload()},a}),define("models/SmartTipModel",["conf/tips"],function(a){var b=function(b,c,d,e){switch(b){case a.TYPES.RD_JOBS_COLLECTIBLE:case a.TYPES.RD_JOBS_AVAILABLE:case a.TYPES.RD_REROLL_AVAILABLE:case a.TYPES.UNUSED_BOOSTERS:this.icon="resource_manager";break;case a.TYPES.LOOT_MASTER:this.icon="premium_officer_loot_master";break;case a.TYPES.BUILDING_QUEUE:this.icon="architectural_designer";break;case a.TYPES.ATTACK_BARBARIANS:case a.TYPES.NO_TRIBE:case a.TYPES.HOSPITALIZED_UNITS:case a.TYPES.RECRUITING_QUEUE:this.icon="military_advisor";break;case a.TYPES.SECOND_VILLAGE:case a.TYPES.SECOND_VILLAGE_EXPIRE:this.icon="second_village_girl"}this.data=e||{},this.type=b,this.cooldownFactor=a.TIP_COOLDOWN_FACTOR,this.duration=a.TIP_DURATION,this.lastDisplay=0,this.checkConditions=c,this.actionFn=d,this.disabled=!1};return b.prototype.disable=function(){this.disabled=!0},b.prototype.hasCooldown=function(b){return(b||Date.now())-this.lastDisplay<this.cooldownFactor*a.TIP_RATE},b.prototype.check=function(){return this.disabled?!1:this.checkConditions(this)},b.prototype.action=function(){this.actionFn&&this.actionFn(this)},b.prototype.show=function(a){this.lastDisplay=a||Date.now(),this.cooldownFactor++},b}),define("models/models",["conf/conf","models/MapDataModel","models/PlayerModel","models/GenericJobModel","models/GenericJobListModel","models/CharacterModel","models/GameDataModel","models/GameDataResearchesModel","models/VillageModel","models/EffectModel","models/EffectListModel","models/BuildingDataModel","models/BuildingQueueModel","models/BuildJobModel","models/CommandListModel","models/CommandModel","models/TradeListModel","models/TradeModel","models/WorldConfigModel","models/ConversationModel","models/FriendListModel","models/Contact","models/InventoryModel","models/PresetListModel","models/GroupListModel","models/AchievementListModel","models/TribeInvitationsModel","models/TribeApplicationsModel","models/TribeSettingsModel","models/OfficerDataModel","models/ErrandModel","models/TribeSkillModel","models/ResourceDepositModel","models/SecondVillageModel","models/quest/QuestLineListModel","models/quest/QuestLineModel","models/quest/QuestModel","models/RecruitJobModel","models/RecruitJobListModel","models/RecruitJobListsContainerModel","models/audio/AudioSpriteListModel","models/audio/AudioSpriteModel","models/SmartTipModel"],function(a){a.DEBUG}),define("models/ResourceModel",[],function(){var a=function(a){this.data=a};return a.prototype.getProductionRates=function(){return this.data.productionRates},a.prototype.getLastUpdate=function(){return this.data.lastUpdate},a.prototype.getMaxStorage=function(){return this.data.maxStorage},a.prototype.setMaxStorage=function(a){this.data.maxStorage=a},a.prototype.getBaseStorage=function(){return this.data.baseStorage},a.prototype.getResources=function(){return this.data.resources},a.prototype.getTemporaryBarracksCosts=function(){return this.data.temporaryCostsBarracks||null},a.prototype.setTemporaryBarracksCosts=function(a){this.data.temporaryCostsBarracks=a},a.prototype.clearTemporaryBarracksCosts=function(){this.data.temporaryCostsBarracks=null},a.prototype.getData=function(){return this.data},a.prototype.setData=function(a){var b;for(b in a)this.data[b]=a[b]},a.prototype.setProductionRates=function(a){this.data.productionRates=a},a}),define("providers/ResourceModelProvider",["app","models/ResourceModel"],function(a,b){a.factory("resourceModelProvider",[function(){return function(a){var c={resources:a.resources,productionRates:a.production_rates,lastUpdate:a.res_last_update,baseStorage:a.base_storage};return new b(c)}}])}),define("providers/CharacterModelProvider",["app","models/CharacterModel"],function(a,b){a.factory("characterModelProvider",[function(){return function(a){return new b(a)}}])}),define("models/TimelineModel",["helper/time"],function(a){var b=function(b){this.data={events:this.splitEventList(b.events.map(function(b){return b.time=a.server2ClientTime(b.time),b}))}};return b.prototype.TYPES={RECRUIT:"recruit",BUILD:"build"},b.prototype.getRowForEvent=function(a){return a.type===this.TYPES.BUILD||a.type===this.TYPES.RECRUIT?"bottom":"top"},b.prototype.splitEventList=function(a){var b,c,d,e={top:[],bottom:[]};for(b=0;b<a.length;b++)d=a[b],c=this.getRowForEvent(d),e[c].push(d);return e},b.prototype.insert=function(b){var c,d,e,f=!1;for(b.time=a.server2ClientTime(b.time),d=this.getRowForEvent(b),c=this.data.events[d].length;c--;){if(e=this.data.events[d][c],e.time<b.time){this.data.events[d].splice(c+1,0,b),f=!0;break}if(e.time===b.time&&e.id===b.id&&e.type===b.type)return!1}f||this.data.events[d].unshift(b),window.injector.get("$rootScope").$broadcast(window.injector.get("eventTypeProvider").TIMELINE_NEW_EVENT)},b.prototype.getEvents=function(){return this.data.events},b.prototype.removeEvent=function(a){var b,c,d,e;for(c in this.data.events)for(e=this.data.events[c],b=e.length;b--;)if(d=e[b],d.id===a)return e.remove(b),void(d.onCompleted&&d.onCompleted())},b.prototype.has=function(a){return this.data.events[this.getRowForEvent(a)].some(function(b){return b.id===a.id&&b.type===a.type})},b}),define("providers/TimelineModelProvider",["app","models/TimelineModel"],function(a,b){a.factory("timelineModelProvider",["timelineDataProvider",function(a){return function(c){return c.events=c.events.filter(function(b){var c;for(c in a)if(a[c]===b.type)return!0;return!1}),new b(c)}}])}),define("providers/PlayerModelProvider",["app","models/PlayerModel"],function(a,b){a.factory("playerModelProvider",["characterModelProvider",function(a){return function(c){var d,e={},f=!1;return c.characters.forEach(function(b){f=!0,d=a(b),e[d.getId()+"_"+d.getWorldId()]=d}),new b(c,f&&e)}}])}),define("providers/GameDataModelProvider",["app","models/GameDataModel"],function(a,b){a.factory("gameDataModelProvider",["inventoryItemTypeProvider",function(a){return function(){return new b(a)}}])}),define("models/GlobalInfoModel",["models/CommandListModel","models/CommandModel"],function(a,b){var c,d={incoming_commands:!0,events:!0};return c=function(c){var e=c,f=new a,g=function(a){f.remove(a,!0)},h=function(a){var c=new b(a);f.add(c,!0)},i=function(){return f},j=function(){var a,b;delete e.beginner_protection,delete e.beginner_protection_extendable;for(b in e)!d[b];for(a=0;a<e.incoming_commands.length;a++)h(e.incoming_commands[a])};j(),this.removeCommand=g,this.insertCommand=h,this.getCommandListModel=i}}),define("providers/GlobalInfoModelProvider",["app","models/GlobalInfoModel"],function(a,b){a.factory("globalInfoModelProvider",[function(){
return function(a){return new b(a)}}])}),define("providers/VillageModelProvider",["app","models/VillageModel","models/EffectListModel"],function(a,b,c){a.factory("villageModelProvider",["resourceModelProvider",function(a){return function(d){return d.effects&&(d.effectList=new c(d.effects)),new b(d,a(d))}}])}),define("providers/BuildingDataModelProvider",["app","models/BuildingDataModel"],function(a,b){a.factory("buildingDataModelProvider",[function(){return function(a){return new b(a)}}])}),define("providers/BuildingQueueModelProvider",["app","models/BuildingQueueModel"],function(a,b){a.factory("buildingQueueModelProvider",[function(){return function(a){return new b(a)}}])}),define("providers/RouteProvider",["app"],function(a){a.factory("routeProvider",function(){var a={STARTUP_LOG:{type:"System/startupTime",data:["startup_time","platform","device"]},SELECT_CHARACTER:{type:"Authentication/selectCharacter",data:["id","world_id","ref_param"]},SYSTEM_IDENTIFY:{type:"System/identify",data:["api_version","platform","device"]},CREATE_CHARACTER:{type:"Authentication/createCharacter",data:["world"]},TRIBE_GET_APPLICATION_TEMPLATE:{type:"Tribe/getApplicationTemplate",data:["tribe_id"]},TRIBE_CHANGE_APPLICATION_TEMPLATE:{type:"Tribe/changeApplicationTemplate",data:["template"]},PLAYER_RESET_PASSWORD:{type:"Player/resetPassword",data:["email"]},PLAYER_EMAIL_GET_CONFIRMATION_PACKAGE:{type:"PlayerEmail/getConfirmationPackage",data:[]},PLAYER_EMAIL_RESEND_WELCOME_MAIL:{type:"PlayerEmail/resendWelcomeMail",data:[]},PLAYER_EMAIL_REQUEST_CHANGE:{type:"PlayerEmail/requestChange",data:["new_address"]},CHAR_CREATE_VILLAGE:{type:"Character/createVillage",data:["name","direction"]},CHAR_GET_INFO:{type:"Character/getInfo"},CHAR_RESTART:{type:"Character/restart",data:["pass"]},CHAR_CHANGE_ROLE:{type:"Character/changeRole",data:["player_id","role"]},CHAR_GET_PROFILE:{type:"Character/getProfile",data:["character_id"]},CHAR_SET_PROFILE:{type:"Character/setProfile",data:["icon","title_id","achievements","text"]},CHAR_GET_TITLES:{type:"Character/getTitles"},CHAR_GET_BASE_PROFILES:{type:"Character/getShortProfiles",data:["character_ids"]},LOGIN:{type:"Authentication/login",data:["name"]},LOGOUT:{type:"Authentication/logout"},RECONNECT:{type:"Authentication/reconnect",data:["name","token","character","world"]},MAP_SET_TUTORIAL_VILLAGE_LOCATION:{type:"Map/setTutorialVillageLocation",data:["village_id"]},MAP_GET_NEAREST_BARBARIAN_VILLAGE:{type:"Map/getNearestBarbarianVillage",data:["x","y"]},BARBARIAN_BOOST_PRODUCTION:{type:"Barbarian/boostProduction",data:["village_id","resource_type"]},MAP_RENAME_PROVINCE:{type:"Map/renameProvince",data:["province_id","name"]},MAP_GETPROVINCE:{type:"Map/getProvince",data:["x","y"]},MAP_GETVILLAGES:{type:"Map/getVillagesByArea",data:["x","y","width","height"]},MAP_GET_TRIBES_NEAR_VILLAGE:{type:"Map/getTribesNearVillage",data:["village_id"]},MAP_GET_VILLAGE_DETAILS:{type:"Map/getVillageDetails",data:["village_id"]},MAP_GET_KINGDOMS:{type:"Map/getKingdoms"},BUILDING_GET_DATA:{type:"Building/getBuildings",data:["village_id"]},VILLAGE_GET_VILLAGE:{type:"Village/getVillage",data:["village_id"]},VILLAGE_BATCH_GET_VILLAGE_DATA:{type:"VillageBatch/getVillageData",data:["village_ids"]},VILLAGE_GET_BUILDING_QUEUE:{type:"Building/getQueue",data:["village_id"]},BUILDING_QUEUE_CANCEL_JOB:{type:"Building/cancelJob",data:["village_id","job_id"]},VILLAGE_WALL_INFO:{type:"Village/getWallInfo",data:["village_id"]},VILLAGE_UNIT_INFO:{type:"Village/getUnitInfo",data:["village_id"]},VILLAGE_UPGRADE_BUILDING:{type:"Building/upgrade",data:["village_id","building","premium"]},VILLAGE_STORAGE_INFO:{type:"Village/getStorageInfo",data:["village_id"]},VILLAGE_RESEARCH_UNLOCK:{type:"Research/unlock",data:["village_id","research_type"]},VILLAGE_FARM_INFO:{type:"Village/getFarmInfo",data:["village_id"]},REGISTER:{type:"Authentication/register",data:["name","mail","pass","pass_wh","agb","platform","portal_data","invite_key"]},VILLAGES_IN_PROVINCE:{type:"Village/getSameProvinceVillages",data:["village_id"]},VILLAGE_CHANGE_NAME:{type:"Village/changeName",data:["village_id","name"]},WORLD_CONFIG:{type:"WorldConfig/getWorldConfig"},GAME_DATA_GET_BASE_DATA:{type:"GameData/getBaseData"},GAME_DATA_UNITS:{type:"GameData/getUnits"},GAME_DATA_BUILDINGS:{type:"GameData/getBuildings"},GAME_DATA_COSTS_PER_COIN:{type:"GameData/getCostsPerCoin"},GAME_DATA_GET_PREMIUM:{type:"GameData/getPremium"},GAME_DATA_GET_OFFICER:{type:"GameData/getOfficers"},GAME_DATA_GET_RESEARCHES:{type:"GameData/getResearch"},VILLAGE_RESOURCE_INFO:{type:"Village/getResourceInfo",data:["village_id"]},GLOBAL_INFORMATION:{type:"GlobalInformation/getInfo"},MEDIA_PARTNER_GET_CAMPAIGN:{type:"MediaPartner/getActiveCampaigns"},COOP_GET_STATUS:{type:"Coop/getCoopStatus"},COOP_ACCEPT_INVITATION:{type:"Coop/acceptInvitation",data:["invitation_id"]},COOP_DECLINE_INVITATION:{type:"Coop/declineInvitation",data:["invitation_id"]},COOP_LEAVE_CHARACTER:{type:"Coop/leaveCharacter",data:["character_id"]},COOP_INVITE_PLAYER:{type:"Coop/invitePlayer",data:["character_id"]},COOP_REMOVE_PLAYER:{type:"Coop/removePlayer",data:["player_id"]},COOP_WITHDRAW_INVITATION:{type:"Coop/withdrawInvitation",data:["invitation_id"]},TIMELINE_GET_EVENTS:{type:"Timeline/listEvents",data:["village_id"]},TIMELINE_GET_DETAILS:{type:"Timeline/getEventDetails",data:["event_type","event_id","village_id"]},HOSPITAL_GET_PATIENTS:{type:"Hospital/getPatients",data:["village_id"]},HOSPITAL_RELEASE_PATIENT:{type:"Hospital/release",data:["village_id","patient_id"]},VILLAGE_GET_UNITSCREEN_INFO:{type:"Unit/getUnitScreenInfo",data:["village_id"]},UNITSCREEN_SEND_SURPLUS_BACK:{type:"Unit/sendSurplusBack",data:["village_id"]},COMMAND_WITHDRAWSUPPORT:{type:"Command/withdrawSupport",data:["id","units"]},COMMAND_WITHDRAW_ALL_SUPPORT_FROM_VILLAGE:{type:"Command/withdrawCompleteSupport",data:["village_id"]},COMMAND_SEND_SUPPORT_BACK:{type:"Command/sendSupportBack",data:["id","units"]},COMMAND_IGNORE:{type:"Command/ignore",data:["command_id"]},REPORT_GET_LIST_REVERSE:{type:"Report/getListReverse",data:["offset","count","opt_filters","query","types"]},REPORT_TOGGLE_FAVOURITE:{type:"Report/toggleFavourite",data:["reports"]},REPORT_GET:{type:"Report/get",data:["id"]},REPORT_GET_BY_TOKEN:{type:"Report/getByToken",data:["token"]},REPORT_DELETE:{type:"Report/delete",data:["reports"]},REPORT_MARK_READ:{type:"Report/markRead",data:["reports"]},REPORT_MARK_UNREAD:{type:"Report/markUnread",data:["reports"]},REPORT_MARK_SEEN:{type:"Report/markSeen",data:["ids"]},REPORT_GET_SETTINGS:{type:"Report/getSettings"},REPORT_SET_SETTINGS:{type:"Report/setSettings",data:["settings"]},GET_PRESETS_FOR_VILLAGE:{type:"ArmyPreset/getForVillage",data:["village_id"]},GET_PRESETS:{type:"ArmyPreset/getPresetList"},SEND_PRESET:{type:"Command/sendPreset",data:["start_village","target_village","army_preset_id","type"]},SEND_CUSTOM_ARMY:{type:"Command/sendCustomArmy",data:["start_village","target_village","type","units","catapult_target","officers"]},SAVE_EXISTING_PRESET:{type:"ArmyPreset/save",data:["preset_id","name","icon","officers","units"]},DELETE_PRESET:{type:"ArmyPreset/delete",data:["id"]},SAVE_NEW_PRESET:{type:"ArmyPreset/create",data:["village_id","name","icon","officers","units"]},RECRUIT_PRESET:{type:"Unit/recruitPreset",data:["village_id","preset_id"]},ASSIGN_PRESETS:{type:"ArmyPreset/assign",data:["village_id","preset_ids"]},GET_ATTACKING_FACTOR:{type:"Command/getAttackingFactor",data:["target_id"]},GET_OWN_COMMANDS:{type:"Command/getOwnCommands",data:["village_id"]},COMMAND_CANCEL:{type:"Command/cancel",data:["command_id"]},ACADEMY_GET_INFO:{type:"Academy/getInfo",data:["village_id"]},MINT_COINS:{type:"Academy/mintCoins",data:["village_id","amount"]},MASS_MINT_COINS:{type:"Academy/massMintCoins",data:["villages"]},GET_TRAINING:{type:"Academy/getTraining",data:["village_id"]},GET_CHARACTER_VILLAGES:{type:"Village/getCharacterVillages"},PRECEPTORY_SELECT_ORDER:{type:"Preceptory/selectOrder",data:["village_id","order"]},PRECEPTORY_RESET_ORDER:{type:"Preceptory/resetOrder",data:["village_id","premium"]},BARRACKS_RECRUIT:{type:"Barracks/recruit",data:["village_id","unit_type","amount"]},ACADEMY_RECRUIT:{type:"Academy/recruit",data:["village_id","unit_type","amount"]},RANKING_CHARACTER:{type:"Ranking/getCharacterRanking",data:["area_type","offset","count","order_by","order_dir"]},RANKING_TRIBE:{type:"Ranking/getTribeRanking",data:["area_type","offset","count","order_by","order_dir"]},STATUE_RECRUIT:{type:"Statue/recruit",data:["village_id","unit_type","amount"]},PALADIN_GET_INFO:{type:"Paladin/getInfo",data:[]},SHOP_GET_PREMIUM_OFFERS:{type:"Premium/listItems",data:[]},PALADIN_RENAME:{type:"Paladin/rename",data:["name"]},PALADIN_EQUIP_ITEM:{type:"Paladin/equipItem",data:["item"]},PALADIN_UNLOCK_NEXT_ITEM_LEVEL:{type:"Paladin/unlockNextItemLevel",data:["item"]},PALADIN_RELOCATE:{type:"Paladin/relocate",data:["village_id"]},PALADIN_RECRUIT_INSTANTLY:{type:"Paladin/summonInstantly",data:["village_id"]},PRECEPTORY_RECRUIT:{type:"Preceptory/recruit",data:["village_id","unit_type","amount"]},PRECEPTORY_CANCEL_RECRUIT_JOB:{type:"Preceptory/cancelRecruitJob",data:["village_id","job_id"]},ACADEMY_CANCEL_RECRUIT_JOB:{type:"Academy/cancelRecruitJob",data:["village_id","job_id"]},BARRACKS_CANCEL_RECRUIT_JOB:{type:"Barracks/cancelRecruitJob",data:["job_id","village_id"]},STATUE_CANCEL_RECRUIT_JOB:{type:"Statue/cancelRecruitJob",data:["village_id","job_id"]},NOTIFICATION_MARK_READ:{type:"Notification/markRead",data:["id"]},NOTIFICATION_GET_NOTIFICATIONS:{type:"Notification/getNotifications",data:[]},AUTOCOMPLETE:{type:"Autocompletion/autocomplete",data:["string","amount","types"]},MESSAGE_SEND:{type:"Message/write",data:["to","title","message"]},MESSAGE_GET_LIST:{type:"Message/getList",data:["folder","offset","count","search"]},MESSAGE_GET:{type:"Message/get",data:["message_id","offset","count","reverse"]},MESSAGE_REPLY:{type:"Message/reply",data:["message_id","message"]},MESSAGE_ADD_PARTICIPANTS:{type:"Message/addParticipants",data:["message_id","entities"]},MESSAGE_KICK:{type:"Message/kick",data:["message_id","character_id"]},MESSAGE_MOVE_TO_FOLDER:{type:"Message/changeFolder",data:["message_ids","new_folder"]},MESSAGE_DELETE:{type:"Message/delete",data:["message_ids"]},MESSAGE_FORWARD:{type:"Message/forward",data:["to","title","message","message_ids"]},MESSAGE_MARK_READ:{type:"Message/markRead",data:["message_ids"]},MESSAGE_MARK_UNREAD:{type:"Message/unmarkRead",data:["message_ids"]},MESSAGE_LEAVE:{type:"Message/leave",data:["message_id"]},FRIENDLIST_GET:{type:"Friendlist/get",data:["offset","count"]},FRIENDLIST_ADD:{type:"Friendlist/add",data:["type","id"]},FRIENDLIST_REMOVE:{type:"Friendlist/remove",data:["type","id"]},SCOUTING_GET_INFO:{type:"Scouting/getInfo",data:["village_id"]},SCOUTING_RECRUIT:{type:"Scouting/recruit",data:["village_id","slot"]},SCOUTING_CANCEL_RECRUIT:{type:"Scouting/cancelProduction",data:["village_id","slot"]},SCOUTING_SET_COUNTER_MEASURE:{type:"Scouting/setCounterMeasure",data:["village_id","type","status","building","level","unit","replacement"]},SCOUTING_SEND_COMMAND:{type:"Scouting/sendCommand",data:["startVillage","targetVillage","spys","type"]},SCOUTING_CANCEL_COMMAND:{type:"Scouting/cancelCommand",data:["command_id"]},TRADING_SEND_RESOURCES:{type:"Trading/sendResources",data:["start_village","target_village","wood","clay","iron"]},TRADING_GET_TRANSPORTS:{type:"Trading/getTransports",data:["village_id","count","offset","ordered_by","order"]},TRADING_CANCEL_TRANSPORT:{type:"Trading/cancelTransport",data:["transport_id"]},TRADING_GET_MERCHANT_STATUS:{type:"Trading/getMerchantStatus",data:["village_id"]},TRADING_LIST_OFFERS:{type:"Trading/listOffers",data:["village_id","offset","count","ordered_by","order","filters"]},TRADING_CREATE_OFFER:{type:"Trading/createOffer",data:["village_id","offered_type","offered_amount","requested_type","requested_amount","offer_amount","max_delivery_time"]},TRADING_REMOVE_OFEER:{type:"Trading/removeOffer",data:["offer_id"]},TRADING_ACCEPT_OFEER:{type:"Trading/acceptOffer",data:["village_id","offer_id","offer_amount"]},TRIBE_INVITATION_GET_OWN:{type:"TribeInvitation/getOwnInvitations"},TRIBE_INVITATION_CREATE:{type:"TribeInvitation/create",data:["character_name"]},TRIBE_INVITATION_REJECT:{type:"TribeInvitation/reject",data:["id"]},TRIBE_INVITATION_ABORT:{type:"TribeInvitation/abort",data:["id"]},TRIBE_INVITATION_ACCEPT:{type:"TribeInvitation/accept",data:["id"]},TRIBE_APPLICATION_GET_OWN:{type:"TribeApplication/getOwnApplications"},TRIBE_APPLICATION_ACCEPT:{type:"TribeApplication/accept",data:["id"]},TRIBE_APPLICATION_CREATE:{type:"TribeApplication/create",data:["tribe_id","message"]},TRIBE_APPLICATION_REJECT:{type:"TribeApplication/reject",data:["id"]},TRIBE_APPLICATION_ABORT:{type:"TribeApplication/abort",data:["id"]},TRIBE_CREATE:{type:"Tribe/create",data:["name","tag"]},TRIBE_GET_PROFILE:{type:"Tribe/getProfile",data:["tribe_id"]},TRIBE_LEAVE:{type:"Tribe/leave"},TRIBE_CHANGE_PROFILE:{type:"Tribe/changeProfile",data:["description"]},TRIBE_SELECT_ACHIEVEMENTS:{type:"Tribe/selectAchievements",data:["achievements"]},TRIBE_SET_MEMBER_TITLE:{type:"Tribe/setMemberTitle",data:["member_id","title"]},TRIBE_SET_MEMBER_RIGHTS:{type:"Tribe/setMemberRights",data:["member_id","rights"]},TRIBE_SET_MEMBER_TRUSTED:{type:"Tribe/setMemberTrusted",data:["member_id","trusted"]},TRIBE_CHANGE_ICON:{type:"Tribe/changeIcon",data:["icon"]},TRIBE_DISBAND:{type:"Tribe/disband"},TRIBE_GET_LOG:{type:"Tribe/getLog",data:["start","count"]},TRIBE_CHANGE_SETTINGS:{type:"Tribe/changeSettings",data:["opt_name","opt_tag","opt_allow_applications","opt_set_open","opt_icon","opt_achievements","opt_description","opt_min_points"]},TRIBE_JOIN:{type:"Tribe/join",data:["tribe_id"]},TRIBE_CHANGE_WELCOME_MESSAGE:{type:"Tribe/changeWelcomeMessage",data:["message"]},TRIBE_RELATION_GET_LIST:{type:"TribeRelation/getList"},TRIBE_RELATION_CHANGE:{type:"TribeRelation/change",data:["tribe_tag","relation"]},TRIBE_GET_MEMBERLIST:{type:"Tribe/getMemberList",data:["tribe"]},TRIBE_GET_RIGHT_PRESETS:{type:"Tribe/getRightPresets"},TRIBE_INVITATION_GET_TRIBE_INVITATIONS:{type:"TribeInvitation/getTribeInvitations"},TRIBE_APPLICATION_GET_TRIBE_APPLICATIONS:{type:"TribeApplication/getTribeApplications"},TRIBE_KICK_MEMBER:{type:"Tribe/kickMember",data:["id"]},TRIBE_GET_WELCOME_MESSAGE:{type:"Tribe/getWelcomeMessage"},TRIBE_SET_FOUNDER:{type:"Tribe/passFounder",data:["new_founder_id"]},FORUM_LIST_FORUMS:{type:"Forum/listForums"},FORUM_CREATE_FORUM:{type:"Forum/createForum",data:["name"]},FORUM_LIST_THREADS:{type:"Forum/listThreads",data:["forum_id","offset","count"]},FORUM_CREATE_THREAD:{type:"Forum/createThread",data:["forum_id","name","text"]},FORUM_DELETE_FORUM:{type:"Forum/deleteForum",data:["forum_id"]},FORUM_SET_ORDER:{type:"Forum/setOrder",data:["order"]},FORUM_LIST_POSTS:{type:"Forum/listPosts",data:["thread_id","offset","count","reverse"]},FORUM_CREATE_POST:{type:"Forum/createPost",data:["thread_id","text"]},FORUM_DELETE_POST:{type:"Forum/deletePost",data:["post_id","thread_id"]},FORUM_EDIT_POST:{type:"Forum/editPost",data:["post_id","text"]},FORUM_RENAME_THREAD:{type:"Forum/renameThread",data:["thread_id","name"]},FORUM_MARK_THREADS_READ:{type:"Forum/markThreadsRead",data:["thread_ids","forum_id"]},FORUM_MARK_THREADS_UNREAD:{type:"Forum/markThreadsUnread",data:["thread_ids","forum_id"]},FORUM_PIN_THREADS:{type:"Forum/pinThreads",data:["thread_ids","forum_id"]},FORUM_UNPIN_THREADS:{type:"Forum/unpinThreads",data:["thread_ids","forum_id"]},FORUM_CLOSE_THREADS:{type:"Forum/closeThreads",data:["thread_ids","forum_id"]},FORUM_REOPEN_THREADS:{type:"Forum/reopenThreads",data:["thread_ids","forum_id"]},FORUM_MARK_FORUM_READ:{type:"Forum/markForumRead",data:["forum_id"]},FORUM_MARK_FORUM_UNREAD:{type:"Forum/markForumUnread",data:["forum_id"]},FORUM_DELETE_THREADS:{type:"Forum/deleteThreads",data:["forum_id","thread_ids"]},FORUM_RENAME_FORUM:{type:"Forum/renameForum",data:["forum_id","name"]},FORUM_MOVE_THREADS:{type:"Forum/moveThreads",data:["forum_id","thread_ids","target_forum_id"]},ACHIEVEMENT_GET_ALL:{type:"Achievement/getAll"},ACHIEVEMENT_GET_ACHIEVED:{type:"Achievement/getAchieved",data:["character_id"]},ACHIEVEMENT_GET_TRIBE_ACHIEVEMENTS:{type:"Achievement/getTribeAchievements",data:["tribe_id"]},ACHIEVEMENT_GET_CHAR_ACHIEVEMENTS:{type:"Achievement/getCharacterAchievements",data:["character_id"]},GET_INVENTORY:{type:"Premium/listItems"},INVENTORY_MARK_SEEN:{type:"Premium/markSeen"},PREMIUM_LIST_SHOP_OFFERS:{type:"Premium/listShopOffers"},PREMIUM_BUY_ITEM:{type:"Premium/buyItem",data:["offer_id"]},PREMIUM_USE_ITEM:{type:"Premium/useItem",data:["village_id","item_id"]},PREMIUM_GET_IFRAME_URL:{type:"Premium/getPaymentIframe"},PREMIUM_BUY_BUILDQUEUE_SLOT:{type:"Village/buyBuildQueueSlot",data:["village_id"]},PREMIUM_BOOST_PRODUCTION:{type:"Village/boostProduction",data:["village_id","resource_type"]},PREMIUM_INSTANT_BUILD:{type:"Building/completeInstantly",data:["village_id","job_id"]},PREMIUM_INSTANT_RECRUIT_BARRACKS:{type:"Barracks/completeInstantly",data:["village_id","job_id"]},PREMIUM_INSTANT_RECRUIT_ACADEMY:{type:"Academy/completeInstantly",data:["village_id","job_id"]},PREMIUM_INSTANT_RECRUIT_PRECEPTORY:{type:"Preceptory/completeInstantly",data:["village_id","job_id"]},PREMIUM_SECOND_QUEUE_JOB_BARRACKS:{type:"Barracks/startSecondJob",data:["village_id","job_id"]},PREMIUM_SECOND_QUEUE_JOB_PRECEPTORY:{type:"Preceptory/startSecondJob",data:["village_id","job_id"]},PREMIUM_INSTANT_TRADE:{type:"Trading/instantTrade",data:["village_id","resource_pay","resource_get","amount"]},PREMIUM_INSTANT_TRANSPORT:{type:"Trading/instantTransport",data:["transport_id"]},PREMIUM_DAILY_UNIT_DEAL_GET_OFFERS:{type:"DailyUnitDeal/getOffers",data:["village_id"]},PREMIUM_DAILY_UNIT_DEAL_ACCEPT:{type:"DailyUnitDeal/accept",data:["village_id","slot"]},PREMIUM_DAILY_UNIT_DEAL_REROLL:{type:"DailyUnitDeal/reroll",data:["village_id"]},RESOURCE_DEPOSIT_GET_INFO:{type:"ResourceDeposit/getInfo"},PREMIUM_RESOURCE_DEPOSIT_REROLL:{type:"ResourceDeposit/reroll"},RESOURCE_DEPOSIT_START_JOB:{type:"ResourceDeposit/startJob",data:["job_id"]},RESOURCE_DEPOSIT_COLLECT:{type:"ResourceDeposit/collect",data:["job_id","village_id"]},RESOURCE_DEPOSIT_OPEN:{type:"ResourceDeposit/open"},SETTINGS_GET_ACCOUNT_INFO:{type:"Settings/getAccountInfo"},SETTINGS_CHANGE_PASSWORD:{type:"Settings/changePassword",data:["old_pass","pass","pass_repeat"]},QUESTS_GET_QUEST_LINES:{type:"Quest/getQuestLines"},QUEST_FINISH_QUEST:{type:"Quest/close",data:["quest_id","village_id"]},QUEST_REFRESH_GOALS:{type:"Quest/refreshGoals"},QUEST_MARK_READ:{type:"Quest/markRead",data:["quest_id"]},GROUPS_GET_INDEX:{type:"Group/getGroups"},GROUPS_CREATE:{type:"Group/create",data:["name","icon"]},GROUPS_UPDATE:{type:"Group/update",data:["id","name","icon"]},GROUPS_DESTROY:{type:"Group/delete",data:["id"]},GROUPS_GET_VILLAGES:{type:"Icon/getVillages"},GROUPS_LINK_VILLAGE:{type:"Group/link",data:["group_id","village_id"]},GROUPS_UNLINK_VILLAGE:{type:"Group/unlink",data:["group_id","village_id"]},OVERVIEW_GET_VILLAGES:{type:"Overview/getVillages",data:["count","offset","sorting","reverse","groups"]},OVERVIEW_GET_INCOMING:{type:"Overview/getIncoming",data:["count","offset","sorting","reverse","groups","command_types","villages"]},OVERVIEW_GET_COMMANDS:{type:"Overview/getCommands",data:["count","offset","sorting","reverse","groups","command_types","villages","directions"]},OVERVIEW_GET_UNITS:{type:"Overview/getUnits",data:["count","offset","sorting","reverse","groups"]},COMMAND_RENAME:{type:"Command/rename",data:["command_id","name"]},TUTORIAL_COMPLETE_TASK:{type:"Tutorial/completeTask"},TUTORIAL_START_TASK:{type:"Tutorial/startTask"},TUTORIAL_GET_CURRENT_TASK:{type:"Tutorial/getCurrentTask"},TUTORIAL_SKIP:{type:"Tutorial/skip"},TUTORIAL_START:{type:"Tutorial/start"},TUTORIAL_GET_VILLAGE_TO_ATTACK:{type:"Tutorial/getVillageToAttack",data:["x","y"]},WAREHOUSE_BOOST_PROTECTION:{type:"Warehouse/boostProtection",data:["village_id"]},CLOSED_BETA_REGISTER:{type:"ClosedBeta/register",data:["name","email","password","ref_param","portal_data"]},CLOSED_BETA_ENTER:{type:"ClosedBeta/enter",data:["key"]},SUPPORT_GET_URL:{type:"Support/getSupportURL"},TRACKING_SNIPPET_GET_VALID:{type:"TrackingSnippet/getIngame",data:["email"]},TRACKING_SNIPPET_CONFIRM_EVENT:{type:"TrackingSnippet/confirmEventSnippet"},TRACKING_AUTH_LOGIN_COMPLETE:{type:"Authentication/completeLogin"},TRACKING_AUTH_LEAVE_WORLD:{type:"Authentication/leaveWorld"},TRACK_EVENT:{type:"EventTracking/sendEvent",data:["category","event_name","tracking_data"]},WORLD_GET_FOR_PLAYER:{type:"World/getForPlayer"},CHAT_SEND_TRIBE:{type:"Chat/tribe",data:["message","character_name"]},CHAT_GET_TRIBE_HISTORY:{type:"Chat/getTribeChatHistory",data:[]},DAILY_LOGIN_BONUS_GET_INFO:{type:"DailyLoginBonus/getInfo"},DAILY_LOGIN_BONUS_CLAIM_REWARD:{type:"DailyLoginBonus/claimReward"},SECOND_VILLAGE_GET_INFO:{type:"SecondVillage/getInfo"},SECOND_VILLAGE_OPEN:{type:"SecondVillage/open"},SECOND_VILLAGE_START_JOB:{type:"SecondVillage/startJob",data:["job_id","village_id"]},SECOND_VILLAGE_COLLECT_JOB_REWARD:{type:"SecondVillage/collectJobReward",data:["job_id","village_id"]},SECOND_VILLAGE_RENAME:{type:"SecondVillage/rename",data:["new_name"]},SECOND_VILLAGE_FINISH_VILLAGE:{type:"SecondVillage/finishVillage",data:[]},INVITE_FRIEND_GET_INFO:{type:"InvitePlayer/getInfo",data:[]},INVITE_FRIEND_SEND_INVITE:{type:"InvitePlayer/sendInvitation",data:["email","invitee_name","inviter_name","message","consent","x","y"]},GET_INTERSTITIALS:{type:"Crm/getInterstitials",data:["device_type"]},ACCEPT_INTERSTITIAL:{type:"Crm/acceptInterstitial",data:["campaign_id"]},REJECT_INTERSTITIAL:{type:"Crm/rejectInterstitial",data:["campaign_id"]},ACCEPT_IGM:{type:"Crm/acceptIgm",data:["campaign_id"]},EFFECT_GET_EFFECTS:{type:"Effect/getEffects",data:[]},TRIBE_SKILL_DONATE:{type:"TribeSkill/donate",data:["village_id","crowns","resources"]},TRIBE_SKILL_GET_DONATION_RANKING:{type:"TribeSkill/getHonorRanking",data:[]},TRIBE_SKILL_ASSIGN_SKILL_POINTS:{type:"TribeSkill/assign",data:["points"]},TRIBE_SKILL_REASSIGN_SKILL_POINTS:{type:"TribeSkill/reassign",data:["points"]},TRIBE_SKILL_DONATE_MASS:{type:"TribeSkill/massDonating",data:["villages"]},TRIBE_SKILLS_GET_INFO:{type:"TribeSkill/getInfo",data:[]}};return a})}),define("providers/EventTypeProvider",["app"],function(a){a.factory("eventTypeProvider",function(){return{SOCKET_EMIT:"Internal/Socket/emit",SOCKET_EMIT_MULTIPLE:"Internal/Socket/emitMultiple",RECONNECT:"Internal/Connection/reconnect",SOCKET_DISCONNECTED:"Internal/socket/disconnected",SOCKET_CONNECTED:"Internal/socket/connected",SOCKET_RECONNECTED_ATTEMPT:"Internal/socket/reconnect_attempt",SOCKET_RECONNECTING:"Internal/socket/reconnecting",SOCKET_RECONNECT_ERROR:"Internal/socket/reconnect_error",SOCKET_RECONNECT_FAILED:"Internal/socket/reconnect_failed",SOCKET_ERROR:"Internal/socket/error",TUTORIAL_COMPLETED:"Internal/tutorial/completed",REFOCUS:"Internal/Map/selectVillage",AUDIO_PLAY_SFX:"Internal/audio/play/sfx",MAP_SELECT_VILLAGE:"Internal/Map/selectVillage",MAP_SELECTED_VILLAGE:"Internal/Map/selectedVillage",MAP_ZOOM:"Internal/Map/zoom",MAP_TOGGLE_VIEW:"Internal/Map/toggleView",MAP_ZOOM_INTO_VILLAGE:"Internal/Map/zoomIntoVillage",MAP_ZOOM_OUT_OF_VILLAGE:"Internal/Map/zoomOutOfVillage",MAP_ZOOM_STEP_CHANGED:"Internal/Map/zoomStepChanged",MAP_VILLAGE_VIEW:"Internal/Map/villageView",MAP_JUMP_TO:"Internal/Map/jumpTo",MAP_CENTER_ON_POSITION:"Internal/Map/centerOnPosition",MAP_LOADING_ASSETS:"Internal/Map/loadingAssets",MAP_INITIALIZED:"Internal/Map/initialized",MAP_INITIALIZE:"Internal/Map/initialize",MAP_ALREADY_INITIALIZED:"Internal/Map/alreadyInitialized",MAP_MOVEMENT_SELECTED:"Internal/Map/movementSelected",MAP_MOVEMENT_UPDATE:"Internal/Map/movementUpdate",VILLAGE_SELECT_BUILDING:"Internal/Village/selectedBuilding",VILLAGE_LOADED:"Internal/Village/loaded",VILLAGE_SWITCH:"Internal/Village/switch",VILLAGE_LOST:"Internal/Village/lost",VILLAGE_CONQUERED:"Internal/Village/conquered",VILLAGE_SELECTED_CHANGED:"Internal/Village/selectedChanged",GROUPS_VILLAGES_CHANGED:"Internal/Groups/villagesChanged",RECRUIT_JOB_ADDED:"Internal/Recruit/jobAdded",RECRUIT_JOB_REMOVED:"Internal/Recruit/jobRemoved",NOTIFICATION_NEW:"Notification/new",NOTIFICATION_DISABLE:"Internal/Notification/disable",NOTIFICATION_ENABLE:"Internal/Notification/enable",INTERFACE_QUEUE_SELECTED:"Internal/InterfaceQueueSelected",ICON_ANIMATION_NEW:"Internal/IconAnimationNew",OVERVIEW_FILTERS_CHANGED:"Internal/OverviewFiltersChanged",OVERVIEW_VILLAGES:"Overview/villages",PLAYER_PASSWORDRESET_INITIATED:"Player/passwordResetInitiated",PLAYER_BANNED:"Player/banned",RESOURCES:"Internal/resources",TOOLTIP_SHOW:"Internal/Tooltip/show",TOOLTIP_HIDE:"Internal/Tooltip/hide",SELECT_SHOW:"Internal/Select/show",SELECT_HIDE:"Internal/Select/hide",SELECT_KEY_HOVER:"Internal/Select/hover",SELECT_SELECTED:"Internal/Select/selected",RICH_TEXT_EDITOR_MENU_SHOW:"Internal/RichTextEditorMenu/show",RICH_TEXT_EDITOR_MENU_HIDE:"Internal/RichTextEditorMenu/hide",RICH_TEXT_EDITOR_MENU_ACTION:"Internal/RichTextEditorMenu/action",WORLD_MAP_SEARCH_TOGGLE:"Internal/WorldMapSearch/toggle",REPORT_SHOW:"Internal/Report/show",REPORT_SWITCH_PAGE:"Internal/Report/switchPage",REPORT_PAGE_SWITCHED:"Internal/Report/pageSwitched",REPORT_NEW_ON_LIST:"Internal/Report/newOnList",GAME_SETTINGS_CHANGED:"Internal/Game/settingsChanged",SHOW_CONTEXT_MENU:"Internal/ContextMenuShow",DESTROY_CONTEXT_MENU:"Internal/ContextMenuDestroy",TRACKING_EMAIL_VALIDATE:"Internal/Tracking/emailValidate",TRIBE_TAB_SELECTED:"Internal/Tribe/tabSelected",TRIBE_TAB_SET:"Internal/Tribe/tabSet",TRIBE_PROFILE_DATA_SET:"Internal/Tribe/profileDataSet",RESOURCE_DEPOSIT_JOB_COLLECTIBLE:"Internal/ResourceDeposit/collectible",WINDOW_CLOSED:"Internal/Window/closed",TRACKING_SNIPPET_VALID:"TrackingSnippet/valid",TRACKING_SNIPPET_EVENT:"TrackingSnippet/event",REGISTER_SUCCESS:"Register/success",MAINTENANCE_BEGIN:"System/maintenance",MAINTENANCE_END:"System/maintenanceEnd",LOGIN_SUCCESS:"Login/success",LOGIN_ERROR:"Login/error",LOGOUT_SUCCESS:"Logout/success",RECONNECTED:"Authentication/reconnected",CHARACTER_SELECTED:"Authentication/characterSelected",CHARACTER_CREATED:"Authentication/characterCreated",CHARACTER_PROFILE:"Character/profile",CHARACTER_PROFILE_SET:"Character/profileSet",CHARACTER_VILLAGE_CREATED:"Character/villageCreated",CHARACTER_INFO:"Character/info",CHARACTER_GAME_OVER:"Character/gameOver",VILLAGE:"Village/village",VILLAGE_WALL_INFO:"Village/wallInfo",VILLAGE_ARMY_CHANGED:"Village/armyChanged",VILLAGE_UNITSCREEN_INFO:"UnitScreen/data",VILLAGE_BATCH_VILLAGE_DATA:"VillageBatch/villageData",BUILDING_LEVEL_CHANGED:"Building/levelChanged",BUILDING_QUEUE:"Building/queue",BUILDING_CHAPEL_DESTROYED:"Building/chapelDestroyed",BUILD_JOB_CANCELLED:"Building/jobCancelled",MESSAGE_WELCOME:"System/welcome",MESSAGE_SUCCESS:"Message/success",MESSAGE_ERROR:"Message/error",MESSAGE_DEBUG:"Message/debug",MESSAGE_PARTY:"Message/party",MESSAGE_SMART_TIP:"Internal/Message/smartTip",ACADEMY_INFO:"Academy/info",ACADEMY_MINTED_COINS:"Academy/mintedCoins",ACADEMY_TRAINING_CANCELLED:"Academy/trainingCancelled",ACADEMY_TRAINING_COMPLETE:"Academy/trainingComplete",ACADEMY_TRAINING_NOBLE:"Academy/trainingNoble",ACADEMY_TRAINING:"Academy/training",ARMY_PRESET_ASSIGNED:"ArmyPreset/assigned",ARMY_PRESET_DELETED:"ArmyPreset/deleted",ARMY_PRESET_FOR_VILLAGE:"ArmyPreset/forVillage",ARMY_PRESET_LIST:"ArmyPreset/presetList",ARMY_PRESET_SAVED:"ArmyPreset/saved",BUILDING_TEARING_DOWN:"Building/tearingDown",BUILDING_UPGRADING:"Building/upgrading",CHARACTER_RESTARTED:"Character/restarted",CHARACTER_ROLE_CHANGED:"Character/roleChanged",CHARACTER_VILLAGES:"Village/characterVillages",GLOBAL_INFORMATION:"GlobalInformation/info",MEDIA_PARTNER_CAMPAIGN:"MediaPartner/activeCampaigns",COOP_INVITATION_ACCEPTED:"Coop/invitationAccepted",COOP_INVITATION_DECLINED:"Coop/invitationDeclined",COOP_STATUS:"Coop/coopStatus",COOP_INVITATION_RECEIVED:"Coop/invitationReceived",COOP_INVITATION_SENT:"Coop/invitationSent",COOP_INVITATION_WITHDRAWN:"Coop/invitationWithdrawn",COOP_CHARACTER_REMOVED:"Coop/playerRemoved",COOP_CHARACTER_LEFT:"Coop/characterLeft",COMMAND_CANCELLED:"Command/cancelled",COMMAND_IGNORED:"Command/ignored",COMMAND_OWN_COMMANDS:"Command/ownCommands",COMMAND_SENT:"Command/sent",COMMAND_RETURNED:"Command/returned",COMMAND_INCOMING:"Command/incoming",COMMAND_WITHDRAWING_SUPPORT:"Command/withdrawingSupport",COMMAND_WITHDRAWN_SUPPORT:"Command/supportWithdrawn",COMMAND_SUPPORT_ARRIVED:"Command/supportArrived",GAME_DATA_BASE_DATA:"GameData/baseData",GAME_DATA_UNITS:"GameData/units",GAME_DATA_BUILDINGS:"GameData/buildings",GAME_DATA_RESEARCHES:"GameData/research",GAME_DATA_COSTS_PER_COIN:"GameData/costsPerCoin",GAME_DATA_PREMIUM_COSTS:"GameData/premium",GAME_DATA_OFFICERS:"GameData/officers",MAP_DELETED_LAYER:"Map/deletedLayer",MAP_LAYER:"Map/layer",MAP_LAYERS:"Map/layers",MAP_SAVED_LAYER:"Map/savedLayer",MAP_VILLAGE_DATA:"Map/villageData",MAP_VILLAGE_DETAILS:"Map/villageDetails",MAP_KINGDOMS:"Map/kingdoms",MAP_PROVINCE:"Map/province",MAP_PROVINCE_RENAMED:"Map/renamedProvince",MAP_TUTORIAL_VILLAGE_SET:"Map/tutorialVillageSet",MAP_NEW_VILLAGE:"Map/newVillage",REPORT_DELETED:"Report/deleted",REPORT_LIST:"Report/list",REPORT_MARKED_READ:"Report/markedRead",REPORT_MARKED_UNREAD:"Report/markedUnread",REPORT_NEW:"Report/new",REPORT_VIEW:"Report/view",REPORT_TOGGLED_FAVOURITE:"Report/toggledFavourite",REPORT_SETTINGS_SAVED:"Report/settingsSaved",REPORT_MARKED_SEEN:"Report/markedSeen",RESEARCH_UNLOCKED:"Research/unlocked",RESEARCH_RESEARCHED:"Internal/research/researched",SCOUTING_CANCELLED:"Scouting/cancelled",SCOUTING_COUNTER_MEASURE_SET:"Scouting/counterMeasureSet",SCOUTING_INFO:"Scouting/info",SCOUTING_RECRUITING_CANCELED:"Scouting/recruitingCanceled",SCOUTING_RECRUITING_STARTED:"Scouting/recruitingStarted",SCOUTING_SENT:"Scouting/sent",SCOUTING_SPY_PRODUCED:"Scouting/spyProduced",SYSTEM_NIGHT_MODE:"System/nightMode",TIMELINE_TOGGLE:"Internal/Timeline/toggle",TIMELINE_RECRUITING_PREVIEW:"Internal/Timeline/recruitingPreview",TIMELINE_EVENT_DETAILS:"Timeline/eventDetails",TIMELINE_NEW_EVENT:"Timeline/newEvent",TIMELINE_EVENTS:"Timeline/events",TIMELINE_RETURNING_COMMAND:"Timeline/returningCommand",TRIBE_CREATED:"Tribe/created",TRIBE_DISBANDED:"Tribe/disbanded",TRIBE_LEFT:"Tribe/left",TRIBE_MEMBER_KICKED:"Tribe/memberKicked",TRIBE_MEMBER_LIST:"Tribe/memberList",TRIBE_MEMBER_RIGHTS_SET:"Tribe/memberRightsSet",TRIBE_MEMBER_TITLE_SET:"Tribe/memberTitleSet",TRIBE_MEMBER_TRUSTED_SET:"Tribe/memberTrusted",TRIBE_PRESETS_INDEX:"Tribe/rightPresets",TRIBE_PROFILE:"Tribe/profile",TRIBE_FOUNDER_UPDATED:"Tribe/founderPassed",TRIBE_JOINED:"Tribe/joined",TRIBE_WELCOME:"Tribe/welcome",TRIBE_SETTINGS_CHANGED:"Tribe/settingsChanged",TRIBE_APPLICATION_ACCEPTED:"TribeApplication/accepted",TRIBE_APPLICATION_CREATED:"TribeApplication/created",TRIBE_APPLICATION_REJECTED:"TribeApplication/rejected",TRIBE_APPLICATION_ABORTED:"TribeApplication/aborted",TRIBE_APPLICATION_INDEX:"TribeApplication/tribeApplications",TRIBE_APPLICATION_OWN:"TribeApplication/ownApplications",TRIBE_INVITATION_ACCEPTED:"TribeInvitation/accepted",TRIBE_INVITATION_REJECT:"TribeInvitation/rejected",TRIBE_INVITATION_ABORTED:"TribeInvitation/aborted",TRIBE_INVITATION_CREATED:"TribeInvitation/created",TRIBE_INVITATION_OWN:"TribeInvitation/ownInvitations",TRIBE_INVITATION_INDEX:"TribeInvitation/tribeInvitations",TRIBE_ICON_CHANGED:"Tribe/iconChanged",TRIBE_RELATION_CHANGED:"TribeRelation/changed",TRIBE_RELATION_LIST:"TribeRelation/list",TRIBE_ACHIEVEMENTS_SELECTED:"Tribe/achievementsSelected",TRIBE_ACHIEVEMENTS:"Achievement/tribeAchievements",TRIBE_TAB_DISCARD_CHANGED_SKILLS:"Internal/Tribe/tabDiscardChangedSettings",CHARACTER_ACHIEVEMENTS:"Achievement/characterAchievements",ACHIEVEMENTS_ALL:"Achievement/all",ACHIEVEMENTS_ACHIEVED:"Achievement/achieved",
ACHIEVEMENT_PROGRESS:"Achievement/progress",TRIBE_SKILL_DONATED:"TribeSkill/donated",TRIBE_SKILL_DONATION_RANKING:"TribeSkill/honorRanking",TRIBE_SKILL_ASSIGNED:"TribeSkill/assigned",TRIBE_SKILL_REASSIGNED:"TribeSkill/reassigned",TRIBE_SKILLS_INFO:"TribeSkill/info",VILLAGE_PROVINCE_VILLAGES:"Village/provinceVillages",VILLAGE_RESOURCE_INFO:"Village/resourceInfo",VILLAGE_RESOURCES_CHANGED:"Village/resourcesChanged",VILLAGE_STORAGE_INFO:"Village/storageInfo",VILLAGE_UNIT_INFO:"Village/unitInfo",VILLAGE_NAME_CHANGED:"Village/nameChanged",VILLAGE_OWNER_CHANGED:"Village/changeVillageOwner",HOSPITAL_PATIENT_RELEASED:"Hospital/released",HOSPITAL_PATIENT_HEALED:"Hospital/healed",WIDGET_WIDGETS:"Widget/widgets",WORLD_CONFIG:"WorldConfig/config",WORLD_CONFIG_UPDATE:"WorldConfig/updateConfig",TRADING_MERCHANT_STATUS:"Trading/merchantStatus",TRADING_OFFER_LIST:"Offer/list",TRADING_OFFER_CREATED:"Offer/created",TRADING_OFFER_REMOVED:"Offer/removed",TRADING_OFFER_ACCEPTED:"Offer/accepted",TRADING_TRANSPORT_NEW:"Transport/new",TRADING_TRANSPORT_INDEX:"Transport/list",TRADING_TRANSPORT_ARRIVED:"Transport/arrived",TRADING_TRANSPORT_RETURNED:"Transport/returned",TRADING_TRANSPORT_CANCELED:"Transport/canceled",PREMIUM_INSTANT_TRADED:"Trading/instantTradeCompleted",RANKING_CHARACTER_LIST:"Ranking/character",RANKING_TRIBE_LIST:"Ranking/tribe",MESSAGE_LIST:"Message/list",MESSAGE_VIEW:"Message/view",MESSAGE_SENT:"Message/sent",MESSAGE_NEW:"Message/new",MESSAGE_PARTICIPATNS_ADDED:"Message/participantsAdded",MESSAGE_CHAR_KICKED:"Message/characterKicked",MESSAGE_FOLDER_CHANGED:"Message/changedFolder",MESSAGE_DELETED:"Message/deleted",MESSAGE_MARKED_READ:"Message/markedRead",MESSAGE_MARKED_UNREAD:"Message/unmarkedRead",MESSAGE_CHAR_LEFT:"Message/characterLeft",FRIENDLIST:"Friendlist/list",FRIEND_ADDED:"Friendlist/new",FRIEND_REMOVED:"Friendlist/removed",FORCE_MODEL_UPDATE:"Specials/forceModelUpdate",EXCEPTION_DB:"Exception/DbException",EXCEPTION_SYSTEM:"Exception/SystemException",EXCEPTION_API:"Exception/ApiErrorException",EXCEPTION_UNMET_REQUIREMENTS:"Exception/UnmetRequirementsException",BARRACKS_RECRUIT_JOB_CANCELED:"Barracks/recruitJobCanceled",BARRACKS_RECRUIT_JOB_CREATED:"Barracks/recruitJobCreated",BARRACKS_RECRUIT_JOB_STARTED:"Barracks/recruitJobStarted",PRECEPTORY_RECRUIT_JOB_CANCELED:"Preceptory/recruitJobCanceled",PRECEPTORY_RECRUIT_JOB_CREATED:"Preceptory/recruitJobCreated",PRECEPTORY_RECRUIT_JOB_STARTED:"Preceptory/recruitJobStarted",ACADEMY_RECRUIT_JOB_CREATED:"Academy/recruitJobCreated",ACADEMY_RECRUIT_JOB_CANCELED:"Academy/recruitJobCanceled",BARBARIAN_PRODUCTION_BOOSTED:"Barbarian/productionBoosted",STATUE_RECRUIT_JOB_CREATED:"Statue/recruitJobCreated",STATUE_RECRUIT_JOB_CANCELED:"Statue/recruitJobCanceled",STATUE_RECRUIT_JOB_FINISHED:"Statue/recruitJobFinished",PALADIN_INFO:"Paladin/info",PALADIN_RELOCATED:"Paladin/relocated",PALADIN_RENAMED:"Paladin/renamed",PALADIN_ITEM_EQUIPPED:"Paladin/itemEquipped",PALADIN_UNLOCK_NEXT_ITEM:"Paladin/itemUpgraded",PALADIN_SUMMONED:"Paladin/summoned",COMMAND_RELOCATED:"Command/relocated",PREMIUM_SHOP_OFFERS:"Premium/shopOffers",PREMIUM_ITEM_BOUGHT:"Premium/itemBought",INVENTORY:"Premium/items",INVENTORY_ITEM_CHANGED:"Premium/itemChange",INVENTORY_MARKED_SEEN:"Premium/markedSeen",UNIT_RECRUIT_JOB_FINISHED:"Unit/recruitJobFinished",PREMIUM_CHANGED:"Premium/currencyChange",PREMIUM_PAYMENT_IFRAME_URL:"Premium/iframeUrl",PREMIUM_DAILY_UNIT_DEAL_OFFERS:"DailyUnitDeal/offers",PREMIUM_DAILY_UNIT_DEAL_ACCEPTED:"DailyUnitDeal/accepted",PREMIUM_DAILY_UNIT_DEAL_REROLLED:"DailyUnitDeal/rerolled",RESOURCE_DEPOSIT_INFO:"ResourceDeposit/info",RESOURCE_DEPOSIT_JOBS_REROLLED:"ResourceDeposit/rerolled",RESOURCE_DEPOSIT_JOB_STARTED:"ResourceDeposit/jobStarted",RESOURCE_DEPOSIT_JOB_COLLECTED:"ResourceDeposit/collected",PRECEPTORY_ORDER_SELECTED:"Preceptory/orderSelected",PRECEPTORY_ORDER_RESET:"Preceptory/orderReset",PRECEPTORY_INITIALIZED:"Preceptory/initialized",AUTOCOMPLETE_CHARACTER:"Autocomplete/characterNames",AUTOCOMPLETE_TRIBE:"Autocomplete/tribeNames",AUTOCOMPLETE_VILLAGE:"Autocomplete/villageNames",SETTINGS_ACCOUNT_INFO:"Settings/accountInfo",SETTINGS_PASSWORD_CHANGED:"Settings/passwordChanged",QUESTS_QUEST_LINES:"Quest/questLines",QUESTS_QUEST_LINE_STARTED:"Quest/questLineStarted",QUESTS_QUEST_PROGRESS:"Quest/progress",QUESTS_QUEST_FINISHED:"Quest/closed",QUESTS_QUEST_LINE_FINISHED:"Internal/QuestLineFinished",QUESTS_QUEST_MARKED_READ:"Quest/markedRead",FORUM_FORUM_DELETED:"Forum/deleted",FORUM_FORUM_CREATED:"Forum/created",FORUM_THREAD_CREATED:"Forum/threadCreated",FORUM_POST_CREATED:"Forum/postCreated",FORUM_POST_DELETED:"Forum/postDeleted",FORUM_POST_EDITED:"Forum/postEdited",FORUM_THREAD_LIST:"Forum/threadList",FORUM_THREAD_RENAMED:"Forum/threadRenamed",FORUM_THREADS_MARKED_READ:"Forum/threadsMarkedRead",FORUM_THREADS_MARKED_UNREAD:"Forum/threadsMarkedUnread",FORUM_THREADS_PINNED:"Forum/threadsPinned",FORUM_THREADS_UNPINNED:"Forum/threadsUnpinned",FORUM_THREADS_MOVED:"Forum/threadsMoved",FORUM_THREADS_CLOSED:"Forum/threadsClosed",FORUM_THREADS_REOPENED:"Forum/threadsReopened",FORUM_FORUM_MARKED_READ:"Forum/forumMarkedRead",FORUM_FORUM_MARKED_UNREAD:"Forum/forumMarkedUnread",FORUM_THREADS_DELETED:"Forum/threadsDeleted",FORUM_FORUM_RENAMED:"Forum/renamed",FORUM_FORUM_ORDER_SET:"Forum/orderSet",FORUM_THREADS_UPDATED:"Internal/threadsUpdated",FORUM_FORUM_LIST:"Forum/forumList",GROUPS_INDEX:"Group/groups",GROUPS_CREATED:"Group/new",GROUPS_DESTROYED:"Group/deleted",GROUPS_UPDATED:"Group/changed",GROUPS_VILLAGES:"Icon/villages",GROUPS_VILLAGE_LINKED:"Group/linked",GROUPS_VILLAGE_UNLINKED:"Group/unlinked",GROUPS_VILLAGE_LINKED_SYSTEM:"Icon/command",CLOSED_BETA_REGISTERED:"ClosedBeta/registered",CLOSED_BETA_ENTERED:"ClosedBeta/entered",CHAT_RECEIVED_TRIBE:"Chat/tribe",CHAT_TRIBE_HISTORY:"Chat/tribeHistory",PLAYEREMAIL_CHANGE_REQUESTED:"PlayerEmail/changeRequested",SECOND_VILLAGE_JOB_STARTED:"SecondVillage/jobStarted",SECOND_VILLAGE_JOB_COLLECTED:"SecondVillage/jobCollected",SECOND_VILLAGE_INFO:"SecondVillage/info",SECOND_VILLAGE_VILLAGE_CREATED:"SecondVillage/villageCreated",SECOND_VILLAGE_VILLAGE_RENAMED:"SecondVillage/renamed",INVITE_FRIEND_INFO:"InvitePlayer/info",INVITE_FRIEND_INVITATION_SENT:"InvitePlayer/invitationSent",INTERSTITIALS_RECEIVED:"Crm/interstitials",INTERSTITIAL_REJECTED:"Crm/interstitialRejected",INTERSTITIAL_ACCEPTED:"Crm/interstitialAccepted",IGM_ACCEPTED:"Crm/igmAccepted",EFFECT_EFFECTS:"Effect/effects",EFFECT_CHANGED:"Effect/changed",EFFECT_EXPIRED:"Effect/expired",TUTORIAL_SKIPPED:"Tutorial/skipped"}})}),define("providers/TimelineDataProvider",["app"],function(a){a.factory("timelineDataProvider",function(){return{BUILD:"build",RECRUIT:"recruit",PREVIEW:"preview",JOB:"job",COMMAND:"command",INCOMING_ATTACK:"incoming_attack",INCOMING_SUPPORT:"incoming_support",RETURNING_ATTACK:"returning_attack",RETURNING_SUPPORT:"returning_support",SCOUTING:"scouting",MIXED:"mixed",MIXED_JOB:"mixed-job",INCOMING_UNITS:"mixed-incoming-units",INCOMING_MIXED:"mixed-incoming",RESOURCE_DEPOSIT:"resource_deposit",SECOND_VILLAGE:"second_village",MAX_LENGTH:6,NIGHT_START:"night_start",NIGHT_END:"night_end"}})}),define("providers/CommandListModelProvider",["app","models/CommandListModel"],function(a,b){a.factory("commandListModelProvider",[function(){return function(a,c){return new b(a,c)}}])}),define("providers/TradeListModelProvider",["app","models/TradeListModel"],function(a,b){a.factory("tradeListModelProvider",[function(){return function(a,c){var d=new b(a);return c&&d.createModels(c),d}}])}),define("providers/WorldConfigModelProvider",["app","models/WorldConfigModel"],function(a,b){a.factory("worldConfigModelProvider",[function(){return function(a){return new b(a)}}])}),define("providers/PreceptoryOrderTypeProvider",["app"],function(a){a.factory("preceptoryOrderTypeProvider",function(){return{TEMPLAR:"templar",TEUTONIC:"teutonic",THIEVES:"thieves"}})}),define("providers/OrderTypeProvider",["app"],function(a){a.factory("orderTypeProvider",function(){var a=-1,b=1,c=function(c){return a===c?b:a};return{ASC:a,DESC:b,DEFAULT:a,toggle:c}})}),define("providers/ConversationModelProvider",["app","models/ConversationModel"],function(a,b){a.factory("conversationModelProvider",[function(){return function(a,c){return new b(a,c)}}])}),define("providers/FriendListModelProvider",["app","models/FriendListModel"],function(a,b){a.factory("friendListModelProvider",[function(){return function(a){return new b(a)}}])}),define("providers/PremiumActionTypeProvider",["app"],function(a){var b=["BUY_ITEM","UPGRADE_BUILDING","PALADIN_WEAPON_UNLOCK","PALADIN_INSTANT_RECRUIT","WOOD_BOOSTER","CLAY_BOOSTER","IRON_BOOSTER","OFFICER_GRANDMASTER","OFFICER_LOOT_MASTER","OFFICER_MEDIC","OFFICER_DRUMMER","OFFICER_BASTARD","OFFICER_TACTICIAN","OFFICER_RANGER","INSTANT_BUILD","BUILD_COST_REDUCTION","UNLOCK_RESEARCH","INSTANT_TRADE","INSTANT_TRANSPORT","VILLAGE_RELOCATE_RANDOM","VILLAGE_RELOCATE_CHOOSEN","NOOB_PROTECTION_INCREASE","LOOT_PROTECTION","BUILD_QUEUE_INCREASE","VILLAGE_MANAGER","ADDITIONAL_GAMBLING_TRY","SECOND_QUEUE_JOB","TRIBE_DONATE"];a.factory("premiumActionTypeProvider",function(){var a=function(a){var b=this;a.forEach(function(a){b[a]=a})};return a.prototype.getOrder=function(){return b},new a(b)})}),define("providers/InventoryItemTypeProvider",["app"],function(a){var b,c=[{BOOST_WOOD:"premium_boost_wood"},{BOOST_CLAY:"premium_boost_clay"},{BOOST_IRON:"premium_boost_iron"},{BOOST_PROTECTION:"premium_loot_protection"},{OFFICER_LEADER:"premium_officer_leader"},{OFFICER_LOOT_MASTER:"premium_officer_loot_master"},{OFFICER_MEDIC:"premium_officer_medic"},{OFFICER_BASTARD:"premium_officer_bastard"},{OFFICER_SUPPORTER:"premium_officer_supporter"},{OFFICER_SCOUT:"premium_officer_scout"},{PALADIN_WEAPON:"premium_paladin_weapon"},{DAILY_UNIT_SLOT:"daily_unit"},{DAILY_UNIT_REROLL:"daily_unit_reroll"},{RESOURCE_DEPOSIT_REROLL:"resource_deposit_reroll"},{PALADIN_INSTANT_RECRUIT:"premium_paladin_instant_item"},{INSTANT_BUILD:"premium_instant_build"},{INSTANT_RECRUIT:"premium_instant_recruit"},{SECOND_QUEUE_JOB:"premium_second_queue_job"},{BUILD_COST_REDUCTION:"premium_build_cost_reduction"},{BUILD_QUEUE_SLOT:"premium_build_queue_slot"},{RESEARCH:"premium_research"},{RESET_ORDER:"premium_reset_order"},{TRADE:"premium_trade"},{INSTANT_TRANSPORT:"premium_instant_transport"},{HOSPITAL_BOOST:"premium_hospital_boost"},{VILLAGE_RELOCATE_RANDOM:"premium_village_relocate_random"},{VILLAGE_RELOCATE_CHOSEN:"premium_village_relocate_chosen"},{NOOB_PROTECTION:"premium_noob_protection"},{LOOT_PROTECTION:"premium_loot_protection"},{VILLAGE_MANAGER:"premium_village_manager"},{GAMBLING:"premium_gambling"},{PACKAGE:"premium_package"},{TRIBE_DONATE:"tribe_donate"},{EFFECT:"effect"},{REWARD_UNITS:"reward_units"},{REWARD_RESOURCES:"reward_resources"},{REWARD_RESOURCE_PACKAGE:"reward_resource_package"}];a.factory("inventoryItemTypeProvider",function(){var a=function(a){var c=this;a.forEach(function(a){var b=Object.keys(a)[0];c[b]=a[b]}),b=a.map(function(a){return Object.keys(a)[0]})};return a.prototype.getOrder=function(){return b},a.prototype.getKey=function(a){var b;for(b in this)if(this.hasOwnProperty(b)&&this[b]===a)return b;return null},new a(c)})}),define("providers/QuestGoalTypeProvider",["app"],function(a){a.factory("questGoalTypeProvider",function(){return{ACCEPT_MARKET_OFFERS:"accept_market_offers",ACTIVATE_COUNTERMEASURES:"activate_countermeasures",CLOSE_QUEST_LINE_QUESTS:"close_quest_line_quests",CREATE_MARKET_OFFERS:"create_market_offers",CREATE_TRIBE:"create_tribe",HAVE_BUILDING_LEVEL:"have_building_level",HAVE_SPIES:"have_spies",INVITE_TRIBE_MEMBERS:"invite_tribe_members",KILL_SPIES:"kill_spies",PERFORM_SCOUTING:"perform_scouting",RECRUIT_PALADIN:"recruit_paladin",RENAME_PALADIN:"rename_paladin",RENAME_TRIBE:"rename_tribe",SEND_COMMAND:"send_command",SEND_RESOURCES:"send_resources",TRAIN_SPIES:"train_spies",USE_ITEM:"use_item"}})}),define("providers/SocketProvider",["app"],function(a){a.provider("$socket",[function(){this.responseInterceptors=[],this.$get=["$injector",function(a){var b=this.responseInterceptors,c={},d=function(d){b.forEach(function(b){c[b]||(c[b]=a.get(b)),c[b].handle(d)})};return{responseInterceptors:b,handleResponse:d}}]}])}),define("providers/model/AudioSpriteModelProvider",["app","howler","models/audio/AudioSpriteModel"],function(a,b,c){a.factory("audioSpriteModelProvider",[function(){return function(a,d,e){var f=new b.Howl(e),g=new c(a,d,e.sprite,f);return g}}])}),define("providers/ErrorTypeProvider",["app"],function(a){a.factory("errorTypeProvider",function(){var a={AUTH_INVALID_SESSION:"Authentication/invalidSession",AUTH_GLOBAL_BAN:"Authentication/playerIsBanned",AUTH_WORLD_BAN:"Authentication/playerIsBannedOnWorld",AUTH_UNKNOWN_PLAYER:"Authentication/unknownPlayerName",AUTH_INVALID_PASSWORD:"Authentication/incorrectPassword",AUTH_INVITATION_ALREADY_ACCEPTED:"InvitePlayer/alreadyAccepted",AUTH_OWNER_GLOBAL_BAN:"Authentication/ownerIsBanned",AUTH_OWNER_WORLD_BAN:"Authentication/ownerIsBannedOnWorld",AUTH_INCORRECT_PASSWORD:"Authentication/incorrectPassword",PLAYER_INVALID_NAME:"Player/invalidName",PLAYER_INVALID_EMAIL:"Player/invalidEmail",PLAYER_EMAIL_ALREADY_IN_USE:"Player/emailAlreadyInUse",PLAYER_EMAIL_ACTIVE_CHANGE_EXISTS:"PlayerEmail/activeChangeExists",PLAYER_PICK_DIFFERENT_PW:"Player/mustPickDifferentPassword",CHARACTER_WORLD_FULL:"Character/worldIsClosed",CHARACTER_NOT_FOUND:"Character/notFound",TRIBE_NOT_ENOUGH_POINTS:"Tribe/notEnoughPoints",TRIBE_NAME_ALREADY_TAKEN:"Tribe/nameAlreadyTaken",TRIBE_TAG_ALREADY_TAKEN:"Tribe/tagAlreadyTaken",TRIBE_NAME_CONTAINS_NO_LETTER:"Tribe/nameContainsNoLetter",TRIBE_TAG_CONTAINS_NO_LETTER:"Tribe/tagContainsNoLetter",TRIBE_NOT_FOUND:"Tribe/notFound",TRIBE_NAME_FORBIDDEN_CHARACTER:"Tribe/nameForbiddenCharacter",TRIBE_SKILL_MUST_MAINTAIN_MEMBER_LIMIT:"TribeSkill/mustMaintainMemberLimit",SECOND_VILLAGE_HAS_NO_SECOND_VILLAGE:"SecondVillage/hasNoSecondVillage",ARMY_PRESET_CANNOT_RECRUIT:"ArmyPreset/cannotRecruit",SCOUTING_NOT_ENOUGH_SPIES_FOR_SABOTAGE:"Scouting/notEnoughSpiesToSabotage",COOP_FLUCTUATION_LIMIT_REACHED:"Coop/fluctuationLimitReached",COOP_VALIDATED_EMAIL_NEEDED:"Coop/validatedEmailNeeded",COOP_MUST_BE_FOUNDER:"Coop/mustBeFounder",VILLAGE_INSUFFICIENT_RESOURCES:"Village/insufficientResources",MESSAGE_NOT_ENOUGH_POINTS:"Defcon/notEnoughPointsToWriteMessage",COMMAND_CANNOT_USE_PRESET:"Command/cannotUsePreset"};return a})}),define("providers/model/quest/QuestLineListModelProvider",["app","models/quest/QuestLineListModel"],function(a,b){a.factory("questLineListModelProvider",["questLineModelProvider",function(a){return function(c){var d=[];return c&&c.forEach(function(b){d.push(a(b))}),new b(d)}}])}),define("providers/model/quest/QuestLineModelProvider",["app","models/quest/QuestLineModel"],function(a,b){a.factory("questLineModelProvider",["questModelProvider",function(a){return function(c){var d=new b(c),e=[];return c.quests.forEach(function(b){e.push(a(b,d))}),d.setQuestModels(e),d}}])}),define("providers/model/quest/QuestModelProvider",["app","models/quest/QuestModel"],function(a,b){a.factory("questModelProvider",[function(){return function(a,c){return new b(a,c)}}])}),define("providers/providers",["conf/conf","providers/ResourceModelProvider","providers/CharacterModelProvider","providers/TimelineModelProvider","providers/PlayerModelProvider","providers/GameDataModelProvider","providers/GlobalInfoModelProvider","providers/VillageModelProvider","providers/BuildingDataModelProvider","providers/BuildingQueueModelProvider","providers/RouteProvider","providers/EventTypeProvider","providers/TimelineDataProvider","providers/CommandListModelProvider","providers/TradeListModelProvider","providers/WorldConfigModelProvider","providers/PreceptoryOrderTypeProvider","providers/OrderTypeProvider","providers/ConversationModelProvider","providers/FriendListModelProvider","providers/PremiumActionTypeProvider","providers/InventoryItemTypeProvider","providers/QuestGoalTypeProvider","providers/SocketProvider","providers/model/AudioSpriteModelProvider","providers/ErrorTypeProvider","providers/model/quest/QuestLineListModelProvider","providers/model/quest/QuestLineModelProvider","providers/model/quest/QuestModelProvider"],function(a){a.DEBUG}),define("factories/ScreenFactory",["app"],function(a){a.factory("screenFactory",["windowManagerService",function(a){var b="building_";return{get:function(c,d){return"market"===c?void a.getFullSize(b+c):void a.getScreen(b+c,d)}}}])}),define("factories/SpriteFactory",["app","conf/conf","construct/graph/Sprite"],function(a,b,c){a.factory("spriteFactory",["canvasAssetService","mapService",function(a,d){var e="noclip",f="redraw",g="zindex",h="origin";return{make:function(i){var j,k=a.getTileset(d.getTimeOfDay());switch(i){case"highlight":j=new c(k.highlight,i,k.highlight.width,k.highlight.height),j[h]=[-j.width>>1,-j.height>>1],j[e]=!0,j[f]=!0,j[g]=1/0;break;case"hover":j=new c(k.hover,i,k.hover.width,k.hover.height),j[e]=!0,j[f]=!0,j[g]=1/0;break;case"villageLocator":j=new c(k.villageLocator,i,k.villageLocator.width,k.villageLocator.height),j[e]=!0,j[f]=!0,j[g]=1/0,j.scale[3]=.5,j.alpha=b.VILLAGE_LOCATOR_ALPHA,j.setTranslation(-j.width/2,-j.height/4);break;case"villageLocatorPointer":j=new c(k.villageLocatorPointer,i,k.villageLocatorPointer.width,k.villageLocatorPointer.height),j[e]=!0,j[f]=!0,j[g]=1/0,j.scale[3]=.5,j.alpha=b.VILLAGE_LOCATOR_ALPHA,j.origin=[-k.villageLocator.width/2-j.width+2,-j.width/2];break;case"resourceDepositEffect":j=new c(k.resourceDepositEffect,i,k.resourceDepositEffect.width,k.resourceDepositEffect.height),j[e]=!0;break;case"secondVillageEffect":j=new c(k.secondVillageEffect,i,k.secondVillageEffect.width,k.secondVillageEffect.height),j[e]=!0;break;case"secondVillageHourglassEffect":j=new c(k.secondVillageHourglassEffect,i,k.secondVillageHourglassEffect.width,k.secondVillageHourglassEffect.height),j[e]=!0;break;case"productionBoost":j=new c(k.productionBoost,i,k.productionBoost.width,k.productionBoost.height),j[h]=[-j.width>>1,-j.height>>1],j[e]=!0;break;default:throw new Error}return j}}}])}),define("factories/SmartTipFactory",["app","helper/time","conf/tips","models/SmartTipModel"],function(a,b,c,d){a.factory("smartTipFactory",["$rootScope","$filter","modelDataService","windowDisplayService","buildingQueueService","screenFactory","windowManagerService","eventTypeProvider","secondVillageService","resourceDepositService","inventoryItemTypeProvider","mapService","socketService","routeProvider",function(a,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=c.TYPES,s=function(){var c=[new d(r.ATTACK_BARBARIANS,function(){return f.getSelectedVillage().getUnitCountInTown()>0&&0===f.getGameData().getNewReportCount()},function(){var a=f.getSelectedVillage();p.emit(q.MAP_GET_NEAREST_BARBARIAN_VILLAGE,{x:a.data.x,y:a.data.y},function(a){a&&o.jumpToVillage(a.x,a.y,a.id,!0)})}),new d(r.UNUSED_BOOSTERS,function(){return f.getInventory().hasAnyItem(n.BOOST_WOOD,n.BOOST_CLAY,n.BOOST_IRON)},function(){g.openInventory()}),new d(r.NO_TRIBE,function(){return null===f.getSelectedCharacter().getTribeId()},function(){g.openNoTribeScreen()}),new d(r.HOSPITALIZED_UNITS,function(){return!1}),new d(r.RECRUITING_QUEUE,function(){var a=200,b=f.getSelectedVillage().getResources().getResources(),c=b.clay>a&&b.food>a&&b.iron>a&&b.wood>a,d=f.getSelectedVillage().getRecruitJobListsContainer().combined;return c&&0===d.length},function(){i.get("barracks")}),new d(r.BUILDING_QUEUE,function(){var a,b,c,d=f.getGameData().getBuildings(),e=!1,g=f.getSelectedVillage().getBuildingData();for(a in d)if(b=g.getDataForBuilding(a),"possible"===b.upgradeability){e=!0;break}return c=h.getQueue(),0===c.length&&e},function(){i.get("headquarter")}),new d(r.LOOT_MASTER,function(){return f.getInventory().hasItem("premium_officer_loot_master")},function(b){var c=a.$new();c.name=b.type.split("officer_")[1],c.close=function(){c.closeWindow()},j.getModal("modal_officer_info",c)}),new d(r.RD_JOBS_COLLECTIBLE,function(){var a=f.getSelectedCharacter().getResourceDeposit();return a&&a.isAvailable()&&!!a.getCollectibleJobs()},function(){g.openResourceDeposit()}),new d(r.RD_JOBS_AVAILABLE,function(){var a,b=f.getSelectedCharacter().getResourceDeposit();return b&&b.isAvailable()?(a=b.getReadyJobs(),!b.getCurrentJob()&&a&&a.length>0):!1},function(){g.openResourceDeposit()}),new d(r.RD_REROLL_AVAILABLE,function(){var a,b=f.getSelectedCharacter().getResourceDeposit(),c=f.getInventory();return b&&b.isAvailable()?(a=b.getReadyJobs(),(!a||0===a.length)&&c.hasItem(n.RESOURCE_DEPOSIT_REROLL)):!1},function(){g.openResourceDeposit()}),new d(r.TRIBE_INVITATION,function(a){var b=f.getSelectedCharacter().getTribeInvitations().getNewInvitationCount();return a.data.textParam1=b,!!b},function(){g.openNoTribeScreen()})];return f.getWorldConfig().isSecondVillageEnabled()&&c.push(new d(r.SECOND_VILLAGE,function(a){var b,c,d,e,g,h,i=f.getSelectedCharacter();return i.getSecondVillageStatus()?(a.disable(),!1):((b=i.getSecondVillage())&&b.isAvailable()&&(d=l.getCurrentDayJobs(b.data.jobs,b.data.day),e=l.getCollectedJobs(b.data.jobs),g=f.getSelectedVillage().getResources().getResources(),c=l.getAvailableJobs(d,e,g,[]),h=!!l.getJobInProgress(b.data.jobs)),!h&&!!Object.keys(c||[]).length)},function(){g.openSecondVillage()},{hasJobInProgress:!1,availableJobs:0}),new d(r.SECOND_VILLAGE_EXPIRE,function(c){var d,g,h,i,j=f.getSelectedCharacter(),k=c.data.featureDuration/1e3/60/60/24,l=Date.now();if(j)return j.getSecondVillageStatus()?(c.disable(),!1):(i=j.getSecondVillage(),(d=i.getExpirationTime())&&i.isAvailable()?(c.data.textParam1=e("readableDateFilter")(d,a.loc.ale),c.data.textParam2=k,g=d-c.data.featureDuration,h=g+b.inMS.day,g>l||l>h?!1:!0):!1)},function(){g.openSecondVillage()},{featureDuration:432e6})),c};return{getTips:s}}])}),define("factories/factories",["conf/conf","factories/ScreenFactory","factories/SpriteFactory","factories/SmartTipFactory"],function(a){a.DEBUG}),define("handlers/InventoryModelHandler",["app","models/InventoryModel"],function(a,b){a.factory("inventoryModelHandler",["eventTypeProvider","modelDataService",function(a,c){var d={},e=function(a){var d=c.getSelectedCharacter(),e=new b(a.inventory);d.setInventory(e)},f=function(a){c.getInventory().itemChanged(a)},g=function(){c.getInventory().markSeen()};return d[a.INVENTORY]=e,d[a.INVENTORY_ITEM_CHANGED]=f,d[a.INVENTORY_MARKED_SEEN]=g,d}])}),define("handlers/QuestLineModelHandler",["app"],function(a){a.factory("questLineModelHandler",["$rootScope","eventTypeProvider","modelDataService","questLineListModelProvider","questLineModelProvider",function(a,b,c,d,e){var f={},g=function(a){var b=c.getQuestLineListModel(),d=b.getQuestById(a.quest_id);d&&d.getGoals()[a.number]&&(d.getGoals()[a.number].progress=a.progress)},h=function(a){c.getSelectedCharacter().setQuestLineListModel(d(a.quest_lines))},i=function(a){c.getSelectedCharacter().getQuestLineListModel().addQuestLineModel(e(a))},j=function(d){var e,f,g=c.getQuestLineListModel(),h=g.getQuestById(d.quest_id);h&&(e=h.getQuestLineModel(),e&&(h.setClosed(!0),e.setProgress(d.quest_line_progress),e.isFinished()&&(f=e.getName(),g.removeQuestLineByName(f)&&a.$broadcast(b.QUESTS_QUEST_LINE_FINISHED,f))))},k=function(a){var b,d=c.getQuestLineListModel(),e=d.getQuestById(a.quest_id);e&&(e.markAsRead(),b=e.getQuestLineModel(),b&&b.markAsRead())};return f[b.QUESTS_QUEST_LINES]=h,f[b.QUESTS_QUEST_LINE_STARTED]=i,f[b.QUESTS_QUEST_PROGRESS]=g,f[b.QUESTS_QUEST_FINISHED]=j,f[b.QUESTS_QUEST_MARKED_READ]=k,f}])}),define("handlers/TradeListModelHandler",["app"],function(a){a.factory("tradeListModelHandler",["$rootScope","eventTypeProvider","modelDataService","villageService","routeProvider","tradeListModelProvider",function(a,b,c,d,e,f){var g={},h=function(d){var e=c.getSelectedVillage(),g=e.getTradeListModel();void 0!==g?g.createModels(d.transports):g=e.setTradeListModel(f(e.getId(),d.transports)),a.$broadcast(b.MAP_MOVEMENT_UPDATE)},i=function(d){var e=c.getSelectedVillage(),f=e.getTradeListModel();f&&(f.createModel(d),a.$broadcast(b.MAP_MOVEMENT_UPDATE))},j=function(f){var g=c.getSelectedVillage(),h=g.getTradeListModel();h&&h.removeId(f.transport_id)&&(a.$broadcast(b.MAP_MOVEMENT_UPDATE),window.injector.get("socketService").emit(e.TRADING_GET_TRANSPORTS,d.villageTransportListParams(g.getId())))};return g[b.TRADING_TRANSPORT_INDEX]=h,g[b.TRADING_TRANSPORT_NEW]=i,g[b.TRADING_TRANSPORT_ARRIVED]=j,g[b.TRADING_TRANSPORT_RETURNED]=j,g[b.TRADING_TRANSPORT_CANCELED]=j,g}])}),define("handlers/InviteFriendHandler",["app","helper/time"],function(a,b){a.factory("inviteFriendHandler",["$rootScope","modelDataService","eventTypeProvider","inviteFriendService",function(a,c,d,e){var f={},g=function(a){var b=e.getFakeVillage();b&&e.removeFakeVillage(),a&&e.spawnFakeVillage(a)},h=function(a,c){if(!a)return!1;if(!c)return!1;var d=Date.now(),e=b.server2ClientTime(c);return d>e?!1:!0},i=function(a){var b,d,e,f,i=c.getSelectedCharacter();a&&(d=a.invites_left,e=a.end_date,f=a.reward_point_goal,h(d,e)&&(b={x:void 0===a.x?a.next_x:a.x,y:void 0===a.y?a.next_y:a.y},i.setInviteInfo(b,a.rewards,f)),g(b))};return f[d.INVITE_FRIEND_INFO]=i,f[d.INVITE_FRIEND_INVITATION_SENT]=i,f}])}),define("handlers/GameDataResearchesModelHandler",["app","models/GameDataResearchesModel"],function(a,b){a.factory("gameDataResearchesModelHandler",["eventTypeProvider","modelDataService",function(a,c){var d={},e=function(a){var d=c.getGameData();d.setResearchesData(new b(a))};return d[a.GAME_DATA_RESEARCHES]=e,d}])}),define("handlers/RecruitJobHandler",["app","conf/recruitingQueueTypes"],function(a,b){a.factory("recruitJobHandler",["$rootScope","routeProvider","eventTypeProvider","modelDataService",function(a,c,d,e){var f={},g=function(b){var c=e.getSelectedVillage(),f=c.getTimeline();c&&b.village_id===c.getId()&&(b.job_id=b.slot?b.village_id.toString()+b.slot.toString():b.job_id,c.removeRecruitJob(b.job_id),a.$broadcast(d.RECRUIT_JOB_REMOVED),f.removeEvent(b.job_id))},h=function(c,f){var g=e.getSelectedVillage(),h=g.getTimeline(),i={};g&&f.village_id===g.getId()&&(g.addRecruitJob(c,f),a.$broadcast(d.RECRUIT_JOB_ADDED),i=c===b.TAVERN?{type:"recruit",unit_type:"spy",amount:1,time:f.time_completed,id:f.village_id.toString()+f.slot.toString(),requestSent:!0,details:{amount:1}}:{type:"recruit",unit_type:f.unit_type,id:f.job_id,time:f.start_time+f.time_per_unit*f.amount/e.getWorldConfig().getSpeed(),amount:f.amount},h.insert(i))},i=function(a,b){var c=e.getSelectedVillage(),d={};d[a]=[b],c.setRecruitingQueues(d)},j=function(a){h(b.PRECEPTORY,a)},k=function(a){h(b.BARRACKS,a)},l=function(a){i(b.BARRACKS,a)},m=function(a){i(b.PRECEPTORY,a)},n=function(a){h(b.ACADEMY,a)},o=function(a){g(a),window.injector.get("socketService").emit(c.ACADEMY_GET_INFO,{village_id:e.getSelectedVillage().getId()})},p=function(a){h(b.STATUE,a)},q=function(a){h(b.TAVERN,a)},r=function(a){var c=e.getSelectedVillage(),d=c.getRecruitingQueue(b.STATUE);c.getId()===a.village_id&&d.removeRecruitJob(a.recruit_job_id)};return f[d.BARRACKS_RECRUIT_JOB_CREATED]=k,f[d.BARRACKS_RECRUIT_JOB_STARTED]=l,f[d.PRECEPTORY_RECRUIT_JOB_CREATED]=j,f[d.PRECEPTORY_RECRUIT_JOB_STARTED]=m,f[d.ACADEMY_RECRUIT_JOB_CREATED]=n,f[d.STATUE_RECRUIT_JOB_CREATED]=p,f[d.SCOUTING_RECRUITING_STARTED]=q,f[d.BARRACKS_RECRUIT_JOB_CANCELED]=g,f[d.PRECEPTORY_RECRUIT_JOB_CANCELED]=g,f[d.ACADEMY_RECRUIT_JOB_CANCELED]=o,f[d.STATUE_RECRUIT_JOB_CANCELED]=g,f[d.UNIT_RECRUIT_JOB_FINISHED]=g,f[d.SCOUTING_RECRUITING_CANCELED]=g,f[d.PALADIN_SUMMONED]=r,f}])}),define("handlers/EffectModelHandler",["app","models/EffectListModel","conf/effectTypes"],function(a,b,c){a.factory("effectModelHandler",["modelDataService","eventTypeProvider","resourceService",function(a,d,e){var f={VILLAGE:"village",TRIBE:"tribe",CHARACTER:"character"},g={},h=function(b){var c,d=a.getSelectedVillage(),e=a.getSelectedCharacter();return d&&b.scope===f.VILLAGE&&(c=d.getEffectList()),!e||b.scope!==f.TRIBE&&b.scope!==f.CHARACTER||(c=e.getEffectList()),c},i=function(a){var b,d=h(a);d&&(b=d.getEffectById(a.effect_id),b?d.updateEffect(a):d.addEffect(a),a.type===c.STORAGE_CAPACITY_INCREASE&&e.updateMaxStorage())},j=function(a){var b=h(a),d=b.getEffectById(a.effect_id);d&&b.removeEffect(d.id),a.type===c.STORAGE_CAPACITY_INCREASE&&e.updateMaxStorage()},k=function(c){a.getSelectedCharacter().setEffectList(new b(c)),e.updateMaxStorage()};return g[d.EFFECT_EFFECTS]=k,g[d.EFFECT_CHANGED]=i,g[d.EFFECT_EXPIRED]=j,g}])}),define("handlers/CommandHandler",["app","helper/dataconversion"],function(a,b){a.factory("commandHandler",["$rootScope","modelDataService","timelineDataProvider","eventTypeProvider","commandListModelProvider",function(a,c,d,e,f){var g={},h=function(f){var g=c.getSelectedVillage(),h=g.getTimeline(),i=g.getCommandListModel(),j=b.command(f);"support"===j.type&&j.returning&&h.insert({type:d.RETURNING_SUPPORT,id:f.id,time:f.time_completed}),j.startVillageId===g.getId()&&i.add(j),a.$broadcast(e.MAP_MOVEMENT_UPDATE)},i=function(a){var b,d,e=c.getSelectedVillage();b=e.getTimeline(),d=c.getSelectedCharacter().getGlobalInfo(),b.removeEvent(a.command_id),d.removeCommand(a.command_id)},j=function(a){var b=c.getSelectedVillage(),d=b.getTimeline(),e=b.getCommandListModel();e.remove(a.command_id),d.removeEvent(a.command_id)},k=function(a){var b=c.getSelectedVillage().getTimeline(),d=c.getSelectedCharacter().getGlobalInfo();switch(a.type){case"support":case"attack":return d.insertCommand(a),b.insert({type:"incoming_"+a.type,id:a.id,time:a.time_completed})}},l=function(a,b){var d,e=c.getSelectedVillage(),g=a.length;if(e.getId()===b&&(d=e.getCommandListModel()))for(;g--;)d.add(a[g]);else e.setCommandListModel(f(a,b))},m=function(a){l(a.commands.map(b.command),a.village_id)},n=function(a){var d=c.getSelectedVillage(),e=d.getTimeline();a.id===d.getId()&&(a.commands.forEach(function(a){"forward"!==a.direction&&e.insert({type:"scouting",subType:a.type,id:a.id,time:a.time_completed})}),d.getCommandListModel().flush(Date.now()+250),l(a.commands.map(function(a){return b.scouting(d,a)}),a.id))},o=function(d){var f=c.getSelectedVillage(),g=f.getCommandListModel(),h=f.getTimeline();d.start_village_id===f.getId()&&("back"===d.direction&&h.insert({type:"scouting",subType:d.type,id:d.id,time:d.time_completed}),g.add(b.scouting(f,d)),a.$broadcast(e.MAP_MOVEMENT_UPDATE))},p=function(a){var b=c.getSelectedVillage(),e=b.getTimeline();b.getId()===a.origin_id&&e.insert({type:d.RETURNING_ATTACK,id:a.id,time:a.arrival,losses:a.losses,haul:a.haul})};return g[e.TIMELINE_RETURNING_COMMAND]=p,g[e.COMMAND_SENT]=h,g[e.COMMAND_CANCELLED]=i,g[e.COMMAND_INCOMING]=k,g[e.COMMAND_RETURNED]=j,g[e.COMMAND_SUPPORT_ARRIVED]=j,g[e.COMMAND_OWN_COMMANDS]=m,g[e.SCOUTING_SENT]=o,g[e.SCOUTING_INFO]=n,g}])}),define("handlers/ForumHandler",["app","models/TribeForumThreadListModel"],function(a,b){a.factory("forumHandler",["$rootScope","modelDataService","eventTypeProvider","forumThreadService",function(a,c,d,e){var f={},g=function(a,b){var d=c.getTribeForumThreadListModel();d&&d.closeThreads(a.thread_ids,b)},h=function(a,b){var d=c.getTribeForumThreadListModel();d&&d.readThreads(a.thread_ids,b?c.getPlayer().getId():0),e.updateNewThreadCount(a.thread_ids,!b)},i=function(a,b){var d=c.getTribeForumThreadListModel();d&&d.readThreads(a.thread_ids,b?c.getPlayer().getId():0),e.updateNewThreadCount(a.thread_ids,!b)},j=function(a){var b=c.getTribeForumThreadListModel();e.updateNewThreadCount(a.thread_ids),b&&(b.deleteThreads(a.forum_id,a.thread_ids),b.deleteForum(a.forum_id))},k=function(e){c.getTribeForumThreadListModel()||c.setTribeForumThreadListModel(new b),c.getTribeForumThreadListModel().addThreadsForForum(e),a.$broadcast(d.FORUM_THREADS_UPDATED,{ids:[e.forum_id]})},l=function(b){var e=c.getTribeForumThreadListModel();e&&(e.addThread(b.thread),a.$broadcast(d.FORUM_THREADS_UPDATED,{ids:[b.thread.forum_id]})),b.thread.reader_id!==c.getPlayer().getId()&&i({thread_ids:[b.thread.id]},!1)},m=function(a){var b=c.getTribeForumThreadListModel();

b&&b.renameThread(a.thread_id,a.name)},n=function(a){g(a,!0)},o=function(a){g(a,!1)},p=function(a){i(a,!0)},q=function(a){i(a,!1)},r=function(a){h(a,!0)},s=function(a){h(a,!1)},t=function(b){var f=c.getTribeForumThreadListModel();e.updateNewThreadCount(b.thread_ids),f&&(f.deleteThreads(b.forum_id,b.thread_ids),a.$broadcast(d.FORUM_THREADS_UPDATED,{ids:[b.forum_id]}))},u=function(b){var e=[b.forum_id],f=c.getTribeForumThreadListModel();f&&(f.reorderThreads(b.forum_id,b.threads),b.threads[0].forum_id!==b.forum_id&&e.push(b.threads[0].forum_id),a.$broadcast(d.FORUM_THREADS_UPDATED,{ids:e}))},v=function(b){var f=c.getTribeForumThreadListModel();f&&(e.updateLastPost(b),a.$broadcast(d.FORUM_THREADS_UPDATED,{ids:[b.thread.forum_id]})),b.thread.reader_id!==c.getPlayer().getId()&&e.updateNewThreadCount([b.thread.id],!0)};return f[d.FORUM_FORUM_DELETED]=j,f[d.FORUM_THREAD_LIST]=k,f[d.FORUM_THREAD_CREATED]=l,f[d.FORUM_THREAD_RENAMED]=m,f[d.FORUM_THREADS_CLOSED]=n,f[d.FORUM_THREADS_REOPENED]=o,f[d.FORUM_THREADS_MARKED_READ]=p,f[d.FORUM_THREADS_MARKED_UNREAD]=q,f[d.FORUM_THREADS_DELETED]=t,f[d.FORUM_POST_CREATED]=v,f[d.FORUM_THREADS_PINNED]=u,f[d.FORUM_THREADS_UNPINNED]=u,f[d.FORUM_THREADS_MOVED]=u,f[d.FORUM_FORUM_MARKED_UNREAD]=s,f[d.FORUM_FORUM_MARKED_READ]=r,f}])}),define("handlers/ArmyPresetHandler",["app","helper/dataconversion"],function(a,b){a.factory("armyPresetHandler",["$rootScope","modelDataService","hotkeyManagerService","storageService","presetService","eventTypeProvider",function(a,c,d,e,f,g){var h={},i=function(a){var d=c.getSelectedCharacter(),e=d.getSelectedVillage();e.getId()===a.village_id&&(a.presets.forEach(b.icon),e.setPresets(a.presets),d.setPresets(a.presets))},j=function(a){var b,g,h,i=c.getSelectedVillage().getId(),j=e.getItem(f.getStorageKey())||{},k=c.getPresetList();if(k.assign(a),a.village_id===i){for(b in j){g=!1;for(h in k.presets)(parseInt(k.presets[h],10)===parseInt(b,10)||k.presets[b].assigned_villages.length)&&(g=!0);g||delete j[b]}e.setItem(f.getStorageKey(),j),d.init()}},k=function(a){b.icon(a),c.getPresetList().addPresets({presets:[a],assigned_villages:a.assigned_villages})},l=function(a){a.presets.forEach(b.icon),c.getPresetList().addPresets(a)},m=function(a){c.getPresetList().deletePresets(a.id)};return h[g.ARMY_PRESET_FOR_VILLAGE]=i,h[g.ARMY_PRESET_LIST]=l,h[g.ARMY_PRESET_DELETED]=m,h[g.ARMY_PRESET_ASSIGNED]=j,h[g.ARMY_PRESET_SAVED]=k,h}])}),define("handlers/ResourceDepositHandler",["app","models/ResourceDepositModel"],function(a,b){a.factory("resourceDepositHandler",["$rootScope","modelDataService","resourceDepositService","eventTypeProvider",function(a,c,d,e){var f={},g=function(a){var e,f=c.getSelectedCharacter();(e=f.getResourceDeposit())||(e=new b(a),f.setResourceDeposit(e)),a.milestones&&d.updateMilestones(a.milestones),e.x=a.x,e.y=a.y,d.updateJobData(a.jobs,!0)},h=function(a){d.updateJobData(a,!0)};return f[e.RESOURCE_DEPOSIT_INFO]=g,f[e.RESOURCE_DEPOSIT_JOBS_REROLLED]=h,f}])}),define("models/TribeRelationsModel",[],function(){var a=function(a){return+a.tribe_id},b=function(b){this.relations=b,this.lookup={ally:b.ally.map(a),nap:b.nap.map(a),enemy:b.enemy.map(a)}};return b.prototype.isAlly=function(a){return this.lookup.ally.indexOf(+a)>=0},b.prototype.isEnemy=function(a){return this.lookup.enemy.indexOf(+a)>=0},b.prototype.isNAP=function(a){return this.lookup.nap.indexOf(+a)>=0},b.prototype.change=function(a){var b,c;for(b in this.lookup)if((c=this.lookup[b].indexOf(+a.tribe.tribe_id))>=0){this.lookup[b].remove(c);break}for(c=this.relations[b].length;c--;)if(this.relations[b][c].tribe_id===a.tribe.tribe_id){this.relations[b].remove(c);break}a.relation&&(this.relations[a.relation].push(a.tribe),this.lookup[a.relation].push(+a.tribe.tribe_id))},b}),define("handlers/TribeHandler",["app","angular","models/TribeRelationsModel","models/TribeInvitationsModel","models/TribeSkillListModel","struct/MapData"],function(a,b,c,d,e,f){a.factory("tribeHandler",["$rootScope","routeProvider","eventTypeProvider","modelDataService",function(a,g,h,i){var j={},k=function(){var c,d,e,f,g,j="tribe",k=[i.getSelectedCharacter().getEffectList(),i.getSelectedVillage().getEffectList()];for(f=0;f<k.length;f++){for(c=k[f],d=[],g=0;g<c.effects.length;g++)e=c.effects[g],e.data.scope===j&&d.push(b.copy(e));for(g=0;g<d.length;g++)e=d[g],c.removeEffect(e.id),e.data.effect_type=e.type,a.$broadcast(h.EFFECT_EXPIRED,e.data)}},l=function(){var a=i.getSelectedCharacter();a.setTribeId(null),a.setTribeRelations(null),a.setTribeRights({}),k(),window.twx.game.map.forceRedraw(!0)},m=function(a){var b=i.getSelectedCharacter();b.setTribeId(a.id),b.setTribeRights(a.tribe_rights)},n=function(a){i.getSelectedCharacter().setTribeRelations(new c(a.relations)),window.twx.game.map.forceRedraw(!0)},o=function(a){i.getSelectedCharacter().getTribeRelations().change(a),window.twx.game.map.forceRedraw(!0)},p=function(a){i.getSelectedCharacter().getTribeInvitations().removeInvitation(a.id)},q=function(a){i.getSelectedCharacter().setTribeInvitations(new d(a.invitations))},r=function(a){i.getApplications().setData(a.applications)},s=function(a){i.getApplications().removeApplication(a.id)},t=function(a){a.candidate_id===i.getSelectedCharacter().getId()&&i.getApplications().addApplication(a)},u=function(a){a.candidate_id===i.getSelectedCharacter().getId()&&i.getSelectedCharacter().getTribeInvitations().addInvitation(a)},v=function(a){var b=i.getSelectedCharacter(),c=b.getId();c===a.character_id?(b.setTribeId(a.tribe_id),b.setTribeRights(a.tribe_rights),window.injector.get("socketService").emit(g.EFFECT_GET_EFFECTS)):f.onEachTown(function(b){b.character_id===a.character_id&&(b.tribe_id=a.tribe_id)}),window.twx.game.map.forceRedraw(!0)},w=function(a){v(a),s(a)},x=function(a){v(a),p(a)},y=function(a){var b=i.getSelectedCharacter();a.member_id===b.getId()&&b.setTribeRights(a.rights)},z=function(a){var b=i.getSelectedCharacter();a.id===b.getId()&&l(),window.twx.game.map.forceRedraw(!0)},A=function(a){var b=i.getSelectedCharacter();a.new_founder_id===b.getId()&&b.setTribeRights(Object.keys(i.getGameData().getTribeRights()))},B=function(a){var b=i.getTribeSettings();b.power=a.new_power,b.level=a.level},C=function(a){var b=i.getTribeSettings();b.power=a.power,b.level=a.level},D=function(a){i.setTribeSkills(new e(a.skills))};return j[h.TRIBE_LEFT]=l,j[h.TRIBE_CREATED]=m,j[h.TRIBE_DISBANDED]=l,j[h.TRIBE_RELATION_LIST]=n,j[h.TRIBE_RELATION_CHANGED]=o,j[h.TRIBE_JOINED]=v,j[h.TRIBE_INVITATION_OWN]=q,j[h.TRIBE_INVITATION_CREATED]=u,j[h.TRIBE_INVITATION_ACCEPTED]=x,j[h.TRIBE_INVITATION_REJECT]=p,j[h.TRIBE_INVITATION_ABORTED]=p,j[h.TRIBE_APPLICATION_ACCEPTED]=w,j[h.TRIBE_APPLICATION_OWN]=r,j[h.TRIBE_APPLICATION_CREATED]=t,j[h.TRIBE_APPLICATION_ABORTED]=s,j[h.TRIBE_APPLICATION_REJECTED]=s,j[h.TRIBE_MEMBER_RIGHTS_SET]=y,j[h.TRIBE_MEMBER_KICKED]=z,j[h.TRIBE_FOUNDER_UPDATED]=A,j[h.TRIBE_SKILL_DONATED]=B,j[h.TRIBE_SKILLS_INFO]=D,j[h.TRIBE_SKILL_REASSIGNED]=C,j}])}),define("handlers/handlers",["conf/conf","handlers/InventoryModelHandler","handlers/QuestLineModelHandler","handlers/TradeListModelHandler","handlers/InviteFriendHandler","handlers/GameDataResearchesModelHandler","handlers/RecruitJobHandler","handlers/EffectModelHandler","handlers/CommandHandler","handlers/ForumHandler","handlers/ArmyPresetHandler","handlers/ResourceDepositHandler","handlers/TribeHandler"],function(a){a.DEBUG}),/*! 
 * angular-hotkeys v1.4.5
 * https://chieffancypants.github.io/angular-hotkeys
 * Copyright (c) 2014 Wes Cruver
 * License: MIT
 */
function(){"use strict";angular.module("cfp.hotkeys",[]).provider("hotkeys",function(){this.includeCheatSheet=!0,this.templateTitle="Keyboard Shortcuts:",this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys"><h4 class="cfp-hotkeys-title">{{ title }}</h4><table><tbody><tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }"><td class="cfp-hotkeys-keys"><span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span></td><td class="cfp-hotkeys-text">{{ hotkey.description }}</td></tr></tbody></table><div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()">×</div></div></div>',this.cheatSheetHotkey="?",this.cheatSheetDescription="toggle_modal",this.$get=["$rootElement","$rootScope","$compile","$window","$document",function(a,b,c,d,e){function f(a){var b={command:"⌘",shift:"⇧",left:"←",right:"→",up:"↑",down:"↓","return":"↩",backspace:"⌫"};a=a.split("+");for(var c=0;c<a.length;c++)"mod"===a[c]&&(d.navigator&&d.navigator.platform.indexOf("Mac")>=0?a[c]="command":a[c]="ctrl"),a[c]=b[a[c]]||a[c];return a.join(" + ")}function g(a,b,c,d,e,f){this.combo=a instanceof Array?a:[a],this.description=b,this.callback=c,this.action=d,this.allowIn=e,this.persistent=f}function h(){for(var a=o.hotkeys.length;a--;){var b=o.hotkeys[a];b&&!b.persistent&&k(b)}}function i(){o.helpVisible=!o.helpVisible,o.helpVisible?(t=l("esc"),k("esc"),j("esc",t.description,i)):(k("esc"),t!==!1&&j(t))}function j(a,b,c,d,e,f){var h,i=["INPUT","SELECT","TEXTAREA"],j=Object.prototype.toString.call(a);if("[object Object]"===j&&(b=a.description,c=a.callback,d=a.action,f=a.persistent,e=a.allowIn,a=a.combo),b instanceof Function?(d=c,c=b,b="$$undefined$$"):angular.isUndefined(b)&&(b="$$undefined$$"),void 0===f&&(f=!0),"function"==typeof c){h=c,e instanceof Array||(e=[]);for(var k,l=0;l<e.length;l++)e[l]=e[l].toUpperCase(),k=i.indexOf(e[l]),-1!==k&&i.splice(k,1);c=function(a){var b=!0,c=a.target||a.srcElement,d=c.nodeName.toUpperCase();if(c.contentEditable===!0||"inherit"===c.contentEditable){if((" "+c.className+" ").indexOf(" mousetrap ")>-1)b=!0;else for(var e=0;e<i.length;e++)if(i[e]===d){b=!1;break}b&&n(h.apply(this,arguments))}}}"string"==typeof d?Mousetrap.bind(a,n(c),d):Mousetrap.bind(a,n(c));var m=new g(a,b,c,d,e,f);return o.hotkeys.push(m),m}function k(a){var b=a instanceof g?a.combo:a;if(Mousetrap.unbind(b),angular.isArray(b)){for(var c=!0,d=b.length;d--;)c=k(b[d])&&c;return c}var e=o.hotkeys.indexOf(l(b));return e>-1?(o.hotkeys[e].combo.length>1?o.hotkeys[e].combo.splice(o.hotkeys[e].combo.indexOf(b),1):o.hotkeys.splice(e,1),!0):!1}function l(a){for(var b,c=0;c<o.hotkeys.length;c++)if(b=o.hotkeys[c],b.combo.indexOf(a)>-1)return b;return!1}function m(a){return a.$id in p||(p[a.$id]=[],a.$on("$destroy",function(){for(var b=p[a.$id].length;b--;)k(p[a.$id][b]),delete p[a.$id][b]})),{add:function(b){var c;return c=arguments.length>1?j.apply(this,arguments):j(b),p[a.$id].push(c),this}}}function n(a){return function(c,d){if(a instanceof Array){var e=a[0],f=a[1];a=function(a){f.scope.$eval(e)}}b.$apply(function(){a(c,l(d))})}}Mousetrap.stopCallback=function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:b.contentEditable&&"true"==b.contentEditable},g.prototype.format=function(){for(var a=this.combo[0],b=a.split(/[\s]/),c=0;c<b.length;c++)b[c]=f(b[c]);return b};var o=b.$new();o.hotkeys=[],o.helpVisible=!1,o.title=this.templateTitle,o.toggleCheatSheet=i;var p=[];if(b.$on("$routeChangeSuccess",function(a,b){h(),b&&b.hotkeys&&angular.forEach(b.hotkeys,function(a){var c=a[2];("string"==typeof c||c instanceof String)&&(a[2]=[c,b]),a[5]=!1,j.apply(this,a)})}),this.includeCheatSheet){var q=e[0],r=a[0],s=angular.element(this.template);j(this.cheatSheetHotkey,this.cheatSheetDescription,i),(r===q||r===q.documentElement)&&(r=q.body),angular.element(r).append(c(s)(o))}var t=!1,u={add:j,del:k,get:l,bindTo:m,template:this.template,toggleCheatSheet:i,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,purgeHotkeys:h,templateTitle:this.templateTitle};return u}]}).directive("hotkey",["hotkeys",function(a){return{restrict:"A",link:function(b,c,d){var e,f;angular.forEach(b.$eval(d.hotkey),function(b,c){f="string"==typeof d.hotkeyAllowIn?d.hotkeyAllowIn.split(/[\s,]+/):[],e=c,a.add({combo:c,description:d.hotkeyDescription,callback:b,action:d.hotkeyAction,allowIn:f})}),c.bind("$destroy",function(){a.del(e)})}}}]).run(["hotkeys",function(a){}])}(),function(a,b,c){function d(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return z[a.which]?z[a.which]:A[a.which]?A[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a,b){return a.sort().join(",")===b.sort().join(",")}function g(a){a=a||{};var b,c=!1;for(b in F)a[b]?c=!0:F[b]=0;c||(I=!1)}function h(a,b,c,d,e,g){var h,i,j=[],k=c.type;if(!D[a])return[];for("keyup"==k&&o(a)&&(b=[a]),h=0;h<D[a].length;++h)if(i=D[a][h],(d||!i.seq||F[i.seq]==i.level)&&k==i.action&&("keypress"==k&&!c.metaKey&&!c.ctrlKey||f(b,i.modifiers))){var l=!d&&i.combo==e,m=d&&i.seq==d&&i.level==g;(l||m)&&D[a].splice(h,1),j.push(i)}return j}function i(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function j(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)}function k(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)}function l(a,b,c,d){K.stopCallback(b,b.target||b.srcElement,c,d)||a(b,c)===!1&&(j(b),k(b))}function m(a,b,c){var d,e=h(a,b,c),f={},i=0,j=!1;for(d=0;d<e.length;++d)e[d].seq&&(i=Math.max(i,e[d].level));for(d=0;d<e.length;++d)if(e[d].seq){if(e[d].level!=i)continue;j=!0,f[e[d].seq]=1,l(e[d].callback,c,e[d].combo,e[d].seq)}else j||l(e[d].callback,c,e[d].combo);var k="keypress"==c.type&&H;c.type!=I||o(a)||k||g(f),H=j&&"keydown"==c.type}function n(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);if(b)return"keyup"==a.type&&G===b?void(G=!1):void K.handleKey(b,i(a),a)}function o(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function p(){clearTimeout(y),y=setTimeout(g,1e3)}function q(){if(!x){x={};for(var a in z)a>95&&112>a||z.hasOwnProperty(a)&&(x[z[a]]=a)}return x}function r(a,b,c){return c||(c=q()[a]?"keydown":"keypress"),"keypress"==c&&b.length&&(c="keydown"),c}function s(a,b,c,d){function f(b){return function(){I=b,++F[a],p()}}function h(b){l(c,b,a),"keyup"!==d&&(G=e(b)),setTimeout(g,10)}F[a]=0;for(var i=0;i<b.length;++i){var j=i+1===b.length,k=j?h:f(d||u(b[i+1]).action);v(b[i],k,d,a,i)}}function t(a){return"+"===a?["+"]:a.split("+")}function u(a,b){var c,d,e,f=[];for(c=t(a),e=0;e<c.length;++e)d=c[e],C[d]&&(d=C[d]),b&&"keypress"!=b&&B[d]&&(d=B[d],f.push("shift")),o(d)&&f.push(d);return b=r(d,f,b),{key:d,modifiers:f,action:b}}function v(a,b,c,d,e){E[a+":"+c]=b,a=a.replace(/\s+/g," ");var f,g=a.split(" ");return g.length>1?void s(a,g,b,c):(f=u(a,c),D[f.key]=D[f.key]||[],h(f.key,f.modifiers,{type:f.action},d,a,e),void D[f.key][d?"unshift":"push"]({callback:b,modifiers:f.modifiers,action:f.action,seq:d,level:e,combo:a}))}function w(a,b,c){for(var d=0;d<a.length;++d)v(a[d],b,c)}for(var x,y,z={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},A={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},B={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},C={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},D={},E={},F={},G=!1,H=!1,I=!1,J=1;20>J;++J)z[111+J]="f"+J;for(J=0;9>=J;++J)z[J+96]=J;d(b,"keypress",n),d(b,"keydown",n),d(b,"keyup",n);var K={bind:function(a,b,c){return a=a instanceof Array?a:[a],w(a,b,c),this},unbind:function(a,b){return K.bind(a,function(){},b)},trigger:function(a,b){return E[a+":"+b]&&E[a+":"+b]({},a),this},reset:function(){return D={},E={},this},stopCallback:function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},handleKey:m};a.Mousetrap=K,"function"==typeof define&&define.amd&&define("hotkeys",K)}(window,document),define("app.config",["app","conf/cdn"],function(a,b){a.config(["$socketProvider","$httpProvider","$sceDelegateProvider","hotkeysProvider",function(a,c,d,e){var f=["self"];a.responseInterceptors.push("backendConversionService"),a.responseInterceptors.push("socketModelService"),a.responseInterceptors.push("dataDependencyResolverService"),c.interceptors.push("httpCdnRequestInterceptorService"),e.template='<div id="hotkey-controller" ng-controller="ModalShowHotkeyController"></div>',b.host&&f.push(b.host+"/**"),d.resourceUrlWhitelist(f)}])}),define("tools/qa",["generators/generate","helper/math","battlecat"],function(a,b,c){var d=function(a,b){var d,e=window.twx.game.map.engine,f=e.graph.getScreenCoords(a,e.getView());return b&&(d=c(window.twx.game.map.engine.canvas).offset(),f.x+=d.left,f.y+=d.top),f};return{getScreenCoordinatesForVillage:function(b,c){var e=window.twx.game.map.engine,f=a.villageName(b),g=e.graph.findByName(f);return d(g,c)},getScreenCoordinatesForLandmark:function(b,c,e){var f=window.twx.game.map.engine,g=a.tileName(b,c,!1,!0),h=f.graph.findByName(g);return d(h,e)},getPointInBuilding:function(a,c){var e,f,g,h,i=window.twx.game.map.engine,j=i.graph.findByName("town");for(f in j.childrenNameTable)if(0===f.indexOf(a)){e=j.childrenNameTable[f];break}if(!e||!(h=e.verts)||!h.length)throw new Error("Couldn't find sprite or polygon.");return g=b.getPointInPolygon(h),g[0]*=j.childrenNameTable.background.width,g[1]*=j.childrenNameTable.background.height,d({matrix:b.multiply(j.getTotalTransformation(),[1,0,0,1].concat(g))},c)}}}),requirejs.config({baseUrl:"/js/game",deps:["sizzle","battlecat","plugins","plugins/array","plugins/function","plugins/number","plugins/string","plugins/date","jsScrollbar"],paths:{raven:"../libs/raven",angular:"../libs/angular","angular-cookie":"../libs/angular-cookie",howler:"../libs/howler",sizzle:"../libs/sizzle",jsScrollbar:"../libs/jsScrollbar",rangy:"../libs/rangy-core",rangySelection:"../libs/rangy-selectionsaverestore",battlecat:"../libs/battlecat",textAngularSanit:"../libs/textAngular-sanitize",textAngular:"../libs/textAngular",textAngularSetup:"../libs/textAngularSetup",pointerEvents:"../libs/pointer_events_polyfill",hotkeys:"../libs/angular-hotkeys",plugins:"plugins",engine2dConf:"conf/engine2d.conf",version:"version/version","product-version":"version/product-version.dev",controller:"construct/controller",graph:"construct/graph",manager:"construct/manager",model:"construct/model",ui:"construct/ui",auth:"controller/auth",building:"controller/building",modal:"controller/modal",overlay:"controller/overlay"},shim:{angular:{exports:"angular"},"angular-cookie":{deps:["angular"]},hotkeys:{deps:["angular"]},rangy:{exports:"rangy"},rangySelection:{deps:["rangy"]},textAngularSanit:{exports:"textAngularSanit",deps:["angular"]},textAngular:{exports:"textAngular",deps:["angular","rangy","textAngularSanit"]},textAngularSetup:{exports:"textAngularSetup",deps:["angular","rangy","textAngular"]},battlecat:{exports:"$",deps:["sizzle"]},pointerEvents:{exports:"PointerEventsPolyfill"},"app.config":{deps:["providers/SocketProvider"]}}}),require(["angular","raven","app","twx","conf/conf","version","rangy","rangySelection","pointerEvents","angular-cookie","textAngularSetup","howler","services/services","controllers/controllers","filters/filters","directives/directives","models/models","providers/providers","factories/factories","handlers/handlers","hotkeys","app.config","tools/qa"],function(a,b,c,d,e,f,g,h){e.DEBUG,c.factory("$exceptionHandler",["$log","ravenTagService",function(a,c){return function(d,f){a.error(d),e.SENTRY_ENABLED&&b.captureException(d,{extra:{cause:f},tags:c.tags})}}]);var i=a.bootstrap(document,["twx"]),j=i.get("$rootScope");window.injector=j.injector=i,document.title+=" ("+f.product+")",g.init(),d.init()}),define("../bootstrap",function(){});
//# sourceMappingURL=game.min.js.map